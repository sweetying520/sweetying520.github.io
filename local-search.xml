<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>ä¸€ç¯‡å°±å¤Ÿç³»åˆ—ï¼šRxJava æ ¸å¿ƒè§£å¯†</title>
    <link href="/2022/10/11/%E4%B8%80%E7%AF%87%E5%B0%B1%E5%A4%9F%E7%B3%BB%E5%88%97%EF%BC%9ARxJava%20%E6%A0%B8%E5%BF%83%E8%A7%A3%E5%AF%86/"/>
    <url>/2022/10/11/%E4%B8%80%E7%AF%87%E5%B0%B1%E5%A4%9F%E7%B3%BB%E5%88%97%EF%BC%9ARxJava%20%E6%A0%B8%E5%BF%83%E8%A7%A3%E5%AF%86/</url>
    
    <content type="html"><![CDATA[<p><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/95599612f89a4939b24dc92b23a41f5a~tplv-k3u1fbpfcp-watermark.image"></p><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>å¾ˆé«˜å…´é‡è§ä½ ~</p><p>ä¼—æ‰€å‘¨çŸ¥ï¼ŒRxJava æ˜¯ä¸€ä¸ªéå¸¸æµè¡Œçš„ç¬¬ä¸‰æ–¹å¼€æºåº“ï¼Œå®ƒèƒ½å°†å¤æ‚çš„é€»è¾‘ç®€å•åŒ–ï¼Œæé«˜æˆ‘ä»¬çš„å¼€å‘æ•ˆç‡ï¼Œä¸€ä¸ªè¿™ä¹ˆå¥½ç”¨çš„åº“ï¼Œæ¥è®©æˆ‘ä»¬å­¦ä¹ ä¸€ä¸‹å§ğŸº</p><p>ä¸‹é¢æˆ‘æŠ›å‡ºä¸€äº›é—®é¢˜ï¼Œå¦‚æœä½ éƒ½çŸ¥é“ï¼Œé‚£ä¹ˆæ­å–œä½ ï¼Œä½ å¯¹ RxJava æŒæ¡çš„å¾ˆé€å½»ï¼Œå¦‚æœä½ å¯¹ä¸‹é¢è¿™äº›é—®é¢˜æœ‰ä¸€äº›ç–‘æƒ‘ï¼Œé‚£ä¹ˆä½ å°±å¯ä»¥æ¥ç€å¾€ä¸‹çœ‹ï¼Œæˆ‘ä¼šç”±æµ…å…¥æ·±çš„ç»™ä½ è®²è§£ RxJavaï¼Œçœ‹å®Œä¹‹åï¼Œè¿™äº›é—®é¢˜ä½ ä¼šéå¸¸æ˜äº†</p><p>1ã€ä»€ä¹ˆæ˜¯è§‚å¯Ÿè€…æ¨¡å¼ï¼Ÿä»€ä¹ˆæ˜¯è£…é¥°è€…æ¨¡å¼ï¼Ÿ</p><p>2ã€è§‚å¯Ÿè€…æ¨¡å¼ï¼Œè£…é¥°è€…æ¨¡å¼åœ¨ RxJava ä¸­çš„åº”ç”¨ï¼Ÿ</p><p>3ã€RxJava map å’Œ flatMap æ“ä½œç¬¦æœ‰å•¥åŒºåˆ«ï¼Ÿ</p><p>4ã€å¦‚æœæœ‰å¤šä¸ª subscribeOn ï¼Œä¼šæ˜¯ä¸€ç§ä»€ä¹ˆæƒ…å†µï¼Ÿä¸ºå•¥ï¼Ÿ</p><p>5ã€å¦‚æœæœ‰å¤šä¸ª observeOn ï¼Œä¼šæ˜¯ä¸€ç§ä»€ä¹ˆæƒ…å†µï¼Ÿä¸ºå•¥ï¼Ÿ</p><p>6ã€RxJava æ¡†æ¶æµæ€æƒ³è®¾è®¡ï¼Ÿ</p><p>7ã€RxJava çš„ Subject æ˜¯ä»€ä¹ˆï¼Ÿ</p><p>8ã€å¦‚ä½•é€šè¿‡ RxJava å®ç°ä¸€ä¸ªè‡ªå·±çš„äº‹ä»¶æ€»çº¿ï¼Ÿ</p><h2 id="ä¸€ã€è®¾è®¡æ¨¡å¼ä»‹ç»"><a href="#ä¸€ã€è®¾è®¡æ¨¡å¼ä»‹ç»" class="headerlink" title="ä¸€ã€è®¾è®¡æ¨¡å¼ä»‹ç»"></a>ä¸€ã€è®¾è®¡æ¨¡å¼ä»‹ç»</h2><p>æˆ‘ä»¬å…ˆäº†è§£ä¸€ä¸‹ä¸‹é¢ä¸¤ç§è®¾è®¡æ¨¡å¼ï¼š</p><p>1ã€è§‚å¯Ÿè€…æ¨¡å¼</p><p>2ã€è£…é¥°è€…æ¨¡å¼</p><h3 id="1-1ã€è§‚å¯Ÿè€…æ¨¡å¼"><a href="#1-1ã€è§‚å¯Ÿè€…æ¨¡å¼" class="headerlink" title="1.1ã€è§‚å¯Ÿè€…æ¨¡å¼"></a>1.1ã€è§‚å¯Ÿè€…æ¨¡å¼</h3><h4 id="1-1-1ã€è§‚å¯Ÿè€…æ¨¡å¼å®šä¹‰"><a href="#1-1-1ã€è§‚å¯Ÿè€…æ¨¡å¼å®šä¹‰" class="headerlink" title="1.1.1ã€è§‚å¯Ÿè€…æ¨¡å¼å®šä¹‰"></a>1.1.1ã€è§‚å¯Ÿè€…æ¨¡å¼å®šä¹‰</h4><p>ç®€å•çš„ç†è§£ï¼šå¯¹è±¡é—´å­˜åœ¨ä¸€ç§ä¸€å¯¹å¤šçš„ä¾èµ–å…³ç³»ï¼Œå½“ä¸€ä¸ªå¯¹è±¡çš„çŠ¶æ€å‘ç”Ÿæ”¹å˜æ—¶ï¼Œæ‰€æœ‰ä¾èµ–äºå®ƒçš„å¯¹è±¡éƒ½ä¼šå¾—åˆ°é€šçŸ¥å¹¶è¢«è‡ªåŠ¨æ›´æ–°</p><h4 id="1-1-2ã€è§‚å¯Ÿè€…æ¨¡å¼ç¤ºä¾‹"><a href="#1-1-2ã€è§‚å¯Ÿè€…æ¨¡å¼ç¤ºä¾‹" class="headerlink" title="1.1.2ã€è§‚å¯Ÿè€…æ¨¡å¼ç¤ºä¾‹"></a>1.1.2ã€è§‚å¯Ÿè€…æ¨¡å¼ç¤ºä¾‹</h4><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-comment">//1ã€å®šä¹‰ä¸€ä¸ªè§‚å¯Ÿè€…çš„æ¥å£</span><br><span class="hljs-keyword">interface</span> <span class="hljs-title class_">Observer</span> &#123;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * æ¥æ”¶äº‹ä»¶çš„æ–¹æ³•</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onChange</span><span class="hljs-params">(o: <span class="hljs-type">Any</span>)</span></span><br>&#125;<br><br><span class="hljs-comment">//2ã€å®šä¹‰ä¸€ä¸ªè¢«è§‚å¯Ÿè€…çš„æ¥å£</span><br><span class="hljs-keyword">interface</span> <span class="hljs-title class_">Observable</span> &#123;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * æ·»åŠ è§‚å¯Ÿè€…</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">addObserver</span><span class="hljs-params">(observer: <span class="hljs-type">Observer</span>)</span></span><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * ç§»é™¤è§‚å¯Ÿè€…</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">removeObserver</span><span class="hljs-params">(observer: <span class="hljs-type">Observer</span>)</span></span><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * å‘é€äº‹ä»¶é€šçŸ¥</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">changeEvent</span><span class="hljs-params">(o: <span class="hljs-type">Any</span>)</span></span><br>&#125;<br><br><span class="hljs-comment">//3ã€å®šä¹‰ä¸€ä¸ªè§‚å¯Ÿè€…çš„å®ç°ç±»</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">ObserverImpl</span>: <span class="hljs-type">Observer</span> &#123;<br>    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onChange</span><span class="hljs-params">(o: <span class="hljs-type">Any</span>)</span></span> &#123;<br>      <span class="hljs-comment">//å¯¹äº‹ä»¶è¿›è¡Œæ‰“å°</span><br>        println(o)<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">//4ã€å®šä¹‰ä¸€ä¸ªè¢«è§‚å¯Ÿè€…çš„å®ç°ç±»</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">ObservableImpl</span>: <span class="hljs-type">Observable</span> &#123;<br><br>    <span class="hljs-comment">//å­˜æ”¾è§‚å¯Ÿè€…çš„é›†åˆ</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> observerList: MutableList&lt;Observer&gt; = LinkedList()<br><br>    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">addObserver</span><span class="hljs-params">(observer: <span class="hljs-type">Observer</span>)</span></span> &#123;<br>        observerList.add(observer)<br>    &#125;<br><br>    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">removeObserver</span><span class="hljs-params">(observer: <span class="hljs-type">Observer</span>)</span></span> &#123;<br>        observerList.remove(observer)<br>    &#125;<br><br>    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">changeEvent</span><span class="hljs-params">(o: <span class="hljs-type">Any</span>)</span></span> &#123;<br>        <span class="hljs-keyword">for</span> (observer <span class="hljs-keyword">in</span> observerList) &#123;<br>            observer.onChange(o)<br>        &#125;<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">//5ã€æµ‹è¯•</span><br><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span>&#123;<br>    <span class="hljs-comment">//1ã€åˆ›å»ºè¢«è§‚å¯Ÿè€…</span><br>    <span class="hljs-keyword">val</span> observable = ObservableImpl()<br>    <span class="hljs-comment">//2ã€åˆ›å»ºè§‚å¯Ÿè€…</span><br>    <span class="hljs-keyword">val</span> observer1 = ObserverImpl()<br>    <span class="hljs-keyword">val</span> observer2 = ObserverImpl()<br>    <span class="hljs-keyword">val</span> observer3 = ObserverImpl()<br>    <span class="hljs-comment">//3ã€æ·»åŠ è§‚å¯Ÿè€…</span><br>    observable.addObserver(observer1)<br>    observable.addObserver(observer2)<br>    observable.addObserver(observer3)<br>    <span class="hljs-comment">//4ã€å‘é€äº‹ä»¶</span><br>    observable.changeEvent(<span class="hljs-string">&quot;erdai666&quot;</span>)<br>&#125;<br><span class="hljs-comment">//æ‰“å°ç»“æœ</span><br>erdai666<br>erdai666<br>erdai666<br></code></pre></td></tr></table></figure><h3 id="1-2ã€è£…é¥°è€…æ¨¡å¼"><a href="#1-2ã€è£…é¥°è€…æ¨¡å¼" class="headerlink" title="1.2ã€è£…é¥°è€…æ¨¡å¼"></a>1.2ã€è£…é¥°è€…æ¨¡å¼</h3><h4 id="1-2-1ã€è£…é¥°è€…æ¨¡å¼å®šä¹‰"><a href="#1-2-1ã€è£…é¥°è€…æ¨¡å¼å®šä¹‰" class="headerlink" title="1.2.1ã€è£…é¥°è€…æ¨¡å¼å®šä¹‰"></a>1.2.1ã€è£…é¥°è€…æ¨¡å¼å®šä¹‰</h4><p>ç®€å•çš„ç†è§£ï¼šåŠ¨æ€çš„ç»™ä¸€ä¸ªç±»è¿›è¡ŒåŠŸèƒ½å¢å¼º</p><h4 id="1-2-2ã€è£…é¥°è€…æ¨¡å¼ç¤ºä¾‹"><a href="#1-2-2ã€è£…é¥°è€…æ¨¡å¼ç¤ºä¾‹" class="headerlink" title="1.2.2ã€è£…é¥°è€…æ¨¡å¼ç¤ºä¾‹"></a>1.2.2ã€è£…é¥°è€…æ¨¡å¼ç¤ºä¾‹</h4><p>ä¸¾ä¸ªä¾‹å­ï¼šæˆ‘æƒ³åƒä¸ªè›‹ç‚’é¥­ï¼Œä½†æ˜¯å•ç‹¬ä¸€ä¸ªè›‹ç‚’é¥­æˆ‘è§‰å¾—ä¸å¥½åƒï¼Œæˆ‘æƒ³åœ¨ä¸Šé¢åŠ ç«è…¿ï¼ŒåŠ ç‰›è‚‰ã€‚æˆ‘ä»¬ä½¿ç”¨è£…é¥°è€…æ¨¡å¼æ¥å®ç°å®ƒ</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-comment">//1ã€å®šä¹‰ä¸€ä¸ªç‚’é¥­çš„æ¥å£</span><br><span class="hljs-keyword">interface</span> <span class="hljs-title class_">Rice</span> &#123;<br>    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">cook</span><span class="hljs-params">()</span></span><br>&#125;<br><br><span class="hljs-comment">//2ã€å®šä¹‰ä¸€ä¸ªç‚’é¥­æ¥å£çš„å®ç°ç±»ï¼šè›‹ç‚’é¥­</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">EggFriedRice</span>: <span class="hljs-type">Rice</span> &#123;<br><br>    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">cook</span><span class="hljs-params">()</span></span> &#123;<br>        println(<span class="hljs-string">&quot;è›‹ç‚’é¥­&quot;</span>)<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">//3ã€å®šä¹‰ä¸€ä¸ªç‚’é¥­çš„æŠ½è±¡è£…é¥°ç±»</span><br><span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RiceDecorate</span>(<span class="hljs-keyword">var</span> rice: Rice): Rice<br><br><span class="hljs-comment">//4ã€å¾€è›‹ç‚’é¥­ä¸­åŠ ç«è…¿</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">HamFriedRiceDecorate</span>(rice: Rice): RiceDecorate(rice) &#123;<br>    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">cook</span><span class="hljs-params">()</span></span> &#123;<br>        rice.cook()<br>        println(<span class="hljs-string">&quot;åŠ ç«è…¿&quot;</span>)<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">//5ã€å¾€è›‹ç‚’é¥­ä¸­åŠ ç‰›è‚‰</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">BeefFriedRiceDecorate</span>(rice: Rice): RiceDecorate(rice) &#123;<br><br>    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">cook</span><span class="hljs-params">()</span></span> &#123;<br>        rice.cook()<br>        println(<span class="hljs-string">&quot;åŠ ç‰›è‚‰&quot;</span>)<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">//6ã€æµ‹è¯•</span><br><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span>&#123;<br>    <span class="hljs-comment">//è›‹ç‚’é¥­</span><br>    <span class="hljs-keyword">val</span> rice = EggFriedRice()<br>    <span class="hljs-comment">//åŠ ç«è…¿</span><br>    <span class="hljs-keyword">val</span> hamFriedRiceDecorate = HamFriedRiceDecorate(rice)<br>    <span class="hljs-comment">//åŠ ç‰›è‚‰</span><br>    <span class="hljs-keyword">val</span> beefFriedRiceDecorate = BeefFriedRiceDecorate(hamFriedRiceDecorate)<br>    beefFriedRiceDecorate.cook()<br>&#125;<br><span class="hljs-comment">//æ‰“å°ç»“æœ</span><br>è›‹ç‚’é¥­<br>åŠ ç«è…¿<br>åŠ ç‰›è‚‰<br></code></pre></td></tr></table></figure><p>è£…é¥°è€…æ¨¡å¼çš„æ ¸å¿ƒï¼šå®šä¹‰ä¸€ä¸ªæŠ½è±¡çš„è£…é¥°ç±»ç»§æ‰¿é¡¶çº§æ¥å£ï¼Œç„¶åæŒæœ‰è¿™ä¸ªé¡¶çº§æ¥å£çš„å¼•ç”¨ï¼Œæ¥ä¸‹æ¥å°±å¯ä»¥è¿›è¡Œæ— é™å¥—å¨ƒäº†ğŸ˜„</p><h2 id="äºŒã€æ‰‹æ’¸-RxJava-æ ¸å¿ƒæºç å®ç°"><a href="#äºŒã€æ‰‹æ’¸-RxJava-æ ¸å¿ƒæºç å®ç°" class="headerlink" title="äºŒã€æ‰‹æ’¸ RxJava æ ¸å¿ƒæºç å®ç°"></a>äºŒã€æ‰‹æ’¸ RxJava æ ¸å¿ƒæºç å®ç°</h2><p>okï¼Œäº†è§£äº†ä¸¤ç§è®¾è®¡æ¨¡å¼ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬æ­£å¼è¿›å…¥ RxJava çš„å­¦ä¹ </p><h3 id="2-1ã€RxJava-ä»‹ç»"><a href="#2-1ã€RxJava-ä»‹ç»" class="headerlink" title="2.1ã€RxJava ä»‹ç»"></a>2.1ã€RxJava ä»‹ç»</h3><p>RxJava æ˜¯ä¸€ä¸ªå¼‚æ­¥æ“ä½œæ¡†æ¶ï¼Œå…¶æ ¸å¿ƒå¯ä»¥å½’çº³ä¸ºä¸¤ç‚¹ï¼š1ã€å¼‚æ­¥äº‹ä»¶æµ 2ã€å“åº”å¼ç¼–ç¨‹ã€‚æ¥ä¸‹æ¥æˆ‘ä»¬å¯ä»¥å¥½å¥½çš„å»æ„Ÿå—è¿™ä¸¤ç‚¹</p><h3 id="2-2ã€RxJava-æ“ä½œç¬¦"><a href="#2-2ã€RxJava-æ“ä½œç¬¦" class="headerlink" title="2.2ã€RxJava æ“ä½œç¬¦"></a>2.2ã€RxJava æ“ä½œç¬¦</h3><p>RxJava ä¹‹æ‰€ä»¥å¼ºå¤§æºäºå®ƒå„ç§å¼ºå¤§çš„æ“ä½œç¬¦ï¼ŒæŒæ¡å¥½è¿™äº›æ“ä½œç¬¦èƒ½è®©ä½ å¯¹ RxJava çš„ä½¿ç”¨å¾—å¿ƒåº”æ‰‹ï¼ŒRxJava æ“ä½œç¬¦ä¸»è¦åˆ†ä¸º 6 å¤§ç±»ï¼š</p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/86c610f277a04ab786cd788ffb73a32c~tplv-k3u1fbpfcp-watermark.image?" alt="RxJava æ“ä½œç¬¦.png" width="100%" /><p>æ¯ä¸€ä¸ªæ“ä½œç¬¦èƒŒåéƒ½å¯¹åº”äº†ä¸€ä¸ªå…·ä½“çš„å®ç°ç±»ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å°±æŒ‘å‡ ä¸ªæœ€å¸¸ç”¨ï¼Œæœ€æ ¸å¿ƒçš„æ“ä½œç¬¦ï¼šcreateï¼Œmapï¼ŒflatMapï¼ŒobserveOnï¼ŒsubscribeOn è¿›è¡Œæ‰‹æ’¸å®ç°ï¼Œç›¸ä¿¡çœ‹å®Œè¿™äº›æ“ä½œç¬¦çš„å®ç°åï¼Œä½ èƒ½èä¼šè´¯é€šï¼Œä¸¾ä¸€åä¸‰</p><p><strong>æ³¨æ„</strong>ï¼šä¸‹é¢è¿™äº›æ“ä½œç¬¦çš„å®ç°å’Œ RxJava å®ç°ç»†èŠ‚ä¸å°½ç›¸åŒï¼Œä½†æ ¸å¿ƒæ€æƒ³æ˜¯ä¸€è‡´çš„ï¼Œå¤§å®¶åªè¦ç†è§£æ ¸å¿ƒæ€æƒ³å°±å¥½</p><h3 id="2-3ã€create-æ“ä½œç¬¦å®ç°"><a href="#2-3ã€create-æ“ä½œç¬¦å®ç°" class="headerlink" title="2.3ã€create æ“ä½œç¬¦å®ç°"></a>2.3ã€create æ“ä½œç¬¦å®ç°</h3><p>create æ˜¯æ¥åˆ›å»ºä¸€ä¸ªè¢«è§‚å¯Ÿè€…å¯¹è±¡ï¼Œçœ‹äº† RxJava create æ“ä½œç¬¦æºç ä½ ä¼šå‘ç°ï¼š</p><p>1ã€create æ˜¯ä½¿ç”¨è§‚å¯Ÿè€…æ¨¡å¼å®ç°çš„ï¼Œä½† RxJava é‡Œé¢ä½¿ç”¨çš„è§‚å¯Ÿè€…æ¨¡å¼å’Œæˆ‘ä»¬ä¸Šé¢ä»‹ç»çš„è¿˜æœ‰ç‚¹ä¸ä¸€æ ·ï¼Œå®ƒæ˜¯ä¸€ç§å˜ç§çš„è§‚å¯Ÿè€…æ¨¡å¼</p><p>2ã€ä¸Šé¢ä¾‹å­ä¸­æˆ‘ä»¬æ˜¯é€šè¿‡è¢«è§‚å¯Ÿè€…å»å‘é€äº‹ä»¶ï¼Œè€Œ RxJava é‡Œé¢å®šä¹‰äº†ä¸“é—¨å‘é€äº‹ä»¶çš„æ¥å£ï¼Œè¿™æ ·åšçš„å¥½å¤„å°±æ˜¯è®©è¢«è§‚å¯Ÿè€…å’Œå‘å°„äº‹ä»¶è¿›è¡Œè§£è€¦</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-comment">//1ã€å®šä¹‰ä¸€ä¸ªè§‚å¯Ÿè€…çš„é¡¶çº§æ¥å£</span><br><span class="hljs-keyword">interface</span> <span class="hljs-title class_">Observer</span>&lt;<span class="hljs-type">T</span>&gt; &#123;<br>    <span class="hljs-comment">//å»ºç«‹äº†è®¢é˜…å…³ç³»</span><br>    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onSubscribe</span><span class="hljs-params">()</span></span><br>    <span class="hljs-comment">//æ¥æ”¶åˆ°æ­£å¸¸äº‹ä»¶</span><br>    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onNext</span><span class="hljs-params">(t: <span class="hljs-type">T</span>)</span></span><br>    <span class="hljs-comment">//æ¥æ”¶åˆ° error äº‹ä»¶</span><br>    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onError</span><span class="hljs-params">(e: <span class="hljs-type">Throwable</span>)</span></span><br>    <span class="hljs-comment">//æ¥æ”¶åˆ° onComplete äº‹ä»¶</span><br>    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onComplete</span><span class="hljs-params">()</span></span><br>&#125;<br><br><span class="hljs-comment">//2ã€å®šä¹‰ä¸€ä¸ªè¢«è§‚å¯Ÿè€…çš„é¡¶çº§æ¥å£</span><br><span class="hljs-keyword">interface</span> <span class="hljs-title class_">ObservableSource</span>&lt;<span class="hljs-type">T</span>&gt; &#123;<br>    <span class="hljs-comment">//è®¢é˜…è§‚å¯Ÿè€…</span><br>    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">subscribe</span><span class="hljs-params">(observer: <span class="hljs-type">Observer</span>&lt;<span class="hljs-type">T</span>&gt;)</span></span><br>&#125;<br><br><span class="hljs-comment">//3ã€å®šä¹‰ä¸€ä¸ªè¢«è§‚å¯Ÿè€…æŠ½è±¡ç±»å®ç°é¡¶å±‚è¢«è§‚å¯Ÿè€…æ¥å£</span><br><span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Observable</span>&lt;<span class="hljs-type">T</span>&gt;: <span class="hljs-type">ObservableSource</span>&lt;<span class="hljs-type">T</span>&gt; &#123;<br><br>    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">subscribe</span><span class="hljs-params">(observer: <span class="hljs-type">Observer</span>&lt;<span class="hljs-type">T</span>&gt;)</span></span> &#123;<br>        subscribeActual(observer)<br>    &#125;<br><br>    <span class="hljs-comment">//å®é™…è®¢é˜…è§‚å¯Ÿè€…çš„æŠ½è±¡æ–¹æ³•ï¼Œè®©å­ç±»å»å®ç°</span><br>    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">abstract</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">subscribeActual</span><span class="hljs-params">(observer: <span class="hljs-type">Observer</span>&lt;<span class="hljs-type">T</span>&gt;)</span></span><br><br>    <span class="hljs-comment">//ä¼´ç”Ÿç±»é‡Œé¢çš„æ–¹æ³•ï¼Œç›´æ¥é€šè¿‡ç±»åè°ƒç”¨    </span><br>    <span class="hljs-keyword">companion</span> <span class="hljs-keyword">object</span>&#123;<br>      <span class="hljs-comment">//è¿™é‡Œæ˜¯æˆ‘ä»¬å®ç° create æ“ä½œç¬¦å¯¹å¤–æä¾›å’Œ RxJava ç±»ä¼¼çš„æ–¹æ³•è°ƒç”¨</span><br>        <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;T&gt;</span> <span class="hljs-title">create</span><span class="hljs-params">(source: <span class="hljs-type">ObservableOnSubscribe</span>&lt;<span class="hljs-type">T</span>&gt;)</span></span>: ObservableCreate&lt;T&gt;&#123;<br>            <span class="hljs-keyword">return</span> ObservableCreate(source)<br>        &#125;<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">//4ã€å®šä¹‰ä¸€ä¸ªä¸è¢«è§‚å¯Ÿè€…å‘å°„äº‹ä»¶è§£è€¦çš„æ¥å£</span><br><span class="hljs-keyword">interface</span> <span class="hljs-title class_">ObservableOnSubscribe</span>&lt;<span class="hljs-type">T</span>&gt; &#123;<br>    <span class="hljs-comment">//é€šè¿‡ Emitter å‘å°„äº‹ä»¶</span><br>    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">subscribe</span><span class="hljs-params">(emitter: <span class="hljs-type">Emitter</span>&lt;<span class="hljs-type">T</span>&gt;)</span></span><br>&#125;<br><br><span class="hljs-comment">//5ã€å®šä¹‰äº‹ä»¶å‘å°„å™¨æ¥å£</span><br><span class="hljs-keyword">interface</span> <span class="hljs-title class_">Emitter</span>&lt;<span class="hljs-type">T</span>&gt; &#123;<br>    <span class="hljs-comment">//å‘é€ onNext äº‹ä»¶</span><br>    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onNext</span><span class="hljs-params">(t: <span class="hljs-type">T</span>)</span></span><br>    <span class="hljs-comment">//å‘é€ onError äº‹ä»¶</span><br>    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onError</span><span class="hljs-params">(e: <span class="hljs-type">Throwable</span>)</span></span><br>    <span class="hljs-comment">//å‘é€ onComplete äº‹ä»¶</span><br>    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onComplete</span><span class="hljs-params">()</span></span><br>&#125;<br><br><span class="hljs-comment">//6ã€å®šä¹‰ create æ“ä½œç¬¦çš„å®ç°ç±»</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">ObservableCreate</span>&lt;<span class="hljs-type">T</span>&gt;(<span class="hljs-keyword">var</span> source: ObservableOnSubscribe&lt;T&gt;): Observable&lt;T&gt;() &#123;<br><br>    <span class="hljs-comment">//å®ç°çˆ¶ç±»è®¢é˜…è§‚å¯Ÿè€…çš„æ–¹æ³•</span><br>    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">subscribeActual</span><span class="hljs-params">(downStream: <span class="hljs-type">Observer</span>&lt;<span class="hljs-type">T</span>&gt;)</span></span> &#123;<br>      <span class="hljs-comment">//å¯ä»¥çœ‹åˆ°åªè¦ä¸€è®¢é˜…ï¼Œé¦–å…ˆå°±ä¼šæ¥æ”¶ onSubscribe äº‹ä»¶</span><br>        downStream.onSubscribe()<br>      <span class="hljs-comment">//é€šè¿‡ ObservableOnSubscribe é‡Œé¢çš„ Emitter è¿›è¡Œäº‹ä»¶çš„å‘é€ï¼Œå®Œæˆè¢«è§‚å¯Ÿè€…å‘é€äº‹ä»¶çš„è§£è€¦</span><br>        source.subscribe(CreateEmitter(downStream))<br>    &#125;<br><br>    <span class="hljs-comment">//äº‹ä»¶å‘å°„å™¨å®ç°ç±»ï¼Œå¯ä»¥çœ‹åˆ°ä¼ å…¥äº†ä¸‹æ¸¸çš„è§‚å¯Ÿè€…æ¥æ¥æ”¶æˆ‘ä»¬å‘å°„çš„äº‹ä»¶</span><br>    <span class="hljs-keyword">class</span> <span class="hljs-title class_">CreateEmitter</span>&lt;<span class="hljs-type">T</span>&gt;(<span class="hljs-keyword">var</span> downStream: Observer&lt;T&gt;): Emitter&lt;T&gt;&#123;<br><br>        <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onNext</span><span class="hljs-params">(t: <span class="hljs-type">T</span>)</span></span> &#123;<br>            downStream.onNext(t)<br>        &#125;<br><br>        <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onError</span><span class="hljs-params">(e: <span class="hljs-type">Throwable</span>)</span></span> &#123;<br>            downStream.onError(e)<br>        &#125;<br><br>        <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onComplete</span><span class="hljs-params">()</span></span> &#123;<br>            downStream.onComplete()<br>        &#125;<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">//7ã€æµ‹è¯•</span><br><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span>&#123;<br>    Observable.create(<span class="hljs-keyword">object</span> : ObservableOnSubscribe&lt;String&gt;&#123;<br>        <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">subscribe</span><span class="hljs-params">(emitter: <span class="hljs-type">Emitter</span>&lt;<span class="hljs-type">String</span>&gt;)</span></span> &#123;<br>            <span class="hljs-comment">//å‘å°„ onNext äº‹ä»¶</span><br>            emitter.onNext(<span class="hljs-string">&quot;erdai666&quot;</span>)<br>            <span class="hljs-comment">//å‘å°„ onComplete äº‹ä»¶</span><br>            emitter.onComplete()<br>        &#125;<br>    &#125;).subscribe(<span class="hljs-keyword">object</span> : Observer&lt;String&gt;&#123;<br>        <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onSubscribe</span><span class="hljs-params">()</span></span> &#123;<br>            println(<span class="hljs-string">&quot;onSubscribe&quot;</span>)<br>        &#125;<br><br>        <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onNext</span><span class="hljs-params">(t: <span class="hljs-type">String</span>)</span></span> &#123;<br>            println(<span class="hljs-string">&quot;onNextï¼š<span class="hljs-variable">$t</span>&quot;</span>)<br>        &#125;<br><br>        <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onError</span><span class="hljs-params">(e: <span class="hljs-type">Throwable</span>)</span></span> &#123;<br>        &#125;<br><br>        <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onComplete</span><span class="hljs-params">()</span></span> &#123;<br>            println(<span class="hljs-string">&quot;onComplete&quot;</span>)<br>        &#125;<br>    &#125;)<br>&#125;<br><span class="hljs-comment">//æ‰“å°ç»“æœ</span><br>onSubscribe<br>onNextï¼šerdai666<br>onComplete<br></code></pre></td></tr></table></figure><p>okï¼Œä¸Šè¿°ä»£ç å°±æ˜¯ create æ“ä½œç¬¦çš„å®ç°ï¼Œå¤§å®¶å¦‚æœæ²¡çœ‹æ˜ç™½å¯ä»¥å¤šçœ‹å‡ éï¼Œä¹Ÿå¯ä»¥ç›´æ¥æŠŠæˆ‘ä¸Šé¢çš„ä»£ç ç›´æ¥æ‹·è´åˆ°ä¸€ä¸ª kt æ–‡ä»¶ä¸­å»è¿è¡Œ</p><h3 id="2-4ã€map-æ“ä½œç¬¦å®ç°"><a href="#2-4ã€map-æ“ä½œç¬¦å®ç°" class="headerlink" title="2.4ã€map æ“ä½œç¬¦å®ç°"></a>2.4ã€map æ“ä½œç¬¦å®ç°</h3><p>map æ˜¯ä¸€ä¸ªè½¬æ¢æ“ä½œç¬¦ï¼Œå®ƒèƒ½æŠŠä¸€ç§ç±»å‹è½¬ä¸ºä¸ºå¦å¤–ä¸€ç§ç±»å‹ï¼Œå¦‚ï¼šInt -&gt; Stringã€‚</p><p>å®ƒçš„ä¸»è¦å®ç°ï¼šè§‚å¯Ÿè€…æ¨¡å¼ + è£…é¥°è€…æ¨¡å¼ + æ³›å‹</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-comment">//1ã€å®šä¹‰ä¸€ä¸ªæŠ½è±¡è£…é¥°ç±»ï¼Œæ³¨æ„é‡Œé¢æ³›å‹çš„ä½¿ç”¨</span><br><span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AbstractObservableWithUpstream</span>&lt;<span class="hljs-type">T,U</span>&gt;(<span class="hljs-keyword">var</span> source: ObservableSource&lt;T&gt;): Observable&lt;U&gt;()<br><br><span class="hljs-comment">//2ã€å®šä¹‰ä¸€ä¸ªç±»å‹è½¬æ¢çš„æ¥å£</span><br><span class="hljs-keyword">interface</span> <span class="hljs-title class_">Function</span>&lt;<span class="hljs-type">T,U</span>&gt; &#123;<br>    <span class="hljs-comment">//ä¼ å…¥ T ç±»å‹ï¼Œè¿”å› U ç±»å‹</span><br>    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">apply</span><span class="hljs-params">(t: <span class="hljs-type">T</span>)</span></span>: U<br>&#125;<br><br><span class="hljs-comment">//3ã€å®šä¹‰ map æ“ä½œç¬¦çš„å®ç°ç±»</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">ObservableMap</span>&lt;<span class="hljs-type">T,U</span>&gt;(source: ObservableSource&lt;T&gt;,<span class="hljs-keyword">var</span> function: Function&lt;T,U&gt;): AbstractObservableWithUpstream&lt;T,U&gt;(source) &#123;<br><br>    <span class="hljs-comment">//å®ç°çˆ¶ç±»è®¢é˜…è§‚å¯Ÿè€…çš„æ–¹æ³•</span><br>    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">subscribeActual</span><span class="hljs-params">(observer: <span class="hljs-type">Observer</span>&lt;<span class="hljs-type">U</span>&gt;)</span></span> &#123;<br>      <span class="hljs-comment">//æ¥æ”¶ onSubscribe äº‹ä»¶</span><br>        observer.onSubscribe()<br>      <span class="hljs-comment">//å®Œæˆäº‹ä»¶çš„è½¬æ¢</span><br>        source.subscribe(MapObserver(function,observer))<br>    &#125;<br><br>    <span class="hljs-comment">//MapObserver æ¥æ”¶ function å¯¹ç±»å‹è¿›è¡Œè½¬æ¢ï¼ŒdownStream å¯¹äº‹ä»¶è¿›è¡Œæ¥æ”¶</span><br>    <span class="hljs-keyword">class</span> <span class="hljs-title class_">MapObserver</span>&lt;<span class="hljs-type">T,U</span>&gt;(<span class="hljs-keyword">var</span> function: Function&lt;T,U&gt;,<span class="hljs-keyword">var</span> downStream: Observer&lt;U&gt;): Observer&lt;T&gt;&#123;<br>        <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onSubscribe</span><span class="hljs-params">()</span></span> &#123;<br>        &#125;<br><br>        <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onNext</span><span class="hljs-params">(t: <span class="hljs-type">T</span>)</span></span> &#123;<br>            <span class="hljs-comment">//æ ¸å¿ƒï¼šå½“æ¥æ”¶åˆ° T ç±»å‹ï¼Œè°ƒç”¨ function.apply è½¬æ¢ä¸º U ç±»å‹</span><br>            <span class="hljs-keyword">val</span> u: U = function.apply(t)<br>            downStream.onNext(u)<br>        &#125;<br><br>        <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onError</span><span class="hljs-params">(e: <span class="hljs-type">Throwable</span>)</span></span> &#123;<br>            downStream.onError(e)<br>        &#125;<br><br>        <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onComplete</span><span class="hljs-params">()</span></span> &#123;<br>            downStream.onComplete()<br>        &#125;<br><br>    &#125;<br>&#125;<br><br><span class="hljs-comment">//4ã€Observable ä¸­å¢åŠ ç›¸åº”çš„è°ƒç”¨æ–¹æ³•</span><br><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;U&gt;</span> <span class="hljs-title">map</span><span class="hljs-params">(function: <span class="hljs-type">Function</span>&lt;<span class="hljs-type">T</span>, U&gt;)</span></span>: ObservableMap&lt;T,U&gt;&#123;<br>    <span class="hljs-keyword">return</span> ObservableMap(<span class="hljs-keyword">this</span>, function)<br>&#125;<br><br><span class="hljs-comment">//5ã€æµ‹è¯•</span><br><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span>&#123;<br>    Observable.create(<span class="hljs-keyword">object</span> : ObservableOnSubscribe&lt;String&gt;&#123;<br>        <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">subscribe</span><span class="hljs-params">(emitter: <span class="hljs-type">Emitter</span>&lt;<span class="hljs-type">String</span>&gt;)</span></span> &#123;<br>            emitter.onNext(<span class="hljs-string">&quot;erdai666&quot;</span>)<br>            emitter.onComplete()<br>        &#125;<br>    &#125;)<br>        .map(<span class="hljs-keyword">object</span> : Function&lt;String,String&gt;&#123;<br>            <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">apply</span><span class="hljs-params">(t: <span class="hljs-type">String</span>)</span></span>: String &#123;<br>                <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;map è½¬æ¢ï¼š<span class="hljs-variable">$t</span>&quot;</span><br>            &#125;<br>        &#125;)<br>        .subscribe(<span class="hljs-keyword">object</span> : Observer&lt;String&gt;&#123;<br>        <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onSubscribe</span><span class="hljs-params">()</span></span> &#123;<br>            println(<span class="hljs-string">&quot;onSubscribe&quot;</span>)<br>        &#125;<br><br>        <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onNext</span><span class="hljs-params">(t: <span class="hljs-type">String</span>)</span></span> &#123;<br>            println(<span class="hljs-string">&quot;onNextï¼š<span class="hljs-variable">$t</span>&quot;</span>)<br>        &#125;<br><br>        <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onError</span><span class="hljs-params">(e: <span class="hljs-type">Throwable</span>)</span></span> &#123;<br>        &#125;<br><br>        <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onComplete</span><span class="hljs-params">()</span></span> &#123;<br>            println(<span class="hljs-string">&quot;onComplete&quot;</span>)<br>        &#125;<br>    &#125;)<br>&#125;<br><br><span class="hljs-comment">//æ‰“å°ç»“æœ</span><br>onSubscribe<br>onNextï¼šmap è½¬æ¢ï¼šerdai666<br>onComplete<br></code></pre></td></tr></table></figure><h3 id="2-5ã€flatMap-æ“ä½œç¬¦å®ç°"><a href="#2-5ã€flatMap-æ“ä½œç¬¦å®ç°" class="headerlink" title="2.5ã€flatMap æ“ä½œç¬¦å®ç°"></a>2.5ã€flatMap æ“ä½œç¬¦å®ç°</h3><p>flatMap æ“ä½œç¬¦çš„å®ç°å…¶å®å’Œ map ç±»ä¼¼ï¼Œåªä¸è¿‡æ˜¯æŠŠ ï¼šFunction&lt;T, U&gt; -&gt; Function&lt;T, ObservableSource&gt; ï¼Œå°†ä¸€ç§ç±»å‹è½¬æ¢ä¸ºäº†ä¸€ä¸ªè¢«è§‚å¯Ÿè€…çš„ç±»å‹ï¼Œè¢«è§‚å¯Ÿè€…çš„ç±»å‹åˆå¯ä»¥è¿›è¡Œä¸€ç³»åˆ—çš„è½¬æ¢ï¼Œå› æ­¤èƒ½æ‹†åˆ†æ›´ç»†çš„ç²’åº¦ï¼š</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-comment">//1ã€å®šä¹‰ flatMap æ“ä½œç¬¦çš„å®ç°ç±»</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">ObservableFlatMap</span>&lt;<span class="hljs-type">T,U</span>&gt;(source: ObservableSource&lt;T&gt;,<span class="hljs-keyword">var</span> function: Function&lt;T,ObservableSource&lt;U&gt;&gt;): AbstractObservableWithUpstream&lt;T,U&gt;(source) &#123;<br><br>    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">subscribeActual</span><span class="hljs-params">(observer: <span class="hljs-type">Observer</span>&lt;<span class="hljs-type">U</span>&gt;)</span></span> &#123;<br>        observer.onSubscribe()<br>        source.subscribe(FlatMapObserver(function,observer))<br>    &#125;<br><br>    <span class="hljs-comment">//FlatMapObserver æ¥æ”¶ function å¯¹ç±»å‹è¿›è¡Œè½¬æ¢ï¼ŒdownStream å¯¹äº‹ä»¶è¿›è¡Œæ¥æ”¶</span><br>    <span class="hljs-keyword">class</span> <span class="hljs-title class_">FlatMapObserver</span>&lt;<span class="hljs-type">T,U</span>&gt;(<span class="hljs-keyword">var</span> function: Function&lt;T,ObservableSource&lt;U&gt;&gt;, <span class="hljs-keyword">var</span> downStream: Observer&lt;U&gt;): Observer&lt;T&gt;&#123;<br>        <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onSubscribe</span><span class="hljs-params">()</span></span> &#123;<br>        &#125;<br><br>        <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onNext</span><span class="hljs-params">(t: <span class="hljs-type">T</span>)</span></span> &#123;<br>            <span class="hljs-comment">//æ ¸å¿ƒï¼šå½“æ¥æ”¶åˆ° T ç±»å‹ï¼Œè°ƒç”¨ function.apply è½¬æ¢ä¸º ObservableSource&lt;U&gt; ç±»å‹</span><br>            <span class="hljs-keyword">val</span> u: ObservableSource&lt;U&gt; = function.apply(t)<br>            <span class="hljs-comment">//å¯¹ u è¿›è¡Œæ›´ç»†ç²’åº¦çš„æ‹†åˆ†ï¼Œåœ¨è®©ä¸‹æ¸¸è§‚å¯Ÿè€…è¿›è¡Œæ¥æ”¶</span><br>            u.subscribe(<span class="hljs-keyword">object</span> : Observer&lt;U&gt;&#123;<br>                <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onSubscribe</span><span class="hljs-params">()</span></span> &#123;<br><br>                &#125;<br><br>                <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onNext</span><span class="hljs-params">(t: <span class="hljs-type">U</span>)</span></span> &#123;<br>                    downStream.onNext(t)<br>                &#125;<br><br>                <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onError</span><span class="hljs-params">(e: <span class="hljs-type">Throwable</span>)</span></span> &#123;<br><br>                &#125;<br><br>                <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onComplete</span><span class="hljs-params">()</span></span> &#123;<br><br>                &#125;<br>            &#125;)<br>        &#125;<br><br>        <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onError</span><span class="hljs-params">(e: <span class="hljs-type">Throwable</span>)</span></span> &#123;<br>            downStream.onError(e)<br>        &#125;<br><br>        <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onComplete</span><span class="hljs-params">()</span></span> &#123;<br>            downStream.onComplete()<br>        &#125;<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">//2ã€Observable ä¸­å¢åŠ ç›¸åº”çš„è°ƒç”¨æ–¹æ³•</span><br><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;U&gt;</span> <span class="hljs-title">flatMap</span><span class="hljs-params">(function: <span class="hljs-type">Function</span>&lt;<span class="hljs-type">T</span>,ObservableSource&lt;U&gt;&gt;)</span></span>: ObservableFlatMap&lt;T,U&gt;&#123;<br>    <span class="hljs-keyword">return</span> ObservableFlatMap(<span class="hljs-keyword">this</span>,function)<br>&#125;<br><br><span class="hljs-comment">//3ã€æµ‹è¯•</span><br><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span>&#123;<br>    Observable.create(<span class="hljs-keyword">object</span> : ObservableOnSubscribe&lt;String&gt;&#123;<br>        <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">subscribe</span><span class="hljs-params">(emitter: <span class="hljs-type">Emitter</span>&lt;<span class="hljs-type">String</span>&gt;)</span></span> &#123;<br>            emitter.onNext(<span class="hljs-string">&quot;erdai666&quot;</span>)<br>            emitter.onComplete()<br>        &#125;<br>    &#125;).flatMap(<span class="hljs-keyword">object</span> : Function&lt;String,ObservableSource&lt;String&gt;&gt;&#123;<br>        <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">apply</span><span class="hljs-params">(t: <span class="hljs-type">String</span>)</span></span>: ObservableSource&lt;String&gt; &#123;<br>            <span class="hljs-keyword">return</span> Observable.create(<span class="hljs-keyword">object</span> : ObservableOnSubscribe&lt;String&gt;&#123;<br>                <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">subscribe</span><span class="hljs-params">(emitter: <span class="hljs-type">Emitter</span>&lt;<span class="hljs-type">String</span>&gt;)</span></span> &#123;<br>                    emitter.onNext(<span class="hljs-string">&quot;flatMapï¼š<span class="hljs-variable">$t</span>&quot;</span>)<br>                &#125;<br>            &#125;)<br>        &#125;<br><br>    &#125;)<br>        .subscribe(<span class="hljs-keyword">object</span> : Observer&lt;String&gt;&#123;<br>        <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onSubscribe</span><span class="hljs-params">()</span></span> &#123;<br>            println(<span class="hljs-string">&quot;onSubscribe&quot;</span>)<br>        &#125;<br><br>        <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onNext</span><span class="hljs-params">(t: <span class="hljs-type">String</span>)</span></span> &#123;<br>            println(<span class="hljs-string">&quot;onNextï¼š<span class="hljs-variable">$t</span>&quot;</span>)<br>        &#125;<br><br>        <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onError</span><span class="hljs-params">(e: <span class="hljs-type">Throwable</span>)</span></span> &#123;<br>        &#125;<br><br>        <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onComplete</span><span class="hljs-params">()</span></span> &#123;<br>            println(<span class="hljs-string">&quot;onComplete&quot;</span>)<br>        &#125;<br>    &#125;)<br>&#125;<br><br><span class="hljs-comment">//æ‰“å°ç»“æœ</span><br>onSubscribe<br>onNextï¼šflatMapï¼šerdai666<br>onComplete<br></code></pre></td></tr></table></figure><h3 id="2-6ã€subscribeOn-æ“ä½œç¬¦å®ç°"><a href="#2-6ã€subscribeOn-æ“ä½œç¬¦å®ç°" class="headerlink" title="2.6ã€subscribeOn æ“ä½œç¬¦å®ç°"></a>2.6ã€subscribeOn æ“ä½œç¬¦å®ç°</h3><p>subscribeOn ä¸»è¦æ˜¯ç”¨æ¥å†³å®šæˆ‘ä»¬è®¢é˜…è§‚å¯Ÿè€…æ˜¯åœ¨å“ªä¸ªçº¿ç¨‹æ‰§è¡Œ</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-comment">//1ã€å®šä¹‰ä¸€ä¸ªæŠ½è±¡çš„è°ƒåº¦å™¨</span><br><span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Scheduler</span> &#123;<br><br>    <span class="hljs-keyword">abstract</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">createWorker</span><span class="hljs-params">()</span></span>: Worker<br>    <br>    <span class="hljs-comment">//å®šä¹‰ä¸€ä¸ªæŠ½è±¡çš„ Worker</span><br>    <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Worker</span>&#123;<br>      <span class="hljs-comment">//çœŸæ­£å†³å®šçº¿ç¨‹æ‰§è¡Œ</span><br>        <span class="hljs-keyword">abstract</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">schedule</span><span class="hljs-params">(runnable: <span class="hljs-type">Runnable</span>)</span></span><br>    &#125;<br>&#125;<br><br><span class="hljs-comment">//2ã€å®šä¹‰è°ƒåº¦å™¨çš„å®ç°ç±»ï¼Œæˆ‘ä»¬ä¸»è¦å®ç°ä¸¤ç§ï¼š</span><br><span class="hljs-comment">//2.1ã€AndroidMainSchedulerï¼šAndroid ä¸»çº¿ç¨‹</span><br><span class="hljs-comment">//å¯ä»¥çœ‹åˆ°æˆ‘ä»¬å°±æ˜¯ä½¿ç”¨ Handler å°†çº¿ç¨‹åˆ‡æ¢åˆ°ä¸»çº¿ç¨‹</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">AndroidMainScheduler</span>(<span class="hljs-keyword">var</span> handler: Handler): Scheduler() &#123;<br>    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">createWorker</span><span class="hljs-params">()</span></span>: Worker &#123;<br>        <span class="hljs-keyword">return</span> AndroidMainWorker(handler)<br>    &#125;<br>    <br>    <span class="hljs-keyword">class</span> <span class="hljs-title class_">AndroidMainWorker</span>(<span class="hljs-keyword">var</span> handler: Handler): Worker()&#123;<br>        <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">schedule</span><span class="hljs-params">(runnable: <span class="hljs-type">Runnable</span>)</span></span> &#123;<br>            handler.post(runnable)<br>        &#125;<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">//2.2ã€NewThreadSchedulerï¼šå¼€å¯ä¸€ä¸ªæ–°çš„å­çº¿ç¨‹</span><br><span class="hljs-comment">//å¯ä»¥çœ‹åˆ°æˆ‘ä»¬å°±æ˜¯ä½¿ç”¨çº¿ç¨‹æ± æ¥æ‰§è¡Œ runnable</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">NewThreadScheduler</span>(<span class="hljs-keyword">var</span> executorService: ExecutorService): Scheduler() &#123;<br><br>    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">createWorker</span><span class="hljs-params">()</span></span>: Worker &#123;<br>        <span class="hljs-keyword">return</span> NewThreadWork(executorService)<br>    &#125;<br>  <br>    <span class="hljs-keyword">class</span> <span class="hljs-title class_">NewThreadWork</span>(<span class="hljs-keyword">var</span> executorService: ExecutorService): Worker()&#123;<br>        <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">schedule</span><span class="hljs-params">(runnable: <span class="hljs-type">Runnable</span>)</span></span> &#123;<br>            executorService.execute(runnable)<br>        &#125;<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">//3ã€å®šä¹‰ä¸€ä¸ªçº¿ç¨‹è°ƒåº¦å™¨çš„å·¥å…·ç±»ï¼Œç±»ä¼¼ RxJava çš„è°ƒç”¨</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Schedulers</span> &#123;<br>  <br>    <span class="hljs-keyword">companion</span> <span class="hljs-keyword">object</span>&#123;<br>      <span class="hljs-comment">//åˆ‡æ¢åˆ°å­çº¿ç¨‹</span><br>        <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">newThread</span><span class="hljs-params">()</span></span>: NewThreadScheduler&#123;<br>            <span class="hljs-keyword">return</span> NewThreadScheduler(Executors.newScheduledThreadPool(<span class="hljs-number">2</span>))<br>        &#125;<br><br>      <span class="hljs-comment">//åˆ‡æ¢åˆ°ä¸»çº¿ç¨‹</span><br>        <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">mainThread</span><span class="hljs-params">()</span></span>: AndroidMainScheduler&#123;<br>            <span class="hljs-keyword">return</span> AndroidMainScheduler(Handler(Looper.getMainLooper()))<br>        &#125;<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">//4ã€å®šä¹‰ subscribeOn æ“ä½œç¬¦å®ç°ç±»</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">ObservableSubscribeOn</span>&lt;<span class="hljs-type">T</span>&gt;(source: ObservableSource&lt;T&gt;,<span class="hljs-keyword">var</span> scheduler: Scheduler): AbstractObservableWithUpstream&lt;T,T&gt;(source) &#123;<br><br>    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">subscribeActual</span><span class="hljs-params">(observer: <span class="hljs-type">Observer</span>&lt;<span class="hljs-type">T</span>&gt;)</span></span> &#123;<br>      <span class="hljs-comment">//æ¥æ”¶è®¢é˜…äº‹ä»¶</span><br>        observer.onSubscribe()<br>      <span class="hljs-comment">//åˆ›å»º Worker å†³å®šæˆ‘ä»¬ä»£ç æ‰€æ‰§è¡Œçš„çº¿ç¨‹</span><br>        <span class="hljs-keyword">val</span> worker = scheduler.createWorker()<br>        worker.schedule(SubscribeTask(SubscribeOnObserver(observer)))<br>    &#125;<br><br><br>    <span class="hljs-comment">//å¯ä»¥çœ‹åˆ°ï¼ŒRunnable é‡Œé¢å°±åªåšäº†ä¸€ä¸ªè®¢é˜…æ“ä½œï¼Œå› æ­¤ subscribeOn ä¼šå†³å®šæˆ‘ä»¬è®¢é˜…è§‚å¯Ÿè€…çš„çº¿ç¨‹</span><br>    <span class="hljs-keyword">inner</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SubscribeTask</span>(<span class="hljs-keyword">var</span> observer: SubscribeOnObserver&lt;T&gt;): Runnable&#123;<br>        <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">run</span><span class="hljs-params">()</span></span> &#123;<br>            source.subscribe(observer)<br>        &#125;<br>    &#125;<br>  <br>    <span class="hljs-comment">//å¦‚æœæˆ‘ä»¬æ²¡æœ‰ä½¿ç”¨ observeOn åˆ‡æ¢çº¿ç¨‹ï¼Œé‚£ä¹ˆè§‚å¯Ÿè€…æ¥æ”¶äº‹ä»¶çš„çº¿ç¨‹ä¹Ÿä¼šç”± subscribeOn çº¿ç¨‹å†³å®š</span><br>    <span class="hljs-keyword">class</span> <span class="hljs-title class_">SubscribeOnObserver</span>&lt;<span class="hljs-type">T</span>&gt;(<span class="hljs-keyword">var</span> observer: Observer&lt;T&gt;): Observer&lt;T&gt;&#123;<br>        <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onSubscribe</span><span class="hljs-params">()</span></span> &#123;<br>        &#125;<br><br>        <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onNext</span><span class="hljs-params">(t: <span class="hljs-type">T</span>)</span></span> &#123;<br>            observer.onNext(t)<br>        &#125;<br><br>        <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onError</span><span class="hljs-params">(e: <span class="hljs-type">Throwable</span>)</span></span> &#123;<br>            observer.onError(e)<br>        &#125;<br><br>        <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onComplete</span><span class="hljs-params">()</span></span> &#123;<br>            observer.onComplete()<br>        &#125;<br><br>    &#125;<br>&#125;<br><br><span class="hljs-comment">//5ã€Observable ä¸­å¢åŠ ç›¸åº”çš„è°ƒç”¨æ–¹æ³•</span><br><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">subscribeOn</span><span class="hljs-params">(scheduler: <span class="hljs-type">Scheduler</span>)</span></span>: ObservableSubscribeOn&lt;T&gt;&#123;<br>    <span class="hljs-keyword">return</span> ObservableSubscribeOn(<span class="hljs-keyword">this</span>,scheduler)<br>&#125;<br><br><span class="hljs-comment">//6ã€æµ‹è¯•</span><br><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span>&#123;<br>    Observable.create(<span class="hljs-keyword">object</span> :ObservableOnSubscribe&lt;String&gt;&#123;<br>        <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">subscribe</span><span class="hljs-params">(emitter: <span class="hljs-type">Emitter</span>&lt;<span class="hljs-type">String</span>&gt;)</span></span> &#123;<br>            emitter.onNext(<span class="hljs-string">&quot;erdai666&quot;</span>)<br>            emitter.onComplete()<br>            println(<span class="hljs-string">&quot;subscribeï¼š<span class="hljs-subst">$&#123;Thread.currentThread().name&#125;</span>&quot;</span>)<br>        &#125;<br><br>    &#125;).subscribeOn(Schedulers.newThread())<br>        .subscribe(<span class="hljs-keyword">object</span> : Observer&lt;String&gt;&#123;<br>            <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onSubscribe</span><span class="hljs-params">()</span></span> &#123;<br>                println(<span class="hljs-string">&quot;onSubscribeï¼š<span class="hljs-subst">$&#123;Thread.currentThread().name&#125;</span>&quot;</span>)<br>            &#125;<br><br>            <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onNext</span><span class="hljs-params">(t: <span class="hljs-type">String</span>)</span></span> &#123;<br>                println(<span class="hljs-string">&quot;onNextï¼š<span class="hljs-variable">$t</span>&quot;</span>)<br>                println(<span class="hljs-string">&quot;onNextï¼š<span class="hljs-subst">$&#123;Thread.currentThread().name&#125;</span>&quot;</span>)<br>            &#125;<br><br>            <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onError</span><span class="hljs-params">(e: <span class="hljs-type">Throwable</span>)</span></span> &#123;<br>                println(<span class="hljs-string">&quot;onErrorï¼š<span class="hljs-subst">$&#123;Thread.currentThread().name&#125;</span>&quot;</span>)<br>            &#125;<br><br>            <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onComplete</span><span class="hljs-params">()</span></span> &#123;<br>                println(<span class="hljs-string">&quot;onComplete&quot;</span>)<br>                println(<span class="hljs-string">&quot;onCompleteï¼š<span class="hljs-subst">$&#123;Thread.currentThread().name&#125;</span>&quot;</span>)<br>            &#125;<br>        &#125;)<br>&#125;<br><br><span class="hljs-comment">//æ‰“å°ç»“æœ</span><br>onSubscribeï¼šmain<br>onNextï¼šerdai666<br>onNextï¼špool-<span class="hljs-number">1</span>-thread-<span class="hljs-number">1</span><br>onComplete<br>onCompleteï¼špool-<span class="hljs-number">1</span>-thread-<span class="hljs-number">1</span><br>subscribeï¼špool-<span class="hljs-number">1</span>-thread-<span class="hljs-number">1</span><br></code></pre></td></tr></table></figure><p>åˆ†æä¸€ä¸‹ä¸Šé¢çš„æ‰“å°ç»“æœï¼š</p><p>1ã€onSubscribe æ˜¯åœ¨ä¸€å¼€å§‹è®¢é˜…å°±è§¦å‘çš„ï¼Œæ­¤æ—¶ Worker éƒ½è¿˜æ²¡åˆ›å»ºï¼Œå› æ­¤æ˜¯åœ¨ä¸»çº¿ç¨‹æ‰§è¡Œçš„</p><p>2ã€å› ä¸ºæˆ‘ä»¬æ²¡æœ‰ä½¿ç”¨ observeOn å¯¹è§‚å¯Ÿè€…æ¥æ”¶äº‹ä»¶çš„çº¿ç¨‹è¿›è¡Œåˆ‡æ¢ï¼Œæ‰€ä»¥ onNextï¼ŒonComplete æ¥æ”¶äº‹ä»¶çš„çº¿ç¨‹ç”± subscribeOn åˆ‡æ¢çš„çº¿ç¨‹å†³å®šï¼Œ</p><p>3ã€subscribe åœ¨æˆ‘ä»¬å®é™…è®¢é˜…è§‚å¯Ÿè€…çš„æ–¹æ³•é‡Œä¼šæ‰§è¡Œå®ƒï¼Œå› æ­¤æ˜¯ç”± subscribeOn åˆ‡æ¢çš„çº¿ç¨‹å†³å®š</p><h3 id="2-7ã€observeOn-æ“ä½œç¬¦å®ç°"><a href="#2-7ã€observeOn-æ“ä½œç¬¦å®ç°" class="headerlink" title="2.7ã€observeOn æ“ä½œç¬¦å®ç°"></a>2.7ã€observeOn æ“ä½œç¬¦å®ç°</h3><p>observeOn æ˜¯ç”¨æ¥å†³å®šæˆ‘ä»¬è§‚å¯Ÿè€…æ¥æ”¶äº‹ä»¶æ˜¯åœ¨å“ªä¸ªçº¿ç¨‹æ‰§è¡Œï¼Œå®ç°ç›¸å¯¹å¤æ‚ä¸€ç‚¹ï¼Œå®ƒå†…éƒ¨ä½¿ç”¨äº†ä¸€ä¸ªé˜Ÿåˆ—æ¥å­˜å‚¨å‘é€è¿‡æ¥çš„ onNext äº‹ä»¶ï¼Œç„¶åé€šè¿‡ While å¾ªç¯å¯¹é˜Ÿåˆ—ä¸­çš„äº‹ä»¶è¿›è¡Œå¤„ç†ï¼Œå…·ä½“å¤§å®¶å¯ä»¥çœ‹æˆ‘ä¸‹é¢çš„å®ç°ï¼Œå†™äº†è¯¦ç»†çš„æ³¨é‡Š</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-comment">//1ã€å®šä¹‰ observeOn æ“ä½œç¬¦å®ç°ç±»</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">ObservableObserveOn</span>&lt;<span class="hljs-type">T</span>&gt;(source: ObservableSource&lt;T&gt;, <span class="hljs-keyword">var</span> scheduler: Scheduler): AbstractObservableWithUpstream&lt;T, T&gt;(source) &#123;<br><br>    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">subscribeActual</span><span class="hljs-params">(observer: <span class="hljs-type">Observer</span>&lt;<span class="hljs-type">T</span>&gt;)</span></span> &#123;<br>      <span class="hljs-comment">//æ¥æ”¶è®¢é˜…äº‹ä»¶</span><br>        observer.onSubscribe()<br>        <span class="hljs-keyword">val</span> worker = scheduler.createWorker()<br>        source.subscribe(ObserveOnObserver(observer,worker))<br>    &#125;<br><br>    <span class="hljs-keyword">class</span> <span class="hljs-title class_">ObserveOnObserver</span>&lt;<span class="hljs-type">T</span>&gt;(<span class="hljs-keyword">var</span> observer: Observer&lt;T&gt;, <span class="hljs-keyword">var</span> worker: Scheduler.Worker, <span class="hljs-keyword">var</span> queue: Deque&lt;T&gt;? = <span class="hljs-literal">null</span>): Observer&lt;T&gt;,Runnable &#123;<br><br>        <span class="hljs-comment">//æ ‡è®°æ˜¯å¦äº‹ä»¶éƒ½å·²ç»æ¥æ”¶ï¼Œä¸€èˆ¬åœ¨ onError æˆ– onComplete æ—¶æ ‡è®°</span><br>        <span class="hljs-meta">@Volatile</span><br>        <span class="hljs-keyword">var</span> done = <span class="hljs-literal">false</span><br><br>        <span class="hljs-comment">//è®°å½• onError çš„å¼‚å¸¸</span><br>        <span class="hljs-meta">@Volatile</span><br>        <span class="hljs-keyword">var</span> throwable: Throwable? = <span class="hljs-literal">null</span><br><br>        <span class="hljs-comment">//æ˜¯å¦èƒ½ç»“æŸ While å¾ªç¯ï¼šä¾‹å¦‚è§‚å¯Ÿè€…æ¥æ”¶äº† onError æˆ– onComplete äº‹ä»¶ï¼Œå°±å¯ä»¥ç»“æŸå¾ªç¯äº†</span><br>        <span class="hljs-meta">@Volatile</span><br>        <span class="hljs-keyword">var</span> over = <span class="hljs-literal">false</span><br><br>        <span class="hljs-keyword">init</span> &#123;<br>            <span class="hljs-comment">//å¦‚æœé˜Ÿåˆ—ä¸ºç©ºï¼Œåˆ™æ–°å»º</span><br>            <span class="hljs-keyword">if</span>(queue == <span class="hljs-literal">null</span>)&#123;<br>                queue = ArrayDeque()<br>            &#125;<br>        &#125;<br><br>        <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onSubscribe</span><span class="hljs-params">()</span></span> &#123;<br>        &#125;<br><br>        <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onNext</span><span class="hljs-params">(t: <span class="hljs-type">T</span>)</span></span> &#123;<br>            <span class="hljs-keyword">if</span>(done)<span class="hljs-keyword">return</span><br>            <span class="hljs-comment">//å°†æ¥æ”¶çš„ onNext äº‹ä»¶åŠ å…¥é˜Ÿåˆ—ä¸­</span><br>            queue?.offer(t)<br>            <span class="hljs-comment">//æ‰§è¡Œè°ƒåº¦</span><br>            schedule()<br>        &#125;<br><br>        <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onError</span><span class="hljs-params">(e: <span class="hljs-type">Throwable</span>)</span></span> &#123;<br>            <span class="hljs-keyword">if</span>(done)<span class="hljs-keyword">return</span><br>            <span class="hljs-comment">//è®°å½•å¼‚å¸¸</span><br>            throwable = e<br>            <span class="hljs-comment">//æ ‡è®°æ¥æ”¶äº‹ä»¶å®Œæˆ</span><br>            done = <span class="hljs-literal">true</span><br>            <span class="hljs-comment">//æ‰§è¡Œè°ƒåº¦</span><br>            schedule()<br><br>        &#125;<br><br>        <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onComplete</span><span class="hljs-params">()</span></span> &#123;<br>            <span class="hljs-keyword">if</span>(done)<span class="hljs-keyword">return</span><br>            <span class="hljs-comment">//æ ‡è®°æ¥æ”¶äº‹ä»¶å®Œæˆ</span><br>            done = <span class="hljs-literal">true</span><br>            <span class="hljs-comment">//æ‰§è¡Œè°ƒåº¦</span><br>            schedule()<br>        &#125;<br><br>        <span class="hljs-comment">//å¯ä»¥çœ‹åˆ°è¿™é‡Œè¿›è¡Œäº†ä»»åŠ¡çš„æ‰§è¡Œï¼Œç”± observeOn å†³å®šæ‰§è¡Œçš„çº¿ç¨‹</span><br>        <span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">schedule</span><span class="hljs-params">()</span></span> &#123;<br>            worker.schedule(<span class="hljs-keyword">this</span>)<br>        &#125;<br><br>        <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">run</span><span class="hljs-params">()</span></span> &#123;<br>            drainNormal()<br>        &#125;<br><br>        <span class="hljs-comment">//å®é™…æœ€ç»ˆçš„é€»è¾‘å°±æ˜¯åœ¨è¿™ä¸ªæ–¹æ³•é‡Œé¢è¿›è¡Œå¤„ç†</span><br>        <span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">drainNormal</span><span class="hljs-params">()</span></span> &#123;<br>            <span class="hljs-comment">//å–å½“å‰çš„é˜Ÿåˆ—</span><br>            <span class="hljs-keyword">val</span> q = queue<br>            <span class="hljs-comment">//å–è§‚å¯Ÿè€…</span><br>            <span class="hljs-keyword">val</span> obs = observer<br><br>            <span class="hljs-comment">//while å¾ªç¯å–å‡ºé˜Ÿåˆ—é‡Œé¢çš„ onNext äº‹ä»¶</span><br>            <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>)&#123;<br>                <span class="hljs-comment">//å– done æ ‡è®°</span><br>                <span class="hljs-keyword">val</span> d = done<br>                <span class="hljs-comment">//ä»é˜Ÿåˆ—ä¸­å–å‡ºå…ƒç´ å¹¶å‡ºé˜Ÿ</span><br>                <span class="hljs-keyword">val</span> t = q?.poll()<br>                <span class="hljs-comment">//å¦‚æœ t ä¸º null è¡¨ç¤ºé˜Ÿåˆ—é‡Œé¢æ²¡æœ‰äº‹ä»¶äº†</span><br>                <span class="hljs-keyword">val</span> empty = t == <span class="hljs-literal">null</span><br>                <span class="hljs-comment">//æ£€æŸ¥æ˜¯å¦èƒ½ç»ˆæ­¢ While å¾ªç¯</span><br>                <span class="hljs-keyword">if</span>(checkTerminated(d,empty,obs))&#123;<br>                    <span class="hljs-keyword">return</span><br>                &#125;<br><br>                <span class="hljs-comment">//å¦‚æœé˜Ÿåˆ—ä¸ºç©ºï¼Œè·³å‡º While å¾ªç¯</span><br>                <span class="hljs-keyword">if</span>(empty)<span class="hljs-keyword">break</span><br><br>                <span class="hljs-comment">//è§‚å¯Ÿè€…æ¥æ”¶ onNext äº‹ä»¶</span><br>                t?.apply &#123;<br>                    obs.onNext(<span class="hljs-keyword">this</span>)<br>                &#125;<br>            &#125;<br><br>        &#125;<br><br>        <span class="hljs-comment">//æ£€æŸ¥æ˜¯å¦èƒ½ç»ˆæ­¢ While å¾ªç¯</span><br>        <span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">checkTerminated</span><span class="hljs-params">(d: <span class="hljs-type">Boolean</span>, empty: <span class="hljs-type">Boolean</span>, obs: <span class="hljs-type">Observer</span>&lt;<span class="hljs-type">T</span>&gt;)</span></span>: <span class="hljs-built_in">Boolean</span> &#123;<br>            <span class="hljs-keyword">if</span>(over)&#123;<br>                <span class="hljs-comment">//å¦‚æœèƒ½ç»“æŸäº†ï¼Œæ¸…ç©ºé˜Ÿåˆ—</span><br>                queue?.clear()<br>                <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span><br>            &#125;<br><br>            <span class="hljs-comment">//å¦‚æœå·²ç»å®Œæˆäº‹ä»¶çš„å‘é€</span><br>            <span class="hljs-keyword">if</span>(d)&#123;<br>                <span class="hljs-keyword">val</span> e = throwable<br>                <span class="hljs-keyword">if</span>(e != <span class="hljs-literal">null</span>)&#123;<br>                    <span class="hljs-comment">//å¦‚æœæœ‰ onError äº‹ä»¶ï¼Œæ ‡è®°ç»“æŸï¼Œå¹¶æ¥æ”¶ onError äº‹ä»¶</span><br>                    over = <span class="hljs-literal">true</span><br>                    obs.onError(e)<br>                &#125;<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(empty)&#123;<br>                    <span class="hljs-comment">//å¦‚æœé˜Ÿåˆ—ä¸ºç©ºï¼Œæ ‡è®°ç»“æŸï¼Œå¹¶æ¥æ”¶ onComplete äº‹ä»¶</span><br>                    over = <span class="hljs-literal">true</span><br>                    obs.onComplete()<br>                    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span><br>                &#125;<br>            &#125;<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span><br>        &#125;<br>        <br>    &#125;<br>&#125; <br><br><span class="hljs-comment">//2ã€Observable ä¸­å¢åŠ ç›¸åº”çš„è°ƒç”¨æ–¹æ³•</span><br><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">observeOn</span><span class="hljs-params">(scheduler: <span class="hljs-type">Scheduler</span>)</span></span>: ObservableObserveOn&lt;T&gt;&#123;<br>    <span class="hljs-keyword">return</span> ObservableObserveOn(<span class="hljs-keyword">this</span>,scheduler)<br>&#125;<br><br><span class="hljs-comment">//3ã€æµ‹è¯•ï¼Œå› ä¸ºæ¶‰åŠåˆ° Handler åˆ‡æ¢åˆ°ä¸»çº¿ç¨‹ï¼Œæˆ‘ä»¬è¿™é‡Œæ”¾åˆ° Activity é‡Œé¢å»æµ‹è¯•</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">MainActivity</span> : <span class="hljs-type">AppCompatActivity</span>() &#123;<br><br>    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onCreate</span><span class="hljs-params">(savedInstanceState: <span class="hljs-type">Bundle</span>?)</span></span> &#123;<br>        <span class="hljs-keyword">super</span>.onCreate(savedInstanceState)<br>        setContentView(R.layout.activity_main)<br><br><br>        Observable.create(<span class="hljs-keyword">object</span> : ObservableOnSubscribe&lt;String&gt; &#123;<br>            <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">subscribe</span><span class="hljs-params">(emitter: <span class="hljs-type">Emitter</span>&lt;<span class="hljs-type">String</span>&gt;)</span></span> &#123;<br>                emitter.onNext(<span class="hljs-string">&quot;erdai666&quot;</span>)<br>                emitter.onComplete()<br>                println(<span class="hljs-string">&quot;subscribeï¼š<span class="hljs-subst">$&#123;Thread.currentThread().name&#125;</span>&quot;</span>)<br>            &#125;<br><br>        &#125;)<br>            .subscribeOn(Schedulers.newThread())<br>            .observeOn(Schedulers.mainThread())<br>            .subscribe(<span class="hljs-keyword">object</span> : Observer&lt;String&gt; &#123;<br>                <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onSubscribe</span><span class="hljs-params">()</span></span> &#123;<br>                    println(<span class="hljs-string">&quot;onSubscribeï¼š<span class="hljs-subst">$&#123;Thread.currentThread().name&#125;</span>&quot;</span>)<br>                &#125;<br><br>                <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onNext</span><span class="hljs-params">(t: <span class="hljs-type">String</span>)</span></span> &#123;<br>                    println(<span class="hljs-string">&quot;onNextï¼š<span class="hljs-variable">$t</span>&quot;</span>)<br>                    println(<span class="hljs-string">&quot;onNextï¼š<span class="hljs-subst">$&#123;Thread.currentThread().name&#125;</span>&quot;</span>)<br>                &#125;<br><br>                <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onError</span><span class="hljs-params">(e: <span class="hljs-type">Throwable</span>)</span></span> &#123;<br>                    println(<span class="hljs-string">&quot;onErrorï¼š<span class="hljs-subst">$&#123;Thread.currentThread().name&#125;</span>&quot;</span>)<br>                &#125;<br><br>                <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onComplete</span><span class="hljs-params">()</span></span> &#123;<br>                    println(<span class="hljs-string">&quot;onComplete&quot;</span>)<br>                    println(<span class="hljs-string">&quot;onCompleteï¼š<span class="hljs-subst">$&#123;Thread.currentThread().name&#125;</span>&quot;</span>)<br>                &#125;<br>            &#125;)<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">//æ‰“å°ç»“æœ</span><br>onSubscribeï¼šmain<br>subscribeï¼špool-<span class="hljs-number">2</span>-thread-<span class="hljs-number">1</span><br>onNextï¼šerdai666<br>onNextï¼šmain<br>onComplete<br>onCompleteï¼šmain<br></code></pre></td></tr></table></figure><p>åˆ†æä¸€ä¸‹ä¸Šé¢çš„æ‰“å°ç»“æœï¼š</p><p>1ã€onSubscribe æ˜¯åœ¨ä¸€å¼€å§‹è®¢é˜…å°±è§¦å‘çš„ï¼Œæ­¤æ—¶ Worker éƒ½è¿˜æ²¡åˆ›å»ºï¼Œå› æ­¤æ˜¯åœ¨ä¸»çº¿ç¨‹æ‰§è¡Œçš„</p><p>2ã€subscribe åœ¨æˆ‘ä»¬å®é™…è®¢é˜…è§‚å¯Ÿè€…çš„æ–¹æ³•é‡Œä¼šæ‰§è¡Œå®ƒï¼Œå› æ­¤æ˜¯ç”± subscribeOn åˆ‡æ¢çš„çº¿ç¨‹å†³å®š</p><p>3ã€observeOn å†³å®šäº†è§‚å¯Ÿè€…æ¥æ”¶äº‹ä»¶æ‰€åœ¨çš„çº¿ç¨‹ï¼Œå› æ­¤ onNextï¼ŒonComplete æ˜¯åœ¨ä¸»çº¿ç¨‹æ‰§è¡Œçš„</p><h2 id="ä¸‰ã€RxJava-æ¡†æ¶æµæ€æƒ³è®¾è®¡"><a href="#ä¸‰ã€RxJava-æ¡†æ¶æµæ€æƒ³è®¾è®¡" class="headerlink" title="ä¸‰ã€RxJava æ¡†æ¶æµæ€æƒ³è®¾è®¡"></a>ä¸‰ã€RxJava æ¡†æ¶æµæ€æƒ³è®¾è®¡</h2><p>æˆ‘ä»¬é€šè¿‡ä¸€æ®µä»£ç æ¥åˆ†æ RxJava çš„æ¡†æ¶æµè®¾è®¡ï¼š</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-keyword">class</span> <span class="hljs-title class_">MainActivity</span> : <span class="hljs-type">AppCompatActivity</span>() &#123;<br><br>    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onCreate</span><span class="hljs-params">(savedInstanceState: <span class="hljs-type">Bundle</span>?)</span></span> &#123;<br>        <span class="hljs-keyword">super</span>.onCreate(savedInstanceState)<br>        setContentView(R.layout.activity_main)<br><br>      <span class="hljs-comment">//create æ“ä½œç¬¦</span><br>        Observable.create(<span class="hljs-keyword">object</span> : ObservableOnSubscribe&lt;String&gt; &#123;<br>            <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">subscribe</span><span class="hljs-params">(emitter: <span class="hljs-type">Emitter</span>&lt;<span class="hljs-type">String</span>&gt;)</span></span> &#123;<br>                emitter.onNext(<span class="hljs-string">&quot;erdai666&quot;</span>)<br>                emitter.onComplete()<br>                println(<span class="hljs-string">&quot;subscribeï¼š<span class="hljs-subst">$&#123;Thread.currentThread().name&#125;</span>&quot;</span>)<br>            &#125;<br><br>        &#125;)<br>          <span class="hljs-comment">//map æ“ä½œç¬¦</span><br>            .map(<span class="hljs-keyword">object</span> : Function&lt;String,String&gt;&#123;<br>                <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">apply</span><span class="hljs-params">(t: <span class="hljs-type">String</span>)</span></span>: String &#123;<br>                    println(<span class="hljs-string">&quot;mapï¼š<span class="hljs-subst">$&#123;Thread.currentThread().name&#125;</span>&quot;</span>)<br>                    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;mapï¼š<span class="hljs-variable">$t</span>&quot;</span><br>                &#125;<br>            &#125;)<br>          <span class="hljs-comment">//flatMap æ“ä½œç¬¦</span><br>            .flatMap(<span class="hljs-keyword">object</span> : Function&lt;String,ObservableSource&lt;String&gt;&gt;&#123;<br>                <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">apply</span><span class="hljs-params">(t: <span class="hljs-type">String</span>)</span></span>: ObservableSource&lt;String&gt; &#123;<br>                    println(<span class="hljs-string">&quot;flatMapï¼š<span class="hljs-subst">$&#123;Thread.currentThread().name&#125;</span>&quot;</span>)<br>                    <span class="hljs-keyword">return</span> Observable.create(<span class="hljs-keyword">object</span> : ObservableOnSubscribe&lt;String&gt;&#123;<br>                        <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">subscribe</span><span class="hljs-params">(emitter: <span class="hljs-type">Emitter</span>&lt;<span class="hljs-type">String</span>&gt;)</span></span> &#123;<br>                            emitter.onNext(<span class="hljs-string">&quot;flatMapï¼š<span class="hljs-variable">$t</span>&quot;</span>)<br>                        &#125;<br>                    &#125;)<br>                &#125;<br><br>            &#125;)<br>          <span class="hljs-comment">//subscribeOn æ“ä½œç¬¦</span><br>            .subscribeOn(Schedulers.newThread())<br>          <span class="hljs-comment">//observeOn æ“ä½œç¬¦</span><br>            .observeOn(Schedulers.mainThread())<br>          <span class="hljs-comment">//è®¢é˜…</span><br>            .subscribe(<span class="hljs-keyword">object</span> : Observer&lt;String&gt; &#123;<br>                <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onSubscribe</span><span class="hljs-params">()</span></span> &#123;<br>                    println(<span class="hljs-string">&quot;onSubscribeï¼š<span class="hljs-subst">$&#123;Thread.currentThread().name&#125;</span>&quot;</span>)<br>                &#125;<br><br>                <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onNext</span><span class="hljs-params">(t: <span class="hljs-type">String</span>)</span></span> &#123;<br>                    println(<span class="hljs-string">&quot;onNextï¼š<span class="hljs-variable">$t</span>&quot;</span>)<br>                    println(<span class="hljs-string">&quot;onNextï¼š<span class="hljs-subst">$&#123;Thread.currentThread().name&#125;</span>&quot;</span>)<br>                &#125;<br><br>                <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onError</span><span class="hljs-params">(e: <span class="hljs-type">Throwable</span>)</span></span> &#123;<br>                    println(<span class="hljs-string">&quot;onErrorï¼š<span class="hljs-subst">$&#123;Thread.currentThread().name&#125;</span>&quot;</span>)<br>                &#125;<br><br>                <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onComplete</span><span class="hljs-params">()</span></span> &#123;<br>                    println(<span class="hljs-string">&quot;onComplete&quot;</span>)<br>                    println(<span class="hljs-string">&quot;onCompleteï¼š<span class="hljs-subst">$&#123;Thread.currentThread().name&#125;</span>&quot;</span>)<br>                &#125;<br>            &#125;)<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="3-1ã€é“¾å¼æ„å»ºæµ"><a href="#3-1ã€é“¾å¼æ„å»ºæµ" class="headerlink" title="3.1ã€é“¾å¼æ„å»ºæµ"></a>3.1ã€é“¾å¼æ„å»ºæµ</h3><p>ç‰¹ç‚¹ï¼šä»ä¸Šå¾€ä¸‹</p><p>ä½¿ç”¨ä¸€æ®µä¼ªä»£ç æ¥åˆ†æ RxJava Observable çš„æ„å»º</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-keyword">val</span> source = ObservableOnSubscribe()<br><span class="hljs-comment">//create æ“ä½œç¬¦</span><br>Observable.create(souce) ---&gt; observable0 = ObservableCreate(source)<br><span class="hljs-comment">//map æ“ä½œç¬¦</span><br>observable0.map() ---&gt; observable1 = ObservableMap(observable0)<br><span class="hljs-comment">//flatMap æ“ä½œç¬¦</span><br>observable1.flatMap() ---&gt; observable2 = ObservableFlatMap(observable1)<br><span class="hljs-comment">//subscribeOn æ“ä½œç¬¦</span><br>observable2.subscribeOn() ---&gt; observable3 = ObservableSubscribeOn(observable2)<br><span class="hljs-comment">//observeOn æ“ä½œç¬¦</span><br>observable3.observeOn() ---&gt; observable4 = ObservableObserveOn(observable3)<br></code></pre></td></tr></table></figure><p>æœ‰æ²¡æœ‰å‘ç°è§„å¾‹ï¼š<strong>æˆ‘ä»¬åœ¨ä¸Šæ¸¸åˆ›å»ºçš„ Observable(è¢«è§‚å¯Ÿè€…) ä¼šè¢«ä¼ å…¥åˆ°ä¸‹æ¸¸ã€‚è¿™å°±æ˜¯å…¸å‹çš„è£…é¥°è€…æ¨¡å¼çš„åº”ç”¨ï¼Œå®ƒçš„ç‰¹ç‚¹å°±æ˜¯ä»ä¸Šå¾€ä¸‹ï¼Œæ— é™å¥—å¨ƒï¼ŒåŠ¨æ€çš„è¾¾åˆ°åŠŸèƒ½çš„å¢å¼º</strong></p><h3 id="3-2ã€è®¢é˜…æµ"><a href="#3-2ã€è®¢é˜…æµ" class="headerlink" title="3.2ã€è®¢é˜…æµ"></a>3.2ã€è®¢é˜…æµ</h3><p>ç‰¹ç‚¹ï¼šä»ä¸‹å¾€ä¸Š</p><p>ä½¿ç”¨ä¸€æ®µä¼ªä»£ç æ¥åˆ†æ RxJava è®¢é˜…çš„è¿‡ç¨‹</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-keyword">val</span> observe5 = Observer()&#123;&#125;...<br>observable4.subscribe(observe5) ---&gt; observable4.subscribeActual(observe5)<br><br><span class="hljs-comment">//observeOn æ“ä½œç¬¦</span><br><span class="hljs-keyword">val</span> observe4 = ObserveOnObserver(observe5)<br>observable3.subscribe(observe4) ---&gt; observable3.subscribeActual(observe4)<br><br><span class="hljs-comment">//subscribeOn æ“ä½œç¬¦</span><br><span class="hljs-keyword">val</span> observe3 = SubscribeOnObserver(observe4)<br>observable2.subscribe(observe3) ---&gt; observable2.subscribeActual(observe3)<br><br><span class="hljs-comment">//flatMap æ“ä½œç¬¦</span><br><span class="hljs-keyword">val</span> observe2 = FlatMapObserver(observe3)<br>observable1.subscribe(observe2) ---&gt; observable1.subscribeActual(observe2)<br><br><span class="hljs-comment">//map æ“ä½œç¬¦</span><br><span class="hljs-keyword">val</span> observe1 = MapObserver(observe2)<br>observable0.subscribe(observe1) ---&gt; observable0.subscribeActual(observe1)<br><br><span class="hljs-comment">//create æ“ä½œç¬¦</span><br><span class="hljs-keyword">val</span> emitter = CreateEmitter(observe1)<br>source.subscribe(emitter)<br></code></pre></td></tr></table></figure><p>æœ‰ç‚¹é€’å½’çš„æ„æ€å“ˆ</p><p>å¯ä»¥å‘ç°è§„å¾‹ï¼š<strong>æˆ‘ä»¬åœ¨ä¸‹æ¸¸åˆ›å»ºçš„ Observable è®¢é˜…æ—¶ï¼Œä¼šé€’å½’å…ˆæ‰§è¡Œä¸Šæ¸¸çš„è®¢é˜…ï¼Œå› æ­¤è®¢é˜…æµçš„ç‰¹ç‚¹å°±æ˜¯ä»ä¸‹å¾€ä¸Š</strong></p><h3 id="3-3ã€å›è°ƒæµ"><a href="#3-3ã€å›è°ƒæµ" class="headerlink" title="3.3ã€å›è°ƒæµ"></a>3.3ã€å›è°ƒæµ</h3><p>ç‰¹ç‚¹ï¼šä»ä¸Šå¾€ä¸‹</p><p>æˆ‘ä»¬åˆ†æè®¢é˜…æµå¯ä»¥å‘ç°ï¼Œè§‚å¯Ÿè€…å¯¹è±¡æ˜¯ä»ä¸‹å¾€ä¸Šä¼ çš„ï¼Œå› æ­¤å½“ emitter å‘é€äº‹ä»¶æ—¶ï¼Œæ¥æ”¶çš„é¡ºåºï¼š</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-comment">//create æ“ä½œç¬¦</span><br>emitter -&gt; observe1<br><br><span class="hljs-comment">//map æ“ä½œç¬¦</span><br>observe1 -&gt; observe2<br><br><span class="hljs-comment">//flatMap æ“ä½œç¬¦</span><br>observe2 -&gt; observe3<br><br><span class="hljs-comment">//subscribeOn æ“ä½œç¬¦</span><br>observe3 -&gt; observe4<br><br><span class="hljs-comment">//observeOn æ“ä½œç¬¦</span><br>observe4 -&gt; observe5<br></code></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ï¼š<strong>å½“ emitter å‘é€äº‹ä»¶åï¼Œè§‚å¯Ÿè€…æ”¶åˆ°äº‹ä»¶çš„é¡ºåºæ˜¯ä»ä¸Šå¾€ä¸‹çš„</strong></p><p>ä¸Šé¢è¿™ä¸‰ä¸ªæµå°±æ˜¯ RxJava æ¡†æ¶æµçš„ä¸€ä¸ªæ€æƒ³è®¾è®¡ï¼Œå¯¹äºä½ ç†è§£ RxJava éå¸¸é‡è¦ï¼Œå¦‚æœæ²¡çœ‹æ˜ç™½ï¼Œå¤šçœ‹å‡ é</p><h3 id="3-4ã€é—®é¢˜å›é¡¾"><a href="#3-4ã€é—®é¢˜å›é¡¾" class="headerlink" title="3.4ã€é—®é¢˜å›é¡¾"></a>3.4ã€é—®é¢˜å›é¡¾</h3><p>æŒæ¡äº† RxJava æ¡†æ¶æµï¼Œæˆ‘ä»¬å›é¡¾ä¸€ä¸‹å‰é¢æåˆ°çš„ä¸¤ä¸ªé—®é¢˜ï¼š</p><p>1ã€å¦‚æœæœ‰å¤šä¸ª subscribeOn ï¼Œä¼šæ˜¯ä¸€ç§ä»€ä¹ˆæƒ…å†µï¼Ÿä¸ºå•¥ï¼Ÿ</p><p>ç­”ï¼šåªæœ‰æœ€ä¸Šé¢é‚£ä¸ª subscribeOn åˆ‡æ¢çš„çº¿ç¨‹æ‰ä¼šç”Ÿæ•ˆã€‚å› ä¸º subscribeOn çš„ä½œç”¨å°±æ˜¯å†³å®šä½ è®¢é˜…æ‰€æ‰§è¡Œçš„çº¿ç¨‹ï¼Œè€Œè®¢é˜…æµæ˜¯ä»ä¸‹å¾€ä¸Šçš„ï¼Œå› æ­¤ä½ å¦‚æœä½¿ç”¨å¤šä¸ª subscribeOn å¯¹çº¿ç¨‹è¿›è¡Œåˆ‡æ¢ï¼Œæœ€ç»ˆç”Ÿæ•ˆçš„åªä¼šæ˜¯æœ€ä¸Šé¢é‚£ä¸ª</p><p>2ã€å¦‚æœæœ‰å¤šä¸ª observeOn ï¼Œä¼šæ˜¯ä¸€ç§ä»€ä¹ˆæƒ…å†µï¼Ÿä¸ºå•¥ï¼Ÿ</p><p>ç­”ï¼šåŒç†ï¼Œåªæœ‰æœ€ä¸‹æ¸¸é‚£ä¸ª observeOn åˆ‡æ¢çš„çº¿ç¨‹æ‰ä¼šç”Ÿæ•ˆã€‚å› ä¸ºå›è°ƒæµæ˜¯ä»ä¸Šå¾€ä¸‹çš„ï¼Œæ‰€ä»¥å¦‚æœä½ åˆ›å»ºäº†å¤šä¸ªè§‚å¯Ÿè€…æ¥æ”¶äº‹ä»¶ï¼Œæœ€ç»ˆç”Ÿæ•ˆçš„åªä¼šæ˜¯æœ€ä¸‹é¢é‚£ä¸ª</p><p>å¥½å¥½ä½“ä¼šä¸‹ä¸‹é¢è¿™ä¸ªä¾‹å­ï¼š</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-keyword">class</span> <span class="hljs-title class_">MainActivity</span> : <span class="hljs-type">AppCompatActivity</span>() &#123;<br><br>    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onCreate</span><span class="hljs-params">(savedInstanceState: <span class="hljs-type">Bundle</span>?)</span></span> &#123;<br>        <span class="hljs-keyword">super</span>.onCreate(savedInstanceState)<br>        setContentView(R.layout.activity_main)<br><br>        Observable.create(<span class="hljs-keyword">object</span> : ObservableOnSubscribe&lt;String&gt; &#123;<br>            <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">subscribe</span><span class="hljs-params">(emitter: <span class="hljs-type">Emitter</span>&lt;<span class="hljs-type">String</span>&gt;)</span></span> &#123;<br>                emitter.onNext(<span class="hljs-string">&quot;erdai666&quot;</span>)<br>                emitter.onComplete()<br>                println(<span class="hljs-string">&quot;subscribeï¼š<span class="hljs-subst">$&#123;Thread.currentThread().name&#125;</span>&quot;</span>)<br>            &#125;<br><br>        &#125;)<br>            .subscribeOn(Schedulers.newThread())<br>            .map(<span class="hljs-keyword">object</span> : Function&lt;String, String&gt; &#123;<br>                <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">apply</span><span class="hljs-params">(t: <span class="hljs-type">String</span>)</span></span>: String &#123;<br>                    println(<span class="hljs-string">&quot;mapï¼š<span class="hljs-subst">$&#123;Thread.currentThread().name&#125;</span>&quot;</span>)<br>                    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;mapï¼š<span class="hljs-variable">$t</span>&quot;</span><br>                &#125;<br><br>            &#125;)<br>            .subscribeOn(Schedulers.mainThread())<br>            .subscribeOn(Schedulers.newThread())<br>            .subscribeOn(Schedulers.mainThread())<br>            .observeOn(Schedulers.newThread())<br>            .observeOn(Schedulers.mainThread())<br>            .observeOn(Schedulers.newThread())<br>          .observeOn(Schedulers.mainThread())<br>            .subscribe(<span class="hljs-keyword">object</span> : Observer&lt;String&gt; &#123;<br>                <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onSubscribe</span><span class="hljs-params">()</span></span> &#123;<br>                    println(<span class="hljs-string">&quot;onSubscribeï¼š<span class="hljs-subst">$&#123;Thread.currentThread().name&#125;</span>&quot;</span>)<br>                &#125;<br><br>                <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onNext</span><span class="hljs-params">(t: <span class="hljs-type">String</span>)</span></span> &#123;<br>                    println(<span class="hljs-string">&quot;onNextï¼š<span class="hljs-variable">$t</span>&quot;</span>)<br>                    println(<span class="hljs-string">&quot;onNextï¼š<span class="hljs-subst">$&#123;Thread.currentThread().name&#125;</span>&quot;</span>)<br>                &#125;<br><br>                <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onError</span><span class="hljs-params">(e: <span class="hljs-type">Throwable</span>)</span></span> &#123;<br>                    println(<span class="hljs-string">&quot;onErrorï¼š<span class="hljs-subst">$&#123;Thread.currentThread().name&#125;</span>&quot;</span>)<br>                &#125;<br><br>                <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onComplete</span><span class="hljs-params">()</span></span> &#123;<br>                    println(<span class="hljs-string">&quot;onComplete&quot;</span>)<br>                    println(<span class="hljs-string">&quot;onCompleteï¼š<span class="hljs-subst">$&#123;Thread.currentThread().name&#125;</span>&quot;</span>)<br>                &#125;<br><br>            &#125;)<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">//æ‰“å°ç»“æœ</span><br>onSubscribeï¼šmain<br>mapï¼špool-<span class="hljs-number">2</span>-thread-<span class="hljs-number">1</span><br>subscribeï¼špool-<span class="hljs-number">2</span>-thread-<span class="hljs-number">1</span><br>onNextï¼šmapï¼šerdai666<br>onNextï¼šmain<br>onComplete<br>onCompleteï¼šmain<br></code></pre></td></tr></table></figure><h2 id="å››ã€RxLifeCycle"><a href="#å››ã€RxLifeCycle" class="headerlink" title="å››ã€RxLifeCycle"></a>å››ã€RxLifeCycle</h2><p>å®ç° RxLifeCycle ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦äº†è§£ä¸€ä¸‹ compose æ“ä½œç¬¦</p><h3 id="4-1ã€compose-æ“ä½œç¬¦ä»‹ç»"><a href="#4-1ã€compose-æ“ä½œç¬¦ä»‹ç»" class="headerlink" title="4.1ã€compose æ“ä½œç¬¦ä»‹ç»"></a>4.1ã€compose æ“ä½œç¬¦ä»‹ç»</h3><p>compose æ“ä½œç¬¦ä½œç”¨ï¼šä¼ å…¥ä¸€ä¸ªä¸Šæ¸¸çš„è¢«è§‚å¯Ÿè€…è¿”å›ä¸€ä¸ªä¸‹æ¸¸çš„è¢«è§‚å¯Ÿè€…ï¼Œèƒ½èµ·åˆ°ä¸€ä¸ªä»£ç å¤ç”¨çš„é€»è¾‘</p><p><strong>æ³¨æ„</strong>ï¼šä¸‹é¢ä½¿ç”¨çš„æ˜¯ RxJava åŒ…ä¸‹çš„ç±»</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyTransformer</span>&lt;<span class="hljs-type">T: Any</span>&gt;: <span class="hljs-type">ObservableTransformer</span>&lt;<span class="hljs-type">T,T</span>&gt; &#123;<br><br>    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">apply</span><span class="hljs-params">(upstream: <span class="hljs-type">Observable</span>&lt;<span class="hljs-type">T</span>&gt;)</span></span>: ObservableSource&lt;T&gt; &#123;<br>      <span class="hljs-comment">//å®Œæˆè®¢é˜…å’Œå›è°ƒçº¿ç¨‹çš„åˆ‡æ¢</span><br>        <span class="hljs-keyword">return</span> upstream.subscribeOn(Schedulers.io())<br>            .observeOn(AndroidSchedulers.mainThread())<br>    &#125;<br>&#125;<br><br><br><span class="hljs-comment">//å®é™…åº”ç”¨</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">MainActivity</span> : <span class="hljs-type">AppCompatActivity</span>() &#123;<br><br>    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onCreate</span><span class="hljs-params">(savedInstanceState: <span class="hljs-type">Bundle</span>?)</span></span> &#123;<br>        <span class="hljs-keyword">super</span>.onCreate(savedInstanceState)<br>        setContentView(R.layout.activity_main)<br><br>        Observable.create(<span class="hljs-keyword">object</span> : ObservableOnSubscribe&lt;String&gt;&#123;<br>            <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">subscribe</span><span class="hljs-params">(emitter: <span class="hljs-type">ObservableEmitter</span>&lt;<span class="hljs-type">String</span>&gt;)</span></span> &#123;<br>                emitter.onNext(<span class="hljs-string">&quot;erdai666&quot;</span>)<br>                emitter.onComplete()<br>                println(<span class="hljs-string">&quot;subscribeï¼š<span class="hljs-subst">$&#123;Thread.currentThread().name&#125;</span>&quot;</span>)<br>            &#125;<br>        &#125;)<br>          <span class="hljs-comment">//compose æ“ä½œç¬¦éœ€è¦ä¼ å…¥ä¸€ä¸ª ObservableTransformer ç±»å‹çš„å¯¹è±¡</span><br>            .compose(MyTransformer())<br>            .subscribe(<span class="hljs-keyword">object</span> : Observer&lt;String&gt;&#123;<br>                <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onSubscribe</span><span class="hljs-params">(d: <span class="hljs-type">Disposable</span>)</span></span> &#123;<br>                    println(<span class="hljs-string">&quot;onSubscribeï¼š<span class="hljs-subst">$&#123;Thread.currentThread().name&#125;</span>&quot;</span>)<br>                &#125;<br><br>                <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onNext</span><span class="hljs-params">(t: <span class="hljs-type">String</span>)</span></span> &#123;<br>                    println(<span class="hljs-string">&quot;onNext <span class="hljs-variable">$t</span>&quot;</span>)<br>                    println(<span class="hljs-string">&quot;onNextï¼š<span class="hljs-subst">$&#123;Thread.currentThread().name&#125;</span>&quot;</span>)<br>                &#125;<br><br>                <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onError</span><span class="hljs-params">(e: <span class="hljs-type">Throwable</span>)</span></span> &#123;<br>                    println(<span class="hljs-string">&quot;onErrorï¼š<span class="hljs-subst">$&#123;Thread.currentThread().name&#125;</span>&quot;</span>)<br>                &#125;<br><br>                <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onComplete</span><span class="hljs-params">()</span></span> &#123;<br>                    println(<span class="hljs-string">&quot;onComplete&quot;</span>)<br>                    println(<span class="hljs-string">&quot;onCompleteï¼š<span class="hljs-subst">$&#123;Thread.currentThread().name&#125;</span>&quot;</span>)<br>                &#125;<br>            &#125;)<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">//æ‰“å°ç»“æœ</span><br>onSubscribeï¼šmain<br>subscribeï¼šRxCachedThreadScheduler-<span class="hljs-number">1</span><br>onNext erdai666<br>onNextï¼šmain<br>onComplete<br>onCompleteï¼šmain<br></code></pre></td></tr></table></figure><h3 id="4-2ã€RxLifeCycle-å®ç°"><a href="#4-2ã€RxLifeCycle-å®ç°" class="headerlink" title="4.2ã€RxLifeCycle å®ç°"></a>4.2ã€RxLifeCycle å®ç°</h3><p>æˆ‘ä»¬ä¸Šé¢å†™çš„ä»£ç æ˜¯å­˜åœ¨å†…å­˜æ³„æ¼çš„ï¼Œå¦‚æœæˆ‘ä»¬ä½¿ç”¨ RxJava åœ¨ Activity åšä¸€ä¸ªç½‘ç»œè¯·æ±‚ï¼Œæ­¤æ—¶ç”¨æˆ·é€€å‡ºäº†å½“å‰ Activity ï¼Œä½†æ˜¯ç½‘ç»œè¯·æ±‚è¿˜åœ¨ç»§ç»­ï¼Œé‚£ä¹ˆæ­¤æ—¶å°±ä¼šäº§ç”Ÿå†…å­˜æ³„æ¼ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦åœ¨åšç½‘ç»œè¯·æ±‚çš„æ—¶å€™æ„ŸçŸ¥ Activity çš„ç”Ÿå‘½å‘¨æœŸå»åšç›¸åº”çš„é€»è¾‘å¤„ç†ï¼Œé‚£ä¹ˆæ­¤æ—¶ RxLifeCycle å°±æ´¾ä¸Šç”¨åœºäº†ï¼Œç›´æ¥ä¸Šä»£ç ï¼š</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-comment">//1ã€RxLifeCycle å®ç°ç±»</span><br><span class="hljs-comment">//1.1ã€å®ƒå®ç°äº† LifecycleEventObserverï¼Œå› æ­¤å¯ä»¥æ„ŸçŸ¥ LifecycleOwner çš„å£°æ˜å‘¨æœŸ</span><br><span class="hljs-comment">//1.2ã€å®ƒå®ç°äº† ObservableTransformerï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ compose æ“ä½œç¬¦</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">RxLifeCycle</span>&lt;<span class="hljs-type">T: Any</span>&gt;: <span class="hljs-type">LifecycleEventObserver</span>,<span class="hljs-type">ObservableTransformer</span>&lt;<span class="hljs-type">T,T</span>&gt; &#123;<br><br>    <span class="hljs-keyword">var</span> compositeDisposable = CompositeDisposable()<br><br>    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onStateChanged</span><span class="hljs-params">(source: <span class="hljs-type">LifecycleOwner</span>, event: <span class="hljs-type">Lifecycle</span>.<span class="hljs-type">Event</span>)</span></span> &#123;<br>        <span class="hljs-keyword">if</span>(event == Lifecycle.Event.ON_DESTROY)&#123;<br>            <span class="hljs-comment">//ç›‘å¬åˆ° LifecycleOwner ç”Ÿå‘½å‘¨æœŸä¸º Destroy æ—¶ï¼Œç§»é™¤ Disposable å®¹å™¨ä¸­çš„æ‰€æœ‰ Disposable å¯¹è±¡</span><br>            compositeDisposable.clear()<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">apply</span><span class="hljs-params">(upstream: <span class="hljs-type">Observable</span>&lt;<span class="hljs-type">T</span>&gt;)</span></span>: ObservableSource&lt;T&gt; &#123;<br>        <span class="hljs-keyword">return</span> upstream.doOnSubscribe&#123;<br>            <span class="hljs-comment">//å°† Disposable åŠ å…¥ Disposable å®¹å™¨</span><br>            compositeDisposable.add(it)<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">companion</span> <span class="hljs-keyword">object</span>&#123;<br>      <span class="hljs-comment">//ä¼ å…¥ LifecycleOwnerï¼Œå’Œ RxJava è¿›è¡Œç”Ÿå‘½å‘¨æœŸç»‘å®š</span><br>        <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;T: Any&gt;</span> <span class="hljs-title">bindToDestroy</span><span class="hljs-params">(owner: <span class="hljs-type">LifecycleOwner</span>)</span></span>: RxLifeCycle&lt;T&gt;&#123;<br>            <span class="hljs-keyword">val</span> rxLifeCycle = RxLifeCycle&lt;T&gt;()<br>            owner.lifecycle.addObserver(rxLifeCycle)<br>            <span class="hljs-keyword">return</span> rxLifeCycle<br>        &#125;<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">//2ã€ä½¿ç”¨</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">MainActivity</span> : <span class="hljs-type">AppCompatActivity</span>() &#123;<br><br>    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onCreate</span><span class="hljs-params">(savedInstanceState: <span class="hljs-type">Bundle</span>?)</span></span> &#123;<br>        <span class="hljs-keyword">super</span>.onCreate(savedInstanceState)<br>        setContentView(R.layout.activity_main)<br><br>        Observable.create(<span class="hljs-keyword">object</span> : ObservableOnSubscribe&lt;String&gt;&#123;<br>            <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">subscribe</span><span class="hljs-params">(emitter: <span class="hljs-type">ObservableEmitter</span>&lt;<span class="hljs-type">String</span>&gt;)</span></span> &#123;<br>                emitter.onNext(<span class="hljs-string">&quot;erdai666&quot;</span>)<br>                emitter.onComplete()<br>                println(<span class="hljs-string">&quot;subscribeï¼š<span class="hljs-subst">$&#123;Thread.currentThread().name&#125;</span>&quot;</span>)<br>            &#125;<br>        &#125;)<br>            .compose(MyTransformer())<br>          <span class="hljs-comment">//ç»‘å®šç”Ÿå‘½å‘¨æœŸï¼Œé˜²æ­¢å†…å­˜æ³„æ¼</span><br>          .compose(RxLifeCycle.bindToDestroy(<span class="hljs-keyword">this</span>))<br>            .subscribe(<span class="hljs-keyword">object</span> : Observer&lt;String&gt;&#123;<br>                <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onSubscribe</span><span class="hljs-params">(d: <span class="hljs-type">Disposable</span>)</span></span> &#123;<br>                    println(<span class="hljs-string">&quot;onSubscribeï¼š<span class="hljs-subst">$&#123;Thread.currentThread().name&#125;</span>&quot;</span>)<br>                &#125;<br><br>                <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onNext</span><span class="hljs-params">(t: <span class="hljs-type">String</span>)</span></span> &#123;<br>                    println(<span class="hljs-string">&quot;onNext <span class="hljs-variable">$t</span>&quot;</span>)<br>                    println(<span class="hljs-string">&quot;onNextï¼š<span class="hljs-subst">$&#123;Thread.currentThread().name&#125;</span>&quot;</span>)<br>                &#125;<br><br>                <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onError</span><span class="hljs-params">(e: <span class="hljs-type">Throwable</span>)</span></span> &#123;<br>                    println(<span class="hljs-string">&quot;onErrorï¼š<span class="hljs-subst">$&#123;Thread.currentThread().name&#125;</span>&quot;</span>)<br>                &#125;<br><br>                <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onComplete</span><span class="hljs-params">()</span></span> &#123;<br>                    println(<span class="hljs-string">&quot;onComplete&quot;</span>)<br>                    println(<span class="hljs-string">&quot;onCompleteï¼š<span class="hljs-subst">$&#123;Thread.currentThread().name&#125;</span>&quot;</span>)<br>                &#125;<br>            &#125;)<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="äº”ã€RxBus"><a href="#äº”ã€RxBus" class="headerlink" title="äº”ã€RxBus"></a>äº”ã€RxBus</h2><p>å®ç° RxBus å‰ï¼Œæˆ‘ä»¬éœ€è¦å…ˆäº†è§£ä¸€ä¸‹ Subject</p><h3 id="5-1ã€Subject-ä»‹ç»"><a href="#5-1ã€Subject-ä»‹ç»" class="headerlink" title="5.1ã€Subject ä»‹ç»"></a>5.1ã€Subject ä»‹ç»</h3><p>1ã€Subject æ—¢å¯ä»¥è¡¨ç¤ºä¸€ä¸ªè¢«è§‚å¯Ÿè€…ä¹Ÿå¯ä»¥è¡¨ç¤ºä¸€ä¸ªè§‚å¯Ÿè€…ï¼Œå®é™…å®ƒå°±æ˜¯ç»§æ‰¿äº† Observable æŠ½è±¡ç±»å¹¶å®ç°äº† Observer æ¥å£</p><p>2ã€Subject ä¸»è¦åˆ†ä¸ºå››ç§ï¼š</p><blockquote><p>1ã€AsyncSubject</p><p>2ã€BehaviorSubject</p><p>3ã€PublishSubject</p><p>4ã€ReplaySubject</p></blockquote><h4 id="5-1-1ã€AsyncSubject"><a href="#5-1-1ã€AsyncSubject" class="headerlink" title="5.1.1ã€AsyncSubject"></a>5.1.1ã€AsyncSubject</h4><p>ç‰¹ç‚¹ï¼šäº‹ä»¶å‘å°„æ— è®ºæ˜¯åœ¨è®¢é˜…å‰è¿˜æ˜¯åï¼Œéƒ½åªä¼šæ¥æ”¶æœ€åä¸€ä¸ªäº‹ä»¶</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span>&#123;<br>    <span class="hljs-keyword">val</span> subject = AsyncSubject.create&lt;String&gt;()<br>    subject.onNext(<span class="hljs-string">&quot;A&quot;</span>)<br>    subject.onNext(<span class="hljs-string">&quot;B&quot;</span>)<br>    subject.subscribe &#123;<br>        println(it)<br>    &#125;<br>    subject.onNext(<span class="hljs-string">&quot;C&quot;</span>)<br>    subject.onNext(<span class="hljs-string">&quot;D&quot;</span>)<br>    subject.onComplete()<br>&#125;<br><br><span class="hljs-comment">//æ‰“å°ç»“æœ</span><br>D<br></code></pre></td></tr></table></figure><h4 id="5-1-2ã€BehaviorSubject"><a href="#5-1-2ã€BehaviorSubject" class="headerlink" title="5.1.2ã€BehaviorSubject"></a>5.1.2ã€BehaviorSubject</h4><p>ç‰¹ç‚¹ï¼šæ¥æ”¶è®¢é˜…å‰æœ€åä¸€ä¸ªäº‹ä»¶ä»¥åŠè®¢é˜…åçš„æ‰€æœ‰äº‹ä»¶</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span>&#123;<br>    <span class="hljs-keyword">val</span> subject = BehaviorSubject.create&lt;String&gt;()<br>    subject.onNext(<span class="hljs-string">&quot;A&quot;</span>)<br>    subject.onNext(<span class="hljs-string">&quot;B&quot;</span>)<br>    subject.subscribe &#123;<br>        println(it)<br>    &#125;<br>    subject.onNext(<span class="hljs-string">&quot;C&quot;</span>)<br>    subject.onNext(<span class="hljs-string">&quot;D&quot;</span>)<br>    subject.onComplete()<br>&#125;<br><br><span class="hljs-comment">//æ‰“å°ç»“æœ</span><br>B<br>C<br>D<br></code></pre></td></tr></table></figure><h4 id="5-1-3ã€PublishSubject"><a href="#5-1-3ã€PublishSubject" class="headerlink" title="5.1.3ã€PublishSubject"></a>5.1.3ã€PublishSubject</h4><p>ç‰¹ç‚¹ï¼šåªæ¥æ”¶è®¢é˜…åçš„æ‰€æœ‰äº‹ä»¶</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span>&#123;<br>    <span class="hljs-keyword">val</span> subject = PublishSubject.create&lt;String&gt;()<br>    subject.onNext(<span class="hljs-string">&quot;A&quot;</span>)<br>    subject.onNext(<span class="hljs-string">&quot;B&quot;</span>)<br>    subject.subscribe &#123;<br>        println(it)<br>    &#125;<br>    subject.onNext(<span class="hljs-string">&quot;C&quot;</span>)<br>    subject.onNext(<span class="hljs-string">&quot;D&quot;</span>)<br>    subject.onComplete()<br>&#125;<br><br><span class="hljs-comment">//æ‰“å°ç»“æœ</span><br>C<br>D<br></code></pre></td></tr></table></figure><h4 id="5-1-4ã€ReplaySubject"><a href="#5-1-4ã€ReplaySubject" class="headerlink" title="5.1.4ã€ReplaySubject"></a>5.1.4ã€ReplaySubject</h4><p>ç‰¹ç‚¹ï¼šäº‹ä»¶å‘å°„æ— è®ºæ˜¯åœ¨è®¢é˜…å‰è¿˜æ˜¯åï¼Œéƒ½ä¼šè¢«å…¨éƒ¨æ¥æ”¶</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span>&#123;<br>    <span class="hljs-keyword">val</span> subject = ReplaySubject.create&lt;String&gt;()<br>    subject.onNext(<span class="hljs-string">&quot;A&quot;</span>)<br>    subject.onNext(<span class="hljs-string">&quot;B&quot;</span>)<br>    subject.subscribe &#123;<br>        println(it)<br>    &#125;<br>    subject.onNext(<span class="hljs-string">&quot;C&quot;</span>)<br>    subject.onNext(<span class="hljs-string">&quot;D&quot;</span>)<br>    subject.onComplete()<br>&#125;<br><br><span class="hljs-comment">//æ‰“å°ç»“æœ</span><br>A<br>B<br>C<br>D<br></code></pre></td></tr></table></figure><h3 id="5-2ã€RxBus-å®ç°"><a href="#5-2ã€RxBus-å®ç°" class="headerlink" title="5.2ã€RxBus å®ç°"></a>5.2ã€RxBus å®ç°</h3><p>æˆ‘ä»¬åœ¨æ—¥å¸¸å¼€å‘ä¸­ï¼Œäº‹ä»¶æ€»çº¿ç”¨çš„æœ€å¤šçš„å¯èƒ½æ˜¯ EventBusï¼Œæ®Šä¸çŸ¥ RxJava ä¹Ÿèƒ½é€šè¿‡ Subject å®ç°äº‹ä»¶æ€»çº¿çš„åŠŸèƒ½ï¼Œè€Œä¸”ä½¿ç”¨èµ·æ¥æ¯” EventBus è¿˜ç®€å•ä¸€äº›ï¼š</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-comment">//1ã€RxBus å®ç°ç±»</span><br><span class="hljs-keyword">object</span> RxBus &#123;<br>    <span class="hljs-comment">//å®šä¹‰ä¸€ä¸ª PublishSubject ç±»å‹çš„ Subjectï¼Œåªæ¥æ”¶è®¢é˜…åçš„äº‹ä»¶</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> subject: Subject&lt;Any&gt; = PublishSubject.create&lt;Any&gt;().toSerialized()<br>    <br>    <span class="hljs-comment">//æ¥æ”¶äº‹ä»¶</span><br>    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;T: Any&gt;</span> <span class="hljs-title">receive</span><span class="hljs-params">(clazz: <span class="hljs-type">Class</span>&lt;<span class="hljs-type">T</span>&gt;)</span></span>: Observable&lt;T&gt;&#123;<br>        <span class="hljs-keyword">return</span> subject.ofType(clazz)<br>    &#125;<br><br>    <span class="hljs-comment">//å‘é€äº‹ä»¶</span><br>    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">post</span><span class="hljs-params">(o: <span class="hljs-type">Any</span>)</span></span>&#123;<br>        subject.onNext(o)<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">//2ã€ä½¿ç”¨</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">MainActivity</span> : <span class="hljs-type">AppCompatActivity</span>() &#123;<br><br>    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onCreate</span><span class="hljs-params">(savedInstanceState: <span class="hljs-type">Bundle</span>?)</span></span> &#123;<br>        <span class="hljs-keyword">super</span>.onCreate(savedInstanceState)<br>        setContentView(R.layout.activity_main)<br><br>        RxBus.receive(String::<span class="hljs-keyword">class</span>.java)<br>          <span class="hljs-comment">//ç»‘å®šç”Ÿå‘½å‘¨æœŸï¼Œé˜²æ­¢å†…å­˜æ³„æ¼</span><br>            .compose(RxLifeCycle.bindToDestroy(<span class="hljs-keyword">this</span>))<br>            .subscribe &#123;<br>                println(it)<br>            &#125;<br><br>        RxBus.post(<span class="hljs-string">&quot;erdai666&quot;</span>)<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">//æ‰“å°ç»“æœ</span><br>erdai666<br></code></pre></td></tr></table></figure><h2 id="å…­ã€æ€»ç»“"><a href="#å…­ã€æ€»ç»“" class="headerlink" title="å…­ã€æ€»ç»“"></a>å…­ã€æ€»ç»“</h2><p>æœ¬ç¯‡æ–‡ç« æˆ‘ä»¬ç”±æµ…å…¥æ·±å¯¹ RxJava è¿›è¡Œäº†å…¨é¢çš„ä»‹ç»ï¼š</p><p>1ã€ä»‹ç»äº† RxJava ä¸­ä½¿ç”¨çš„ä¸¤ç§è®¾è®¡æ¨¡å¼ï¼š</p><blockquote><p>1ã€å˜ç§çš„è§‚å¯Ÿè€…æ¨¡å¼</p><p>2ã€è£…é¥°è€…æ¨¡å¼</p></blockquote><p>2ã€æ‰‹æ’¸äº† RxJava æ ¸å¿ƒæ“ä½œç¬¦çš„å®ç°ï¼Œå¸Œæœ›ä½ èƒ½ä¸¾ä¸€åä¸‰ï¼Œå…¶å®ƒæ“ä½œç¬¦çš„å®ç°ä¹Ÿæ˜¯ç±»ä¼¼çš„å¥—è·¯</p><p>3ã€ä»‹ç»äº† RxJava æ¡†æ¶æµæ€æƒ³è®¾è®¡ï¼š</p><blockquote><p>1ã€é“¾å¼æ„å»ºæµï¼šä»ä¸Šå¾€ä¸‹</p><p>2ã€è®¢é˜…æµï¼šä»ä¸‹å¾€ä¸Š</p><p>3ã€å›è°ƒæµï¼šä»ä¸Šå¾€ä¸‹</p></blockquote><p>4ã€ä»‹ç»äº† compose æ“ä½œç¬¦å¹¶æ‰©å±•å®ç°äº† RxLifeCycle</p><p>5ã€ä»‹ç»äº† Subject å¹¶æ‰©å±•å®ç°äº† RxBus</p><p>å¥½äº†ï¼Œæœ¬ç¯‡æ–‡ç« åˆ°è¿™é‡Œå°±ç»“æŸäº†ï¼Œå¸Œæœ›èƒ½ç»™ä½ å¸¦æ¥å¸®åŠ© ğŸ¤</p><p><strong>æ„Ÿè°¢ä½ é˜…è¯»è¿™ç¯‡æ–‡ç« </strong></p><h3 id="å‚è€ƒå’Œæ¨è"><a href="#å‚è€ƒå’Œæ¨è" class="headerlink" title="å‚è€ƒå’Œæ¨è"></a>å‚è€ƒå’Œæ¨è</h3><p><a href="https://github.com/ReactiveX/RxJava">RxJava</a></p><blockquote><p><strong>ä½ çš„ç‚¹èµï¼Œè¯„è®ºï¼Œæ˜¯å¯¹æˆ‘å·¨å¤§çš„é¼“åŠ±ï¼</strong></p><p>æ¬¢è¿å…³æ³¨æˆ‘çš„<strong>å…¬ä¼—å·ï¼š</strong>  <a href="http://m6z.cn/6jwi7b"><strong>sweetying</strong></a> ï¼Œæ–‡ç« æ›´æ–°å¯ç¬¬ä¸€æ—¶é—´æ”¶åˆ°</p><p>å¦‚æœ<strong>æœ‰é—®é¢˜</strong>ï¼Œå…¬ä¼—å·å†…æœ‰åŠ æˆ‘å¾®ä¿¡çš„å…¥å£ï¼Œåœ¨æŠ€æœ¯å­¦ä¹ ã€ä¸ªäººæˆé•¿çš„é“è·¯ä¸Šï¼Œæˆ‘ä»¬ä¸€èµ·å‰è¿›ï¼</p></blockquote>]]></content>
    
    
    <categories>
      
      <category>Android</category>
      
      <category>ä¸€ç¯‡å°±å¤Ÿ</category>
      
    </categories>
    
    
    <tags>
      
      <tag>åŸåˆ›</tag>
      
      <tag>Android</tag>
      
      <tag>ä¸€ç¯‡å°±å¤Ÿ</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ä¸€ç¯‡å°±å¤Ÿç³»åˆ—ï¼šAndroid ä¸­ä½¿ç”¨ Protobuf</title>
    <link href="/2022/10/11/%E4%B8%80%E7%AF%87%E5%B0%B1%E5%A4%9F%E7%B3%BB%E5%88%97%EF%BC%9AAndroid%20%E4%B8%AD%E4%BD%BF%E7%94%A8%20Protobuf/"/>
    <url>/2022/10/11/%E4%B8%80%E7%AF%87%E5%B0%B1%E5%A4%9F%E7%B3%BB%E5%88%97%EF%BC%9AAndroid%20%E4%B8%AD%E4%BD%BF%E7%94%A8%20Protobuf/</url>
    
    <content type="html"><![CDATA[<p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/b8ddd1d4e057458ab3c236644e0ae27c~tplv-k3u1fbpfcp-watermark.image"></p><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>å¾ˆé«˜å…´é‡è§ä½ ~</p><p>æœ€è¿‘æˆ‘è´Ÿè´£çš„ LiveChat å®¢æœèŠå¤©ç³»ç»Ÿåˆ°äº†è‡ªç ”é˜¶æ®µï¼Œç±»ä¼¼åšä¸€ä¸ªè…¾è®¯ IM é€šä¿¡ SDKã€‚å’Œåå°è®¨è®ºåï¼Œç¡®å®šæ•°æ®ä¼ è¾“æ–¹å¼ä½¿ç”¨ Protobufï¼Œç®€å•çš„ä»‹ç»ä¸‹è‡ªå·±çš„ä¸€ä¸ªä½¿ç”¨å¿ƒå¾—</p><h2 id="ä¸€ã€Protobuf-ä»‹ç»"><a href="#ä¸€ã€Protobuf-ä»‹ç»" class="headerlink" title="ä¸€ã€Protobuf ä»‹ç»"></a>ä¸€ã€Protobuf ä»‹ç»</h2><p>Protobuf å…¨ç§°ï¼šProtocol Buffersï¼Œæ˜¯ Google æ¨å‡ºçš„ä¸€ç§ä¸å¹³å°æ— å…³ã€è¯­è¨€æ— å…³ã€å¯æ‰©å±•çš„è½»ä¾¿é«˜æ•ˆçš„åºåˆ—åŒ–æ•°æ®å­˜å‚¨æ ¼å¼ï¼Œç±»ä¼¼äºæˆ‘ä»¬å¸¸ç”¨çš„ xml å’Œ jsonã€‚</p><p><strong>é—®é¢˜</strong>ï¼šæ—¢ç„¶æœ‰äº† xml å’Œ jsonï¼ŒGoogle ä¸ºå•¥è¿˜è¦æ¨å‡º Protobuf å‘¢ï¼Ÿ</p><p>å­˜åœ¨æ˜¯æœ‰åŸå› çš„ï¼ŒProtobuf ç”¨ä¸¤ä¸ªå­—æ€»ç»“ï¼šå°ï¼Œå¿«ã€‚ç”¨ Protobuf åºåˆ—åŒ–åçš„å¤§å°æ˜¯ json çš„ååˆ†ä¹‹ä¸€ï¼Œæ˜¯ xml æ ¼å¼çš„äºŒååˆ†ä¹‹ä¸€ï¼Œè€Œä¸”æ€§èƒ½æ˜¯ä»–ä»¬çš„ 5ï½100 å€ã€‚</p><p>é€šå¸¸æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä½¿ç”¨ xml æˆ–è€… json è¿›è¡Œæ•°æ®é€šä¿¡æ˜¯æ²¡ä»€ä¹ˆé—®é¢˜çš„ï¼Œä½†æ˜¯åœ¨é«˜æ€§èƒ½å’Œå¤§æ•°æ®é€šä¿¡çš„æƒ…å†µä¸‹ï¼Œå¦‚æœæœ‰åŠæ³•å‹ç¼©æ•°æ®é‡ï¼Œæé«˜ä¼ è¾“æ•ˆç‡ï¼Œæ˜¾ç„¶ä¼šç»™ç”¨æˆ·å¸¦æ¥æ›´å¿«æ›´æµç•…çš„ä½“éªŒï¼Œå› æ­¤åš LiveChat è‡ªç ”ï¼ŒProtobuf æˆä¸ºæˆ‘ä»¬è¿›è¡Œæ•°æ®ä¼ è¾“çš„ç¬¬ä¸€é€‰æ‹©ã€‚</p><table><thead><tr><th></th><th>xml</th><th>json</th><th>protobuf</th></tr></thead><tbody><tr><td>æ•°æ®ä¿å­˜æ–¹å¼</td><td>æ–‡æœ¬</td><td>æ–‡æœ¬</td><td>äºŒè¿›åˆ¶</td></tr><tr><td>æ•°æ®ä¿å­˜å¤§å°</td><td>å¤§</td><td>ä¸€èˆ¬</td><td>å°</td></tr><tr><td>è§£ææ•ˆç‡</td><td>æ…¢</td><td>ä¸€èˆ¬</td><td>å¿«</td></tr></tbody></table><h2 id="äºŒã€Protobuf-ç¯å¢ƒé…ç½®"><a href="#äºŒã€Protobuf-ç¯å¢ƒé…ç½®" class="headerlink" title="äºŒã€Protobuf ç¯å¢ƒé…ç½®"></a>äºŒã€Protobuf ç¯å¢ƒé…ç½®</h2><p>ä»‹ç»ä¸¤ç§å®‰è£… Protobuf çš„æ–¹å¼ï¼š</p><p>1ã€Github ä¸‹è½½ Protobuf å¹¶å®‰è£…</p><p>2ã€brew å®‰è£…</p><h3 id="2-1ã€æ–¹å¼ä¸€ï¼šGithub-ä¸‹è½½-Protobuf-å¹¶å®‰è£…"><a href="#2-1ã€æ–¹å¼ä¸€ï¼šGithub-ä¸‹è½½-Protobuf-å¹¶å®‰è£…" class="headerlink" title="2.1ã€æ–¹å¼ä¸€ï¼šGithub ä¸‹è½½ Protobuf å¹¶å®‰è£…"></a>2.1ã€æ–¹å¼ä¸€ï¼šGithub ä¸‹è½½ Protobuf å¹¶å®‰è£…</h3><p><strong>æ³¨æ„</strong>ï¼šProtobuf ç‰ˆæœ¬å°½é‡ä¿æŒå‰åå°ä¸€è‡´ï¼Œè¿™é‡Œæ˜¯åå°å’Œæˆ‘çº¦å®šçš„ä¸€ä¸ªç‰ˆæœ¬</p><p>Protobuf Github ä¸‹è½½åœ°å€ï¼š<a href="https://github.com/protocolbuffers/protobuf/releases/tag/v3.19.2">https://github.com/protocolbuffers/protobuf/releases/tag/v3.19.2</a></p><p>1ã€æ ¹æ®è‡ªå·±çš„ç³»ç»Ÿé€‰æ‹©ç›¸åº”çš„ zip åŒ…ï¼š</p><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/8e6590e6d53f442b96f578cd6b78d726~tplv-k3u1fbpfcp-zoom-1.image" alt="image-20220823172254077"></p><p>2ã€è§£å‹å¹¶é…ç½®ç¯å¢ƒå˜é‡</p><p>ä»¥æˆ‘ä¸‹è½½çš„ä¸ºä¾‹ï¼Œè§£å‹åç»“æ„å¦‚ä¸‹ï¼š</p><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/7e9e549beafa401cad0ea26b1dcda3b5~tplv-k3u1fbpfcp-zoom-1.image" alt="image-20220823172812299"></p><p>å¯ä»¥çœ‹åˆ° bin ç›®å½•ä¸‹æœ‰ä¸ª protoc çš„å¯æ‰§è¡Œæ–‡ä»¶ï¼Œæˆ‘ä»¬ç»™å®ƒé…ç½®ä¸€ä¸‹ç¯å¢ƒå˜é‡å°±å¯ä»¥ä½¿ç”¨äº†ï¼Œä»¥æˆ‘çš„ä¸ºä¾‹ï¼š</p><figure class="highlight protobuf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs protobuf"># protobuf ç¯å¢ƒå˜é‡<br>export PROTOBUF_HOME=/Users/zhouying/Downloads/protoc-<span class="hljs-number">3.19</span>.<span class="hljs-number">2</span>-osx-x86_64<br>export PATH=$&#123;PATH&#125;:$&#123;PROTOBUF_HOME&#125;/bin<br></code></pre></td></tr></table></figure><p>3ã€é…ç½®å¥½åï¼Œä½¿ç”¨ protoc â€“version éªŒè¯</p><p>æ‰“å¼€ç»ˆç«¯é”®å…¥ protoc â€“version å‘½ä»¤ï¼š</p><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/4e0b7da1f5d0489884a6e361977c1888~tplv-k3u1fbpfcp-zoom-1.image" alt="image-20220823174015288"></p><p>å¯ä»¥çœ‹åˆ°æ‰“å°å‡ºäº†ç‰ˆæœ¬ï¼Œè¯æ˜æˆ‘ä»¬å®‰è£…æˆåŠŸäº†</p><h3 id="2-2ã€æ–¹å¼äºŒï¼šbrew-å®‰è£…"><a href="#2-2ã€æ–¹å¼äºŒï¼šbrew-å®‰è£…" class="headerlink" title="2.2ã€æ–¹å¼äºŒï¼šbrew å®‰è£…"></a>2.2ã€æ–¹å¼äºŒï¼šbrew å®‰è£…</h3><p>ç›´æ¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å°±å¯ä»¥ä¸€é”®å®‰è£…æˆ–å¸è½½ï¼š</p><figure class="highlight protobuf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs protobuf"><span class="hljs-comment">//ä¸€é”®å®‰è£… protobuf</span><br>brew install protobuf<br><br><span class="hljs-comment">//ä¸€é”®å¸è½½ protobuf</span><br>brew uninstall protobuf<br></code></pre></td></tr></table></figure><p><strong>æ³¨æ„</strong>ï¼šè¿™ç§æ–¹å¼åªé€‚ç”¨äº Mac ç³»ç»Ÿï¼Œè€Œä¸”å®‰è£…çš„ protobuf ä¸ºæœ€æ–°ç‰ˆæœ¬ï¼Œå› æ­¤å¦‚æœæƒ³è¦ä½¿ç”¨æŒ‡å®šçš„ç‰ˆæœ¬ï¼Œå»ºè®®ä½¿ç”¨æ–¹å¼ä¸€</p><h2 id="ä¸‰ã€ä½¿ç”¨-IDE-åˆ›å»º-Protobuf-æ–‡ä»¶"><a href="#ä¸‰ã€ä½¿ç”¨-IDE-åˆ›å»º-Protobuf-æ–‡ä»¶" class="headerlink" title="ä¸‰ã€ä½¿ç”¨ IDE åˆ›å»º Protobuf æ–‡ä»¶"></a>ä¸‰ã€ä½¿ç”¨ IDE åˆ›å»º Protobuf æ–‡ä»¶</h2><p><strong>æ³¨æ„</strong>ï¼šè¿™é‡Œæˆ‘ä½¿ç”¨çš„ IDE æ˜¯ AndroidStudio</p><p>1ã€åˆ›å»ºä¸€ä¸ªä»¥ .proto ä¸ºåç¼€çš„æ–‡ä»¶ï¼Œå¦‚ä¸‹å›¾ï¼š</p><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/b8b17c40fb4545c4ad25fb481a7be618~tplv-k3u1fbpfcp-zoom-1.image" alt="image-20220823192237038"></p><p>å¯ä»¥çœ‹åˆ°è¿™ä¸ªæ–‡ä»¶å‰é¢çš„ icon æ˜¯ä¸ªæ–‡æœ¬ç±»å‹çš„ï¼Œè€Œä¸”ä½ åœ¨ç¼–å†™ä»£ç æ—¶ï¼Œæ²¡æœ‰ä»»ä½•æç¤ºï¼Œå…³é”®å­—ä¹Ÿæ²¡é«˜äº®æ˜¾ç¤ºï¼Œæ­¤æ—¶æˆ‘ä»¬éœ€è¦é›†æˆä¸€ä¸ªæ’ä»¶æ¥æ”¯æŒ Protobuf çš„ç¼–å†™</p><p>2ã€é›†æˆ Protocol Buffers æ’ä»¶</p><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/700811520b5347c994017a72637f2f3b~tplv-k3u1fbpfcp-zoom-1.image" alt="image-20220823192414258"></p><p>å½“æˆ‘ä»¬é›†æˆè¿™ä¸ªæ’ä»¶åï¼Œå¯ä»¥çœ‹åˆ°æ–‡ä»¶ icon å’Œä»£ç é«˜äº®çš„å˜åŒ–ï¼Œè€Œä¸”è¿˜ä¼šæœ‰è¯­æ³•æç¤º</p><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/3a54b01c63be42c1bcd1ad2038c4495b~tplv-k3u1fbpfcp-zoom-1.image" alt="image-20220823192636386"></p><p>okï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å°±å¯ä»¥æ„‰å¿«çš„ç¼–å†™ Protobuf äº†ï¼Œä½†æ˜¯è¦æ€ä¹ˆå†™å‘¢ğŸ˜‚ ï¼Ÿä½ æ˜¯ä¸æ˜¯è¿˜ä¸ä¼š Protobuf çš„è¯­æ³•ï¼Œæ¥ç€å¾€ä¸‹çœ‹</p><h2 id="å››ã€Protobuf-è¯­æ³•åŸºç¡€"><a href="#å››ã€Protobuf-è¯­æ³•åŸºç¡€" class="headerlink" title="å››ã€Protobuf è¯­æ³•åŸºç¡€"></a>å››ã€Protobuf è¯­æ³•åŸºç¡€</h2><p>å…³äº Protobuf çš„è¯­æ³•æœ‰å¾ˆå¤šï¼Œæˆ‘ä»¬è®²ä¸€äº›å¸¸ç”¨çš„</p><h3 id="4-1ã€Protobuf-å¸¸ç”¨å…³é”®å­—ä»‹ç»"><a href="#4-1ã€Protobuf-å¸¸ç”¨å…³é”®å­—ä»‹ç»" class="headerlink" title="4.1ã€Protobuf å¸¸ç”¨å…³é”®å­—ä»‹ç»"></a>4.1ã€Protobuf å¸¸ç”¨å…³é”®å­—ä»‹ç»</h3><table><thead><tr><th>å…³é”®å­—</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>syntax</td><td>æŒ‡å®š Protobuf çš„ç‰ˆæœ¬ï¼ŒProtobuf ç›®å‰æœ‰ proto2 å’Œ proto3 ä¸¤ä¸ªå¸¸ç”¨ç‰ˆæœ¬ï¼Œå¦‚æœæ²¡æœ‰å£°æ˜ï¼Œåˆ™é»˜è®¤æ˜¯proto2</td></tr><tr><td>package</td><td>æŒ‡å®šæ–‡ä»¶åŒ…å</td></tr><tr><td>import</td><td>å¯¼åŒ…ï¼Œå’Œ Java çš„ import ç±»ä¼¼</td></tr><tr><td>message</td><td>å®šä¹‰æ¶ˆæ¯ç±»ï¼Œå’Œ Java çš„ class å…³é”®å­—ç±»ä¼¼ï¼Œæ¶ˆæ¯ç±»ä¹‹é—´å¯ä»¥åµŒå¥—</td></tr><tr><td>repeated</td><td>å®šä¹‰ä¸€ä¸ªé›†åˆï¼Œå’Œ Java çš„é›†åˆç±»ä¼¼</td></tr><tr><td>reserved</td><td>ä¿ç•™å­—æ®µï¼Œå¦‚æœä½¿ç”¨äº†è¿™ä¸ªå…³é”®å­—ä¿®é¥°ï¼Œç”¨æˆ·å°±ä¸èƒ½ä½¿ç”¨è¿™ä¸ªå­—æ®µç¼–å·æˆ–å­—æ®µå</td></tr><tr><td>option</td><td>option å¯ä»¥ç”¨åœ¨ Protobuf çš„ scope ä¸­ï¼Œæˆ–è€… messageã€enumã€service çš„å®šä¹‰ä¸­ï¼ŒProtobuf å®šä¹‰çš„ option æœ‰ java_packageï¼Œjava_outer_classnameï¼Œjava_multiple_files ç­‰ç­‰</td></tr><tr><td>optional</td><td>è¡¨ç¤ºè¯¥å­—æ®µæ˜¯å¯é€‰çš„</td></tr><tr><td>java_package</td><td>æŒ‡å®šç”Ÿæˆç±»æ‰€åœ¨çš„åŒ…åï¼Œéœ€é…åˆ</td></tr><tr><td>java_outer_classname</td><td>å®šä¹‰å½“å‰æ–‡ä»¶çš„ç±»åï¼Œå¦‚æœæ²¡æœ‰å®šä¹‰ï¼Œåˆ™é»˜è®¤ä¸ºæ–‡ä»¶çš„é¦–å­—æ¯å¤§å†™åç§°</td></tr><tr><td>java_multiple_files</td><td>æŒ‡å®šç¼–è¯‘è¿‡å Java çš„æ–‡ä»¶ä¸ªæ•°ï¼Œå¦‚æœæ˜¯ trueï¼Œé‚£ä¹ˆå°†ä¼šä¸€ä¸ª Java å¯¹è±¡ä¸€ä¸ªç±»ï¼Œå¦‚æœæ˜¯ falseï¼Œé‚£ä¹ˆå®šä¹‰çš„Java å¯¹è±¡å°†ä¼šè¢«åŒ…å«åœ¨åŒä¸€ä¸ªæ–‡ä»¶ä¸­</td></tr></tbody></table><p><strong>æ³¨æ„</strong>ï¼šåœ¨ Proto3 ä¸­ä¸æ”¯æŒ required (å¿…é¡»)å­—æ®µ</p><h3 id="4-2ã€Protobuf-åŸºæœ¬æ•°æ®ç±»å‹"><a href="#4-2ã€Protobuf-åŸºæœ¬æ•°æ®ç±»å‹" class="headerlink" title="4.2ã€Protobuf åŸºæœ¬æ•°æ®ç±»å‹"></a>4.2ã€Protobuf åŸºæœ¬æ•°æ®ç±»å‹</h3><table><thead><tr><th align="left">Protobuf Type</th><th>è¯´æ˜</th><th align="left">å¯¹åº” Java&#x2F;Kotlin Type</th></tr></thead><tbody><tr><td align="left">double</td><td>å›ºå®š 8 å­—èŠ‚é•¿åº¦</td><td align="left">double</td></tr><tr><td align="left">float</td><td>å›ºå®š 4 å­—èŠ‚é•¿åº¦</td><td align="left">float</td></tr><tr><td align="left">int32</td><td>å¯å˜é•¿åº¦ç¼–ç ï¼Œå¯¹è´Ÿæ•°ç¼–ç ä½æ•ˆï¼Œå¦‚æœå­—æ®µå¯èƒ½ä¸ºè´Ÿæ•°ï¼Œç”¨ sint32 ä»£æ›¿</td><td align="left">int</td></tr><tr><td align="left">int64</td><td>å¯å˜é•¿åº¦ç¼–ç ï¼Œå¯¹è´Ÿæ•°ç¼–ç ä½æ•ˆï¼Œå¦‚æœå­—æ®µå¯èƒ½ä¸ºè´Ÿæ•°ï¼Œç”¨ sint64 ä»£æ›¿</td><td align="left">long</td></tr><tr><td align="left">uint32</td><td>å¯å˜é•¿åº¦ç¼–ç ï¼Œæ— ç¬¦å·æ•´æ•°</td><td align="left">int</td></tr><tr><td align="left">uint64</td><td>å¯å˜é•¿åº¦ç¼–ç ï¼Œæ— ç¬¦å·æ•´æ•°</td><td align="left">long</td></tr><tr><td align="left">sint32</td><td>å¯å˜é•¿åº¦ç¼–ç ï¼Œæœ‰ç¬¦å·æ•´æ•°</td><td align="left">int</td></tr><tr><td align="left">sint64</td><td>å¯å˜é•¿åº¦ç¼–ç ï¼Œæœ‰ç¬¦å·æ•´æ•°</td><td align="left">long</td></tr><tr><td align="left">fixed32</td><td>å›ºå®š 4 å­—èŠ‚é•¿åº¦ï¼Œæ— ç¬¦å·æ•´æ•°</td><td align="left">int</td></tr><tr><td align="left">fixed64</td><td>å›ºå®š 8 å­—èŠ‚é•¿åº¦ï¼Œæ— ç¬¦å·æ•´æ•°</td><td align="left">long</td></tr><tr><td align="left">sfixed32</td><td>å›ºå®š 4 å­—èŠ‚é•¿åº¦ï¼Œæœ‰ç¬¦å·æ•´æ•°</td><td align="left">int</td></tr><tr><td align="left">sfixed64</td><td>å›ºå®š 8 å­—èŠ‚é•¿åº¦ï¼Œæœ‰ç¬¦å·æ•´æ•°</td><td align="left">long</td></tr><tr><td align="left">bool</td><td>å¸ƒå°”ç±»å‹ï¼Œå€¼ä¸º true æˆ– false</td><td align="left">boolean</td></tr><tr><td align="left">string</td><td>å­—ç¬¦ä¸²ç±»å‹</td><td align="left">String</td></tr></tbody></table><p>å¯å˜é•¿åº¦ç¼–ç å’Œå›ºå®šé•¿åº¦ç¼–ç åŒºåˆ«ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//ä¾‹å¦‚è¯´æˆ‘åœ¨ Java é‡Œé¢è¿›è¡Œå¦‚ä¸‹å®šä¹‰ï¼š</span><br><span class="hljs-type">int</span> <span class="hljs-variable">a</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;<br><span class="hljs-comment">//å› ä¸º int ç±»å‹å  4 ä¸ªå­—èŠ‚ï¼Œ1ä¸ªå­—èŠ‚å  8 ä½ï¼Œæˆ‘ä»¬æŠŠ 1 çš„å­—èŠ‚å ä½ç»™åˆ—å‡ºæ¥ï¼š</span><br><span class="hljs-number">00000000</span> <span class="hljs-number">00000000</span> <span class="hljs-number">00000000</span> <span class="hljs-number">00000001</span><br><span class="hljs-comment">//å¯ä»¥çœ‹åˆ° 1 çš„å‰é¢ 3 ä¸ªå­—èŠ‚å ä½éƒ½æ˜¯ 0ï¼Œåœ¨ Protobuf é‡Œé¢æ˜¯å¯ä»¥å»æ‰çš„ï¼Œäºæ˜¯å°±å˜æˆäº†ï¼š</span><br><span class="hljs-number">00000001</span><br><span class="hljs-comment">//å› æ­¤ 1 åœ¨ Protobuf é‡Œé¢å°±åªå ç”¨äº†ä¸€ä¸ªå­—èŠ‚ï¼ŒèŠ‚çœäº†ç©ºé—´</span><br></code></pre></td></tr></table></figure><p>ä¸Šé¢è¿™ç§å°±æ˜¯å¯å˜é•¿åº¦ç¼–ç ã€‚è€Œå›ºå®šé•¿åº¦ç¼–ç å°±æ˜¯å³ä½¿å‰é¢çš„å­—èŠ‚å ä½æ˜¯ 0ï¼Œä¹Ÿä¸èƒ½å»æ‰ï¼Œæˆ‘å°±æ˜¯è¦å è¿™ä¹ˆå¤šå­—èŠ‚</p><h4 id="4-2-1ã€åŸºæœ¬æ•°æ®ç±»å‹é»˜è®¤å€¼"><a href="#4-2-1ã€åŸºæœ¬æ•°æ®ç±»å‹é»˜è®¤å€¼" class="headerlink" title="4.2.1ã€åŸºæœ¬æ•°æ®ç±»å‹é»˜è®¤å€¼"></a>4.2.1ã€åŸºæœ¬æ•°æ®ç±»å‹é»˜è®¤å€¼</h4><table><thead><tr><th>ç±»å‹</th><th>é»˜è®¤å€¼</th></tr></thead><tbody><tr><td>æ•°å€¼ç±»å‹</td><td>0</td></tr><tr><td>bool</td><td>false</td></tr><tr><td>string</td><td>ç©ºå­—ç¬¦ä¸²</td></tr><tr><td>enum</td><td>é»˜è®¤ä¸ºç¬¬ä¸€ä¸ªå…ƒç´ </td></tr></tbody></table><h3 id="4-3ã€æ¶ˆæ¯ç±»å‹å®šä¹‰"><a href="#4-3ã€æ¶ˆæ¯ç±»å‹å®šä¹‰" class="headerlink" title="4.3ã€æ¶ˆæ¯ç±»å‹å®šä¹‰"></a>4.3ã€æ¶ˆæ¯ç±»å‹å®šä¹‰</h3><p>åœ¨ä¸Šé¢åˆ›å»ºçš„ Protobuf æ–‡ä»¶ä¸­ï¼Œå®šä¹‰ä¸€ä¸ªå­¦ç”Ÿï¼Œå­¦ç”Ÿæœ‰å§“åï¼Œå¹´é¾„ï¼Œé‚®ç®±å’Œè¯¾ç¨‹ï¼Œæˆ‘ä»¬æ¥å®ç°ä¸€ä¸‹å®ƒï¼š</p><figure class="highlight protobuf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs protobuf"><span class="hljs-comment">//æŒ‡å®š Protobuf ç‰ˆæœ¬</span><br>syntax = <span class="hljs-string">&quot;proto3&quot;</span>;<br><br><span class="hljs-comment">//æŒ‡å®šåŒ…å</span><br><span class="hljs-keyword">package</span> erdai;<br><br><span class="hljs-comment">//å®šä¹‰ä¸€ä¸ªå­¦ç”Ÿçš„æ¶ˆæ¯ç±»</span><br><span class="hljs-keyword">message </span><span class="hljs-title class_">Student</span>&#123;<br>  <span class="hljs-comment">//å§“å</span><br>  <span class="hljs-type">string</span> name = <span class="hljs-number">1</span>;<br>  <span class="hljs-comment">//å¹´é¾„</span><br>  <span class="hljs-type">int32</span> age = <span class="hljs-number">2</span>;<br>  <span class="hljs-comment">//é‚®ç®±</span><br>  <span class="hljs-type">string</span> email = <span class="hljs-number">3</span>;<br>  <span class="hljs-comment">//è¯¾ç¨‹</span><br>  <span class="hljs-keyword">repeated</span> <span class="hljs-type">string</span> course = <span class="hljs-number">4</span>; <span class="hljs-comment">//ç›¸å½“äº Java çš„ List&lt;String&gt;</span><br>&#125;<br></code></pre></td></tr></table></figure><p><strong>æ³¨æ„</strong>ï¼š</p><p>1ã€ä¸€ä¸ª Protobuf æ–‡ä»¶é‡Œé¢å¯ä»¥æ·»åŠ å¤šä¸ªæ¶ˆæ¯ç±»ï¼Œä¹Ÿå¯ä»¥è¿›è¡ŒåµŒå¥—</p><p>2ã€ä¸Šé¢çš„ 1ï¼Œ2ï¼Œ3ï¼Œ4 å¹¶ä¸æ˜¯ç»™å­—æ®µèµ‹å€¼ï¼Œè€Œæ˜¯ç»™æ¯ä¸ªå­—æ®µå®šä¹‰ä¸€ä¸ªå”¯ä¸€çš„ç¼–å·ã€‚è¿™äº›ç¼–å·ç”¨äºäºŒè¿›åˆ¶æ ¼å¼ä¸­æ ‡è¯†ä½ çš„å­—æ®µï¼Œå¹¶ä¸”åœ¨ä½¿ç”¨ä½ çš„æ¶ˆæ¯ç±»å‹åä¸åº”æ›´æ”¹</p><p>3ã€1-15 çš„å­—æ®µç¼–å·åªå ä¸€ä¸ªå­—èŠ‚è¿›è¡Œç¼–ç ï¼Œ16-2047 çš„å­—æ®µç¼–å·å ä¸¤ä¸ªå­—èŠ‚ï¼ŒåŒ…æ‹¬å­—æ®µç¼–å·å’Œå­—æ®µç±»å‹ï¼Œå› æ­¤å»ºè®®æ›´å¤šçš„ä½¿ç”¨ 1-15 çš„å­—æ®µç¼–å·</p><p>4ã€å¯ä»¥æŒ‡å®šæœ€å°å­—æ®µç¼–å·ä¸º 1ï¼Œæœ€å¤§å­—æ®µç¼–å·ä¸º 2^29 - 1 æˆ– 536870911ã€‚å¦å¤–ä¸èƒ½ä½¿ç”¨ 19000-19999 çš„æ ‡è¯†å·ï¼Œå› ä¸º protobuf åè®®å®ç°å¯¹è¿™äº›è¿›è¡Œäº†é¢„ç•™ï¼ŒåŒæ ·ï¼Œä¹Ÿä¸èƒ½ä½¿ç”¨ä»»ä½•ä»¥å‰ä¿ç•™ï¼ˆreservedï¼‰ çš„å­—æ®µç¼–å·</p><h3 id="4-4ã€Protobuf-æšä¸¾ç±»å‹"><a href="#4-4ã€Protobuf-æšä¸¾ç±»å‹" class="headerlink" title="4.4ã€Protobuf æšä¸¾ç±»å‹"></a>4.4ã€Protobuf æšä¸¾ç±»å‹</h3><figure class="highlight protobuf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs protobuf"><span class="hljs-keyword">message </span><span class="hljs-title class_">Weather</span>&#123;<br>  <span class="hljs-type">int32</span> query = <span class="hljs-number">1</span>;<br><br>  <span class="hljs-comment">//å­£èŠ‚</span><br>  <span class="hljs-keyword">enum </span><span class="hljs-title class_">Season</span>&#123;<br>    <span class="hljs-comment">//å…è®¸å¯¹æšä¸¾å¸¸é‡è®¾ç½®åˆ«å</span><br>    <span class="hljs-keyword">option</span> allow_alias = <span class="hljs-literal">true</span>;<br>    <span class="hljs-comment">//æšä¸¾é‡Œé¢çš„ = æ“ä½œæ˜¯å¯¹å¸¸é‡è¿›è¡Œèµ‹å€¼æ“ä½œ</span><br>    <span class="hljs-comment">//æ˜¥</span><br>    SPRING = <span class="hljs-number">0</span>;<br>    <span class="hljs-comment">//å¤</span><br>    SUMMER = <span class="hljs-number">1</span>;<br>    <span class="hljs-comment">//ç§‹ å¦‚æœä¸è®¾ç½®åˆ«åï¼Œä¸å…è®¸å­˜åœ¨ä¸¤ä¸ªç›¸åŒçš„å€¼</span><br>    FALL = <span class="hljs-number">2</span>;<br>    AUTUMN = <span class="hljs-number">2</span>;<br>    <span class="hljs-comment">//å†¬</span><br>    WINTER = <span class="hljs-number">3</span>;<br>  &#125;<br><br>  <span class="hljs-comment">//å¯¹ season è¿›è¡Œç¼–å·</span><br>  Season season = <span class="hljs-number">2</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>1ã€å®šä¹‰æšä¸¾ç±»å‹ä½¿ç”¨ enum å…³é”®å­—</p><p>2ã€æšä¸¾ç±»å‹ç¬¬ä¸€ä¸ªå­—æ®µçš„å€¼ä¸ºå¿…é¡» 0ï¼Œå¦åˆ™ç¼–è¯‘ä¼šæŠ¥é”™</p><p>3ã€æšä¸¾å¸¸é‡å€¼å¿…é¡»åœ¨ 32 ä½æ•´å‹å€¼çš„èŒƒå›´å†…ã€‚å› ä¸º enum å€¼æ˜¯ä½¿ç”¨å¯å˜ç¼–ç æ–¹å¼çš„ï¼Œå¯¹è´Ÿæ•°ä¸å¤Ÿé«˜æ•ˆï¼Œå› æ­¤ä¸æ¨èåœ¨ enum ä¸­ä½¿ç”¨è´Ÿæ•°</p><p>4ã€æšä¸¾é‡Œé¢çš„ &#x3D; æ“ä½œæ˜¯å¯¹å¸¸é‡è¿›è¡Œèµ‹å€¼æ“ä½œï¼Œè€Œæšä¸¾å¤–é¢çš„ &#x3D; åˆ™æ˜¯å¯¹å½“å‰å­—æ®µè¿›è¡Œç¼–å·</p><h3 id="4-5ã€Protobuf-é›†åˆ"><a href="#4-5ã€Protobuf-é›†åˆ" class="headerlink" title="4.5ã€Protobuf é›†åˆ"></a>4.5ã€Protobuf é›†åˆ</h3><figure class="highlight protobuf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs protobuf"><span class="hljs-keyword">repeated</span> <span class="hljs-type">string</span> list = <span class="hljs-number">1</span>; <span class="hljs-comment">//ç±»ä¼¼ Java çš„ List&lt;String&gt;</span><br><br>map&lt;<span class="hljs-type">string</span>,<span class="hljs-type">string</span>&gt; = <span class="hljs-number">2</span>; <span class="hljs-comment">//ç±»ä¼¼ Java çš„ Map&lt;String,String&gt;</span><br></code></pre></td></tr></table></figure><p>1ã€Protobuf ä¸­å®šä¹‰é›†åˆï¼Œå°±æ˜¯åœ¨ä½ å®šä¹‰å¥½çš„å±æ€§å‰é¢åŠ  repeated å…³é”®å­—</p><p>2ã€Protobuf ä¸­å®šä¹‰ map å’Œ Java ç±»ä¼¼ï¼Œåªä¸è¿‡ map æ˜¯å°å†™çš„</p><h3 id="4-6ã€reserved-ä¿ç•™å­—æ®µ"><a href="#4-6ã€reserved-ä¿ç•™å­—æ®µ" class="headerlink" title="4.6ã€reserved ä¿ç•™å­—æ®µ"></a>4.6ã€reserved ä¿ç•™å­—æ®µ</h3><p>å½“æˆ‘ä»¬ä½¿ç”¨ reserved å…³é”®å­—æŒ‡å®šä¸€ä¸ªå­—æ®µç¼–å·æˆ–å­—æ®µåä¸ºä¿ç•™å­—æ®µåï¼Œæˆ‘ä»¬å°±ä¸èƒ½å»ä½¿ç”¨å®ƒï¼Œå¦åˆ™ç¼–è¯‘å™¨ä¼šæŠ¥é”™ï¼Œå¦‚ä¸‹ï¼š</p><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/345fc00ef64c48638750c2de5a2d7b0f~tplv-k3u1fbpfcp-zoom-1.image" alt="image-20220824165406735"></p><p>okï¼Œç®€å•çš„ä»‹ç»äº† Protobuf è¯­æ³•åï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬ä½¿ç”¨ AndroidStudio å°† Protobuf æ–‡ä»¶è½¬æ¢ä¸ºå¯¹åº”çš„ Java æ–‡ä»¶æ¥è¿›è¡Œå¼€å‘</p><h2 id="äº”ã€Protobuf-è½¬-Java-æ–‡ä»¶"><a href="#äº”ã€Protobuf-è½¬-Java-æ–‡ä»¶" class="headerlink" title="äº”ã€Protobuf è½¬ Java æ–‡ä»¶"></a>äº”ã€Protobuf è½¬ Java æ–‡ä»¶</h2><p>é¦–å…ˆæˆ‘ä»¬è¦æ˜ç™½ä¸€ç‚¹ï¼šProtobuf æ˜¯ä¸€ç§ä¸å¹³å°ï¼Œè¯­è¨€æ— å…³çš„æ•°æ®å­˜å‚¨æ ¼å¼ï¼Œå› æ­¤æˆ‘ä»¬è¦åœ¨å…¶å®ƒè¯­è¨€å¦‚ï¼šJavaï¼ŒKotlinï¼ŒDart ç­‰è¯­è¨€ä¸­ä½¿ç”¨å®ƒï¼Œåˆ™å¿…é¡»å°† Protobuf æ–‡ä»¶è½¬æ¢ä¸ºå¯¹åº”å¹³å°çš„è¯­è¨€æ–‡ä»¶å»ä½¿ç”¨ï¼Œè¿™é‡Œæˆ‘ä»¬ä»¥è½¬ Java æ–‡ä»¶ä¸ºä¾‹ï¼Œä»‹ç»ä¸¤ç§è½¬æ¢çš„æ–¹å¼ï¼š</p><p>1ã€é›†æˆ Protobuf æ’ä»¶è½¬æ¢</p><p>2ã€ä½¿ç”¨ protoc å‘½ä»¤è¡Œè½¬æ¢</p><p>åœ¨ä½¿ç”¨è¿™ä¸¤ç§æ–¹å¼è½¬æ¢å‰ï¼Œæˆ‘ä»¬éœ€è¦å…ˆé›†æˆ protobuf-java è¿™ä¸ªç¬¬ä¸‰æ–¹åº“ï¼Œå› ä¸ºæˆ‘ä»¬è½¬æ¢çš„ Java æ–‡ä»¶ä¸­ä¼šä½¿ç”¨è¿™ä¸ªåº“é‡Œé¢çš„åŠŸèƒ½</p><figure class="highlight protobuf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs protobuf">implementation &#x27;com.google.protobuf:protobuf-java:<span class="hljs-number">3.19</span>.<span class="hljs-number">2</span>&#x27;<br></code></pre></td></tr></table></figure><p>æœ€æ–°ç‰ˆæœ¬å¯æŸ¥çœ‹æ­¤é“¾æ¥ï¼š<a href="https://github.com/protocolbuffers/protobuf/tree/main/java">https://github.com/protocolbuffers/protobuf/tree/main/java</a></p><h3 id="5-1ã€é›†æˆ-Protobuf-æ’ä»¶è½¬æ¢"><a href="#5-1ã€é›†æˆ-Protobuf-æ’ä»¶è½¬æ¢" class="headerlink" title="5.1ã€é›†æˆ Protobuf æ’ä»¶è½¬æ¢"></a>5.1ã€é›†æˆ Protobuf æ’ä»¶è½¬æ¢</h3><p>æ’ä»¶é“¾æ¥ï¼š<a href="https://github.com/google/protobuf-gradle-plugin">https://github.com/google/protobuf-gradle-plugin</a></p><p>1ã€åœ¨é¡¹ç›®çš„æ ¹ build.gradle æ–‡ä»¶ä¸­ï¼Œæ·»åŠ å¦‚ä¸‹ä¾èµ–ï¼š</p><figure class="highlight protobuf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs protobuf">buildscript &#123;<br>    repositories &#123;<br>        gradlePluginPortal()<br>    &#125;<br>    dependencies &#123;<br>        classpath &#x27;com.google.protobuf:protobuf-gradle-plugin:<span class="hljs-number">0.8</span>.<span class="hljs-number">19</span>&#x27;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>2ã€åœ¨ app çš„ build.gradle æ–‡ä»¶ä¸­åº”ç”¨æ’ä»¶</p><figure class="highlight protobuf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs protobuf"><span class="hljs-comment">//1ã€å¦‚æœä½¿ç”¨çš„æ˜¯ apply æ–¹å¼ï¼ŒAndroid æ’ä»¶å¿…é¡»åœ¨ Protobuf æ’ä»¶ä¹‹å‰ï¼Œå¦‚ä¸‹ï¼š</span><br>apply plugin: &#x27;com.android.application&#x27;<br>apply plugin: &#x27;com.google.protobuf&#x27;<br><br><span class="hljs-comment">//2ã€å¦‚æœä½¿ç”¨çš„æ˜¯ Gradle DSL æ–¹å¼ï¼Œåˆ™ä¸é¡ºåºæ— å…³</span><br>plugins &#123;<br>    id &#x27;com.google.protobuf&#x27;<br>    id &#x27;com.android.application&#x27;<br>&#125;<br></code></pre></td></tr></table></figure><p>3ã€åœ¨ app çš„ build.gradle æ–‡ä»¶ä¸­é…ç½® protobuf ç¼–è¯‘ä»»åŠ¡</p><figure class="highlight protobuf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs protobuf">android &#123;<br>    <span class="hljs-comment">//...</span><br>&#125;<br><br>protobuf &#123;<br>    <span class="hljs-comment">//é…ç½® protoc ç¼–è¯‘å™¨</span><br>    protoc &#123;<br>        artifact = &#x27;com.google.protobuf:protoc:<span class="hljs-number">3.19</span>.<span class="hljs-number">2</span>&#x27;<br>    &#125;<br>    <span class="hljs-comment">//é…ç½®ç”Ÿæˆç›®å½•ï¼Œç¼–è¯‘åä¼šåœ¨ build çš„ç›®å½•ä¸‹ç”Ÿæˆå¯¹åº”çš„javaæ–‡ä»¶</span><br>    generateProtoTasks &#123;<br>        all().each &#123; task -&gt;<br>            task.builtins &#123;<br>                remove java<br>            &#125;<br>            task.builtins &#123;<br>                java &#123;&#125;<br>            &#125;<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>4ã€æŒ‡å®š protobuf æ–‡ä»¶æ‰€åœ¨è·¯å¾„</p><figure class="highlight protobuf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs protobuf">android &#123;<br>    <span class="hljs-comment">//...</span><br><br>    sourceSets &#123;<br>        main &#123;<br>            <span class="hljs-comment">//å®é™…æµ‹è¯•æŒ‡ä¸æŒ‡å®šæ— æ‰€è°“ï¼Œä¸å½±å“ Java æ–‡ä»¶ç”Ÿæˆ</span><br>            proto &#123;<br>                srcDir &#x27;src/main/proto&#x27;<br>            &#125;<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ç»è¿‡ä¸Šé¢ 4 æ­¥ï¼Œæˆ‘ä»¬çš„æ’ä»¶å°±ç®—é…ç½®å®Œæˆäº†ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬æµ‹è¯•ä¸€ä¸‹</p><p>5ã€é‡æ–°ç¼–è¯‘é¡¹ç›®</p><p>ä»¥æˆ‘ä»¬ä¸Šé¢é‚£ä¸ª student.proto ä¸ºä¾‹ï¼Œé‡Œé¢çš„å†…å®¹å¦‚ä¸‹ï¼š</p><figure class="highlight protobuf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs protobuf"><span class="hljs-comment">//æŒ‡å®š Protobuf ç‰ˆæœ¬</span><br>syntax = <span class="hljs-string">&quot;proto3&quot;</span>;<br><br><span class="hljs-comment">//æŒ‡å®šåŒ…å</span><br><span class="hljs-keyword">package</span> erdai;<br><br><span class="hljs-comment">//å®šä¹‰ä¸€ä¸ªå­¦ç”Ÿçš„æ¶ˆæ¯ç±»</span><br><span class="hljs-keyword">message </span><span class="hljs-title class_">Student</span>&#123;<br>  <span class="hljs-comment">//å§“å</span><br>  <span class="hljs-type">string</span> name = <span class="hljs-number">1</span>;<br>  <span class="hljs-comment">//å¹´é¾„</span><br>  <span class="hljs-type">int32</span> age = <span class="hljs-number">2</span>;<br>  <span class="hljs-comment">//é‚®ç®±</span><br>  <span class="hljs-type">string</span> email = <span class="hljs-number">3</span>;<br>  <span class="hljs-comment">//è¯¾ç¨‹</span><br>  <span class="hljs-keyword">repeated</span> <span class="hljs-type">string</span> course = <span class="hljs-number">4</span>;<br><br>&#125;<br><br><span class="hljs-comment">//å®šä¹‰ä¸€ä¸ªå¤©æ°”çš„æ¶ˆæ¯ç±»</span><br><span class="hljs-keyword">message </span><span class="hljs-title class_">Weather</span>&#123;<br>  <span class="hljs-type">int32</span> query = <span class="hljs-number">1</span>;<br><br>  <span class="hljs-comment">//å­£èŠ‚</span><br>  <span class="hljs-keyword">enum </span><span class="hljs-title class_">Season</span>&#123;<br>    <span class="hljs-keyword">option</span> allow_alias = <span class="hljs-literal">true</span>;<br>    <span class="hljs-comment">//æ˜¥</span><br>    SPRING = <span class="hljs-number">0</span>;<br>    <span class="hljs-comment">//å¤</span><br>    SUMMER = <span class="hljs-number">1</span>;<br>    <span class="hljs-comment">//ç§‹</span><br>    FALL = <span class="hljs-number">2</span>;<br>    AUTUMN = <span class="hljs-number">2</span>;<br>    <span class="hljs-comment">//å†¬</span><br>    WINTER = <span class="hljs-number">3</span>;<br>  &#125;<br><br>  Season season = <span class="hljs-number">2</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>ç¼–è¯‘åï¼Œä¼šåœ¨ app&#x2F;build&#x2F;generated&#x2F;source&#x2F;proto&#x2F; ç›®å½•ä¸‹ç”Ÿæˆå¦‚ä¸‹æ–‡ä»¶ï¼š</p><p><img src="https://raw.githubusercontent.com/sweetying520/picgo/master/img/202208241633803.png" alt="image-20220824110842489"></p><p>è¿™ç§æ–¹å¼ä¼šè‡ªåŠ¨ç»™æˆ‘ä»¬ç”Ÿæˆå¯¹åº”çš„ Java ç±»ï¼Œå°±æ˜¯é›†æˆçš„æ—¶å€™éº»çƒ¦ä¸€ç‚¹</p><h3 id="5-2ã€ä½¿ç”¨-protoc-å‘½ä»¤è¡Œè½¬æ¢"><a href="#5-2ã€ä½¿ç”¨-protoc-å‘½ä»¤è¡Œè½¬æ¢" class="headerlink" title="5.2ã€ä½¿ç”¨ protoc å‘½ä»¤è¡Œè½¬æ¢"></a>5.2ã€ä½¿ç”¨ protoc å‘½ä»¤è¡Œè½¬æ¢</h3><p>æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java">protoc --java_out=$&#123;<span class="hljs-string">&quot;ä½ è¦ç”Ÿæˆçš„ Java æ–‡ä»¶ç›®å½•&quot;</span>&#125; $&#123;<span class="hljs-string">&quot;Protobuf æ–‡ä»¶ä½ç½®&quot;</span>&#125;<br><br><span class="hljs-comment">//ä»¥æˆ‘çš„ä¸ºä¾‹ï¼š</span><br>protoc --java_out=./app/src/main/java ./app/src/main/proto/student.proto<br></code></pre></td></tr></table></figure><p>ç”Ÿæˆçš„æ–‡ä»¶ï¼š</p><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/9d84f8aace4f4fa2a3bc04b6465d5e9c~tplv-k3u1fbpfcp-zoom-1.image" alt="image-20220824112730091"></p><p>è¿™ç§æ–¹å¼çš„ä¼˜ç‚¹æ˜¯ä½¿ç”¨éå¸¸ç®€å•ï¼Œä½†æ˜¯æ¯ä¸€æ¬¡åˆ›å»ºæ–°çš„ Protobuf æ–‡ä»¶éƒ½éœ€è¦æ‰§è¡Œä¸€ä¸‹å‘½ä»¤</p><h3 id="5-3ã€ç”Ÿæˆçš„-Java-æ–‡ä»¶ä»‹ç»"><a href="#5-3ã€ç”Ÿæˆçš„-Java-æ–‡ä»¶ä»‹ç»" class="headerlink" title="5.3ã€ç”Ÿæˆçš„ Java æ–‡ä»¶ä»‹ç»"></a>5.3ã€ç”Ÿæˆçš„ Java æ–‡ä»¶ä»‹ç»</h3><p>å…³äºè¿™ä¸ªç±»çš„å†…å®¹ç®€å•ä»‹ç»ä¸‹ï¼Œå¤§å®¶ä¹Ÿå¯ä»¥ç”Ÿæˆåè‡ªè¡Œçœ‹æºç ï¼Œå¦‚ä¸‹å›¾ï¼š</p><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/33a15c47616b447191f4f468e4e6d284~tplv-k3u1fbpfcp-zoom-1.image" alt="image-20220824143229899"></p><p>1ã€ç”Ÿæˆçš„ç±» StudentOuterClass æœ‰ 4 ä¸ªå­ç±»ï¼š</p><blockquote><p>Student ï¼ˆå®ç°äº† StudentOrBuilder æ¥å£ï¼‰</p><p>Weather ï¼ˆå®ç°äº† WeatherOrBuilder æ¥å£ï¼‰</p><p>StudentOrBuilder ï¼ˆæ¥å£ï¼‰</p><p>WeatherOrBuilder ï¼ˆæ¥å£ï¼‰</p></blockquote><p>2ã€Student æ˜¯ StudentOuterClass çš„é™æ€å†…éƒ¨ç±»ï¼Œæ„é€ æ–¹æ³•ç§æœ‰åŒ–ï¼Œéœ€é€šè¿‡ Builder æ¨¡å¼åˆ›å»ºå¯¹è±¡ã€‚å¦å¤– Student æä¾›äº†å±æ€§çš„ get æ–¹æ³•ï¼Œæ—  set æ–¹æ³•ï¼ŒBuilder ä½œä¸º Student çš„é™æ€å†…éƒ¨ç±»æä¾›äº†å±æ€§çš„ getï¼Œsetï¼Œclearæ–¹æ³•ï¼Œclear å°±æ˜¯æ¸…ç©ºæŸä¸ªå±æ€§å›åˆ°åˆå§‹å€¼</p><p>3ã€Weather åŒ 2</p><h2 id="å…­ã€Protobuf-ä½¿ç”¨"><a href="#å…­ã€Protobuf-ä½¿ç”¨" class="headerlink" title="å…­ã€Protobuf ä½¿ç”¨"></a>å…­ã€Protobuf ä½¿ç”¨</h2><p>æ¥ä¸‹æ¥æˆ‘ä»¬å¯¹åˆšæ‰ç”Ÿæˆçš„ Java ç±»è¿›è¡Œä½¿ç”¨</p><h3 id="6-1ã€åŸºæœ¬è°ƒç”¨"><a href="#6-1ã€åŸºæœ¬è°ƒç”¨" class="headerlink" title="6.1ã€åŸºæœ¬è°ƒç”¨"></a>6.1ã€åŸºæœ¬è°ƒç”¨</h3><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span>&#123;<br>    <span class="hljs-comment">//æ„å»º Protobuf å¯¹è±¡</span><br>    <span class="hljs-keyword">val</span> student = StudentOuterClass.Student.newBuilder()<br>        .setName(<span class="hljs-string">&quot;erdai&quot;</span>)<br>        .setAge(<span class="hljs-number">18</span>)<br>        .setEmail(<span class="hljs-string">&quot;erdai666@qq.com&quot;</span>)<br>        .addAllCourse(mutableListOf(<span class="hljs-string">&quot;Math&quot;</span>, <span class="hljs-string">&quot;English&quot;</span>, <span class="hljs-string">&quot;Computer&quot;</span>))<br>        .build()<br>    println(student)<br>    println()<br>    println(StudentOuterClass.Weather.Season.SPRING.number)<br>    println(StudentOuterClass.Weather.Season.SUMMER.number)<br>    println(StudentOuterClass.Weather.Season.AUTUMN.number)<br>    println(StudentOuterClass.Weather.Season.WINTER.number)<br>&#125;<br><br><span class="hljs-comment">//æ‰“å°ç»“æœ</span><br>name: <span class="hljs-string">&quot;erdai&quot;</span><br>age: <span class="hljs-number">18</span><br>email: <span class="hljs-string">&quot;erdai666@qq.com&quot;</span><br>course: <span class="hljs-string">&quot;Math&quot;</span><br>course: <span class="hljs-string">&quot;English&quot;</span><br>course: <span class="hljs-string">&quot;Computer&quot;</span><br><br><br><span class="hljs-number">0</span><br><span class="hljs-number">1</span><br><span class="hljs-number">2</span><br><span class="hljs-number">3</span><br></code></pre></td></tr></table></figure><h3 id="6-2ã€åºåˆ—åŒ–å’Œååºåˆ—åŒ–"><a href="#6-2ã€åºåˆ—åŒ–å’Œååºåˆ—åŒ–" class="headerlink" title="6.2ã€åºåˆ—åŒ–å’Œååºåˆ—åŒ–"></a>6.2ã€åºåˆ—åŒ–å’Œååºåˆ—åŒ–</h3><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span>&#123;<br>    <span class="hljs-comment">//1ã€æ„å»º Protobuf å¯¹è±¡</span><br>    <span class="hljs-keyword">val</span> student = StudentOuterClass.Student.newBuilder()<br>        .setName(<span class="hljs-string">&quot;erdai&quot;</span>)<br>        .setAge(<span class="hljs-number">18</span>)<br>        .setEmail(<span class="hljs-string">&quot;erdai666@qq.com&quot;</span>)<br>        .addAllCourse(mutableListOf(<span class="hljs-string">&quot;Math&quot;</span>, <span class="hljs-string">&quot;English&quot;</span>, <span class="hljs-string">&quot;Computer&quot;</span>))<br>        .build()<br>    <span class="hljs-comment">//2ã€åºåˆ—åŒ–å¹¶è¿”å›ä¸€ä¸ªåŒ…å«å…¶åŸå§‹å­—èŠ‚çš„å­—èŠ‚æ•°ç»„</span><br>    <span class="hljs-keyword">val</span> byteArray: ByteArray = student.toByteArray()<br>    <span class="hljs-comment">//3ã€ååºåˆ—åŒ–ä»å­—èŠ‚æ•°ç»„ä¸­è§£ææ¶ˆæ¯</span><br>    <span class="hljs-keyword">val</span> parseStudent: StudentOuterClass.Student = StudentOuterClass.Student.parseFrom(byteArray)<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="ä¸ƒã€Protobuf-å’Œ-Json-ç›¸äº’è½¬æ¢"><a href="#ä¸ƒã€Protobuf-å’Œ-Json-ç›¸äº’è½¬æ¢" class="headerlink" title="ä¸ƒã€Protobuf å’Œ Json ç›¸äº’è½¬æ¢"></a>ä¸ƒã€Protobuf å’Œ Json ç›¸äº’è½¬æ¢</h2><p>é¦–å…ˆæˆ‘ä»¬éœ€è¦æ·»åŠ ä¸€ä¸ªç¬¬ä¸‰æ–¹ä¾èµ–ï¼š</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs kotlin">implementation <span class="hljs-string">&#x27;com.google.protobuf:protobuf-java-util:3.19.2&#x27;</span><br></code></pre></td></tr></table></figure><h3 id="7-1ã€Protobuf-è½¬-Json"><a href="#7-1ã€Protobuf-è½¬-Json" class="headerlink" title="7.1ã€Protobuf è½¬ Json"></a>7.1ã€Protobuf è½¬ Json</h3><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span>&#123;<br>    <span class="hljs-comment">//1ã€æ„å»º Protobuf å¯¹è±¡</span><br>    <span class="hljs-keyword">val</span> student = StudentOuterClass.Student.newBuilder()<br>        .setName(<span class="hljs-string">&quot;erdai&quot;</span>)<br>        .setAge(<span class="hljs-number">18</span>)<br>        .setEmail(<span class="hljs-string">&quot;erdai666@qq.com&quot;</span>)<br>        .addAllCourse(mutableListOf(<span class="hljs-string">&quot;Math&quot;</span>, <span class="hljs-string">&quot;English&quot;</span>, <span class="hljs-string">&quot;Computer&quot;</span>))<br>        .build()<br>    <span class="hljs-comment">//2ã€Protobuf è½¬ Json</span><br>    <span class="hljs-keyword">val</span> json = JsonFormat.printer().print(student)<br>    <span class="hljs-comment">//3ã€æ‰“å° json</span><br>    println(json)<br>&#125;<br><br><span class="hljs-comment">//æ‰“å°ç»“æœ</span><br>&#123;<br>  <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;erdai&quot;</span>,<br>  <span class="hljs-string">&quot;age&quot;</span>: <span class="hljs-number">18</span>,<br>  <span class="hljs-string">&quot;email&quot;</span>: <span class="hljs-string">&quot;erdai666@qq.com&quot;</span>,<br>  <span class="hljs-string">&quot;course&quot;</span>: [<span class="hljs-string">&quot;Math&quot;</span>, <span class="hljs-string">&quot;English&quot;</span>, <span class="hljs-string">&quot;Computer&quot;</span>]<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="7-2ã€Json-è½¬-Protobuf"><a href="#7-2ã€Json-è½¬-Protobuf" class="headerlink" title="7.2ã€Json è½¬ Protobuf"></a>7.2ã€Json è½¬ Protobuf</h3><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span>&#123;<br>    <span class="hljs-comment">//1ã€æ„å»º Protobuf å¯¹è±¡</span><br>    <span class="hljs-keyword">val</span> student = StudentOuterClass.Student.newBuilder()<br>        .setName(<span class="hljs-string">&quot;erdai&quot;</span>)<br>        .setAge(<span class="hljs-number">18</span>)<br>        .setEmail(<span class="hljs-string">&quot;erdai666@qq.com&quot;</span>)<br>        .addAllCourse(mutableListOf(<span class="hljs-string">&quot;Math&quot;</span>, <span class="hljs-string">&quot;English&quot;</span>, <span class="hljs-string">&quot;Computer&quot;</span>))<br>        .build()<br>    <span class="hljs-comment">//2ã€Protobuf å¯¹è±¡è½¬ Json</span><br>    <span class="hljs-keyword">val</span> json = JsonFormat.printer().print(student)<br>    <span class="hljs-comment">//3ã€Json è½¬ Protobuf å¯¹è±¡</span><br>    <span class="hljs-keyword">val</span> builder = StudentOuterClass.Student.newBuilder()<br>    JsonFormat.parser().ignoringUnknownFields().merge(json,builder)<br>    <span class="hljs-comment">//4ã€æ‰“å° Protobuf å¯¹è±¡</span><br>    println(builder.build())<br>&#125;<br><br><span class="hljs-comment">//æ‰“å°ç»“æœ</span><br>name: <span class="hljs-string">&quot;erdai&quot;</span><br>age: <span class="hljs-number">18</span><br>email: <span class="hljs-string">&quot;erdai666@qq.com&quot;</span><br>course: <span class="hljs-string">&quot;Math&quot;</span><br>course: <span class="hljs-string">&quot;English&quot;</span><br>course: <span class="hljs-string">&quot;Computer&quot;</span><br></code></pre></td></tr></table></figure><h2 id="å…«ã€Protobuf-å’Œ-Java-å¯¹è±¡ç›¸äº’è½¬æ¢"><a href="#å…«ã€Protobuf-å’Œ-Java-å¯¹è±¡ç›¸äº’è½¬æ¢" class="headerlink" title="å…«ã€Protobuf å’Œ Java å¯¹è±¡ç›¸äº’è½¬æ¢"></a>å…«ã€Protobuf å’Œ Java å¯¹è±¡ç›¸äº’è½¬æ¢</h2><p>è¿™ä¸ªå®åˆ™æ˜¯åœ¨ä¸ƒçš„åŸºç¡€ä¸Šï¼Œå½“æˆ‘ä»¬å°† Protobuf è½¬æ¢ä¸º Json åï¼Œåœ¨æŠŠ Json è½¬æ¢ä¸ºå¯¹åº”çš„ Java å¯¹è±¡ï¼Œè¿™é‡Œæˆ‘ä»¬å…ˆå¼•å…¥ Gson ï¼š</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs kotlin">implementation <span class="hljs-string">&#x27;com.google.code.gson:gson:2.8.9&#x27;</span><br></code></pre></td></tr></table></figure><p>å®šä¹‰ä¸€ä¸ªæ¥æ”¶å½“å‰ Json çš„æ•°æ®æ¨¡å‹ï¼š</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-keyword">data</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyStudent</span>(<br>    <span class="hljs-keyword">var</span> name: String? = <span class="hljs-string">&quot;&quot;</span>,<br>    <span class="hljs-keyword">var</span> age: <span class="hljs-built_in">Int</span> = <span class="hljs-number">0</span>,<br>    <span class="hljs-keyword">var</span> email: String? = <span class="hljs-string">&quot;&quot;</span>,<br>    <span class="hljs-keyword">var</span> course: MutableList&lt;String&gt;? = <span class="hljs-literal">null</span><br>)<br></code></pre></td></tr></table></figure><p>æœ€åè¿›è¡Œè½¬æ¢ï¼š</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span>&#123;<br>    <span class="hljs-comment">//1ã€æ„å»º Protobuf å¯¹è±¡</span><br>    <span class="hljs-keyword">val</span> student = StudentOuterClass.Student.newBuilder()<br>        .setName(<span class="hljs-string">&quot;erdai&quot;</span>)<br>        .setAge(<span class="hljs-number">18</span>)<br>        .setEmail(<span class="hljs-string">&quot;erdai666@qq.com&quot;</span>)<br>        .addAllCourse(mutableListOf(<span class="hljs-string">&quot;Math&quot;</span>, <span class="hljs-string">&quot;English&quot;</span>, <span class="hljs-string">&quot;Computer&quot;</span>))<br>        .build()<br>    <span class="hljs-comment">//2ã€å°† Protobuf è½¬æ¢ä¸º Json</span><br>    <span class="hljs-keyword">val</span> json = JsonFormat.printer().print(student)<br><br>    <span class="hljs-comment">//3ã€å°† Json è½¬æ¢ä¸º Java Bean å¯¹è±¡</span><br>    <span class="hljs-keyword">val</span> myStudent = Gson().fromJson(json,MyStudent::<span class="hljs-keyword">class</span>.java)<br>    println(myStudent)<br>&#125;<br><br><span class="hljs-comment">//æ‰“å°ç»“æœ</span><br>MyStudent(name=erdai, age=<span class="hljs-number">18</span>, email=<span class="hljs-symbol">erdai666@</span>qq.com, course=[Math, English, Computer])<br></code></pre></td></tr></table></figure><h2 id="ä¹ã€æ€»ç»“"><a href="#ä¹ã€æ€»ç»“" class="headerlink" title="ä¹ã€æ€»ç»“"></a>ä¹ã€æ€»ç»“</h2><p>å…³äº Protobuf çš„å¼€å‘æµç¨‹ï¼šä¸€èˆ¬éƒ½æ˜¯åå°å®šä¹‰å¥½ Protobuf ï¼Œç„¶åç»™åˆ°æˆ‘ä»¬å®¢æˆ·ç«¯ï¼Œå®¢æˆ·ç«¯åœ¨æ ¹æ® Protobuf ç”Ÿæˆå¯¹åº”å¹³å°çš„ä»£ç è¿›è¡Œä½¿ç”¨å³å¯ã€‚å› æ­¤ä¸Šé¢æˆ‘è®²çš„è¿™äº›å†…å®¹ä½ æŒæ¡äº†ï¼ŒåŸºæœ¬ä¸Šèƒ½æ»¡è¶³æ—¥å¸¸çš„å¼€å‘</p><p>å¥½äº†ï¼Œæœ¬ç¯‡æ–‡ç« åˆ°è¿™é‡Œå°±ç»“æŸäº†ï¼Œå¦‚æœæœ‰å•¥é—®é¢˜ï¼Œæ¬¢è¿è¯„è®ºåŒºä¸€èµ·äº¤æµ</p><p><strong>æ„Ÿè°¢ä½ é˜…è¯»è¿™ç¯‡æ–‡ç« </strong></p><h3 id="å‚è€ƒå’Œæ¨è"><a href="#å‚è€ƒå’Œæ¨è" class="headerlink" title="å‚è€ƒå’Œæ¨è"></a>å‚è€ƒå’Œæ¨è</h3><p><a href="https://developers.google.com/protocol-buffers/docs/proto3">Protocol Buffers å®˜æ–¹æ–‡æ¡£</a></p><blockquote><p><strong>ä½ çš„ç‚¹èµï¼Œè¯„è®ºï¼Œæ˜¯å¯¹æˆ‘å·¨å¤§çš„é¼“åŠ±ï¼</strong></p><p>æ¬¢è¿å…³æ³¨æˆ‘çš„<strong>å…¬ä¼—å·ï¼š</strong>  <a href="http://m6z.cn/6jwi7b"><strong>sweetying</strong></a> ï¼Œæ–‡ç« æ›´æ–°å¯ç¬¬ä¸€æ—¶é—´æ”¶åˆ°</p><p>å¦‚æœ<strong>æœ‰é—®é¢˜</strong>ï¼Œå…¬ä¼—å·å†…æœ‰åŠ æˆ‘å¾®ä¿¡çš„å…¥å£ï¼Œåœ¨æŠ€æœ¯å­¦ä¹ ã€ä¸ªäººæˆé•¿çš„é“è·¯ä¸Šï¼Œæˆ‘ä»¬ä¸€èµ·å‰è¿›ï¼</p></blockquote>]]></content>
    
    
    <categories>
      
      <category>Android</category>
      
      <category>ä¸€ç¯‡å°±å¤Ÿ</category>
      
    </categories>
    
    
    <tags>
      
      <tag>åŸåˆ›</tag>
      
      <tag>Android</tag>
      
      <tag>ä¸€ç¯‡å°±å¤Ÿ</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ä¸€ç¯‡å°±å¤Ÿç³»åˆ—ï¼šAndroid Emoji è¡¨æƒ…åˆ†äº«å’Œå®è·µ</title>
    <link href="/2022/10/11/%E4%B8%80%E7%AF%87%E5%B0%B1%E5%A4%9F%E7%B3%BB%E5%88%97%EF%BC%9AAndroid%20Emoji%20%E8%A1%A8%E6%83%85%E5%88%86%E4%BA%AB%E5%92%8C%E5%AE%9E%E8%B7%B5/"/>
    <url>/2022/10/11/%E4%B8%80%E7%AF%87%E5%B0%B1%E5%A4%9F%E7%B3%BB%E5%88%97%EF%BC%9AAndroid%20Emoji%20%E8%A1%A8%E6%83%85%E5%88%86%E4%BA%AB%E5%92%8C%E5%AE%9E%E8%B7%B5/</url>
    
    <content type="html"><![CDATA[<p><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/301a8e00a98440299835b6d3220b110a~tplv-k3u1fbpfcp-watermark.image"></p><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>å¾ˆé«˜å…´é‡è§ä½ ~</p><p>æœ€è¿‘å¼€å‘äº†ä¸€ä¸ª LiveChat å®¢æœèŠå¤©çš„æ¨¡å—ï¼Œé‡Œé¢æ¶‰åŠåˆ° Emoji è¡¨æƒ…ï¼Œé‡åˆ°äº†ä¸€äº›é—®é¢˜ï¼Œåˆ†äº«ä¸‹è‡ªå·±çš„ä¸€ä¸ªè§£å†³è¿‡ç¨‹ä»¥åŠå…³äº Android Emoji çš„ç›¸å…³çŸ¥è¯†ç‚¹</p><h2 id="ä¸€ã€Emoji-è¡¨æƒ…ä»‹ç»"><a href="#ä¸€ã€Emoji-è¡¨æƒ…ä»‹ç»" class="headerlink" title="ä¸€ã€Emoji è¡¨æƒ…ä»‹ç»"></a>ä¸€ã€Emoji è¡¨æƒ…ä»‹ç»</h2><p>ä¸‹é¢å¤§æ¦‚ä»‹ç»ä¸€ä¸‹å…³äº Emoji è¡¨æƒ…ï¼š</p><p>1ã€Emoji æ˜¯å¯ä»¥è¢«æ’å…¥æ–‡å­—ä¸­çš„å›¾å½¢ç¬¦å·ï¼Œå®ƒæ˜¯ä¸€ä¸ªæ—¥æœ¬è¯­ï¼Œe è¡¨ç¤ºâ€ç»˜â€ï¼Œmoji è¡¨ç¤º â€œæ–‡å­—â€ ï¼Œè¿åœ¨ä¸€èµ·å°±æ˜¯ â€œç»˜æ–‡å­—â€ï¼Œå®ƒæœ€æ—©æ˜¯ç”¨äºæˆ‘ä»¬å‘çŸ­ä¿¡æ¥å¢å¼ºç”¨æˆ·çš„ä¸€ä¸ªä½“éªŒï¼Œ2007 å¹´ï¼ŒApple åœ¨ iPhone ä¸­æ”¯æŒäº† Emojiï¼Œæ‰è®©å®ƒåœ¨å…¨çƒèŒƒå›´å†…æµè¡Œèµ·æ¥ã€‚</p><p>2ã€åœ¨ 2010 å¹´ä»¥å‰ï¼ŒEmoji çš„å®ç°æ˜¯å°†ä¸€äº›ç‰¹æ®Šçš„ç¬¦å·ç»„åˆæ›¿æ¢æˆå›¾ç‰‡è¡¨æƒ…ï¼Œä¾‹å¦‚ <code>:)</code> æ›¿æ¢æˆ ğŸ˜Š ï¼Œè¿™æ ·çš„è§£å†³æ–¹æ¡ˆå¯¼è‡´ Emoji è¡¨æƒ…å¾ˆéš¾æ ‡å‡†åŒ–ï¼Œè€Œä¸”è¡¨è¾¾èŒƒå›´æœ‰é™</p><p>3ã€ä» 2010 å¹´å¼€å§‹ï¼ŒUnicode å¼€å§‹ä¸º Emoji åˆ†é…å›ºå®šçš„ç ç‚¹ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨è¿™ä¹‹åï¼Œæ¯ä¸€ä¸ª Unicode å­—ç¬¦å¯¹åº”ä¸€ä¸ªå­—ä½“ï¼Œå®ƒä¼šè¢«æ¸²æŸ“ä¸ºå›¾ç‰‡æ˜¾ç¤º</p><p>4ã€Emoji è¡¨æƒ…ç”±äºå…¶è¡¨è¾¾æƒ…ç»ªçš„ç‰¹ç‚¹ï¼Œè¢«å¹¿å—æ¬¢è¿ã€‚Emoji è¡¨æƒ…çš„å›½é™…æ ‡å‡†åœ¨ 2015 å¹´å‡ºå°ï¼Œåˆ°ç›®å‰ä¸ºæ­¢å·²ç»æ˜¯ V13.1 ç‰ˆæœ¬çš„æ ‡å‡†äº†ï¼Œå…·ä½“å…³äº Unicode å­—ç¬¦å’Œ Emoji è¡¨æƒ…çš„ä¸€ä¸ªæ˜ å°„å…³ç³»ä»¥åŠå…¶ä»–çš„ä¸€äº›ç»†èŠ‚ï¼Œå¯ä»¥ä»è¿™ä¸ªç½‘ç«™ä¸­å»æŸ¥è¯¢ï¼š<a href="http://www.unicode.org/emoji/charts/full-emoji-list.html">http://www.unicode.org/emoji/charts/full-emoji-list.html</a> </p><h2 id="äºŒã€éœ€æ±‚"><a href="#äºŒã€éœ€æ±‚" class="headerlink" title="äºŒã€éœ€æ±‚"></a>äºŒã€éœ€æ±‚</h2><p>å¯¹ Emoji è¡¨æƒ…æœ‰äº†ä¸€ä¸ªå¤§æ¦‚çš„äº†è§£ä¹‹åï¼Œä¸‹é¢è®²ä¸‹äº§å“ç»™æˆ‘æçš„ä¸€ä¸ªéœ€æ±‚ï¼Œå¤§æ¦‚å°±æ˜¯ï¼š<strong>ä» <a href="http://www.unicode.org/emoji/charts/full-emoji-list.html">http://www.unicode.org/emoji/charts/full-emoji-list.html</a> è¿™ä¸ªç½‘ç«™ä¸­ï¼Œç­›é€‰ä¸€äº›å¸¸ç”¨çš„ Emoji è¡¨æƒ…ï¼Œç„¶åæ ¹æ® UI è®¾è®¡ç¨¿ï¼Œå®ç°è¡¨æƒ…åŒ…åŠŸèƒ½å³å¯</strong></p><p>äº†è§£äº†éœ€æ±‚ä¹‹åï¼Œæˆ‘ä»¬å°±è¦å»æ€è€ƒå¦‚ä½•å»å®ç°è¿™ä¸ªåŠŸèƒ½ğŸ¤”ï¼Ÿ</p><p>é¦–å…ˆæ‰“å¼€è¿™ä¸ªç½‘ç«™çœ‹çœ‹ï¼Œå¦‚ä¸‹å›¾ï¼š</p><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/880be0265dfc4da18cd2e30d6566aa66~tplv-k3u1fbpfcp-zoom-1.image" alt="image-20210521105455542"></p><p>ä»ä¸Šå›¾æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼š</p><p>1ã€æ¯ä¸ªè¡¨æƒ…çš„ Unicode å­—ç¬¦</p><p>è¿™é‡Œè§£é‡Šä¸€ä¸‹ Unicodeï¼šUnicode å°±æ˜¯ç»Ÿä¸€çš„å­—ç¬¦ç¼–ç æ ‡å‡†ï¼Œå½“éœ€è¦è¡¨ç¤ºä¸€ä¸ª Unicode å­—ç¬¦æ—¶ï¼Œé€šå¸¸ä¼šç”¨ U+ ç„¶åç´§æ¥ç€ä¸€ä¸ªåå…­è¿›åˆ¶çš„æ•°å­—æ¥è¡¨ç¤ºï¼Œå¦‚ä¸Šå›¾æ‰€åˆ—ä¸¾çš„è¿™äº›</p><p>2ã€æ¯ä¸ª Unicode å­—ç¬¦å¯¹åº”çš„ Emoji è¡¨æƒ…åœ¨å„ä¸ªå¹³å°å±•ç¤ºçš„æ ·å¼éƒ½ä¸å¤ªä¸€æ ·ï¼Œå› ä¸º Unicode åªæ˜¯è§„å®šäº† Emoji çš„ç ç‚¹å’Œå«ä¹‰ï¼Œå¹¶æ²¡æœ‰è§„å®šå®ƒçš„æ ·å¼ï¼Œæ¯ä¸ªå¹³å°éƒ½æœ‰è‡ªå·±çš„ Emoji å®ç°</p><h2 id="ä¸‰ã€Unicode-ä½¿ç”¨"><a href="#ä¸‰ã€Unicode-ä½¿ç”¨" class="headerlink" title="ä¸‰ã€Unicode ä½¿ç”¨"></a>ä¸‰ã€Unicode ä½¿ç”¨</h2><p>åˆ°è¿™é‡Œæˆ‘å¿ƒé‡Œä¼šæœ‰ä¸ªç–‘é—®ï¼šæˆ‘å¦‚ä½•å°†è¿™äº› Unicode å­—ç¬¦å¦‚ U+1F600 åœ¨ Android ä¸­ä½¿ç”¨å‘¢ï¼Ÿ</p><p>Unicode å…è®¸æˆ‘ä»¬ä½¿ç”¨ Codeã€UTF-8ã€Surrogates ç­‰è¿™äº›å½¢å¼æ¥è¡¨ç¤ºä¸€ä¸ªå­—ç¬¦ï¼Œé‚£å…¶å®è¿™å°±æ˜¯ä¸€ä¸ªçªç ´å£</p><p>ä»¥ code å½¢å¼ä¸¾ä¾‹ï¼šä¾‹å¦‚è¯´æˆ‘çš„ä¸€ä¸ª Emoji è¡¨æƒ…çš„ code å½¢å¼æ˜¯ 1F600ï¼Œé‚£ä¹ˆæˆ‘å°±å¯ä»¥ç»è¿‡ä¸€ç³»åˆ— Api çš„è½¬æ¢ï¼Œè®©ä»–èƒ½å¤Ÿä½¿ç”¨ Android æ§ä»¶å»åŠ è½½</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//å°†å½“å‰ code è½¬æ¢ä¸º 16 è¿›åˆ¶æ•°</span><br><span class="hljs-type">int</span> <span class="hljs-variable">hex</span> <span class="hljs-operator">=</span> Integer.parseInt(<span class="hljs-string">&quot;1F600&quot;</span>, <span class="hljs-number">16</span>);<br><span class="hljs-comment">//å°†å½“å‰ 16 è¿›åˆ¶æ•°è½¬æ¢æˆå­—ç¬¦æ•°ç»„</span><br><span class="hljs-type">char</span>[] chars = Character.toChars(hex);<br><span class="hljs-comment">//å°†å½“å‰å­—ç¬¦æ•°ç»„è½¬æ¢æˆ TextView å¯åŠ è½½çš„ String å­—ç¬¦ä¸²</span><br><span class="hljs-type">String</span> <span class="hljs-variable">mEmojiString</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>(chars);<br></code></pre></td></tr></table></figure><p>ç»è¿‡ä¸Šè¿°è½¬æ¢ï¼Œå°†ç”Ÿæˆçš„ String å¯¹è±¡ï¼Œä¼ é€’ç»™ TextViewï¼Œå¦‚æœæ˜¯å½“å‰è®¾å¤‡æ”¯æŒçš„ Emojiï¼Œå°±å¯ä»¥æ­£å¸¸æ˜¾ç¤ºäº†</p><h2 id="å››ã€Emoji-è¡¨æƒ…å®è·µ"><a href="#å››ã€Emoji-è¡¨æƒ…å®è·µ" class="headerlink" title="å››ã€Emoji è¡¨æƒ…å®è·µ"></a>å››ã€Emoji è¡¨æƒ…å®è·µ</h2><p>æœ‰äº†æ€è·¯ï¼Œå°±å¼€å§‹æ’¸èµ·æŸšå­å¹²ï¼ŒæŠŠç­›é€‰å‡ºçš„è¡¨æƒ… code æ”¾åˆ°ä¸€ä¸ªé›†åˆä¸­ï¼Œç„¶åé€šè¿‡ ViewPager + Fragment + RecyclerView ç­‰ä¸€ç³»åˆ—æ§ä»¶çš„é…åˆï¼Œå®ç°äº† UI éœ€è¦çš„æ•ˆæœï¼Œå¦‚ä¸‹å›¾ï¼š</p><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/b3a456040f8a4825854a804bdbdc73b4~tplv-k3u1fbpfcp-zoom-1.image" alt="image-20210510130326366"></p><p>ä»ä¸Šå›¾å¯ä»¥å‘ç°ä¸€ä¸ªé—®é¢˜ï¼š<strong>æœ‰äº› Emoji è¡¨æƒ…æ˜¾ç¤ºå‡ºæ¥åƒä¸€ä¸ªä¿¡å°</strong></p><p>åŸå› æ˜¯å½“å‰è®¾å¤‡ä¸æ”¯æŒï¼Œä¸Šé¢æˆ‘è®²åˆ°æ¯ä¸€ä¸ª Unicode å­—ç¬¦å¯¹åº”ä¸€ä¸ªå­—ä½“ï¼Œå®ƒä¼šè¢«æ¸²æŸ“ä¸ºå›¾ç‰‡æ˜¾ç¤ºï¼Œä½†æ˜¯å¦‚æœå½“å‰ç³»ç»Ÿä¸æ”¯æŒè¿™ç§å­—ä½“ï¼Œé‚£ä¹ˆå°±ä¼šæ˜¾ç¤ºå‡ºä¸€ä¸ªä¿¡å°ï¼Œè€Œä¸”éšç€ Android ç‰ˆæœ¬è¶Šæ¥è¶Šä½ï¼Œè¿™ç§æƒ…å†µè¶Šæ¥è¶Šå¤šï¼Œè¿™ç§æ•ˆæœè‚¯å®šæ˜¯ä¸è¡Œçš„</p><p>çŸ¥é“äº†å‡ºç°çš„é—®é¢˜å’ŒåŸå› ï¼Œæˆ‘ä»¬å°±è¦å»æƒ³è§£å†³æ–¹æ³•ï¼Œè¿™ä¸ªæ—¶å€™ EmojiCompat å°±æ¥äº†</p><h2 id="äº”ã€EmojiCompat-ä»‹ç»"><a href="#äº”ã€EmojiCompat-ä»‹ç»" class="headerlink" title="äº”ã€EmojiCompat ä»‹ç»"></a>äº”ã€EmojiCompat ä»‹ç»</h2><h3 id="1ã€ä»€ä¹ˆæ˜¯-EmojiCompat-ï¼Ÿ"><a href="#1ã€ä»€ä¹ˆæ˜¯-EmojiCompat-ï¼Ÿ" class="headerlink" title="1ã€ä»€ä¹ˆæ˜¯ EmojiCompat ï¼Ÿ"></a>1ã€ä»€ä¹ˆæ˜¯ EmojiCompat ï¼Ÿ</h3><p>EmojiCompat æ˜¯ Google å®˜æ–¹ç»™æˆ‘ä»¬æä¾›çš„ä¸€ä¸ª Emoji è¡¨æƒ…å…¼å®¹åº“ï¼Œæœ€ä½æ”¯æŒåˆ° Android 4.4(Api Level 19) çš„ç³»ç»Ÿè®¾å¤‡ï¼Œå®ƒå¯ä»¥é˜²æ­¢åº”ç”¨ä¸­ï¼Œå‡ºç°ä»¥ä¿¡å°çš„å½¢å¼æ¥æ˜¾ç¤º Emojiï¼Œè™½ç„¶å®ƒä»…ä»…åªæ˜¯å› ä¸ºä½ å½“å‰çš„è®¾å¤‡æ²¡æœ‰è¿™ä¸ªå­—ä½“è€Œå·²ã€‚é€šè¿‡ EmojiCompat ï¼Œä½ çš„è®¾å¤‡æ— éœ€ç­‰å¾… Android ç³»ç»Ÿæ›´æ–°ï¼Œå°±å¯ä»¥è·å¾—æœ€æ–°çš„ Emoji è¡¨æƒ…æ˜¾ç¤ºæ•ˆæœã€‚</p><p>EmojiCompat çš„è¿è¡ŒåŸç†å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/269e10afe7234f38bec1d40cb4c86be1~tplv-k3u1fbpfcp-zoom-1.image" alt="image-20210510142708101"></p><p>ä»ä¸Šå›¾æˆ‘ä»¬å¯ä»¥çŸ¥é“ï¼šEmojiCompat ä¼šåˆ¤æ–­å½“å‰è®¾å¤‡æ˜¯å¦æ”¯æŒè¿™ä¸ª Emojiï¼Œå¦‚æœæ”¯æŒåˆ™è¿˜æ˜¯ä½¿ç”¨ç³»ç»Ÿå†…ç½®çš„å­—ä½“åŠ è½½ï¼Œå¦‚æœä¸æ”¯æŒï¼Œåˆ™ä½¿ç”¨ EmojiSpan æ¥è¿›è¡Œæ›¿æ¢ï¼Œä»è€Œè¾¾åˆ°æ›¿æ¢æ¸²æŸ“çš„æ•ˆæœ</p><h3 id="2ã€å¦‚ä½•ä½¿ç”¨-EmojiCompat-ï¼Ÿ"><a href="#2ã€å¦‚ä½•ä½¿ç”¨-EmojiCompat-ï¼Ÿ" class="headerlink" title="2ã€å¦‚ä½•ä½¿ç”¨ EmojiCompat ï¼Ÿ"></a>2ã€å¦‚ä½•ä½¿ç”¨ EmojiCompat ï¼Ÿ</h3><p>è¦ä½¿ç”¨ EmojiCompat ï¼Œæˆ‘ä»¬éœ€è¦å…ˆå¯¹å…¶è¿›è¡Œåˆå§‹åŒ–ï¼Œå¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java">EmojiCompat.init(config);<br><span class="hljs-comment">//EmojiCompat çš„ init æ–¹æ³•</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> EmojiCompat <span class="hljs-title function_">init</span><span class="hljs-params">(<span class="hljs-meta">@NonNull</span> <span class="hljs-keyword">final</span> Config config)</span> &#123;<br>    <span class="hljs-keyword">if</span> (sInstance == <span class="hljs-literal">null</span>) &#123;<br>        <span class="hljs-keyword">synchronized</span> (sInstanceLock) &#123;<br>            <span class="hljs-keyword">if</span> (sInstance == <span class="hljs-literal">null</span>) &#123;<br>                sInstance = <span class="hljs-keyword">new</span> <span class="hljs-title class_">EmojiCompat</span>(config);<br>            &#125;<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">return</span> sInstance;<br>&#125;<br></code></pre></td></tr></table></figure><p>ä¸Šè¿°ä»£ç å¯ä»¥çœ‹åˆ°ï¼Œ EmojiCompat æ˜¯ä¸€ä¸ªå•ä¾‹å¯¹è±¡ï¼Œåˆå§‹åŒ–æ–¹æ³•å°±æ˜¯ä¼ å…¥äº†ä¸€ä¸ª config å³é…ç½®ï¼Œå› æ­¤æ„å»ºé…ç½®æ˜¯ EmojiCompat åˆå§‹åŒ–èƒ½å¦æˆåŠŸçš„é‡ç‚¹æ‰€åœ¨ï¼ŒGoogle ç»™æˆ‘ä»¬æä¾›äº†ä¸¤ç§é…ç½® ï¼Œä»–ä»¬åˆ†åˆ«æ˜¯ï¼š</p><p>1ã€å¯ä¸‹è½½çš„å­—ä½“é…ç½®</p><p>2ã€æœ¬åœ°æ†ç»‘çš„å­—ä½“é…ç½®</p><p>æ ¹æ® Google å®˜æ–¹ä»‹ç»ï¼š</p><h5 id="1ï¼‰ã€å¯ä¸‹è½½çš„å­—ä½“é…ç½®"><a href="#1ï¼‰ã€å¯ä¸‹è½½çš„å­—ä½“é…ç½®" class="headerlink" title="1ï¼‰ã€å¯ä¸‹è½½çš„å­—ä½“é…ç½®"></a>1ï¼‰ã€å¯ä¸‹è½½çš„å­—ä½“é…ç½®</h5><p>åŸç†ï¼šå¯ä¸‹è½½çš„å­—ä½“çš„æ–¹å¼ä¼šåœ¨é¦–æ¬¡å¯åŠ¨ app çš„æ—¶å€™æ£€æŸ¥æœ¬åœ°æ˜¯å¦æœ‰è¯¥å­—ä½“ï¼Œæ²¡æœ‰çš„è¯ä¼šä»ç½‘ä¸Šä¸‹è½½æœ€æ–°çš„ Emoji å­—ä½“ï¼Œç„¶åé‡åˆ°ä¸æ”¯æŒçš„ Emojiï¼Œå°±ä¼šä»è¿™ä¸ªå­—ä½“æ–‡ä»¶ä¸­ï¼ŒåŠ è½½èµ„æºå¹¶ä¸”æ¸²æŸ“</p><p>ç¼ºç‚¹ï¼šå¯ä¸‹è½½å­—ä½“çš„æ–¹å¼ï¼Œå®Œå…¨ä¾èµ– GMS æœåŠ¡ï¼Œåœ¨æ²¡æœ‰ GMS æœåŠ¡çš„æ‰‹æœºä¸Šå¹¶ä¸å¯ç”¨</p><h5 id="2ï¼‰ã€æœ¬åœ°æ†ç»‘çš„å­—ä½“é…ç½®"><a href="#2ï¼‰ã€æœ¬åœ°æ†ç»‘çš„å­—ä½“é…ç½®" class="headerlink" title="2ï¼‰ã€æœ¬åœ°æ†ç»‘çš„å­—ä½“é…ç½®"></a>2ï¼‰ã€æœ¬åœ°æ†ç»‘çš„å­—ä½“é…ç½®</h5><p>åŸç†ï¼šæœ¬åœ°æ†ç»‘çš„æ–¹å¼ä¼šåœ¨ App æ‰“åŒ…çš„è¿‡ç¨‹ä¸­ï¼Œæ¤å…¥ä¸€ä¸ªæœ€æ–°çš„ Emoji å­—ä½“æ–‡ä»¶ï¼Œç„¶åé‡åˆ°ä¸æ”¯æŒçš„ Emojiï¼Œå°±ä¼šä»è¿™ä¸ªå­—ä½“æ–‡ä»¶ä¸­ï¼ŒåŠ è½½èµ„æºå¹¶ä¸”æ¸²æŸ“</p><p>ç¼ºç‚¹ï¼šæœ¬åœ°æ†ç»‘çš„æ–¹å¼ä¼šåµŒå…¥ä¸€ä¸ªçº¦ 9M+ çš„å­—ä½“æ–‡ä»¶ï¼Œæ— å½¢ä¸­å¢å¤§äº† Apk å®‰è£…åŒ…çš„ä½“ç§¯</p><p>ç›®å‰å®˜æ–¹ä½¿ç”¨çš„æ˜¯ NotoColorEmojiCompat.ttf å­—ä½“æ–‡ä»¶ï¼Œæ–‡ä»¶å¤§å°çº¦ 9M+</p><p>ä¸‹é¢å…ˆè®²ä¸‹å¦‚ä½•ä½¿ç”¨è¿™ä¸¤ç§æ–¹å¼å»è¿›è¡Œåˆå§‹åŒ–</p><h4 id="1ã€å¯ä¸‹è½½çš„å­—ä½“é…ç½®"><a href="#1ã€å¯ä¸‹è½½çš„å­—ä½“é…ç½®" class="headerlink" title="1ã€å¯ä¸‹è½½çš„å­—ä½“é…ç½®"></a>1ã€å¯ä¸‹è½½çš„å­—ä½“é…ç½®</h4><p>1ï¼‰ã€æ·»åŠ  Gradle ä¾èµ–</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">implementation <span class="hljs-string">&#x27;androidx.emoji:emoji:1.1.0&#x27;</span><br></code></pre></td></tr></table></figure><p>2ï¼‰ã€æ„å»ºå¯ä¸‹è½½å­—ä½“é…ç½®åˆå§‹åŒ– EmojiCompat ï¼Œæ„å»ºç›¸å…³ä¿¡æ¯å‚ç…§ <strong><a href="https://github.com/googlearchive/android-EmojiCompat">android-EmojiCompat</a></strong> è¿™ä¸ªé¡¹ç›®</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">FontRequest</span> <span class="hljs-variable">fontRequest</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">FontRequest</span>(<br>                <span class="hljs-string">&quot;com.google.android.gms.fonts&quot;</span>,<br>                <span class="hljs-string">&quot;com.google.android.gms&quot;</span>,<br>                <span class="hljs-string">&quot;Noto Color Emoji Compat&quot;</span>,<br>                R.array.chat_com_google_android_gms_fonts_certs);<br>EmojiCompat.<span class="hljs-type">Config</span> <span class="hljs-variable">config</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">FontRequestEmojiCompatConfig</span>(mContext, fontRequest);<br>config.setReplaceAll(<span class="hljs-literal">true</span>);<br>config.registerInitCallback(<span class="hljs-keyword">new</span> <span class="hljs-title class_">EmojiCompat</span>.InitCallback() &#123;<br>     <span class="hljs-meta">@Override</span><br>     <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onInitialized</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-comment">//åˆå§‹åŒ–æˆåŠŸå›è°ƒ  </span><br>     &#125;<br><br>     <span class="hljs-meta">@Override</span><br>     <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onFailed</span><span class="hljs-params">(<span class="hljs-meta">@Nullable</span> Throwable throwable)</span> &#123;<br>  <span class="hljs-comment">//åˆå§‹åŒ–å¤±è´¥å›è°ƒ</span><br>     &#125;<br>&#125;);<br>EmojiCompat.init(config);<br></code></pre></td></tr></table></figure><h4 id="2ã€æœ¬åœ°æ†ç»‘çš„å­—ä½“é…ç½®"><a href="#2ã€æœ¬åœ°æ†ç»‘çš„å­—ä½“é…ç½®" class="headerlink" title="2ã€æœ¬åœ°æ†ç»‘çš„å­—ä½“é…ç½®"></a>2ã€æœ¬åœ°æ†ç»‘çš„å­—ä½“é…ç½®</h4><p>1ï¼‰ã€æ·»åŠ  Gradle ä¾èµ–</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">implementation <span class="hljs-string">&#x27;androidx.emoji:emoji-bundled:1.1.0&#x27;</span><br></code></pre></td></tr></table></figure><p>2ï¼‰ã€æ„å»ºæœ¬åœ°æ†ç»‘å­—ä½“é…ç½®åˆå§‹åŒ– EmojiCompat</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java">EmojiCompat.<span class="hljs-type">Config</span> <span class="hljs-variable">config</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BundledEmojiCompatConfig</span>(mContext, fontRequest);<br>config.setReplaceAll(<span class="hljs-literal">true</span>);<br>config.registerInitCallback(<span class="hljs-keyword">new</span> <span class="hljs-title class_">EmojiCompat</span>.InitCallback() &#123;<br>     <span class="hljs-meta">@Override</span><br>     <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onInitialized</span><span class="hljs-params">()</span> &#123;<br>         <span class="hljs-comment">//åˆå§‹åŒ–æˆåŠŸå›è°ƒ      </span><br>     &#125;<br><br>     <span class="hljs-meta">@Override</span><br>     <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onFailed</span><span class="hljs-params">(<span class="hljs-meta">@Nullable</span> Throwable throwable)</span> &#123;<br>  <span class="hljs-comment">//åˆå§‹åŒ–å¤±è´¥å›è°ƒ</span><br>     &#125;<br>&#125;);<br>EmojiCompat.init(config);<br></code></pre></td></tr></table></figure><p>åˆ°è¿™é‡Œï¼ŒEmojiCompat çš„åˆå§‹åŒ–å·¥ä½œå°±å®Œæˆäº†ï¼Œæˆ‘ä»¬å¯ä»¥å‘ç°è¿™ä¸¤ç§æ–¹å¼å…¶å®éƒ½æ˜¯å»æ„å»ºä¸€ä¸ªå­—ä½“é…ç½®å³ config å»åˆå§‹åŒ–</p><p>é‚£æˆ‘ä¼šæƒ³ï¼šæ˜¯å¦å¯ä»¥æ„å»ºä¸€ä¸ªè‡ªå®šä¹‰çš„å­—ä½“é…ç½®å»å®Œæˆ EmojiCompat çš„åˆå§‹åŒ–å‘¢ï¼Ÿ</p><p>è¿™ä¸ªé—®é¢˜æˆ‘ä»¬å…ˆç•™ç€ï¼Œç»§ç»­å¾€ä¸‹çœ‹</p><h4 id="3ã€EmojiCompat-å®è·µ"><a href="#3ã€EmojiCompat-å®è·µ" class="headerlink" title="3ã€EmojiCompat å®è·µ"></a>3ã€EmojiCompat å®è·µ</h4><p>ç°åœ¨æˆ‘ä»¬æ¸…æ¥šäº†ï¼š</p><p>1ã€æ„å»ºå­—ä½“é…ç½®</p><p>2ã€ä¸¤ç§å­—ä½“é…ç½®çš„åŸç†å’Œç¼ºç‚¹</p><p>3ã€åˆå§‹åŒ– EmojiCompat</p><p>å› ä¸ºæœ¬åœ°æ†ç»‘å­—ä½“é…ç½®çš„æ–¹å¼ä¼šä½¿æˆ‘ä»¬çš„ app åŒ…ä½“ç§¯å¢å¤§ 9M+ï¼Œè¿™æ˜¯å®Œå…¨ä¸èƒ½æ¥å—çš„ï¼Œè€Œä¸”æˆ‘ä»¬çš„ app ä¸»è¦æ˜¯é¢å‘å›½å¤–çš„ç”¨æˆ·ï¼Œå›½å¤–ç”¨æˆ·æ‰‹æœºä¸€èˆ¬éƒ½æœ‰ GMS æœåŠ¡ï¼Œå› æ­¤æˆ‘é€‰ç”¨äº†<strong>å¯ä¸‹è½½å­—ä½“é…ç½®</strong>æ¥å®Œæˆ EmojiCompat çš„åˆå§‹åŒ–</p><p>åˆå§‹åŒ–æˆåŠŸåï¼Œæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨ EmojiCompat æä¾›çš„åŠŸèƒ½äº†ï¼Œä¹‹å‰æˆ‘ä»¬æ˜¯é€šè¿‡å¦‚ä¸‹æ–¹å¼è¿›è¡Œè¡¨æƒ…åŒ…åŠ è½½çš„ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//å°†å½“å‰ code è½¬æ¢ä¸º 16 è¿›åˆ¶æ•°</span><br><span class="hljs-type">int</span> <span class="hljs-variable">hex</span> <span class="hljs-operator">=</span> Integer.parseInt(<span class="hljs-string">&quot;1F600&quot;</span>, <span class="hljs-number">16</span>);<br><span class="hljs-comment">//å°†å½“å‰ 16 è¿›åˆ¶æ•°è½¬æ¢æˆå­—ç¬¦æ•°ç»„</span><br><span class="hljs-type">char</span>[] chars = Character.toChars(hex);<br><span class="hljs-comment">//å°†å½“å‰å­—ç¬¦æ•°ç»„è½¬æ¢æˆ TextView å¯åŠ è½½çš„ String å­—ç¬¦ä¸²</span><br><span class="hljs-type">String</span> <span class="hljs-variable">mEmojiString</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>(chars);<br></code></pre></td></tr></table></figure><p>ç°åœ¨åªéœ€è¦å¯¹å½“å‰ mEmojiString é€šè¿‡ EmojiCompat å¤„ç†ä¸€ä¸‹å³å¯ï¼Œå¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//åˆ¤æ–­å½“å‰ EmojiCompat æ˜¯å¦åˆå§‹åŒ–æˆåŠŸ</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">isEmojiCompatInit</span><span class="hljs-params">()</span>&#123;<br>    <span class="hljs-keyword">return</span> EmojiCompat.get().getLoadState() == EmojiCompat.LOAD_STATE_SUCCEEDED;<br>&#125;<br><br><span class="hljs-comment">//è·å–å¯å…¼å®¹çš„ emoji å­—ç¬¦ä¸²</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> CharSequence <span class="hljs-title function_">getCompatEmojiString</span><span class="hljs-params">(String code)</span> &#123;<br>    <span class="hljs-comment">//å°†å½“å‰ code è½¬æ¢ä¸º 16 è¿›åˆ¶æ•°</span><br>    <span class="hljs-type">int</span> <span class="hljs-variable">hex</span> <span class="hljs-operator">=</span> Integer.parseInt(code, <span class="hljs-number">16</span>);<br>    <span class="hljs-comment">//å°†å½“å‰ 16 è¿›åˆ¶æ•°è½¬æ¢æˆå­—ç¬¦æ•°ç»„</span><br>    <span class="hljs-type">char</span>[] chars = Character.toChars(hex);<br>    <span class="hljs-comment">//å°†å½“å‰å­—ç¬¦æ•°ç»„è½¬æ¢æˆ TextView å¯åŠ è½½çš„ String å­—ç¬¦ä¸²</span><br>    <span class="hljs-type">String</span> <span class="hljs-variable">mEmojiString</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>(chars);<br>    <span class="hljs-comment">//åˆ¤æ–­å½“å‰ç³»ç»Ÿæ˜¯å¦å¤§äºç­‰äº 19ï¼Œå¹¶ä¸” EmojiCompat åˆå§‹åŒ–æˆåŠŸ</span><br>    <span class="hljs-keyword">if</span>(Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.KITKAT &amp;&amp; isEmojiCompatInit())&#123;<br>        <span class="hljs-keyword">return</span> EmojiCompat.get().process(mEmojiString);<br>    &#125;<br>    <span class="hljs-keyword">return</span> mEmojiString;<br>&#125;<br></code></pre></td></tr></table></figure><p>ä¸Šè¿°ä»£ç æˆ‘ä»¬ä½¿ç”¨ EmojiCompat çš„ process æ–¹æ³•å¯¹ä¹‹å‰çš„  emoji å­—ç¬¦ä¸²åšäº†å…¼å®¹å¤„ç†ï¼Œç°åœ¨æ˜¾ç¤ºå‡ºæ¥çš„è¡¨æƒ…å°±ä¸ä¼šæœ‰å•¥é—®é¢˜äº†ï¼Œè¿™ä¸ªåº“ä½¿ç”¨èµ·æ¥è¿˜æ˜¯å¾ˆç®€å•çš„</p><h4 id="4ã€-EmojiCompat-æä¾›çš„æ§ä»¶"><a href="#4ã€-EmojiCompat-æä¾›çš„æ§ä»¶" class="headerlink" title="4ã€ EmojiCompat æä¾›çš„æ§ä»¶"></a>4ã€ EmojiCompat æä¾›çš„æ§ä»¶</h4><p>è¿™é‡Œæˆ‘ä»¬åœ¨å»¶ä¼¸ä¸€ä¸‹ï¼Œå‡è®¾ä¹‹å‰çš„ä»£ç æˆ‘éƒ½ä¸æƒ³åŠ¨ï¼Œä¹Ÿå°±æ˜¯è¯´ getCompatEmojiString è¿™ä¸ªæ–¹æ³•æˆ‘éƒ½ä¸æƒ³å†™ï¼Œè¿˜æ˜¯ä½¿ç”¨ä¹‹å‰çš„æ–¹å¼å»å®ç°è¡¨æƒ…åŒ…çš„å…¼å®¹ï¼Œå¯ä»¥åšåˆ°ä¹ˆï¼Ÿ</p><p>ç­”ï¼šå¯ä»¥çš„ï¼Œä½¿ç”¨ EmojiCompat æä¾›çš„æ§ä»¶</p><p>EmojiCompat é‡Œé¢æä¾›äº†å¦‚ï¼šEmojiTextViewï¼ŒEmojiButtonï¼ŒEmojiEditTextç­‰æ§ä»¶ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java">&lt;androidx.emoji.widget.EmojiTextView<br>    android:layout_width=<span class="hljs-string">&quot;wrap_content&quot;</span><br>    android:layout_height=<span class="hljs-string">&quot;wrap_content&quot;</span> /&gt;<br>      <br>&lt;androidx.emoji.widget.EmojiButton<br>    android:layout_width=<span class="hljs-string">&quot;wrap_content&quot;</span><br>    android:layout_height=<span class="hljs-string">&quot;wrap_content&quot;</span> /&gt;<br><br>&lt;androidx.emoji.widget.EmojiEditText<br>    android:layout_width=<span class="hljs-string">&quot;wrap_content&quot;</span><br>    android:layout_height=<span class="hljs-string">&quot;wrap_content&quot;</span> /&gt;<br></code></pre></td></tr></table></figure><p>å®é™…ä¸Šè¿™äº›æ§ä»¶çš„æºç é‡Œé¢æœ€ç»ˆè¿˜æ˜¯ä¼šè°ƒç”¨ EmojiCompat çš„ process æ–¹æ³•å¯¹ä¹‹å‰çš„ emoji å­—ç¬¦ä¸²åšå…¼å®¹å¤„ç†ï¼Œå¦‚æœ EmojiCompat åˆå§‹åŒ–å¤±è´¥ï¼Œè¿™äº› EmojiCompat æä¾›çš„æ§ä»¶å’Œå®ƒç»§æ‰¿çš„æ§ä»¶åŠŸèƒ½æ˜¯ä¸€æ ·çš„ï¼Œä»…æ­¤è€Œå·²</p><p>æœ€ç»ˆæˆ‘çš„å®ç°æ–¹æ¡ˆå°±æ˜¯ï¼š<strong>ä½¿ç”¨å¯ä¸‹è½½å­—ä½“é…ç½®åˆå§‹åŒ– EmojiCompatï¼Œåœ¨ä½¿ç”¨ EmojiCompat æä¾›çš„æ§ä»¶æ›¿æ¢ä¹‹å‰çš„æ§ä»¶å®ç°äº†è¡¨æƒ…åŒ…çš„å…¼å®¹</strong>ï¼Œæ•ˆæœå¦‚ä¸‹ï¼š</p><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/451cf961936f4522a18c3b8e29d1feb5~tplv-k3u1fbpfcp-zoom-1.image" alt="image-20210526145027221"></p><p>å¯èƒ½ä½ ä¼šå‘ç°è¿™å¼ æ•ˆæœå›¾å’Œä¹‹å‰é‚£å¼ ä¸€äº›èƒ½æ˜¾ç¤ºå‡ºæ¥çš„ Emoji è¡¨æƒ…æ•ˆæœä¸ä¸€æ ·ï¼Œè¿™æ˜¯å•¥æƒ…å†µå‘¢ï¼Ÿ</p><p>ä¹‹å‰æˆ‘è®²è¿‡ï¼šEmojiCompat ä¼šåˆ¤æ–­å½“å‰è®¾å¤‡æ˜¯å¦æ”¯æŒè¿™ä¸ª Emojiï¼Œå¦‚æœæ”¯æŒåˆ™è¿˜æ˜¯ä½¿ç”¨ç³»ç»Ÿå†…ç½®çš„å­—ä½“åŠ è½½ï¼Œå¦‚æœä¸æ”¯æŒï¼Œåˆ™ä½¿ç”¨ EmojiSpan æ¥è¿›è¡Œæ›¿æ¢ï¼Œä»è€Œè¾¾åˆ°æ›¿æ¢æ¸²æŸ“çš„æ•ˆæœã€‚è¿™æ˜¯åœ¨ä½ æ²¡è®¾ç½® config.setReplaceAll(true) çš„æƒ…å†µä¸‹ï¼Œè€Œå¦‚æœä½ è®¾ç½®äº†  config.setReplaceAll(true) ï¼Œé‚£ä¹ˆæ‰€æœ‰çš„ Emoji è¡¨æƒ…éƒ½ä¼šä½¿ç”¨ EmojiSpan æ›¿æ¢å¹¶æ¸²æŸ“</p><h2 id="å…­ã€æ–°çš„é—®é¢˜"><a href="#å…­ã€æ–°çš„é—®é¢˜" class="headerlink" title="å…­ã€æ–°çš„é—®é¢˜"></a>å…­ã€æ–°çš„é—®é¢˜</h2><p>å¥½äº†ï¼Œåˆ°äº†è¿™é‡Œä¼¼ä¹å°±è¦ç»“æŸäº†ï¼Œæˆ‘ä¹Ÿè§‰å¾—è¦ç»“æŸäº†ï¼Œç„¶è€Œæµ‹è¯•é‚£è¾¹å‘ç°è¿˜æ˜¯ä¼šæœ‰æ˜¾ç¤ºé—®é¢˜ï¼ŒåŸå› å…¶å®æˆ‘ä¹ŸçŒœåˆ°äº†ï¼Œé‚£å°±æ˜¯å½“å‰è®¾å¤‡æ²¡æœ‰ GMS æœåŠ¡</p><p>æˆ‘è®²è¿‡å›½å¤–çš„æ‰‹æœºä¸€èˆ¬éƒ½ä¼šæœ‰ GMS æœåŠ¡ï¼Œä½†æ˜¯è¿‘äº›å¹´ä¸­ç¾è´¸æ˜“æˆ˜ï¼Œå¾ˆå¤šåä¸ºæ‰‹æœºæ²¡æœ‰ GMS æœåŠ¡äº†ï¼Œè€Œæˆ‘ä»¬çš„ç”¨æˆ·å­˜åœ¨å¾ˆå¤§ä¸€éƒ¨åˆ†ç”¨æˆ·ç”¨çš„å°±æ˜¯åä¸ºæ‰‹æœºï¼Œå› æ­¤æ‹…å¿ƒå‡ºç°ä¸€äº›é—®é¢˜ï¼Œæ‰€ä»¥å¿…é¡»å¾—å»è§£å†³è¿™ä¸ªé—®é¢˜</p><p>æ‹ä¸€æ‹ç°åœ¨çš„é—®é¢˜ï¼šå¯ä¸‹è½½çš„å­—ä½“é…ç½®å®Œå…¨ä¾èµ– GMS æœåŠ¡ï¼Œå¦‚æœæ²¡æœ‰  GMS æœåŠ¡ï¼Œåˆ™ä¼šå¯¼è‡´å­—ä½“ä¸‹è½½å¤±è´¥ï¼Œç›¸åº”çš„ EmojiCompat å°±ä¼šåˆå§‹åŒ–å¤±è´¥ï¼ŒEmojiCompat åˆå§‹åŒ–å¤±è´¥ï¼Œåˆ™çœ‹å½“å‰ç³»ç»Ÿæ˜¯å¦æ”¯æŒè¯¥ emojiï¼Œå¦‚æœä¸æ”¯æŒï¼Œé‚£å°±ä¼šæ˜¾ç¤ºæˆä¿¡å°çŠ¶ã€‚ä¹‹å‰æœ¬åœ°æ†ç»‘å­—ä½“é…ç½®çš„æ–¹å¼å› ä¸ºä¼šä½¿æˆ‘ä»¬çš„ app åŒ…ä½“ç§¯å¢å¤§ï¼Œç›´æ¥è¢« pass æ‰äº†</p><p>å¦‚æœè¿˜è¦ç»§ç»­ä½¿ç”¨ EmojiCompatï¼Œé—®é¢˜åˆ°äº†è¿™é‡Œä¼¼ä¹æ— è§£äº†ï¼Œåˆ«ç€æ€¥ï¼ŒåŠæ³•æ€»æ¯”å›°éš¾å¤šï¼Œå½“æ—¶æˆ‘å¿ƒé‡Œæœ‰ä¸¤ä¸ªæƒ³æ³•ï¼š</p><p>1ã€æ¨åˆ°ç›®å‰çš„å®ç°æ–¹æ¡ˆè¿›è¡Œé‡æ„</p><p>2ã€ç»§ç»­ç ”ç©¶ EmojiCompat ï¼Œçœ‹æ˜¯å¦æœ‰æ–°çš„è§£å†³æ€è·¯</p><p>æˆ‘è¿™ä¸ªäººæ¯”è¾ƒå–œæ¬¢å·æ‡’ï¼Œ1 å› ä¸ºæ„Ÿè§‰éœ€è¦èŠ±è´¹å¾ˆå¤šæ—¶é—´å’Œç²¾åŠ›è¢«æˆ‘ pass æ‰äº†ï¼Œ2 å¦‚æœèƒ½ç ”ç©¶è§£å†³ï¼Œé‚£æ”¹åŠ¨å°±éå¸¸çš„å°äº†</p><p>æŠ±ç€è¯•ä¸€è¯•çš„å¿ƒæ€ï¼Œæˆ‘é€‰æ‹©äº† 2ï¼Œç»§ç»­ç ”ç©¶ EmojiCompat</p><h2 id="ä¸ƒã€EmojiCompat-æºç åˆ†æ"><a href="#ä¸ƒã€EmojiCompat-æºç åˆ†æ" class="headerlink" title="ä¸ƒã€EmojiCompat æºç åˆ†æ"></a>ä¸ƒã€EmojiCompat æºç åˆ†æ</h2><p>å»ºè®®ä½ é…åˆæºç è·Ÿç€æˆ‘çš„æ€è·¯å¾€ä¸‹èµ°</p><p>æˆ‘ä»¬ä» EmojiCompat åˆå§‹åŒ–å¼€å§‹åˆ†æï¼Œå¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> EmojiCompat <span class="hljs-title function_">init</span><span class="hljs-params">(<span class="hljs-meta">@NonNull</span> <span class="hljs-keyword">final</span> Config config)</span> &#123;<br>    <span class="hljs-keyword">if</span> (sInstance == <span class="hljs-literal">null</span>) &#123;<br>        <span class="hljs-keyword">synchronized</span> (sInstanceLock) &#123;<br>            <span class="hljs-keyword">if</span> (sInstance == <span class="hljs-literal">null</span>) &#123;<br>                sInstance = <span class="hljs-keyword">new</span> <span class="hljs-title class_">EmojiCompat</span>(config);<br>            &#125;<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">return</span> sInstance;<br>&#125;<br></code></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ï¼Œä¸Šé¢å°±æ˜¯æŠŠ config ä¼ è¿›æ¥ï¼Œé€šè¿‡åŒé‡æ ¡éªŒçš„æ–¹å¼åˆ›å»ºäº†ä¸€ä¸ªå•ä¾‹å¯¹è±¡ï¼Œæ¥ç€çœ‹ EmojiCompat çš„è¿™ä¸ªæ„é€ æ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> <span class="hljs-title function_">EmojiCompat</span><span class="hljs-params">(<span class="hljs-meta">@NonNull</span> <span class="hljs-keyword">final</span> Config config)</span> &#123;<br>    <span class="hljs-comment">//...</span><br>    mHelper = Build.VERSION.SDK_INT &lt; <span class="hljs-number">19</span> ? <span class="hljs-keyword">new</span> <span class="hljs-title class_">CompatInternal</span>(<span class="hljs-built_in">this</span>) : <span class="hljs-keyword">new</span> <span class="hljs-title class_">CompatInternal19</span>(<span class="hljs-built_in">this</span>);<br>    loadMetadata();<br>&#125;<br></code></pre></td></tr></table></figure><p>ä¸Šè¿°ä»£ç å®é™…ä¸Šå°±æ˜¯åšäº†ä¸€äº›å±æ€§åˆå§‹åŒ–çš„å·¥ä½œï¼ŒmHelper åœ¨ç³»ç»Ÿç‰ˆæœ¬å°äº 19 å’Œ ç³»ç»Ÿç‰ˆæœ¬å¤§äºç­‰äº 19 åˆ›å»ºçš„å®ä¾‹æœ‰æ‰€ä¸åŒï¼Œæˆ‘ä»¬çœ‹ä¸‹è¿™ä¸¤ä¸ªç±»ï¼Œå› ä¸ºä»£ç å¤ªé•¿å°±ä¸è´´ä»£ç äº†ï¼š</p><p>CompatInternal ç±»ï¼šé‡Œé¢éƒ½æ˜¯ä¸€äº›é»˜è®¤å®ç°</p><p>CompatInternal19 ç±»ï¼šç»§æ‰¿ CompatInternalï¼Œå¹¶é‡çˆ¶ç±»çš„æ–¹æ³•ä»è€Œè¾¾åˆ°å®ç°åŠŸèƒ½çš„æ•ˆæœ</p><p>æˆ‘ä»¬ä¸»è¦è·Ÿè¿›æœ€åä¸€è¡Œä»£ç  loadMetadata æ–¹æ³•ï¼Œè§åçŸ¥æ„ï¼ŒloadMetadata å°±æ˜¯åŠ è½½å…ƒæ•°æ®å³æ‹‰å–å­—ä½“æ–‡ä»¶ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">loadMetadata</span><span class="hljs-params">()</span> &#123;<br>    mInitLock.writeLock().lock();<br>    <span class="hljs-keyword">try</span> &#123;<br>        <span class="hljs-keyword">if</span> (mMetadataLoadStrategy == LOAD_STRATEGY_DEFAULT) &#123;<br>            mLoadState = LOAD_STATE_LOADING;<br>        &#125;<br>    &#125; <span class="hljs-keyword">finally</span> &#123;<br>        mInitLock.writeLock().unlock();<br>    &#125;<br><br>    <span class="hljs-keyword">if</span> (getLoadState() == LOAD_STATE_LOADING) &#123;<br>        mHelper.loadMetadata();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ä¸Šè¿°ä»£ç æ­¥éª¤ï¼š</p><p>1ã€å°† mLoadState ç½®ä¸º LOAD_STATE_LOADING è¿›è¡Œä¸Šé”æ“ä½œï¼Œé˜²æ­¢å¤šçº¿ç¨‹å¹¶å‘ï¼Œå¯¼è‡´é‡å¤åˆå§‹åŒ–</p><p>2ã€å¦‚æœå½“å‰çŠ¶æ€ä¸º LOAD_STATE_LOADING , åˆ™è°ƒç”¨ mHelper.loadMetadata()</p><p>æ¥ç€åˆ†æ mHelper.loadMetadata()</p><p>å½“ç³»ç»Ÿç‰ˆæœ¬å°äº 19 çš„æ—¶å€™ï¼Œä¼šèµ°å¦‚ä¸‹ä»£ç ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">void</span> <span class="hljs-title function_">loadMetadata</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-comment">// Moves into LOAD_STATE_SUCCESS state immediately.</span><br>    mEmojiCompat.onMetadataLoadSuccess();<br>&#125;<br></code></pre></td></tr></table></figure><p>è·Ÿè¿› mEmojiCompat.onMetadataLoadSuccess æ–¹æ³•çœ‹ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">void</span> <span class="hljs-title function_">onMetadataLoadSuccess</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-comment">//...</span><br>    mInitLock.writeLock().lock();<br>    <span class="hljs-keyword">try</span> &#123;<br>        mLoadState = LOAD_STATE_SUCCEEDED;<br>    &#125; <span class="hljs-keyword">finally</span> &#123;<br>        mInitLock.writeLock().unlock();<br>    &#125;<br><br>    mMainHandler.post(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ListenerDispatcher</span>(initCallbacks, mLoadState));<br>&#125;<br></code></pre></td></tr></table></figure><p>ä¸Šè¿°ä»£ç æ­¥éª¤ï¼š</p><p>1ã€å°† mLoadState ç½®ä¸ºLOAD_STATE_SUCCEEDED ï¼ˆå³åˆå§‹åŒ–æˆåŠŸï¼‰è¿›è¡Œä¸Šé”æ“ä½œï¼Œé˜²æ­¢å¤šçº¿ç¨‹å¹¶å‘</p><p>2ã€é€šè¿‡ä¸»çº¿ç¨‹ mMainHandler å°†æ¶ˆæ¯å‘é€åˆ°ä¸»çº¿ç¨‹å¤„ç†</p><p>3ã€é€šè¿‡ ListenerDispatcher è¿›è¡Œç›‘å¬çš„åˆ†å‘ï¼Œæœ€ç»ˆä¼šå›è°ƒåˆ°æˆ‘ä»¬ä¹‹å‰åˆå§‹åŒ–é…ç½®çš„ç›‘å¬</p><p>å¯ä»¥çœ‹åˆ°ï¼Œå½“ç³»ç»Ÿç‰ˆæœ¬å°äº 19  å°±ç›´æ¥å›è°ƒæˆåŠŸäº†ï¼Œå¹¶æ²¡æœ‰ä»»ä½•æ‹‰å–å­—ä½“çš„æ“ä½œï¼Œå®é™…å½“ç³»ç»Ÿç‰ˆæœ¬å°äº 19 çš„æ—¶å€™éƒ½æ˜¯ä¸€äº›é»˜è®¤å®ç°ï¼Œæ„Ÿå…´è¶£çš„å¯ä»¥çœ‹çœ‹æºç ã€‚å› æ­¤å½“ç³»ç»Ÿç‰ˆæœ¬å°äº 19 çš„æ—¶å€™ï¼ŒEmojiCompat æ”¯æŒåº“å¹¶ä¸ä¼šèµ·ä½œç”¨</p><p>æ¥ç€çœ‹å½“ç³»ç»Ÿç‰ˆæœ¬å¤§äºç­‰äº 19 çš„æ—¶å€™ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">void</span> <span class="hljs-title function_">loadMetadata</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-keyword">try</span> &#123;<br>        <span class="hljs-keyword">final</span> <span class="hljs-type">MetadataRepoLoaderCallback</span> <span class="hljs-variable">callback</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">MetadataRepoLoaderCallback</span>() &#123;<br>            <span class="hljs-meta">@Override</span><br>            <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onLoaded</span><span class="hljs-params">(<span class="hljs-meta">@NonNull</span> MetadataRepo metadataRepo)</span> &#123;<br>                onMetadataLoadSuccess(metadataRepo);<br>            &#125;<br><br>            <span class="hljs-meta">@Override</span><br>            <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onFailed</span><span class="hljs-params">(<span class="hljs-meta">@Nullable</span> Throwable throwable)</span> &#123;<br>                mEmojiCompat.onMetadataLoadFailed(throwable);<br>            &#125;<br>        &#125;;<br>        mEmojiCompat.mMetadataLoader.load(callback);<br>    &#125; <span class="hljs-keyword">catch</span> (Throwable t) &#123;<br>        mEmojiCompat.onMetadataLoadFailed(t);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ä¸Šè¿°ä»£ç æ­¥éª¤ï¼š</p><p>1ã€åˆ›å»ºäº†ä¸€ä¸ª MetadataRepoLoaderCallback çš„ callback</p><p>2ã€å¦‚æœ callback å›è°ƒ onLoaded æ–¹æ³•ï¼Œåˆ™ä¼šè°ƒ onMetadataLoadSuccess ï¼Œé‚£ä¹ˆå°±ç›´æ¥åˆå§‹åŒ–æˆåŠŸäº†</p><p>3ã€å¦‚æœ callback å›è°ƒ onFailed æ–¹æ³•ï¼Œåˆ™ä¼šè°ƒ mEmojiCompat.onMetadataLoadFailed(throwable)ï¼Œé‚£ä¹ˆå°±ä¼šåˆå§‹åŒ–å¤±è´¥</p><p>4ã€æœ€ç»ˆä¼šé€šè¿‡ mEmojiCompat.mMetadataLoader çš„ load æ–¹æ³•å»åŠ è½½è¿™ä¸ª callback</p><p>åˆ°è¿™é‡Œæˆ‘ä»¬è¿˜æ˜¯æ²¡æœ‰çœ‹åˆ°æ‹‰å–å­—ä½“çš„æ“ä½œï¼Œè€Œæ˜¯æŠŠè¿™ä¸ª callback ä¼ å…¥åˆ°äº† load æ–¹æ³•ä¸­</p><p>æ¥ä¸‹æ¥æˆ‘ä»¬ç»§ç»­åˆ†æ load æ–¹æ³•ï¼Œload æ–¹æ³•æ˜¯ mMetadataLoader çš„ï¼ŒmMetadataLoader æ˜¯ EmojiCompat çš„ä¸€ä¸ªå±æ€§ï¼Œè€Œä¸”åœ¨ EmojiCompat çš„æ„é€ æ–¹æ³•é‡Œåšäº†èµ‹å€¼æ“ä½œï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> <span class="hljs-title function_">EmojiCompat</span><span class="hljs-params">(<span class="hljs-meta">@NonNull</span> <span class="hljs-keyword">final</span> Config config)</span> &#123;<br>    <span class="hljs-comment">//...</span><br>    mMetadataLoader = config.mMetadataLoader;<br>    <span class="hljs-comment">//...</span><br>&#125;<br></code></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ï¼ŒEmojiCompat çš„ mMetadataLoader æ˜¯ä»æˆ‘ä»¬ä¼ è¿›æ¥çš„ config ä¸­æ‹¿çš„ï¼Œç°åœ¨é—®é¢˜å°±è½¬å˜åˆ°äº†æˆ‘ä»¬é…ç½®çš„ config ä¸­ï¼Œæˆ‘ä»¬çœ‹ä¸€çœ¼å¯ä¸‹è½½å­—ä½“é…ç½®çš„ configï¼Œçœ‹ä¸»è¦æµç¨‹çš„ä¸€äº›ä»£ç ï¼Œå…¶ä»–çš„ç»™çœç•¥äº†ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">FontRequestEmojiCompatConfig</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">EmojiCompat</span>.Config &#123;<br>    <span class="hljs-comment">//...</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">FontRequestMetadataLoader</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">EmojiCompat</span>.MetadataRepoLoader &#123;<br>        <span class="hljs-meta">@Override</span><br>        <span class="hljs-meta">@RequiresApi(19)</span><br>        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">load</span><span class="hljs-params">(<span class="hljs-meta">@NonNull</span> <span class="hljs-keyword">final</span> EmojiCompat.MetadataRepoLoaderCallback loaderCallback)</span> &#123;<br>            Preconditions.checkNotNull(loaderCallback, <span class="hljs-string">&quot;LoaderCallback cannot be null&quot;</span>);<br>            <span class="hljs-keyword">synchronized</span> (mLock) &#123;<br>                <span class="hljs-keyword">if</span> (mHandler == <span class="hljs-literal">null</span>) &#123;<br>                    mThread = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HandlerThread</span>(<span class="hljs-string">&quot;emojiCompat&quot;</span>, Process.THREAD_PRIORITY_BACKGROUND);<br>                    mThread.start();<br>                    mHandler = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Handler</span>(mThread.getLooper());<br>                &#125;<br>                mHandler.post(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Runnable</span>() &#123;<br>                    <span class="hljs-meta">@Override</span><br>                    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span><span class="hljs-params">()</span> &#123;<br>                        mCallback = loaderCallback;<br>                        createMetadata();<br>                    &#125;<br>                &#125;);<br>            &#125;<br>        &#125;<br><br>        <span class="hljs-meta">@RequiresApi(19)</span><br>        <span class="hljs-keyword">void</span> <span class="hljs-title function_">createMetadata</span><span class="hljs-params">()</span> &#123;<br>            <span class="hljs-keyword">try</span> &#123;<br>              <span class="hljs-comment">//...</span><br>              <span class="hljs-keyword">final</span> FontsContractCompat.<span class="hljs-type">FontInfo</span> <span class="hljs-variable">font</span> <span class="hljs-operator">=</span> retrieveFontInfo();<br>                <span class="hljs-keyword">final</span> <span class="hljs-type">Typeface</span> <span class="hljs-variable">typeface</span> <span class="hljs-operator">=</span> mFontProviderHelper.buildTypeface(mContext, font);<br>                <span class="hljs-keyword">final</span> <span class="hljs-type">ByteBuffer</span> <span class="hljs-variable">buffer</span> <span class="hljs-operator">=</span> TypefaceCompatUtil.mmap(mContext, <span class="hljs-literal">null</span>, font.getUri());<br>                <span class="hljs-keyword">if</span> (buffer == <span class="hljs-literal">null</span>) &#123;<br>                    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">&quot;Unable to open file.&quot;</span>);<br>                &#125;<br>                mCallback.onLoaded(MetadataRepo.create(typeface, buffer));<br>                cleanUp();<br>            &#125; <span class="hljs-keyword">catch</span> (Throwable t) &#123;<br>                mCallback.onFailed(t);<br>                cleanUp();<br>            &#125;<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>1ã€FontRequestMetadataLoader å®ç°äº† EmojiCompat.MetadataRepoLoader æ¥å£ï¼Œå®ƒæ˜¯ FontRequestEmojiCompatConfig çš„ä¸€ä¸ªé™æ€å†…éƒ¨ç±»ï¼Œå¹¶é‡å†™äº† load æ–¹æ³•</p><p>2ã€load æ–¹æ³•ä¸»è¦åšçš„äº‹æƒ…æ˜¯ï¼šé€šè¿‡ HandlerThread é…åˆ Handler æŠŠçº¿ç¨‹åˆ‡æ¢åˆ°å­çº¿ç¨‹ï¼Œå°†ä¼ è¿›æ¥çš„ loaderCallback(ä¹Ÿå°±æ˜¯æˆ‘ä»¬å‰é¢åˆ†æçš„é‚£ä¸ª callback) èµ‹å€¼ç»™äº† mCallBackï¼Œå¹¶æ‰§è¡Œ  createMetadata æ–¹æ³•</p><p>æ¥ç€çœ‹ createMetadata æ–¹æ³•ï¼Œå®ƒé‡Œé¢åšçš„ä¸»è¦äº‹æƒ…å°±æ˜¯ï¼š</p><p>1ã€é€šè¿‡ GMS æœåŠ¡æ‹‰å–å­—ä½“ä¿¡æ¯ï¼Œç»ˆäºçœ‹åˆ°äº†è¿™ä¸ªæ“ä½œ</p><p>2ã€é€šè¿‡æ‹‰å–çš„å­—ä½“ä¿¡æ¯æ„å»ºä¸€ä¸ª Typeface å¯¹è±¡</p><p>3ã€é€šè¿‡æ‹‰å–çš„å­—ä½“ä¿¡æ¯æ„å»ºä¸€ä¸ª ByteBuffer æµå¯¹è±¡</p><p>4ã€é€šè¿‡ typeface å’Œ buffer æ„å»ºä¸€ä¸ª MetadataRepo å¯¹è±¡å¹¶æœ€ç»ˆå›è°ƒ onLoaded æ–¹æ³•ï¼Œåˆå§‹åŒ–æˆåŠŸ</p><p>MetadataRepo è§£é‡Šï¼šå®é™…ä¸Š MetadataRepo å°±æ˜¯ EmojiCompat å¤„ç†å’Œç»˜åˆ¶è¡¨æƒ…çš„ä¸€ä¸ªæ•°æ®ä»“åº“ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸‰ç§æ–¹å¼å»æ„å»ºå®ƒï¼š</p><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/4fb9455f949940dd8b2354fb3d1f7a53~tplv-k3u1fbpfcp-zoom-1.image" alt="image-20210526191217511"></p><p>ä»æˆªå›¾ä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°å®ƒæœ‰ä¸‰ä¸ªé‡è½½æ–¹æ³•ï¼š</p><p>1ã€æ–¹å¼ä¸€ï¼šä¼ å…¥ä¸€ä¸ª Typeface å¯¹è±¡å’Œä¸€ä¸ª InputStream æµå¯¹è±¡</p><p>2ã€æ–¹å¼äºŒï¼šä¼ å…¥ä¸€ä¸ª  Typeface å¯¹è±¡å’Œä¸€ä¸ª ByteBuffer æµå¯¹è±¡</p><p>3ã€æ–¹å¼ä¸‰ï¼šä¼ å…¥ä¸€ä¸ª AssetManager å¯¹è±¡å’Œä¸€ä¸ª assetPath è·¯å¾„</p><p>å®é™…ä¸Šï¼Œå¯ä¸‹è½½å­—ä½“é…ç½®ç”¨çš„å°±æ˜¯æ–¹å¼äºŒï¼Œæœ¬åœ°æ†ç»‘å­—ä½“é…ç½®ç”¨çš„æ˜¯æ–¹å¼ä¸‰ï¼Œ<strong>æˆ‘ä»¬è¿˜æœ‰æ–¹å¼ä¸€å¯ä»¥ç”¨ï¼Œè¿™ä¹Ÿæ˜¯åç»­è§£å†³é—®é¢˜çš„ä¸€ä¸ªçªç ´å£</strong></p><p>4ã€å¦‚æœæµç¨‹æœ‰ä»»ä½•å¼‚å¸¸ï¼Œèµ°åˆ° catch é‡Œé¢ï¼Œæœ€ç»ˆå›è°ƒ onFailed æ–¹æ³•ï¼Œåˆå§‹åŒ–å¤±è´¥</p><p>é€šè¿‡ä¸Šé¢æµç¨‹çš„ä¸€ä¸ªåˆ†ææˆ‘ä»¬å¯ä»¥çŸ¥é“ï¼šEmojiCompat ä¼šé€šè¿‡ä¼ å…¥çš„ config ä¸­çš„ MetadataRepoLoader çš„ load æ–¹æ³•åˆ‡æ¢åˆ°å­çº¿ç¨‹å»æ‹‰å–å­—ä½“æ–‡ä»¶ï¼Œå¦‚æœæ‹‰å–æˆåŠŸå¹¶æˆåŠŸæ„å»º MetadataRepo å¯¹è±¡ï¼Œåˆ™èƒ½åˆå§‹åŒ–æˆåŠŸï¼Œå¦‚æœæ‹‰å–å¤±è´¥ï¼Œåˆ™ä¼šåˆå§‹åŒ–å¤±è´¥</p><p>æºç åˆ†æåˆ°äº†è¿™é‡Œï¼Œä½ å¿ƒé‡Œæ˜¯å¦æœ‰äº†æ–°çš„æ€è·¯äº†å‘¢ï¼Ÿè¿˜è®°å¾—ä¸Šé¢æˆ‘é¢„ç•™çš„ä¸€ä¸ªé—®é¢˜å—ï¼Ÿ</p><p>æˆ‘ä»¬æ˜¯å¦å¯ä»¥æ„å»ºä¸€ä¸ªè‡ªå®šä¹‰çš„å­—ä½“é…ç½®å»å®Œæˆ EmojiCompat çš„åˆå§‹åŒ–å‘¢ï¼Ÿ</p><p>å½“æ—¶åªæ˜¯çŒœæƒ³ï¼Œæˆ‘ä»¬ç°åœ¨ç†æ€§åˆ†æä¸€æ³¢ï¼š</p><p>1ã€ä¸Šé¢æˆ‘ä»¬ä½¿ç”¨çš„å¯ä¸‹è½½çš„å­—ä½“é…ç½®æ˜¯é€šè¿‡ GMS æœåŠ¡æ‹‰å–çš„å­—ä½“æ–‡ä»¶ï¼Œç„¶åé€šè¿‡ä¸Šè¿°æ–¹å¼äºŒå»æ„å»º MetadataRepoï¼Œæœ€ç»ˆåˆå§‹åŒ–æˆåŠŸ</p><p>2ã€æœ¬åœ°æ†ç»‘å­—ä½“é…ç½®æ˜¯é€šè¿‡ä»æœ¬åœ° assets æ–‡ä»¶å¤¹ä¸‹æ‹‰å–å­—ä½“æ–‡ä»¶ï¼Œç„¶åé€šè¿‡æ–¹å¼ä¸‰å»æ„å»º MetadataRepoï¼Œæœ€ç»ˆåˆå§‹åŒ–æˆåŠŸ</p><p>é‚£ä¹ˆä¾è‘«èŠ¦ç”»ç“¢ï¼šæˆ‘æ˜¯å¦å¯ä»¥æ„å»ºä¸€ä¸ªè‡ªå®šä¹‰çš„å­—ä½“é…ç½®ï¼ŒæŠŠå­—ä½“å­˜åˆ°æˆ‘ä»¬è‡ªå·±çš„æœåŠ¡å™¨ï¼Œåœ¨ä»æœåŠ¡å™¨ä¸Šå»æ‹‰å–å­—ä½“ï¼Œæ‹‰å–æˆåŠŸåï¼Œé€šè¿‡æ–¹å¼ä¸€å»æ„å»º MetadataRepoï¼Œé‚£ä¹ˆè¿™æ ·æ˜¯å¦ä¹Ÿèƒ½åˆå§‹åŒ–æˆåŠŸå‘¢ï¼Ÿ</p><p>å—¯ï¼Œæ„Ÿè§‰æ–¹æ¡ˆå¯è¡Œï¼Œå¹²å°±å®Œäº†</p><h2 id="å…«ã€æ–°æ–¹æ¡ˆå®è·µ"><a href="#å…«ã€æ–°æ–¹æ¡ˆå®è·µ" class="headerlink" title="å…«ã€æ–°æ–¹æ¡ˆå®è·µ"></a>å…«ã€æ–°æ–¹æ¡ˆå®è·µ</h2><p>é€šè¿‡ä¸Šé¢çš„åˆ†æï¼Œæˆ‘ä»¬æœ‰äº†æ–°çš„æ€è·¯ï¼Œä¸‹é¢æ˜¯æˆ‘å®è·µçš„ä¸€ä¸ªè¿‡ç¨‹ï¼Œå› ä»£ç å¤ªå¤šï¼Œè´´å‡ºéƒ¨åˆ†å…³é”®ä»£ç ï¼Œä¸»è¦å…³æ³¨è§£å†³é—®é¢˜çš„æ€è·¯ï¼š</p><p>1ã€å°† Google å®˜æ–¹æä¾›çš„ NotoColorEmojiCompat.ttf å­—ä½“æ–‡ä»¶ï¼Œä¸Šä¼ åˆ°æˆ‘ä»¬è‡ªå·±çš„æœåŠ¡å™¨</p><p>2ã€é’ˆå¯¹æ²¡æœ‰ GMS çš„æ‰‹æœºï¼ŒEmojiCompat ä¼šåˆå§‹åŒ–å¤±è´¥ï¼Œé‚£ä¹ˆåœ¨ EmojiCompat é¦–æ¬¡åˆå§‹åŒ–å¤±è´¥åï¼Œåœ¨å®ƒå¤±è´¥çš„å›è°ƒé‡Œé¢å¯åŠ¨ä¸€ä¸ªä¸‹è½½ä»»åŠ¡å»ä¸‹è½½ NotoColorEmojiCompat.ttf è¿™ä¸ªå­—ä½“</p><p>3ã€è‹¥ä¸‹è½½æˆåŠŸï¼Œåˆ™æ„é€ ä¸€ä¸ªè‡ªå®šä¹‰çš„å­—ä½“é…ç½®é‡æ–°åˆå§‹åŒ– EmojiCompat</p><p>ä¸‹é¢æ˜¯ä¸€äº›å…³é”®çš„ä»£ç ï¼Œä»…ä¾›å‚è€ƒï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//åˆå§‹åŒ– EmojiCompat</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">initEmotionCompat</span><span class="hljs-params">(Context mContext)</span> &#123;<br>    <span class="hljs-type">FontRequest</span> <span class="hljs-variable">fontRequest</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">FontRequest</span>(<br>            <span class="hljs-string">&quot;com.google.android.gms.fonts&quot;</span>,<br>            <span class="hljs-string">&quot;com.google.android.gms&quot;</span>,<br>            <span class="hljs-string">&quot;Noto Color Emoji Compat&quot;</span>,<br>            R.array.chat_com_google_android_gms_fonts_certs);<br>    EmojiCompat.<span class="hljs-type">Config</span> <span class="hljs-variable">config</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">FontRequestEmojiCompatConfig</span>(mContext, fontRequest);<br>    config.setReplaceAll(<span class="hljs-literal">true</span>);<br>    config.registerInitCallback(<span class="hljs-keyword">new</span> <span class="hljs-title class_">EmojiCompat</span>.InitCallback() &#123;<br>        <span class="hljs-meta">@Override</span><br>        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onInitialized</span><span class="hljs-params">()</span> &#123;<br>            Log.e(TAG, <span class="hljs-string">&quot;loadEmojiFontFromNetwork()-&gt;onInitialized()&quot;</span>);<br>        &#125;<br><br>        <span class="hljs-meta">@Override</span><br>        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onFailed</span><span class="hljs-params">(<span class="hljs-meta">@Nullable</span> Throwable throwable)</span> &#123;<br>            Log.e(TAG, <span class="hljs-string">&quot;loadEmojiFontFromNetwork()-&gt;onFailed():&quot;</span> + throwable.getMessage());<br>            <span class="hljs-comment">//è‹¥åˆå§‹åŒ–å¤±è´¥åˆ™æ‰§è¡Œä¸‹è½½å­—ä½“æ“ä½œ</span><br>            downloadFont(mContext,<span class="hljs-string">&quot;ä½ çš„å­—ä½“ä¸‹è½½ url &quot;</span>);<br>        &#125;<br>    &#125;);<br>    EmojiCompat.init(config);<br>&#125;<br><br><span class="hljs-comment">//ä¸‹è½½å­—ä½“</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">downloadFont</span><span class="hljs-params">(Context mContext,String fontUrl)</span>&#123;<br>    EmojiFontDownloadUtils.downloadFont(fontUrl,<span class="hljs-keyword">new</span> <span class="hljs-title class_">EmojiFontPreloadUtils</span>.OnEmojiFontDownloadListener() &#123;<br>        <span class="hljs-meta">@Override</span><br>        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onSuccess</span><span class="hljs-params">(File file)</span> &#123;<br>            <span class="hljs-comment">//ä¸‹è½½æˆåŠŸï¼Œé‡æ–°åˆå§‹åŒ– EmojiCompat</span><br>            resetConfig(mContext);<br>        &#125;<br><br>        <span class="hljs-meta">@Override</span><br>        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onFailed</span><span class="hljs-params">(Throwable throwable)</span> &#123;<br>            Log.e(TAG, <span class="hljs-string">&quot;onFailed: &quot;</span> + throwable.getMessage());<br>        &#125;<br>    &#125;);<br>&#125;<br><br><span class="hljs-comment">//é‡æ–°åˆå§‹åŒ–</span><br><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">resetConfig</span><span class="hljs-params">(Context mContext)</span> &#123;<br>    <span class="hljs-comment">//æ„å»ºè‡ªå®šä¹‰å­—ä½“é…ç½®</span><br>    <span class="hljs-keyword">final</span> EmojiCompat.<span class="hljs-type">Config</span> <span class="hljs-variable">config</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">LocalEmojiCompatConfig</span>(mContext);<br>    config.registerInitCallback(<span class="hljs-keyword">new</span> <span class="hljs-title class_">EmojiCompat</span>.InitCallback() &#123;<br>        <span class="hljs-meta">@Override</span><br>        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onInitialized</span><span class="hljs-params">()</span> &#123;<br>            Log.e(TAG, <span class="hljs-string">&quot;reInit success...&quot;</span>);<br>        &#125;<br><br>        <span class="hljs-meta">@Override</span><br>        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onFailed</span><span class="hljs-params">(<span class="hljs-meta">@Nullable</span> Throwable throwable)</span> &#123;<br>            Log.e(TAG, <span class="hljs-string">&quot;reInit failed:&quot;</span> + throwable.getMessage());<br>        &#125;<br>    &#125;);<br>    <span class="hljs-comment">//é‡ç½®åˆå§‹åŒ–é…ç½®è¿›è¡Œé‡æ–°åˆå§‹åŒ–</span><br>    EmojiCompat.reset(config);<br>&#125;<br></code></pre></td></tr></table></figure><p> å¯èƒ½å¤§å®¶æƒ³çœ‹çœ‹æˆ‘æ„å»ºçš„è‡ªå®šä¹‰å­—ä½“é…ç½®é•¿å•¥æ ·ï¼Ÿå®‰æ’ğŸ˜„ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LocalEmojiCompatConfig</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">EmojiCompat</span>.Config &#123;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">LocalEmojiCompatConfig</span><span class="hljs-params">(<span class="hljs-meta">@NonNull</span> Context context)</span> &#123;<br>        <span class="hljs-built_in">super</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">LocalEmojiCompatConfig</span>.LocalMetadataLoader(context));<br>    &#125;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LocalMetadataLoader</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">EmojiCompat</span>.MetadataRepoLoader &#123;<br>        <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Context mContext;<br><br>        LocalMetadataLoader(<span class="hljs-meta">@NonNull</span> Context context) &#123;<br>            mContext = context.getApplicationContext();<br>        &#125;<br><br>        <span class="hljs-meta">@Override</span><br>        <span class="hljs-meta">@RequiresApi(19)</span><br>        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">load</span><span class="hljs-params">(<span class="hljs-meta">@NonNull</span> EmojiCompat.MetadataRepoLoaderCallback loaderCallback)</span> &#123;<br>            Preconditions.checkNotNull(loaderCallback, <span class="hljs-string">&quot;loaderCallback cannot be null&quot;</span>);<br>            <span class="hljs-comment">//å¼€å¯å­çº¿ç¨‹æ‰§è¡Œä»»åŠ¡</span><br>            <span class="hljs-keyword">final</span> LocalEmojiCompatConfig.<span class="hljs-type">InitRunnable</span> <span class="hljs-variable">runnable</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">LocalEmojiCompatConfig</span>.InitRunnable(mContext, loaderCallback);<br>            <span class="hljs-keyword">final</span> <span class="hljs-type">Thread</span> <span class="hljs-variable">thread</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(runnable);<br>            thread.setDaemon(<span class="hljs-literal">false</span>);<br>            thread.start();<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-meta">@RequiresApi(19)</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">InitRunnable</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Runnable</span> &#123;<br>        <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> EmojiCompat.MetadataRepoLoaderCallback mLoaderCallback;<br>        <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Context mContext;<br><br>        InitRunnable(Context context, EmojiCompat.MetadataRepoLoaderCallback loaderCallback) &#123;<br>            mContext = context;<br>            mLoaderCallback = loaderCallback;<br>        &#125;<br><br>        <span class="hljs-meta">@Override</span><br>        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span><span class="hljs-params">()</span> &#123;<br>            <span class="hljs-keyword">try</span> &#123;<br>              <span class="hljs-comment">//æ„å»º MetadataRepo </span><br>                <span class="hljs-keyword">final</span> <span class="hljs-type">Typeface</span> <span class="hljs-variable">typeface</span> <span class="hljs-operator">=</span> Typeface.createFromFile(EmojiFontPreloadUtils.getFile());<br>                <span class="hljs-keyword">final</span> <span class="hljs-type">InputStream</span> <span class="hljs-variable">inputStream</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">FileInputStream</span>(EmojiFontPreloadUtils.getFile());<br>                <span class="hljs-keyword">final</span> <span class="hljs-type">MetadataRepo</span> <span class="hljs-variable">metadataRepo</span> <span class="hljs-operator">=</span> MetadataRepo.create(typeface, inputStream);<br>                mLoaderCallback.onLoaded(metadataRepo);<br>            &#125; <span class="hljs-keyword">catch</span> (Throwable t) &#123;<br>                mLoaderCallback.onFailed(t);<br>            &#125;<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>å…¶å®è¿™ä¸ªè‡ªå®šä¹‰çš„å­—ä½“é…ç½®å¾ˆç®€å•ï¼Œå°±æ˜¯ä»¿ç…§ä¹‹å‰æˆ‘ä»¬åˆ†æçš„é‚£ä¸ªæºç æµç¨‹ï¼Œç»“åˆå¯ä¸‹è½½å­—ä½“é…ç½®çš„æ€è·¯å†™å‡ºæ¥çš„ï¼Œä¸Šè¿°è‡ªå®šä¹‰çš„å­—ä½“é…ç½®ä¸»è¦åšçš„äº‹æƒ…ï¼š</p><p>1ã€åœ¨ load æ–¹æ³•é‡Œé¢å¼€å¯ä¸€ä¸ªå­çº¿ç¨‹æ‰§è¡Œä»»åŠ¡</p><p>2ã€åœ¨å¯æ‰§è¡Œçš„ä»»åŠ¡é‡Œé¢é€šè¿‡æ–¹å¼ä¸€æ„å»º MetadataRepo æœ€ç»ˆå®Œæˆåˆå§‹åŒ–æ“ä½œ</p><p>æœ€ç»ˆç»è¿‡å®è·µï¼Œå‘ç°è¿™ç§æ–¹æ¡ˆèƒ½å¤Ÿåˆå§‹åŒ–æˆåŠŸï¼Œé—®é¢˜è§£å†³</p><h2 id="ä¹ã€æ€»ç»“"><a href="#ä¹ã€æ€»ç»“" class="headerlink" title="ä¹ã€æ€»ç»“"></a>ä¹ã€æ€»ç»“</h2><p>æ¢³ç†ä¸€ä¸‹è¿™ç¯‡æ–‡ç« æˆ‘ä»¬æ‰€è®²çš„ä¸€äº›ä¸œè¥¿ï¼š</p><p>é¦–å…ˆä»‹ç»äº† Emoji è¡¨æƒ…ï¼Œè®²äº†ä¸‹æˆ‘æ¥åˆ°çš„éœ€æ±‚ï¼Œç„¶åå¯¹ Emoji è¡¨æƒ…æ–¹æ¡ˆè¿›è¡Œäº†å®è·µï¼Œå‘ç°æœ‰æ˜¾ç¤ºé—®é¢˜ï¼Œäºæ˜¯å¼•å…¥  EmojiCompat æ”¯æŒåº“è§£å†³äº†æ˜¾ç¤ºé—®é¢˜ï¼Œä½†æ˜¯å‘ç°åœ¨æ²¡æœ‰ GMS æœåŠ¡çš„æ‰‹æœºä¸Šæ˜¾ç¤ºä»ç„¶ä¼šå‡ºç°ä¸€äº›æ˜¾ç¤ºé—®é¢˜ï¼Œäºæ˜¯æˆ‘ä»¬é€šè¿‡å°†å­—ä½“æ–‡ä»¶ä¸Šä¼ åˆ°è‡ªå·±çš„æœåŠ¡å™¨ï¼Œå¹¶æ‹‰å–æ„å»ºè‡ªå®šä¹‰çš„å­—ä½“æ–‡ä»¶é…ç½®åˆå§‹åŒ– EmojiCompat è§£å†³äº†è¯¥é—®é¢˜</p><p>å¥½äº†ï¼Œå¦‚æœä½ çœ‹åˆ°è¿™é‡Œï¼Œç›¸ä¿¡ä½ ä¸€å®šæ”¶è·æ»¡æ»¡ï¼Œå¦‚æœæœ‰å•¥é—®é¢˜ï¼Œæ¬¢è¿è¯„è®ºåŒºä¸€èµ·äº¤æµğŸ¤</p><p><strong>æ„Ÿè°¢ä½ é˜…è¯»è¿™ç¯‡æ–‡ç« </strong></p><blockquote><p><strong>ä½ çš„ç‚¹èµï¼Œè¯„è®ºï¼Œæ˜¯å¯¹æˆ‘å·¨å¤§çš„é¼“åŠ±ï¼</strong></p><p>æ¬¢è¿å…³æ³¨æˆ‘çš„<strong>å…¬ä¼—å·ï¼š</strong>  <a href="http://m6z.cn/6jwi7b"><strong>sweetying</strong></a> ï¼Œæ–‡ç« æ›´æ–°å¯ç¬¬ä¸€æ—¶é—´æ”¶åˆ°</p><p>å¦‚æœ<strong>æœ‰é—®é¢˜</strong>ï¼Œå…¬ä¼—å·å†…æœ‰åŠ æˆ‘å¾®ä¿¡çš„å…¥å£ï¼Œåœ¨æŠ€æœ¯å­¦ä¹ ã€ä¸ªäººæˆé•¿çš„é“è·¯ä¸Šï¼Œæˆ‘ä»¬ä¸€èµ·å‰è¿›ï¼</p></blockquote>]]></content>
    
    
    <categories>
      
      <category>Android</category>
      
      <category>ä¸€ç¯‡å°±å¤Ÿ</category>
      
    </categories>
    
    
    <tags>
      
      <tag>åŸåˆ›</tag>
      
      <tag>Android</tag>
      
      <tag>ä¸€ç¯‡å°±å¤Ÿ</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ä¸€ç¯‡å°±å¤Ÿç³»åˆ—ï¼šHandleræ‰©å±•ç¯‡</title>
    <link href="/2022/10/11/%E4%B8%80%E7%AF%87%E5%B0%B1%E5%A4%9F%E7%B3%BB%E5%88%97%EF%BC%9AHandler%E6%89%A9%E5%B1%95%E7%AF%87/"/>
    <url>/2022/10/11/%E4%B8%80%E7%AF%87%E5%B0%B1%E5%A4%9F%E7%B3%BB%E5%88%97%EF%BC%9AHandler%E6%89%A9%E5%B1%95%E7%AF%87/</url>
    
    <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><blockquote><p>Handlerç³»åˆ—æ–‡ç« å…±ä¸¤ç¯‡ï¼š</p><p>ç¬¬ä¸€ç¯‡ï¼š<a href="https://juejin.cn/post/6924084444609544199#heading-5">â€œä¸€ç¯‡å°±å¤Ÿâ€ç³»åˆ—: Handleræ¶ˆæ¯æœºåˆ¶å®Œå…¨è§£æ</a></p><p>ç¬¬äºŒç¯‡ï¼š <a href="https://juejin.cn/post/6932608660354891790/">â€œä¸€ç¯‡å°±å¤Ÿâ€ç³»åˆ—: Handleræ‰©å±•ç¯‡</a></p></blockquote><p>åœ¨<a href="https://juejin.cn/post/6924084444609544199">ä¸Šä¸€ç¯‡</a>ä¸­ï¼Œæˆ‘ä»¬å¯¹Handlerçš„ä¸»ä½“éƒ¨åˆ†è¿›è¡Œäº†è®²è§£ï¼Œä»Šå¤©ï¼Œæˆ‘ä»¬å°±æ¥å­¦ä¹ ä¸€ä¸‹Handlerç›¸å…³çš„ä¸€äº›æ‰©å±•çŸ¥è¯†ï¼Œè®²å®Œè¿™äº›æ‰©å±•çŸ¥è¯†åï¼Œåœ¨æ¥å›ç­”ä¹‹å‰åˆ—å‡ºæ¥çš„ä¸€ç³»åˆ—é—®é¢˜</p><h2 id="åŒæ­¥å±éšœ"><a href="#åŒæ­¥å±éšœ" class="headerlink" title="åŒæ­¥å±éšœ"></a>åŒæ­¥å±éšœ</h2><p>é€šè¿‡ä¸Šä¸€ç¯‡çš„å­¦ä¹ ï¼Œæˆ‘ä»¬çŸ¥é“: Handlerå‘é€çš„Messageä¼šæ”¾å…¥åˆ°MessageQueueä¸­ï¼ŒMessageQueueä¸­ç»´æŠ¤äº†ä¸€ä¸ªä¼˜å…ˆçº§é˜Ÿåˆ—ï¼Œä¼˜å…ˆçº§é˜Ÿåˆ—çš„æ„æ€å°±æ˜¯å°†å­˜å‚¨æ•°æ®çš„å•é“¾è¡¨æŒ‰ç…§æ—¶é—´å‡åºè¿›è¡Œæ’åºå½¢æˆçš„ï¼ŒLooperåˆ™æŒ‰ç…§é¡ºåºï¼Œæ¯æ¬¡ä»è¿™ä¸ªä¼˜å…ˆçº§é˜Ÿåˆ—ä¸­å–å‡ºä¸€ä¸ªMessageè¿›è¡Œåˆ†å‘ï¼Œä¸€ä¸ªå¤„ç†å®Œå°±å¤„ç†ä¸‹ä¸€ä¸ªã€‚</p><p>é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼šæˆ‘èƒ½ä¸èƒ½è®©æˆ‘çš„ä¸€ä¸ªMessageè¢«ä¼˜å…ˆå¤„ç†ï¼Ÿ</p><p>å¯ä»¥ï¼Œä½¿ç”¨åŒæ­¥å±éšœ</p><p>è¿™é‡Œï¼Œæˆ‘å¿ƒé‡Œåˆä¼šæœ‰ä¸ªç–‘é—®ï¼Œä»€ä¹ˆæ˜¯åŒæ­¥å±éšœï¼Ÿæ€ä¹ˆä½¿ç”¨åŒæ­¥å±éšœï¼ŸåŒæ­¥å±éšœæœ‰å•¥ä½œç”¨ï¼Ÿå¸¦ç€è¿™äº›ç–‘é—®ğŸ¤”ï¸ï¼Œæˆ‘ä»¬æ¥åˆ†æä¸‹æºç </p><p>å…ˆçœ‹ä¸‹MessageQueueçš„<code>next</code>æ–¹æ³•ï¼Œåœ¨ä¸Šä¸€ç¯‡ä¸­ï¼Œæˆ‘ä»¬çœç•¥äº†ä¸€éƒ¨åˆ†ä»£ç ï¼Œå…¶ä¸­æœ‰ä¸€éƒ¨åˆ†æ˜¯è¿™æ ·å­çš„ï¼Œä»…è´´å‡ºå…³é”®ä»£ç </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java">Message <span class="hljs-title function_">next</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-comment">//...</span><br>    <span class="hljs-keyword">for</span> (;;) &#123;<br>        <span class="hljs-keyword">synchronized</span> (<span class="hljs-built_in">this</span>) &#123;<br>            <span class="hljs-keyword">if</span> (msg != <span class="hljs-literal">null</span> &amp;&amp; msg.target == <span class="hljs-literal">null</span>) &#123;<br>                <span class="hljs-comment">// Stalled by a barrier.  Find the next asynchronous message in the queue.</span><br>                <span class="hljs-keyword">do</span> &#123;<br>                     prevMsg = msg;<br>                     msg = msg.next;<br>                &#125; <span class="hljs-keyword">while</span> (msg != <span class="hljs-literal">null</span> &amp;&amp; !msg.isAsynchronous());<br>            &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ä¸Šè¿°ä»£ç ï¼š</p><p>1ã€åˆ¤æ–­å½“å‰msgä¸ä¸ºç©ºå¹¶ä¸”msg.targetä¸ºç©ºï¼Œåˆ™è¿›å…¥æ¡ä»¶ä½“é‡Œé¢</p><p>2ã€æ¡ä»¶ä½“é‡Œé¢æœ‰ä¸€è¡Œæºç æ³¨é‡Šï¼Œç¿»è¯‘è¿‡æ¥å°±æ˜¯: <strong>è¢«ä¸€ä¸ªå±éšœç»™é˜»ç¢ã€‚åœ¨é˜Ÿåˆ—ä¸­æŸ¥æ‰¾ä¸‹ä¸€ä¸ªå¼‚æ­¥æ¶ˆæ¯</strong></p><p>3ã€æ¥ä¸‹æ¥å°±æ˜¯ä¸€ä¸ªå¾ªç¯ï¼Œéå†æ‰¾å‡ºä¸€æ¡å¼‚æ­¥æ¶ˆæ¯ï¼Œå¾ªç¯ä½“é‡Œé¢å°±æ˜¯é“¾è¡¨ç›¸å…³çš„æ“ä½œ</p><p>è¿™é‡Œå¤§å®¶æ˜¯ä¸æ˜¯ä¼šæœ‰ä¸ªç–‘é—®ï¼Ÿmsg.targetæ€ä¹ˆå¯èƒ½ä¼šä¸ºç©ºå‘¢ï¼Ÿä¹‹å‰å‘é€æ¶ˆæ¯çš„ä¸€ç³»åˆ—æ–¹æ³•ä¸æ˜¯éƒ½ä¼šç»™msg.targetå¯¹è±¡èµ‹å€¼å—ï¼Ÿ</p><p>æ²¡é”™ï¼Œæˆ‘ä»¬åœ¨å›é¡¾ä¸€ä¸‹Handlerçš„<code>enqueueMessage</code>ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">enqueueMessage</span><span class="hljs-params">(<span class="hljs-meta">@NonNull</span> MessageQueue queue, <span class="hljs-meta">@NonNull</span> Message msg,<span class="hljs-type">long</span> uptimeMillis)</span> &#123;<br>     <span class="hljs-comment">//å°†å½“å‰Handlerèµ‹å€¼ç»™msg.target</span><br>     msg.target = <span class="hljs-built_in">this</span>;<br>     msg.workSourceUid = ThreadLocalWorkSource.getUid();<br>     <span class="hljs-keyword">if</span> (mAsynchronous) &#123;<br>         msg.setAsynchronous(<span class="hljs-literal">true</span>);<br>     &#125;<br>     <span class="hljs-comment">//è°ƒç”¨MessageQueueçš„enqueueMessageæ–¹æ³•</span><br>     <span class="hljs-keyword">return</span> queue.enqueueMessage(msg, uptimeMillis);<br>&#125;<br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬çŸ¥é“Handlerçš„<code>post</code>å’Œ<code>send</code>ç³»åˆ—æ–¹æ³•å‘é€çš„æ¶ˆæ¯ï¼Œæœ€ç»ˆéƒ½ä¼šèµ°åˆ°è¿™ä¸ªæ–¹æ³•ï¼Œmsg.targetéƒ½ä¼šè¢«èµ‹å€¼ï¼Œå› æ­¤ä¸å¯èƒ½ä¸ºç©ºã€‚é‚£msg.targetå•¥æ—¶å€™ä¼šä¸ºç©ºå‘¢ï¼Ÿæˆ‘ä»¬æ¨æ–­è‚¯å®šæ˜¯å…¶ä»–å‘é€æ¶ˆæ¯çš„æ–¹æ³•ä½¿å¾—msg.targetä¸ºç©ºï¼Œé‚£æˆ‘ä»¬å°±æ‰¾ä¸€ä¸‹ï¼Œä¼šå‘ç°MessageQueueçš„<code>postSyncBarrier</code>çš„æ–¹æ³•ä¸­æ²¡æœ‰ç»™msg.targetå¯¹è±¡èµ‹å€¼ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">postSyncBarrier</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-keyword">return</span> postSyncBarrier(SystemClock.uptimeMillis());<br>&#125;<br><br><span class="hljs-keyword">private</span> <span class="hljs-type">int</span> <span class="hljs-title function_">postSyncBarrier</span><span class="hljs-params">(<span class="hljs-type">long</span> when)</span> &#123;<br>     <span class="hljs-comment">// Enqueue a new sync barrier token.</span><br>     <span class="hljs-comment">// We don&#x27;t need to wake the queue because the purpose of a barrier is to stall it.</span><br>     <span class="hljs-keyword">synchronized</span> (<span class="hljs-built_in">this</span>) &#123;<br>         <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">token</span> <span class="hljs-operator">=</span> mNextBarrierToken++;<br>         <span class="hljs-keyword">final</span> <span class="hljs-type">Message</span> <span class="hljs-variable">msg</span> <span class="hljs-operator">=</span> Message.obtain();<br>         msg.markInUse();<br>         msg.when = when;<br>         msg.arg1 = token;<br><br>         <span class="hljs-type">Message</span> <span class="hljs-variable">prev</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br>         <span class="hljs-type">Message</span> <span class="hljs-variable">p</span> <span class="hljs-operator">=</span> mMessages;<br>         <span class="hljs-keyword">if</span> (when != <span class="hljs-number">0</span>) &#123;<br>             <span class="hljs-keyword">while</span> (p != <span class="hljs-literal">null</span> &amp;&amp; p.when &lt;= when) &#123;<br>                 prev = p;<br>                 p = p.next;<br>             &#125;<br>         &#125;<br>         <span class="hljs-keyword">if</span> (prev != <span class="hljs-literal">null</span>) &#123; <span class="hljs-comment">// invariant: p == prev.next</span><br>             msg.next = p;<br>             prev.next = msg;<br>         &#125; <span class="hljs-keyword">else</span> &#123;<br>             msg.next = p;<br>             mMessages = msg;<br>         &#125;<br>         <span class="hljs-keyword">return</span> token;<br>     &#125;<br> &#125;<br></code></pre></td></tr></table></figure><p>ä¸Šè¿°ä»£ç å°±æ˜¯å¾€æ¶ˆæ¯é˜Ÿåˆ—ä¸­åˆé€‚çš„ä½ç½®æ’å…¥targetå±æ€§ä¸ºnullçš„Message</p><p>å› æ­¤æˆ‘ä»¬æ˜¯ä¸æ˜¯å¯ä»¥çŸ¥é“ï¼ŒMessageçš„targetå±æ€§ä¸ºç©ºå’Œéç©ºæ˜¯å¾ˆä¸ä¸€æ ·çš„ï¼Œè¿™é‡Œå°±ä¸å–å…³å­äº†ï¼Œç›´æ¥ç»™ç»“è®º: <strong>targetå±æ€§ä¸ºç©ºçš„Messageå°±æ˜¯åŒæ­¥å±éšœï¼Œä»–æ˜¯ä¸€ç§ç‰¹æ®Šçš„æ¶ˆæ¯ï¼Œå¹¶ä¸ä¼šè¢«æ¶ˆè´¹ï¼Œä»…ä»…æ˜¯ä½œä¸ºä¸€ä¸ªæ ‡è¯†å¤„äº MessageQueue ä¸­ï¼Œå½“MessageQueueçš„<code>next</code>æ–¹æ³•é‡åˆ°åŒæ­¥å±éšœçš„æ—¶å€™ï¼Œå°±ä¼šå¾ªç¯éå†æ•´ä¸ªé“¾è¡¨æ‰¾åˆ°æ ‡è®°ä¸ºå¼‚æ­¥æ¶ˆæ¯çš„Messageï¼Œå…¶ä»–çš„æ¶ˆæ¯ä¼šç›´æ¥å¿½è§†ï¼Œé‚£ä¹ˆè¿™æ ·å¼‚æ­¥æ¶ˆæ¯å°±ä¼šæå‰è¢«æ‰§è¡Œäº†</strong></p><p>ç°åœ¨æˆ‘ä»¬ç°åœ¨å°±å¯ä»¥å›ç­”ä¸Šé¢çš„é—®é¢˜äº†ï¼š<strong>targetå±æ€§ä¸ºç©ºçš„Messageå°±æ˜¯åŒæ­¥å±éšœï¼ŒåŒæ­¥å±éšœå¯ä»¥ä½¿å¾—å¼‚æ­¥æ¶ˆæ¯ä¼˜å…ˆè¢«å¤„ç†ï¼Œé€šè¿‡MessageQueueçš„<code>postSyncBarrier</code>å¯ä»¥æ·»åŠ ä¸€ä¸ªåŒæ­¥å±éšœ</strong></p><p><strong>æ³¨æ„</strong>: <strong>åœ¨å¼‚æ­¥æ¶ˆæ¯å¤„ç†å®Œä¹‹åï¼ŒåŒæ­¥å±éšœå¹¶ä¸ä¼šè¢«ç§»é™¤ï¼Œéœ€è¦æˆ‘ä»¬æ‰‹åŠ¨ç§»é™¤ï¼Œä»ä¸Šé¢çš„æºç æˆ‘ä»¬ä¹Ÿå¯ä»¥çœ‹å‡ºï¼Œå¦‚æœä¸ç§»é™¤åŒæ­¥å±éšœï¼Œé‚£ä¹ˆä»–ä¼šä¸€ç›´åœ¨é‚£é‡Œï¼Œè¿™æ ·åŒæ­¥æ¶ˆæ¯å°±æ°¸è¿œæ— æ³•è¢«æ‰§è¡Œäº†ã€‚</strong></p><p>å› æ­¤æˆ‘ä»¬åœ¨ä½¿ç”¨å®ŒåŒæ­¥å±éšœåï¼Œéœ€è¦æ‰‹åŠ¨ç§»é™¤ï¼Œä»£ç å¦‚ä¸‹: </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">removeSyncBarrier</span><span class="hljs-params">(<span class="hljs-type">int</span> token)</span> &#123;<br>     <span class="hljs-comment">// Remove a sync barrier token from the queue.</span><br>     <span class="hljs-comment">// If the queue is no longer stalled by a barrier then wake it.</span><br>     <span class="hljs-keyword">synchronized</span> (<span class="hljs-built_in">this</span>) &#123;<br>         <span class="hljs-type">Message</span> <span class="hljs-variable">prev</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br>         <span class="hljs-type">Message</span> <span class="hljs-variable">p</span> <span class="hljs-operator">=</span> mMessages;<br>         <span class="hljs-keyword">while</span> (p != <span class="hljs-literal">null</span> &amp;&amp; (p.target != <span class="hljs-literal">null</span> || p.arg1 != token)) &#123;<br>             prev = p;<br>             p = p.next;<br>         &#125;<br>         <span class="hljs-keyword">if</span> (p == <span class="hljs-literal">null</span>) &#123;<br>             <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalStateException</span>(<span class="hljs-string">&quot;The specified message queue synchronization &quot;</span><br>                     + <span class="hljs-string">&quot; barrier token has not been posted or has already been removed.&quot;</span>);<br>         &#125;<br>         <span class="hljs-keyword">final</span> <span class="hljs-type">boolean</span> needWake;<br>         <span class="hljs-keyword">if</span> (prev != <span class="hljs-literal">null</span>) &#123;<br>             prev.next = p.next;<br>             needWake = <span class="hljs-literal">false</span>;<br>         &#125; <span class="hljs-keyword">else</span> &#123;<br>             mMessages = p.next;<br>             needWake = mMessages == <span class="hljs-literal">null</span> || mMessages.target != <span class="hljs-literal">null</span>;<br>         &#125;<br>         p.recycleUnchecked();<br><br>         <span class="hljs-comment">// If the loop is quitting then it is already awake.</span><br>         <span class="hljs-comment">// We can assume mPtr != 0 when mQuitting is false.</span><br>         <span class="hljs-keyword">if</span> (needWake &amp;&amp; !mQuitting) &#123;<br>             nativeWake(mPtr);<br>         &#125;<br>     &#125;<br> &#125;<br></code></pre></td></tr></table></figure><p>åˆ°è¿™é‡Œæˆ‘å¿ƒé‡Œåˆæœ‰ä¸€ä¸ªç–‘é—®äº†ï¼Ÿæ€ä¹ˆæŠŠä¸€ä¸ªæ¶ˆæ¯å˜æˆå¼‚æ­¥æ¶ˆæ¯å‘¢ï¼Ÿè¿˜æ˜¯å›åˆ°Handlerçš„<code>enqueueMessage</code>æ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">enqueueMessage</span><span class="hljs-params">(<span class="hljs-meta">@NonNull</span> MessageQueue queue, <span class="hljs-meta">@NonNull</span> Message msg,<span class="hljs-type">long</span> uptimeMillis)</span> &#123;<br>     msg.target = <span class="hljs-built_in">this</span>;<br>     msg.workSourceUid = ThreadLocalWorkSource.getUid();<br>     <span class="hljs-comment">//å¦‚æœmAsynchronousï¼Œåˆ™å°†è¯¥æ¶ˆæ¯è®¾ç½®ä¸ºå¼‚æ­¥æ¶ˆæ¯</span><br>     <span class="hljs-keyword">if</span> (mAsynchronous) &#123;<br>         msg.setAsynchronous(<span class="hljs-literal">true</span>);<br>     &#125;<br>     <span class="hljs-keyword">return</span> queue.enqueueMessage(msg, uptimeMillis);<br>&#125;<br></code></pre></td></tr></table></figure><p>ä»ä¸Šè¿°ä»£ç æˆ‘æ˜¯å¯ä»¥çœ‹åˆ°ï¼Œé€šè¿‡msg.setAsynchronousæ–¹æ³•è®¾ç½®ä¸ºtrueï¼Œå¯ä»¥æŠŠä¸€ä¸ªæ¶ˆæ¯å˜æˆå¼‚æ­¥æ¶ˆæ¯ï¼Œä½†æ˜¯å‰æå¾—æ»¡è¶³mAsynchronouså±æ€§ä¸ºtrueï¼ŒmAsynchronousæ˜¯Handlerä¸­çš„ä¸€ä¸ªå±æ€§ï¼Œä»–ä¼šåœ¨è¿™ä¸¤ä¸ªæ„é€ æ–¹æ³•ä¸­è¢«èµ‹å€¼ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@UnsupportedAppUsage</span><br><span class="hljs-keyword">public</span> <span class="hljs-title function_">Handler</span><span class="hljs-params">(<span class="hljs-meta">@NonNull</span> Looper looper, <span class="hljs-meta">@Nullable</span> Callback callback, <span class="hljs-type">boolean</span> async)</span> &#123;<br>    <span class="hljs-comment">//...</span><br>    mAsynchronous = async;<br>&#125;<br><br><span class="hljs-keyword">public</span> <span class="hljs-title function_">Handler</span><span class="hljs-params">(<span class="hljs-meta">@Nullable</span> Callback callback, <span class="hljs-type">boolean</span> async)</span> &#123;<br>    <span class="hljs-comment">//...</span><br>    mAsynchronous = async;<br>&#125;<br></code></pre></td></tr></table></figure><p>å› æ­¤æˆ‘ä»¬æ˜¯ä¸æ˜¯å¯ä»¥å¾—å‡ºç»“è®ºï¼ŒæŠŠä¸€ä¸ªæ¶ˆæ¯è®¾ç½®ä¸ºå¼‚æ­¥æ¶ˆæ¯ï¼Œæœ‰ä¸¤ç§æ–¹å¼ï¼š</p><p>1ã€åœ¨Handlerçš„æ„é€ æ–¹æ³•ä¸­ï¼Œä¼ å…¥asyncä¸ºtrueï¼Œé‚£ä¹ˆè¿™ä¸ªæ—¶å€™å‘é€çš„Messageå°±éƒ½æ˜¯å¼‚æ­¥çš„çš„æ¶ˆæ¯</p><p>2ã€ç»™Messageé€šè¿‡<code>setAsynchronous</code> æ–¹æ³•æ ‡å¿—ä¸ºå¼‚æ­¥</p><p>ä½†æ˜¯ï¼Œä¸Šé¢ä¸¤ä¸ªæ„é€ æ–¹æ³•å¯¹å¤–æ˜¯ä¸å¯è§çš„ï¼Œæˆ‘ä»¬è°ƒç”¨ä¸åˆ°ï¼Œè€Œä¸”è®¾ç½®åŒæ­¥å±éšœçš„æ–¹æ³•å¯¹å¤–ä¹Ÿæ˜¯ä¸å¯è§çš„ï¼Œè¯´æ˜è°·æ­Œä¸æƒ³è¦æˆ‘ä»¬å»ä½¿ç”¨ä»–ã€‚æ‰€ä»¥è¿™é‡ŒåŒæ­¥å±éšœä¹Ÿæ˜¯ä½œä¸ºä¸€ä¸ªäº†è§£ï¼Œä¸€èˆ¬åªæœ‰ç³»ç»Ÿä¼šå»ä½¿ç”¨å®ƒï¼Œä¾‹å¦‚ï¼šåœ¨è¿›è¡ŒUIç»˜åˆ¶çš„æ—¶å€™ï¼Œä»¥ä¸‹æ˜¯ViewRootImplä¸­æ‰§è¡ŒUIç»˜åˆ¶çš„æ–¹æ³•ä½¿ç”¨åˆ°äº†åŒæ­¥å±éšœ:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@UnsupportedAppUsage</span><br><span class="hljs-keyword">void</span> <span class="hljs-title function_">scheduleTraversals</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-keyword">if</span> (!mTraversalScheduled) &#123;<br>        mTraversalScheduled = <span class="hljs-literal">true</span>;<br>        mTraversalBarrier = mHandler.getLooper().getQueue().postSyncBarrier();<br>        mChoreographer.postCallback(<br>                Choreographer.CALLBACK_TRAVERSAL, mTraversalRunnable, <span class="hljs-literal">null</span>);<br>        <span class="hljs-keyword">if</span> (!mUnbufferedInputDispatch) &#123;<br>            scheduleConsumeBatchedInput();<br>        &#125;<br>        notifyRendererOfFramePending();<br>        pokeDrawLockIfNeeded();<br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">void</span> <span class="hljs-title function_">unscheduleTraversals</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-keyword">if</span> (mTraversalScheduled) &#123;<br>        mTraversalScheduled = <span class="hljs-literal">false</span>;<br>        mHandler.getLooper().getQueue().removeSyncBarrier(mTraversalBarrier);<br>        mChoreographer.removeCallbacks(<br>                Choreographer.CALLBACK_TRAVERSAL, mTraversalRunnable, <span class="hljs-literal">null</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ä¸Šè¿°ä»£ç åœ¨æŠŠç»˜åˆ¶æ¶ˆæ¯æ”¾å…¥é˜Ÿåˆ—ä¹‹å‰ï¼Œå…ˆæ”¾å…¥äº†ä¸€ä¸ªåŒæ­¥å±éšœï¼Œç„¶ååœ¨å‘é€å¼‚æ­¥ç»˜åˆ¶æ¶ˆæ¯ï¼Œä»è€Œä½¿å¾—ç•Œé¢ç»˜åˆ¶çš„æ¶ˆæ¯ä¼šæ¯”å…¶ä»–æ¶ˆæ¯ä¼˜å…ˆæ‰§è¡Œï¼Œé¿å…äº†å› ä¸º MessageQueue ä¸­æ¶ˆæ¯å¤ªå¤šå¯¼è‡´ç»˜åˆ¶æ¶ˆæ¯è¢«é˜»å¡å¯¼è‡´ç”»é¢å¡é¡¿ï¼Œå½“ç»˜åˆ¶å®Œæˆåï¼Œå°±ä¼šå°†åŒæ­¥å±éšœç§»é™¤ã€‚</p><h2 id="IdleHandler"><a href="#IdleHandler" class="headerlink" title="IdleHandler"></a>IdleHandler</h2><p>è§åçŸ¥æ„ï¼Œidleæ˜¯ç©ºé—²çš„æ„æ€ï¼Œé‚£ä¹ˆIdleHandlerå°±æ˜¯ç©ºé—²çš„Handlerï¼Œæœ‰ç‚¹è¿™ä¸ªæ„æ€ï¼Œå®é™…ä¸Šå®ƒæ˜¯MessageQueueä¸­æœ‰ä¸€ä¸ªé™æ€æ¥å£</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">IdleHandler</span> &#123;<br>    <span class="hljs-type">boolean</span> <span class="hljs-title function_">queueIdle</span><span class="hljs-params">()</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°å®ƒæ˜¯ä¸€ä¸ªå•æ–¹æ³•çš„æ¥å£ï¼Œä¹Ÿå¯ç§°ä¸ºå‡½æ•°å‹æ¥å£ï¼Œå®ƒçš„ä½œç”¨æ˜¯ï¼š<strong>åœ¨UIçº¿ç¨‹å¤„ç†å®Œæ‰€æœ‰Viewäº‹åŠ¡åï¼Œå›è°ƒä¸€äº›é¢å¤–çš„æ“ä½œï¼Œä¸”ä¸ä¼šå µå¡ä¸»è¿›ç¨‹ï¼›</strong>æˆ‘ä»¬æ¥å®é™…æ“ä½œä¸€ä¸‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MainActivity</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AppCompatActivity</span> &#123;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onCreate</span><span class="hljs-params">(Bundle savedInstanceState)</span> &#123;<br>        <span class="hljs-built_in">super</span>.onCreate(savedInstanceState);<br>        setContentView(R.layout.activity_main);<br><br>        <span class="hljs-keyword">new</span> <span class="hljs-title class_">Handler</span>().getLooper().getQueue().addIdleHandler(<span class="hljs-keyword">new</span> <span class="hljs-title class_">MessageQueue</span>.IdleHandler() &#123;<br>            <span class="hljs-meta">@Override</span><br>            <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">queueIdle</span><span class="hljs-params">()</span> &#123;<br>                Log.d(<span class="hljs-string">&quot;print&quot;</span>, <span class="hljs-string">&quot;queueIdle: ç©ºé—²æ—¶åšä¸€äº›è½»é‡çº§åˆ«&quot;</span>);<br>                <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>            &#125;<br>        &#125;);<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">//ä¸Šé¢ä»£ç ä¼šæ‰“å°å¦‚ä¸‹ç»“æœ</span><br>queueIdle: ç©ºé—²æ—¶åšä¸€äº›è½»é‡çº§åˆ«<br></code></pre></td></tr></table></figure><p>æ¥ç€è¿›è¡Œæºç åˆ†æï¼Œæˆ‘ä»¬åœ¨çœ‹ä¸‹<code>addIdleHandler</code>è¿™ä¸ªæ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">addIdleHandler</span><span class="hljs-params">(<span class="hljs-meta">@NonNull</span> IdleHandler handler)</span> &#123;<br>    <span class="hljs-keyword">if</span> (handler == <span class="hljs-literal">null</span>) &#123;<br>        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">NullPointerException</span>(<span class="hljs-string">&quot;Can&#x27;t add a null IdleHandler&quot;</span>);<br>    &#125;<br>    <span class="hljs-keyword">synchronized</span> (<span class="hljs-built_in">this</span>) &#123;<br>        mIdleHandlers.add(handler);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ï¼Œè¢«æ·»åŠ è¿›æ¥çš„handleræ”¾åˆ°äº†mIdleHandlersï¼Œè·Ÿè¿‡å»çœ‹ä¸‹mIdleHandlersï¼Œä¼šå‘ç°MessageQueueä¸­å®šä¹‰äº†IdleHandlerçš„é›†åˆå’Œæ•°ç»„ï¼Œå¹¶ä¸”æœ‰ä¸€äº›æ“ä½œæ–¹æ³•ï¼Œå¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> ArrayList&lt;IdleHandler&gt; mIdleHandlers = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;IdleHandler&gt;();<br><span class="hljs-keyword">private</span> IdleHandler[] mPendingIdleHandlers;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">addIdleHandler</span><span class="hljs-params">(<span class="hljs-meta">@NonNull</span> IdleHandler handler)</span> &#123;<br>    <span class="hljs-keyword">if</span> (handler == <span class="hljs-literal">null</span>) &#123;<br>        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">NullPointerException</span>(<span class="hljs-string">&quot;Can&#x27;t add a null IdleHandler&quot;</span>);<br>    &#125;<br>    <span class="hljs-keyword">synchronized</span> (<span class="hljs-built_in">this</span>) &#123;<br>        mIdleHandlers.add(handler);<br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">removeIdleHandler</span><span class="hljs-params">(<span class="hljs-meta">@NonNull</span> IdleHandler handler)</span> &#123;<br>    <span class="hljs-keyword">synchronized</span> (<span class="hljs-built_in">this</span>) &#123;<br>        mIdleHandlers.remove(handler);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æœ€ååœ¨çœ‹ä¸‹MessageQueueä¸­çš„<code>Next</code>æ–¹æ³•ï¼Œä»…è´´å‡ºå…³é”®ä»£ç ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><code class="hljs java">Message <span class="hljs-title function_">next</span><span class="hljs-params">()</span> &#123;<br>  <span class="hljs-type">int</span> <span class="hljs-variable">pendingIdleHandlerCount</span> <span class="hljs-operator">=</span> -<span class="hljs-number">1</span>; <span class="hljs-comment">// -1 only during first iteration</span><br>    <span class="hljs-keyword">for</span> (;;) &#123;<br>        <span class="hljs-comment">//...</span><br>        <span class="hljs-keyword">synchronized</span> (<span class="hljs-built_in">this</span>) &#123;<br>             <span class="hljs-comment">//...</span><br>             <span class="hljs-comment">//å½“å‰æ— æ¶ˆæ¯ï¼Œæˆ–è¿˜éœ€è¦ç­‰å¾…ä¸€æ®µæ—¶é—´æ¶ˆæ¯æ‰èƒ½åˆ†å‘ï¼Œè·å¾—IdleHandlerçš„æ•°é‡</span><br>             <span class="hljs-keyword">if</span> (pendingIdleHandlerCount &lt; <span class="hljs-number">0</span> &amp;&amp; (mMessages == <span class="hljs-literal">null</span> || now &lt; mMessages.when)) &#123;<br>                 pendingIdleHandlerCount = mIdleHandlers.size();<br>             &#125;<br>          <br>           <span class="hljs-keyword">if</span> (pendingIdleHandlerCount &lt;= <span class="hljs-number">0</span>) &#123;<br>                 <span class="hljs-comment">// No idle handlers to run.  Loop and wait some more.</span><br>                <span class="hljs-comment">//å¦‚æœæ²¡æœ‰idle handleréœ€è¦æ‰§è¡Œï¼Œé˜»å¡çº¿ç¨‹è¿›å…¥ä¸‹æ¬¡å¾ªç¯</span><br>                 mBlocked = <span class="hljs-literal">true</span>;<br>                 <span class="hljs-keyword">continue</span>;<br>             &#125;<br>     <span class="hljs-comment">//åˆå§‹åŒ–mPendingIdleHandlers</span><br>             <span class="hljs-keyword">if</span> (mPendingIdleHandlers == <span class="hljs-literal">null</span>) &#123;<br>                 mPendingIdleHandlers = <span class="hljs-keyword">new</span> <span class="hljs-title class_">IdleHandler</span>[Math.max(pendingIdleHandlerCount, <span class="hljs-number">4</span>)];<br>             &#125;<br>             <span class="hljs-comment">//æŠŠListè½¬åŒ–æˆæ•°ç»„ç±»å‹</span><br>             mPendingIdleHandlers = mIdleHandlers.toArray(mPendingIdleHandlers);<br>         &#125;<br>      <br>        <span class="hljs-comment">//å¾ªç¯éå†æ‰€æœ‰çš„IdleHandler</span><br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; pendingIdleHandlerCount; i++) &#123;<br>            <span class="hljs-keyword">final</span> <span class="hljs-type">IdleHandler</span> <span class="hljs-variable">idler</span> <span class="hljs-operator">=</span> mPendingIdleHandlers[i];<br>            mPendingIdleHandlers[i] = <span class="hljs-literal">null</span>; <span class="hljs-comment">// release the reference to the handler</span><br><br>            <span class="hljs-type">boolean</span> <span class="hljs-variable">keep</span> <span class="hljs-operator">=</span> <span class="hljs-literal">false</span>;<br>            <span class="hljs-keyword">try</span> &#123;<br>              <span class="hljs-comment">//è·å¾—idler.queueIdleçš„è¿”å›å€¼</span><br>                keep = idler.queueIdle();<br>            &#125; <span class="hljs-keyword">catch</span> (Throwable t) &#123;<br>                Log.wtf(TAG, <span class="hljs-string">&quot;IdleHandler threw exception&quot;</span>, t);<br>            &#125;<br>            <span class="hljs-comment">//keepå³idler.queueIdleçš„è¿”å›å€¼ï¼Œå¦‚æœä¸ºfalseè¡¨æ˜åªè¦æ‰§è¡Œä¸€æ¬¡ï¼Œå¹¶ç§»é™¤ï¼Œå¦åˆ™ä¸ç§»é™¤</span><br>            <span class="hljs-keyword">if</span> (!keep) &#123;<br>                <span class="hljs-keyword">synchronized</span> (<span class="hljs-built_in">this</span>) &#123;<br>                    mIdleHandlers.remove(idler);<br>                &#125;<br>            &#125;<br>         &#125;<br>         <span class="hljs-comment">// Reset the idle handler count to 0 so we do not run them again.</span><br>       <span class="hljs-comment">//å°†pendingIdleHandlerCountç½®ä¸º0é¿å…ä¸‹æ¬¡å†æ¬¡æ‰§è¡Œ</span><br>         pendingIdleHandlerCount = <span class="hljs-number">0</span>;<br>      <br>       <span class="hljs-comment">// å½“åœ¨æ‰§è¡ŒIdleHandlerçš„æ—¶å€™ï¼Œå¯èƒ½æœ‰æ–°çš„æ¶ˆæ¯å·²ç»è¿›æ¥äº†</span><br>         <span class="hljs-comment">// æ‰€ä»¥è¿™ä¸ªæ—¶å€™ä¸èƒ½é˜»å¡ï¼Œè¦å›å»å¾ªç¯ä¸€æ¬¡çœ‹ä¸€ä¸‹</span><br>         nextPollTimeoutMillis = <span class="hljs-number">0</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ä¸Šè¿°ä»£ç è§£æï¼š</p><p>1ã€å½“è°ƒç”¨nextæ–¹æ³•çš„æ—¶å€™ï¼Œä¼šå°†pendingIdleHandlerCountèµ‹å€¼ä¸º-1</p><p>2ã€åˆ¤æ–­pendingIdleHandlerCountæ˜¯å¦å°äº0å¹¶ä¸”MessageQueue æ˜¯å¦ä¸ºç©ºæˆ–è€…æœ‰å»¶è¿Ÿæ¶ˆæ¯éœ€è¦æ‰§è¡Œï¼Œå¦‚æœæ˜¯åˆ™æŠŠå­˜å‚¨IdleHandlerçš„listçš„é•¿åº¦èµ‹å€¼ç»™pendingIdleHandlerCount</p><p>3ã€åˆ¤æ–­å¦‚æœæ²¡æœ‰IdleHandleréœ€è¦æ‰§è¡Œï¼Œé˜»å¡çº¿ç¨‹è¿›å…¥ä¸‹æ¬¡å¾ªç¯ï¼Œå¦‚æœæœ‰ï¼Œåˆ™åˆå§‹åŒ–mPendingIdleHandlersï¼ŒæŠŠlistä¸­çš„æ‰€æœ‰IdleHandleræ”¾åˆ°æ•°ç»„ä¸­ã€‚è¿™ä¸€æ­¥æ˜¯ä¸ºäº†ä¸è®©åœ¨æ‰§è¡ŒIdleHandlerçš„æ—¶å€™Listè¢«æ’å…¥æ–°çš„IdleHandlerï¼Œé€ æˆé€»è¾‘æ··ä¹±</p><p>4ã€å¾ªç¯éå†æ‰€æœ‰çš„IdleHandlerå¹¶æ‰§è¡Œï¼ŒæŸ¥çœ‹idler.queueIdleæ–¹æ³•çš„è¿”å›å€¼ï¼Œä¸ºfalseè¡¨æ˜è¿™ä¸ªIdleHandleråªéœ€è¦æ‰§è¡Œä¸€æ¬¡ï¼Œå¹¶ç§»é™¤ï¼Œä¸ºtrueï¼Œåˆ™ä¸ç§»é™¤</p><p>5ã€å°†pendingIdleHandlerCountç½®ä¸º0é¿å…ä¸‹æ¬¡å†æ¬¡æ‰§è¡Œï¼Œ å½“åœ¨æ‰§è¡ŒIdleHandlerçš„æ—¶å€™ï¼Œå¯èƒ½æœ‰æ–°çš„æ¶ˆæ¯å·²ç»è¿›æ¥äº†ï¼Œæ‰€ä»¥è¿™ä¸ªæ—¶å€™ä¸èƒ½é˜»å¡ï¼Œè¦å›å»å¾ªç¯ä¸€æ¬¡çœ‹ä¸€ä¸‹</p><p>åˆ°è¿™é‡ŒåŒæ­¥å±éšœå’ŒIdleHandleréƒ½è®²å®Œäº†ï¼Œå»ºè®®è¯»è€…é…åˆå®Œæ•´çš„æºç åœ¨å»ä»”ç»†é˜…è¯»ä¸€æ¬¡ã€‚</p><p><strong>å®é™…åº”ç”¨</strong>: å¯ä»¥åœ¨IdleHandleré‡Œé¢è·å–Viewçš„å®½é«˜</p><h2 id="ä¸»çº¿ç¨‹æ¶ˆæ¯å¾ªç¯"><a href="#ä¸»çº¿ç¨‹æ¶ˆæ¯å¾ªç¯" class="headerlink" title="ä¸»çº¿ç¨‹æ¶ˆæ¯å¾ªç¯"></a>ä¸»çº¿ç¨‹æ¶ˆæ¯å¾ªç¯</h2><p>åœ¨ä¸Šä¸€ç¯‡ä¸­æˆ‘ä»¬è®²åˆ°ï¼ŒActivityThreadå°±æ˜¯ä¸»çº¿ç¨‹ï¼Œä¹Ÿå¯ä»¥è¯´æ˜¯UIçº¿ç¨‹ï¼Œåœ¨ä¸»çº¿ç¨‹çš„<code>mainæ–¹æ³•ä¸­</code>åˆ›å»ºäº†Looperï¼Œå¹¶å¼€å¯äº†æ¶ˆæ¯å¾ªç¯ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>  <span class="hljs-comment">//...</span><br>  <span class="hljs-comment">//åˆ›å»ºLooper</span><br>  Looper.prepareMainLooper();<br>  <br>  <span class="hljs-type">ActivityThread</span> <span class="hljs-variable">thread</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ActivityThread</span>();<br>  thread.attach(<span class="hljs-literal">false</span>);<br><br>  <span class="hljs-keyword">if</span> (sMainThreadHandler == <span class="hljs-literal">null</span>) &#123;<br>    sMainThreadHandler = thread.getHandler();<br>  &#125;<br>  <span class="hljs-comment">//...</span><br>  <span class="hljs-comment">//å¼€å¯å¾ªç¯è¯»å–æ¶ˆæ¯</span><br>  Looper.loop();<br>  <span class="hljs-comment">//Looperå¦‚æœå› å¼‚å¸¸åŸå› åœæ­¢å¾ªç¯åˆ™æŠ›å¼‚å¸¸</span><br>  <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">&quot;Main thread loop unexpectedly exited&quot;</span>);<br>&#125;<br></code></pre></td></tr></table></figure><p>ä¸»çº¿ç¨‹çš„æ¶ˆæ¯å¾ªç¯å¼€å§‹äº†ä»¥åï¼ŒActivityThreadè¿˜éœ€è¦æœ‰ä¸€ä¸ªHandleræ¥å’Œæ¶ˆæ¯é˜Ÿåˆ—è¿›è¡Œäº¤äº’ï¼Œè¿™ä¸ªHandlerå°±æ˜¯ActivityThread.Hï¼Œå®ƒå†…éƒ¨å®šä¹‰äº†å¾ˆå¤šçš„æ¶ˆæ¯ç±»å‹ï¼Œä¾‹å¦‚å››å¤§ç»„ä»¶çš„å¯åŠ¨ï¼ŒApplicationçš„å¯åŠ¨ç­‰ç­‰</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">class</span> <span class="hljs-title class_">H</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Handler</span> &#123;<br>        <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">BIND_APPLICATION</span>        <span class="hljs-operator">=</span> <span class="hljs-number">110</span>;<br>        <span class="hljs-meta">@UnsupportedAppUsage</span><br>        <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">EXIT_APPLICATION</span>        <span class="hljs-operator">=</span> <span class="hljs-number">111</span>;<br>        <span class="hljs-meta">@UnsupportedAppUsage</span><br>        <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">RECEIVER</span>                <span class="hljs-operator">=</span> <span class="hljs-number">113</span>;<br>        <span class="hljs-meta">@UnsupportedAppUsage</span><br>        <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">CREATE_SERVICE</span>          <span class="hljs-operator">=</span> <span class="hljs-number">114</span>;<br>        <span class="hljs-meta">@UnsupportedAppUsage</span><br>        <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">SERVICE_ARGS</span>            <span class="hljs-operator">=</span> <span class="hljs-number">115</span>;<br>        <span class="hljs-meta">@UnsupportedAppUsage</span><br>        <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">STOP_SERVICE</span>            <span class="hljs-operator">=</span> <span class="hljs-number">116</span>;<br><br>        <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">CONFIGURATION_CHANGED</span>   <span class="hljs-operator">=</span> <span class="hljs-number">118</span>;<br>        <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">CLEAN_UP_CONTEXT</span>        <span class="hljs-operator">=</span> <span class="hljs-number">119</span>;<br>        <span class="hljs-meta">@UnsupportedAppUsage</span><br>        <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">GC_WHEN_IDLE</span>            <span class="hljs-operator">=</span> <span class="hljs-number">120</span>;<br>        <span class="hljs-meta">@UnsupportedAppUsage</span><br>        <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">BIND_SERVICE</span>            <span class="hljs-operator">=</span> <span class="hljs-number">121</span>;<br>        <span class="hljs-meta">@UnsupportedAppUsage</span><br>        <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">UNBIND_SERVICE</span>          <span class="hljs-operator">=</span> <span class="hljs-number">122</span>;<br>        <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">DUMP_SERVICE</span>            <span class="hljs-operator">=</span> <span class="hljs-number">123</span>;<br>        <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">LOW_MEMORY</span>              <span class="hljs-operator">=</span> <span class="hljs-number">124</span>;<br>        <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">PROFILER_CONTROL</span>        <span class="hljs-operator">=</span> <span class="hljs-number">127</span>;<br>        <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">CREATE_BACKUP_AGENT</span>     <span class="hljs-operator">=</span> <span class="hljs-number">128</span>;<br>        <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">DESTROY_BACKUP_AGENT</span>    <span class="hljs-operator">=</span> <span class="hljs-number">129</span>;<br>        <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">SUICIDE</span>                 <span class="hljs-operator">=</span> <span class="hljs-number">130</span>;<br>     <span class="hljs-comment">//...</span><br>        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">handleMessage</span><span class="hljs-params">(Message msg)</span> &#123;<br>          <span class="hljs-comment">//...</span><br>        &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>å…³äºActivityThread.Hçš„å®é™…åº”ç”¨ï¼Œæˆ‘ä»¬åœ¨çœ‹<a href="https://juejin.cn/post/6847902222294990862">Activityçš„å¯åŠ¨æµç¨‹</a>å¯èƒ½ä¼šæœ‰æ¯”è¾ƒæ·±å…¥çš„ç†è§£ï¼ŒActivityThreadé€šè¿‡ApplicationThreadå’ŒAMSè¿›è¡Œè¿›ç¨‹é—´é€šä¿¡çš„æ–¹å¼å®ŒæˆActivityThreadçš„è¯·æ±‚åï¼Œä¼šå›è°ƒApplicationThreadä¸­çš„Binderæ–¹æ³•ï¼Œç„¶åApplicationThreadä¼šå‘Hå‘é€æ¶ˆæ¯ï¼ŒHæ”¶åˆ°æ¶ˆæ¯åä¼šå°†ApplicationThreadä¸­çš„é€»è¾‘åˆ‡æ¢åˆ°ActivityThreadä¸­å»æ‰§è¡Œï¼Œå³åˆ‡æ¢åˆ°ä¸»çº¿ç¨‹å»æ‰§è¡Œï¼Œè¿™ä¸ªè¿‡ç¨‹å°±æ˜¯ä¸»çº¿ç¨‹çš„æ¶ˆæ¯å¾ªç¯æ¨¡å‹</p><h2 id="å¦™ç”¨-Looper-æœºåˆ¶"><a href="#å¦™ç”¨-Looper-æœºåˆ¶" class="headerlink" title="å¦™ç”¨ Looper æœºåˆ¶"></a>å¦™ç”¨ Looper æœºåˆ¶</h2><p>1ã€æˆ‘ä»¬å¯ä»¥é€šè¿‡Looper<code>getMainLooper</code>æ–¹æ³•è·å–ä¸»çº¿ç¨‹Looperï¼Œä»è€Œå¯ä»¥åˆ¤æ–­å½“å‰çº¿ç¨‹æ˜¯å¦æ˜¯ä¸»çº¿ç¨‹</p><p>2ã€å°† Runnable post åˆ°ä¸»çº¿ç¨‹æ‰§è¡Œ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MainThread</span> &#123;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-title function_">MainThread</span><span class="hljs-params">()</span> &#123;<br>    &#125;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">Handler</span> <span class="hljs-variable">HANDLER</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Handler</span>(Looper.getMainLooper());<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span><span class="hljs-params">(<span class="hljs-meta">@NonNull</span> Runnable runnable)</span> &#123;<br>        <span class="hljs-keyword">if</span> (isMainThread()) &#123;<br>            runnable.run();<br>        &#125;<span class="hljs-keyword">else</span>&#123;<br>            HANDLER.post(runnable);<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">isMainThread</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> Looper.myLooper() == Looper.getMainLooper();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="å­çº¿ç¨‹ä½¿ç”¨HandleråŠç›¸å…³æ³¨æ„äº‹é¡¹"><a href="#å­çº¿ç¨‹ä½¿ç”¨HandleråŠç›¸å…³æ³¨æ„äº‹é¡¹" class="headerlink" title="å­çº¿ç¨‹ä½¿ç”¨HandleråŠç›¸å…³æ³¨æ„äº‹é¡¹"></a>å­çº¿ç¨‹ä½¿ç”¨HandleråŠç›¸å…³æ³¨æ„äº‹é¡¹</h2><p>æˆ‘ä»¬é€šå¸¸ä½¿ç”¨Handleréƒ½æ˜¯ä»å­çº¿ç¨‹å‘é€æ¶ˆæ¯åˆ°ä¸»çº¿ç¨‹å»å¤„ç†ï¼Œé‚£ä¹ˆè¿™é‡Œæˆ‘ä»¬å°è¯•ä¸€ä¸‹ä»ä¸»çº¿ç¨‹å‘é€æ¶ˆæ¯åˆ°å­çº¿ç¨‹æ¥å¤„ç†ï¼Œä¸Šä»£ç ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MainActivity</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AppCompatActivity</span> &#123;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onCreate</span><span class="hljs-params">(Bundle savedInstanceState)</span> &#123;<br>        <span class="hljs-built_in">super</span>.onCreate(savedInstanceState);<br>        setContentView(R.layout.activity_main);<br>        <span class="hljs-comment">//åˆ›å»ºçº¿ç¨‹å®ä¾‹å¹¶å¼€å¯</span><br>        <span class="hljs-type">MyThread</span> <span class="hljs-variable">myThread</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">MyThread</span>();<br>        myThread.start();<br>        <span class="hljs-comment">//æ‰“å¼€è¿™æ®µæ³¨é‡Šå°±ä¸ä¼šcrashï¼Œä¸”çœ‹ä¸‹é¢åˆ†æ</span><br><span class="hljs-comment">//      try &#123;</span><br><span class="hljs-comment">//          Thread.sleep(500);</span><br><span class="hljs-comment">//      &#125; catch (InterruptedException e) &#123;</span><br><span class="hljs-comment">//          e.printStackTrace();</span><br><span class="hljs-comment">//      &#125;</span><br>        <span class="hljs-comment">//è·å–Handlerå‘é€æ¶ˆæ¯</span><br>        myThread.getHandler().sendEmptyMessage(<span class="hljs-number">0x001</span>);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyThread</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Thread</span> &#123;<br>        <span class="hljs-keyword">private</span> Handler mHandler;<br><br>        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span><span class="hljs-params">()</span> &#123;<br>            Looper.prepare();<br>            mHandler = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Handler</span>() &#123;<br>                <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">handleMessage</span><span class="hljs-params">(<span class="hljs-meta">@NonNull</span> Message msg)</span> &#123;<br>                    <span class="hljs-keyword">if</span>(msg.what == <span class="hljs-number">0x001</span>)&#123;<br>                        Log.d(<span class="hljs-string">&quot;print&quot;</span>, <span class="hljs-string">&quot;handleMessage: &quot;</span>);<br>                    &#125;<br>                &#125;<br>            &#125;;<br>            Looper.loop();<br>        &#125;<br><br>        <span class="hljs-keyword">public</span> Handler <span class="hljs-title function_">getHandler</span><span class="hljs-params">()</span>&#123;<br>            <span class="hljs-keyword">return</span> mHandler;<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿è¡Œä¸€ä¸‹ä¸Šè¿°ä»£ç ï¼Œå‘ç°ä¼šCrashï¼Œå¦‚ä¸‹å›¾ï¼š</p><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/79f6a7b7e65d4c1ea07ea76b3ac49689~tplv-k3u1fbpfcp-zoom-1.image" alt="image-20210223112129732"></p><p>æŠ¥äº†ä¸€ä¸ªç©ºæŒ‡é’ˆå¼‚å¸¸ï¼ŒåŸå› å°±æ˜¯å¤šçº¿ç¨‹å¹¶å‘ï¼Œå½“ä¸»çº¿ç¨‹æ‰§è¡Œåˆ°sendEnptyMessageæ—¶ï¼Œå­çº¿ç¨‹çš„Handlerè¿˜æ²¡æœ‰åˆ›å»ºã€‚å› æ­¤æˆ‘ä»¬å¯ä»¥åœ¨è·å–Handlerçš„æ—¶å€™è®©ä¸»çº¿ç¨‹ä¼‘çœ ä¸€ä¸‹åœ¨æ‰§è¡Œï¼Œåº”ç”¨å°±ä¸ä¼šCrashäº†ï¼Œæ‰“å¼€ä¸Šé¢ä»£ç çš„æ³¨é‡Šå³å¯</p><p><strong>å€¼å¾—æ³¨æ„çš„æ˜¯</strong>ï¼šæˆ‘ä»¬è‡ªå·±åˆ›å»ºçš„Looperåœ¨ä½¿ç”¨å®Œæ¯•ååº”è¯¥è°ƒç”¨<code>quit</code>æ–¹æ³•æ¥ç»ˆæ­¢æ¶ˆæ¯å¾ªç¯ï¼Œå¦‚æœä¸é€€å‡ºçš„è¯ï¼Œé‚£ä¹ˆè¯¥çº¿ç¨‹çš„Looperå¤„ç†å®Œæ‰€æœ‰çš„æ¶ˆæ¯åï¼Œå°±ä¼šå¤„äºä¸€ä¸ªé˜»å¡çŠ¶æ€ï¼Œè¦çŸ¥é“çº¿ç¨‹æ˜¯æ¯”è¾ƒé‡é‡çº§çš„ï¼Œå¦‚æœä¸€ç›´å­˜åœ¨ï¼Œè‚¯å®šä¼šå¯¹åº”ç”¨æ€§èƒ½é€ æˆä¸€å®šçš„å½±å“ã€‚è€Œå¦‚æœé€€å‡ºLooperï¼Œè¿™ä¸ªçº¿ç¨‹å°±ä¼šç«‹åˆ»ç»ˆæ­¢ï¼Œå› æ­¤å»ºè®®ä¸éœ€è¦çš„æ—¶å€™ç»ˆæ­¢Looperã€‚</p><p>å› æ­¤åœ¨å­çº¿ç¨‹ä½¿ç”¨Handlerï¼Œæˆ‘ä»¬éœ€è¦æ³¨æ„ä¸€ä¸‹ä¸¤ç‚¹ï¼š</p><p><strong>1ã€å¿…é¡»è°ƒç”¨<code> Looper.prepare()</code>åˆ›å»ºå½“å‰çº¿ç¨‹çš„ Looperï¼Œå¹¶è°ƒç”¨<code>Looper.loop()</code>å¼€å¯æ¶ˆæ¯å¾ªç¯</strong></p><p><strong>2ã€å¿…é¡»åœ¨ä½¿ç”¨ç»“æŸåè°ƒç”¨Looperçš„<code>quit</code>æ–¹æ³•é€€å‡ºå½“å‰çº¿ç¨‹</strong></p><h2 id="HandlerThread"><a href="#HandlerThread" class="headerlink" title="HandlerThread"></a>HandlerThread</h2><p>ä¸Šé¢è®²åˆ°ä¸»çº¿ç¨‹å‘é€æ¶ˆæ¯åˆ°å­çº¿ç¨‹æ¥å¤„ç†ï¼Œå…¶å®Androidå·²ç»ç»™æˆ‘ä»¬æä¾›äº†ä¸€ä¸ªè¿™æ ·è½»é‡çº§çš„å¼‚æ­¥ç±»ï¼Œé‚£å°±æ˜¯HandlerThread</p><p>HandlerThreadçš„å®ç°åŸç†ä¹Ÿæ¯”è¾ƒç®€å•ï¼š<strong>ç»§æ‰¿Threadå¹¶å¯¹Looperè¿›è¡Œäº†å°è£…</strong></p><p>å…·ä½“æºç å°±ä¸è¿‡å¤šåˆ†æäº†ï¼Œå¤§å®¶æœ‰å…´è¶£çš„å¯ä»¥å»çœ‹ä¸€ä¸‹ï¼Œä¹Ÿå°±100å¤šè¡Œä»£ç ï¼Œè¿™é‡Œä¸»è¦è®²è§£ä¸€ä¸‹ä½¿ç”¨ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MainActivity</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AppCompatActivity</span> &#123;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onCreate</span><span class="hljs-params">(Bundle savedInstanceState)</span> &#123;<br>        <span class="hljs-built_in">super</span>.onCreate(savedInstanceState);<br>        setContentView(R.layout.activity_main);<br>      <span class="hljs-comment">//1ï¼Œåˆ›å»ºHandlerå®ä¾‹</span><br>      <span class="hljs-type">HandlerThread</span> <span class="hljs-variable">mHandlerThread</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">HandlerThread</span>(<span class="hljs-string">&quot;HandlerThread&quot;</span>);<br>      <span class="hljs-comment">//2ï¼Œå¯åŠ¨çº¿ç¨‹</span><br>        mHandlerThread.start();<br>      <span class="hljs-comment">//3ï¼Œä½¿ç”¨ä¼ å…¥Looperä¸ºå‚æ•°çš„æ„é€ æ–¹æ³•åˆ›å»ºHandlerå®ä¾‹</span><br>        <span class="hljs-type">Handler</span> <span class="hljs-variable">mHandler</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Handler</span>(mHandlerThread.getLooper())&#123;<br>            <span class="hljs-meta">@Override</span><br>            <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">handleMessage</span><span class="hljs-params">(<span class="hljs-meta">@NonNull</span> Message msg)</span> &#123;<br>                Log.d(<span class="hljs-string">&quot;print&quot;</span>, <span class="hljs-string">&quot;å½“å‰çº¿ç¨‹: &quot;</span> + Thread.currentThread().getName() + <span class="hljs-string">&quot; handleMessage&quot;</span>);<br>            &#125;<br>        &#125;;<br>        <span class="hljs-comment">//4ï¼Œä½¿ç”¨Handlerå‘é€æ¶ˆæ¯</span><br>        mHandler.sendEmptyMessage(<span class="hljs-number">0x001</span>);<br>      <span class="hljs-comment">//5ï¼Œåœ¨åˆé€‚çš„æ—¶æœºè°ƒç”¨HandlerThreadçš„quitæ–¹æ³•ï¼Œé€€å‡ºæ¶ˆæ¯å¾ªç¯</span><br>    &#125;<br>&#125;<br><br><span class="hljs-comment">//ä¸Šè¿°ä»£ç æ‰“å°ç»“æœ:</span><br>å½“å‰çº¿ç¨‹: HandlerThread handleMessage<br></code></pre></td></tr></table></figure><h3 id="Handler-HandlerThread-Threadä¸‰è€…åŒºåˆ«"><a href="#Handler-HandlerThread-Threadä¸‰è€…åŒºåˆ«" class="headerlink" title="Handler  HandlerThread  Threadä¸‰è€…åŒºåˆ«"></a>Handler  HandlerThread  Threadä¸‰è€…åŒºåˆ«</h3><p><strong>Handler</strong>ï¼šåœ¨Androidä¸­è´Ÿè´£å‘é€å’Œå¤„ç†æ¶ˆæ¯</p><p><strong>HandlerThread</strong>ï¼šç»§æ‰¿è‡ªThreadï¼Œå¯¹Looperè¿›è¡Œäº†å°è£…ï¼Œä¹Ÿå°±æ˜¯è¯´å®ƒåœ¨å­çº¿ç¨‹ç»´æŠ¤äº†ä¸€ä¸ªLooperï¼Œæ–¹ä¾¿æˆ‘ä»¬åœ¨å­çº¿ç¨‹ä¸­å»å¤„ç†æ¶ˆæ¯</p><p><strong>Thread</strong>: cpuæ‰§è¡Œçš„æœ€å°å•ä½ï¼Œå³çº¿ç¨‹ï¼Œå®ƒåœ¨æ‰§è¡Œå®Œåå°±ç«‹é©¬ç»“æŸäº†ï¼Œå¹¶ä¸èƒ½å»å¤„ç†æ¶ˆæ¯ã€‚å¦‚æœè¦å¤„ç†ï¼Œéœ€è¦é…åˆLooperï¼ŒHandlerä¸€èµ·ä½¿ç”¨</p><h2 id="å­çº¿ç¨‹å¼¹Toast"><a href="#å­çº¿ç¨‹å¼¹Toast" class="headerlink" title="å­çº¿ç¨‹å¼¹Toast"></a>å­çº¿ç¨‹å¼¹Toast</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//1</span><br><span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>()&#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span><span class="hljs-params">()</span> &#123;<br>        Toast.makeText(MainActivity.<span class="hljs-built_in">this</span>, <span class="hljs-string">&quot;å­çº¿ç¨‹å¼¹Toast&quot;</span>, Toast.LENGTH_SHORT).show();<br>    &#125;<br>&#125;.start();<br><br><span class="hljs-comment">//2</span><br><span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>()&#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span><span class="hljs-params">()</span> &#123;<br>        Looper.prepare();<br>        Toast.makeText(MainActivity.<span class="hljs-built_in">this</span>, <span class="hljs-string">&quot;å­çº¿ç¨‹å¼¹Toast&quot;</span>, Toast.LENGTH_SHORT).show();<br>        Looper.loop();<br>    &#125;<br>&#125;.start();<br></code></pre></td></tr></table></figure><p>ä¸Šè¿°1ä»£ç è¿è¡Œä¼šå¥”æºƒï¼Œä¼šæŠ¥è¿™ä¹ˆä¸€ä¸ªå¼‚å¸¸æç¤ºï¼š**â€Canâ€™t toast on a thread that has not called Looper.prepare()â€**</p><p>åŸå› å°±æ˜¯Toastçš„å®ç°ä¹Ÿæ˜¯ä¾èµ–Handlerï¼Œè€Œæˆ‘ä»¬çŸ¥é“åœ¨å­çº¿ç¨‹ä¸­åˆ›å»ºHandlerï¼Œéœ€å…ˆåˆ›å»ºLooperå¹¶å¼€å¯æ¶ˆæ¯å¾ªç¯ï¼Œè¿™ç‚¹åœ¨Toastä¸­çš„æºç ä¹Ÿæœ‰ä½“ç°ï¼Œå¦‚ä¸‹å›¾ï¼š</p><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/f4fb7b199888404f864e1d0c43d0dc7f~tplv-k3u1fbpfcp-zoom-1.image" alt="image-20210223131023498"></p><p>å› æ­¤æˆ‘ä»¬åœ¨å­çº¿ç¨‹åˆ›å»ºToastå°±éœ€è¦ä½¿ç”¨ä¸Šè¿°2ä»£ç çš„æ–¹å¼</p><h2 id="å­çº¿ç¨‹å¼¹Dialog"><a href="#å­çº¿ç¨‹å¼¹Dialog" class="headerlink" title="å­çº¿ç¨‹å¼¹Dialog"></a>å­çº¿ç¨‹å¼¹Dialog</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>()&#123;<br>    <span class="hljs-meta">@Override</span><br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span><span class="hljs-params">()</span> &#123;<br>            Looper.prepare();<br>          <span class="hljs-keyword">new</span> <span class="hljs-title class_">AlertDialog</span>.Builder(MainActivity.<span class="hljs-built_in">this</span>)<br>                  .setTitle(<span class="hljs-string">&quot;æ ‡é¢˜&quot;</span>)<br>                  .setMessage(<span class="hljs-string">&quot;å­çº¿ç¨‹å¼¹Dialog&quot;</span>)<br>                  .setNegativeButton(<span class="hljs-string">&quot;å–æ¶ˆ&quot;</span>,<span class="hljs-literal">null</span>)<br>                  .setPositiveButton(<span class="hljs-string">&quot;ç¡®å®š&quot;</span>,<span class="hljs-literal">null</span>)<br>                  .show();<br>            Looper.loop();     <br>    &#125;    <br>&#125;.start();<br></code></pre></td></tr></table></figure><p>å’Œä¸Šé¢Toastå·®ä¸å¤šï¼Œè¿™é‡Œè´´å‡ºæ­£ç¡®çš„ä»£ç ç¤ºä¾‹ï¼Œå®ƒçš„å®ç°ä¹Ÿæ˜¯ä¾èµ–Handlerï¼Œæˆ‘ä»¬åœ¨å®ƒçš„æºç ä¸­å¯ä»¥çœ‹åˆ°ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">Handler</span> <span class="hljs-variable">mHandler</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Handler</span>();<br></code></pre></td></tr></table></figure><p>ä»–ç›´æ¥å°±newäº†ä¸€ä¸ªHandlerå®ä¾‹ï¼Œæˆ‘ä»¬çŸ¥é“ï¼Œåˆ›å»ºHandlerï¼Œéœ€è¦å…ˆåˆ›å»ºLooperå¹¶å¼€å¯æ¶ˆæ¯å¾ªç¯ï¼Œä¸»çº¿ç¨‹ä¸­å·²ç»ç»™æˆ‘ä»¬åˆ›å»ºå¹¶å¼€å¯æ¶ˆæ¯å¾ªç¯ï¼Œè€Œå­çº¿ç¨‹ä¸­å¹¶æ²¡æœ‰ï¼Œå¦‚æœä¸åˆ›å»ºé‚£å°±ä¼šæŠ¥è¿™å¥ç»å…¸çš„å¼‚å¸¸æç¤ºï¼š**â€Canâ€™t create handler inside thread that has not called Looper.prepare() â€œ**ï¼Œå› æ­¤åœ¨å­çº¿ç¨‹ä¸­ï¼Œéœ€è¦æˆ‘ä»¬æ‰‹åŠ¨å»åˆ›å»ºå¹¶å¼€å¯æ¶ˆæ¯å¾ªç¯</p><p>åˆ°è¿™é‡Œï¼ŒHandlerç›¸å…³çš„æ‰©å±•çŸ¥è¯†å°±å…¨éƒ¨è®²å®Œäº†ï¼Œæˆ‘ä»¬ä¼šå‘ç°ä¹Ÿæœ‰ç€å¾ˆå¤šä½¿ç”¨çš„å°æŠ€å·§ï¼Œæ¯”å¦‚ IdleHandlerï¼Œåˆ¤æ–­æ˜¯å¦æ˜¯ä¸»çº¿ç¨‹ç­‰ç­‰</p><p>ç”±äº Handler çš„ç‰¹æ€§ï¼Œå®ƒåœ¨ Android é‡Œçš„åº”ç”¨éå¸¸å¹¿æ³›ï¼Œæ¯”å¦‚ï¼š AsyncTaskã€HandlerThreadã€Messengerã€IdleHandler å’Œ IntentService ç­‰ç­‰ï¼Œä¸‹é¢æˆ‘ä»¬æ¥å›ç­”ä¸Šä¸€ç¯‡ä¸­åˆ—å‡ºæ¥çš„ä¸€ç³»åˆ—é—®é¢˜</p><h2 id="é—®é¢˜"><a href="#é—®é¢˜" class="headerlink" title="é—®é¢˜"></a>é—®é¢˜</h2><h3 id="1ã€Handleræœ‰å“ªäº›ä½œç”¨"><a href="#1ã€Handleræœ‰å“ªäº›ä½œç”¨" class="headerlink" title="1ã€Handleræœ‰å“ªäº›ä½œç”¨?"></a>1ã€Handleræœ‰å“ªäº›ä½œç”¨?</h3><p>ç­”ï¼š</p><p> 1ã€Handlerèƒ½å¤Ÿè¿›è¡Œçº¿ç¨‹ä¹‹é—´çš„åˆ‡æ¢ </p><p>2ã€Handlerèƒ½å¤ŸæŒ‰ç…§é¡ºåºå¤„ç†æ¶ˆæ¯ï¼Œé¿å…å¹¶å‘ </p><p>3ã€Handlerèƒ½å¤Ÿé˜»å¡çº¿ç¨‹ </p><p>4ã€Handlerèƒ½å¤Ÿå‘é€å¹¶å¤„ç†å»¶è¿Ÿæ¶ˆæ¯</p><p>è§£æ: </p><p>1ã€Handlerèƒ½å¤Ÿè¿›è¡Œçº¿ç¨‹ä¹‹é—´çš„åˆ‡æ¢ï¼Œæ˜¯å› ä¸ºä½¿ç”¨äº†ä¸åŒçº¿ç¨‹çš„Looperå¤„ç†æ¶ˆæ¯</p><p>2ã€Handlerèƒ½å¤ŸæŒ‰ç…§é¡ºåºå¤„ç†æ¶ˆæ¯ï¼Œé¿å…å¹¶å‘ï¼Œæ˜¯å› ä¸ºæ¶ˆæ¯åœ¨å…¥é˜Ÿçš„æ—¶å€™ä¼šæŒ‰ç…§æ—¶é—´å‡åºå¯¹å½“å‰é“¾è¡¨è¿›è¡Œæ’åºï¼ŒLooperè¯»å–çš„æ—¶å€™ï¼ŒMessageQueueçš„<code>next</code>æ–¹æ³•ä¼šå¾ªç¯åŠ é”ï¼ŒåŒæ—¶é…åˆé˜»å¡å”¤é†’æœºåˆ¶</p><p>3ã€Handlerèƒ½å¤Ÿé˜»å¡çº¿ç¨‹ä¸»è¦æ˜¯åŸºäºLinuxçš„epollæœºåˆ¶å®ç°çš„</p><p>4ã€Handlerèƒ½å¤Ÿå¤„ç†å»¶è¿Ÿæ¶ˆæ¯ï¼Œæ˜¯å› ä¸ºMessageQueueçš„<code>next</code>æ–¹æ³•ä¸­ä¼šæ‹¿å½“å‰æ¶ˆæ¯æ—¶é—´å’Œå½“å‰æ—¶é—´åšæ¯”è¾ƒï¼Œå¦‚æœæ˜¯å»¶è¿Ÿæ¶ˆæ¯ï¼Œé‚£ä¹ˆå°±ä¼šé˜»å¡å½“å‰çº¿ç¨‹ï¼Œç­‰é˜»å¡æ—¶é—´åˆ°ï¼Œåœ¨æ‰§è¡Œè¯¥æ¶ˆæ¯</p><h3 id="2ã€ä¸ºä»€ä¹ˆæˆ‘ä»¬èƒ½åœ¨ä¸»çº¿ç¨‹ç›´æ¥ä½¿ç”¨Handlerï¼Œè€Œä¸éœ€è¦åˆ›å»ºLooperï¼Ÿ"><a href="#2ã€ä¸ºä»€ä¹ˆæˆ‘ä»¬èƒ½åœ¨ä¸»çº¿ç¨‹ç›´æ¥ä½¿ç”¨Handlerï¼Œè€Œä¸éœ€è¦åˆ›å»ºLooperï¼Ÿ" class="headerlink" title="2ã€ä¸ºä»€ä¹ˆæˆ‘ä»¬èƒ½åœ¨ä¸»çº¿ç¨‹ç›´æ¥ä½¿ç”¨Handlerï¼Œè€Œä¸éœ€è¦åˆ›å»ºLooperï¼Ÿ"></a>2ã€ä¸ºä»€ä¹ˆæˆ‘ä»¬èƒ½åœ¨ä¸»çº¿ç¨‹ç›´æ¥ä½¿ç”¨Handlerï¼Œè€Œä¸éœ€è¦åˆ›å»ºLooperï¼Ÿ</h3><p>ç­”ï¼šä¸»çº¿ç¨‹å·²ç»åˆ›å»ºäº†Looperï¼Œå¹¶å¼€å¯äº†æ¶ˆæ¯å¾ªç¯</p><h3 id="3ã€å¦‚æœæƒ³è¦åœ¨å­çº¿ç¨‹åˆ›å»ºHandlerï¼Œéœ€è¦åšä»€ä¹ˆå‡†å¤‡ï¼Ÿ"><a href="#3ã€å¦‚æœæƒ³è¦åœ¨å­çº¿ç¨‹åˆ›å»ºHandlerï¼Œéœ€è¦åšä»€ä¹ˆå‡†å¤‡ï¼Ÿ" class="headerlink" title="3ã€å¦‚æœæƒ³è¦åœ¨å­çº¿ç¨‹åˆ›å»ºHandlerï¼Œéœ€è¦åšä»€ä¹ˆå‡†å¤‡ï¼Ÿ"></a>3ã€å¦‚æœæƒ³è¦åœ¨å­çº¿ç¨‹åˆ›å»ºHandlerï¼Œéœ€è¦åšä»€ä¹ˆå‡†å¤‡ï¼Ÿ</h3><p>ç­”ï¼šéœ€è¦å…ˆåˆ›å»ºLooperï¼Œå¹¶å¼€å¯æ¶ˆæ¯å¾ªç¯</p><h3 id="4ã€ä¸€ä¸ªçº¿ç¨‹æœ‰å‡ ä¸ªHandlerï¼Ÿ"><a href="#4ã€ä¸€ä¸ªçº¿ç¨‹æœ‰å‡ ä¸ªHandlerï¼Ÿ" class="headerlink" title="4ã€ä¸€ä¸ªçº¿ç¨‹æœ‰å‡ ä¸ªHandlerï¼Ÿ"></a>4ã€ä¸€ä¸ªçº¿ç¨‹æœ‰å‡ ä¸ªHandlerï¼Ÿ</h3><p>ç­”ï¼šå¯ä»¥æœ‰ä»»æ„å¤šä¸ª</p><h3 id="5ã€ä¸€ä¸ªçº¿ç¨‹æœ‰å‡ ä¸ªLooperï¼Ÿå¦‚ä½•ä¿è¯ï¼Ÿ"><a href="#5ã€ä¸€ä¸ªçº¿ç¨‹æœ‰å‡ ä¸ªLooperï¼Ÿå¦‚ä½•ä¿è¯ï¼Ÿ" class="headerlink" title="5ã€ä¸€ä¸ªçº¿ç¨‹æœ‰å‡ ä¸ªLooperï¼Ÿå¦‚ä½•ä¿è¯ï¼Ÿ"></a>5ã€ä¸€ä¸ªçº¿ç¨‹æœ‰å‡ ä¸ªLooperï¼Ÿå¦‚ä½•ä¿è¯ï¼Ÿ</h3><p>ç­”ï¼šä¸€ä¸ªçº¿ç¨‹åªæœ‰ä¸€ä¸ªLooperï¼Œé€šè¿‡ThreadLocalæ¥ä¿è¯</p><h3 id="6ã€Handlerå‘é€æ¶ˆæ¯çš„æ—¶å€™ï¼Œæ—¶é—´ä¸ºå•¥è¦å–SystemClock-uptimeMillis-delayMillisï¼Œå¯ä»¥æŠŠSystemClock-uptimeMillis-æ¢æˆSystem-currentTimeMillis-å—ï¼Ÿ"><a href="#6ã€Handlerå‘é€æ¶ˆæ¯çš„æ—¶å€™ï¼Œæ—¶é—´ä¸ºå•¥è¦å–SystemClock-uptimeMillis-delayMillisï¼Œå¯ä»¥æŠŠSystemClock-uptimeMillis-æ¢æˆSystem-currentTimeMillis-å—ï¼Ÿ" class="headerlink" title="6ã€Handlerå‘é€æ¶ˆæ¯çš„æ—¶å€™ï¼Œæ—¶é—´ä¸ºå•¥è¦å–SystemClock.uptimeMillis() + delayMillisï¼Œå¯ä»¥æŠŠSystemClock.uptimeMillis() æ¢æˆSystem.currentTimeMillis()å—ï¼Ÿ"></a>6ã€Handlerå‘é€æ¶ˆæ¯çš„æ—¶å€™ï¼Œæ—¶é—´ä¸ºå•¥è¦å–SystemClock.uptimeMillis() + delayMillisï¼Œå¯ä»¥æŠŠSystemClock.uptimeMillis() æ¢æˆSystem.currentTimeMillis()å—ï¼Ÿ</h3><p>ç­”ï¼šä¸å¯ä»¥</p><p><strong>SystemClock.uptimeMillis()</strong> è¿™ä¸ªæ–¹æ³•è·å–çš„æ—¶é—´ï¼Œæ˜¯è‡ªç³»ç»Ÿå¼€æœºåˆ°ç°åœ¨çš„ä¸€ä¸ªæ¯«ç§’æ•°ï¼Œè¿™ä¸ªæ—¶é—´æ˜¯ä¸ªç›¸å¯¹çš„</p><p><strong>System.currentTimeMillis()</strong> è¿™ä¸ªæ–¹æ³•è·å–çš„æ˜¯è‡ª<strong>1970-01-01 00:00:00</strong> åˆ°ç°åœ¨çš„ä¸€ä¸ªæ¯«ç§’æ•°ï¼Œè¿™æ˜¯ä¸€ä¸ªå’Œç³»ç»Ÿå¼ºå…³è”çš„æ—¶é—´ï¼Œè€Œä¸”è¿™ä¸ªå€¼å¯ä»¥åšä¿®æ”¹</p><p>1ã€ä½¿ç”¨System.currentTimeMillis()å¯èƒ½ä¼šå¯¼è‡´å»¶è¿Ÿæ¶ˆæ¯å¤±æ•ˆ</p><p>2ã€æœ€ç»ˆè¿™ä¸ªæ—¶é—´ä¼šè¢«è®¾ç½®åˆ°Messageçš„whenå±æ€§ï¼Œè€ŒMessageçš„whenå±æ€§åªæ˜¯éœ€è¦ä¸€ä¸ªæ—¶é—´å·®æ¥è¡¨ç¤ºæ¶ˆæ¯çš„å…ˆåé¡ºåºï¼Œä½¿ç”¨ä¸€ä¸ªç›¸å¯¹æ—¶é—´å°±è¡Œäº†ï¼Œæ²¡å¿…è¦ä½¿ç”¨ä¸€ä¸ªç»å¯¹æ—¶é—´</p><h3 id="7ã€ä¸ºä»€ä¹ˆLooperæ­»å¾ªç¯ï¼Œå´ä¸ä¼šå¯¼è‡´åº”ç”¨å¡æ­»ï¼Ÿ"><a href="#7ã€ä¸ºä»€ä¹ˆLooperæ­»å¾ªç¯ï¼Œå´ä¸ä¼šå¯¼è‡´åº”ç”¨å¡æ­»ï¼Ÿ" class="headerlink" title="7ã€ä¸ºä»€ä¹ˆLooperæ­»å¾ªç¯ï¼Œå´ä¸ä¼šå¯¼è‡´åº”ç”¨å¡æ­»ï¼Ÿ"></a>7ã€ä¸ºä»€ä¹ˆLooperæ­»å¾ªç¯ï¼Œå´ä¸ä¼šå¯¼è‡´åº”ç”¨å¡æ­»ï¼Ÿ</h3><p>ç­”ï¼šå› ä¸ºå½“Looperå¤„ç†å®Œæ‰€æœ‰æ¶ˆæ¯çš„æ—¶å€™ï¼Œä¼šè°ƒç”¨Linuxçš„epollæœºåˆ¶è¿›å…¥åˆ°é˜»å¡çŠ¶æ€ï¼Œå½“æœ‰æ–°çš„Messageè¿›æ¥çš„æ—¶å€™ä¼šæ‰“ç ´é˜»å¡ç»§ç»­æ‰§è¡Œã€‚</p><p>åº”ç”¨å¡æ­»å³ANR: å…¨ç§°Applicationn Not Respondingï¼Œä¸­æ–‡æ„æ€æ˜¯åº”ç”¨æ— å“åº”ï¼Œå½“æˆ‘å‘é€ä¸€ä¸ªæ¶ˆæ¯åˆ°ä¸»çº¿ç¨‹ï¼ŒHandlerç»è¿‡ä¸€å®šæ—¶é—´æ²¡æœ‰æ‰§è¡Œå®Œè¿™æ¡æ¶ˆæ¯ï¼Œé‚£ä¹ˆè¿™ä¸ªæ—¶å€™å°±ä¼šæŠ›å‡ºANRå¼‚å¸¸</p><p>Looperæ­»å¾ªç¯: å¾ªç¯æ‰§è¡Œå„ç§äº‹åŠ¡ï¼ŒLooperæ­»å¾ªç¯è¯´æ˜çº¿ç¨‹è¿˜æ´»ç€ï¼Œå¦‚æœæ²¡æœ‰Looperæ­»å¾ªç¯ï¼Œçº¿ç¨‹ç»“æŸï¼Œåº”ç”¨å°±é€€å‡ºäº†ï¼Œå½“Looperå¤„ç†å®Œæ‰€æœ‰æ¶ˆæ¯çš„æ—¶å€™ä¼šè°ƒç”¨Linuxçš„epollæœºåˆ¶è¿›å…¥åˆ°é˜»å¡çŠ¶æ€ï¼Œå½“æœ‰æ–°çš„Messageè¿›æ¥çš„æ—¶å€™ä¼šæ‰“ç ´é˜»å¡ç»§ç»­æ‰§è¡Œ</p><h3 id="8ã€Handlerå†…å­˜æ³„éœ²åŸå› -å¦‚ä½•è§£å†³ï¼Ÿ"><a href="#8ã€Handlerå†…å­˜æ³„éœ²åŸå› -å¦‚ä½•è§£å†³ï¼Ÿ" class="headerlink" title="8ã€Handlerå†…å­˜æ³„éœ²åŸå› ? å¦‚ä½•è§£å†³ï¼Ÿ"></a>8ã€Handlerå†…å­˜æ³„éœ²åŸå› ? å¦‚ä½•è§£å†³ï¼Ÿ</h3><p>å†…å­˜æ³„æ¼çš„æœ¬è´¨æ˜¯é•¿ç”Ÿå‘½å‘¨æœŸçš„å¯¹è±¡æŒæœ‰çŸ­ç”Ÿå‘½å‘¨æœŸå¯¹è±¡çš„å¼•ç”¨ï¼Œå¯¼è‡´çŸ­ç”Ÿå‘½å‘¨æœŸçš„å¯¹è±¡æ— æ³•è¢«å›æ”¶ï¼Œä»è€Œå¯¼è‡´äº†å†…å­˜æ³„æ¼</p><p>ä¸‹é¢æˆ‘ä»¬å°±çœ‹ä¸ªå¯¼è‡´å†…å­˜æ³„æ¼çš„ä¾‹å­</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MainActivity</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AppCompatActivity</span> &#123;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">Handler</span> <span class="hljs-variable">mHandler</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Handler</span>() &#123;<br>        <span class="hljs-meta">@Override</span><br>        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">handleMessage</span><span class="hljs-params">(<span class="hljs-meta">@NonNull</span> Message msg)</span> &#123;<br>           <span class="hljs-comment">//do something</span><br>        &#125;<br>    &#125;;<br>  <br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onCreate</span><span class="hljs-params">(Bundle savedInstanceState)</span> &#123;<br>        <span class="hljs-built_in">super</span>.onCreate(savedInstanceState);<br>        setContentView(R.layout.activity_main);<br>        <span class="hljs-comment">//å‘é€ä¸€ä¸ªå»¶è¿Ÿæ¶ˆæ¯ï¼Œ10åˆ†é’Ÿååœ¨æ‰§è¡Œ</span><br>        mHandler.sendEmptyMessageDelayed(<span class="hljs-number">0x001</span>,<span class="hljs-number">10</span>*<span class="hljs-number">60</span>*<span class="hljs-number">1000</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ä¸Šè¿°ä»£ç :</p><p>1ã€æˆ‘ä»¬é€šè¿‡åŒ¿åå†…éƒ¨ç±»çš„æ–¹å¼åˆ›å»ºäº†ä¸€ä¸ªHandlerçš„å®ä¾‹</p><p>2ã€åœ¨<code>onCreate</code>æ–¹æ³•é‡Œé¢é€šè¿‡Handlerå®ä¾‹å‘é€äº†ä¸€ä¸ªå»¶è¿Ÿ10åˆ†é’Ÿæ‰§è¡Œçš„æ¶ˆæ¯</p><p>æˆ‘ä»¬å‘é€çš„è¿™ä¸ªå»¶è¿Ÿ10åˆ†é’Ÿæ‰§è¡Œçš„æ¶ˆæ¯å®ƒæ˜¯æŒæœ‰Handlerçš„å¼•ç”¨çš„ï¼Œæ ¹æ®Javaç‰¹æ€§æˆ‘ä»¬åˆçŸ¥é“ï¼Œéé™æ€å†…éƒ¨ç±»ä¼šæŒæœ‰å¤–éƒ¨ç±»çš„å¼•ç”¨ï¼Œå› æ­¤å½“å‰HandleråˆæŒæœ‰Activityçš„å¼•ç”¨ï¼Œè€ŒMessageåˆå­˜åœ¨MessageQueueä¸­ï¼ŒMessageQueueåˆåœ¨å½“å‰çº¿ç¨‹ä¸­ï¼Œå› æ­¤ä¼šå­˜åœ¨ä¸€ä¸ªå¼•ç”¨é“¾å…³ç³»:</p><p><strong>å½“å‰çº¿ç¨‹-&gt;MessageQueue-&gt;Message-&gt;Handler-&gt;Activity</strong></p><p>å› æ­¤å½“æˆ‘ä»¬é€€å‡ºActivityçš„æ—¶å€™ï¼Œç”±äºæ¶ˆæ¯éœ€è¦åœ¨10åˆ†é’Ÿååœ¨æ‰§è¡Œï¼Œå› æ­¤ä¼šä¸€ç›´æŒæœ‰Activityï¼Œä»è€Œå¯¼è‡´äº†Activityçš„å†…å­˜æ³„æ¼</p><p>é€šè¿‡ä¸Šé¢åˆ†ææˆ‘ä»¬çŸ¥é“äº†å†…å­˜æ³„æ¼çš„åŸå› å°±æ˜¯æŒæœ‰äº†Activityçš„å¼•ç”¨ï¼Œé‚£æˆ‘ä»¬æ˜¯ä¸æ˜¯ä¼šæƒ³ï¼Œåˆ‡æ–­è¿™æ¡å¼•ç”¨ï¼Œé‚£ä¹ˆå¦‚æœæˆ‘ä»¬éœ€è¦ç”¨åˆ°Activityç›¸å…³çš„å±æ€§å’Œæ–¹æ³•é‡‡ç”¨å¼±å¼•ç”¨çš„æ–¹å¼ä¸å°±å¯ä»¥äº†ä¹ˆï¼Ÿæˆ‘ä»¬å®é™…æ“ä½œä¸€ä¸‹ï¼ŒæŠŠHandlerå†™æˆä¸€ä¸ªé™æ€å†…éƒ¨ç±»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MainActivity</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AppCompatActivity</span> &#123;<br><br>  <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">SafeHandler</span> <span class="hljs-variable">mSafeHandler</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SafeHandler</span>(<span class="hljs-built_in">this</span>);<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onCreate</span><span class="hljs-params">(Bundle savedInstanceState)</span> &#123;<br>        <span class="hljs-built_in">super</span>.onCreate(savedInstanceState);<br>        setContentView(R.layout.activity_main);<br>      <span class="hljs-comment">//å‘é€ä¸€ä¸ªå»¶è¿Ÿæ¶ˆæ¯ï¼Œ10åˆ†é’Ÿååœ¨æ‰§è¡Œ</span><br>        mSafeHandler.sendEmptyMessageDelayed(<span class="hljs-number">0x001</span>,<span class="hljs-number">10</span>*<span class="hljs-number">60</span>*<span class="hljs-number">1000</span>);<br>    &#125;<br><br>    <span class="hljs-comment">//é™æ€å†…éƒ¨ç±»å¹¶æŒæœ‰Activityçš„å¼±å¼•ç”¨</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SafeHandler</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Handler</span>&#123;<br>      <br>        <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> WeakReference&lt;MainActivity&gt; mWeakReference;<br>      <br>        <span class="hljs-keyword">public</span> <span class="hljs-title function_">SafeHandler</span><span class="hljs-params">(MainActivity activity)</span>&#123;<br>            mWeakReference = <span class="hljs-keyword">new</span> <span class="hljs-title class_">WeakReference</span>&lt;&gt;(activity);<br>        &#125;<br><br>        <span class="hljs-meta">@Override</span><br>        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">handleMessage</span><span class="hljs-params">(<span class="hljs-meta">@NonNull</span> Message msg)</span> &#123;<br>            <span class="hljs-type">MainActivity</span> <span class="hljs-variable">mMainActivity</span> <span class="hljs-operator">=</span> mWeakReference.get();<br>            <span class="hljs-keyword">if</span>(mMainActivity != <span class="hljs-literal">null</span>)&#123;<br>                <span class="hljs-comment">//do something</span><br>            &#125;<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ä¸Šè¿°ä»£ç </p><p>1ã€æŠŠHandlerå®šä¹‰æˆäº†ä¸€ä¸ªé™æ€å†…éƒ¨ç±»ï¼Œå¹¶æŒæœ‰å½“å‰Activityçš„å¼±å¼•ç”¨ï¼Œå¼±å¼•ç”¨ä¼šåœ¨Javaè™šæ‹Ÿæœºå‘ç”Ÿgcçš„æ—¶å€™æŠŠå¯¹è±¡ç»™å›æ”¶æ‰</p><p>ç»è¿‡ä¸Šè¿°æ”¹é€ ï¼Œæˆ‘ä»¬è§£å†³äº†Activityçš„å†…å­˜æ³„æ¼ï¼Œæ­¤æ—¶çš„å¼•ç”¨é“¾å…³ç³»ä¸º:</p><p><strong>å½“å‰çº¿ç¨‹-&gt;MessageQueue-&gt;Message-&gt;Handler</strong></p><p>æˆ‘ä»¬ä¼šå‘ç°Messageè¿˜æ˜¯ä¼šæŒæœ‰Handlerçš„å¼•ç”¨ï¼Œä»è€Œå¯¼è‡´Handlerä¹Ÿä¼šå†…å­˜æ³„æ¼ï¼Œæ‰€ä»¥æˆ‘ä»¬åº”è¯¥åœ¨Activityé”€æ¯çš„æ—¶å€™ï¼Œåœ¨ä»–çš„ç”Ÿå‘½å‘¨æœŸæ–¹æ³•é‡Œï¼ŒæŠŠMessageQueueä¸­çš„Messageéƒ½ç»™ç§»é™¤æ‰ï¼Œå› æ­¤æœ€ç»ˆå°±å˜æˆäº†è¿™æ ·ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MainActivity</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AppCompatActivity</span> &#123;<br><br>  <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">SafeHandler</span> <span class="hljs-variable">mSafeHandler</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SafeHandler</span>(<span class="hljs-built_in">this</span>);<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onCreate</span><span class="hljs-params">(Bundle savedInstanceState)</span> &#123;<br>        <span class="hljs-built_in">super</span>.onCreate(savedInstanceState);<br>        setContentView(R.layout.activity_main);<br>      <span class="hljs-comment">//å‘é€ä¸€ä¸ªå»¶è¿Ÿæ¶ˆæ¯ï¼Œ10åˆ†é’Ÿååœ¨æ‰§è¡Œ</span><br>        mSafeHandler.sendEmptyMessageDelayed(<span class="hljs-number">0x001</span>,<span class="hljs-number">10</span>*<span class="hljs-number">60</span>*<span class="hljs-number">1000</span>);<br>    &#125;<br>  <br>  <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onDestroy</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-built_in">super</span>.onDestroy();<br>        mSafeHandler.removeCallbacksAndMessages(<span class="hljs-literal">null</span>);<br>    &#125;<br><br>    <span class="hljs-comment">//é™æ€å†…éƒ¨ç±»å¹¶æŒæœ‰Activityçš„å¼±å¼•ç”¨</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SafeHandler</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Handler</span>&#123;<br>      <br>        <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> WeakReference&lt;MainActivity&gt; mWeakReference;<br>      <br>        <span class="hljs-keyword">public</span> <span class="hljs-title function_">SafeHandler</span><span class="hljs-params">(MainActivity activity)</span>&#123;<br>            mWeakReference = <span class="hljs-keyword">new</span> <span class="hljs-title class_">WeakReference</span>&lt;&gt;(activity);<br>        &#125;<br><br>        <span class="hljs-meta">@Override</span><br>        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">handleMessage</span><span class="hljs-params">(<span class="hljs-meta">@NonNull</span> Message msg)</span> &#123;<br>            <span class="hljs-type">MainActivity</span> <span class="hljs-variable">mMainActivity</span> <span class="hljs-operator">=</span> mWeakReference.get();<br>            <span class="hljs-keyword">if</span>(mMainActivity != <span class="hljs-literal">null</span>)&#123;<br>                <span class="hljs-comment">//do something</span><br>            &#125;<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>å› æ­¤å½“Activityé”€æ¯åï¼Œå¼•ç”¨é“¾å…³ç³»ä¸º:</p><p><strong>å½“å‰çº¿ç¨‹-&gt;MessageQueue</strong></p><p>è€Œå½“å‰çº¿ç¨‹å’ŒMessageQueueçš„ç”Ÿå‘½å‘¨æœŸå’Œåº”ç”¨ç”Ÿå‘½å‘¨æœŸæ˜¯ä¸€æ ·é•¿çš„ï¼Œå› æ­¤ä¹Ÿå°±ä¸å­˜åœ¨å†…å­˜æ³„æ¼äº†ï¼Œå®Œç¾ã€‚</p><p>æ‰€ä»¥è§£å†³Handlerå†…å­˜æ³„æ¼æœ€å¥½çš„æ–¹å¼å°±æ˜¯ï¼š<strong>å°†Handlerå®šä¹‰æˆé™æ€å†…éƒ¨ç±»ï¼Œå†…éƒ¨æŒæœ‰Activityçš„å¼±å¼•ç”¨ï¼Œå¹¶åœ¨Activityé”€æ¯çš„æ—¶å€™ç§»é™¤æ‰€æœ‰æ¶ˆæ¯</strong></p><h3 id="9ã€çº¿ç¨‹ç»´æŠ¤çš„Looperï¼Œåœ¨æ¶ˆæ¯é˜Ÿåˆ—æ— æ¶ˆæ¯æ—¶çš„å¤„ç†æ–¹æ¡ˆæ˜¯ä»€ä¹ˆï¼Ÿæœ‰ä»€ä¹ˆç”¨ï¼Ÿ"><a href="#9ã€çº¿ç¨‹ç»´æŠ¤çš„Looperï¼Œåœ¨æ¶ˆæ¯é˜Ÿåˆ—æ— æ¶ˆæ¯æ—¶çš„å¤„ç†æ–¹æ¡ˆæ˜¯ä»€ä¹ˆï¼Ÿæœ‰ä»€ä¹ˆç”¨ï¼Ÿ" class="headerlink" title="9ã€çº¿ç¨‹ç»´æŠ¤çš„Looperï¼Œåœ¨æ¶ˆæ¯é˜Ÿåˆ—æ— æ¶ˆæ¯æ—¶çš„å¤„ç†æ–¹æ¡ˆæ˜¯ä»€ä¹ˆï¼Ÿæœ‰ä»€ä¹ˆç”¨ï¼Ÿ"></a>9ã€çº¿ç¨‹ç»´æŠ¤çš„Looperï¼Œåœ¨æ¶ˆæ¯é˜Ÿåˆ—æ— æ¶ˆæ¯æ—¶çš„å¤„ç†æ–¹æ¡ˆæ˜¯ä»€ä¹ˆï¼Ÿæœ‰ä»€ä¹ˆç”¨ï¼Ÿ</h3><p>ç­”ï¼šå½“æ¶ˆæ¯é˜Ÿåˆ—æ— æ¶ˆæ¯æ—¶ï¼ŒLooperä¼šé˜»å¡å½“å‰çº¿ç¨‹ï¼Œé‡Šæ”¾cpuèµ„æºï¼Œæé«˜Appæ€§èƒ½</p><p>æˆ‘ä»¬çŸ¥é“Looperçš„<code>loop</code>æ–¹æ³•ä¸­æœ‰ä¸ªæ­»å¾ªç¯ä¸€ç›´åœ¨è¯»å–MessageQueueä¸­çš„æ¶ˆæ¯ï¼Œå…¶å®æ˜¯è°ƒç”¨äº†MessageQueueä¸­çš„<code>next</code>æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•ä¼šåœ¨æ— æ¶ˆæ¯æ—¶ï¼Œè°ƒç”¨Linuxçš„epollæœºåˆ¶ï¼Œä½¿å¾—çº¿ç¨‹è¿›å…¥é˜»å¡çŠ¶æ€ï¼Œå½“æœ‰æ–°æ¶ˆæ¯åˆ°æ¥æ—¶ï¼Œå°±ä¼šå°†å®ƒå”¤é†’ï¼Œnextæ–¹æ³•é‡Œä¼šåˆ¤æ–­å½“å‰æ¶ˆæ¯æ˜¯å¦æ˜¯å»¶è¿Ÿæ¶ˆæ¯ï¼Œå¦‚æœæ˜¯åˆ™é˜»å¡çº¿ç¨‹ï¼Œå¦‚æœä¸æ˜¯ï¼Œåˆ™ä¼šè¿”å›è¿™æ¡æ¶ˆæ¯å¹¶å°†å…¶ä»ä¼˜å…ˆçº§é˜Ÿåˆ—ä¸­ç»™ç§»é™¤</p><h3 id="10ã€MessageQueueä»€ä¹ˆæƒ…å†µä¸‹ä¼šè¢«å”¤é†’ï¼Ÿ"><a href="#10ã€MessageQueueä»€ä¹ˆæƒ…å†µä¸‹ä¼šè¢«å”¤é†’ï¼Ÿ" class="headerlink" title="10ã€MessageQueueä»€ä¹ˆæƒ…å†µä¸‹ä¼šè¢«å”¤é†’ï¼Ÿ"></a>10ã€MessageQueueä»€ä¹ˆæƒ…å†µä¸‹ä¼šè¢«å”¤é†’ï¼Ÿ</h3><p>ç­”ï¼šéœ€è¦åˆ†æƒ…å†µ</p><p>1ã€å‘é€æ¶ˆæ¯è¿‡æ¥ï¼Œæ­¤æ—¶MessageQueueä¸­æ— æ¶ˆæ¯æˆ–è€…å½“å‰å‘é€è¿‡æ¥çš„æ¶ˆæ¯æºå¸¦çš„whenä¸º0æˆ–è€…æœ‰å»¶è¿Ÿæ‰§è¡Œçš„æ¶ˆæ¯ï¼Œé‚£ä¹ˆéœ€è¦å”¤é†’</p><p>2ã€å½“é‡åˆ°åŒæ­¥å±éšœä¸”å½“å‰å‘é€è¿‡æ¥çš„æ¶ˆæ¯ä¸ºå¼‚æ­¥æ¶ˆæ¯ï¼Œåˆ¤æ–­è¯¥å¼‚æ­¥æ¶ˆæ¯æ˜¯å¦æ’å…¥åœ¨æ‰€æœ‰å¼‚æ­¥æ¶ˆæ¯çš„é˜Ÿé¦–ï¼Œå¦‚æœæ˜¯åˆ™éœ€è¦å”¤é†’ï¼Œå¦‚æœä¸æ˜¯ï¼Œåˆ™ä¸å”¤é†’</p><h3 id="11ã€çº¿ç¨‹ä»€ä¹ˆæƒ…å†µä¸‹ä¼šè¢«é˜»å¡ï¼Ÿ"><a href="#11ã€çº¿ç¨‹ä»€ä¹ˆæƒ…å†µä¸‹ä¼šè¢«é˜»å¡ï¼Ÿ" class="headerlink" title="11ã€çº¿ç¨‹ä»€ä¹ˆæƒ…å†µä¸‹ä¼šè¢«é˜»å¡ï¼Ÿ"></a>11ã€çº¿ç¨‹ä»€ä¹ˆæƒ…å†µä¸‹ä¼šè¢«é˜»å¡ï¼Ÿ</h3><p>ç­”ï¼šåˆ†æƒ…å†µ</p><p>1ã€å½“MessageQueueä¸­æ²¡æœ‰æ¶ˆæ¯çš„æ—¶å€™ï¼Œè¿™ä¸ªæ—¶å€™ä¼šæ— é™é˜»å¡ï¼Œ</p><p>2ã€å½“å‰MessageQueueä¸­å…¨éƒ¨æ˜¯å»¶è¿Ÿæ¶ˆæ¯ï¼Œé˜»å¡æ—¶é—´ä¸º(å½“å‰å»¶è¿Ÿæ¶ˆæ¯æ—¶é—´ - å½“å‰æ—¶é—´)ï¼Œå¦‚æœè¿™ä¸ªé˜»å¡æ—¶é—´è¶…è¿‡æ¥Integerç±»å‹çš„æœ€å¤§å€¼ï¼Œåˆ™å–Integerç±»å‹çš„æœ€å¤§å€¼</p><h3 id="12ã€æˆ‘ä»¬å¯ä»¥ä½¿ç”¨å¤šä¸ªHandlerå¾€æ¶ˆæ¯é˜Ÿåˆ—ä¸­æ·»åŠ æ•°æ®ï¼Œé‚£ä¹ˆå¯èƒ½å­˜åœ¨å‘æ¶ˆæ¯çš„Handlerå­˜åœ¨ä¸åŒçš„çº¿ç¨‹ï¼Œé‚£ä¹ˆHandleræ˜¯å¦‚ä½•ä¿è¯MessageQueueå¹¶å‘è®¿é—®å®‰å…¨çš„å‘¢ï¼Ÿ"><a href="#12ã€æˆ‘ä»¬å¯ä»¥ä½¿ç”¨å¤šä¸ªHandlerå¾€æ¶ˆæ¯é˜Ÿåˆ—ä¸­æ·»åŠ æ•°æ®ï¼Œé‚£ä¹ˆå¯èƒ½å­˜åœ¨å‘æ¶ˆæ¯çš„Handlerå­˜åœ¨ä¸åŒçš„çº¿ç¨‹ï¼Œé‚£ä¹ˆHandleræ˜¯å¦‚ä½•ä¿è¯MessageQueueå¹¶å‘è®¿é—®å®‰å…¨çš„å‘¢ï¼Ÿ" class="headerlink" title="12ã€æˆ‘ä»¬å¯ä»¥ä½¿ç”¨å¤šä¸ªHandlerå¾€æ¶ˆæ¯é˜Ÿåˆ—ä¸­æ·»åŠ æ•°æ®ï¼Œé‚£ä¹ˆå¯èƒ½å­˜åœ¨å‘æ¶ˆæ¯çš„Handlerå­˜åœ¨ä¸åŒçš„çº¿ç¨‹ï¼Œé‚£ä¹ˆHandleræ˜¯å¦‚ä½•ä¿è¯MessageQueueå¹¶å‘è®¿é—®å®‰å…¨çš„å‘¢ï¼Ÿ"></a>12ã€æˆ‘ä»¬å¯ä»¥ä½¿ç”¨å¤šä¸ªHandlerå¾€æ¶ˆæ¯é˜Ÿåˆ—ä¸­æ·»åŠ æ•°æ®ï¼Œé‚£ä¹ˆå¯èƒ½å­˜åœ¨å‘æ¶ˆæ¯çš„Handlerå­˜åœ¨ä¸åŒçš„çº¿ç¨‹ï¼Œé‚£ä¹ˆHandleræ˜¯å¦‚ä½•ä¿è¯MessageQueueå¹¶å‘è®¿é—®å®‰å…¨çš„å‘¢ï¼Ÿ</h3><p>ç­”ï¼šå¾ªç¯åŠ é”ï¼Œé…åˆé˜»å¡å”¤é†’æœºåˆ¶</p><p>æˆ‘ä»¬å¯ä»¥å‘ç°MessageQueueå…¶å®æ˜¯â€œç”Ÿäº§è€…-æ¶ˆè´¹è€…â€æ¨¡å‹ï¼ŒHandlerä¸æ–­åœ°æ”¾å…¥æ¶ˆæ¯ï¼ŒLooperä¸æ–­åœ°å–å‡ºï¼Œè¿™å°±æ¶‰åŠåˆ°æ­»é”é—®é¢˜ã€‚å¦‚æœLooperæ‹¿åˆ°é”ï¼Œä½†æ˜¯é˜Ÿåˆ—ä¸­æ²¡æœ‰æ¶ˆæ¯ï¼Œå°±ä¼šä¸€ç›´ç­‰å¾…ï¼Œè€ŒHandleréœ€è¦æŠŠæ¶ˆæ¯æ”¾è¿›å»ï¼Œé”å´è¢«Looperæ‹¿ç€æ— æ³•å…¥é˜Ÿï¼Œè¿™å°±é€ æˆäº†æ­»é”ã€‚Handleræœºåˆ¶çš„è§£å†³æ–¹æ³•æ˜¯<strong>å¾ªç¯åŠ é”</strong>ã€‚åœ¨MessageQueueçš„nextæ–¹æ³•ä¸­ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java">Message <span class="hljs-title function_">next</span><span class="hljs-params">()</span> &#123;<br>   ...<br>    <span class="hljs-keyword">for</span> (;;) &#123;<br>  ...<br>        nativePollOnce(ptr, nextPollTimeoutMillis);<br>        <span class="hljs-keyword">synchronized</span> (<span class="hljs-built_in">this</span>) &#123;<br>            ...<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ä»–çš„ç­‰å¾…æ˜¯åœ¨é”å¤–çš„ï¼Œå½“é˜Ÿåˆ—ä¸­æ²¡æœ‰æ¶ˆæ¯çš„æ—¶å€™ï¼Œä»–ä¼šå…ˆé‡Šæ”¾é”ï¼Œå†è¿›è¡Œç­‰å¾…ï¼Œç›´åˆ°è¢«å”¤é†’ã€‚è¿™æ ·å°±ä¸ä¼šé€ æˆæ­»é”é—®é¢˜äº†ã€‚</p><p>é‚£åœ¨å…¥é˜Ÿçš„æ—¶å€™ä¼šä¸ä¼šå› ä¸ºé˜Ÿåˆ—å·²ç»æ»¡äº†ç„¶åä¸€è¾¹åœ¨ç­‰å¾…æ¶ˆæ¯å¤„ç†ä¸€è¾¹æ‹¿ç€é”å‘¢ï¼Ÿè¿™ä¸€ç‚¹ä¸åŒçš„æ˜¯MessageQueueçš„æ¶ˆæ¯æ²¡æœ‰ä¸Šé™ï¼Œæˆ–è€…è¯´ä»–çš„ä¸Šé™å°±æ˜¯JVMç»™ç¨‹åºåˆ†é…çš„å†…å­˜ï¼Œå¦‚æœè¶…å‡ºå†…å­˜ä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œä½†ä¸€èˆ¬æƒ…å†µä¸‹æ˜¯ä¸ä¼šçš„ã€‚</p><h3 id="13ã€Handleræ˜¯å¦‚ä½•è¿›è¡Œçº¿ç¨‹åˆ‡æ¢çš„å‘¢ï¼Ÿ"><a href="#13ã€Handleræ˜¯å¦‚ä½•è¿›è¡Œçº¿ç¨‹åˆ‡æ¢çš„å‘¢ï¼Ÿ" class="headerlink" title="13ã€Handleræ˜¯å¦‚ä½•è¿›è¡Œçº¿ç¨‹åˆ‡æ¢çš„å‘¢ï¼Ÿ"></a>13ã€Handleræ˜¯å¦‚ä½•è¿›è¡Œçº¿ç¨‹åˆ‡æ¢çš„å‘¢ï¼Ÿ</h3><p>ç­”ï¼šä½¿ç”¨ä¸åŒçº¿ç¨‹çš„Looperå¤„ç†æ¶ˆæ¯</p><p>æˆ‘ä»¬é€šå¸¸å¤„ç†æ¶ˆæ¯æ˜¯åœ¨Handlerçš„<code>handleMessage</code>æ–¹æ³•ä¸­ï¼Œé‚£ä¹ˆè¿™ä¸ªæ–¹æ³•æ˜¯åœ¨å“ªé‡Œå›è°ƒçš„å‘¢ï¼Ÿçœ‹ä¸‹é¢è¿™æ®µä»£ç </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">loop</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-comment">//å¼€å¯æ­»å¾ªç¯è¯»å–æ¶ˆæ¯</span><br>    <span class="hljs-keyword">for</span> (;;) &#123;<br>         <span class="hljs-comment">// è°ƒç”¨Messageå¯¹åº”çš„Handlerå¤„ç†æ¶ˆæ¯</span><br>         msg.target.dispatchMessage(msg);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ä¸Šè¿°ä»£ç ä¸­<code>msg.target</code>å…¶å®å°±æ˜¯æˆ‘ä»¬å‘é€æ¶ˆæ¯çš„Handlerï¼Œå› æ­¤ä»–ä¼šå›è°ƒHandlerçš„<code>dispatchMessage</code>æ–¹æ³•ï¼Œè€Œ<code>dispatchMessage</code>è¿™ä¸ªæ–¹æ³•æˆ‘ä»¬åœ¨ä¸Šä¸€ç¯‡ä¸­é‡ç‚¹åˆ†æè¿‡ï¼Œå…¶ä¸­æœ‰ä¸€éƒ¨åˆ†é€»è¾‘å°±æ˜¯ä¼šå›è°ƒåˆ°Handlerçš„<code>handleMessage</code>æ–¹æ³•ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥å‘ç°ï¼ŒHandlerçš„<code>handleMessage</code>æ–¹æ³•æ‰€åœ¨çš„çº¿ç¨‹æ˜¯ç”±Looperçš„<code>loop</code>æ–¹æ³•å†³å®šçš„ã€‚å¹³æ—¶æˆ‘ä»¬ä½¿ç”¨çš„æ—¶å€™ï¼Œæ˜¯ä»å¼‚æ­¥çº¿ç¨‹å‘é€æ¶ˆæ¯åˆ° Handlerï¼Œè€Œè¿™ä¸ª Handler çš„ <code>handleMessage()</code> æ–¹æ³•æ˜¯åœ¨ä¸»çº¿ç¨‹è°ƒç”¨çš„ï¼Œå› ä¸ºLooperæ˜¯åœ¨ä¸»çº¿ç¨‹åˆ›å»ºçš„ï¼Œæ‰€ä»¥æ¶ˆæ¯å°±ä»å¼‚æ­¥çº¿ç¨‹åˆ‡æ¢åˆ°äº†ä¸»çº¿ç¨‹ã€‚</p><h3 id="14ã€æˆ‘ä»¬åœ¨ä½¿ç”¨Messageçš„æ—¶å€™ï¼Œåº”è¯¥å¦‚ä½•å»åˆ›å»ºå®ƒï¼Ÿ"><a href="#14ã€æˆ‘ä»¬åœ¨ä½¿ç”¨Messageçš„æ—¶å€™ï¼Œåº”è¯¥å¦‚ä½•å»åˆ›å»ºå®ƒï¼Ÿ" class="headerlink" title="14ã€æˆ‘ä»¬åœ¨ä½¿ç”¨Messageçš„æ—¶å€™ï¼Œåº”è¯¥å¦‚ä½•å»åˆ›å»ºå®ƒï¼Ÿ"></a>14ã€æˆ‘ä»¬åœ¨ä½¿ç”¨Messageçš„æ—¶å€™ï¼Œåº”è¯¥å¦‚ä½•å»åˆ›å»ºå®ƒï¼Ÿ</h3><p>ç­”ï¼šAndroid ç»™ Message è®¾è®¡äº†å›æ”¶æœºåˆ¶ï¼Œå®˜æ–¹å»ºè®®æ˜¯é€šè¿‡<code>Message.obtain</code>æ–¹æ³•æ¥è·å–ï¼Œè€Œä¸æ˜¯ç›´æ¥newä¸€ä¸ªæ–°çš„å¯¹è±¡ï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨ä½¿ç”¨çš„æ—¶å€™åº”å°½é‡å¤ç”¨ Message ï¼Œå‡å°‘å†…å­˜æ¶ˆè€—ï¼Œæ–¹å¼æœ‰äºŒï¼š</p><p>1ã€è°ƒç”¨ Message çš„ä¸€ç³»åˆ—é™æ€é‡è½½æ–¹æ³• <code>Message.obtain</code>  è·å–</p><p>2ã€é€šè¿‡ Handler çš„å…¬æœ‰æ–¹æ³• <code>handler.obtainMessage</code>ï¼Œå®é™…ä¸Š<code>handler.obtainMessage</code>å†…éƒ¨è°ƒç”¨çš„ä¹Ÿæ˜¯<code>Message.obtain</code>çš„é‡è½½æ–¹æ³•</p><h3 id="15ã€Handleré‡Œé¢è—ç€çš„CallBackèƒ½åšä»€ä¹ˆï¼Ÿ"><a href="#15ã€Handleré‡Œé¢è—ç€çš„CallBackèƒ½åšä»€ä¹ˆï¼Ÿ" class="headerlink" title="15ã€Handleré‡Œé¢è—ç€çš„CallBackèƒ½åšä»€ä¹ˆï¼Ÿ"></a>15ã€Handleré‡Œé¢è—ç€çš„CallBackèƒ½åšä»€ä¹ˆï¼Ÿ</h3><p>ç­”: åˆ©ç”¨æ­¤CallBackæ‹¦æˆªHandlerçš„æ¶ˆæ¯å¤„ç†</p><p>åœ¨ä¸Šä¸€ç¯‡ä¸­æˆ‘ä»¬åˆ†æåˆ°ï¼Œ<code>dispatchMessage</code>æ–¹æ³•çš„å¤„ç†æ­¥éª¤:</p><p>1ã€é¦–å…ˆï¼Œæ£€æŸ¥Messageçš„callbackæ˜¯å¦ä¸ºnullï¼Œä¸ä¸ºnullå°±é€šè¿‡<code>handleCallBack</code>æ¥å¤„ç†æ¶ˆæ¯ï¼ŒMessageçš„callbackæ˜¯ä¸€ä¸ªRunnableå¯¹è±¡ï¼Œå®é™…ä¸Šå°±æ˜¯Handlerçš„<code>post</code>ç³»åˆ—æ–¹æ³•æ‰€ä¼ é€’çš„Runnableå‚æ•°</p><p>2ã€å…¶æ¬¡ï¼Œæ£€æŸ¥Handleré‡Œé¢è—ç€çš„CallBackæ˜¯å¦ä¸ºnullï¼Œä¸ä¸ºnullå°±è°ƒç”¨mCallbackçš„<code>handleMessage</code>æ–¹æ³•æ¥å¤„ç†æ¶ˆæ¯ï¼Œå¹¶åˆ¤æ–­å…¶è¿”å›å€¼ï¼šä¸ºtrueï¼Œé‚£ä¹ˆ Handler çš„ <code>handleMessage(msg)</code> æ–¹æ³•å°±ä¸ä¼šè¢«è°ƒç”¨äº†ï¼›ä¸ºfalseï¼Œé‚£ä¹ˆå°±æ„å‘³ç€<strong>ä¸€ä¸ªæ¶ˆæ¯å¯ä»¥åŒæ—¶è¢« Callback ä»¥åŠ Handler å¤„ç†</strong>ã€‚</p><p>3ã€æœ€åï¼Œè°ƒç”¨Handlerçš„<code>handleMessage</code>æ–¹æ³•æ¥å¤„ç†æ¶ˆæ¯</p><p>é€šè¿‡ä¸Šé¢åˆ†ææˆ‘ä»¬çŸ¥é“Handlerå¤„ç†æ¶ˆæ¯çš„é¡ºåºæ˜¯ï¼š<strong>Messageçš„Callback &gt; Handlerçš„Callback &gt; Handlerçš„<code>handleMessage</code>æ–¹æ³•</strong></p><p>ä½¿ç”¨åœºæ™¯: Hook ActivityThread.mH ï¼Œ åœ¨ ActivityThread ä¸­æœ‰ä¸ªæˆå‘˜å˜é‡ <code>mH</code> ï¼Œå®ƒæ˜¯ä¸ª Handlerï¼Œåˆæ˜¯ä¸ªæå…¶é‡è¦çš„ç±»ï¼Œå‡ ä¹æ‰€æœ‰çš„æ’ä»¶åŒ–æ¡†æ¶éƒ½ä½¿ç”¨äº†è¿™ä¸ªæ–¹æ³•ã€‚</p><h3 id="16ã€Handleré˜»å¡å”¤é†’æœºåˆ¶æ˜¯æ€ä¹ˆä¸€å›äº‹ï¼Ÿ"><a href="#16ã€Handleré˜»å¡å”¤é†’æœºåˆ¶æ˜¯æ€ä¹ˆä¸€å›äº‹ï¼Ÿ" class="headerlink" title="16ã€Handleré˜»å¡å”¤é†’æœºåˆ¶æ˜¯æ€ä¹ˆä¸€å›äº‹ï¼Ÿ"></a>16ã€Handleré˜»å¡å”¤é†’æœºåˆ¶æ˜¯æ€ä¹ˆä¸€å›äº‹ï¼Ÿ</h3><p>ç­”ï¼š Handlerçš„é˜»å¡å”¤é†’æœºåˆ¶æ˜¯åŸºäºLinuxçš„é˜»å¡å”¤é†’æœºåˆ¶ã€‚</p><p>è¿™ä¸ªæœºåˆ¶ä¹Ÿæ˜¯ç±»ä¼¼äºhandleræœºåˆ¶çš„æ¨¡å¼ã€‚åœ¨æœ¬åœ°åˆ›å»ºä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦ï¼Œç„¶åéœ€è¦ç­‰å¾…çš„ä¸€æ–¹åˆ™ç›‘å¬è¿™ä¸ªæ–‡ä»¶æè¿°ç¬¦ï¼Œå”¤é†’çš„ä¸€æ–¹åªéœ€è¦ä¿®æ”¹è¿™ä¸ªæ–‡ä»¶ï¼Œé‚£ä¹ˆç­‰å¾…çš„ä¸€æ–¹å°±ä¼šæ”¶åˆ°æ–‡ä»¶ä»è€Œæ‰“ç ´å”¤é†’ã€‚å’ŒLooperç›‘å¬MessageQueueï¼ŒHandleræ·»åŠ messageæ˜¯æ¯”è¾ƒç±»ä¼¼çš„ã€‚å…·ä½“çš„Linuxå±‚çŸ¥è¯†è¯»è€…å¯é€šè¿‡è¿™ç¯‡æ–‡ç« è¯¦ç»†äº†è§£ï¼ˆ<a href="https://mp.weixin.qq.com/s/Ylc5mPwMzWoK2CIthZy0Vw">ä¼ é€é—¨</a>ï¼‰</p><h3 id="17ã€ä»€ä¹ˆæ˜¯Handlerçš„åŒæ­¥å±éšœï¼Ÿ"><a href="#17ã€ä»€ä¹ˆæ˜¯Handlerçš„åŒæ­¥å±éšœï¼Ÿ" class="headerlink" title="17ã€ä»€ä¹ˆæ˜¯Handlerçš„åŒæ­¥å±éšœï¼Ÿ"></a>17ã€ä»€ä¹ˆæ˜¯Handlerçš„åŒæ­¥å±éšœï¼Ÿ</h3><p>ç­”: åŒæ­¥å±éšœæ˜¯ä¸€ç§ä½¿å¾—å¼‚æ­¥æ¶ˆæ¯å¯ä»¥è¢«æ›´å¿«å¤„ç†çš„æœºåˆ¶</p><h3 id="18ã€èƒ½ä¸èƒ½è®©ä¸€ä¸ªMessageè¢«åŠ æ€¥å¤„ç†ï¼Ÿ"><a href="#18ã€èƒ½ä¸èƒ½è®©ä¸€ä¸ªMessageè¢«åŠ æ€¥å¤„ç†ï¼Ÿ" class="headerlink" title="18ã€èƒ½ä¸èƒ½è®©ä¸€ä¸ªMessageè¢«åŠ æ€¥å¤„ç†ï¼Ÿ"></a>18ã€èƒ½ä¸èƒ½è®©ä¸€ä¸ªMessageè¢«åŠ æ€¥å¤„ç†ï¼Ÿ</h3><p>ç­”ï¼šå¯ä»¥ï¼Œæ·»åŠ åŠ åŒæ­¥å±éšœï¼Œå¹¶å‘é€å¼‚æ­¥æ¶ˆæ¯</p><h3 id="19ã€ä»€ä¹ˆæ˜¯IdleHandlerï¼Ÿ"><a href="#19ã€ä»€ä¹ˆæ˜¯IdleHandlerï¼Ÿ" class="headerlink" title="19ã€ä»€ä¹ˆæ˜¯IdleHandlerï¼Ÿ"></a>19ã€ä»€ä¹ˆæ˜¯IdleHandlerï¼Ÿ</h3><p>ç­”: IdleHandleræ˜¯MessageQueueä¸­ä¸€ä¸ªé™æ€å‡½æ•°å‹æ¥å£ï¼Œå®ƒåœ¨ä¸»çº¿ç¨‹æ‰§è¡Œå®Œæ‰€æœ‰çš„Viewäº‹åŠ¡åï¼Œå›è°ƒä¸€äº›é¢å¤–çš„æ“ä½œï¼Œä¸”ä¸ä¼šé˜»å¡ä¸»çº¿ç¨‹</p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>Handleræ¶ˆæ¯æœºåˆ¶åœ¨Androidç³»ç»Ÿæºç ä¸­è¿›è¡Œäº†å¤§é‡çš„ä½¿ç”¨ï¼Œå¯ä»¥è¯´æ˜¯æ¶‰åŠäº†Androidçš„æ–¹æ–¹é¢é¢ï¼Œæ¯”å¦‚æˆ‘ä»¬å››å¤§ç»„ä»¶çš„å¯åŠ¨ï¼ŒApplicationçš„åˆ›å»ºç­‰ç­‰ï¼Œå­¦å¥½Handlerç›¸å…³çš„çŸ¥è¯†ï¼Œå¯ä»¥å¸®åŠ©æˆ‘ä»¬æ›´å¥½çš„å»é˜…è¯»Androidæºç ï¼Œè€Œä¸”Handleråœ¨æˆ‘ä»¬æ—¥å¸¸å¼€å‘ä¸­ç›´æ¥æˆ–é—´æ¥çš„ä¼šè¢«ç”¨åˆ°ã€‚åŒæ—¶é€šè¿‡å¯¹Handleræºç çš„å­¦ä¹ ï¼Œè®©æˆ‘æ„Ÿå—åˆ°äº†ä»£ç è®¾è®¡çš„èƒŒåï¼Œè•´è—ç€å·¥ç¨‹å¸ˆå¤§é‡çš„æ™ºæ…§ï¼Œå¿ƒé‡Œç›´å‘¼666ï¼Œå“ˆå“ˆã€‚</p><p>åˆ°äº†è¿™é‡Œï¼Œå…³äºHandlerç›¸å…³çš„çŸ¥è¯†å°±éƒ½è®²å®Œäº†ï¼Œå¦‚æœä½ è¿˜æœ‰ä»€ä¹ˆé—®é¢˜ï¼Œè¯„è®ºåŒºå‘Šè¯‰æˆ‘å§ã€‚</p><h2 id="å‚è€ƒå’Œæ¨è"><a href="#å‚è€ƒå’Œæ¨è" class="headerlink" title="å‚è€ƒå’Œæ¨è"></a>å‚è€ƒå’Œæ¨è</h2><p><a href="https://juejin.cn/post/6887933281686421518">Androidå…¨é¢è§£æä¹‹Handleræœºåˆ¶ï¼ˆç»ˆç¯‡ï¼‰ï¼šå¸¸è§é—®é¢˜æ±‡æ€»</a></p><p><a href="https://juejin.cn/post/6844903783139393550">Handler éƒ½æ²¡ææ‡‚ï¼Œæ‹¿ä»€ä¹ˆå»è·³æ§½å•Šï¼Ÿ</a></p><p><a href="https://juejin.cn/post/6844904150140977165#heading-22">æ¢ä¸ªå§¿åŠ¿ï¼Œå¸¦ç€é—®é¢˜çœ‹Handler</a></p><blockquote><p><strong>ä½ çš„ç‚¹èµï¼Œè¯„è®ºï¼Œæ˜¯å¯¹æˆ‘å·¨å¤§çš„é¼“åŠ±ï¼</strong></p><p>æ¬¢è¿å…³æ³¨æˆ‘çš„<strong>å…¬ä¼—å·ï¼š</strong>  <a href="http://m6z.cn/6jwi7b"><strong>sweetying</strong></a> ï¼Œæ–‡ç« æ›´æ–°å¯ç¬¬ä¸€æ—¶é—´æ”¶åˆ°</p><p>å¦‚æœ<strong>æœ‰é—®é¢˜</strong>ï¼Œå…¬ä¼—å·å†…æœ‰åŠ æˆ‘å¾®ä¿¡çš„å…¥å£ï¼Œåœ¨æŠ€æœ¯å­¦ä¹ ã€ä¸ªäººæˆé•¿çš„é“è·¯ä¸Šï¼Œæˆ‘ä»¬ä¸€èµ·å‰è¿›ï¼</p></blockquote>]]></content>
    
    
    <categories>
      
      <category>Android</category>
      
      <category>ä¸€ç¯‡å°±å¤Ÿ</category>
      
    </categories>
    
    
    <tags>
      
      <tag>åŸåˆ›</tag>
      
      <tag>Android</tag>
      
      <tag>ä¸€ç¯‡å°±å¤Ÿ</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ä¸€ç¯‡å°±å¤Ÿç³»åˆ—ï¼šHandleræ¶ˆæ¯æœºåˆ¶å®Œå…¨è§£æ</title>
    <link href="/2022/10/11/%E4%B8%80%E7%AF%87%E5%B0%B1%E5%A4%9F%E7%B3%BB%E5%88%97%EF%BC%9AHandler%E6%B6%88%E6%81%AF%E6%9C%BA%E5%88%B6%E5%AE%8C%E5%85%A8%E8%A7%A3%E6%9E%90/"/>
    <url>/2022/10/11/%E4%B8%80%E7%AF%87%E5%B0%B1%E5%A4%9F%E7%B3%BB%E5%88%97%EF%BC%9AHandler%E6%B6%88%E6%81%AF%E6%9C%BA%E5%88%B6%E5%AE%8C%E5%85%A8%E8%A7%A3%E6%9E%90/</url>
    
    <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><blockquote><p>Handlerç³»åˆ—æ–‡ç« å…±ä¸¤ç¯‡ï¼š</p><p>ç¬¬ä¸€ç¯‡ï¼š<a href="https://juejin.cn/post/6924084444609544199#heading-5">â€œä¸€ç¯‡å°±å¤Ÿâ€ç³»åˆ—: Handleræ¶ˆæ¯æœºåˆ¶å®Œå…¨è§£æ</a></p><p>ç¬¬äºŒç¯‡ï¼š <a href="https://juejin.cn/post/6932608660354891790/">â€œä¸€ç¯‡å°±å¤Ÿâ€ç³»åˆ—: Handleræ‰©å±•ç¯‡</a></p></blockquote><p>å…³äºHandlerï¼Œæƒ³å¿…å¤§å®¶éƒ½å·²ç»éå¸¸ç†Ÿæ‚‰äº†ï¼Œå®ƒæ˜¯Androidä¸­éå¸¸åŸºç¡€ï¼Œä½†åŒæ—¶ä¹Ÿæå…¶é‡è¦çš„æ¶ˆæ¯æœºåˆ¶ï¼Œè¯´å®ƒåŸºç¡€ï¼Œæ˜¯å› ä¸ºå®ƒä½¿ç”¨ç®€å•ï¼Œåœ¨æˆ‘ä»¬ä¸€å¼€å§‹å­¦ä¹ Androidæ—¶ï¼Œå°±ä¼šæ¥è§¦åˆ°Handlerï¼Œç”¨å®ƒæ¥è¿›è¡Œçº¿ç¨‹é—´çš„é€šä¿¡ã€‚è¯´å®ƒæå…¶é‡è¦ï¼Œæ˜¯å› ä¸ºå®ƒåœ¨Androidç³»ç»Ÿä¸­æ‰®æ¼”äº†ä¸€ä¸ªæå…¶æ ¸å¿ƒçš„è§’è‰²ï¼Œå¯ä»¥è¯´åªè¦æœ‰å¼‚æ­¥é€šä¿¡çš„åœ°æ–¹å°±ä¸€å®šä¼šæœ‰Handlerï¼Œæ­£æ˜¯å› ä¸ºå®ƒçš„å­˜åœ¨ï¼Œä½¿å¾—æˆ‘ä»¬Androidç³»ç»Ÿä¸­çš„å¾ˆå¤šç»„ä»¶èƒ½å¤Ÿæ­£å¸¸çš„è¿è¡Œ</p><p><strong>æ³¨æ„ï¼šæœ¬æ–‡æ‰€å±•ç¤ºçš„ç³»ç»Ÿæºç éƒ½æ˜¯åŸºäºAndroid-29 ï¼Œå¹¶æå–æ ¸å¿ƒéƒ¨åˆ†è¿›è¡Œåˆ†æ</strong></p><h2 id="é—®é¢˜"><a href="#é—®é¢˜" class="headerlink" title="é—®é¢˜"></a>é—®é¢˜</h2><p>ä¸‹é¢æˆ‘åœ¨è¿™é‡ŒæŠ›å‡ºä¸€äº›é—®é¢˜ï¼Œå¦‚æœä½ éƒ½çŸ¥é“ï¼Œé‚£ä¹ˆæ­å–œä½ ï¼Œä½ å¯¹Handleræœºåˆ¶æŒæ¡çš„å¾ˆé€å½»ï¼Œå¦‚æœä½ å¯¹ä¸‹é¢è¿™äº›é—®é¢˜æœ‰ä¸€äº›ç–‘æƒ‘ï¼Œé‚£ä¹ˆä½ å°±å¯ä»¥æ¥ç€å¾€ä¸‹çœ‹ï¼Œæˆ‘ä¼šç”±æµ…å…¥æ·±çš„ç»™ä½ è®²è§£Handleræœºåˆ¶ï¼Œçœ‹å®Œä¹‹åï¼Œè¿™äº›é—®é¢˜ä½ å°±éƒ½ä¼šéå¸¸çš„æ˜äº†ï¼ŒåŒæ—¶åœ¨æœ€åæˆ‘ä¹Ÿä¼šå¯¹è¿™äº›é—®é¢˜ç»™å‡ºè‡ªå·±çš„å›ç­”</p><ol><li>Handleræœ‰å“ªäº›ä½œç”¨?</li><li>ä¸ºä»€ä¹ˆæˆ‘ä»¬èƒ½åœ¨ä¸»çº¿ç¨‹ç›´æ¥ä½¿ç”¨Handlerï¼Œè€Œä¸éœ€è¦åˆ›å»ºLooper?</li><li>å¦‚æœæƒ³è¦åœ¨å­çº¿ç¨‹åˆ›å»ºHandlerï¼Œéœ€è¦åšä»€ä¹ˆå‡†å¤‡?</li><li>ä¸€ä¸ªçº¿ç¨‹æœ‰å‡ ä¸ªHandler?</li><li>ä¸€ä¸ªçº¿ç¨‹æœ‰å‡ ä¸ªLooper?å¦‚ä½•ä¿è¯?</li><li>ä¸ºä»€ä¹ˆLopperæ­»å¾ªç¯ï¼Œå´ä¸ä¼šå¯¼è‡´åº”ç”¨å¡æ­»?</li><li>Handlerå†…å­˜æ³„éœ²åŸå› ? å¦‚ä½•è§£å†³ï¼Ÿ</li><li>çº¿ç¨‹ç»´æŠ¤çš„Looperï¼Œåœ¨æ¶ˆæ¯é˜Ÿåˆ—æ— æ¶ˆæ¯æ—¶çš„å¤„ç†æ–¹æ¡ˆæ˜¯ä»€ä¹ˆ?æœ‰ä»€ä¹ˆç”¨?</li><li>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨å¤šä¸ªHandlerå¾€æ¶ˆæ¯é˜Ÿåˆ—ä¸­æ·»åŠ æ•°æ®ï¼Œé‚£ä¹ˆå¯èƒ½å­˜åœ¨å‘æ¶ˆæ¯çš„Handlerå­˜åœ¨ä¸åŒçš„çº¿ç¨‹ï¼Œé‚£ä¹ˆHandleræ˜¯å¦‚ä½•ä¿è¯MessageQueueå¹¶å‘è®¿é—®å®‰å…¨çš„å‘¢ï¼Ÿ</li><li>Handleræ˜¯å¦‚ä½•è¿›è¡Œçº¿ç¨‹åˆ‡æ¢çš„å‘¢ï¼Ÿ</li><li>æˆ‘ä»¬åœ¨ä½¿ç”¨Messageçš„æ—¶å€™,åº”è¯¥å¦‚ä½•å»åˆ›å»ºå®ƒï¼Ÿ</li><li>Handleré‡Œé¢è—ç€çš„CallBackèƒ½åšä»€ä¹ˆï¼Ÿ</li><li>Handleré˜»å¡å”¤é†’æœºåˆ¶æ˜¯æ€ä¹ˆä¸€å›äº‹ï¼Ÿ</li><li>ä»€ä¹ˆæ˜¯Handlerçš„åŒæ­¥å±éšœï¼Ÿ</li><li>èƒ½ä¸èƒ½è®©ä¸€ä¸ªMessageè¢«åŠ æ€¥å¤„ç†ï¼Ÿ</li></ol><h2 id="ä»€ä¹ˆæ˜¯Handler"><a href="#ä»€ä¹ˆæ˜¯Handler" class="headerlink" title="ä»€ä¹ˆæ˜¯Handler?"></a>ä»€ä¹ˆæ˜¯Handler?</h2><p>æˆ‘ä»¬é€šå¸¸æ‰€è¯´çš„Handlerï¼Œä»–å…¶å®æ˜¯Handleræœºåˆ¶ä¸­çš„ä¸€ä¸ªè§’è‰²ï¼Œåªä¸è¿‡æˆ‘ä»¬å¯¹Handleræ¥è§¦æ¯”è¾ƒå¤šï¼Œå› æ­¤ç”¨Handleræ¥ä»£ç§°</p><p><strong>Handleræœºåˆ¶æ˜¯Androidä¸­åŸºäºå•çº¿æ¶ˆæ¯é˜Ÿåˆ—æ¨¡å¼çš„ä¸€å¥—çº¿ç¨‹æ¶ˆæ¯æœºåˆ¶ã€‚</strong></p><h2 id="HandleråŸºæœ¬ç”¨æ³•"><a href="#HandleråŸºæœ¬ç”¨æ³•" class="headerlink" title="HandleråŸºæœ¬ç”¨æ³•"></a>HandleråŸºæœ¬ç”¨æ³•</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//åœ¨ä¸»çº¿ç¨‹åˆ›å»ºHandlerå®ä¾‹</span><br><span class="hljs-keyword">private</span> <span class="hljs-type">Handler</span> <span class="hljs-variable">mHandler</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Handler</span>() &#123;<br>        <span class="hljs-meta">@Override</span><br>        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">handleMessage</span><span class="hljs-params">(<span class="hljs-meta">@NonNull</span> Message msg)</span> &#123;<br>            <span class="hljs-comment">//å¤„ç†æ¥æ”¶çš„æ¶ˆæ¯</span><br>        &#125;<br>    &#125;;<br><br><span class="hljs-comment">//åœ¨é€‚å½“çš„æ—¶æœºä½¿ç”¨Handlerå®ä¾‹å‘é€æ¶ˆæ¯</span><br>mHandler.sendMessage(message);<br>mHandler.post(runnable);<span class="hljs-comment">//Runnableä¼šè¢«å°è£…è¿›ä¸€ä¸ªMessageï¼Œæ‰€ä»¥å®ƒæœ¬è´¨ä¸Šè¿˜æ˜¯ä¸€ä¸ªMessage</span><br></code></pre></td></tr></table></figure><p>çœ‹ä¸Šé¢è¿™æ®µä»£ç ï¼Œåˆ›å»ºäº†ä¸€ä¸ªHandlerå®ä¾‹å¹¶é‡å†™äº† <code>handleMessage</code> æ–¹æ³• ï¼Œç„¶ååœ¨é€‚å½“çš„æ—¶æœºè°ƒç”¨å®ƒçš„ <code>send</code> æˆ–è€… <code>post</code> ç³»åˆ—æ–¹æ³•å°±å¯ä»¥äº†ï¼Œä½¿ç”¨å°±æ˜¯è¿™ä¹ˆç®€å•</p><p>é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œå®ƒä»¬æ˜¯å¦‚ä½•è¿›è¡Œçº¿ç¨‹é—´çš„é€šä¿¡çš„å‘¢? ä¸‹é¢æˆ‘ä»¬å°±éœ€è¦å¯¹æºç è¿›è¡Œåˆ†æ</p><h2 id="Handleræœºåˆ¶æºç åˆ†æ"><a href="#Handleræœºåˆ¶æºç åˆ†æ" class="headerlink" title="Handleræœºåˆ¶æºç åˆ†æ"></a>Handleræœºåˆ¶æºç åˆ†æ</h2><p>åœ¨åˆ†ææºç ä¹‹å‰,æˆ‘å…ˆè®²ä¸‹Handleræœºåˆ¶æ¶‰åŠçš„å‡ å¤§è§’è‰²: <strong>Handler,Looper,MessageQueue,Message</strong></p><p>å…ˆæå‰ä»‹ç»ä¸‹è¿™å‡ ä¸ªè§’è‰²çš„ä½œç”¨,ä¾¿äºåç»­åˆ†ææºç çš„ä¸€ä¸ªç†è§£</p><p><strong>Handler</strong>: å‘é€æ¶ˆæ¯å’Œå¤„ç†æ¶ˆæ¯</p><p><strong>Looper</strong>: ä»MessageQueueä¸­è·å–Messageï¼Œç„¶åäº¤ç»™Handlerå¤„ç†</p><p><strong>MessageQueue</strong>: æ¶ˆæ¯é˜Ÿåˆ—ï¼Œå­˜æ”¾Handlerå‘é€è¿‡æ¥çš„æ¶ˆæ¯</p><p><strong>Message</strong>: æ¶ˆæ¯çš„è½½ä½“</p><p>ä¸‹é¢æˆ‘ä»¬å¼€å§‹è¿›è¡Œæºç åˆ†æï¼Œåœ¨æˆ‘ä»¬ä¸€å¼€å§‹ä½¿ç”¨çš„æ—¶å€™ï¼Œåˆ›å»ºäº†ä¸€ä¸ªHandlerå®ä¾‹ï¼Œé‚£æˆ‘ä»¬çœ‹ä¸‹å®ƒå®ä¾‹åŒ–çš„è¿™ä¸ªæ„é€ æ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-title function_">Handler</span><span class="hljs-params">()</span> &#123;<br>     <span class="hljs-built_in">this</span>(<span class="hljs-literal">null</span>, <span class="hljs-literal">false</span>);<br>&#125;<br></code></pre></td></tr></table></figure><p>å®ƒå…¶å®æ˜¯è°ƒç”¨äº†å®ƒçš„ä¸€ä¸ªé‡è½½çš„æ–¹æ³•,æ¥ç€çœ‹å®ƒçš„é‡è½½æ–¹æ³•</p><p><strong>æ³¨æ„:</strong> </p><ol><li>Handlerçš„æ„é€ æ–¹æ³•ä¸­è¿˜å¯ä»¥ä¼ å…¥Looperï¼Œé€šè¿‡ä¼ å…¥Looperçš„æ„é€ æ–¹æ³•å¯ä»¥å®ç°ä¸€äº›ç‰¹æ®Šçš„åŠŸèƒ½</li><li>Handlerçš„æ„é€ æ–¹æ³•ä¸­è¿˜å¯ä»¥ä¼ å…¥Callbackï¼Œè¿™ç§æ–¹å¼åˆ›å»ºä¸€ä¸ªHandlerçš„å®ä¾‹ï¼Œå®ƒå¹¶ä¸éœ€è¦æ´¾ç”Ÿå‡ºä¸€ä¸ªå­ç±»ï¼Œåé¢æˆ‘ä¹Ÿä¼šä»‹ç»åˆ°</li><li>æœ‰äº›æ„é€ æ–¹æ³•ä½¿ç”¨äº†<code>@UnsupportedAppUsage</code>æ³¨è§£ï¼Œè¡¨ç¤ºä¸æ”¯æŒå¤–éƒ¨åº”ç”¨è°ƒç”¨</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-title function_">Handler</span><span class="hljs-params">(<span class="hljs-meta">@Nullable</span> Callback callback, <span class="hljs-type">boolean</span> async)</span> &#123;<br>  <span class="hljs-comment">//...</span><br>    <span class="hljs-comment">//è·å–å½“å‰çº¿ç¨‹çš„Lopper</span><br>    mLooper = Looper.myLooper();<br>    <span class="hljs-comment">//å¦‚æœå½“å‰Looperä¸ºç©º,åˆ™æŠ›å‡ºå¼‚å¸¸</span><br>    <span class="hljs-keyword">if</span> (mLooper == <span class="hljs-literal">null</span>) &#123;<br>        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<br>            <span class="hljs-string">&quot;Can&#x27;t create handler inside thread &quot;</span> + Thread.currentThread()<br>                    + <span class="hljs-string">&quot; that has not called Looper.prepare()&quot;</span>);<br>    &#125;<br>    <span class="hljs-comment">//å°†å½“å‰Lopperä¸­çš„MessageQueueèµ‹å€¼ç»™Handlerä¸­çš„MessageQueue</span><br>    mQueue = mLooper.mQueue;<br>    <span class="hljs-comment">//...</span><br> &#125;<br><br><span class="hljs-comment">//---------------------ä»¥ä¸‹ä¸ºé¢å¤–æ‰©å±•å†…å®¹--------------------------</span><br><span class="hljs-comment">//ä¼ å…¥Looperçš„æ„é€ æ–¹æ³•</span><br><span class="hljs-keyword">public</span> <span class="hljs-title function_">Handler</span><span class="hljs-params">(<span class="hljs-meta">@NonNull</span> Looper looper)</span> &#123;<br>    <span class="hljs-built_in">this</span>(looper, <span class="hljs-literal">null</span>, <span class="hljs-literal">false</span>);<br>&#125;<br><br><span class="hljs-comment">//ä¼ å…¥Callbackçš„æ„é€ æ–¹æ³•</span><br><span class="hljs-keyword">public</span> <span class="hljs-title function_">Handler</span><span class="hljs-params">(<span class="hljs-meta">@Nullable</span> Callback callback)</span> &#123;<br>    <span class="hljs-built_in">this</span>(callback, <span class="hljs-literal">false</span>);<br>&#125;<br><br><span class="hljs-comment">//ä½¿ç”¨äº†@UnsupportedAppUsageæ³¨è§£çš„æ„é€ æ–¹æ³•</span><br><span class="hljs-meta">@UnsupportedAppUsage</span><br><span class="hljs-keyword">public</span> <span class="hljs-title function_">Handler</span><span class="hljs-params">(<span class="hljs-type">boolean</span> async)</span> &#123;<br>    <span class="hljs-built_in">this</span>(<span class="hljs-literal">null</span>, async);<br>&#125;<br></code></pre></td></tr></table></figure><p>ä¸Šé¢è¿™æ®µä»£ç æ³¨é‡Šå†™çš„å¾ˆæ¸…æ¥šï¼Œé‚£æˆ‘ä»¬æ˜¯ä¸æ˜¯å°±å¯ä»¥å¾—å‡ºä¸€ä¸ªç»“è®ºï¼š <strong>æˆ‘ä»¬åœ¨åˆ›å»ºHandlerå®ä¾‹çš„æ—¶å€™ï¼Œä¸€å®šè¦å…ˆåˆ›å»ºä¸€ä¸ªLopperï¼Œå¹¶å¼€å¯å¾ªç¯è¯»å–æ¶ˆæ¯</strong>ï¼Œé‚£ä¹ˆå¤§å®¶è‚¯å®šæœ‰ä¸ªç–‘é—®ï¼Ÿ ä½ ä¸Šé¢çš„ä½¿ç”¨å°±æ²¡æœ‰åˆ›å»ºLopperï¼Œé‚£æ˜¯å› ä¸ºæˆ‘ä»¬çš„ä¸»çº¿ç¨‹å·²ç»ç»™æˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªLopper</p><p>æ¥ä¸‹æ¥æˆ‘ä»¬æ‰¾ä¸‹ä¸»çº¿ç¨‹çš„è¿™ä¸ªLopperæ˜¯åœ¨å“ªé‡Œåˆ›å»ºçš„ï¼Œæˆ‘ä»¬æ‰¾åˆ°ActivityThreadçš„main()æ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>  <span class="hljs-comment">//...</span><br> <span class="hljs-comment">//åˆ›å»ºLopper</span><br>  Looper.prepareMainLooper();<br>  <br>  <span class="hljs-type">ActivityThread</span> <span class="hljs-variable">thread</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ActivityThread</span>();<br>  thread.attach(<span class="hljs-literal">false</span>);<br><br>  <span class="hljs-keyword">if</span> (sMainThreadHandler == <span class="hljs-literal">null</span>) &#123;<br>    sMainThreadHandler = thread.getHandler();<br>  &#125;<br>  <span class="hljs-comment">//...</span><br>  <span class="hljs-comment">//å¼€å¯å¾ªç¯è¯»å–æ¶ˆæ¯</span><br>  Looper.loop();<br><span class="hljs-comment">//Looperå¦‚æœå› å¼‚å¸¸åŸå› åœæ­¢å¾ªç¯åˆ™æŠ›å¼‚å¸¸</span><br>  <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">&quot;Main thread loop unexpectedly exited&quot;</span>);<br>&#125;<br></code></pre></td></tr></table></figure><p><strong>æ³¨æ„ï¼šé€šå¸¸æˆ‘ä»¬è®¤ä¸º ActivityThread å°±æ˜¯ä¸»çº¿ç¨‹ã€‚äº‹å®ä¸Šå®ƒå¹¶ä¸æ˜¯ä¸€ä¸ªçº¿ç¨‹ï¼Œè€Œæ˜¯ä¸»çº¿ç¨‹æ“ä½œçš„ç®¡ç†è€…ï¼Œæ‰€ä»¥ä»¬æŠŠ ActivityThread è®¤ä¸ºå°±æ˜¯ä¸»çº¿ç¨‹æ— å¯åšéï¼Œå¦å¤–ä¸»çº¿ç¨‹ä¹Ÿå¯ä»¥è¯´æˆ UI çº¿ç¨‹ã€‚</strong></p><p>æˆ‘ä»¬åœ¨ ActivityThreadé‡Œçš„<code>main</code>æ–¹æ³•é‡Œè°ƒç”¨äº†Looper.prepareMainLooper() æ–¹æ³•åˆ›å»ºäº†ä¸»çº¿ç¨‹çš„Looper ï¼Œå¹¶ä¸”è°ƒç”¨äº†<code>loop</code>æ–¹æ³•ï¼Œæ‰€ä»¥æˆ‘ä»¬å°±å¯ä»¥ç›´æ¥ä½¿ç”¨ Handler</p><p>ç»§ç»­åˆ†æï¼Œæˆ‘ä»¬çŸ¥é“main()æ–¹æ³•æ˜¯Javaç¨‹åºçš„å…¥å£ï¼ŒåŒæ—¶ä¹Ÿæ˜¯Androidåº”ç”¨ç¨‹åºçš„å…¥å£ï¼Œè€Œåœ¨Javaä¸­ï¼Œæˆ‘ä»¬æ‰§è¡Œå®Œmain()æ–¹æ³•ï¼Œé©¬ä¸Šå°±é€€å‡ºäº†ï¼Œè€Œåœ¨Androidä¸­ï¼Œä¸ºå•¥æ²¡æœ‰é€€å‡ºå‘¢ï¼Ÿè¿™é‡Œæˆ‘ä»¬åšä¸ªå‡è®¾ï¼Œå¦‚æœåœ¨Androidä¸­ä¹Ÿé€€å‡ºäº†ï¼Œé‚£ä¹ˆæ˜¯ä¸æ˜¯Androidå°±æ²¡å¾—ç©äº†ï¼Œæ‰€ä»¥Googleè‚¯å®šæ˜¯ä¸èƒ½è®©ä»–é€€å‡ºçš„ï¼Œä¹‹æ‰€ä»¥åœ¨Androidä¸­æ²¡æœ‰é€€å‡ºï¼Œæ­£æ˜¯å› ä¸ºæˆ‘ä»¬åœ¨è¿™é‡Œåˆ›å»ºå¹¶å¼€å¯äº†Looperæ­»å¾ªç¯ï¼Œä»–ä¼šå¾ªç¯æ‰§è¡Œå„ç§äº‹ç‰©ã€‚Looperæ­»å¾ªç¯è¯´æ˜çº¿ç¨‹æ²¡æœ‰æ­»äº¡ï¼Œå¦‚æœLooperåœæ­¢å¾ªç¯ï¼Œçº¿ç¨‹åˆ™ç»“æŸé€€å‡ºäº†</p><p>é‚£ä¹ˆå¤§å®¶æ˜¯ä¸æ˜¯åˆä¼šæœ‰ä¸ªç–‘é—®ï¼Ÿæ—¢ç„¶æ˜¯ä¸€ä¸ªæ­»å¾ªç¯ï¼Œé‚£ä¸ºå•¥ä¸ä¼šé€ æˆANRï¼Ÿ</p><p>å…¶å®Lopperæ­»å¾ªç¯å’Œç¨‹åºANRæ²¡æœ‰ä»»ä½•å…³ç³»ï¼Œè¿™é‡Œæ„Ÿè§‰å°±æ˜¯åœ¨è¿›è¡Œä¸€ä¸ªæ¦‚å¿µçš„æ··æ·†ï¼Œè¿™é‡Œæˆ‘è§£é‡Šä¸€ä¸‹è¿™ä¸¤ä¸ªæ¦‚å¿µ</p><p>ANR: å…¨ç§°Applicationn Not Respondingï¼Œä¸­æ–‡æ„æ€æ˜¯åº”ç”¨æ— å“åº”ï¼Œå½“æˆ‘å‘é€ä¸€ä¸ªæ¶ˆæ¯åˆ°ä¸»çº¿ç¨‹ï¼Œç»è¿‡ä¸€å®šæ—¶é—´æ²¡æœ‰è¢«æ‰§è¡Œï¼Œé‚£ä¹ˆè¿™ä¸ªæ—¶å€™å°±ä¼šæŠ›å‡ºANRå¼‚å¸¸</p><p>Lopperæ­»å¾ªç¯: å¾ªç¯æ‰§è¡Œå„ç§äº‹åŠ¡ï¼Œå½“Looperå¤„ç†å®Œæ‰€æœ‰æ¶ˆæ¯çš„æ—¶å€™ä¼šè¿›å…¥é˜»å¡çŠ¶æ€ï¼Œå½“æœ‰æ–°çš„Messageè¿›æ¥çš„æ—¶å€™ä¼šæ‰“ç ´é˜»å¡ç»§ç»­æ‰§è¡Œ</p><p>åˆ°äº†è¿™é‡Œï¼Œç›¸ä¿¡å¤§å®¶å¯¹äºåˆ›å»ºHandlerå·²ç»å¾ˆæ˜äº†äº†ï¼Œä¸‹é¢æˆ‘ä»¬æ¥å®é™…åº”ç”¨ä¸€ä¸‹ï¼Œåœ¨å­çº¿ç¨‹åˆ›å»ºHandlerï¼Œç›´æ¥ä¸Šä»£ç ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyThread</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Thread</span> &#123;<br>    <span class="hljs-keyword">public</span> Handler mHandler;<br> <br>        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span><span class="hljs-params">()</span> &#123;<br>            Looper.prepare();<br>            mHandler = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Handler</span>() &#123;<br>                <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">handleMessage</span><span class="hljs-params">(<span class="hljs-meta">@NonNull</span> Message msg)</span> &#123;<br><span class="hljs-comment">//å¤„ç†æ¥æ”¶çš„æ¶ˆæ¯</span><br>                &#125;<br>            &#125;;<br>            Looper.loop();<br>        &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>å¥½ï¼Œåˆ°äº†è¿™é‡Œï¼Œæˆ‘ä»¬åº”è¯¥å¯¹<strong>åˆ›å»ºHandlerå®ä¾‹çš„æ—¶å€™,ä¸€å®šè¦å…ˆåˆ›å»ºä¸€ä¸ªLopperï¼Œå¹¶å¼€å¯å¾ªç¯è¯»å–æ¶ˆæ¯</strong>ï¼Œæœ‰äº†æ·±åˆ»çš„ç†è§£ï¼Œæˆ‘ä»¬ç»§ç»­åˆ†ææºç </p><p>ä¸Šé¢è¯´äº†åˆ›å»ºHandlerå®ä¾‹ä¹‹å‰è¦å…ˆåˆ›å»ºLooperå¹¶å¼€å¯å¾ªç¯ï¼Œé‚£æˆ‘ä»¬åˆ†æä¸‹åˆ›å»ºLopperå¹¶å¼€å¯å¾ªç¯è¿™ä¸ªè¿‡ç¨‹ï¼Œå…ˆçœ‹ä¸‹ActivityThreadé‡Œçš„<code>main</code>æ–¹æ³•é‡Œè°ƒç”¨çš„Looper.prepareMainLooper()</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">prepareMainLooper</span><span class="hljs-params">()</span> &#123;<br>  <span class="hljs-comment">//åˆ›å»ºLooper,å‚æ•°falseè¡¨ç¤ºè¯¥Looperä¸èƒ½é€€å‡º</span><br>    prepare(<span class="hljs-literal">false</span>);<br>  <span class="hljs-comment">//æ·»åŠ åŒæ­¥é”</span><br>    <span class="hljs-keyword">synchronized</span> (Looper.class) &#123;<br>      <span class="hljs-comment">//å¦‚æœå½“å‰sMainLooperå·²ç»å­˜åœ¨,åˆ™æŠ›å¼‚å¸¸</span><br>        <span class="hljs-keyword">if</span> (sMainLooper != <span class="hljs-literal">null</span>) &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalStateException</span>(<span class="hljs-string">&quot;The main Looper has already been prepared.&quot;</span>);<br>        &#125;<br>      <span class="hljs-comment">//å°†å½“å‰çº¿ç¨‹çš„Looperå®ä¾‹èµ‹å€¼ç»™sMainLooper</span><br>        sMainLooper = myLooper();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>å®é™…ä¸Šä¸»è¦æ˜¯è°ƒç”¨äº†å¦å¤–ä¸¤ä¸ªæ–¹æ³•ï¼Œæˆ‘ä»¬åœ¨çœ‹ä¸‹prepare(false)å’ŒmyLooper()æ–¹æ³•çš„å†…éƒ¨å®ç°</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">prepare</span><span class="hljs-params">(<span class="hljs-type">boolean</span> quitAllowed)</span> &#123;<br>   <span class="hljs-comment">//é€šè¿‡sThreadLocalè·å–å½“å‰Looperå®ä¾‹,å¦‚æœå½“å‰Lopperå®ä¾‹ä¸ä¸ºç©ºåˆ™æŠ›å‡ºå¼‚å¸¸</span><br>     <span class="hljs-keyword">if</span> (sThreadLocal.get() != <span class="hljs-literal">null</span>) &#123;<br>         <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">&quot;Only one Looper may be created per thread&quot;</span>);<br>     &#125;<br>   <span class="hljs-comment">//å°†newå‡ºæ¥çš„Looperå®ä¾‹è®¾ç½®ç»™sThreadLocal</span><br>     sThreadLocal.set(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Looper</span>(quitAllowed));<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-meta">@Nullable</span> Looper <span class="hljs-title function_">myLooper</span><span class="hljs-params">()</span> &#123;<br>   <span class="hljs-comment">//é€šè¿‡sThreadLocalè·å–Looperå®ä¾‹å¯¹è±¡</span><br>     <span class="hljs-keyword">return</span> sThreadLocal.get();<br>&#125;<br></code></pre></td></tr></table></figure><p><code>prepare</code>æ–¹æ³•: newä¸€ä¸ªLooperè®¾ç½®ç»™sThreadLocal. <code>myLooper</code>æ–¹æ³•: é€šè¿‡sThreadLocalè·å–Looper. ä¸Šé¢ä¸¤ä¸ªæ–¹æ³•ï¼Œå¤§å®¶æ˜¯ä¸æ˜¯ä¼šå¯¹è¿™ä¸ªsThreadLocalå¾ˆå¥½å¥‡ï¼Œè¿™ä¸ªä¸œè¥¿æœ‰å•¥ä½œç”¨ï¼Œæˆ‘ä»¬æ ¹æ®ä¸Šé¢ä¸¤ä¸ªæ–¹æ³•å¯ä»¥æ¨æ–­å‡º: sThreadLocalæ˜¯ç”¨æ¥å­˜æ”¾Looperçš„</p><h3 id="ThreadLocalä»‹ç»"><a href="#ThreadLocalä»‹ç»" class="headerlink" title="ThreadLocalä»‹ç»"></a>ThreadLocalä»‹ç»</h3><p><strong>ThreadLocalæ˜¯Javaä¸­ä¸€ä¸ªç”¨äºçº¿ç¨‹å†…éƒ¨å­˜å‚¨æ•°æ®çš„å·¥å…·ç±»</strong></p><p>çœ‹ä¸‹é¢è¿™ä¸€æ®µä»£ç </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs java"> <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>     ThreadLocal&lt;Boolean&gt; threadLocal = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ThreadLocal</span>&lt;&gt;();<br>     threadLocal.set(<span class="hljs-literal">true</span>);<br>     <span class="hljs-type">Boolean</span> <span class="hljs-variable">aBoolean</span> <span class="hljs-operator">=</span> threadLocal.get();<br>     System.out.println(<span class="hljs-string">&quot;Current Thread &quot;</span> + Thread.currentThread().getName() + <span class="hljs-string">&quot;: &quot;</span> + aBoolean);<br> <span class="hljs-comment">//åˆ›å»ºä¸€ä¸ªæ–°çš„çº¿ç¨‹å‘½åä¸ºa</span><br>     <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(<span class="hljs-string">&quot;a&quot;</span>)&#123;<br>         <span class="hljs-meta">@Override</span><br>          <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span><span class="hljs-params">()</span> &#123;<br>              threadLocal.set(<span class="hljs-literal">false</span>);<br>              <span class="hljs-type">Boolean</span> <span class="hljs-variable">bBoolean</span> <span class="hljs-operator">=</span> threadLocal.get();<br>              System.out.println(<span class="hljs-string">&quot;Current Thread &quot;</span> + Thread.currentThread().getName() + <span class="hljs-string">&quot;: &quot;</span> + bBoolean);<br>          &#125;<br>     &#125;.start();<br> <span class="hljs-comment">//åˆ›å»ºä¸€ä¸ªæ–°çš„çº¿ç¨‹å‘½åä¸ºb</span><br>     <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(<span class="hljs-string">&quot;b&quot;</span>)&#123;<br>         <span class="hljs-meta">@Override</span><br>         <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span><span class="hljs-params">()</span> &#123; ;<br>             <span class="hljs-type">Boolean</span> <span class="hljs-variable">cBoolean</span> <span class="hljs-operator">=</span> threadLocal.get();<br>             System.out.println(<span class="hljs-string">&quot;Current Thread &quot;</span> + Thread.currentThread().getName() + <span class="hljs-string">&quot;: &quot;</span> + cBoolean);<br>         &#125;<br>     &#125;.start();<br> &#125;<br><br><span class="hljs-comment">//æ‰“å°ç»“æœ:</span><br>Current Thread main: <span class="hljs-literal">true</span><br>Current Thread a: <span class="hljs-literal">false</span><br>Current Thread b: <span class="hljs-literal">null</span><br></code></pre></td></tr></table></figure><p>ä¸Šé¢è¿™æ®µä»£ç : </p><ol><li>åœ¨ä¸»çº¿ç¨‹åˆ›å»ºäº†ä¸€ä¸ªthreadLocalå˜é‡ï¼Œå¹¶è°ƒç”¨<code>set</code>æ–¹æ³•è®¾ç½®ä¸ºtrueï¼Œç„¶åè·å–è¯¥å€¼å¹¶æ‰“å°</li><li>åˆ›å»ºä¸€ä¸ªæ–°çš„çº¿ç¨‹ï¼Œå¹¶è°ƒç”¨<code>set</code>æ–¹æ³•è®¾ç½®å€¼ä¸ºfalseï¼Œè·å–è·å–è¯¥å€¼å¹¶æ‰“å°</li><li>åˆ›å»ºä¸€ä¸ªæ–°çš„çº¿ç¨‹ï¼Œè·å–è¯¥å€¼å¹¶æ‰“å°</li></ol><p>ä»ä¸Šé¢çš„æ—¥å¿—å¯ä»¥çœ‹å‡ºï¼Œè™½ç„¶åœ¨ä¸åŒçš„çº¿ç¨‹ä¸­è®¿é—®åŒä¸€ä¸ªthreadLocalå¯¹è±¡ï¼Œä½†æ˜¯å®ƒä»¬é€šè¿‡ThreadLocalè·å–çš„å€¼å´æ˜¯ä¸ä¸€æ ·çš„ï¼Œè¿™å°±æ˜¯ThreadLocalçš„å¥‡å¦™ä¹‹å¤„ï¼Œè¿™é‡Œæˆ‘åˆæƒ³é—®ä¸€å¥,ä¸ºä»€ä¹ˆ? å‡¡äº‹å¤šé—®å‡ ä¸ªä¸ºä»€ä¹ˆï¼ŒçŸ¥è¯†åŸç†å°±å­¦åˆ°æ‰‹äº†ï¼Œå“ˆå“ˆğŸ˜„ï¼Œæˆ‘ä»¬ç‚¹è¿›å»ThreadLocalçš„<code>set</code>æ–¹æ³•çœ‹ä¸€ä¸‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">set</span><span class="hljs-params">(T value)</span> &#123;<br>  <span class="hljs-comment">//è·å–å½“å‰çº¿ç¨‹</span><br>    <span class="hljs-type">Thread</span> <span class="hljs-variable">t</span> <span class="hljs-operator">=</span> Thread.currentThread();<br>  <span class="hljs-comment">//è·å–å½“å‰çº¿ç¨‹çš„ThreadLocalMap</span><br>    <span class="hljs-type">ThreadLocalMap</span> <span class="hljs-variable">map</span> <span class="hljs-operator">=</span> getMap(t);<br>    <span class="hljs-keyword">if</span> (map != <span class="hljs-literal">null</span>)<br>      <span class="hljs-comment">//å¦‚æœmapä¸ä¸ºç©º,åˆ™å°†å½“å‰çš„ThreadLocalå˜é‡ä½œä¸ºkey,ä¼ è¿›æ¥çš„æ³›å‹ä½œä¸ºvalueè¿›è¡Œå­˜å‚¨</span><br>        map.set(<span class="hljs-built_in">this</span>, value);<br>    <span class="hljs-keyword">else</span><br>      <span class="hljs-comment">//å¦‚æœmapä¸ºç©º,åˆ™ä¼šåˆ›å»ºmap,å°†å½“å‰çš„ThreadLocalå˜é‡ä½œä¸ºkey,ä¼ è¿›æ¥çš„æ³›å‹ä½œä¸ºvalueè¿›è¡Œå­˜å‚¨</span><br>        createMap(t, value);<br>&#125;<br></code></pre></td></tr></table></figure><p>é€šè¿‡ä¸Šé¢ä»£ç æˆ‘ä»¬çŸ¥é“ï¼Œé€šè¿‡è·å–å½“å‰çº¿ç¨‹çš„ThreadLocalMapï¼Œåœ¨æŠŠThreadLocalå˜é‡ä½œä¸ºkeyï¼Œä¼ è¿›æ¥çš„æ³›å‹ä½œä¸ºvalueè¿›è¡Œå­˜å‚¨</p><p><strong>ThreadLocalMap</strong>å®ƒæ˜¯ThreadLocalé‡Œé¢çš„ä¸€ä¸ªé™æ€å†…éƒ¨ç±»ï¼Œå®ƒç±»ä¼¼äºä¸€ä¸ªæ”¹ç‰ˆçš„HashMapï¼Œå†…éƒ¨ä¹Ÿæ˜¯ä½¿ç”¨æ•°ç»„å’ŒHashç®—æ³•æ¥å­˜å‚¨æ•°æ®ï¼Œä½¿å¾—å­˜å‚¨å’Œè¯»å–çš„é€Ÿåº¦éå¸¸å¿«ï¼Œå› æ­¤è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨HashMapçš„æ€æƒ³å»ç†è§£ThreadLocalMapå°±å¥½äº†ï¼Œå¦‚æœå¯¹ThreadLocalMapå·¥ä½œåŸç†æ„Ÿå…´è¶£çš„ï¼Œå¯ä»¥é˜…è¯»è¿™ç¯‡æ–‡ç« <a href="https://juejin.cn/post/6844904141890781192">ä¼ é€é—¨</a></p><p>åœ¨çœ‹ä¸‹<code>get</code>æ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> T <span class="hljs-title function_">get</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-type">Thread</span> <span class="hljs-variable">t</span> <span class="hljs-operator">=</span> Thread.currentThread();<br>    <span class="hljs-type">ThreadLocalMap</span> <span class="hljs-variable">map</span> <span class="hljs-operator">=</span> getMap(t);<br>    <span class="hljs-keyword">if</span> (map != <span class="hljs-literal">null</span>) &#123;<br>        ThreadLocalMap.<span class="hljs-type">Entry</span> <span class="hljs-variable">e</span> <span class="hljs-operator">=</span> map.getEntry(<span class="hljs-built_in">this</span>);<br>        <span class="hljs-keyword">if</span> (e != <span class="hljs-literal">null</span>) &#123;<br>            <span class="hljs-meta">@SuppressWarnings(&quot;unchecked&quot;)</span><br>            <span class="hljs-type">T</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> (T)e.value;<br>            <span class="hljs-keyword">return</span> result;<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">return</span> setInitialValue();<br>&#125;<br></code></pre></td></tr></table></figure><p>è·å–å½“å‰çº¿ç¨‹çš„ThreadLocalMapï¼Œå‰é¢è®²åˆ°ThreadLocalMapå…¶å®éå¸¸åƒä¸€ä¸ªHashMapï¼Œä»–çš„getæ–¹æ³•ä¹Ÿæ˜¯ä¸€æ ·çš„ï¼Œä½¿ç”¨ThreadLocalä½œä¸ºkeyè·å–åˆ°å¯¹åº”çš„Entryï¼Œå†æŠŠvalueè¿”å›å³å¯ï¼Œå¦‚æœmapå°šæœªåˆå§‹åŒ–åˆ™ä¼šæ‰§è¡Œåˆå§‹åŒ–æ“ä½œ</p><p>å› æ­¤æˆ‘ä»¬æ˜¯å¦å¯ä»¥å¾—åˆ°ç»“è®º:</p><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/88a4d99892f746b988d2f88a1e44a2f9~tplv-k3u1fbpfcp-zoom-1.image" alt="image-20210201082013061"></p><p>ThreadLocalä¼šä»å„è‡ªçš„çº¿ç¨‹ï¼Œå–å‡ºè‡ªå·±ç»´æŠ¤çš„ThreadLocalMapï¼Œå…¶keyä¸ºThreadLocalï¼Œvalueä¸ºThreadLocalå¯¹åº”çš„æ³›å‹å¯¹è±¡ï¼Œè¿™æ ·æ¯ä¸ªThreadLocalå°±å¯ä»¥æŠŠè‡ªå·±ä½œä¸ºkeyæŠŠä¸åŒçš„valueå­˜å‚¨åœ¨ä¸åŒçš„ThreadLocalMapï¼Œå½“è·å–æ•°æ®çš„æ—¶å€™ï¼ŒåŒä¸ªThreadLocalå°±å¯ä»¥ä»ä¸åŒçº¿ç¨‹çš„ThreadLocalMapä¸­å¾—åˆ°ä¸åŒçš„æ•°æ®ã€‚å› æ­¤å½“æˆ‘ä»¬ä»¥çº¿ç¨‹ä½œä¸ºä½œç”¨åŸŸï¼Œå¹¶ä¸”ä¸åŒçº¿ç¨‹éœ€è¦å…·æœ‰ä¸åŒæ•°æ®å‰¯æœ¬çš„æ—¶å€™ï¼Œæˆ‘ä»¬å°±å¯ä»¥è€ƒè™‘ä½¿ç”¨ThreadLocalã€‚è€ŒLooperæ­£å¥½é€‚ç”¨äºè¿™ç§åœºæ™¯</p><h3 id="Looperä»‹ç»"><a href="#Looperä»‹ç»" class="headerlink" title="Looperä»‹ç»"></a>Looperä»‹ç»</h3><p>ä¸Šé¢æˆ‘ä»¬åˆ†æåˆ°Looperä½¿ç”¨ThreadLocalæ¥ä¿è¯æ¯ä¸ªçº¿ç¨‹æœ‰ä¸”åªæœ‰ä¸€ä¸ªç›¸åŒçš„å‰¯æœ¬ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥å¾—å‡ºç»“è®º: <strong>ä¸€ä¸ªçº¿ç¨‹å¯¹åº”ä¸€ä¸ªLooper</strong>ï¼Œè¿™ä¸ªç»“è®ºéå¸¸çš„é‡è¦ï¼ŒHandleræœºåˆ¶ä¹‹æ‰€ä»¥èƒ½å¤Ÿå®ç°çº¿ç¨‹ä¹‹é—´çš„é€šä¿¡ï¼Œå°±æ˜¯å› ä¸ºä½¿ç”¨äº†ä¸åŒçº¿ç¨‹çš„Looperå¤„ç†æ¶ˆæ¯ï¼Œä¸¾ä¸ªä¾‹å­: æˆ‘åœ¨çº¿ç¨‹Aåˆ›å»ºäº†å‡ ä¸ªHanlderå®ä¾‹å¤„ç†æ¶ˆæ¯ï¼Œé‚£æˆ‘é¦–å…ˆå°±è¦åˆ›å»ºAçº¿ç¨‹çš„Looperå¹¶å¼€å¯æ¶ˆæ¯å¾ªç¯ï¼Œé‚£ä¹ˆæˆ‘ä¸ç®¡ä½ è¿™äº›Hanlderçš„å®ä¾‹ä»é‚£ä¸ªçº¿ç¨‹å‘é€æ¶ˆæ¯è¿‡æ¥ï¼Œæœ€ç»ˆéƒ½ä¼šå›åˆ°æˆ‘Açº¿ç¨‹çš„MessageQueueä¸­ï¼Œç„¶åé€šè¿‡Açº¿ç¨‹Looperä¸æ–­è¯»å–æ¶ˆæ¯ï¼Œåœ¨äº¤ç»™å½“å‰Açº¿ç¨‹çš„Handleræ¥å¤„ç†</p><p>Looperå¯ä»¥è¯´æ˜¯Handleræœºåˆ¶ä¸­çš„ä¸€ä¸ªéå¸¸é‡è¦çš„æ ¸å¿ƒã€‚Looperç›¸å½“äºçº¿ç¨‹æ¶ˆæ¯æœºåˆ¶çš„å¼•æ“ï¼Œé©±åŠ¨æ•´ä¸ªæ¶ˆæ¯æœºåˆ¶è¿è¡Œã€‚Looperè´Ÿè´£ä»é˜Ÿåˆ—ä¸­å–å‡ºæ¶ˆæ¯ï¼Œç„¶åäº¤ç»™å¯¹åº”çš„Handlerå»å¤„ç†ã€‚å¦‚æœé˜Ÿåˆ—ä¸­æ²¡æœ‰æ¶ˆæ¯ï¼Œåˆ™MessageQueueçš„nextæ–¹æ³•ä¼šé˜»å¡çº¿ç¨‹ï¼Œç­‰å¾…æ–°çš„æ¶ˆæ¯çš„åˆ°æ¥ã€‚æ¯ä¸ªçº¿ç¨‹æœ‰ä¸”åªèƒ½æœ‰ä¸€ä¸ªâ€œå¼•æ“â€ï¼Œä¹Ÿå°±æ˜¯Looperï¼Œå¦‚æœæ²¡æœ‰Looperï¼Œé‚£ä¹ˆæ¶ˆæ¯æœºåˆ¶å°±è¿è¡Œä¸èµ·æ¥ï¼Œè€Œå¦‚æœæœ‰å¤šä¸ªLooperï¼Œåˆ™ä¼šè¿èƒŒå•çº¿æ“ä½œçš„æ¦‚å¿µï¼Œé€ æˆå¹¶å‘æ“ä½œã€‚</p><h4 id="Looperåˆ›å»º"><a href="#Looperåˆ›å»º" class="headerlink" title="Looperåˆ›å»º"></a>Looperåˆ›å»º</h4><p>åœ¨ä¸Šé¢åˆ›å»ºLooperçš„æ—¶å€™æˆ‘ä»¬åˆ†æåˆ°:</p><ol><li><p>ä¸»çº¿ç¨‹ActivityThreadåˆ›å»ºLooperï¼Œä½¿ç”¨çš„æ˜¯<code>prepareMainLooper</code>æ–¹æ³•ï¼Œå®ƒæ˜¯ä¸ºä¸»çº¿ç¨‹é‡èº«å®šåšçš„ï¼Œç”±äºä¸»çº¿ç¨‹çš„Looperæ¯”è¾ƒç‰¹æ®Šï¼Œæ‰€ä»¥Looperæä¾›äº†ä¸€ä¸ª<code>getMainLooper</code>æ–¹æ³•ï¼Œé€šè¿‡è¿™ä¸ªæ–¹æ³•æˆ‘ä»¬å¯ä»¥åœ¨ä»»ä½•åœ°æ–¹è·å–åˆ°ä¸»çº¿ç¨‹çš„Looperï¼Œä¸”ä¸»çº¿ç¨‹çš„Looperä¸èƒ½é€€å‡º</p></li><li><p>æˆ‘ä»¬è‡ªå·±åˆ›å»ºçš„Looperï¼Œä½¿ç”¨çš„æ˜¯<code>prepare</code>æ–¹æ³•ï¼Œå®è´¨ä¸Šå®ƒä»¬æœ€ç»ˆéƒ½ä¼šè°ƒåˆ°<code>prepare(boolean quitAllowed)</code>è¿™ä¸ªæ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•æ˜¯ç§æœ‰çš„ï¼Œå¤–éƒ¨ä¸èƒ½ç›´æ¥è°ƒç”¨ï¼ŒåŒºåˆ«å°±æ˜¯ä¸»çº¿ç¨‹åˆ›å»ºçš„Looperä¸èƒ½é€€å‡ºï¼Œè€Œæˆ‘ä»¬è‡ªå·±åˆ›å»ºçš„å¯ä»¥é€€å‡º</p></li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//ä¸»çº¿ç¨‹</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">prepareMainLooper</span><span class="hljs-params">()</span> &#123;<br>    prepare(<span class="hljs-literal">false</span>);<br>  <span class="hljs-comment">//...</span><br>&#125;<br><br><span class="hljs-comment">//è·å–ä¸»çº¿ç¨‹Looper</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Looper <span class="hljs-title function_">getMainLooper</span><span class="hljs-params">()</span> &#123;<br>     <span class="hljs-keyword">synchronized</span> (Looper.class) &#123;<br>     <span class="hljs-keyword">return</span> sMainLooper;<br>     &#125;<br> &#125;<br><br><span class="hljs-comment">//æˆ‘ä»¬è‡ªå·±åˆ›å»ºLooper</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">prepare</span><span class="hljs-params">()</span> &#123;<br>    prepare(<span class="hljs-literal">true</span>);<br>&#125;<br><br><span class="hljs-comment">//å‚æ•°quitAllowed true: å¯é€€å‡º false: ä¸å¯é€€å‡º</span><br><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">prepare</span><span class="hljs-params">(<span class="hljs-type">boolean</span> quitAllowed)</span> &#123;<br>     <span class="hljs-keyword">if</span> (sThreadLocal.get() != <span class="hljs-literal">null</span>) &#123;<br>         <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">&quot;Only one Looper may be created per thread&quot;</span>);<br>     &#125;<br>     sThreadLocal.set(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Looper</span>(quitAllowed));<br>&#125;<br></code></pre></td></tr></table></figure><p>åˆ°è¿™é‡Œæˆ‘åˆæœ‰ä¸ªç–‘é—®ï¼Œä¸ºå•¥Looperä¸èƒ½ç›´æ¥åœ¨å¤–éƒ¨ç»™Newå‡ºæ¥å‘¢ï¼Ÿæˆ‘ä»¬ç‚¹å‡»å»Looperçš„æ„é€ æ–¹æ³•çœ‹ä¸€ä¸‹:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> <span class="hljs-title function_">Looper</span><span class="hljs-params">(<span class="hljs-type">boolean</span> quitAllowed)</span> &#123;<br>   <span class="hljs-comment">//åˆ›å»ºä¸€ä¸ªMessageQueue,èµ‹å€¼ç»™å½“å‰Looperçš„mQueue</span><br>     mQueue = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MessageQueue</span>(quitAllowed);<br>   <span class="hljs-comment">//è·å–å½“å‰çº¿ç¨‹èµ‹å€¼ç»™Looperçš„mThread</span><br>     mThread = Thread.currentThread();<br>&#125;<br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬å‘ç°ï¼Œä»–çš„æ„é€ æ–¹æ³•æ˜¯ç§æœ‰çš„ï¼ŒåŸæ¥å¦‚æ­¤ã€‚è€Œä¸”æˆ‘ä»¬è¿˜ä¼šå‘ç°ï¼šLooperçš„å†…éƒ¨ç»´æŠ¤äº†ä¸€ä¸ªMessageQueueï¼Œå½“åˆå§‹åŒ–Looperçš„æ—¶å€™ä¼šé¡ºå¸¦åˆå§‹åŒ–è¿™ä¸ªMessageQueue</p><h4 id="Looperå¼€å¯æ¶ˆæ¯å¾ªç¯"><a href="#Looperå¼€å¯æ¶ˆæ¯å¾ªç¯" class="headerlink" title="Looperå¼€å¯æ¶ˆæ¯å¾ªç¯"></a>Looperå¼€å¯æ¶ˆæ¯å¾ªç¯</h4><p>å½“æˆ‘ä»¬çš„Looperåˆ›å»ºå¥½åï¼Œä»–æ˜¯ä¸ä¼šè‡ªå·±å¯åŠ¨çš„ï¼Œéœ€è¦æˆ‘ä»¬æ‰‹åŠ¨å»å¯åŠ¨Looperï¼Œè°ƒç”¨Looperçš„<code>loop()</code>æ–¹æ³•å³å¯ï¼Œæ‰€ä»¥å‰é¢åˆ›å»ºLooperçš„æ—¶å€™æˆ‘æ€»æ˜¯ä¼šè¯´ï¼Œåˆ›å»ºLooperå¹¶å¼€å¯æ¶ˆæ¯å¾ªç¯ï¼ŒLooperçš„<code>prepare</code>å’Œ<code>loop</code>æ–¹æ³•æ˜¯é…å¥—ä½¿ç”¨çš„ï¼Œä¸¤è€…å¿…é¡»æˆå¯¹å­˜åœ¨ã€‚ç°åœ¨æˆ‘ä»¬æ¥é‡ç‚¹åˆ†æä¸€ä¸‹Looperçš„<code>loop</code>æ–¹æ³•ï¼Œä¸Šæºç :</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">loop</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-comment">// è·å–å½“å‰çº¿ç¨‹çš„Looper</span><br>    <span class="hljs-keyword">final</span> <span class="hljs-type">Looper</span> <span class="hljs-variable">me</span> <span class="hljs-operator">=</span> myLooper();<br>    <span class="hljs-comment">//å½“å‰çº¿ç¨‹çš„Looper,ç›´æ¥æŠ›å¼‚å¸¸</span><br>    <span class="hljs-keyword">if</span> (me == <span class="hljs-literal">null</span>) &#123;<br>        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">&quot;No Looper; Looper.prepare() wasn&#x27;t called on this thread.&quot;</span>);<br>    &#125;<br>  <span class="hljs-comment">//è·å–å½“å‰Looperä¸­çš„MessageQueue</span><br>    <span class="hljs-keyword">final</span> <span class="hljs-type">MessageQueue</span> <span class="hljs-variable">queue</span> <span class="hljs-operator">=</span> me.mQueue;<br>    <span class="hljs-comment">//...</span><br>  <span class="hljs-comment">//å¼€å¯æ­»å¾ªç¯è¯»å–æ¶ˆæ¯</span><br>    <span class="hljs-keyword">for</span> (;;) &#123;<br>        <span class="hljs-comment">// è·å–æ¶ˆæ¯é˜Ÿåˆ—ä¸­çš„æ¶ˆæ¯</span><br>        <span class="hljs-type">Message</span> <span class="hljs-variable">msg</span> <span class="hljs-operator">=</span> queue.next(); <span class="hljs-comment">// might block</span><br>        <span class="hljs-keyword">if</span> (msg == <span class="hljs-literal">null</span>) &#123;<br>            <span class="hljs-comment">// è¿”å›nullè¯´æ˜MessageQueueé€€å‡ºäº†</span><br>            <span class="hljs-keyword">return</span>;<br>        &#125;<br>        <span class="hljs-comment">//...</span><br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-comment">// è°ƒç”¨Messageå¯¹åº”çš„Handlerå¤„ç†æ¶ˆæ¯</span><br>            msg.target.dispatchMessage(msg);<br>            <span class="hljs-keyword">if</span> (observer != <span class="hljs-literal">null</span>) &#123;<br>                observer.messageDispatched(token, msg);<br>            &#125;<br>            dispatchEnd = needEndTime ? SystemClock.uptimeMillis() : <span class="hljs-number">0</span>;<br>        &#125;<br>        <span class="hljs-comment">//...</span><br>    <span class="hljs-comment">// å›æ”¶Message</span><br>        msg.recycleUnchecked();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><code>loop</code>æ–¹æ³•å°±æ˜¯Looperè¿™ä¸ªâ€œå¼•æ“â€çš„æ ¸å¿ƒæ‰€åœ¨ï¼Œä»–å°±åƒæ˜¯ä¸€ä¸ªå¼€å…³</p><p>åˆ†æä¸‹è¿™æ®µä»£ç ï¼Œé¦–å…ˆè·å–å½“å‰çº¿ç¨‹çš„Looperå¯¹è±¡ï¼Œæ²¡æœ‰åˆ™æŠ›å¼‚å¸¸ï¼Œç„¶åè¿›å…¥ä¸€ä¸ªæ­»å¾ªç¯: ä¸æ–­è°ƒç”¨MessageQueueçš„nextæ–¹æ³•æ¥è·å–æ¶ˆæ¯ï¼Œç„¶åè°ƒç”¨messageçš„ç›®æ ‡handlerçš„<code>dispatchMessage</code>æ–¹æ³•æ¥å¤„ç†Messageã€‚</p><h4 id="Looperé€€å‡º"><a href="#Looperé€€å‡º" class="headerlink" title="Looperé€€å‡º"></a>Looperé€€å‡º</h4><p>Looperæä¾›äº†<code>quit</code>å’Œ<code>quitSafely</code>æ–¹æ³•æ¥é€€å‡ºä¸€ä¸ªLooperï¼ŒäºŒè€…çš„åŒºåˆ«æ˜¯ï¼š quitä¼šç›´æ¥é€€å‡ºLooperï¼Œè€ŒquitSafelyåªæ˜¯è®¾å®šä¸€ä¸ªæ ‡è®°ï¼Œç„¶åæŠŠæ¶ˆæ¯é˜Ÿåˆ—ä¸­çš„å·²æœ‰æ¶ˆæ¯å¤„ç†å®Œæ¯•åæ‰å®‰å…¨é€€å‡º.åœ¨æˆ‘ä»¬æ‰‹åŠ¨åˆ›å»ºLooperçš„æƒ…å†µä¸‹ï¼Œå¦‚æœæ‰€æœ‰çš„æ¶ˆæ¯éƒ½è¢«å¤„ç†å®Œæˆåï¼Œæˆ‘ä»¬åº”è¯¥è°ƒç”¨<code>quit</code>æ–¹æ³•æ¥ç»ˆæ­¢æ¶ˆæ¯å¾ªç¯ï¼Œå¦åˆ™å­çº¿ç¨‹å°±ä¼šä¸€ç›´å¤„äºç­‰å¾…çŠ¶æ€ï¼Œè€Œå¦‚æœé€€å‡ºLooperï¼Œè¿™ä¸ªçº¿ç¨‹å°±ä¼šç«‹åˆ»ç»ˆæ­¢ï¼Œå› æ­¤å»ºè®®ä¸éœ€è¦çš„æ—¶å€™ç»ˆæ­¢Looperã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">quit</span><span class="hljs-params">()</span> &#123;<br>    mQueue.quit(<span class="hljs-literal">false</span>);<br>&#125;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">quitSafely</span><span class="hljs-params">()</span> &#123;<br>    mQueue.quit(<span class="hljs-literal">true</span>);<br>&#125;<br><br><span class="hljs-comment">// æœ€ç»ˆéƒ½æ˜¯è°ƒç”¨åˆ°äº†è¿™ä¸ªæ–¹æ³•</span><br><span class="hljs-keyword">void</span> <span class="hljs-title function_">quit</span><span class="hljs-params">(<span class="hljs-type">boolean</span> safe)</span> &#123;<br>    <span class="hljs-comment">// å¦‚æœä¸èƒ½é€€å‡ºåˆ™æŠ›å‡ºå¼‚å¸¸ã€‚è¿™ä¸ªå€¼åœ¨åˆå§‹åŒ–Looperçš„æ—¶å€™è¢«èµ‹å€¼</span><br>    <span class="hljs-keyword">if</span> (!mQuitAllowed) &#123;<br>        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalStateException</span>(<span class="hljs-string">&quot;Main thread not allowed to quit.&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-keyword">synchronized</span> (<span class="hljs-built_in">this</span>) &#123;<br>        <span class="hljs-comment">// é€€å‡ºä¸€æ¬¡ä¹‹åå°±æ— æ³•å†æ¬¡è¿è¡Œäº†</span><br>        <span class="hljs-keyword">if</span> (mQuitting) &#123;<br>            <span class="hljs-keyword">return</span>;<br>        &#125;<br>        mQuitting = <span class="hljs-literal">true</span>;<br>        <span class="hljs-comment">// æ‰§è¡Œä¸åŒçš„æ–¹æ³•</span><br>        <span class="hljs-keyword">if</span> (safe) &#123;<br>            removeAllFutureMessagesLocked();<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            removeAllMessagesLocked();<br>        &#125;<br>        <span class="hljs-comment">// å”¤é†’MessageQueue</span><br>        nativeWake(mPtr);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><code>quit</code>å’Œ<code>quitSafely</code>æ–¹æ³•æœ€ç»ˆéƒ½è°ƒç”¨äº†<code>quit(boolean safe)</code>è¿™ä¸ªæ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•å…ˆåˆ¤æ–­æ˜¯å¦èƒ½é€€å‡ºï¼Œç„¶åå†æ‰§è¡Œé€€å‡ºé€»è¾‘ã€‚å¦‚æœmQuitting&#x3D;&#x3D;trueï¼Œé‚£ä¹ˆè¿™é‡Œä¼šç›´æ¥returnæ‰ï¼Œæˆ‘ä»¬ä¼šå‘ç°mQuittingè¿™ä¸ªå˜é‡åªæœ‰åœ¨è¿™é‡Œè¢«æ‰§è¡Œäº†èµ‹å€¼ï¼Œæ‰€ä»¥ä¸€æ—¦looperé€€å‡ºï¼Œåˆ™æ— æ³•å†æ¬¡è¿è¡Œäº†ã€‚ä¹‹åæ‰§è¡Œä¸åŒçš„é€€å‡ºé€»è¾‘,ç„¶åå”¤é†’MessageQueue,ä¹‹åMessageQueueçš„nextæ–¹æ³•ä¼šé€€å‡ºï¼ŒLooperçš„loopæ–¹æ³•ä¹Ÿä¼šè·Ÿç€é€€å‡ºï¼Œé‚£ä¹ˆçº¿ç¨‹ä¹Ÿå°±åœæ­¢äº†ã€‚</p><h4 id="Looperæ€»ç»“"><a href="#Looperæ€»ç»“" class="headerlink" title="Looperæ€»ç»“"></a>Looperæ€»ç»“</h4><p>Looperä½œä¸ºHandleræ¶ˆæ¯æœºåˆ¶çš„â€œåŠ¨åŠ›å¼•æ“â€ï¼Œä¸æ–­ä»MessageQueueä¸­è·å–æ¶ˆæ¯ï¼Œç„¶åäº¤ç»™Handlerå»å¤„ç†ã€‚Looperçš„ä½¿ç”¨å‰éœ€è¦å…ˆåˆå§‹åŒ–å½“å‰çº¿ç¨‹çš„Looperå¯¹è±¡ï¼Œå†è°ƒç”¨loopæ–¹æ³•æ¥å¯åŠ¨å®ƒã€‚</p><p>åŒæ—¶Handlerä¹Ÿæ˜¯å®ç°åˆ‡æ¢çš„æ ¸å¿ƒï¼Œå› ä¸ºä¸åŒçš„Looperè¿è¡Œåœ¨ä¸åŒçš„çº¿ç¨‹ï¼Œä»–æ‰€è°ƒç”¨çš„dispatchMessageæ–¹æ³•åˆ™è¿è¡Œåœ¨ä¸åŒçš„çº¿ç¨‹ï¼Œæ‰€ä»¥Messageçš„å¤„ç†å°±è¢«åˆ‡æ¢åˆ°Looperæ‰€åœ¨çš„çº¿ç¨‹äº†ã€‚å½“looperä¸å†ä½¿ç”¨æ—¶ï¼Œå¯è°ƒç”¨ä¸åŒçš„é€€å‡ºæ–¹æ³•æ¥é€€å‡ºä»–ï¼Œæ³¨æ„Looperä¸€æ—¦é€€å‡ºï¼Œçº¿ç¨‹åˆ™ä¼šç›´æ¥ç»“æŸã€‚</p><h3 id="Handlerå‘é€æ¶ˆæ¯"><a href="#Handlerå‘é€æ¶ˆæ¯" class="headerlink" title="Handlerå‘é€æ¶ˆæ¯"></a>Handlerå‘é€æ¶ˆæ¯</h3><p>Handlerå’ŒLooperéƒ½åˆ›å»ºå¥½äº†ï¼Œé‚£ä¹ˆæ¥ä¸‹æ¥æˆ‘ä»¬å°±è¦ä½¿ç”¨Handlerå»å‘é€æ¶ˆæ¯ï¼Œæˆ‘ä»¬åœ¨æœ€å¼€å§‹ä»‹ç»Handlerä½¿ç”¨çš„æ—¶å€™ï¼Œå†™äº†å‘é€çš„ä¸¤ç§æ¶ˆæ¯ç±»å‹ï¼Œå¦‚ä¸‹:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//åœ¨é€‚å½“çš„æ—¶æœºä½¿ç”¨Handlerå®ä¾‹å‘é€æ¶ˆæ¯</span><br>mHandler.sendMessage(message);<br>mHandler.post(runnable);<span class="hljs-comment">//Runnableä¼šè¢«å°è£…è¿›ä¸€ä¸ªMessage,æ‰€ä»¥å®ƒæœ¬è´¨ä¸Šè¿˜æ˜¯ä¸€ä¸ªMessage</span><br></code></pre></td></tr></table></figure><p>ä½¿ç”¨Handlerå‘é€æ¶ˆæ¯ï¼Œå®ƒæœ‰<code>send</code> æˆ–è€… <code>post</code>ç­‰ä¸€ç³»åˆ—æ–¹æ³•ï¼Œæœ€ç»ˆè¿™äº›å‘é€çš„æ–¹æ³•ä¼šè°ƒç”¨åˆ°Handlerä¸­çš„enqueueMessage()æ–¹æ³•ï¼Œè€ŒHandlerä¸­çš„<code>enqueueMessage</code>æ–¹æ³•æœ€ç»ˆä¼šè°ƒç”¨åˆ°MessageQueueçš„<code>enqueueMessage</code>æ–¹æ³•ï¼Œæˆ‘ä»¬é€šè¿‡ä¸€ä¸ªå‘é€æ¶ˆæ¯æ–¹æ³•çš„æºç çœ‹ä¸‹ï¼Œä»¥æˆ‘ä»¬æœ€å¸¸ç”¨çš„sendMessage()è¿™ä¸ªæ–¹æ³•ä¸ºä¾‹ï¼š</p><p><strong>æ³¨æ„</strong>ï¼š<code>post</code>ç³»åˆ—æ–¹æ³•ï¼Œå‘é€çš„æ˜¯ä¸€ä¸ªRunnableï¼ŒRunnableä¼šè¢«å°è£…è¿›ä¸€ä¸ªMessageï¼Œæ‰€ä»¥å®ƒæœ¬è´¨ä¸Šè¿˜æ˜¯ä¸€ä¸ªMessage</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//1</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">sendMessage</span><span class="hljs-params">(<span class="hljs-meta">@NonNull</span> Message msg)</span> &#123;<br>    <span class="hljs-keyword">return</span> sendMessageDelayed(msg, <span class="hljs-number">0</span>);<br>&#125;<br><br><span class="hljs-comment">//2</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">sendMessageDelayed</span><span class="hljs-params">(<span class="hljs-meta">@NonNull</span> Message msg, <span class="hljs-type">long</span> delayMillis)</span> &#123;<br>    <span class="hljs-keyword">if</span> (delayMillis &lt; <span class="hljs-number">0</span>) &#123;<br>      delayMillis = <span class="hljs-number">0</span>;<br>    &#125;<br>   <span class="hljs-keyword">return</span> sendMessageAtTime(msg, SystemClock.uptimeMillis() + delayMillis);<br>&#125;<br><br><span class="hljs-comment">//3</span><br><span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">sendMessageAtTime</span><span class="hljs-params">(<span class="hljs-meta">@NonNull</span> Message msg, <span class="hljs-type">long</span> uptimeMillis)</span> &#123;<br>    <span class="hljs-type">MessageQueue</span> <span class="hljs-variable">queue</span> <span class="hljs-operator">=</span> mQueue;<br>    <span class="hljs-keyword">if</span> (queue == <span class="hljs-literal">null</span>) &#123;<br>        <span class="hljs-type">RuntimeException</span> <span class="hljs-variable">e</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<br>        <span class="hljs-built_in">this</span> + <span class="hljs-string">&quot; sendMessageAtTime() called with no mQueue&quot;</span>);<br>        Log.w(<span class="hljs-string">&quot;Looper&quot;</span>, e.getMessage(), e);<br>       <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>    &#125;<br>    <span class="hljs-keyword">return</span> enqueueMessage(queue, msg, uptimeMillis);<br>&#125;<br><br><span class="hljs-comment">//4</span><br><span class="hljs-keyword">private</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">enqueueMessage</span><span class="hljs-params">(<span class="hljs-meta">@NonNull</span> MessageQueue queue, <span class="hljs-meta">@NonNull</span> Message msg,<span class="hljs-type">long</span> uptimeMillis)</span> &#123;<br>     <span class="hljs-comment">//å°†å½“å‰çš„Handlerèµ‹å€¼ç»™Messageçš„targetå±æ€§</span><br>   msg.target = <span class="hljs-built_in">this</span>;<br>     msg.workSourceUid = ThreadLocalWorkSource.getUid();<br><br>     <span class="hljs-keyword">if</span> (mAsynchronous) &#123;<br>         msg.setAsynchronous(<span class="hljs-literal">true</span>);<br>     &#125;<br>     <span class="hljs-keyword">return</span> queue.enqueueMessage(msg, uptimeMillis);<br>&#125;<br></code></pre></td></tr></table></figure><p>ä»¥ä¸Šä»£ç çš„è°ƒç”¨é¡ºåºå°±æ˜¯1-&gt;2-&gt;3-&gt;4</p><p>è¿™é‡Œæˆ‘ç»™ä¸€å¼ å›¾æ¥æ€»ç»“ä¸€ä¸‹ï¼Œ<code>send</code> æˆ–è€… <code>post</code>ç­‰ä¸€ç³»åˆ—æ–¹æ³•çš„è°ƒç”¨åŠæœ€ç»ˆçš„èµ°å‘ï¼š</p><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/72362e6cb08043fa8094f459fbd6291e~tplv-k3u1fbpfcp-zoom-1.image" alt="image-20210131222442908"></p><h3 id="MessageQueue-enqueueMessageæ–¹æ³•ä»‹ç»"><a href="#MessageQueue-enqueueMessageæ–¹æ³•ä»‹ç»" class="headerlink" title="MessageQueue enqueueMessageæ–¹æ³•ä»‹ç»"></a>MessageQueue enqueueMessageæ–¹æ³•ä»‹ç»</h3><p>åˆ°äº†è¿™é‡Œï¼Œæˆ‘ä»¬å°±æ¥é‡ç‚¹åˆ†æä¸€ä¸‹MessageQueueçš„enqueueMessage()æ–¹æ³•ï¼ŒenqueueMessageä¸­æ–‡æ„æ€æ˜¯å…¥é˜Ÿæ¶ˆæ¯ï¼Œè§åçŸ¥æ„ï¼Œè¿™ä¸ªæ–¹æ³•å°±æ˜¯æŠŠHandlerå‘é€çš„æ¶ˆæ¯ï¼Œæ”¾åˆ°æ¶ˆæ¯é˜Ÿåˆ—ä¸­</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">boolean</span> <span class="hljs-title function_">enqueueMessage</span><span class="hljs-params">(Message msg, <span class="hljs-type">long</span> when)</span> &#123;<br>    <span class="hljs-comment">// Hanlderä¸ºç©ºåˆ™æŠ›å¼‚å¸¸</span><br>    <span class="hljs-keyword">if</span> (msg.target == <span class="hljs-literal">null</span>) &#123;<br>        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalArgumentException</span>(<span class="hljs-string">&quot;Message must have a target.&quot;</span>);<br>    &#125;<br>  <span class="hljs-comment">//å½“å‰æ¶ˆæ¯å¦‚æœå·²ç»å·²ç»è¢«æ‰§è¡Œåˆ™æŠ›å¼‚å¸¸</span><br>    <span class="hljs-keyword">if</span> (msg.isInUse()) &#123;<br>        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalStateException</span>(msg + <span class="hljs-string">&quot; This message is already in use.&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-comment">// å¯¹MessageQueueè¿›è¡ŒåŠ é”</span><br>    <span class="hljs-keyword">synchronized</span> (<span class="hljs-built_in">this</span>) &#123;<br>        <span class="hljs-comment">// åˆ¤æ–­ç›®æ ‡threadæ˜¯å¦å·²ç»æ­»äº¡</span><br>        <span class="hljs-keyword">if</span> (mQuitting) &#123;<br>            <span class="hljs-type">IllegalStateException</span> <span class="hljs-variable">e</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalStateException</span>(<br>                    msg.target + <span class="hljs-string">&quot; sending message to a Handler on a dead thread&quot;</span>);<br>            Log.w(TAG, e.getMessage(), e);<br>            msg.recycle();<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>        &#125;<br>        <span class="hljs-comment">// æ ‡è®°Messageæ­£åœ¨è¢«æ‰§è¡Œï¼Œä»¥åŠéœ€è¦è¢«æ‰§è¡Œçš„æ—¶é—´</span><br>        <span class="hljs-comment">//è¿™é‡Œçš„whençš„å€¼éœ€è¦åˆ†æƒ…å†µ:1,å¯èƒ½ä¸º0 2, å¦‚æœä¸ä¸º0ï¼Œåˆ™æ˜¯ç³»ç»Ÿå¼€æœºåˆ°ç°åœ¨çš„ä¸€ä¸ªæ¯«ç§’æ•° + å»¶è¿Ÿæ‰§è¡Œçš„æ—¶é—´</span><br>        <span class="hljs-comment">//è¿™ä¸¤ç§æƒ…å†µä¸»è¦çœ‹ä½ è°ƒç”¨çš„æ˜¯Handlerå“ªä¸ªå‘é€Messageçš„æ–¹æ³•</span><br>        msg.markInUse();<br>        msg.when = when;<br>        <span class="hljs-comment">// pæ˜¯MessageQueueçš„é“¾è¡¨å¤´</span><br>        <span class="hljs-type">Message</span> <span class="hljs-variable">p</span> <span class="hljs-operator">=</span> mMessages;<br>      <span class="hljs-comment">// åˆ¤æ–­æ˜¯å¦éœ€è¦å”¤é†’MessageQueue</span><br>        <span class="hljs-type">boolean</span> needWake;<br>        <span class="hljs-comment">// å¦‚æœæœ‰æ–°çš„é˜Ÿå¤´ï¼ŒåŒæ—¶MessageQueueå¤„äºé˜»å¡çŠ¶æ€åˆ™éœ€è¦å”¤é†’é˜Ÿåˆ—</span><br>        <span class="hljs-keyword">if</span> (p == <span class="hljs-literal">null</span> || when == <span class="hljs-number">0</span> || when &lt; p.when) &#123;<br>            msg.next = p;<br>            mMessages = msg;<br>            needWake = mBlocked;<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-comment">//...</span><br>            <span class="hljs-comment">// æ ¹æ®æ—¶é—´æ‰¾åˆ°æ’å…¥çš„ä½ç½®</span><br>            Message prev;<br>            <span class="hljs-keyword">for</span> (;;) &#123;<br>                prev = p;<br>                p = p.next;<br>                <span class="hljs-keyword">if</span> (p == <span class="hljs-literal">null</span> || when &lt; p.when) &#123;<br>                    <span class="hljs-keyword">break</span>;<br>                &#125;<br>                <span class="hljs-comment">//...</span><br>            &#125;<br>            msg.next = p; <br>            prev.next = msg;<br>        &#125;<br><br>        <span class="hljs-comment">// å¦‚æœéœ€è¦åˆ™å”¤é†’é˜Ÿåˆ—</span><br>        <span class="hljs-keyword">if</span> (needWake) &#123;<br>            nativeWake(mPtr);<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>&#125;<br><br></code></pre></td></tr></table></figure><p>ä¸Šè¿°ä»£ç æˆ‘ä»¬æ¥æ€»ç»“ä¸€ä¸‹:</p><ol><li><p>é¦–å…ˆåˆ¤æ–­Messageä¸­çš„Handlerä¸èƒ½ä¸ç©ºï¼Œä¸”ä¸èƒ½ä¸ºåœ¨ä½¿ç”¨ä¸­ï¼Œå¦åˆ™æŠ›å¼‚å¸¸</p></li><li><p>å¯¹MessageQueueè¿›è¡ŒåŠ é”ï¼Œåˆ¤æ–­å½“å‰çº¿ç¨‹æ˜¯å¦deadï¼Œå¦‚æœdeadåˆ™æ‰“å°ä¸€ä¸ªå¼‚å¸¸ï¼Œå¹¶è¿”å›false</p></li><li><p>åˆå§‹åŒ–Messageçš„æ‰§è¡Œæ—¶é—´ä»¥å¹¶ä¸”æ ‡è®°ä¸ºæ­£åœ¨æ‰§è¡Œä¸­</p></li><li><p>å½“æ–°æ’å…¥çš„Messageåœ¨é“¾è¡¨å¤´æ—¶ï¼Œå¦‚æœmessageQueueæ˜¯ç©ºçš„æˆ–è€…æ­£åœ¨ç­‰å¾…ä¸‹ä¸ªå»¶è¿Ÿæ¶ˆæ¯ï¼Œåˆ™éœ€è¦å”¤é†’MessageQueue</p></li><li><p>æ ¹æ®Messageçš„æ‰§è¡Œæ—¶é—´ï¼Œæ‰¾åˆ°åœ¨é“¾è¡¨ä¸­çš„æ’å…¥ä½ç½®è¿›è¡Œæ’å…¥ï¼Œè¿™é‡Œæˆ‘ä»¬å¯ä»¥ç†è§£MessageQueueä¸­ç»´æŠ¤äº†ä¸€ä¸ªä¼˜å…ˆçº§é˜Ÿåˆ—,</p><p>ä¼˜å…ˆçº§é˜Ÿåˆ—å°±æ˜¯é“¾è¡¨æ ¹æ®æ—¶é—´è¿›è¡Œæ’åºå¹¶åŠ å…¥é˜Ÿåˆ—çš„æ•°æ®ç»“æ„å½¢æˆçš„ï¼Œä¾‹å¦‚æˆ‘ä»¬å‘é€çš„å‡ ä¸ªæ¶ˆæ¯æºå¸¦çš„æ—¶é—´åˆ†åˆ«ä¸ºï¼š1sï¼Œ20msï¼Œ3sï¼Œé‚£ä¹ˆè¿™ä¸ªæ—¶å€™å°±ä¼šæ ¹æ®æ—¶é—´è¿›è¡Œæ’åºä¸ºï¼š20msï¼Œ1sï¼Œ3sï¼Œ é‚£ä¹ˆå¦‚æœæˆ‘æ–°åŠ å…¥çš„ä¸€ä¸ªæ¶ˆæ¯çš„æ—¶é—´ä¸º2sï¼Œé‚£ä¹ˆä»–å°±ä¼šæ’å…¥1så’Œ3sçš„ä¸­é—´ï¼Œæ­¤æ—¶è¿™ä¸ªä¼˜å…ˆçº§é˜Ÿåˆ—å°±æœ‰äº†4ä¸ªå…ƒç´ ï¼š 20msï¼Œ1sï¼Œ2sï¼Œ3s</p></li></ol><h3 id="MessageQueue-nextæ–¹æ³•ä»‹ç»"><a href="#MessageQueue-nextæ–¹æ³•ä»‹ç»" class="headerlink" title="MessageQueue nextæ–¹æ³•ä»‹ç»"></a>MessageQueue nextæ–¹æ³•ä»‹ç»</h3><p>åˆ°è¿™é‡Œï¼ŒHandlerå‘é€çš„æ¶ˆæ¯å·²ç»æ”¾åˆ°äº†MessageQueueä¸­ï¼Œé‚£æ¥ç€è‚¯å®šå°±è¦è¿›è¡Œæ¶ˆæ¯çš„è¯»å–ï¼Œæˆ‘ä»¬åˆšè®²åˆ°Looperçš„<code>Loop</code>æ–¹æ³•ä¼šä»MessageQueueä¸­å¾ªç¯è¯»å–æ¶ˆæ¯ï¼Œ<code>loop</code>æ–¹æ³•ä¸­è°ƒç”¨<code>queue.next()</code>çš„åœ°æ–¹æœ‰å¥æºç æ³¨é‡Šï¼šmight block,ä¸­æ–‡æ„æ€æ˜¯å¯èƒ½è¢«é˜»å¡ï¼Œå¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">loop</span><span class="hljs-params">()</span> &#123;<br>  <span class="hljs-comment">//è·å–å½“å‰Looperä¸­çš„MessageQueue</span><br>    <span class="hljs-keyword">final</span> <span class="hljs-type">MessageQueue</span> <span class="hljs-variable">queue</span> <span class="hljs-operator">=</span> me.mQueue;<br>    <span class="hljs-comment">//...</span><br>  <span class="hljs-comment">//å¼€å¯æ­»å¾ªç¯è¯»å–æ¶ˆæ¯</span><br>    <span class="hljs-keyword">for</span> (;;) &#123;<br>      <span class="hljs-comment">// è·å–æ¶ˆæ¯é˜Ÿåˆ—ä¸­çš„æ¶ˆæ¯</span><br>        <span class="hljs-type">Message</span> <span class="hljs-variable">msg</span> <span class="hljs-operator">=</span> queue.next(); <span class="hljs-comment">// might block</span><br>    &#125;<br>  <span class="hljs-comment">//...</span><br>&#125;<br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬å°±çœ‹ä¸‹MessageQueueçš„<code>next</code>æ–¹æ³•åˆ°åº•åšäº†ä»€ä¹ˆï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><code class="hljs java">Message <span class="hljs-title function_">next</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-comment">// Return here if the message loop has already quit and been disposed.</span><br>    <span class="hljs-comment">// æºç ä¸­çš„æ³¨é‡Šè¡¨ç¤º:å¦‚æœlooperå·²ç»é€€å‡ºäº†,è¿™é‡Œå°±è¿”å›null</span><br>    <span class="hljs-keyword">final</span> <span class="hljs-type">long</span> <span class="hljs-variable">ptr</span> <span class="hljs-operator">=</span> mPtr;<br>    <span class="hljs-keyword">if</span> (ptr == <span class="hljs-number">0</span>) &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>    &#125;<br>    <span class="hljs-comment">//...</span><br>    <span class="hljs-comment">// å®šä¹‰é˜»å¡æ—¶é—´èµ‹å€¼ä¸º0</span><br>    <span class="hljs-type">int</span> <span class="hljs-variable">nextPollTimeoutMillis</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;<br>  <span class="hljs-comment">//æ­»å¾ªç¯</span><br>    <span class="hljs-keyword">for</span> (;;) &#123;<br>        <span class="hljs-keyword">if</span> (nextPollTimeoutMillis != <span class="hljs-number">0</span>) &#123;<br>            Binder.flushPendingCommands();<br>        &#125;<br>        <span class="hljs-comment">// é˜»å¡å¯¹åº”æ—¶é—´ è¿™ä¸ªæ–¹æ³•æœ€ç»ˆä¼šè°ƒç”¨åˆ°linuxçš„epollæœºåˆ¶</span><br>        nativePollOnce(ptr, nextPollTimeoutMillis);<br>    <span class="hljs-comment">// å¯¹MessageQueueè¿›è¡ŒåŠ é”ï¼Œä¿è¯çº¿ç¨‹å®‰å…¨</span><br>        <span class="hljs-keyword">synchronized</span> (<span class="hljs-built_in">this</span>) &#123;<br>            <span class="hljs-keyword">final</span> <span class="hljs-type">long</span> <span class="hljs-variable">now</span> <span class="hljs-operator">=</span> SystemClock.uptimeMillis();<br>            <span class="hljs-type">Message</span> <span class="hljs-variable">prevMsg</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br>            <span class="hljs-type">Message</span> <span class="hljs-variable">msg</span> <span class="hljs-operator">=</span> mMessages;<br>            <span class="hljs-comment">//...</span><br>            <span class="hljs-keyword">if</span> (msg != <span class="hljs-literal">null</span>) &#123;<br>                <span class="hljs-keyword">if</span> (now &lt; msg.when) &#123;<br>                    <span class="hljs-comment">// ä¸‹ä¸€ä¸ªæ¶ˆæ¯è¿˜æ²¡å¼€å§‹ï¼Œç­‰å¾…ä¸¤è€…çš„æ—¶é—´å·®</span><br>                    nextPollTimeoutMillis = (<span class="hljs-type">int</span>) Math.min(msg.when - now, Integer.MAX_VALUE);<br>                &#125; <span class="hljs-keyword">else</span> &#123;<br>                    <span class="hljs-comment">// è·å¾—æ¶ˆæ¯ä¸”ç°åœ¨è¦æ‰§è¡Œï¼Œæ ‡è®°MessageQueueä¸ºéé˜»å¡</span><br>                    mBlocked = <span class="hljs-literal">false</span>;<br>                    <span class="hljs-comment">// é“¾è¡¨æ“ä½œ</span><br>                    <span class="hljs-keyword">if</span> (prevMsg != <span class="hljs-literal">null</span>) &#123;<br>                        prevMsg.next = msg.next;<br>                    &#125; <span class="hljs-keyword">else</span> &#123;<br>                        mMessages = msg.next;<br>                    &#125;<br>                    msg.next = <span class="hljs-literal">null</span>;<br>                    msg.markInUse();<br>                    <span class="hljs-keyword">return</span> msg;<br>                &#125;<br>            &#125; <span class="hljs-keyword">else</span> &#123;<br>                <span class="hljs-comment">// æ²¡æœ‰æ¶ˆæ¯ï¼Œè¿›å…¥é˜»å¡çŠ¶æ€</span><br>                nextPollTimeoutMillis = -<span class="hljs-number">1</span>;<br>            &#125;<br>          <span class="hljs-comment">//é€€å‡º</span><br>          <span class="hljs-keyword">if</span> (mQuitting) &#123;<br>                 dispose();<br>                 <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>             &#125;<br>            <span class="hljs-comment">//...æ¶‰åŠäº†åŒæ­¥å±éšœå’ŒIdleHandler,åç»­åœ¨åˆ†æ</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ä»ä¸Šé¢ä»£ç æˆ‘ä»¬å‘ç°<code>next</code>æ–¹æ³•ç›®çš„æ˜¯è·å–MessageQueueä¸­çš„ä¸€ä¸ªMessageï¼Œå®ƒé‡Œé¢æœ‰ä¸€ä¸ªæ­»å¾ªç¯ï¼Œå¦‚æœæ¶ˆæ¯é˜Ÿåˆ—ä¸­æ²¡æœ‰æ¶ˆæ¯ï¼Œé‚£ä¹ˆnextæ–¹æ³•ä¼šä¸€ç›´é˜»å¡åœ¨è¿™é‡Œï¼Œå½“æœ‰æ–°æ¶ˆæ¯åˆ°æ¥æ—¶ï¼Œå°±ä¼šå°†å®ƒå”¤é†’ï¼Œnextæ–¹æ³•ä¼šè¿”å›è¿™æ¡æ¶ˆæ¯å¹¶å°†å…¶ä»ä¼˜å…ˆçº§é˜Ÿåˆ—ä¸­ç»™ç§»é™¤</p><p>æ­¥éª¤å¦‚ä¸‹ï¼š</p><ol><li>å¦‚æœLooperå·²ç»é€€å‡ºäº†ï¼Œç›´æ¥è¿”å›null</li><li>è¿›å…¥æ­»å¾ªç¯ï¼Œç›´åˆ°è·å–åˆ°Messageæˆ–è€…é€€å‡º</li><li>å¾ªç¯ä¸­å…ˆåˆ¤æ–­æ˜¯å¦éœ€è¦è¿›è¡Œé˜»å¡ï¼Œé˜»å¡æœ€ç»ˆä¼šè°ƒç”¨åˆ°linuxçš„epollæœºåˆ¶ï¼Œé˜»å¡ç»“æŸå,å¯¹MessageQueueè¿›è¡ŒåŠ é”ï¼Œè·å–Message</li><li>å¦‚æœMessageQueueä¸­æ²¡æœ‰æ¶ˆæ¯ï¼Œåˆ™ç›´æ¥æŠŠçº¿ç¨‹æ— é™é˜»å¡ç­‰å¾…å”¤é†’</li><li>å¦‚æœMessageQueueä¸­æœ‰æ¶ˆæ¯ï¼Œåˆ™åˆ¤æ–­æ˜¯å¦éœ€è¦ç­‰å¾…ï¼Œå¦åˆ™åˆ™ç›´æ¥è¿”å›å¯¹åº”çš„message</li></ol><p>å¯ä»¥çœ‹åˆ°é€»è¾‘å°±æ˜¯åˆ¤æ–­å½“å‰æ—¶é—´Messageä¸­æ˜¯å¦éœ€è¦ç­‰å¾….å…¶ä¸­<code>nextPollTimeoutMillis</code>è¡¨ç¤ºé˜»å¡çš„æ—¶é—´ï¼Œ<code>-1</code>è¡¨ç¤ºæ— é™æ—¶é—´,ç›´åˆ°æœ‰äº‹ä»¶å‘ç”Ÿä¸ºæ­¢ï¼Œ<code>0</code>è¡¨ç¤ºä¸é˜»å¡</p><h3 id="Handleræ¥æ”¶æ¶ˆæ¯"><a href="#Handleræ¥æ”¶æ¶ˆæ¯" class="headerlink" title="Handleræ¥æ”¶æ¶ˆæ¯"></a>Handleræ¥æ”¶æ¶ˆæ¯</h3><p>åœ¨æˆ‘ä»¬å¯¹Looperè¿›è¡Œæ€»ç»“æ—¶æˆ‘ä»¬è¯´äº†ï¼š Handlerä¹Ÿæ˜¯å®ç°çº¿ç¨‹åˆ‡æ¢çš„æ ¸å¿ƒï¼Œå› ä¸ºä¸åŒçš„Looperè¿è¡Œåœ¨ä¸åŒçš„çº¿ç¨‹ï¼Œä»–æ‰€è°ƒç”¨çš„dispatchMessageæ–¹æ³•åˆ™ä¼šè¿è¡Œåœ¨ä¸åŒçš„çº¿ç¨‹ï¼Œæ‰€ä»¥Messageçš„å¤„ç†å°±ä¼šè¢«åˆ‡æ¢åˆ°Looperæ‰€åœ¨çš„çº¿ç¨‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">loop</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-keyword">for</span> (;;) &#123;<br>      <span class="hljs-comment">//...</span><br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-comment">// è°ƒç”¨Messageå¯¹åº”çš„Handlerå¤„ç†æ¶ˆæ¯</span><br>            msg.target.dispatchMessage(msg);<br>        &#125;<br> <span class="hljs-comment">//...</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ä¸Šé¢ä»£ç è°ƒç”¨äº† <code>msg.target.dispatchMessage(msg)</code> æ–¹æ³•ï¼Œmsg.target å°±æ˜¯å‘é€è¯¥æ¶ˆæ¯çš„ Handlerï¼Œè¿™æ ·æ¶ˆæ¯æœ€ç»ˆä¼šå›è°ƒåˆ°Handlerçš„<code>dispatchMessage</code>æ–¹æ³•ä¸­ï¼Œçœ‹ä¸‹è¿™ä¸ªæ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">dispatchMessage</span><span class="hljs-params">(<span class="hljs-meta">@NonNull</span> Message msg)</span> &#123;<br>  <span class="hljs-comment">//æ¶ˆæ¯çš„callbackä¸ä¸ºç©º,åˆ™å›è°ƒhandleCallbackæ–¹æ³•</span><br>    <span class="hljs-keyword">if</span> (msg.callback != <span class="hljs-literal">null</span>) &#123;<br>        handleCallback(msg);<br>     &#125; <span class="hljs-keyword">else</span> &#123;<br>      <span class="hljs-comment">//å½“å‰mCallbackä¸ä¸ºç©º,å›è°ƒmCallback.handleMessageæ–¹æ³•</span><br>     <span class="hljs-keyword">if</span> (mCallback != <span class="hljs-literal">null</span>) &#123;<br>              <span class="hljs-keyword">if</span> (mCallback.handleMessage(msg)) &#123;<br>                  <span class="hljs-keyword">return</span>;<br>              &#125;<br>          &#125;<br>      <span class="hljs-comment">//å›è°ƒhandleMessage</span><br>          handleMessage(msg);<br>     &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ä¸Šè¿°ä»£ç æ­¥éª¤:</p><p>1ã€é¦–å…ˆï¼Œæ£€æŸ¥Messageçš„callbackæ˜¯å¦ä¸ºnullï¼Œä¸ä¸ºnullå°±é€šè¿‡<code>handleCallBack</code>æ¥å¤„ç†æ¶ˆæ¯ï¼ŒMessageçš„callbackæ˜¯ä¸€ä¸ªRunnableå¯¹è±¡ï¼Œå®é™…ä¸Šå°±æ˜¯Handlerçš„<code>post</code>ç³»åˆ—æ–¹æ³•æ‰€ä¼ é€’çš„Runnableå‚æ•°ï¼Œ<code>handleCallBack</code>æ–¹æ³•å¤„ç†é€»è¾‘ä¹Ÿå¾ˆç®€å•ï¼Œå¦‚ä¸‹:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">handleCallback</span><span class="hljs-params">(Message message)</span> &#123;<br>     message.callback.run();<br>&#125;<br></code></pre></td></tr></table></figure><p>2ã€å…¶æ¬¡ï¼Œæ£€æŸ¥mCallbackæ˜¯å¦ä¸ºnullï¼Œä¸ä¸ºnullå°±è°ƒç”¨mCallbackçš„<code>handleMessage</code>æ–¹æ³•æ¥å¤„ç†æ¶ˆæ¯ã€‚Callbackæ˜¯ä¸ªæ¥å£ï¼Œå¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * Callback interface you can use when instantiating a Handler to avoid</span><br><span class="hljs-comment"> * having to implement your own subclass of Handler.</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">Callback</span> &#123;<br>    <span class="hljs-type">boolean</span> <span class="hljs-title function_">handleMessage</span><span class="hljs-params">(<span class="hljs-meta">@NonNull</span> Message msg)</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>é€šè¿‡Callbackå¯ä»¥é‡‡ç”¨å¦‚ä¸‹æ–¹å¼æ¥åˆ›å»ºHandlereå¯¹è±¡ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">Handler</span> <span class="hljs-variable">handler</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Handler</span>(callback);<br></code></pre></td></tr></table></figure><p>é‚£Callbackçš„æ„ä¹‰æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿæºç é‡Œæ³¨é‡Šåšäº†è¯´æ˜ï¼šå¯ä»¥ç”¨æ¥åˆ›å»ºä¸€ä¸ªHandlerçš„å®ä¾‹ä½†å¹¶ä¸éœ€è¦æ´¾ç”Ÿçš„å­ç±»ã€‚åœ¨æ—¥å¸¸å¼€å‘ä¸­ï¼Œåˆ›å»ºHandleræœ€å¸¸è§çš„å°±æ˜¯æ´¾ç”Ÿä¸€ä¸ªHandlerçš„å­ç±»å¹¶é‡å†™å…¶<code>handleMessage</code>æ–¹æ³•æ¥å¤„ç†å…·ä½“çš„æ¶ˆæ¯ï¼Œè€ŒCallbackç»™æˆ‘ä»¬æä¾›äº†å¦å¤–ä¸€ç§ä½¿ç”¨Handlerçš„æ–¹å¼ï¼Œå½“æˆ‘ä»¬ä¸æƒ³æ´¾ç”Ÿå­ç±»æ—¶ï¼Œå°±å¯ä»¥é€šè¿‡Callbackæ¥å®ç°ã€‚</p><p>3ã€æœ€åï¼Œè°ƒç”¨Handlerçš„<code>handleMessage</code>æ–¹æ³•æ¥å¤„ç†æ¶ˆæ¯</p><p>Handlerå¤„ç†æ¶ˆæ¯çš„è¿‡ç¨‹æˆ‘ç”»äº†ä¸€å¼ å›¾ï¼Œå¦‚ä¸‹ï¼š</p><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/2849c508f7a342e9b53f2b8384066c57~tplv-k3u1fbpfcp-zoom-1.image" alt="image-20210131222054614"></p><h3 id="Messageä»‹ç»"><a href="#Messageä»‹ç»" class="headerlink" title="Messageä»‹ç»"></a>Messageä»‹ç»</h3><p>Messageæ˜¯è´Ÿè´£æ‰¿è½½æ¶ˆæ¯çš„ç±»ï¼Œä¸»è¦æ˜¯å…³æ³¨ä»–çš„å†…éƒ¨å±æ€§ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// ç”¨æˆ·è‡ªå®šä¹‰ï¼Œä¸»è¦ç”¨äºè¾¨åˆ«Messageçš„ç±»å‹</span><br><span class="hljs-keyword">public</span> <span class="hljs-type">int</span> what;<br><span class="hljs-comment">// ç”¨äºå­˜å‚¨ä¸€äº›æ•´å‹æ•°æ®</span><br><span class="hljs-keyword">public</span> <span class="hljs-type">int</span> arg1;<br><span class="hljs-keyword">public</span> <span class="hljs-type">int</span> arg2;<br><span class="hljs-comment">// å¯æ”¾å…¥ä¸€ä¸ªå¯åºåˆ—åŒ–å¯¹è±¡</span><br><span class="hljs-keyword">public</span> Object obj;<br><span class="hljs-comment">// Bundleæ•°æ®</span><br>Bundle data;<br><span class="hljs-comment">// Messageå¤„ç†çš„æ—¶é—´ã€‚ç›¸å¯¹äº1970.1.1è€Œè¨€çš„æ—¶é—´</span><br><span class="hljs-comment">// å¯¹ç”¨æˆ·ä¸å¯è§</span><br><span class="hljs-keyword">public</span> <span class="hljs-type">long</span> when;<br><span class="hljs-comment">// å¤„ç†è¿™ä¸ªMessageçš„Handler</span><br><span class="hljs-comment">// å¯¹ç”¨æˆ·ä¸å¯è§</span><br>Handler target;<br><span class="hljs-comment">// å½“æˆ‘ä»¬ä½¿ç”¨Handlerçš„postæ–¹æ³•æ—¶å€™å°±æ˜¯æŠŠrunnableå¯¹è±¡å°è£…æˆMessage</span><br><span class="hljs-comment">// å¯¹ç”¨æˆ·ä¸å¯è§</span><br>Runnable callback;<br><span class="hljs-comment">// MessageQueueæ˜¯ä¸€ä¸ªé“¾è¡¨ï¼Œnextè¡¨ç¤ºä¸‹ä¸€ä¸ª</span><br><span class="hljs-comment">// å¯¹ç”¨æˆ·ä¸å¯è§</span><br>Message next;<br></code></pre></td></tr></table></figure><h4 id="å¾ªç¯åˆ©ç”¨Message"><a href="#å¾ªç¯åˆ©ç”¨Message" class="headerlink" title="å¾ªç¯åˆ©ç”¨Message"></a>å¾ªç¯åˆ©ç”¨Message</h4><p>å½“æˆ‘ä»¬è·å–Messageçš„æ—¶å€™ï¼Œå®˜æ–¹å»ºè®®æ˜¯é€šè¿‡Message.obtain()æ–¹æ³•æ¥è·å–ï¼Œå½“ä½¿ç”¨å®Œä¹‹åä½¿ç”¨recycle()æ–¹æ³•æ¥å›æ”¶å¾ªç¯åˆ©ç”¨ã€‚è€Œä¸æ˜¯ç›´æ¥newä¸€ä¸ªæ–°çš„å¯¹è±¡ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Message <span class="hljs-title function_">obtain</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-keyword">synchronized</span> (sPoolSync) &#123;<br>        <span class="hljs-keyword">if</span> (sPool != <span class="hljs-literal">null</span>) &#123;<br>            <span class="hljs-type">Message</span> <span class="hljs-variable">m</span> <span class="hljs-operator">=</span> sPool;<br>            sPool = m.next;<br>            m.next = <span class="hljs-literal">null</span>;<br>            m.flags = <span class="hljs-number">0</span>; <br>            sPoolSize--;<br>            <span class="hljs-keyword">return</span> m;<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Message</span>();<br>&#125;<br></code></pre></td></tr></table></figure><p>Messageç»´æŠ¤äº†ä¸€ä¸ªé™æ€é“¾è¡¨ï¼Œé“¾è¡¨å¤´æ˜¯<code>sPool</code>ï¼ŒMessageæœ‰ä¸€ä¸ªnextå±æ€§ï¼ŒMessageæœ¬èº«å°±æ˜¯é“¾è¡¨ç»“æ„ã€‚<code>sPoolSync</code>æ˜¯ä¸€ä¸ªobjectå¯¹è±¡ï¼Œä»…ä½œä¸ºè§£å†³å¹¶å‘è®¿é—®å®‰å…¨è®¾è®¡ã€‚å½“æˆ‘ä»¬è°ƒç”¨obtainæ¥è·å–ä¸€ä¸ªæ–°çš„Messageçš„æ—¶å€™ï¼Œé¦–å…ˆä¼šæ£€æŸ¥é“¾è¡¨ä¸­æ˜¯å¦æœ‰ç©ºé—²çš„Messageï¼Œå¦‚æœæ²¡æœ‰åˆ™æ–°å»ºä¸€ä¸ªè¿”å›ã€‚</p><p>å½“æˆ‘ä»¬ä½¿ç”¨å®Œæˆä¹‹åï¼Œå¯ä»¥è°ƒç”¨Messageçš„recycleæ–¹æ³•è¿›è¡Œå›æ”¶ï¼Œå¦‚æœè¿™ä¸ªMessageæ­£åœ¨ä½¿ç”¨åˆ™ä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œå¦åˆ™åˆ™è°ƒç”¨<code>recycleUnchecked</code>è¿›è¡Œå›æ”¶ï¼ŒæŠŠMessageä¸­çš„å†…å®¹æ¸…ç©ºï¼Œç„¶ååˆ¤æ–­é“¾è¡¨æ˜¯å¦è¾¾åˆ°æœ€å¤§å€¼ï¼ˆ50ï¼‰ï¼Œç„¶åæ’å…¥é“¾è¡¨ä¸­</p><h2 id="Handleræ¶ˆæ¯æœºåˆ¶åŸç†æ€»ç»“"><a href="#Handleræ¶ˆæ¯æœºåˆ¶åŸç†æ€»ç»“" class="headerlink" title="Handleræ¶ˆæ¯æœºåˆ¶åŸç†æ€»ç»“"></a>Handleræ¶ˆæ¯æœºåˆ¶åŸç†æ€»ç»“</h2><p>é€šè¿‡ä¸Šé¢çš„æºç åˆ†æï¼Œæˆ‘ä»¬å¯ä»¥å¾—å‡ºç»“è®ºï¼š</p><ol><li>å®ä¾‹åŒ–Handlerä¹‹å‰ï¼Œéœ€å…ˆæ„å»ºå½“å‰çº¿ç¨‹çš„Looperå¹¶å¼€å¯æ¶ˆæ¯å¾ªç¯</li><li>é€šè¿‡Handlerçš„sendå’Œpostæ–¹æ³•å‘é€æ¶ˆæ¯</li><li>å‘é€çš„æ¶ˆæ¯ä¼šåŠ å…¥åˆ°MessageQueueä¸­ï¼Œç­‰å¾…Looperè·å–å¤„ç†</li><li>Looperä¼šä¸æ–­åœ°ä»MessageQueueä¸­è·å–Messageç„¶åäº¤ä»˜ç»™å¯¹åº”çš„Handlerå¤„ç†</li></ol><p>å¦‚æœåˆ°è¿™é‡Œä½ è¿˜ä¸æ˜¯ç‰¹åˆ«æ¸…æ¥šHandleræ¶ˆæ¯æœºåˆ¶çš„åŸç†ï¼Œé‚£ä¹ˆç»§ç»­çœ‹ä¸‹é¢è¿™å¼ å›¾ï¼š</p><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/c76ccdd09feb4aa2a41ba0789da36c38~tplv-k3u1fbpfcp-zoom-1.image"></p><p>å¥½äº†ï¼Œåˆ°äº†è¿™é‡Œï¼Œå…³äºHandleræ¶ˆæ¯æœºåˆ¶çš„ä¸»ä½“éƒ¨åˆ†å°±è®²å®Œäº†ã€‚</p><p>é™äºç¯‡å¹…ï¼Œæœ¬ç¯‡æ–‡ç« å°±åˆ°è¿™é‡Œäº†ï¼Œåç»­æˆ‘ä¼šåœ¨å†™ä¸€ç¯‡å…³äºHandlerçš„æ–‡ç« ï¼Œä»‹ç»Hanlderçš„ä¸€äº›æ‰©å±•çŸ¥è¯†å­¦ä¹ ï¼Œå¹¶å›ç­”å‰é¢æˆ‘æ‰€åˆ—å‡ºæ¥çš„ä¸€ç³»åˆ—é—®é¢˜</p><blockquote><p><strong>ä½ çš„ç‚¹èµï¼Œè¯„è®ºï¼Œæ˜¯å¯¹æˆ‘å·¨å¤§çš„é¼“åŠ±ï¼</strong></p><p>æ¬¢è¿å…³æ³¨æˆ‘çš„<strong>å…¬ä¼—å·ï¼š</strong>  <a href="http://m6z.cn/6jwi7b"><strong>sweetying</strong></a> ï¼Œæ–‡ç« æ›´æ–°å¯ç¬¬ä¸€æ—¶é—´æ”¶åˆ°</p><p>å¦‚æœ<strong>æœ‰é—®é¢˜</strong>ï¼Œå…¬ä¼—å·å†…æœ‰åŠ æˆ‘å¾®ä¿¡çš„å…¥å£ï¼Œåœ¨æŠ€æœ¯å­¦ä¹ ã€ä¸ªäººæˆé•¿çš„é“è·¯ä¸Šï¼Œæˆ‘ä»¬ä¸€èµ·å‰è¿›ï¼</p></blockquote>]]></content>
    
    
    <categories>
      
      <category>Android</category>
      
      <category>ä¸€ç¯‡å°±å¤Ÿ</category>
      
    </categories>
    
    
    <tags>
      
      <tag>åŸåˆ›</tag>
      
      <tag>Android</tag>
      
      <tag>ä¸€ç¯‡å°±å¤Ÿ</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ä¸€ç¯‡å°±å¤Ÿç³»åˆ—ï¼šå‘å¸ƒå¼€æºåº“åˆ°JitPackï¼ŒJCenterè¯¦ç»†æ•™ç¨‹</title>
    <link href="/2022/10/11/%E4%B8%80%E7%AF%87%E5%B0%B1%E5%A4%9F%E7%B3%BB%E5%88%97%EF%BC%9A%E5%8F%91%E5%B8%83%E5%BC%80%E6%BA%90%E5%BA%93%E5%88%B0JitPack%EF%BC%8CJCenter%E8%AF%A6%E7%BB%86%E6%95%99%E7%A8%8B/"/>
    <url>/2022/10/11/%E4%B8%80%E7%AF%87%E5%B0%B1%E5%A4%9F%E7%B3%BB%E5%88%97%EF%BC%9A%E5%8F%91%E5%B8%83%E5%BC%80%E6%BA%90%E5%BA%93%E5%88%B0JitPack%EF%BC%8CJCenter%E8%AF%A6%E7%BB%86%E6%95%99%E7%A8%8B/</url>
    
    <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><ul><li><p>JCenterè§£é‡Š: JCenteræ˜¯ä¸€ä¸ªJava&#x2F;Androidå·¥ç¨‹çš„åŒ…ç®¡ç†Mavenä»“åº“,ç”±<a href="https://bintray.com/">bintray.com</a>ç»´æŠ¤,æ˜¯ç›®å‰ä¸–ç•Œä¸Šæœ€å¤§çš„Javaä»“åº“</p></li><li><p><a href="https://jitpack.io/">JitPack</a>å®˜æ–¹è§£é‡Š: æ˜“äºä¸ºJVMå’ŒAndroidåº“ä½¿ç”¨åŒ…å­˜å‚¨åº“ï¼ŒJitPackæ ¹æ®éœ€è¦æ„å»ºGitHubé¡¹ç›®ï¼Œå¹¶å‘å¸ƒéšæ—¶å¯ç”¨çš„åŒ…</p></li><li><p>åœ¨æˆ‘ä»¬çš„æ—¥å¸¸å¼€å‘å½“ä¸­,ç»å¸¸ä¼šå¼•å…¥ä¸€äº›ç¬¬ä¸‰æ–¹çš„åº“æ¥å®ç°ä¸€äº›åŠŸèƒ½,å¦‚ä¸‹</p></li></ul><p>æ–¹å¼1: å‘å¸ƒåˆ°JCenterçš„åº“è¿›è¡Œå¦‚ä¸‹ä¾èµ–:</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-regexp">//</span>åœ¨appçš„build.gradleæˆ–è€…moduleçš„build.gradleä¸‹æ·»åŠ å¦‚ä¸‹ä»£ç <br>dependencies &#123;<br>    implementation <span class="hljs-string">&#x27;org.greenrobot:eventbus:3.2.0&#x27;</span><br>&#125;<br></code></pre></td></tr></table></figure><p>æ–¹å¼2: å‘å¸ƒåˆ°JitPackçš„åº“è¿›è¡Œå¦‚ä¸‹ä¾èµ–</p><figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs fsharp"><span class="hljs-comment">//åœ¨projectçš„build.gradleä¸­æ·»åŠ å¦‚ä¸‹ä»£ç </span><br><span class="hljs-keyword">allprojects</span> &#123;<br>    <span class="hljs-keyword">repositories</span> &#123;<br>       <span class="hljs-comment">//...</span><br>        <span class="hljs-keyword">maven</span> &#123; url <span class="hljs-symbol">&#x27;https</span><span class="hljs-operator">:</span><span class="hljs-comment">//jitpack.io&#x27; &#125;</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-regexp">//</span>åœ¨appçš„build.gradleæˆ–è€…moduleçš„build.gradleä¸‹æ·»åŠ å¦‚ä¸‹ä»£ç <br>dependencies &#123;<br>    implementation <span class="hljs-string">&#x27;com.github.sweetying520:AndroidUtils:1.0.1&#x27;</span><br>&#125;<br></code></pre></td></tr></table></figure><p>ç»è¿‡ä¸Šé¢çš„æ“ä½œ,æˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨è¿™äº›ç¬¬ä¸‰æ–¹åº“çš„åŠŸèƒ½äº†</p><p><strong>æ³¨æ„:</strong></p><blockquote><p>JitPackå’ŒJCenteréƒ½æ˜¯ç¬¬ä¸‰æ–¹çš„ä»£ç ä»“åº“,åœ¨æˆ‘ä»¬ä½¿ç”¨AndroidStudioæ–°å»ºä¸€ä¸ªé¡¹ç›®çš„æ—¶å€™é»˜è®¤å¼•å…¥äº†JCenter,å› æ­¤æˆ‘ä»¬å‘å¸ƒåˆ°Jcenterçš„åº“å°±å¯ä»¥ç›´æ¥åœ¨appçš„build.gradleæˆ–è€…moduleçš„build.gradleæ·»åŠ ä¾èµ–å³å¯,è€ŒJitPackæ²¡æœ‰å¼•å…¥,å› æ­¤åœ¨æ·»åŠ appçš„build.gradleæˆ–è€…moduleçš„build.gradleçš„ä¾èµ–çš„æ—¶å€™,éœ€åœ¨projectä¸­çš„build.gradleä¸­å¼•å…¥JitPackçš„ä»“åº“,æ·»åŠ å…¶ä»–ç¬¬ä¸‰æ–¹åº“ä¸‹çš„ä¾èµ–ä¹Ÿæ˜¯å¦‚æ­¤</p></blockquote><ul><li><p>é—®é¢˜: æˆ‘ä»¬å¦‚ä½•å°†è‡ªå·±å†™çš„Androidåº“è¢«åˆ«äººä¼˜é›…çš„å¼•ç”¨å‘¢ï¼Ÿ</p><p>ç­”æ¡ˆ: å°†æˆ‘ä»¬ç¼–å†™å¥½çš„Androidåº“å‘å¸ƒåˆ°JCenteræˆ–è€…JitPackä»“åº“æˆ–è€…è‡ªå·±çš„æœ¬åœ°ä»“åº“,åœ¨æŒ‰ç…§å¦‚ä¸Šæ–¹å¼å¼•ç”¨</p></li></ul><h2 id="æ–¹å¼ä¸€-å‘å¸ƒAndroidåº“åˆ°JCenter"><a href="#æ–¹å¼ä¸€-å‘å¸ƒAndroidåº“åˆ°JCenter" class="headerlink" title="æ–¹å¼ä¸€: å‘å¸ƒAndroidåº“åˆ°JCenter"></a>æ–¹å¼ä¸€: å‘å¸ƒAndroidåº“åˆ°JCenter</h2><h3 id="æ­¥éª¤1-æ³¨å†ŒBintrayè´¦å·"><a href="#æ­¥éª¤1-æ³¨å†ŒBintrayè´¦å·" class="headerlink" title="æ­¥éª¤1: æ³¨å†ŒBintrayè´¦å·"></a>æ­¥éª¤1: æ³¨å†ŒBintrayè´¦å·</h3><ul><li><a href="https://bintray.com/signup/oss">æ³¨å†Œåœ°å€</a></li></ul><blockquote><p><strong>æ³¨æ„:</strong></p><ol><li>ä¸è¦åœ¨å®˜ç½‘æ³¨å†Œï¼Œå› ä¸ºå®˜ç½‘æ³¨å†Œçš„æ˜¯ä¼ä¸šç‰ˆï¼Œæˆ‘ä»¬éœ€è¦çš„æ˜¯ä¸ªäººç‰ˆ</li><li>ï¼ˆå»ºè®®ï¼‰ç›´æ¥å…³è” <code>Github</code>è´¦å·è¿›è¡Œæ³¨å†Œ &amp; ç™»å½•</li></ol></blockquote><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/6de3916fd3a24b0eb68240d8f49a343e~tplv-k3u1fbpfcp-zoom-1.image" alt="944365-93dd43c47e0ffa59"></p><h3 id="æ­¥éª¤2-åœ¨Bintrayä¸Šåˆ›å»ºä»“åº“"><a href="#æ­¥éª¤2-åœ¨Bintrayä¸Šåˆ›å»ºä»“åº“" class="headerlink" title="æ­¥éª¤2: åœ¨Bintrayä¸Šåˆ›å»ºä»“åº“"></a>æ­¥éª¤2: åœ¨Bintrayä¸Šåˆ›å»ºä»“åº“</h3><ol><li><p>ç‚¹å‡»çº¢æ¡†ä¸­çš„Add New Repositoryåˆ›å»ºä¸€ä¸ªä»“åº“</p><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/4f8beb73953140df90d44f08300ccd80~tplv-k3u1fbpfcp-zoom-1.image" alt="image-20210110140256826"></p></li></ol><h3 id="æ­¥éª¤3-æŒ‰æ­¥éª¤å¡«å†™ç›¸å…³é…ç½®"><a href="#æ­¥éª¤3-æŒ‰æ­¥éª¤å¡«å†™ç›¸å…³é…ç½®" class="headerlink" title="æ­¥éª¤3: æŒ‰æ­¥éª¤å¡«å†™ç›¸å…³é…ç½®"></a>æ­¥éª¤3: æŒ‰æ­¥éª¤å¡«å†™ç›¸å…³é…ç½®</h3><p><strong>æ³¨æ„</strong></p><p>å¡«å†™ä»“åº“åçš„æ—¶å€™,è¿™é‡Œæˆ‘ä»¬å¡«å†™mavenå°±å¥½ï¼Œè¿™ä¸ªåœ°æ–¹é‡åˆ°å‘å°±æ˜¯,å½“æˆ‘ä»¬å¡«å†™ä¸Šä¼ åˆ°Bintrayçš„é…ç½®ä¿¡æ¯çš„æ—¶å€™,å¦‚æœæ²¡æœ‰æŒ‡å®šrepoName,é‚£ä¹ˆé»˜è®¤çš„repoNameå°±ä¸ºmaven,å¦‚æœæŒ‡å®šäº†å°±å¡«å†™ä½ åˆ›å»ºçš„ä»“åº“åå³å¯</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs awk">publish &#123;<br>    userOrg = <span class="hljs-string">&#x27;sweetying520&#x27;</span>  <span class="hljs-regexp">//</span>Bintrayç”¨æˆ·å<br>    repoName = <span class="hljs-string">&#x27;maven&#x27;</span> <span class="hljs-regexp">//</span>Bintrayä¸Šåˆ›å»ºçš„ä»“åº“å,å¦‚æœä½ åˆ›å»ºçš„æ˜¯maven,åˆ™å¯ä»¥å¹²æ‰è¿™ä¸€è¡Œ,å¦åˆ™éœ€è¦æŒ‡å®šä»“åº“å<br>    groupId = <span class="hljs-string">&#x27;com.github.sweetying520&#x27;</span> <span class="hljs-regexp">//</span>ä¾èµ–åimplementation <span class="hljs-string">&#x27;x:y:z&#x27;</span>ä¸­çš„x<br>    artifactId = <span class="hljs-string">&#x27;AndroidUtils&#x27;</span> <span class="hljs-regexp">//</span>ä¾èµ–åimplementation <span class="hljs-string">&#x27;x:y:z&#x27;</span>ä¸­çš„y<br>    publishVersion = <span class="hljs-string">&#x27;1.0.0&#x27;</span> <span class="hljs-regexp">//</span>ä¾èµ–åimplementation <span class="hljs-string">&#x27;x:y:z&#x27;</span>ä¸­çš„z<br>    desc = <span class="hljs-string">&#x27;AndroidUtils is a library of tools to help developers improve their productivity&#x27;</span> <span class="hljs-regexp">//</span>å¯¹è¿™ä¸ªåº“çš„æè¿°<br>    website = <span class="hljs-string">&#x27;https://github.com/sweetying520/AndroidUtils&#x27;</span> <span class="hljs-regexp">//</span>VCSåœ°å€,å¡«å†™è¯¥é¡¹ç›®çš„Githubåœ°å€å°±å¥½<br>&#125;<br></code></pre></td></tr></table></figure><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/0d9199b5090641488e02c346f513d29c~tplv-k3u1fbpfcp-zoom-1.image" alt="image-20210110140857448"></p><h3 id="æ­¥éª¤4-åœ¨ä»£ç é¡¹ç›®ä¸­åˆ›å»ºModuleï¼Œå¹¶å°†é¡¹ç›®ä¸Šä¼ åˆ°Github"><a href="#æ­¥éª¤4-åœ¨ä»£ç é¡¹ç›®ä¸­åˆ›å»ºModuleï¼Œå¹¶å°†é¡¹ç›®ä¸Šä¼ åˆ°Github" class="headerlink" title="æ­¥éª¤4: åœ¨ä»£ç é¡¹ç›®ä¸­åˆ›å»ºModuleï¼Œå¹¶å°†é¡¹ç›®ä¸Šä¼ åˆ°Github"></a>æ­¥éª¤4: åœ¨ä»£ç é¡¹ç›®ä¸­åˆ›å»º<code>Module</code>ï¼Œå¹¶å°†é¡¹ç›®ä¸Šä¼ åˆ°Github</h3><p><strong>æ³¨æ„</strong></p><p>Moduleæˆ‘å·²ç»åˆ›å»ºå¥½äº†,è¿™é‡Œåªæ˜¯æ¼”ç¤ºè¿‡ç¨‹</p><ol><li><p>æ–°å»ºModule</p><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/f6203f57c4c34bdabd8abe8bc7b7605f~tplv-k3u1fbpfcp-zoom-1.image" alt="image-20210110144659112"></p></li><li><p>é€‰æ‹©Android Library</p><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/01409ab76bbc47509d5df79d85564520~tplv-k3u1fbpfcp-zoom-1.image" alt="image-20210110145022512"></p></li><li><p>åœ¨Moduleä¸­ç¼–å†™ä¸€äº›æµ‹è¯•ä»£ç ,æ–¹ä¾¿ä¸Šä¼ æˆåŠŸåéªŒè¯</p></li><li><p>å°†è‡ªå·±çš„è¿™ä¸ªé¡¹ç›®ä¸Šä¼ åˆ°Github,å¦‚ä½•ä¸Šä¼ åˆ°Githubä¸æ‡‚çš„è‡ªå·±ä¸Šç½‘æŸ¥ä¸€ä¸‹</p></li></ol><h3 id="æ­¥éª¤5-é…ç½®ä¸Šä¼ æ’ä»¶å¹¶ä¸Šä¼ åˆ°JCenter"><a href="#æ­¥éª¤5-é…ç½®ä¸Šä¼ æ’ä»¶å¹¶ä¸Šä¼ åˆ°JCenter" class="headerlink" title="æ­¥éª¤5: é…ç½®ä¸Šä¼ æ’ä»¶å¹¶ä¸Šä¼ åˆ°JCenter"></a>æ­¥éª¤5: é…ç½®ä¸Šä¼ æ’ä»¶å¹¶ä¸Šä¼ åˆ°JCenter</h3><blockquote><p><strong>æ³¨æ„</strong></p><p>ç½‘ä¸Šå¤§éƒ¨åˆ†æ•™ç¨‹æ¨èæˆ‘ä»¬ä½¿ç”¨<a href="https://github.com/novoda/bintray-release">bintray-releaseæ’ä»¶</a>ä¸Šä¼ ,ä½†æ˜¯è¿™ä¸ªæ’ä»¶ä¸æ”¯æŒGradleç‰ˆæœ¬ä¸º6.+çš„,å› æ­¤è¿™é‡Œæˆ‘æ¨èå¤§å®¶ä½¿ç”¨å¦å¤–ä¸€ä¸ªæ’ä»¶<a href="https://github.com/panpf/bintray-publish">ä¼ é€é—¨</a>,å®ƒæ˜¯åŸºäº<a href="https://github.com/novoda/bintray-release">bintray-releaseæ’ä»¶</a>åšäº†ä¸€äº›æ”¹é€ ,ç„¶åæ”¯æŒGradleç‰ˆæœ¬ä¸º6.+ä¸Šä¼ </p></blockquote><ol><li>åœ¨ä½ moduleçš„build.gradleä¸‹é…ç½®å¦‚ä¸‹ä»£ç å³å¯</li></ol><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-regexp">//</span>================================bintray ä¸Šä¼ æ’ä»¶é…ç½® start=========================================<br>apply plugin: <span class="hljs-string">&#x27;com.github.panpf.bintray-publish&#x27;</span><br><br><span class="hljs-regexp">//</span>é˜²æ­¢ä¸­æ–‡æ³¨é‡Šå‡ºç°é”™è¯¯<br>allprojects &#123;<br>    tasks.withType(Javadoc) &#123;<br>        options.addStringOption(<span class="hljs-string">&#x27;Xdoclint:none&#x27;</span>, <span class="hljs-string">&#x27;-quiet&#x27;</span>)<br>        options.addStringOption(<span class="hljs-string">&#x27;encoding&#x27;</span>, <span class="hljs-string">&#x27;UTF-8&#x27;</span>)<br>    &#125;<br>&#125;<br><br>buildscript &#123;<br>    repositories &#123;<br>        jcenter()<br>    &#125;<br>    dependencies &#123;<br>      <span class="hljs-regexp">//</span>ä¸Šä¼ æ’ä»¶<br>        classpath <span class="hljs-string">&#x27;com.github.panpf.bintray-publish:bintray-publish:1.0.0&#x27;</span><br>    &#125;<br>&#125;<br><br><span class="hljs-regexp">//</span>ä¸‹é¢è¿™äº›é…ç½®æ¢æˆä½ è‡ªå·±çš„å³å¯<br>publish &#123;<br>    userOrg = <span class="hljs-string">&#x27;sweetying520&#x27;</span>  <span class="hljs-regexp">//</span>Bintrayç”¨æˆ·å<br>    repoName = <span class="hljs-string">&#x27;maven&#x27;</span> <span class="hljs-regexp">//</span>Bintrayä¸Šåˆ›å»ºçš„ä»“åº“å,å¦‚æœä½ åˆ›å»ºçš„æ˜¯maven,åˆ™å¯ä»¥å¹²æ‰è¿™ä¸€è¡Œ,å¦åˆ™éœ€è¦æŒ‡å®šä»“åº“å<br>    groupId = <span class="hljs-string">&#x27;com.github.sweetying520&#x27;</span> <span class="hljs-regexp">//</span>ä¾èµ–åimplementation <span class="hljs-string">&#x27;x:y:z&#x27;</span>ä¸­çš„x<br>    artifactId = <span class="hljs-string">&#x27;AndroidUtils&#x27;</span> <span class="hljs-regexp">//</span>ä¾èµ–åimplementation <span class="hljs-string">&#x27;x:y:z&#x27;</span>ä¸­çš„y<br>    publishVersion = <span class="hljs-string">&#x27;1.0.0&#x27;</span> <span class="hljs-regexp">//</span>ä¾èµ–åimplementation <span class="hljs-string">&#x27;x:y:z&#x27;</span>ä¸­çš„z<br>    desc = <span class="hljs-string">&#x27;AndroidUtils is a library of tools to help developers improve their productivity&#x27;</span> <span class="hljs-regexp">//</span>å¯¹è¿™ä¸ªåº“çš„æè¿°<br>    website = <span class="hljs-string">&#x27;https://github.com/sweetying520/AndroidUtils&#x27;</span> <span class="hljs-regexp">//</span>VCSåœ°å€,å¡«å†™è¯¥é¡¹ç›®çš„Githubåœ°å€å°±å¥½<br>&#125;<br><span class="hljs-regexp">//</span>================================bintray ä¸Šä¼ æ’ä»¶é…ç½® end=========================================<br></code></pre></td></tr></table></figure><ol start="2"><li><p>ä¸Šä¼ é¡¹ç›®åˆ°JCenter</p><ol><li><p>åœ¨ä½ çš„AndroidStudioçš„Terminalä¸­æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤:</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs routeros">å¦‚æœæ˜¯Windowsç³»ç»Ÿ:<br><br>gradlew clean build bintrayUpload <span class="hljs-attribute">-PbintrayUser</span>=<span class="hljs-string">&quot;Bintrayç”¨æˆ·å&quot;</span> <span class="hljs-attribute">-PbintrayKey</span>=<span class="hljs-string">&quot;Binaryå¾—åˆ°çš„API Key&quot;</span> <span class="hljs-attribute">-PdryRun</span>=<span class="hljs-literal">false</span><br>   <br>å¦‚æœæ˜¯Macç³»ç»Ÿ:<br><br>./gradlew clean build bintrayUpload <span class="hljs-attribute">-PbintrayUser</span>=<span class="hljs-string">&quot;Bintrayç”¨æˆ·å&quot;</span> <span class="hljs-attribute">-PbintrayKey</span>=<span class="hljs-string">&quot;Binaryå¾—åˆ°çš„API Key&quot;</span> <span class="hljs-attribute">-PdryRun</span>=<span class="hljs-literal">false</span><br></code></pre></td></tr></table></figure><p>ä¸Šé¢<strong>PbintrayUser</strong>ä»£è¡¨æ³¨å†Œçš„ç”¨æˆ·åï¼Œ<strong>PbintrayKey</strong>å°±æ˜¯éœ€è¦åœ¨Binaryå¾—åˆ°çš„API Keyï¼ŒPdryRunæ˜¯ä¸€ä¸ªé…ç½®å‚æ•°ï¼Œä¸ºtrueçš„æ—¶å€™ï¼Œä¼šè¿è¡Œæ‰€æœ‰çš„ç¯èŠ‚ï¼Œä½†æ˜¯ä¸ä¼šä¸Šä¼ </p></li><li><p>å¦‚ä½•è·å–Binaryå¾—åˆ°çš„API Key?</p><ol><li><p>ç‚¹å‡»1çš„Edit Profile</p></li><li><p>ç‚¹å‡»2çš„API Key</p></li><li><p>è¾“å…¥3çš„å¯†ç å³å¯è·å–API Key</p><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/1ad70987d56d40ac9a4c3b73d77a3ff4~tplv-k3u1fbpfcp-zoom-1.image" alt="image-20210110152109989"></p></li></ol></li></ol></li><li><p>è‡³æ­¤,å·²ç»å°†é¡¹ç›®ä¸Šä¼ åˆ°JCenterä¸Šé¢å»äº†,æˆ‘ä»¬å¯ä»¥æŸ¥çœ‹åº“ç›¸å…³ä¿¡æ¯</p><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/baca177c4c89447385aa088ed8b07db8~tplv-k3u1fbpfcp-zoom-1.image" alt="image-20210110152638520"></p><p>ä½†æ˜¯è¿™ä¸ªæ—¶å€™,æˆ‘ä»¬çš„åº“è¿˜ä¸èƒ½è¢«å¤–ç•Œç»™å¼•ç”¨åˆ°</p></li></ol><h3 id="æ­¥éª¤6-æ·»åŠ åˆ°JCenter"><a href="#æ­¥éª¤6-æ·»åŠ åˆ°JCenter" class="headerlink" title="æ­¥éª¤6: æ·»åŠ åˆ°JCenter"></a>æ­¥éª¤6: æ·»åŠ åˆ°JCenter</h3><ol><li><p>ä»Bintrayä¸Šæ‰“å¼€æŸ¥çœ‹è¯¥åº“çš„ä¿¡æ¯,ç‚¹å‡»æ·»åŠ Add to JCenteræŒ‰é’®</p><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/982c86aae178457da160e2391bbc273a~tplv-k3u1fbpfcp-zoom-1.image" alt="image-20210110153737396"></p></li><li><p>å¡«å†™ä¸€äº›å¯¹libraryçš„æè¿°ï¼Œç„¶åå‘é€ï¼Œç­‰å¾…å®¡æ ¸,å®¡æ ¸æ—¶é—´ä¸€èˆ¬å‡ åˆ†é’Ÿåˆ°å‡ ä¸ªå°æ—¶,å·¥ä½œæ—¥ä¼šå¿«ç‚¹,å®¡æ ¸é€šè¿‡åä¼šé‚®ä»¶é€šçŸ¥ä½ ï¼Œè¿™ä¸ªæ—¶å€™å°±å¯ä»¥æ„‰å¿«çš„é€šè¿‡ä¾èµ–ä½¿ç”¨è¿™ä¸ªåº“äº†</p><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/9f9bcc30806140a9b66ade7812e415b3~tplv-k3u1fbpfcp-zoom-1.image" alt="image-20210110154334641"></p></li><li><p>åœ¨ä½ çš„Appæˆ–è€…Moduleçš„build.gradleä¸­æ·»åŠ å¦‚ä¸‹ä»£ç å°±å¯ä»¥ä½¿ç”¨äº†</p><figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs clean">dependencies &#123;<br>    <span class="hljs-keyword">implementation</span> <span class="hljs-string">&#x27;com.github.sweetying520:AndroidUtils:1.0.0&#x27;</span><br>&#125;<br></code></pre></td></tr></table></figure></li><li><p>éªŒè¯æ•ˆæœ,æˆ‘çš„Demoä¸­æ˜¯ç”¨Toastæ˜¾ç¤ºä¸€å¥â€äºŒä»£666â€</p><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/7a231167e3c042b9aa82c6540bb77b42~tplv-k3u1fbpfcp-zoom-1.image" alt="image-20210110172426166"></p></li></ol><h3 id="å…³äºåç»­ç‰ˆæœ¬æ›´æ–°"><a href="#å…³äºåç»­ç‰ˆæœ¬æ›´æ–°" class="headerlink" title="å…³äºåç»­ç‰ˆæœ¬æ›´æ–°"></a>å…³äºåç»­ç‰ˆæœ¬æ›´æ–°</h3><ol><li><p>ä¿®æ”¹moduleä¸­build.gradleçš„é…ç½®ç‰ˆæœ¬å·</p><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/0bd7f1b51c3b4876b1e21b2ef759a9f5~tplv-k3u1fbpfcp-zoom-1.image" alt="image-20210111103047291"></p></li><li><p>åœ¨ä½ çš„AndroidStudioçš„Terminalä¸­æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤:</p><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs jboss-cli"><span class="hljs-string">//</span>å¦‚æœæ˜¯Windowsç³»ç»Ÿ:<br>gradlew clean build bintrayUpload -PbintrayUser=<span class="hljs-string">&quot;Bintrayç”¨æˆ·å&quot;</span> -PbintrayKey=<span class="hljs-string">&quot;Binaryå¾—åˆ°çš„API Key&quot;</span> -PdryRun=<span class="hljs-literal">false</span><br><br>å¦‚æœæ˜¯Macç³»ç»Ÿ:<br><span class="hljs-string">./gradlew</span> clean build bintrayUpload -PbintrayUser=<span class="hljs-string">&quot;Bintrayç”¨æˆ·å&quot;</span> -PbintrayKey=<span class="hljs-string">&quot;Binaryå¾—åˆ°çš„API Key&quot;</span> -PdryRun=<span class="hljs-literal">false</span><br></code></pre></td></tr></table></figure><p>æ‰§è¡Œå®Œä¹‹å,ç­‰å¾…ä¸€æ®µæ—¶é—´,ä½ å°±å¯ä»¥å»Bintrayä¸Šçœ‹åˆ°ä½ æ›´æ–°çš„ç‰ˆæœ¬äº†</p></li></ol><h2 id="æ–¹å¼äºŒ-å‘å¸ƒAndroidåº“åˆ°JitPack"><a href="#æ–¹å¼äºŒ-å‘å¸ƒAndroidåº“åˆ°JitPack" class="headerlink" title="æ–¹å¼äºŒ: å‘å¸ƒAndroidåº“åˆ°JitPack"></a>æ–¹å¼äºŒ: å‘å¸ƒAndroidåº“åˆ°JitPack</h2><p>è¿˜æ˜¯ä»¥ä¸Šé¢è¿™ä¸ªç¼–å†™çš„åº“ä¸ºä¾‹</p><h3 id="æ­¥éª¤1ï¼šåˆ›å»ºå¥½é¡¹ç›®å¹¶ç¼–å†™Androidåº“"><a href="#æ­¥éª¤1ï¼šåˆ›å»ºå¥½é¡¹ç›®å¹¶ç¼–å†™Androidåº“" class="headerlink" title="æ­¥éª¤1ï¼šåˆ›å»ºå¥½é¡¹ç›®å¹¶ç¼–å†™Androidåº“"></a>æ­¥éª¤1ï¼šåˆ›å»ºå¥½é¡¹ç›®å¹¶ç¼–å†™Androidåº“</h3><h3 id="æ­¥éª¤2ï¼šé…ç½®ä¸Šä¼ æ’ä»¶å¹¶ä¸Šä¼ è‡³Github"><a href="#æ­¥éª¤2ï¼šé…ç½®ä¸Šä¼ æ’ä»¶å¹¶ä¸Šä¼ è‡³Github" class="headerlink" title="æ­¥éª¤2ï¼šé…ç½®ä¸Šä¼ æ’ä»¶å¹¶ä¸Šä¼ è‡³Github"></a>æ­¥éª¤2ï¼šé…ç½®ä¸Šä¼ æ’ä»¶å¹¶ä¸Šä¼ è‡³Github</h3><blockquote><p><strong>æ³¨æ„</strong></p><p>æ’ä»¶ç‰ˆæœ¬å¯ä»¥ä½¿ç”¨æœ€æ–°çš„,ä»¥å®˜ç½‘ä¸ºä¸» <a href="https://github.com/dcendents/android-maven-gradle-plugin">ä¼ é€é—¨</a></p></blockquote><ol><li><p>åœ¨ä½ moduleçš„build.gradleä¸­è¿›è¡Œå¦‚ä¸‹é…ç½®:</p><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs gradle"><span class="hljs-comment">//==============================JitPack ä¸Šä¼ æ’ä»¶é…ç½® start=====================</span><br>apply plugin: <span class="hljs-string">&#x27;com.github.dcendents.android-maven&#x27;</span><br><span class="hljs-comment">//ç»„å com.githubæ˜¯å›ºå®šçš„,åé¢çš„sweetying520æ˜¯æˆ‘Githubçš„ç”¨æˆ·å,æ›¿æ¢æˆä½ è‡ªå·±çš„å°±å¯ä»¥äº†</span><br><span class="hljs-keyword">group</span>=<span class="hljs-string">&#x27;com.github.sweetying520&#x27;</span><br><br><span class="hljs-keyword">buildscript</span> &#123;<br>    <span class="hljs-keyword">repositories</span> &#123;<br>        jcenter()<br>    &#125;<br>    <span class="hljs-keyword">dependencies</span> &#123;<br>    <span class="hljs-comment">//è¿™é‡Œæˆ‘å†™çš„æ—¶å€™æ˜¯è¿™ä¸ªç‰ˆæœ¬</span><br>        <span class="hljs-keyword">classpath</span> <span class="hljs-string">&#x27;com.github.dcendents:android-maven-gradle-plugin:2.1&#x27;</span><br>    &#125;<br>&#125;<br><span class="hljs-comment">//==============================JitPack ä¸Šä¼ æ’ä»¶é…ç½® end=======================</span><br></code></pre></td></tr></table></figure></li><li><p>å°†é¡¹ç›®ä¸Šä¼ åˆ°Github,ä¸æ‡‚å¦‚ä½•ä¸Šä¼ çš„è‡ªå·±ä¸Šç½‘æŸ¥ä¸€ä¸‹</p></li></ol><h3 id="æ­¥éª¤3ï¼šæ‰“å¼€é¡¹ç›®çš„githubä¸»é¡µï¼Œåˆ›å»ºä¸€ä¸ªReleaseæˆ–Tag"><a href="#æ­¥éª¤3ï¼šæ‰“å¼€é¡¹ç›®çš„githubä¸»é¡µï¼Œåˆ›å»ºä¸€ä¸ªReleaseæˆ–Tag" class="headerlink" title="æ­¥éª¤3ï¼šæ‰“å¼€é¡¹ç›®çš„githubä¸»é¡µï¼Œåˆ›å»ºä¸€ä¸ªReleaseæˆ–Tag"></a>æ­¥éª¤3ï¼šæ‰“å¼€é¡¹ç›®çš„githubä¸»é¡µï¼Œåˆ›å»ºä¸€ä¸ªReleaseæˆ–Tag</h3><ol><li><p>ç‚¹å‡»å¦‚ä¸‹å›¾æŒ‡ç¤º</p><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/0e4e424e448f4041a31630d2d443ad4b~tplv-k3u1fbpfcp-zoom-1.image" alt="image-20210110161833850"></p></li><li><p>åˆ›å»ºä¸€ä¸ªReleaseæˆ–è€…Tag</p><p><strong>æ³¨æ„</strong></p><ol><li><p>é¦–æ¬¡è¿›æ¥æ˜¯è¿™æ ·å­çš„</p><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/ba15384fec564aeeba00366cf859ba26~tplv-k3u1fbpfcp-zoom-1.image" alt="image-20210110162350536"></p></li><li><p>åˆ›å»ºè¿‡ç‰ˆæœ¬ä¹‹å,è¿›æ¥æ˜¯è¿™æ ·å­çš„</p><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/f26dec9bfdfc41f58c64afe51099e518~tplv-k3u1fbpfcp-zoom-1.image" alt="image-20210110162314370"></p></li><li><p>åˆ›å»ºç‰ˆæœ¬</p><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/69e5c9ee1c7e4698af2d7a6b9b69ae00~tplv-k3u1fbpfcp-zoom-1.image" alt="image-20210110163349014"></p></li></ol></li></ol><h3 id="æ­¥éª¤4-å°†é¡¹ç›®çš„ä»“åº“æäº¤åˆ°JitPack"><a href="#æ­¥éª¤4-å°†é¡¹ç›®çš„ä»“åº“æäº¤åˆ°JitPack" class="headerlink" title="æ­¥éª¤4: å°†é¡¹ç›®çš„ä»“åº“æäº¤åˆ°JitPack"></a>æ­¥éª¤4: å°†é¡¹ç›®çš„ä»“åº“æäº¤åˆ°<a href="https://jitpack.io/">JitPack</a></h3><ol><li><p>æ‰“å¼€<a href="https://jitpack.io/">JitPack</a>,å¹¶ç™»é™†(ä½¿ç”¨çš„æ˜¯ä½ çš„Githubè´¦å·ç™»é™†å³å¯)</p></li><li><p>å°†ä½ çš„é¡¹ç›®Githubåœ°å€æ”¾å…¥æœç´¢æ ,ç‚¹å‡»look up,è¿™ä¸ªæ—¶å€™å°±ä¼šè¿›è¡Œç¼–è¯‘,ç­‰å¾…ç¼–è¯‘å®Œæˆå³å¯,ä¸‹é¢çš„Versionæ˜¯æˆ‘ä¹‹å‰ç”Ÿæˆçš„ä¸€äº›ç‰ˆæœ¬</p><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/b5e669348011438485594afed1950d04~tplv-k3u1fbpfcp-zoom-1.image" alt="image-20210110165357849"></p><p>ç¼–è¯‘å®ŒæˆåJitPackä¼šè‡ªåŠ¨ç»™ä½ ç”Ÿæˆç›¸å…³çš„é…ç½®ä¿¡æ¯,æŒ‰ç…§å¦‚ä¸‹é…ç½®,é…ç½®ä½ çš„é¡¹ç›®å³å¯ </p><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/cf3b57d281cb4cc292adca3e3f3f4f08~tplv-k3u1fbpfcp-zoom-1.image" alt="image-20210110165537556"></p><p>æœ€åå°±å¯ä»¥æ„‰å¿«çš„è¿›è¡Œä½¿ç”¨äº†!!!</p></li></ol><h3 id="å…³äºåç»­ç‰ˆæœ¬æ›´æ–°-1"><a href="#å…³äºåç»­ç‰ˆæœ¬æ›´æ–°-1" class="headerlink" title="å…³äºåç»­ç‰ˆæœ¬æ›´æ–°"></a>å…³äºåç»­ç‰ˆæœ¬æ›´æ–°</h3><ol><li>å°†ä¿®æ”¹å¥½çš„ä¸œè¥¿ä¸Šä¼ åˆ°Github</li><li>æ‰“å¼€é¡¹ç›®çš„githubä¸»é¡µï¼Œåˆ›å»ºä¸€ä¸ªReleaseæˆ–Tag(è¿™ä¸ªæ­¥éª¤å°±æ˜¯é‡å¤æ­¥éª¤3)</li><li>å°†é¡¹ç›®çš„ä»“åº“æäº¤åˆ°<a href="https://jitpack.io/">JitPack</a>(è¿™ä¸ªæ­¥éª¤å°±æ˜¯é‡å¤æ­¥éª¤4)</li></ol><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>åˆ°è¿™é‡Œ,ä¸¤ç§å¼•ç”¨æ–¹å¼å°±éƒ½ä»‹ç»å®Œäº†,å¯¹æ¯”ä¸‹è¿™ä¸¤ç§ä¸Šä¼ åº“çš„æ–¹å¼:</p><p>ä¸Šä¼ åˆ°JitPack: ç®€å•,çœæ—¶,é¡¹ç›®ä¾èµ–çš„æ—¶å€™,éœ€å¼•å…¥JitPackä»“åº“</p><p>ä¸Šä¼ åˆ°JCenter: æµç¨‹ç›¸å¯¹JitPackå¤æ‚ä¸€ç‚¹,é¡¹ç›®ä¾èµ–çš„æ—¶å€™,ç›´æ¥å¼•ç”¨å³å¯,ä½†æ˜¯ä¸Šä¼ çš„è¿‡ç¨‹ä¸­å¯èƒ½ä¼šé‡åˆ°ä¸€äº›å‘,æ–‡ä¸­éƒ½å·²ç»åšäº†è¯´æ˜,å› æ­¤æŒ‰ç…§æˆ‘çš„æ­¥éª¤èµ°,åº”è¯¥å°±æ²¡å•¥é—®é¢˜</p><blockquote><p><strong>ä½ çš„ç‚¹èµï¼Œè¯„è®ºï¼Œæ˜¯å¯¹æˆ‘å·¨å¤§çš„é¼“åŠ±ï¼</strong></p><p>æ¬¢è¿å…³æ³¨æˆ‘çš„<strong>å…¬ä¼—å·ï¼š</strong>  <a href="http://m6z.cn/6jwi7b"><strong>sweetying</strong></a> ï¼Œæ–‡ç« æ›´æ–°å¯ç¬¬ä¸€æ—¶é—´æ”¶åˆ°</p><p>å¦‚æœ<strong>æœ‰é—®é¢˜</strong>ï¼Œå…¬ä¼—å·å†…æœ‰åŠ æˆ‘å¾®ä¿¡çš„å…¥å£ï¼Œåœ¨æŠ€æœ¯å­¦ä¹ ã€ä¸ªäººæˆé•¿çš„é“è·¯ä¸Šï¼Œæˆ‘ä»¬ä¸€èµ·å‰è¿›ï¼</p></blockquote>]]></content>
    
    
    <categories>
      
      <category>Android</category>
      
      <category>ä¸€ç¯‡å°±å¤Ÿ</category>
      
    </categories>
    
    
    <tags>
      
      <tag>åŸåˆ›</tag>
      
      <tag>Android</tag>
      
      <tag>ä¸€ç¯‡å°±å¤Ÿ</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Kotlin ç³»åˆ—ï¼ˆä¸‰ï¼‰ï¼šKotlinåç¨‹(ä¸Š)</title>
    <link href="/2022/10/11/Kotlin%20%E7%B3%BB%E5%88%97%EF%BC%88%E4%B8%89%EF%BC%89%EF%BC%9AKotlin%E5%8D%8F%E7%A8%8B(%E4%B8%8A)/"/>
    <url>/2022/10/11/Kotlin%20%E7%B3%BB%E5%88%97%EF%BC%88%E4%B8%89%EF%BC%89%EF%BC%9AKotlin%E5%8D%8F%E7%A8%8B(%E4%B8%8A)/</url>
    
    <content type="html"><![CDATA[<p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/b0df73f208c14ee89d6efa1043fd0a62~tplv-k3u1fbpfcp-watermark.image"></p><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>å¾ˆé«˜å…´é‡è§ä½ ~</p><p>åœ¨æœ¬ç³»åˆ—çš„ä¸Šä¸€ç¯‡ä¸­ï¼Œæˆ‘ä»¬å­¦ä¹ äº† Kotlin æ³›å‹ï¼Œä½¿ç”¨æ³›å‹èƒ½ä½¿æˆ‘ä»¬çš„ä»£ç å…·æœ‰å¯å¤ç”¨æ€§ï¼Œé¿å…ç±»å‹è½¬æ¢å¼‚å¸¸ï¼Œè¿˜æ²¡æœ‰çœ‹è¿‡ä¸Šä¸€ç¯‡æ–‡ç« çš„æœ‹å‹ï¼Œå»ºè®®å…ˆå»é˜…è¯» <a href="https://juejin.cn/post/6950042154496425992">â€œKotlinâ€ç³»åˆ—: äºŒã€Kotlinæ³›å‹</a>ã€‚æ¥ä¸‹æ¥æˆ‘ä»¬å°±è¿›å…¥ Kotlin åç¨‹çš„å­¦ä¹ ï¼Œåœ¨æˆ‘çœ‹æ¥ï¼Œ Kotlin åç¨‹ä¹Ÿæ˜¯å±äºé‚£ç§æ¯”è¾ƒéš¾ç†è§£çš„çŸ¥è¯†ç‚¹ï¼Œæˆ‘ä¼šå°½é‡ç”¨æ¯”è¾ƒé€šä¿—æ˜“æ‡‚çš„è¯­è¨€å»è¿›è¡Œè®²è§£ï¼Œå¸Œæœ›é€šè¿‡æˆ‘çš„æ–‡ç« èƒ½å¸¦é¢†å¤§å®¶æ”»å…‹ Kotlin åç¨‹</p><h2 id="é—®é¢˜"><a href="#é—®é¢˜" class="headerlink" title="é—®é¢˜"></a>é—®é¢˜</h2><p>é¦–å…ˆè¿˜æ˜¯å…ˆæŠ›å‡ºä¸€ç³»åˆ—çš„é—®é¢˜ï¼Œå¤§å®¶ææ¸…æ¥šè¿™äº›é—®é¢˜åå­¦ä¹  Kotlin åç¨‹å¯èƒ½ä¼šè½»æ¾ä¸€ç‚¹ï¼š</p><p>1ã€ä»€ä¹ˆæ˜¯å¹¶å‘ï¼Ÿä»€ä¹ˆæ˜¯å¹¶è¡Œï¼Ÿ</p><p>2ã€ä»€ä¹ˆæ˜¯å¤šä»»åŠ¡ï¼Ÿä»€ä¹ˆæ˜¯åä½œå¼å¤šä»»åŠ¡ï¼Ÿä»€ä¹ˆæ˜¯æŠ¢å å¼å¤šä»»åŠ¡ï¼Ÿ</p><p>3ã€ä»€ä¹ˆæ˜¯åŒæ­¥ï¼Ÿä»€ä¹ˆæ˜¯å¼‚æ­¥ï¼Ÿ</p><p>4ã€ä»€ä¹ˆæ˜¯éé˜»å¡å¼ï¼Ÿä»€ä¹ˆæ˜¯é˜»å¡å¼ï¼Ÿ</p><p>5ã€ä»€ä¹ˆæ˜¯æŒ‚èµ·ï¼Ÿ</p><p>6ã€ä»€ä¹ˆæ˜¯éé˜»å¡å¼æŒ‚èµ·ï¼Ÿ</p><p>7ã€ä»€ä¹ˆæ˜¯åç¨‹ï¼Ÿ</p><p>8ã€ä»€ä¹ˆæ˜¯ Kotlin åç¨‹ï¼Ÿ</p><p>9ã€Kotlin åç¨‹æœ‰ä»€ä¹ˆç”¨ï¼Ÿ</p><h3 id="1ã€ä»€ä¹ˆæ˜¯å¹¶å‘ï¼Ÿä»€ä¹ˆæ˜¯å¹¶è¡Œï¼Ÿ"><a href="#1ã€ä»€ä¹ˆæ˜¯å¹¶å‘ï¼Ÿä»€ä¹ˆæ˜¯å¹¶è¡Œï¼Ÿ" class="headerlink" title="1ã€ä»€ä¹ˆæ˜¯å¹¶å‘ï¼Ÿä»€ä¹ˆæ˜¯å¹¶è¡Œï¼Ÿ"></a>1ã€ä»€ä¹ˆæ˜¯å¹¶å‘ï¼Ÿä»€ä¹ˆæ˜¯å¹¶è¡Œï¼Ÿ</h3><p>1ï¼‰ã€å¹¶å‘å°±æ˜¯åŒä¸€æ—¶åˆ»åªæœ‰ä¸€æ¡æŒ‡ä»¤åœ¨æ‰§è¡Œï¼Œä½†æ˜¯å› ä¸º CPU æ—¶é—´ç‰‡éå¸¸çš„å°ï¼Œå¤šä¸ªæŒ‡ä»¤é—´èƒ½å¤Ÿå¿«é€Ÿçš„åˆ‡æ¢ï¼Œä½¿å¾—æˆ‘ä»¬çœ‹èµ·æ¥æ‹¥æœ‰åŒæ—¶æ‰§è¡Œçš„æ•ˆæœï¼Œå­˜åœ¨äºå•æ ¸æˆ–å¤šæ ¸ CPU ç³»ç»Ÿä¸­</p><p>2ï¼‰ã€å¹¶è¡Œå°±æ˜¯åŒä¸€æ—¶åˆ»æœ‰å¤šæ¡æŒ‡ä»¤åŒæ—¶åœ¨æ‰§è¡Œï¼Œå­˜åœ¨äºå¤šæ ¸ CPU ç³»ç»Ÿä¸­</p><p>ä¸¾ä¸ªç”Ÿæ´»ä¸­äººåƒé¦’å¤´çš„ä¾‹å­ï¼šä¸€ä¸ªäººä¹°äº† 3 ä¸ªé¦’å¤´ï¼Œé‚£ä¹ˆä»–åŒä¸€æ—¶åˆ»åªèƒ½åœ¨åƒä¸€ä¸ªé¦’å¤´ï¼Œè¿™æ˜¯å¹¶å‘ã€‚è€Œ 3 ä¸ªäººæ¯äººä¹°äº†ä¸€ä¸ªé¦’å¤´ï¼Œé‚£ä¹ˆåŒä¸€æ—¶åˆ»ä»–ä»¬èƒ½åŒæ—¶åƒé¦’å¤´ï¼Œè¿™æ˜¯å¹¶è¡Œã€‚å¹¶å‘å’Œå¹¶è¡Œçš„åŒºåˆ«åœ¨äºåŒä¸€æ—¶åˆ»æ˜¯å¦åœ¨åŒæ—¶è¿›è¡Œ</p><h3 id="2ã€ä»€ä¹ˆæ˜¯å¤šä»»åŠ¡ï¼Ÿä»€ä¹ˆæ˜¯åä½œå¼å¤šä»»åŠ¡ï¼Ÿä»€ä¹ˆæ˜¯æŠ¢å å¼å¤šä»»åŠ¡ï¼Ÿ"><a href="#2ã€ä»€ä¹ˆæ˜¯å¤šä»»åŠ¡ï¼Ÿä»€ä¹ˆæ˜¯åä½œå¼å¤šä»»åŠ¡ï¼Ÿä»€ä¹ˆæ˜¯æŠ¢å å¼å¤šä»»åŠ¡ï¼Ÿ" class="headerlink" title="2ã€ä»€ä¹ˆæ˜¯å¤šä»»åŠ¡ï¼Ÿä»€ä¹ˆæ˜¯åä½œå¼å¤šä»»åŠ¡ï¼Ÿä»€ä¹ˆæ˜¯æŠ¢å å¼å¤šä»»åŠ¡ï¼Ÿ"></a>2ã€ä»€ä¹ˆæ˜¯å¤šä»»åŠ¡ï¼Ÿä»€ä¹ˆæ˜¯åä½œå¼å¤šä»»åŠ¡ï¼Ÿä»€ä¹ˆæ˜¯æŠ¢å å¼å¤šä»»åŠ¡ï¼Ÿ</h3><p>1ï¼‰ã€å¤šä»»åŠ¡å°±æ˜¯æ“ä½œç³»ç»Ÿèƒ½å¤ŸåŒæ—¶å¤„ç†å¤šä¸ªä»»åŠ¡ï¼Œä¾‹å¦‚æˆ‘å¯ä»¥ä½¿ç”¨ç¬”è®°æœ¬ç”µè„‘æ‰“å¼€ AndroidStudio å’Œç½‘æ˜“äº‘éŸ³ä¹ï¼Œä¸€è¾¹æ’¸ç ä¸€è¾¹å¬æ­Œ</p><p>2ï¼‰ã€åä½œå¼å¤šä»»åŠ¡å°±æ˜¯ä¸€ä¸ªä»»åŠ¡å¾—åˆ°äº† CPU æ—¶é—´ï¼Œé™¤éå®ƒè‡ªå·±æ”¾å¼ƒä½¿ç”¨ CPU ï¼Œå¦åˆ™å°†å®Œå…¨éœ¸å  CPU ï¼Œæ‰€ä»¥ä»»åŠ¡ä¹‹é—´éœ€è¦åä½œï¼Œä½¿ç”¨ä¸€æ®µæ—¶é—´çš„ CPU åï¼Œæ”¾å¼ƒä½¿ç”¨ï¼Œå…¶å®ƒçš„ä»»åŠ¡ä¹Ÿå¦‚æ­¤ï¼Œæ‰èƒ½ä¿è¯ç³»ç»Ÿçš„æ­£å¸¸è¿è¡Œã€‚ä¸€èˆ¬å‡ºç°åœ¨æ—©æœŸçš„æ“ä½œç³»ç»Ÿä¸­ï¼Œå¦‚ Windows 3.1</p><p>3ï¼‰ã€æŠ¢å å¼å¤šä»»åŠ¡å°±æ˜¯ç”±æ“ä½œç³»ç»Ÿæ¥åˆ†é…æ¯ä¸ªä»»åŠ¡çš„ CPU ä½¿ç”¨æ—¶é—´ï¼Œåœ¨ä¸€ä¸ªä»»åŠ¡ä½¿ç”¨ä¸€æ®µæ—¶é—´ CPU åï¼Œæ“ä½œç³»ç»Ÿä¼šå‰¥å¤ºå½“å‰ä»»åŠ¡çš„ CPU ä½¿ç”¨æƒï¼ŒæŠŠå®ƒæ’åœ¨è¯¢é—®é˜Ÿåˆ—çš„æœ€åï¼Œå†å»è¯¢é—®ä¸‹ä¸€ä¸ªä»»åŠ¡ã€‚ä¸€èˆ¬å‡ºç°åœ¨ç°åœ¨ä½¿ç”¨çš„æ“ä½œç³»ç»Ÿï¼Œå¦‚ Window 95åŠä¹‹åçš„ Windows ç‰ˆæœ¬</p><p>åä½œå¼å¤šä»»åŠ¡å’ŒæŠ¢å å¼å¤šä»»åŠ¡åŒºåˆ«ï¼šåœ¨åä½œå¼å¤šä»»åŠ¡ä¸­ï¼Œå¦‚æœä¸€ä¸ªä»»åŠ¡æ­»é”ï¼Œåˆ™ç³»ç»Ÿä¹Ÿä¼šæ­»é”ã€‚è€ŒæŠ¢å å¼å¤šä»»åŠ¡ä¸­ï¼Œå¦‚æœä¸€ä¸ªä»»åŠ¡æ­»é”ï¼Œç³»ç»Ÿä»èƒ½æ­£å¸¸è¿è¡Œ</p><h3 id="3ã€ä»€ä¹ˆæ˜¯åŒæ­¥ï¼Ÿä»€ä¹ˆæ˜¯å¼‚æ­¥ï¼Ÿ"><a href="#3ã€ä»€ä¹ˆæ˜¯åŒæ­¥ï¼Ÿä»€ä¹ˆæ˜¯å¼‚æ­¥ï¼Ÿ" class="headerlink" title="3ã€ä»€ä¹ˆæ˜¯åŒæ­¥ï¼Ÿä»€ä¹ˆæ˜¯å¼‚æ­¥ï¼Ÿ"></a>3ã€ä»€ä¹ˆæ˜¯åŒæ­¥ï¼Ÿä»€ä¹ˆæ˜¯å¼‚æ­¥ï¼Ÿ</h3><p>è®¡ç®—æœºé¢†åŸŸä¸­çš„åŒæ­¥å’Œå¼‚æ­¥å’Œæˆ‘ä»¬å¹³æ—¶ç”Ÿæ´»ä¸­çš„åŒæ­¥å’Œå¼‚æ­¥æ˜¯ä¸ä¸€æ ·çš„ï¼Œè¿™å°±è®©å¾ˆå¤šäººéš¾ä»¥ç†è§£</p><p>1ï¼‰ã€è®¡ç®—æœºé¢†åŸŸä¸­çš„åŒæ­¥å°±æ˜¯å½“è°ƒç”¨è€…å‘é€ä¸€ä¸ªè°ƒç”¨æŒ‡ä»¤ï¼Œéœ€ç­‰å¾…è¯¥æŒ‡ä»¤æ‰§è¡Œå®Œï¼Œåœ¨ç»§ç»­å¾€ä¸‹æ‰§è¡Œï¼Œæ˜¯ä¸€ç§ä¸²è¡Œçš„å¤„ç†æ–¹å¼</p><p>2ï¼‰ã€è®¡ç®—æœºé¢†åŸŸä¸­çš„å¼‚æ­¥å°±æ˜¯å½“è°ƒç”¨è€…å‘é€ä¸€ä¸ªè°ƒç”¨æŒ‡ä»¤ï¼Œæ— éœ€ç­‰å¾…è¯¥æŒ‡ä»¤æ‰§è¡Œå®Œï¼Œç»§ç»­å¾€ä¸‹æ‰§è¡Œï¼Œæ˜¯ä¸€ç§å¹¶è¡Œçš„å¤„ç†æ–¹å¼</p><h3 id="4ã€ä»€ä¹ˆæ˜¯é˜»å¡ï¼Ÿä»€ä¹ˆæ˜¯éé˜»å¡ï¼Ÿ"><a href="#4ã€ä»€ä¹ˆæ˜¯é˜»å¡ï¼Ÿä»€ä¹ˆæ˜¯éé˜»å¡ï¼Ÿ" class="headerlink" title="4ã€ä»€ä¹ˆæ˜¯é˜»å¡ï¼Ÿä»€ä¹ˆæ˜¯éé˜»å¡ï¼Ÿ"></a>4ã€ä»€ä¹ˆæ˜¯é˜»å¡ï¼Ÿä»€ä¹ˆæ˜¯éé˜»å¡ï¼Ÿ</h3><p>é˜»å¡å¾ˆç®€å•ï¼Œå°±æ˜¯å­—é¢æ„æ€ï¼Œåœ¨ Android ä¸­çš„ä½“ç°ï¼Œå…¶å®å°±æ˜¯é˜»å¡äº†ä¸»çº¿ç¨‹çš„è¿è¡Œï¼Œé‚£ä¹ˆéé˜»å¡å°±æ˜¯æ²¡æœ‰å¡ä½ä¸»çº¿ç¨‹çš„è¿è¡Œ</p><h3 id="5ã€ä»€ä¹ˆæ˜¯æŒ‚èµ·ï¼Ÿ"><a href="#5ã€ä»€ä¹ˆæ˜¯æŒ‚èµ·ï¼Ÿ" class="headerlink" title="5ã€ä»€ä¹ˆæ˜¯æŒ‚èµ·ï¼Ÿ"></a>5ã€ä»€ä¹ˆæ˜¯æŒ‚èµ·ï¼Ÿ</h3><p>æŒ‚èµ·å°±æ˜¯ä¿å­˜å½“å‰çŠ¶æ€ï¼Œç­‰å¾…æ¢å¤æ‰§è¡Œï¼Œåœ¨ Android ä¸­çš„ä½“ç°ï¼ŒæŒ‚èµ·å°±æ˜¯ä¸å½±å“ä¸»çº¿ç¨‹çš„å·¥ä½œï¼Œæ›´è´´åˆ‡çš„è¯´æ³•å¯ä»¥ç†è§£ä¸ºåˆ‡æ¢åˆ°äº†ä¸€ä¸ªæŒ‡å®šçš„çº¿ç¨‹ï¼Œ</p><h3 id="6ã€ä»€ä¹ˆæ˜¯éé˜»å¡å¼æŒ‚èµ·ï¼Ÿ"><a href="#6ã€ä»€ä¹ˆæ˜¯éé˜»å¡å¼æŒ‚èµ·ï¼Ÿ" class="headerlink" title="6ã€ä»€ä¹ˆæ˜¯éé˜»å¡å¼æŒ‚èµ·ï¼Ÿ"></a>6ã€ä»€ä¹ˆæ˜¯éé˜»å¡å¼æŒ‚èµ·ï¼Ÿ</h3><p>é€šè¿‡ä¸Šé¢æ¦‚å¿µçš„è§£é‡Šï¼Œéé˜»å¡å¼æŒ‚èµ·å°±æ˜¯ä¸ä¼šå¡ä½ä¸»çº¿ç¨‹ä¸”å°†ç¨‹åºåˆ‡æ¢åˆ°å¦å¤–ä¸€ä¸ªæŒ‡å®šçš„çº¿ç¨‹å»æ‰§è¡Œ</p><h3 id="7ã€ä»€ä¹ˆæ˜¯åç¨‹ï¼Ÿ"><a href="#7ã€ä»€ä¹ˆæ˜¯åç¨‹ï¼Ÿ" class="headerlink" title="7ã€ä»€ä¹ˆæ˜¯åç¨‹ï¼Ÿ"></a>7ã€ä»€ä¹ˆæ˜¯åç¨‹ï¼Ÿ</h3><p>åç¨‹ï¼Œè‹±æ–‡å Coroutineï¼Œæºè‡ª Simula å’Œ Modula-2 è¯­è¨€ï¼Œå®ƒæ˜¯ä¸€ç§åä½œå¼å¤šä»»åŠ¡å®ç°ï¼Œæ˜¯ä¸€ç§ç¼–ç¨‹æ€æƒ³ï¼Œå¹¶ä¸å±€é™äºç‰¹å®šçš„è¯­è¨€ã€‚åç¨‹è®¾è®¡çš„åˆè¡·æ˜¯ä¸ºäº†è§£å†³å¹¶å‘é—®é¢˜ï¼Œè®©åä½œå¼å¤šä»»åŠ¡å®ç°èµ·æ¥æ›´åŠ æ–¹ä¾¿</p><h3 id="8ã€ä»€ä¹ˆæ˜¯-Kotlin-åç¨‹ï¼Ÿ"><a href="#8ã€ä»€ä¹ˆæ˜¯-Kotlin-åç¨‹ï¼Ÿ" class="headerlink" title="8ã€ä»€ä¹ˆæ˜¯ Kotlin åç¨‹ï¼Ÿ"></a>8ã€ä»€ä¹ˆæ˜¯ Kotlin åç¨‹ï¼Ÿ</h3><p>Kotlin åç¨‹ç®€å•æ¥è¯´æ˜¯ä¸€å¥—çº¿ç¨‹æ“ä½œæ¡†æ¶ï¼Œè¯¦ç»†ç‚¹è¯´å®ƒå°±æ˜¯ä¸€å¥—åŸºäºçº¿ç¨‹è€Œå®ç°çš„ä¸€å¥—æ›´ä¸Šå±‚çš„å·¥å…· APIï¼Œç±»ä¼¼äº Java çš„çº¿ç¨‹æ± ï¼Œä½ å¯ä»¥ç†è§£ Kotlin æ–°é€ äº†ä¸€äº›æ¦‚å¿µç”¨æ¥å¸®åŠ©ä½ æ›´å¥½åœ°ä½¿ç”¨è¿™äº› APIï¼Œä»…æ­¤è€Œå·²</p><h3 id="9ã€Kotlin-åç¨‹æœ‰ä»€ä¹ˆç”¨ï¼Ÿ"><a href="#9ã€Kotlin-åç¨‹æœ‰ä»€ä¹ˆç”¨ï¼Ÿ" class="headerlink" title="9ã€Kotlin åç¨‹æœ‰ä»€ä¹ˆç”¨ï¼Ÿ"></a>9ã€Kotlin åç¨‹æœ‰ä»€ä¹ˆç”¨ï¼Ÿ</h3><p>1ï¼‰ã€Kotlin åç¨‹å¯ä»¥ç”¨çœ‹èµ·æ¥åŒæ­¥çš„æ–¹å¼å†™å‡ºå¼‚æ­¥çš„ä»£ç ï¼Œå¸®ä½ ä¼˜é›…çš„å¤„ç†å›è°ƒåœ°ç‹±</p><p>æ¸…æ¥šäº†ä¸Šé¢è¿™äº›é—®é¢˜åï¼Œæˆ‘ä»¬æ¥ç€å¾€ä¸‹çœ‹</p><h2 id="ä¸€ã€Kotlin-åç¨‹ç”Ÿæ€å’Œä¾èµ–åº“"><a href="#ä¸€ã€Kotlin-åç¨‹ç”Ÿæ€å’Œä¾èµ–åº“" class="headerlink" title="ä¸€ã€Kotlin åç¨‹ç”Ÿæ€å’Œä¾èµ–åº“"></a>ä¸€ã€Kotlin åç¨‹ç”Ÿæ€å’Œä¾èµ–åº“</h2><p>Kotlin å¹¶æ²¡æœ‰æŠŠåç¨‹çº³å…¥æ ‡å‡†åº“ä¸­ï¼Œè€Œæ˜¯ä»¥ä¾èµ–åº“çš„å½¢å¼æä¾›çš„ï¼Œè¿™æ˜¯ä¸€å¼  Kotlin åç¨‹çš„ç”Ÿæ€å›¾ï¼š</p><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/fe3aab023ec74ca0a90d06f6f37bdebe~tplv-k3u1fbpfcp-zoom-1.image" alt="image-20210414204413591"></p><p>ä»ä¸Šå›¾æˆ‘ä»¬å¯ä»¥å¾ˆæ¸…æ™°çš„çœ‹åˆ°ï¼ŒKotlin æ ‡å‡†åº“å’Œåç¨‹ä¾èµ–åº“æ‰€æä¾›çš„ä¸œè¥¿ï¼Œåœ¨æˆ‘ä»¬åˆ›å»ºä¸€ä¸ª Kotlin é¡¹ç›®çš„æ—¶å€™ï¼Œé»˜è®¤ä¼šå¯¼å…¥æ ‡å‡†åº“çš„ä¾èµ–ï¼Œå› æ­¤è¿™é‡Œæ·»åŠ å¦‚ä¸‹åç¨‹ä¾èµ–åº“å°±å¯ä»¥äº†ï¼Œæœ€æ–°åç¨‹ä¾èµ–åº“ç‰ˆæœ¬å¯ä»¥ç‚¹å‡»<a href="https://github.com/Kotlin/kotlinx.coroutines">ä¼ é€é—¨</a>æŸ¥çœ‹ï¼š</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-comment">//åç¨‹æ ¸å¿ƒåº“</span><br>implementation <span class="hljs-string">&#x27;org.jetbrains.kotlinx:kotlinx-coroutines-core:1.4.3&#x27;</span><br><span class="hljs-comment">//è¿™ä¸ªåº“åœ¨ Android é¡¹ç›®ä¸­æ‰ä¼šç”¨åˆ°</span><br>implementation <span class="hljs-string">&#x27;org.jetbrains.kotlinx:kotlinx-coroutines-android:1.4.3&#x27;</span><br></code></pre></td></tr></table></figure><h2 id="äºŒã€ä½¿ç”¨-GlobalScope-launch-å‡½æ•°åˆ›å»ºä½ çš„ç¬¬ä¸€ä¸ªåç¨‹"><a href="#äºŒã€ä½¿ç”¨-GlobalScope-launch-å‡½æ•°åˆ›å»ºä½ çš„ç¬¬ä¸€ä¸ªåç¨‹" class="headerlink" title="äºŒã€ä½¿ç”¨ GlobalScope.launch å‡½æ•°åˆ›å»ºä½ çš„ç¬¬ä¸€ä¸ªåç¨‹"></a>äºŒã€ä½¿ç”¨ GlobalScope.launch å‡½æ•°åˆ›å»ºä½ çš„ç¬¬ä¸€ä¸ªåç¨‹</h2><ul><li>GlobalScope.launch å‡½æ•°å¯ä»¥åˆ›å»ºä¸€ä¸ªåç¨‹ä½œç”¨åŸŸï¼Œè¿™æ ·ä¼ é€’ç»™ launch å‡½æ•°çš„ä»£ç å—å°±æ˜¯åœ¨åç¨‹ä¸­è¿è¡Œäº†</li><li>GlobalScope.launch å‡½æ•°åˆ›å»ºçš„æ˜¯ä¸€ä¸ªé¡¶çº§åç¨‹ï¼Œå½“åº”ç”¨ç¨‹åºè¿è¡Œç»“æŸæ—¶ä¹Ÿä¼šè·Ÿç€ä¸€èµ·ç»“æŸ</li><li>GlobalScope.launch å‡½æ•°åˆ›å»ºçš„åç¨‹å’Œçº¿ç¨‹æœ‰ç‚¹åƒï¼Œå› ä¸ºçº¿ç¨‹æ²¡æœ‰é¡¶çº§è¿™ä¸€è¯´ï¼Œæ‰€ä»¥æ°¸è¿œéƒ½æ˜¯é¡¶çº§çš„</li></ul><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>    GlobalScope.launch &#123;<br>        println(<span class="hljs-string">&quot;codes run in coroutine scope&quot;</span>)<br>    &#125;  <br>&#125;<br></code></pre></td></tr></table></figure><p>ä¸Šé¢è¿™æ®µç®€çŸ­çš„ä»£ç å°±æ˜¯å¼€å¯äº†ä¸€ä¸ªåç¨‹ï¼Œå¾ˆç®€å•å§ï¼Œä¸€è¡Œä»£ç å°±å®ç°äº†ï¼Œåç¨‹ä¹Ÿä¸è¿‡å¦‚æ­¤å•ŠğŸ˜‚ã€‚å®é™…ä¸‹é¢è¿™æ®µä»£ç èƒŒååŒ…å«ç€æˆå¨çš„çŸ¥è¯†ç‚¹ï¼š</p><p>1ã€åç¨‹ä½œç”¨åŸŸ</p><p>2ã€åç¨‹ä½œç”¨åŸŸçš„æ‰©å±•å‡½æ•°</p><p>3ã€åç¨‹ä¸Šä¸‹æ–‡</p><p>4ã€åç¨‹å¯åŠ¨æ¨¡å¼</p><p>å¯èƒ½å¤§å®¶ä¼šæœ‰ç‚¹ç–‘æƒ‘ï¼ŒåŒºåŒºä¸€è¡Œä»£ç ï¼Œæ€ä¹ˆå¯èƒ½ä¼šæ¶‰åŠè¿™ä¹ˆå¤šä¸œè¥¿ï¼Ÿä¸ä¿¡æˆ‘ä»¬åœ¨ç‚¹å‡» launch å‡½æ•°çœ‹ä¸‹å®ƒçš„æºç ï¼š</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-comment">// launch å‡½æ•°æºç </span><br><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> CoroutineScope.<span class="hljs-title">launch</span><span class="hljs-params">(</span></span><br><span class="hljs-params"><span class="hljs-function">    context: <span class="hljs-type">CoroutineContext</span> = EmptyCoroutineContext,</span></span><br><span class="hljs-params"><span class="hljs-function">    start: <span class="hljs-type">CoroutineStart</span> = CoroutineStart.DEFAULT,</span></span><br><span class="hljs-params"><span class="hljs-function">    block: <span class="hljs-type">suspend</span> <span class="hljs-type">CoroutineScope</span>.() -&gt; <span class="hljs-type">Unit</span></span></span><br><span class="hljs-params"><span class="hljs-function">)</span></span>: Job &#123;<br>  <span class="hljs-comment">//...</span><br>&#125;<br></code></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ï¼Œlaunch å‡½æ•°æ˜¯ CoroutineScope å³åç¨‹ä½œç”¨åŸŸçš„ä¸€ä¸ªæ‰©å±•å‡½æ•°ï¼Œå®ƒé‡Œé¢æœ‰ä¸‰ä¸ªå‚æ•°ï¼šç¬¬ä¸€ä¸ªå‚æ•°ï¼š CoroutineContext å³åç¨‹ä¸Šä¸‹æ–‡ï¼Œæœ‰é»˜è®¤å€¼ã€‚ç¬¬äºŒä¸ªå‚æ•°ï¼š CoroutineStart å³åç¨‹å¯åŠ¨æ¨¡å¼ï¼Œæœ‰é»˜è®¤å€¼ã€‚ç¬¬ä¸‰ä¸ªå‚æ•°ï¼šå‡½æ•°ç±»å‹å‚æ•°ï¼Œæ— é»˜è®¤å€¼ã€‚å› æ­¤ launch å‡½æ•°åœ¨å®é™…è°ƒç”¨çš„æ—¶å€™ï¼Œåªéœ€è¦ä¼ å…¥ä¸€ä¸ª Lambda è¡¨è¾¾å¼å°±å¯ä»¥äº†ï¼Œå½“ç„¶ä½ ä¹Ÿå¯ä»¥ä¼ å‚å»è¦†ç›–é»˜è®¤å€¼</p><p>å¥½äº†ï¼ŒçŸ¥é“å®ƒé‡Œé¢æ¶‰åŠåˆ°è¿™ä¹ˆå¤šçŸ¥è¯†ç‚¹ï¼Œç°åœ¨æˆ‘ä»¬æ¥è¿›è¡Œå„ä¸ªå‡»ç ´ï¼Œä¸‹é¢æˆ‘ä¼šè®²è§£åç¨‹ä½œç”¨åŸŸï¼Œå…¶ä»–çš„åœ¨è¿™ç¯‡æ–‡ç« åˆ†æå¯èƒ½æœ‰ç‚¹æ¯ç‡¥ï¼Œæˆ‘ä»¬æ”¾åˆ°ä¸‹ç¯‡æ–‡ç« åœ¨æ¥åˆ†æ</p><h2 id="ä¸‰ã€åç¨‹ä½œç”¨åŸŸ"><a href="#ä¸‰ã€åç¨‹ä½œç”¨åŸŸ" class="headerlink" title="ä¸‰ã€åç¨‹ä½œç”¨åŸŸ"></a>ä¸‰ã€åç¨‹ä½œç”¨åŸŸ</h2><p>å›åˆ°æœ€å¼€å§‹é‚£æ®µä»£ç ï¼Œé¦–å…ˆæˆ‘ä»¬çœ‹åˆ° GlobalScope è¿™ä¸ªä¸œä¸œï¼Œç‚¹è¿›å»çœ‹ä¸€çœ¼å®ƒçš„æºç ï¼š</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-keyword">public</span> <span class="hljs-keyword">object</span> GlobalScope : CoroutineScope &#123;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * Returns [EmptyCoroutineContext].</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">override</span> <span class="hljs-keyword">val</span> coroutineContext: CoroutineContext<br>        <span class="hljs-keyword">get</span>() = EmptyCoroutineContext<br>&#125;<br></code></pre></td></tr></table></figure><p>ä¸Šè¿°ä»£ç æˆ‘ä»¬å¯ä»¥çŸ¥é“ï¼šGlobalScope æ˜¯ä¸€ä¸ªå•ä¾‹ç±»ï¼Œå®ç°äº† CoroutineScope è¿™ä¸ªä¸œä¸œï¼Œå¹¶é‡å†™äº† coroutineContext è¿™ä¸ªå±æ€§</p><h3 id="1ã€CoroutineScope"><a href="#1ã€CoroutineScope" class="headerlink" title="1ã€CoroutineScope"></a>1ã€CoroutineScope</h3><p>æ¥ç€ç‚¹è¿›å» CoroutineScope è¿™ä¸ªä¸œä¸œçœ‹ä¸€ä¸‹ï¼š</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">CoroutineScope</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">val</span> coroutineContext: CoroutineContext<br>&#125;<br></code></pre></td></tr></table></figure><p>1ï¼‰ã€æºç é‡Œé¢æœ‰ä¸€æ®µå¯¹å®ƒçš„æ³¨é‡Šï¼Œç¿»è¯‘è¿‡æ¥å¤§è‡´å°±æ˜¯ï¼šCoroutineScope èƒ½å¤Ÿå®šä¹‰ä¸€ä¸ªåç¨‹ä½œç”¨åŸŸï¼Œæ¯ä¸ªåç¨‹æ„å»ºå™¨åƒ launch, async éƒ½æ˜¯å®ƒçš„ä¸€ä¸ªæ‰©å±•ã€‚</p><p>2ï¼‰ã€å®ƒæ˜¯ä¸€ä¸ªæ¥å£ï¼Œé‡Œé¢æŒæœ‰ä¸€ä¸ª CoroutineContext å³åç¨‹ä¸Šä¸‹æ–‡ï¼Œæˆ‘ä»¬å¯ä»¥è®©ç±»å®ç°å®ƒï¼Œè®©è¯¥ç±»æˆä¸ºä¸€ä¸ªåç¨‹ä½œç”¨åŸŸ</p><h3 id="2ã€GlobalScope"><a href="#2ã€GlobalScope" class="headerlink" title="2ã€GlobalScope"></a>2ã€GlobalScope</h3><p>ç°åœ¨å›åˆ° GlobalScope è¿™ä¸ªä¸œä¸œï¼Œæˆ‘ä»¬åº”è¯¥å¯ä»¥æŠŠå®ƒè§£é‡Šæ¸…æ¥šäº†ï¼šå› ä¸º GlobalScope æ˜¯ä¸€ä¸ªå•ä¾‹ç±»ï¼Œä¸”å®ç°äº†CoroutineScopeï¼Œæ‰€æœ‰å®ƒæ‹¥æœ‰äº†å…¨å±€çš„åç¨‹ä½œç”¨åŸŸï¼Œä¸”åœ¨æ•´ä¸ª JVM è™šæ‹Ÿæœºä¸­åªæœ‰ä¸€ä»½å¯¹è±¡å®ä¾‹ã€‚å› ä¸ºå®ƒçš„ç”Ÿå‘½å‘¨æœŸè´¯ç©¿æ•´ä¸ª JVMï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨ä½¿ç”¨å®ƒçš„æ—¶å€™éœ€è¦è­¦æƒ•å†…å­˜æ³„æ¼ã€‚ä¸Šé¢ä»£ç ä¸­è°ƒç”¨çš„ GlobalScope.launchï¼Œå®è´¨ä¸Šæ˜¯è°ƒç”¨äº† CoroutineScope çš„ launch æ‰©å±•å‡½æ•°</p><h3 id="3ã€åç¨‹ä½œç”¨åŸŸä½œç”¨"><a href="#3ã€åç¨‹ä½œç”¨åŸŸä½œç”¨" class="headerlink" title="3ã€åç¨‹ä½œç”¨åŸŸä½œç”¨"></a>3ã€åç¨‹ä½œç”¨åŸŸä½œç”¨</h3><p>é‚£ä¹ˆè¿™é‡Œä½ å¿ƒé‡Œæ˜¯å¦ä¼šæœ‰ä¸ªç–‘é—®ï¼šæ‹¥æœ‰åç¨‹ä½œç”¨åŸŸæœ‰å•¥ç”¨å‘¢ï¼Ÿä½œç”¨å¯å¤§äº†</p><blockquote><p><strong>åç¨‹å¿…é¡»åœ¨åç¨‹ä½œç”¨åŸŸä¸­æ‰èƒ½å¯åŠ¨ï¼Œåç¨‹ä½œç”¨åŸŸä¸­å®šä¹‰äº†ä¸€äº›çˆ¶å­åç¨‹çš„è§„åˆ™ï¼ŒKotlin åç¨‹é€šè¿‡åç¨‹ä½œç”¨åŸŸæ¥ç®¡æ§åŸŸä¸­çš„æ‰€æœ‰åç¨‹</strong></p></blockquote><p>åç¨‹ä½œç”¨åŸŸé—´å¯å¹¶åˆ—æˆ–åŒ…å«ï¼Œç»„æˆä¸€ä¸ªæ ‘çŠ¶ç»“æ„ï¼Œè¿™å°±æ˜¯ Kotlin åç¨‹ä¸­çš„<strong>ç»“æ„åŒ–å¹¶å‘</strong>ï¼Œè§„åˆ™å¦‚ä¸‹ï¼š</p><h3 id="4ã€ä½œç”¨åŸŸç»†åˆ†"><a href="#4ã€ä½œç”¨åŸŸç»†åˆ†" class="headerlink" title="4ã€ä½œç”¨åŸŸç»†åˆ†"></a>4ã€ä½œç”¨åŸŸç»†åˆ†</h3><p>æœ‰ä¸‹è¿°ä¸‰ç§ï¼š</p><p>1ï¼‰ã€<strong>é¡¶çº§ä½œç”¨åŸŸ</strong>ï¼šæ²¡æœ‰çˆ¶åç¨‹çš„åç¨‹æ‰€åœ¨çš„ä½œç”¨åŸŸ</p><p>2ï¼‰ã€<strong>ååŒä½œç”¨åŸŸ</strong>ï¼šåç¨‹ä¸­å¯åŠ¨æ–°åç¨‹(å³å­åç¨‹)ï¼Œæ­¤æ—¶å­åç¨‹æ‰€åœ¨çš„ä½œç”¨åŸŸé»˜è®¤ä¸ºååŒä½œç”¨åŸŸï¼Œå­åç¨‹æŠ›å‡ºçš„æœªæ•è·å¼‚å¸¸éƒ½å°†ä¼ é€’ç»™çˆ¶åç¨‹å¤„ç†ï¼Œçˆ¶åç¨‹åŒæ—¶ä¹Ÿä¼šè¢«å–æ¶ˆï¼›</p><p>3ï¼‰ã€<strong>ä¸»ä»ä½œç”¨åŸŸ</strong>ï¼šä¸ååŒä½œç”¨åŸŸçˆ¶å­å…³ç³»ä¸€è‡´ï¼ŒåŒºåˆ«åœ¨äºå­åç¨‹å‡ºç°æœªæ•è·å¼‚å¸¸æ—¶ä¸ä¼šå‘ä¸Šä¼ é€’ç»™çˆ¶åç¨‹</p><h3 id="5ã€çˆ¶å­åç¨‹é—´çš„è§„åˆ™"><a href="#5ã€çˆ¶å­åç¨‹é—´çš„è§„åˆ™" class="headerlink" title="5ã€çˆ¶å­åç¨‹é—´çš„è§„åˆ™"></a>5ã€çˆ¶å­åç¨‹é—´çš„è§„åˆ™</h3><p>1ï¼‰ã€çˆ¶åç¨‹å¦‚æœå–æ¶ˆæˆ–ç»“æŸäº†ï¼Œé‚£ä¹ˆå®ƒä¸‹é¢çš„æ‰€æœ‰å­åç¨‹å‡è¢«å–æ¶ˆæˆ–ç»“æŸ</p><p>2ï¼‰ã€çˆ¶åç¨‹éœ€ç­‰å¾…å­åç¨‹æ‰§è¡Œå®Œæ¯•åæ‰ä¼šæœ€ç»ˆè¿›å…¥å®ŒæˆçŠ¶æ€ï¼Œè€Œä¸ç®¡çˆ¶åç¨‹æœ¬èº«çš„ä»£ç å—æ˜¯å¦å·²æ‰§è¡Œå®Œ</p><p>3ï¼‰ã€å­åç¨‹ä¼šç»§æ‰¿çˆ¶åç¨‹ä¸Šä¸‹æ–‡ä¸­çš„å…ƒç´ ï¼Œå¦‚æœè‡ªèº«æœ‰ç›¸åŒ Key çš„æˆå‘˜ï¼Œåˆ™è¦†ç›–å¯¹åº” Keyï¼Œè¦†ç›–æ•ˆæœä»…åœ¨è‡ªèº«èŒƒå›´å†…æœ‰æ•ˆ</p><p>å¥½äº†ï¼Œåˆ°äº†è¿™é‡Œå…³äºåç¨‹ä½œç”¨åŸŸä½ æ˜¯å¦ç†è§£äº†å‘¢ï¼Ÿå¦‚æœä¸æ˜ç™½ï¼Œæ¥ç€å¾€ä¸‹çœ‹ï¼Œæˆ–è®¸éšç€å­¦ä¹ çš„æ·±å…¥ï¼Œä½ çš„é—®é¢˜å°±å¼•åˆƒè€Œè§£äº†</p><h2 id="å››ã€ä½¿ç”¨-Delay-å‡½æ•°å»¶è¿Ÿåç¨‹æ‰§è¡Œ"><a href="#å››ã€ä½¿ç”¨-Delay-å‡½æ•°å»¶è¿Ÿåç¨‹æ‰§è¡Œ" class="headerlink" title="å››ã€ä½¿ç”¨ Delay å‡½æ•°å»¶è¿Ÿåç¨‹æ‰§è¡Œ"></a>å››ã€ä½¿ç”¨ Delay å‡½æ•°å»¶è¿Ÿåç¨‹æ‰§è¡Œ</h2><ul><li><p>delay å‡½æ•°æ˜¯ä¸€ä¸ªéé˜»å¡å¼æŒ‚èµ·å‡½æ•°ï¼Œå®ƒå¯ä»¥è®©å½“å‰åç¨‹å»¶è¿Ÿåˆ°æŒ‡å®šçš„æ—¶é—´æ‰§è¡Œï¼Œä¸”åªèƒ½åœ¨åç¨‹çš„ä½œç”¨åŸŸæˆ–è€…å…¶ä»–æŒ‚èµ·å‡½æ•°ä¸­è°ƒç”¨</p></li><li><p>å¯¹æ¯” Thread.sleep() å‡½æ•°ï¼Œdelay å‡½æ•°åªä¼šæŒ‚èµ·å½“å‰åç¨‹ï¼Œå¹¶ä¸ä¼šå½±å“å…¶ä»–åç¨‹çš„è¿è¡Œï¼Œè€Œ Thread.sleep() å‡½æ•°ä¼šé˜»å¡å½“å‰çº¿ç¨‹ï¼Œé‚£ä¹ˆè¯¥çº¿ç¨‹ä¸‹çš„æ‰€æœ‰åç¨‹éƒ½ä¼šè¢«é˜»å¡</p></li></ul><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>    GlobalScope.launch &#123;<br>        println(<span class="hljs-string">&quot;codes run in coroutine scope&quot;</span>)<br>    &#125;  <br>&#125;<br></code></pre></td></tr></table></figure><p>ä¸Šè¿°ä»£ç ä½ è¿è¡Œä¸€ä¸‹ä¼šå‘ç°æ—¥å¿—æ‰“å°ä¸å‡ºæ¥ï¼Œå°æœ‹å‹ï¼Œä½ æ˜¯å¦æœ‰å¾ˆå¤šé—®å·ï¼ŸğŸ˜‚</p><p>è¿™æ˜¯å› ä¸ºä»£ç å—ä¸­çš„ä»£ç è¿˜æ²¡æ¥å¾—åŠæ‰§è¡Œï¼Œåº”ç”¨ç¨‹åºå°±ç»“æŸäº†ï¼Œè¦è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥è®©ç¨‹åºå»¶è¿Ÿä¸€æ®µæ—¶é—´åœ¨ç»“æŸï¼Œå¦‚ä¸‹ï¼š</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>    GlobalScope.launch &#123;<br>        println(<span class="hljs-string">&quot;codes run in coroutine scope&quot;</span>)<br>    &#125;  <br>    Thread.sleep(<span class="hljs-number">1000</span>)<br>&#125;<br><span class="hljs-comment">//æ‰“å°ç»“æœ</span><br>codes run <span class="hljs-keyword">in</span> coroutine scope<br></code></pre></td></tr></table></figure><p>ä¸Šè¿°ä»£ç æˆ‘ä»¬è®©ä¸»çº¿ç¨‹é˜»å¡äº† 1 ç§’é’Ÿåœ¨æ‰§è¡Œï¼Œå› æ­¤ä»£ç å—ä¸­çš„ä»£ç å¾—åˆ°äº†æ‰§è¡Œã€‚å…¶å®è¿™ç§å†™æ³•è¿˜æ˜¯å­˜åœ¨ä¸€ç‚¹é—®é¢˜ï¼Œå¦‚æœæˆ‘è®©ä»£ç å—ä¸­çš„ä»£ç åœ¨ 1 ç§’é’Ÿå†…ä¸èƒ½è¿è¡Œç»“æŸï¼Œé‚£ä¹ˆå°±ä¼šè¢«å¼ºåˆ¶ä¸­æ–­ï¼š</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>    GlobalScope.launch &#123;<br>        println(<span class="hljs-string">&quot;codes run in coroutine scope&quot;</span>)<br>      delay(<span class="hljs-number">1500</span>)<br>        println(<span class="hljs-string">&quot;codes run in coroutine scope finished&quot;</span>)<br>    &#125;  <br>    Thread.sleep(<span class="hljs-number">1000</span>)<br>&#125;<br><span class="hljs-comment">//æ‰“å°ç»“æœ</span><br>codes run <span class="hljs-keyword">in</span> coroutine scope<br></code></pre></td></tr></table></figure><p>ä¸Šè¿°ä»£ç æˆ‘ä»¬åœ¨ä»£ç å—ä¸­åŠ å…¥äº†ä¸€ä¸ª delay å‡½æ•°ï¼Œå¹¶åœ¨å…¶ä¹‹ååˆæ‰“å°äº†ä¸€è¡Œæ—¥å¿—ã€‚é‚£ä¹ˆå½“å‰åç¨‹ä¼šæŒ‚èµ· 1.5 ç§’ï¼Œè€Œä¸»çº¿ç¨‹å´åªé˜»å¡äº† 1 ç§’ï¼Œé‚£ä¹ˆé‡æ–°è¿è¡Œä¸€ä¸‹ç¨‹åºï¼Œæ–°å¢çš„è¿™æ¡æ—¥å¿—å¹¶æ²¡æœ‰æ‰“å°å‡ºæ¥ï¼Œå› ä¸ºå®ƒè¿˜æ²¡æ¥å¾—åŠè¿è¡Œï¼Œç¨‹åºå°±ç»“æŸäº†ã€‚</p><p>é‚£æœ‰åŠæ³•è®©åç¨‹ä¸­æ‰€æœ‰çš„ä»£ç éƒ½æ‰§è¡Œå®Œäº†ä¹‹ååœ¨ç»“æŸå—ï¼ŸğŸ¤”ï¸</p><p>ç­”ï¼šæœ‰çš„ï¼Œä½¿ç”¨ runBlocking å‡½æ•°</p><h2 id="äº”ã€ä½¿ç”¨-runBlocking-å‡½æ•°åˆ›å»ºä¸€ä¸ªèƒ½é˜»å¡å½“å‰çº¿ç¨‹çš„åç¨‹ä½œç”¨åŸŸ"><a href="#äº”ã€ä½¿ç”¨-runBlocking-å‡½æ•°åˆ›å»ºä¸€ä¸ªèƒ½é˜»å¡å½“å‰çº¿ç¨‹çš„åç¨‹ä½œç”¨åŸŸ" class="headerlink" title="äº”ã€ä½¿ç”¨ runBlocking å‡½æ•°åˆ›å»ºä¸€ä¸ªèƒ½é˜»å¡å½“å‰çº¿ç¨‹çš„åç¨‹ä½œç”¨åŸŸ"></a>äº”ã€ä½¿ç”¨ runBlocking å‡½æ•°åˆ›å»ºä¸€ä¸ªèƒ½é˜»å¡å½“å‰çº¿ç¨‹çš„åç¨‹ä½œç”¨åŸŸ</h2><ul><li>runBlocking å‡½æ•°å¯ä»¥ä¿è¯åœ¨åç¨‹ä½œç”¨åŸŸå†…çš„æ‰€æœ‰ä»£ç å’Œå­åç¨‹æ²¡æœ‰å…¨éƒ¨æ‰§è¡Œå®Œä¹‹å‰ä¸€ç›´é˜»å¡å½“å‰çº¿ç¨‹</li></ul><p><strong>æ³¨æ„</strong>ï¼šrunBlocking å‡½æ•°é€šå¸¸åªèƒ½åœ¨æµ‹è¯•ç¯å¢ƒä¸­ä½¿ç”¨ï¼Œåœ¨æ­£å¼ç¯å¢ƒä¸­ä½¿ç”¨ä¼šå®¹æ˜“äº§ç”Ÿä¸€äº›æ€§èƒ½ä¸Šçš„é—®é¢˜</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>    runBlocking &#123;<br>       println(<span class="hljs-string">&quot;codes run in coroutine scope&quot;</span>)<br>       delay(<span class="hljs-number">1500</span>)<br>       println(<span class="hljs-string">&quot;codes run in coroutine scope finished&quot;</span>)<br>    &#125;<br>&#125;<br><span class="hljs-comment">//æ‰“å°ç»“æœ</span><br>codes run <span class="hljs-keyword">in</span> coroutine scope<br>codes run <span class="hljs-keyword">in</span> coroutine scope finished<br></code></pre></td></tr></table></figure><p> ä¸Šè¿°ä»£ç æˆ‘ä»¬ä½¿ç”¨äº† runBlocking å‡½æ•°ï¼Œå¯ä»¥çœ‹åˆ°ä¸¤æ¡æ—¥å¿—éƒ½èƒ½å¤Ÿæ­£å¸¸æ‰“å°å‡ºæ¥äº†ã€‚åˆ°äº†è¿™é‡Œæˆ‘å¿ƒé‡Œä¼šæœ‰ä¸€ä¸ªç–‘é—®ï¼šä¸Šé¢çš„ä»£ç éƒ½æ˜¯è·‘åœ¨åŒä¸€ä¸ªåç¨‹ä¸­ï¼Œæˆ‘èƒ½ä¸èƒ½åˆ›å»ºå¤šä¸ªåç¨‹åŒæ—¶è·‘å‘¢ï¼Ÿ</p><p>ç­”ï¼šå¯ä»¥çš„ï¼Œä½¿ç”¨ launch å‡½æ•°</p><h2 id="å…­ã€ä½¿ç”¨-launch-å‡½æ•°åœ¨å½“å‰çš„åç¨‹ä½œç”¨åŸŸä¸‹åˆ›å»ºå­åç¨‹"><a href="#å…­ã€ä½¿ç”¨-launch-å‡½æ•°åœ¨å½“å‰çš„åç¨‹ä½œç”¨åŸŸä¸‹åˆ›å»ºå­åç¨‹" class="headerlink" title="å…­ã€ä½¿ç”¨ launch å‡½æ•°åœ¨å½“å‰çš„åç¨‹ä½œç”¨åŸŸä¸‹åˆ›å»ºå­åç¨‹"></a>å…­ã€ä½¿ç”¨ launch å‡½æ•°åœ¨å½“å‰çš„åç¨‹ä½œç”¨åŸŸä¸‹åˆ›å»ºå­åç¨‹</h2><p>ä¸Šé¢æˆ‘ä»¬è®²åˆ°è¿‡ï¼Œlaunch å‡½æ•°æ˜¯ CoroutineScope çš„ä¸€ä¸ªæ‰©å±•å‡½æ•°ï¼Œå› æ­¤åªè¦æ‹¥æœ‰åç¨‹ä½œç”¨åŸŸï¼Œå°±å¯ä»¥è°ƒç”¨ launch å‡½æ•°</p><ul><li>å•ç‹¬ä½¿ç”¨ launch å‡½æ•°å’Œæˆ‘ä»¬åˆšæ‰ä½¿ç”¨çš„ GlobalScope.launch å‡½æ•°ä¸åŒï¼Œ GlobalScope.launch åˆ›å»ºçš„æ˜¯ä¸€ä¸ªé¡¶çº§åç¨‹ï¼Œè€Œ launch å‡½æ•°åˆ›å»ºçš„æ˜¯å­åç¨‹</li></ul><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>    runBlocking &#123;<br>        launch &#123;<br>            println(<span class="hljs-string">&quot;launch1&quot;</span>)<br>            delay(<span class="hljs-number">1000</span>)<br>            println(<span class="hljs-string">&quot;launch1 finished&quot;</span>)<br>        &#125;<br><br>        launch &#123;<br>            println(<span class="hljs-string">&quot;launch2&quot;</span>)<br>            delay(<span class="hljs-number">1000</span>)<br>            println(<span class="hljs-string">&quot;launch2 finished&quot;</span>)<br>        &#125;<br>    &#125;<br>&#125;<br><span class="hljs-comment">//æ‰“å°ç»“æœ</span><br>launch1<br>launch2<br>launch1 finished<br>launch2 finished<br></code></pre></td></tr></table></figure><p>ä¸Šè¿°ä»£ç æˆ‘ä»¬è°ƒç”¨äº†ä¸¤æ¬¡ launch å‡½æ•°ï¼Œä¹Ÿå°±æ˜¯åˆ›å»ºäº†ä¸¤ä¸ªå­åç¨‹ï¼Œè¿è¡Œä¹‹åæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ä¸¤ä¸ªå­åç¨‹çš„æ—¥å¿—æ˜¯äº¤æ›¿æ‰“å°çš„ï¼Œè¿™ä¸€ç°è±¡è¡¨æ˜ä»–ä»¬åƒæ˜¯å¤šçº¿ç¨‹é‚£æ ·å¹¶å‘è¿è¡Œçš„ã€‚ç„¶è€Œè¿™ä¸¤ä¸ªå­åç¨‹å®é™…ä¸Šæ˜¯è¿è¡Œåœ¨åŒä¸€ä¸ªçº¿ç¨‹ä¸­ï¼Œåªæ˜¯ç”±ç¼–ç¨‹è¯­è¨€æ¥å†³å®šå¦‚ä½•åœ¨å¤šä¸ªåç¨‹ä¹‹é—´è¿›è¡Œè°ƒåº¦ï¼Œè®©è°è¿è¡Œï¼Œè®©è°æŒ‚èµ·ã€‚è°ƒåº¦çš„è¿‡ç¨‹å®Œå…¨ä¸éœ€è¦æ“ä½œç³»ç»Ÿå‚ä¸ï¼Œè¿™ä¹Ÿå°±ä½¿å¾—åç¨‹çš„å¹¶å‘æ•ˆç‡å‡ºå¥‡çš„é«˜</p><p>ç›®å‰ launch å‡½æ•°ä¸­çš„é€»è¾‘æ˜¯æ¯”è¾ƒç®€å•çš„ï¼Œé‚£ä¹ˆéšç€é€»è¾‘è¶Šæ¥è¶Šå¤šï¼Œæˆ‘ä»¬å¯èƒ½éœ€è¦å°†éƒ¨åˆ†ä»£ç æå–åˆ°ä¸€ä¸ªå•ç‹¬çš„å‡½æ•°ä¸­ï¼Œå¦‚ä¸‹ï¼š</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">performLogistics</span><span class="hljs-params">()</span></span>&#123;<br>    <span class="hljs-comment">//å¤„ç†æˆå¨çš„é€»è¾‘ä»£ç </span><br>    <span class="hljs-comment">//...</span><br>    <span class="hljs-comment">//è¿™å¥ä»£ç ç¼–è¯‘å™¨ä¼šæŠ¥é”™ï¼Œå› ä¸º delay å‡½æ•°åªèƒ½åœ¨åç¨‹ä½œç”¨åŸŸæˆ–è€…å…¶ä»–æŒ‚èµ·å‡½æ•°ä¸­è°ƒç”¨</span><br>    delay(<span class="hljs-number">1500</span>)<br>    <span class="hljs-comment">//...</span><br>&#125;<br></code></pre></td></tr></table></figure><p>ä¸Šé¢è¿™æ®µä»£ç æŠ¥é”™äº†ï¼Œå› ä¸ºæå–åˆ°ä¸€ä¸ªå•ç‹¬çš„å‡½æ•°ä¸­å°±æ²¡æœ‰åç¨‹ä½œç”¨åŸŸäº†ï¼Œé‚£ä¹ˆ delay å‡½æ•°å°±è°ƒç”¨ä¸äº†äº†ï¼Œè›‹ç–¼ï¼Œæœ‰æ²¡æœ‰å…¶ä»–åŠæ³•å‘¢ï¼Ÿ</p><p>ä»”ç»†åˆ†æä¸€ä¸‹ï¼Œæˆ‘ä»¬çŸ¥é“ delay å‡½æ•°åªèƒ½åœ¨åç¨‹ä½œç”¨åŸŸæˆ–è€…å…¶ä»–æŒ‚èµ·å‡½æ•°ä¸­è°ƒç”¨ï¼Œç°åœ¨æå–å‡ºæ¥çš„å•ç‹¬å‡½æ•°æ²¡æœ‰åç¨‹ä½œç”¨åŸŸäº†ï¼Œé‚£ä¹ˆæ˜¯å¦å¯ä»¥æŠŠå®ƒå£°æ˜æˆä¸€ä¸ªæŒ‚èµ·å‡½æ•°å‘¢ï¼Ÿ</p><p>ç­”ï¼šå¯ä»¥çš„ï¼Œä½¿ç”¨ suspend å…³é”®å­—å°†ä¸€ä¸ªå‡½æ•°å£°æ˜æˆæŒ‚èµ·å‡½æ•°ï¼ŒæŒ‚èµ·å‡½æ•°ä¹‹é—´æ˜¯å¯ä»¥ç›¸äº’è°ƒç”¨çš„</p><h2 id="ä¸ƒã€ä½¿ç”¨-suspend-å…³é”®å­—å°†ä¸€ä¸ªå‡½æ•°å£°æ˜æˆæŒ‚èµ·å‡½æ•°"><a href="#ä¸ƒã€ä½¿ç”¨-suspend-å…³é”®å­—å°†ä¸€ä¸ªå‡½æ•°å£°æ˜æˆæŒ‚èµ·å‡½æ•°" class="headerlink" title="ä¸ƒã€ä½¿ç”¨ suspend å…³é”®å­—å°†ä¸€ä¸ªå‡½æ•°å£°æ˜æˆæŒ‚èµ·å‡½æ•°"></a>ä¸ƒã€ä½¿ç”¨ suspend å…³é”®å­—å°†ä¸€ä¸ªå‡½æ•°å£°æ˜æˆæŒ‚èµ·å‡½æ•°</h2><ul><li>suspend å…³é”®å­—èƒ½å°†ä¸€ä¸ªå‡½æ•°å£°æ˜æˆæŒ‚èµ·å‡½æ•°</li><li>æŒ‚èµ·å‡½æ•°å¿…é¡»åœ¨åç¨‹æˆ–è€…å¦ä¸€ä¸ªæŒ‚èµ·å‡½æ•°é‡Œè¢«è°ƒç”¨</li></ul><p>é‚£ä¹ˆä¸Šé¢ä»£ç æˆ‘ä»¬åŠ ä¸ªå…³é”®å­—ä¿®é¥°ä¸€ä¸‹å°± ok äº†ï¼Œå¦‚ä¸‹ï¼š</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-keyword">suspend</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">performLogistics</span><span class="hljs-params">()</span></span>&#123;<br>    <span class="hljs-comment">//å¤„ç†æˆå¨çš„é€»è¾‘ä»£ç </span><br>    <span class="hljs-comment">//...</span><br>    delay(<span class="hljs-number">1500</span>)<br>    <span class="hljs-comment">//...</span><br>&#125;<br></code></pre></td></tr></table></figure><p>ç°åœ¨é—®é¢˜åˆæ¥äº†ï¼Œå¦‚æœæˆ‘æƒ³åœ¨è¿™ä¸ªæŒ‚èµ·å‡½æ•°ä¸­è°ƒç”¨ launch å‡½æ•°å¯ä»¥ä¹ˆï¼Ÿå¦‚ä¸‹ï¼š</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-keyword">suspend</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">performLogistics</span><span class="hljs-params">()</span></span>&#123;<br>    <span class="hljs-comment">//å¤„ç†æˆå¨çš„é€»è¾‘ä»£ç </span><br>    <span class="hljs-comment">//...</span><br>    delay(<span class="hljs-number">1500</span>)<br>    <span class="hljs-comment">//...</span><br>    <span class="hljs-comment">//è¿™å¥ä»£ç ç¼–è¯‘å™¨ä¼šæŠ¥é”™ï¼Œå› ä¸ºæ²¡æœ‰åç¨‹ä½œç”¨åŸŸ</span><br>    launch&#123;<br>      <br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ä¸Šé¢è¿™æ®µä»£ç åˆæŠ¥é”™äº†ï¼Œå› ä¸ºæ²¡æœ‰åç¨‹ä½œç”¨åŸŸï¼Œé‚£ä¹ˆå¦‚æœæˆ‘æƒ³è¿™æ ·è°ƒç”¨ï¼Œèƒ½å®ç°ä¹ˆï¼Ÿ</p><p>ç­”ï¼šå¯ä»¥çš„ï¼Œå€ŸåŠ© coroutineScope å‡½æ•°æ¥è§£å†³</p><h2 id="å…«ã€ä½¿ç”¨-coroutineScope-å‡½æ•°åˆ›å»ºä¸€ä¸ªåç¨‹ä½œç”¨åŸŸ"><a href="#å…«ã€ä½¿ç”¨-coroutineScope-å‡½æ•°åˆ›å»ºä¸€ä¸ªåç¨‹ä½œç”¨åŸŸ" class="headerlink" title="å…«ã€ä½¿ç”¨ coroutineScope å‡½æ•°åˆ›å»ºä¸€ä¸ªåç¨‹ä½œç”¨åŸŸ"></a>å…«ã€ä½¿ç”¨ coroutineScope å‡½æ•°åˆ›å»ºä¸€ä¸ªåç¨‹ä½œç”¨åŸŸ</h2><ul><li>coroutineScope å‡½æ•°ä¼šç»§æ‰¿å¤–éƒ¨çš„åç¨‹ä½œç”¨åŸŸå¹¶åˆ›å»ºä¸€ä¸ªå­ä½œç”¨åŸŸ</li><li>coroutineScope å‡½æ•°ä¹Ÿæ˜¯ä¸€ä¸ªæŒ‚èµ·å‡½æ•°ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥åœ¨ä»»ä½•å…¶ä»–æŒ‚èµ·å‡½æ•°ä¸­è°ƒç”¨</li></ul><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-keyword">suspend</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">printDot</span><span class="hljs-params">()</span></span> = coroutineScope &#123;<br>    println(<span class="hljs-string">&quot;.&quot;</span>)<br>    delay(<span class="hljs-number">1000</span>)<br>    launch &#123;<br><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p> ä¸Šè¿°ä»£ç è°ƒç”¨ launch å‡½æ•°å°±ä¸ä¼šæŠ¥é”™äº†ã€‚</p><p>å¦å¤–ï¼Œ coroutineScope å‡½æ•°å’Œ runBlocking å‡½æ•°æœ‰ç‚¹ç±»ä¼¼ï¼Œå®ƒå¯ä»¥ä¿è¯å…¶ä½œç”¨åŸŸå†…çš„æ‰€æœ‰ä»£ç å’Œå­åç¨‹åœ¨å…¨éƒ¨æ‰§è¡Œå®Œä¹‹å‰ï¼Œä¸€ç›´é˜»å¡å½“å‰åç¨‹ã€‚è€Œ runBlocking æ˜¯ä¸€ç›´é˜»å¡å½“å‰çº¿ç¨‹ï¼Œæˆ‘ä»¬æ¥åšä¸ªéªŒè¯ï¼š</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>    runBlocking &#123;<br>        coroutineScope &#123;<br>            launch &#123;<br>                <span class="hljs-keyword">for</span> (i <span class="hljs-keyword">in</span> <span class="hljs-number">1.</span><span class="hljs-number">.5</span>) &#123;<br>                    println(i)<br>                &#125;<br>            &#125;<br>        &#125;<br>        println(<span class="hljs-string">&quot;coroutineScope finished&quot;</span>)<br>    &#125;<br>    println(<span class="hljs-string">&quot;runBlocking finished&quot;</span>)<br>&#125;<br><br><span class="hljs-comment">//æ‰“å°ç»“æœ</span><br><span class="hljs-number">1</span><br><span class="hljs-number">2</span><br><span class="hljs-number">3</span><br><span class="hljs-number">4</span><br><span class="hljs-number">5</span><br>coroutineScope finished<br>runBlocking finished<br></code></pre></td></tr></table></figure><p>ä»æ‰“å°ç»“æœï¼Œæˆ‘ä»¬å°±å¯ä»¥éªŒè¯ä¸Šé¢è¿™ä¸€ç»“è®º</p><h2 id="ä¹ã€ä½¿ç”¨-async-å‡½æ•°åˆ›å»ºä¸€ä¸ªå­åç¨‹å¹¶è·å–æ‰§è¡Œç»“æœ"><a href="#ä¹ã€ä½¿ç”¨-async-å‡½æ•°åˆ›å»ºä¸€ä¸ªå­åç¨‹å¹¶è·å–æ‰§è¡Œç»“æœ" class="headerlink" title="ä¹ã€ä½¿ç”¨ async å‡½æ•°åˆ›å»ºä¸€ä¸ªå­åç¨‹å¹¶è·å–æ‰§è¡Œç»“æœ"></a>ä¹ã€ä½¿ç”¨ async å‡½æ•°åˆ›å»ºä¸€ä¸ªå­åç¨‹å¹¶è·å–æ‰§è¡Œç»“æœ</h2><p>ä»ä¸Šé¢çš„å­¦ä¹ æˆ‘ä»¬å¯ä»¥çŸ¥é“ launch å‡½æ•°å¯ä»¥åˆ›å»ºä¸€ä¸ªå­åç¨‹ï¼Œä½†æ˜¯ launch å‡½æ•°åªèƒ½ç”¨äºæ‰§è¡Œä¸€æ®µé€»è¾‘ï¼Œå´ä¸èƒ½è·å–æ‰§è¡Œçš„ç»“æœï¼Œå› ä¸ºå®ƒçš„è¿”å›å€¼æ°¸è¿œæ˜¯ä¸€ä¸ª Job å¯¹è±¡ï¼Œé‚£ä¹ˆå¦‚æœæˆ‘ä»¬æƒ³åˆ›å»ºä¸€ä¸ªå­åç¨‹å¹¶è·å–å®ƒçš„æ‰§è¡Œç»“æœï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ async å‡½æ•°</p><ul><li>async å‡½æ•°å¿…é¡»åœ¨åç¨‹ä½œç”¨åŸŸä¸‹æ‰èƒ½è°ƒç”¨</li><li>async å‡½æ•°ä¼šåˆ›å»ºä¸€ä¸ªå­åç¨‹å¹¶è¿”å›ä¸€ä¸ª Deferred å¯¹è±¡ï¼Œå¦‚æœéœ€è¦è·å– async å‡½æ•°ä»£ç å—ä¸­çš„æ‰§è¡Œç»“æœï¼Œåªéœ€è¦è°ƒç”¨ Deferred å¯¹è±¡çš„ await() æ–¹æ³•å³å¯</li><li>async å‡½æ•°åœ¨è°ƒç”¨åä¼šç«‹åˆ»æ‰§è¡Œï¼Œå½“è°ƒç”¨ await() æ–¹æ³•æ—¶ï¼Œå¦‚æœä»£ç å—ä¸­çš„ä»£ç è¿˜æ²¡æ‰§è¡Œå®Œï¼Œé‚£ä¹ˆ await() æ–¹æ³•ä¼šå°†å½“å‰åç¨‹é˜»å¡ä½ï¼Œç›´åˆ°å¯ä»¥è·å– async å‡½æ•°ä¸­çš„æ‰§è¡Œç»“æœ</li></ul><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>    runBlocking &#123;<br>        <span class="hljs-keyword">val</span> start = System.currentTimeMillis()<br>        <span class="hljs-keyword">val</span> result1 = async &#123;<br>            delay(<span class="hljs-number">1000</span>)<br>            <span class="hljs-number">5</span> + <span class="hljs-number">5</span><br>        &#125;.await()<br><br><br>        <span class="hljs-keyword">val</span> result2 = async &#123;<br>            delay(<span class="hljs-number">1000</span>)<br>            <span class="hljs-number">4</span> + <span class="hljs-number">6</span><br>        &#125;.await()<br>        println(<span class="hljs-string">&quot;result is <span class="hljs-subst">$&#123;result1 + result2&#125;</span>&quot;</span>)<br>        <span class="hljs-keyword">val</span> end = System.currentTimeMillis()<br>        println(<span class="hljs-string">&quot;cost: <span class="hljs-subst">$&#123;end - start&#125;</span> ms.&quot;</span>)<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">//æ‰“å°ç»“æœ</span><br>result <span class="hljs-keyword">is</span> <span class="hljs-number">20</span><br>cost: <span class="hljs-number">2017</span> ms.<br></code></pre></td></tr></table></figure><p>ä¸Šè¿°ä»£ç è¿ç»­ä½¿ç”¨äº†ä¸¤ä¸ª async å‡½æ•°æ¥æ‰§è¡Œä»»åŠ¡ï¼Œå¹¶åœ¨ä»£ç å—ä¸­è¿›è¡Œ 1 ç§’çš„å»¶è¿Ÿï¼ŒæŒ‰ç…§åˆšæ‰ä¸Šé¢è¯´çš„ï¼Œawait() æ–¹æ³•åœ¨ async å‡½æ•°ä»£ç å—ä¸­çš„ä»£ç æ‰§è¡Œå®Œä¹‹å‰ä¼šä¸€ç›´å°†å½“å‰åç¨‹é˜»å¡ä½ã€‚æ•´æ®µä»£ç çš„æ‰§è¡Œè€—æ—¶æ˜¯ 2017 msï¼Œè¯´æ˜è¿™é‡Œçš„ä¸¤ä¸ª async å‡½æ•°ç¡®å®æ˜¯ä¸€ç§ä¸²è¡Œçš„å…³ç³»ï¼Œå‰ä¸€ä¸ªæ‰§è¡Œå®Œäº†ä¸‹ä¸€ä¸ªæ‰èƒ½æ‰§è¡Œã€‚å¾ˆæ˜æ˜¾è¿™ç§å†™æ³•æ˜¯æ¯”è¾ƒä½æ•ˆçš„ï¼Œå› ä¸ºä¸¤ä¸ª async å®Œå…¨å¯ä»¥å¼‚æ­¥å»æ‰§è¡Œï¼Œè€Œç°åœ¨å´è¢«æ•´æˆäº†åŒæ­¥ï¼Œæˆ‘ä»¬æ”¹é€ ä¸€ä¸‹ä¸Šé¢çš„å†™æ³•ï¼š</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>    runBlocking &#123;<br>        <span class="hljs-keyword">val</span> start = System.currentTimeMillis()<br>        <span class="hljs-keyword">val</span> deferred1 = async &#123;<br>            delay(<span class="hljs-number">1000</span>)<br>            <span class="hljs-number">5</span> + <span class="hljs-number">5</span><br>        &#125;<br><br><br>        <span class="hljs-keyword">val</span> deferred2 = async &#123;<br>            delay(<span class="hljs-number">1000</span>)<br>            <span class="hljs-number">4</span> + <span class="hljs-number">6</span><br>        &#125;<br>        println(<span class="hljs-string">&quot;result is <span class="hljs-subst">$&#123;deferred1.await() + deferred2.await()&#125;</span>&quot;</span>)<br>        <span class="hljs-keyword">val</span> end = System.currentTimeMillis()<br>        println(<span class="hljs-string">&quot;cost: <span class="hljs-subst">$&#123;end - start&#125;</span> ms.&quot;</span>)<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">//æ‰“å°ç»“æœ</span><br>result <span class="hljs-keyword">is</span> <span class="hljs-number">20</span><br>cost: <span class="hljs-number">1020</span> ms.<br></code></pre></td></tr></table></figure><p>ä¸Šé¢çš„å†™æ³•æˆ‘ä»¬æ²¡æœ‰åœ¨æ¯æ¬¡è°ƒç”¨ async å‡½æ•°ä¹‹åå°±ç«‹åˆ»ä½¿ç”¨ await() æ–¹æ³•è·å–ç»“æœäº†ï¼Œè€Œæ˜¯ä»…åœ¨éœ€è¦ç”¨åˆ° async å‡½æ•°çš„æ‰§è¡Œç»“æœæ—¶æ‰è°ƒç”¨ await() æ–¹æ³•è¿›è¡Œè·å–ï¼Œè¿™æ · async å‡½æ•°å°±å˜æˆäº†ä¸€ç§å¼‚æ­¥å…³ç³»äº†ï¼Œå¯ä»¥çœ‹åˆ°æ‰“å°ç»“æœä¹ŸéªŒè¯äº†è¿™ä¸€ç‚¹</p><p>æˆ‘æ˜¯ä¸ªå–œæ¬¢å·æ‡’çš„äººï¼Œ async å‡½æ•°æ¯æ¬¡éƒ½è¦è°ƒç”¨ await() æ–¹æ³•æ‰èƒ½è·å–ç»“æœï¼Œæ¯”è¾ƒç¹çï¼Œé‚£æˆ‘å°±ä¼šæƒ³ï¼šæœ‰æ²¡æœ‰ç±»ä¼¼ async å‡½æ•°å¹¶ä¸”ä¸éœ€è¦æ¯æ¬¡éƒ½å»è°ƒç”¨ await() æ–¹æ³•è·å–ç»“æœçš„å‡½æ•°å‘¢ï¼Ÿ</p><p>ç­”ï¼šæœ‰çš„ï¼Œä½¿ç”¨ withContext å‡½æ•°</p><h2 id="10ã€ä½¿ç”¨-withContext-å‡½æ•°æ„å»ºä¸€ä¸ªç®€åŒ–ç‰ˆçš„-async-å‡½æ•°"><a href="#10ã€ä½¿ç”¨-withContext-å‡½æ•°æ„å»ºä¸€ä¸ªç®€åŒ–ç‰ˆçš„-async-å‡½æ•°" class="headerlink" title="10ã€ä½¿ç”¨ withContext å‡½æ•°æ„å»ºä¸€ä¸ªç®€åŒ–ç‰ˆçš„  async å‡½æ•°"></a>10ã€ä½¿ç”¨ withContext å‡½æ•°æ„å»ºä¸€ä¸ªç®€åŒ–ç‰ˆçš„  async å‡½æ•°</h2><ul><li>withContext å‡½æ•°æ˜¯ä¸€ä¸ªæŒ‚èµ·å‡½æ•°ï¼Œå¹¶ä¸”å¼ºåˆ¶è¦æ±‚æˆ‘ä»¬æŒ‡å®šä¸€ä¸ªåç¨‹ä¸Šä¸‹æ–‡å‚æ•°ï¼Œè¿™ä¸ªè°ƒåº¦å™¨å…¶å®å°±æ˜¯æŒ‡å®šåç¨‹å…·ä½“çš„è¿è¡Œçº¿ç¨‹</li><li>withContext å‡½æ•°åœ¨è°ƒç”¨åä¼šç«‹åˆ»æ‰§è¡Œï¼Œå®ƒå¯ä»¥ä¿è¯å…¶ä½œç”¨åŸŸå†…çš„æ‰€æœ‰ä»£ç å’Œå­åç¨‹åœ¨å…¨éƒ¨æ‰§è¡Œå®Œä¹‹å‰ï¼Œä¸€ç›´é˜»å¡å½“å‰åç¨‹</li><li>withContext å‡½æ•°ä¼šåˆ›å»ºä¸€ä¸ªå­åç¨‹å¹¶å°†æœ€åä¸€è¡Œçš„æ‰§è¡Œç»“æœä½œä¸ºè¿”å›å€¼</li></ul><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>    runBlocking &#123;<br>        <span class="hljs-keyword">val</span> result = withContext(Dispatchers.Default) &#123;<br>            <span class="hljs-number">5</span> + <span class="hljs-number">5</span><br>        &#125;<br>        println(result)<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">//æ‰“å°ç»“æœ</span><br><span class="hljs-number">10</span><br></code></pre></td></tr></table></figure><h2 id="11ã€ä½¿ç”¨-suspendCoroutine-å‡½æ•°ç®€åŒ–å›è°ƒçš„å†™æ³•"><a href="#11ã€ä½¿ç”¨-suspendCoroutine-å‡½æ•°ç®€åŒ–å›è°ƒçš„å†™æ³•" class="headerlink" title="11ã€ä½¿ç”¨ suspendCoroutine å‡½æ•°ç®€åŒ–å›è°ƒçš„å†™æ³•"></a>11ã€ä½¿ç”¨ suspendCoroutine å‡½æ•°ç®€åŒ–å›è°ƒçš„å†™æ³•</h2><p>åœ¨æ—¥å¸¸å·¥ä½œä¸­ï¼Œæˆ‘ä»¬é€šå¸¸ä¼šé€šè¿‡å¼‚æ­¥å›è°ƒæœºåˆ¶å»è·å–ç½‘ç»œå“åº”æ•°æ®ï¼Œä¸çŸ¥ä½ æœ‰æ²¡æœ‰å‘ç°ï¼Œè¿™ç§å›è°ƒæœºåˆ¶åŸºæœ¬ä¸Šæ˜¯ä¾é åŒ¿åå†…éƒ¨ç±»æ¥å®ç°çš„ï¼Œæ¯”å¦‚å¦‚ä¸‹ä»£ç ï¼š</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs kotlin">sendHttpRequest(<span class="hljs-keyword">object</span> : OnHttpCallBackListener&#123;<br>    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onSuccess</span><span class="hljs-params">(response: <span class="hljs-type">String</span>)</span></span> &#123;<br>            <br>    &#125;<br><br>    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onError</span><span class="hljs-params">(exception: <span class="hljs-type">Exception</span>)</span></span> &#123;<br>            <br>    &#125;<br> &#125;)<br></code></pre></td></tr></table></figure><p>é‚£ä¹ˆåœ¨å¤šå°‘åœ°æ–¹å‘èµ·ç½‘ç»œè¯·æ±‚ï¼Œå°±éœ€è¦ç¼–å†™å¤šå°‘æ¬¡è¿™æ ·çš„åŒ¿åå†…éƒ¨ç±»å»å®ç°ï¼Œè¿™æ ·ä¼šæ˜¾å¾—ç‰¹åˆ«ç¹çã€‚åœ¨æˆ‘ä»¬å­¦ä¹  Kotin åç¨‹ä¹‹å‰ï¼Œå¯èƒ½ç¡®å®æ˜¯æ²¡æœ‰å•¥æ›´ç®€å•çš„å†™æ³•äº†ï¼Œä¸è¿‡ç°åœ¨ï¼Œæˆ‘ä»¬å°±å¯ä»¥å€ŸåŠ© Kotlin åç¨‹é‡Œé¢çš„ suspendCoroutine å‡½æ•°æ¥ç®€åŒ–å›è°ƒçš„å†™æ³•ï¼š</p><ul><li>suspendCoroutine å‡½æ•°å¿…é¡»åœ¨åç¨‹ä½œç”¨åŸŸæˆ–è€…æŒ‚èµ·å‡½æ•°ä¸­è°ƒç”¨ï¼Œå®ƒæ¥æ”¶ä¸€ä¸ª Lambda è¡¨è¾¾å¼ï¼Œä¸»è¦ä½œç”¨æ˜¯å°†å½“å‰åç¨‹ç«‹å³æŒ‚èµ·ï¼Œç„¶ååœ¨ä¸€ä¸ªæ™®é€šçº¿ç¨‹ä¸­å»æ‰§è¡Œ Lambda è¡¨è¾¾å¼ä¸­çš„ä»£ç </li><li>suspendCoroutine å‡½æ•°çš„ Lambda è¡¨è¾¾å¼å‚æ•°åˆ—è¡¨ä¼šä¼ å…¥ä¸€ä¸ª Contination å‚æ•°ï¼Œè°ƒç”¨å®ƒçš„ resume() æˆ– resumeWithException() æ–¹æ³•å¯ä»¥è®©åç¨‹æ¢å¤æ‰§è¡Œ</li></ul><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-comment">//å®šä¹‰æˆåŠŸå’Œå¤±è´¥çš„æ¥å£</span><br><span class="hljs-keyword">interface</span> <span class="hljs-title class_">OnHttpCallBackListener</span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onSuccess</span><span class="hljs-params">(response: <span class="hljs-type">String</span>)</span></span><br>    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onError</span><span class="hljs-params">(exception: <span class="hljs-type">Exception</span>)</span></span><br>&#125;<br><br><span class="hljs-comment">//æ¨¡æ‹Ÿå‘é€ä¸€ä¸ªç½‘ç»œè¯·æ±‚</span><br><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">sendHttpRequest</span><span class="hljs-params">(url: <span class="hljs-type">String</span>, httpCallBack: <span class="hljs-type">OnHttpCallBackListener</span>)</span></span>&#123;<br><br>&#125;<br><br><span class="hljs-comment">//å¯¹å‘é€çš„ç½‘ç»œè¯·æ±‚å›è°ƒä½¿ç”¨ suspendCoroutine å‡½æ•°è¿›è¡Œå°è£…</span><br><span class="hljs-keyword">suspend</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">request</span><span class="hljs-params">(url: <span class="hljs-type">String</span>)</span></span>: String&#123;<br>    <span class="hljs-keyword">return</span> suspendCoroutine &#123; continuation -&gt;<br>        sendHttpRequest(url,<span class="hljs-keyword">object</span> : OnHttpCallBackListener&#123;<br>            <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onSuccess</span><span class="hljs-params">(response: <span class="hljs-type">String</span>)</span></span> &#123;<br>                continuation.resume(response)<br>            &#125;<br><br>            <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onError</span><span class="hljs-params">(exception: <span class="hljs-type">Exception</span>)</span></span> &#123;<br>                continuation.resumeWithException(exception)<br>            &#125;<br><br>        &#125;)<br><br>    &#125;<br>&#125;<br><br><span class="hljs-comment">//å…·ä½“ä½¿ç”¨</span><br><span class="hljs-keyword">suspend</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">getBaiduResponse</span><span class="hljs-params">()</span></span>&#123;<br>    <span class="hljs-keyword">try</span> &#123;<br>        <span class="hljs-keyword">val</span> request = request(<span class="hljs-string">&quot;https://www.baidu.com/&quot;</span>)<br>    &#125; <span class="hljs-keyword">catch</span> (e: Exception) &#123;<br>        <span class="hljs-comment">//å¯¹å¼‚å¸¸æƒ…å†µè¿›è¡Œå¤„ç†</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ä¸Šè¿°ä»£ç ä¸­ï¼š</p><p>1ã€æˆ‘ä»¬åœ¨ request å‡½æ•°å†…éƒ¨ä½¿ç”¨äº†åˆšåˆšä»‹ç»çš„ suspendCoroutine å‡½æ•°ï¼Œè¿™æ ·å½“å‰åç¨‹ä¼šç«‹åˆ»è¢«æŒ‚èµ·ï¼Œè€Œ Lambda è¡¨è¾¾å¼ä¸­çš„ä»£ç åˆ™ä¼šåœ¨æ™®é€šçº¿ç¨‹ä¸­æ‰§è¡Œã€‚æ¥ç€æˆ‘ä»¬åœ¨ Lambda è¡¨è¾¾å¼ä¸­è°ƒç”¨äº† sendHttpRequest() æ–¹æ³•å‘èµ·ç½‘ç»œè¯·æ±‚ï¼Œå¹¶é€šè¿‡ä¼ ç»Ÿå›è°ƒçš„æ–¹å¼ç›‘å¬è¯·æ±‚ç»“æœ</p><p>2ã€å¦‚æœè¯·æ±‚æˆåŠŸå°±è°ƒç”¨ Continuation çš„ resume() æ–¹æ³•æ¢å¤è¢«æŒ‚èµ·çš„åç¨‹ï¼Œå¹¶ä¼ å…¥æœåŠ¡å™¨å“åº”çš„æ•°æ®ï¼Œè¯¥å€¼ä¼šæˆä¸º suspendCoroutine å‡½æ•°çš„è¿”å›å€¼</p><p>3ã€å¦‚æœè¯·æ±‚å¤±è´¥ï¼Œå°±è°ƒç”¨ Continuation çš„ resumeWithException() æ–¹æ³•æ¢å¤è¢«æŒ‚èµ·çš„åç¨‹ï¼Œå¹¶ä¼ å…¥å…·ä½“çš„å¼‚å¸¸åŸå› </p><p>4ã€æœ€ååœ¨ getBaiduResponse() ä¸­è¿›è¡Œäº†å…·ä½“ä½¿ç”¨ï¼Œæœ‰æ²¡æœ‰è§‰å¾—è¿™é‡Œçš„ä»£ç æ¸…çˆ½äº†å¾ˆå¤šï¼Ÿç”±äº  getBaiduResponse() æ˜¯ä¸€ä¸ªæŒ‚èµ·å‡½æ•°ï¼Œå½“ getBaiduResponse() è°ƒç”¨äº† request() å‡½æ•°æ—¶ï¼Œå½“å‰åç¨‹ä¼šç«‹åˆ»æŒ‚èµ·ï¼Œç„¶åç­‰å¾…ç½‘ç»œè¯·æ±‚æˆåŠŸæˆ–è€…å¤±è´¥åï¼Œå½“å‰åç¨‹æ‰èƒ½æ¢å¤è¿è¡Œ</p><p>5ã€å¦‚æœè¯·æ±‚æˆåŠŸï¼Œæˆ‘ä»¬å°±èƒ½è·å¾—å¼‚æ­¥ç½‘ç»œè¯·æ±‚çš„å“åº”æ•°æ®ï¼Œå¦‚æœè¯·æ±‚å¤±è´¥ï¼Œåˆ™ä¼šç›´æ¥è¿›å…¥ catch è¯­å¥ä¸­</p><p>åˆ°è¿™é‡Œå…¶å®åˆä¼šäº§ç”Ÿä¸€ä¸ªé—®é¢˜ï¼šgetBaiduResponse() å‡½æ•°è¢«å£°æ˜æˆäº†ä¸€ä¸ªæŒ‚èµ·å‡½æ•°ï¼Œå› æ­¤å®ƒåªèƒ½åœ¨åç¨‹ä½œç”¨åŸŸæˆ–å…¶ä»–æŒ‚èµ·å‡½æ•°ä¸­è°ƒç”¨äº†ï¼Œä½¿ç”¨èµ·æ¥æ˜¯ä¸æ˜¯éå¸¸æœ‰å±€é™æ€§ï¼Ÿ</p><p>ç­”ï¼šç¡®å®å¦‚æ­¤ï¼Œå› ä¸º suspendCoroutine å‡½æ•°æœ¬èº«å°±æ˜¯è¦ç»“åˆåç¨‹ä¸€èµ·ä½¿ç”¨çš„ï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬å°±éœ€è¦é€šè¿‡åˆç†çš„é¡¹ç›®æ¶æ„è®¾è®¡å»è§£å†³è¿™ä¸ªé—®é¢˜</p><p>ç»è¿‡ä¸Šé¢çš„æ­¥éª¤ï¼Œæˆ‘ä»¬ä½¿ç”¨ suspendCoroutine å‡½æ•°å®ç°äº†<strong>çœ‹ä¼¼åŒæ­¥çš„æ–¹å¼å†™å‡ºå¼‚æ­¥çš„ä»£ç </strong>ï¼Œäº‹å®ä¸Š suspendCoroutine å‡½æ•°å‡ ä¹å¯ä»¥ç”¨äºç®€åŒ–ä»»ä½•å›è°ƒçš„å†™æ³•ï¼Œä¾‹å¦‚æˆ‘ä»¬åœ¨å®é™…é¡¹ç›®ä¸­ä½¿ç”¨ Retrofit å°±å¯ä»¥ä½¿ç”¨ suspendCoroutine å‡½æ•°æ¥ç®€åŒ–å›è°ƒ</p><p>åˆ°äº†è¿™é‡Œï¼Œç›¸ä¿¡ä½ å¯¹åç¨‹æœ‰äº†ä¸€å®šçš„äº†è§£äº†ï¼Œæ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬åˆ†æä¸€ç‚¹æ·±å…¥çš„ä¸œè¥¿</p><h2 id="åäºŒã€Kotlin-ä¸­çš„æŒ‚èµ·æ“ä½œ"><a href="#åäºŒã€Kotlin-ä¸­çš„æŒ‚èµ·æ“ä½œ" class="headerlink" title="åäºŒã€Kotlin ä¸­çš„æŒ‚èµ·æ“ä½œ"></a>åäºŒã€Kotlin ä¸­çš„æŒ‚èµ·æ“ä½œ</h2><p>æŒ‚èµ·ç®—æ˜¯ Kotlin åç¨‹ä¸­çš„ä¸€ä¸ªé»‘é­”æ³•äº†ï¼Œä¸Šé¢æˆ‘ä»¬ç®€å•äº†ä»‹ç»äº†ä¸‹ä½¿ç”¨ suspend å®šä¹‰ä¸€ä¸ªæŒ‚èµ·å‡½æ•°ï¼Œä¸‹é¢æˆ‘ä»¬æ¥è¯¦ç»†çš„å»å‰–æä¸€ä¸‹ Kotlin ä¸­çš„æŒ‚èµ·æ“ä½œ</p><h3 id="1ã€æŒ‚èµ·çš„æœ¬è´¨"><a href="#1ã€æŒ‚èµ·çš„æœ¬è´¨" class="headerlink" title="1ã€æŒ‚èµ·çš„æœ¬è´¨"></a>1ã€æŒ‚èµ·çš„æœ¬è´¨</h3><p>å¦‚ä¸‹ä»£ç ï¼š</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-keyword">class</span> <span class="hljs-title class_">MainActivity</span> : <span class="hljs-type">AppCompatActivity</span>() &#123;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> TAG: String = <span class="hljs-string">&quot;MainActivity&quot;</span><br>  <br>    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onCreate</span><span class="hljs-params">(savedInstanceState: <span class="hljs-type">Bundle</span>?)</span></span> &#123;<br>        <span class="hljs-keyword">super</span>.onCreate(savedInstanceState)<br>        setContentView(R.layout.activity_main)<br><br>        Log.d(TAG, <span class="hljs-string">&quot;start... &quot;</span>);<br>        GlobalScope.launch(Dispatchers.Main) &#123;<br>            mockTimeConsume()<br>            Log.d(TAG, <span class="hljs-string">&quot;æˆ‘ç­‰æŒ‚èµ·å‡½æ•°æ‰§è¡Œå®Œäº†åœ¨æ‰§è¡Œ&quot;</span>);<br>        &#125;<br>        Log.d(TAG, <span class="hljs-string">&quot;æˆ‘åœ¨ä¸»çº¿ç¨‹æ‰§è¡Œäº†æˆå¨çš„ä»£ç &quot;</span>);<br>    &#125;<br><br><br>    <span class="hljs-comment">//æ¨¡æ‹ŸæŒ‚èµ·å‡½æ•°è€—æ—¶ä»»åŠ¡</span><br>    <span class="hljs-keyword">suspend</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">mockTimeConsume</span><span class="hljs-params">()</span></span> = withContext(Dispatchers.IO)&#123;<br>        Log.d(TAG, <span class="hljs-string">&quot;ç´§å¼ çš„æ‰§è¡Œè€—æ—¶ä»»åŠ¡ä¸­... &quot;</span> +  + Thread.currentThread().name);<br>        Thread.sleep(<span class="hljs-number">3000</span>)<br>    &#125;<br>&#125;<br><span class="hljs-comment">//æ‰“å°ç»“æœå¦‚ä¸‹</span><br>start...<br>æˆ‘åœ¨ä¸»çº¿ç¨‹æ‰§è¡Œäº†æˆå¨çš„ä»£ç <br>ç´§å¼ çš„æ‰§è¡Œè€—æ—¶ä»»åŠ¡ä¸­...DefaultDispatcher-worker-<span class="hljs-number">2</span><br>æˆ‘ç­‰æŒ‚èµ·å‡½æ•°æ‰§è¡Œå®Œäº†åœ¨æ‰§è¡Œ<br></code></pre></td></tr></table></figure><p>ä¸Šè¿°ä»£ç æ­¥éª¤ï¼š</p><p>1ã€åœ¨ä¸»çº¿ç¨‹ä¸­åˆ›å»ºäº†ä¸€ä¸ªé¡¶çº§åç¨‹ï¼Œå¹¶æŒ‡å®šè¯¥åç¨‹åœ¨ä¸»çº¿ç¨‹ä¸­è¿è¡Œ</p><p>2ã€åœ¨åç¨‹ä¸­æ‰§è¡Œ mockTimeConsume è¿™ä¸ªæ–¹æ³•å¹¶æ‰“å°äº†ä¸€å¥ Log</p><p>ç°åœ¨æˆ‘ä»¬ä»çº¿ç¨‹å’Œåç¨‹ä¸¤ä¸ªè§’åº¦å»åˆ†æå®ƒï¼š</p><p>å‰é¢æˆ‘åœ¨å›ç­”é—®é¢˜çš„æ—¶å€™è®²åˆ°è¿‡ï¼ŒæŒ‚èµ·å°±æ˜¯åˆ‡æ¢åˆ°å¦å¤–ä¸€ä¸ªæŒ‡å®šçš„çº¿ç¨‹å»æ‰§è¡Œ</p><p><strong>çº¿ç¨‹</strong></p><p>çº¿ç¨‹ï¼šé‚£ä¹ˆå½“æ‰§è¡Œåˆ°åç¨‹ä¸­çš„ mockTimeConsume() è¿™å¥ä»£ç çš„æ—¶å€™ï¼Œå› ä¸ºé‡åˆ°äº†æŒ‚èµ·å‡½æ•°ï¼Œåç¨‹è¢«æŒ‚èµ·äº†ï¼Œä¸»çº¿ç¨‹å°†ä¼šè·³å‡ºè¿™ä¸ªåç¨‹ï¼Œå¦‚æœä¸‹é¢è¿˜æœ‰ä»£ç ï¼Œåˆ™ç»§ç»­æ‰§è¡Œä¸‹é¢çš„ä»£ç ï¼Œå¦‚æœæ²¡æœ‰ï¼Œåˆ™æ‰§è¡Œå®ƒç•Œé¢åˆ·æ–°çš„ä»»åŠ¡</p><p><strong>åç¨‹</strong></p><p>åç¨‹ï¼šå½“æ‰§è¡Œåˆ°åç¨‹ä¸­çš„ mockTimeConsume() è¿™å¥ä»£ç çš„æ—¶å€™ï¼Œå› ä¸ºé‡åˆ°äº†æŒ‚èµ·å‡½æ•°ï¼Œå½“å‰åç¨‹ä¼šè¢«æŒ‚èµ·ï¼Œ<strong>æ³¨æ„æ˜¯æ•´ä¸ªåç¨‹è¢«æŒ‚èµ·äº†ï¼Œæ„å‘³ç€ mockTimeConsume() è¿™å¥ä»£ç ä¸‹é¢çš„ä»£ç éƒ½ä¸ä¼šæ‰§è¡Œäº†ï¼Œéœ€ç­‰å¾…æˆ‘è¿™å¥ä»£ç æ‰§è¡Œå®Œä¹‹ååœ¨æ¥ç€å¾€åæ‰§è¡Œ</strong>ï¼Œæ¥ä¸‹æ¥ä¼šåœ¨æŒ‡å®šçš„çº¿ç¨‹æ‰§è¡ŒæŒ‚èµ·å‡½æ•°é‡Œé¢çš„å†…å®¹ã€‚è°æŒ‡å®šçš„ï¼Ÿæ˜¯å½“å‰æŒ‚èµ·å‡½æ•°æŒ‡å®šçš„ï¼Œæ¯”å¦‚æˆ‘ä»¬è¿™ä¸ªä¾‹å­ä¸­ï¼Œå‡½æ•°å†…éƒ¨çš„ withContext ä¼ å…¥çš„ Dispatchers.IO æ‰€æŒ‡å®šçš„ IO çº¿ç¨‹</p><p>Dispatchers è°ƒåº¦å™¨ï¼Œå®ƒå¯ä»¥å°†åç¨‹é™åˆ¶åœ¨ä¸€ä¸ªç‰¹å®šçš„çº¿ç¨‹æ‰§è¡Œï¼Œæˆ–è€…å°†å®ƒåˆ†æ´¾åˆ°ä¸€ä¸ªçº¿ç¨‹æ± ï¼Œæˆ–è€…è®©å®ƒä¸å—é™åˆ¶åœ°è¿è¡Œ</p><p>å¸¸ç”¨çš„ Dispatchers ï¼Œæœ‰ä»¥ä¸‹ä¸‰ç§ï¼š</p><ul><li>Dispatchers.Mainï¼šAndroid ä¸­çš„ä¸»çº¿ç¨‹</li><li>Dispatchers.IOï¼šé’ˆå¯¹ç£ç›˜å’Œç½‘ç»œ IO è¿›è¡Œäº†ä¼˜åŒ–ï¼Œé€‚åˆ IO å¯†é›†å‹çš„ä»»åŠ¡ï¼Œæ¯”å¦‚ï¼šè¯»å†™æ–‡ä»¶ï¼Œæ“ä½œæ•°æ®åº“ä»¥åŠç½‘ç»œè¯·æ±‚</li><li>Dispatchers.Defaultï¼šé€‚åˆ CPU å¯†é›†å‹çš„ä»»åŠ¡ï¼Œæ¯”å¦‚è®¡ç®—</li></ul><p>å½“æŒ‚èµ·å‡½æ•°æ‰§è¡Œå®Œä¹‹åï¼Œåç¨‹ä¸ºæˆ‘ä»¬åšçš„æœ€çˆ½çš„äº‹å°±æ¥äº†ï¼š<strong>æ¢å¤å½“å‰åç¨‹ï¼ŒæŠŠçº¿ç¨‹ä»å…¶ä»–çº¿ç¨‹ï¼Œåˆ‡å›åˆ°äº†å½“å‰çš„çº¿ç¨‹</strong>ã€‚é‚£ä¹ˆæ¥ç€å°±ä¼šæ‰§è¡Œåç¨‹ä¸­ Log.d(TAG, â€œæˆ‘ç­‰æŒ‚èµ·å‡½æ•°æ‰§è¡Œå®Œäº†åœ¨æ‰§è¡Œâ€) è¿™å¥ä»£ç ï¼Œæ•´ä¸ªæµç¨‹å°±ç»“æŸäº†</p><p>é€šè¿‡ä¸Šé¢å¯¹çº¿ç¨‹å’Œåç¨‹ä¸¤ä¸ªè§’åº¦éƒ½åˆ†æï¼Œæˆ‘ä»¬å¯ä»¥å¾—å‡ºä¸€äº›ç»“è®ºï¼š</p><p><strong>1ã€è¢« suspend ä¿®é¥°çš„æŒ‚èµ·å‡½æ•°æ¯”æ™®é€šå‡½æ•°å¤šä¸¤ä¸ªæ“ä½œï¼š</strong></p><p>1ï¼‰ã€æŒ‚èµ·ï¼šæš‚åœå½“å‰åç¨‹çš„æ‰§è¡Œï¼Œä¿å­˜æ‰€æœ‰çš„å±€éƒ¨å˜é‡ </p><p>2ï¼‰ã€æ¢å¤ï¼šä»åç¨‹è¢«æš‚åœçš„åœ°æ–¹ç»§ç»­æ‰§è¡Œåç¨‹</p><p><strong>2ã€åç¨‹åœ¨æ‰§è¡Œåˆ°æœ‰ suspend æ ‡è®°çš„æŒ‚èµ·å‡½æ•°æ—¶ï¼Œä¼šè¢«æŒ‚èµ·ï¼Œè€Œæ‰€è°“çš„è¢«æŒ‚èµ·ï¼Œå°±æ˜¯åˆ‡æ¢çº¿ç¨‹</strong></p><p><strong>3ã€åç¨‹è¢«æŒ‚èµ·ä¹‹åéœ€è¦æ¢å¤ï¼Œè€Œæ¢å¤è¿™ä¸ªæ“ä½œæ˜¯åç¨‹æ¡†æ¶ç»™æˆ‘ä»¬åšçš„</strong></p><p>é€šè¿‡ç»“è®º 3 ï¼Œæˆ‘ä»¬å¼•ç”³ä¸€ä¸‹ï¼šå¦‚æœä½ ä¸åœ¨åç¨‹é‡Œé¢è°ƒç”¨æŒ‚èµ·å‡½æ•°ï¼Œæ¢å¤è¿™ä¸ªåŠŸèƒ½æ²¡æ³•å®ç°ï¼Œæ‰€ä»¥ä¹Ÿå°±å›ç­”äº†é—®é¢˜ï¼šä¸ºä»€ä¹ˆæŒ‚èµ·å‡½æ•°å¿…é¡»åœ¨åç¨‹æˆ–è€…å¦ä¸€ä¸ªæŒ‚èµ·å‡½æ•°é‡Œè¢«è°ƒç”¨</p><p>å†ç»†æƒ³ä¸‹è¿™ä¸ªé€»è¾‘ï¼šä¸€ä¸ªæŒ‚èµ·å‡½æ•°è¦ä¹ˆåœ¨åç¨‹é‡Œè¢«è°ƒç”¨ï¼Œè¦ä¹ˆåœ¨å¦ä¸€ä¸ªæŒ‚èµ·å‡½æ•°é‡Œè¢«è°ƒç”¨ï¼Œé‚£ä¹ˆå®ƒå…¶å®ç›´æ¥æˆ–è€…é—´æ¥åœ°ï¼Œæ€»æ˜¯ä¼šåœ¨ä¸€ä¸ªåç¨‹é‡Œè¢«è°ƒç”¨çš„</p><p>æ‰€ä»¥ï¼Œè¦æ±‚ suspend å‡½æ•°åªèƒ½åœ¨åç¨‹é‡Œæˆ–è€…å¦ä¸€ä¸ª suspend å‡½æ•°é‡Œè¢«è°ƒç”¨ï¼Œè¿˜æ˜¯ä¸ºäº†è¦è®©åç¨‹èƒ½å¤Ÿåœ¨æŒ‚èµ·å‡½æ•°åˆ‡æ¢çº¿ç¨‹ä¹‹åå†åˆ‡å›æ¥</p><h3 id="2ã€æ˜¯æ€ä¹ˆè¢«æŒ‚èµ·çš„ï¼Ÿ"><a href="#2ã€æ˜¯æ€ä¹ˆè¢«æŒ‚èµ·çš„ï¼Ÿ" class="headerlink" title="2ã€æ˜¯æ€ä¹ˆè¢«æŒ‚èµ·çš„ï¼Ÿ"></a>2ã€æ˜¯æ€ä¹ˆè¢«æŒ‚èµ·çš„ï¼Ÿ</h3><p>åˆ°è¿™é‡Œä½ å¿ƒé‡Œæ˜¯å¦ä¼šæœ‰å¦å¤–ä¸€ä¸ªç–‘é—®ï¼šåç¨‹æ˜¯æ€ä¹ˆè¢«æŒ‚èµ·çš„ï¼Ÿå¦‚æœä¸Šé¢é‚£ä¸ªæŒ‚èµ·å‡½æ•°è¿™ä¹ˆå†™ï¼š</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-keyword">suspend</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">mockTimeConsume</span><span class="hljs-params">()</span></span>&#123;<br>   Log.d(TAG, <span class="hljs-string">&quot;ç´§å¼ çš„æ‰§è¡Œè€—æ—¶ä»»åŠ¡ä¸­...&quot;</span> + Thread.currentThread().name);<br>   Thread.sleep(<span class="hljs-number">3000</span>)<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿è¡Œåä½ ä¼šå‘ç°æ‰“å°çš„çº¿ç¨‹æ˜¯ä¸»çº¿ç¨‹ï¼Œé‚£ä¸ºä»€ä¹ˆæ²¡æœ‰åˆ‡æ¢çº¿ç¨‹å‘¢ï¼Ÿå› ä¸ºå®ƒä¸çŸ¥é“å¾€å“ªåˆ‡ï¼Œéœ€è¦æˆ‘ä»¬å‘Šè¯‰å®ƒï¼Œä¹‹å‰æˆ‘ä»¬æ˜¯è¿™ä¹ˆå†™çš„ï¼š</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-keyword">suspend</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">mockTimeConsume</span><span class="hljs-params">()</span></span> = withContext(Dispatchers.IO)&#123;<br>   Log.d(TAG, <span class="hljs-string">&quot;ç´§å¼ çš„æ‰§è¡Œè€—æ—¶ä»»åŠ¡ä¸­... &quot;</span> +  + Thread.currentThread().name);<br>   Thread.sleep(<span class="hljs-number">3000</span>)<br>&#125;<br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬å¯ä»¥å‘ç°ä¸åŒä¹‹å¤„å…¶å®åœ¨äº withContext å‡½æ•°ã€‚</p><p>å…¶å®é€šè¿‡ withContext æºç å¯ä»¥çŸ¥é“ï¼Œå®ƒæœ¬èº«å°±æ˜¯ä¸€ä¸ªæŒ‚èµ·å‡½æ•°ï¼Œå®ƒæ¥æ”¶ä¸€ä¸ª Dispatcher å‚æ•°ï¼Œä¾èµ–è¿™ä¸ª Dispatcher å‚æ•°çš„æŒ‡ç¤ºï¼Œä½ çš„åç¨‹å°±è¢«æŒ‚èµ·äº†ï¼Œç„¶ååˆ‡åˆ°åˆ«çš„çº¿ç¨‹</p><p>æ‰€ä»¥<strong>ä½¿ç”¨ suspend å®šä¹‰çš„æŒ‚èµ·å‡½æ•°ï¼Œè¿˜ä¸æ˜¯çœŸæ­£çš„æŒ‚èµ·å‡½æ•°ï¼ŒçœŸæ­£çš„æŒ‚èµ·å‡½æ•°å†…éƒ¨éœ€è¦è°ƒç”¨åˆ° Kotlin åç¨‹æ¡†æ¶è‡ªå¸¦çš„æŒ‚èµ·å‡½æ•°</strong></p><p>å› æ­¤æˆ‘ä»¬æƒ³è¦è‡ªå·±å†™ä¸€ä¸ªæŒ‚èµ·å‡½æ•°ï¼Œä»…ä»…åªåŠ ä¸Š suspend å…³é”®å­—æ˜¯ä¸è¡Œçš„ï¼Œè¿˜éœ€è¦å‡½æ•°å†…éƒ¨ç›´æ¥æˆ–é—´æ¥åœ°è°ƒç”¨åˆ° Kotlin åç¨‹æ¡†æ¶è‡ªå¸¦çš„ æŒ‚èµ·å‡½æ•°æ‰è¡Œ</p><h3 id="3ã€ä½¿ç”¨-suspend-çš„æ„ä¹‰"><a href="#3ã€ä½¿ç”¨-suspend-çš„æ„ä¹‰" class="headerlink" title="3ã€ä½¿ç”¨ suspend çš„æ„ä¹‰"></a>3ã€ä½¿ç”¨ suspend çš„æ„ä¹‰</h3><p>é€šè¿‡ä¸Šé¢çš„åˆ†ææˆ‘ä»¬çŸ¥é“ï¼Œä½¿ç”¨ suspend å…³é”®å­—ä¿®é¥°çš„å‡½æ•°å¯èƒ½è¿˜ä¸æ˜¯ä¸€ä¸ªçœŸæ­£çš„æŒ‚èµ·å‡½æ•°ï¼Œé‚£å®ƒçš„ä½œç”¨æ˜¯å•¥å‘¢ï¼Ÿ</p><p><strong>èµ·åˆ°ä¸€ä¸ªæé†’çš„ä½œç”¨</strong>ï¼Œæé†’è°ƒç”¨è€…æˆ‘æ˜¯ä¸€ä¸ªè€—æ—¶å‡½æ•°ï¼Œéœ€è¦åœ¨æŒ‚èµ·å‡½æ•°æˆ–è€…åç¨‹ä¸­è°ƒç”¨æˆ‘</p><p>ä¸ºä»€ä¹ˆ suspend å…³é”®å­—å¹¶æ²¡æœ‰å®é™…å»æ“ä½œæŒ‚èµ·ï¼Œä½† Kotlin å´æŠŠå®ƒæä¾›å‡ºæ¥ï¼Ÿ</p><p>å› ä¸ºå®ƒæœ¬æ¥å°±ä¸æ˜¯ç”¨æ¥æ“ä½œæŒ‚èµ·çš„ã€‚</p><p>æŒ‚èµ·çš„æ“ä½œ â€”â€” ä¹Ÿå°±æ˜¯åˆ‡çº¿ç¨‹ï¼Œä¾èµ–çš„æ˜¯æŒ‚èµ·å‡½æ•°é‡Œé¢çš„å®é™…ä»£ç ï¼Œè€Œä¸æ˜¯è¿™ä¸ªå…³é”®å­—</p><p>æ‰€ä»¥è¿™ä¸ªå…³é”®å­—ï¼Œ<strong>åªæ˜¯ä¸€ä¸ªæé†’</strong>ã€‚</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-keyword">suspend</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">mockTimeConsume</span><span class="hljs-params">()</span></span>&#123;<br>   Log.d(TAG, <span class="hljs-string">&quot;ç´§å¼ çš„æ‰§è¡Œè€—æ—¶ä»»åŠ¡ä¸­...&quot;</span> + Thread.currentThread().name);<br>   Thread.sleep(<span class="hljs-number">3000</span>)<br>&#125;<br></code></pre></td></tr></table></figure><p>ä¸Šè¿°è¿™æ®µä»£ç è¿™æ ·åšæ˜¯æ²¡æœ‰æ„ä¹‰çš„ï¼Œè€Œä¸”ä¼šå½±å“åˆ°ç¨‹åºçš„æ€§èƒ½ï¼ŒAndroidStudio ä¹Ÿä¼šæç¤ºä½  suspend ä¿®é¥°ç¬¦æ˜¯å¤šä½™çš„ã€‚</p><h3 id="4ã€å¦‚ä½•è‡ªå®šä¹‰ä¸€ä¸ªæŒ‚èµ·å‡½æ•°ï¼Ÿ"><a href="#4ã€å¦‚ä½•è‡ªå®šä¹‰ä¸€ä¸ªæŒ‚èµ·å‡½æ•°ï¼Ÿ" class="headerlink" title="4ã€å¦‚ä½•è‡ªå®šä¹‰ä¸€ä¸ªæŒ‚èµ·å‡½æ•°ï¼Ÿ"></a>4ã€å¦‚ä½•è‡ªå®šä¹‰ä¸€ä¸ªæŒ‚èµ·å‡½æ•°ï¼Ÿ</h3><p>ç¬¬ä¸€æ­¥ï¼šåˆ†æåœ¨ä»€ä¹ˆæƒ…å†µä¸‹å»ä½¿ç”¨æŒ‚èµ·å‡½æ•°ï¼Ÿ</p><p>å¦‚æœä½ çš„æŸä¸ªå‡½æ•°æ¯”è¾ƒè€—æ—¶ï¼Œæ¶‰åŠåˆ°å¤šçº¿ç¨‹æ“ä½œï¼Œå¦‚ï¼šç½‘ç»œè¯·æ±‚ï¼ŒI&#x2F;O æ“ä½œï¼ŒCPU è®¡ç®—å·¥ä½œç­‰éœ€è¦ç­‰å¾…çš„æ“ä½œï¼Œé‚£å°±æŠŠå®ƒå†™æˆ suspend æŒ‚èµ·å‡½æ•°ï¼Œè¿™æ˜¯åŸåˆ™</p><p>ç¬¬äºŒæ­¥ï¼šä½¿ç”¨ suspend å…³é”®å­—ä¿®é¥°ä½ çš„å‡½æ•°ï¼Œå¹¶åœ¨å‡½æ•°å†…éƒ¨è°ƒç”¨ Kotin åç¨‹æ¡†æ¶æä¾›çš„æŒ‚èµ·å‡½æ•°ï¼Œå¦‚ä¸‹ï¼š</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-keyword">suspend</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">mockTimeConsume</span><span class="hljs-params">()</span></span> = withContext(Dispatchers.IO)&#123;<br>   Log.d(TAG, <span class="hljs-string">&quot;ç´§å¼ çš„æ‰§è¡Œè€—æ—¶ä»»åŠ¡ä¸­... &quot;</span> +  + Thread.currentThread().name);<br>   Thread.sleep(<span class="hljs-number">3000</span>)<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="åä¸‰ã€æ€»ç»“"><a href="#åä¸‰ã€æ€»ç»“" class="headerlink" title="åä¸‰ã€æ€»ç»“"></a>åä¸‰ã€æ€»ç»“</h2><p>è¿™ç¯‡æ–‡ç« è®²åˆ°äº†ï¼š</p><p>1ã€Kotlin åç¨‹ä¸­æ¶‰åŠåˆ°çš„ä¸€äº›åŸºç¡€æ¦‚å¿µçš„ç†è§£</p><p>2ã€Kotlin åç¨‹çš„åŸºç¡€ä½¿ç”¨ï¼Œä»¥åŠä¸€äº›åç¨‹ä½œç”¨åŸŸæ„å»ºå™¨</p><p>3ã€Kotlin åç¨‹ä¸­å…³äºæŒ‚èµ·çš„ä¸€ä¸ªè¯¦ç»†ä»‹ç»</p><p>åç¨‹çš„å†…å®¹çœŸçš„æŒºå¤šçš„ï¼Œåç»­æˆ‘è¿˜ä¼šå†™ä¸¤ç¯‡å…³äºåç¨‹çš„æ–‡ç« ï¼Œå¸Œæœ›èƒ½ç»™ä½ å¸¦æ¥å¸®åŠ© ğŸ¤</p><p><strong>æ„Ÿè°¢ä½ é˜…è¯»è¿™ç¯‡æ–‡ç« </strong></p><h3 id="å‚è€ƒå’Œæ¨è"><a href="#å‚è€ƒå’Œæ¨è" class="headerlink" title="å‚è€ƒå’Œæ¨è"></a>å‚è€ƒå’Œæ¨è</h3><p>[ç¬¬ä¸€è¡Œä»£ç  Android ç¬¬3ç‰ˆ]</p><p><a href="https://rengwuxian.com/kotlin-coroutines-2/">æ‰”ç‰©çº¿ - Kotlin åç¨‹çš„æŒ‚èµ·å¥½ç¥å¥‡å¥½éš¾æ‡‚ï¼Ÿä»Šå¤©æˆ‘æŠŠå®ƒçš„çš®ç»™æ‰’äº†</a></p><blockquote><p><strong>ä½ çš„ç‚¹èµï¼Œè¯„è®ºï¼Œæ˜¯å¯¹æˆ‘å·¨å¤§çš„é¼“åŠ±ï¼</strong></p><p>æ¬¢è¿å…³æ³¨æˆ‘çš„<strong>å…¬ä¼—å·ï¼š</strong>  <a href="http://m6z.cn/6jwi7b"><strong>sweetying</strong></a> ï¼Œæ–‡ç« æ›´æ–°å¯ç¬¬ä¸€æ—¶é—´æ”¶åˆ°</p><p>å¦‚æœ<strong>æœ‰é—®é¢˜</strong>ï¼Œå…¬ä¼—å·å†…æœ‰åŠ æˆ‘å¾®ä¿¡çš„å…¥å£ï¼Œåœ¨æŠ€æœ¯å­¦ä¹ ã€ä¸ªäººæˆé•¿çš„é“è·¯ä¸Šï¼Œæˆ‘ä»¬ä¸€èµ·å‰è¿›ï¼</p></blockquote>]]></content>
    
    
    <categories>
      
      <category>Android</category>
      
      <category>Kotlin</category>
      
    </categories>
    
    
    <tags>
      
      <tag>åŸåˆ›</tag>
      
      <tag>Android</tag>
      
      <tag>Kotlin</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Kotlin ç³»åˆ—ï¼ˆäºŒï¼‰ï¼šKotlinæ³›å‹</title>
    <link href="/2022/10/11/Kotlin%20%E7%B3%BB%E5%88%97%EF%BC%88%E4%BA%8C%EF%BC%89%EF%BC%9AKotlin%E6%B3%9B%E5%9E%8B/"/>
    <url>/2022/10/11/Kotlin%20%E7%B3%BB%E5%88%97%EF%BC%88%E4%BA%8C%EF%BC%89%EF%BC%9AKotlin%E6%B3%9B%E5%9E%8B/</url>
    
    <content type="html"><![CDATA[<p><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/05b521446f194f10b323e77e9accaac1~tplv-k3u1fbpfcp-watermark.image"></p><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>å¾ˆé«˜å…´é‡è§ä½ ~</p><p>åœ¨æœ¬ç³»åˆ—çš„ä¸Šä¸€ç¯‡ä¸­ï¼Œæˆ‘ä»¬å­¦ä¹ äº† Kotlin å¤§éƒ¨åˆ†çŸ¥è¯†ç‚¹ï¼Œä½“éªŒåˆ°äº† Kotlin è¯­æ³•çš„ä¾¿æ·ï¼Œå¼ºå¤§ï¼Œä»¥åŠé«˜æ•ˆçš„å‡½æ•°å¼ç¼–ç¨‹ã€‚è¿˜æ²¡æœ‰çœ‹è¿‡ä¸Šä¸€ç¯‡æ–‡ç« çš„æœ‹å‹ï¼Œå»ºè®®å…ˆå»é˜…è¯» <a href="https://juejin.cn/post/6942251919662383134">â€œKotlinâ€ç³»åˆ—: ä¸€ã€Kotlinå…¥é—¨</a>ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å°±è¿›å…¥ Kotlin æ³›å‹çš„å­¦ä¹ ï¼Œæ³›å‹åœ¨æˆ‘çœ‹æ¥æ˜¯æ¯”è¾ƒå¤æ‚çš„ï¼ŒåŒæ—¶ä¹Ÿæ˜¯é¢è¯•ä¸­ç»å¸¸é—®çš„ï¼Œå¾ˆé•¿ä¸€æ®µæ—¶é—´ï¼Œæˆ‘å¯¹æ³›å‹çš„è®¤è¯†æ¯”è¾ƒæ¨¡ç³Šï¼Œé‚£ä¹ˆåœ¨ä½¿ç”¨çš„æ—¶å€™å°±æ›´åŠ ç–‘æƒ‘äº†ï¼Œå› æ­¤è¿™ç¯‡æ–‡ç« å¸Œæœ›èƒ½å¸¦å¤§å®¶æ”»å…‹è¿™ä¸€çŸ¥è¯†ç‚¹</p><h2 id="é—®é¢˜"><a href="#é—®é¢˜" class="headerlink" title="é—®é¢˜"></a>é—®é¢˜</h2><p>ä¸‹é¢æˆ‘æŠ›å‡ºä¸€ç³»åˆ—é—®é¢˜ï¼Œå’±ä»¬å¸¦ç€é—®é¢˜å»å­¦ä¹ ï¼š</p><p>1ã€ä»€ä¹ˆæ˜¯æ³›å‹ï¼Ÿ</p><p>2ã€æ³›å‹æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ</p><p>3ã€æ€ä¹ˆå»å®šä¹‰å’Œä½¿ç”¨æ³›å‹ï¼Ÿ</p><h3 id="1ã€ä»€ä¹ˆæ˜¯æ³›å‹ï¼Ÿ"><a href="#1ã€ä»€ä¹ˆæ˜¯æ³›å‹ï¼Ÿ" class="headerlink" title="1ã€ä»€ä¹ˆæ˜¯æ³›å‹ï¼Ÿ"></a>1ã€ä»€ä¹ˆæ˜¯æ³›å‹ï¼Ÿ</h3><p>æ³›å‹é€šä¿—çš„ç†è§£å°±æ˜¯ï¼šå¾ˆå¤šçš„ç±»å‹ï¼Œå®ƒé€šè¿‡ä½¿ç”¨<strong>å‚æ•°åŒ–ç±»å‹</strong>çš„æ¦‚å¿µï¼Œå…è®¸æˆ‘ä»¬åœ¨ä¸æŒ‡å®šå…·ä½“ç±»å‹çš„æƒ…å†µä¸‹è¿›è¡Œç¼–ç¨‹</p><h3 id="2ã€æ³›å‹æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ"><a href="#2ã€æ³›å‹æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ" class="headerlink" title="2ã€æ³›å‹æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ"></a>2ã€æ³›å‹æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ</h3><p>æ³›å‹æ˜¯ JDK 1.5 å¼•å…¥çš„å®‰å…¨æœºåˆ¶ï¼Œæ˜¯ä¸€ç§ç»™ç¼–è¯‘å™¨ä½¿ç”¨çš„æŠ€æœ¯ï¼š</p><p>1ã€æé«˜äº†ä»£ç çš„å¯é‡ç”¨æ€§</p><p>2ã€å°†è¿è¡ŒæœŸçš„ç±»å‹è½¬æ¢å¼‚å¸¸æå‰åˆ°äº†ç¼–è¯‘æœŸï¼Œä¿è¯ç±»å‹çš„å®‰å…¨ï¼Œé¿å…ç±»å‹è½¬æ¢å¼‚å¸¸</p><h3 id="3ã€æ€ä¹ˆå»å®šä¹‰å’Œä½¿ç”¨æ³›å‹ï¼Ÿ"><a href="#3ã€æ€ä¹ˆå»å®šä¹‰å’Œä½¿ç”¨æ³›å‹ï¼Ÿ" class="headerlink" title="3ã€æ€ä¹ˆå»å®šä¹‰å’Œä½¿ç”¨æ³›å‹ï¼Ÿ"></a>3ã€æ€ä¹ˆå»å®šä¹‰å’Œä½¿ç”¨æ³›å‹ï¼Ÿ</h3><p>æˆ‘ä»¬å¯ä»¥ç»™ä¸€ä¸ªç±»ï¼Œæ–¹æ³•ï¼Œæˆ–è€…æ¥å£æŒ‡å®šæ³›å‹ï¼Œåœ¨å…·ä½“ä½¿ç”¨çš„åœ°æ–¹æŒ‡å®šå…·ä½“çš„ç±»å‹</p><h2 id="ä¸€ã€Java-æ³›å‹"><a href="#ä¸€ã€Java-æ³›å‹" class="headerlink" title="ä¸€ã€Java æ³›å‹"></a>ä¸€ã€Java æ³›å‹</h2><p>è¦å­¦ä¹ å¥½ Kotlin æ³›å‹ï¼Œæˆ‘ä»¬å…ˆè¦å¯¹ Java æ³›å‹è¶³å¤Ÿçš„äº†è§£ï¼Œå› ä¸º Kotlin æ³›å‹å’Œ Java æ³›å‹åŸºæœ¬ä¸Šæ˜¯ä¸€æ ·çš„ï¼Œåªä¸è¿‡åœ¨ Kotlin ä¸Šæœ‰äº›ä¸œè¥¿æ¢äº†æ–°çš„å†™æ³•</p><h3 id="1ã€æ³›å‹çš„ç®€å•ä½¿ç”¨"><a href="#1ã€æ³›å‹çš„ç®€å•ä½¿ç”¨" class="headerlink" title="1ã€æ³›å‹çš„ç®€å•ä½¿ç”¨"></a>1ã€æ³›å‹çš„ç®€å•ä½¿ç”¨</h3><p>åœ¨ Java ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ç»™ä¸€ä¸ªç±»ï¼Œæ–¹æ³•ï¼Œæˆ–è€…æ¥å£æŒ‡å®šæ³›å‹ï¼Œåœ¨å…·ä½“ä½¿ç”¨çš„åœ°æ–¹æŒ‡å®šå…·ä½“çš„ç±»å‹</p><p>1ï¼‰ã€å®šä¹‰ä¸€ä¸ªæ³›å‹ç±»ï¼Œåœ¨ç±»åçš„åé¢åŠ ä¸Š <code>&lt;T&gt;</code> è¿™ç§è¯­æ³•ç»“æ„å°±æ˜¯å®šä¹‰ä¸€ä¸ªæ³›å‹ç±»ï¼Œæ³›å‹å¯ä»¥æœ‰ä»»æ„å¤šä¸ª</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//å®šä¹‰ä¸€ä¸ªæ³›å‹ç±»</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">JavaGenericClass</span>&lt;T&gt; &#123;<br><br>    <span class="hljs-keyword">private</span> T a;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">JavaGenericClass</span><span class="hljs-params">(T a)</span> &#123;<br>        <span class="hljs-built_in">this</span>.a = a;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> T <span class="hljs-title function_">getA</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> a;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setA</span><span class="hljs-params">(T a)</span> &#123;<br>        <span class="hljs-built_in">this</span>.a = a;<br>    &#125;<br><br>    <span class="hljs-comment">//æ³›å‹ç±»ä½¿ç”¨</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>      <span class="hljs-comment">//ç¼–è¯‘å™¨å¯æ¨æ–­æ³›å‹ç±»å‹ï¼Œå› æ­¤ new å¯¹è±¡åé¢çš„æ³›å‹ç±»å‹å¯çœç•¥</span><br>        JavaGenericClass&lt;String&gt; javaGenericClass1 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">JavaGenericClass</span>&lt;String&gt;(<span class="hljs-string">&quot;erdai&quot;</span>);<br>        JavaGenericClass&lt;Integer&gt; javaGenericClass2 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">JavaGenericClass</span>&lt;&gt;(<span class="hljs-number">666</span>);<br>        System.out.println(javaGenericClass1.getA());<br>        System.out.println(javaGenericClass2.getA());<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">//æ‰“å°ç»“æœ</span><br>erdai<br><span class="hljs-number">666</span><br></code></pre></td></tr></table></figure><p>2ï¼‰ã€å®šä¹‰ä¸€ä¸ªæ³›å‹æ–¹æ³•ï¼Œåœ¨æ–¹æ³•çš„è¿”å›å€¼å‰é¢åŠ ä¸Š <code>&lt;T&gt;</code> è¿™ç§è¯­æ³•ç»“æ„å°±æ˜¯å®šä¹‰ä¸€ä¸ªæ³›å‹æ–¹æ³•ï¼Œæ³›å‹å¯ä»¥æœ‰ä»»æ„å¤šä¸ªï¼Œæ³›å‹æ–¹æ³•çš„æ³›å‹ä¸å®ƒæ‰€åœ¨çš„ç±»æ²¡æœ‰ä»»ä½•å…³ç³»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">JavaGenericMethod</span> &#123;<br><br>    <span class="hljs-keyword">public</span> &lt;T&gt; <span class="hljs-keyword">void</span> <span class="hljs-title function_">getName</span><span class="hljs-params">(T t)</span>&#123;<br>        System.out.println(t.getClass().getSimpleName());<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-type">JavaGenericMethod</span> <span class="hljs-variable">javaGenericMethod</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">JavaGenericMethod</span>();<br>      <span class="hljs-comment">//ç¼–è¯‘å™¨å¯æ¨æ–­å‡ºæ³›å‹ç±»å‹ï¼Œå› æ­¤è¿™é‡Œçš„æ³›å‹ç±»å‹ä¹Ÿå¯çœç•¥</span><br>        javaGenericMethod.&lt;String&gt;getName(<span class="hljs-string">&quot;erdai666&quot;</span>);<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">//æ‰“å°ç»“æœ</span><br>String<br></code></pre></td></tr></table></figure><p>3ï¼‰ã€å®šä¹‰ä¸€ä¸ªæ³›å‹æ¥å£</p><p>åœ¨æ¥å£åçš„åé¢åŠ ä¸Š <code>&lt;T&gt;</code> è¿™ç§è¯­æ³•ç»“æ„å°±æ˜¯å®šä¹‰ä¸€ä¸ªæ³›å‹æ¥å£ï¼Œæ³›å‹å¯ä»¥æœ‰ä»»æ„å¤šä¸ª</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">JavaGenericInterface</span>&lt;T&gt; &#123;<br><br>    T <span class="hljs-title function_">get</span><span class="hljs-params">()</span>;<br>&#125;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">TestClass</span>&lt;T&gt; <span class="hljs-keyword">implements</span> <span class="hljs-title class_">JavaGenericInterface</span>&lt;T&gt;&#123;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> T t;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">TestClass</span><span class="hljs-params">(T t)</span> &#123;<br>        <span class="hljs-built_in">this</span>.t = t;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> T <span class="hljs-title function_">get</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> t;<br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Client</span>&#123;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        JavaGenericInterface&lt;String&gt; javaGenericInterface = <span class="hljs-keyword">new</span> <span class="hljs-title class_">TestClass</span>&lt;&gt;(<span class="hljs-string">&quot;erdai666&quot;</span>);<br>        System.out.println(javaGenericInterface.get());<br>    &#125;<br>&#125;<br><span class="hljs-comment">//æ‰“å°ç»“æœ</span><br>erdai666<br></code></pre></td></tr></table></figure><h3 id="2ã€æ³›å‹æ“¦é™¤"><a href="#2ã€æ³›å‹æ“¦é™¤" class="headerlink" title="2ã€æ³›å‹æ“¦é™¤"></a>2ã€æ³›å‹æ“¦é™¤</h3><h4 id="1ã€æ³›å‹æ“¦é™¤æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#1ã€æ³›å‹æ“¦é™¤æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="1ã€æ³›å‹æ“¦é™¤æ˜¯ä»€ä¹ˆï¼Ÿ"></a>1ã€æ³›å‹æ“¦é™¤æ˜¯ä»€ä¹ˆï¼Ÿ</h4><p>çœ‹ä¸‹é¢è¿™æ®µä»£ç ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//ä½¿ç”¨äº†ä¸åŒçš„æ³›å‹ç±»å‹ ç»“æœå¾—åˆ°äº†ç›¸åŒçš„æ•°æ®ç±»å‹</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">JavaGenericWipe</span> &#123;<br>  <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-type">Class</span> <span class="hljs-variable">a</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;String&gt;().getClass();<br>        <span class="hljs-type">Class</span> <span class="hljs-variable">b</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;Integer&gt;().getClass();<br><br>        System.out.println(<span class="hljs-string">&quot;a = &quot;</span> + a);<br>        System.out.println(<span class="hljs-string">&quot;b = &quot;</span> + b);<br>        System.out.println(<span class="hljs-string">&quot;a == b: &quot;</span> + (a == b));<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">//æ‰“å°ç»“æœ</span><br>a = <span class="hljs-keyword">class</span> <span class="hljs-title class_">java</span>.util.<span class="hljs-type">ArrayList</span><br><span class="hljs-variable">b</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">java</span>.util.ArrayList<br>a == b: <span class="hljs-literal">true</span><br></code></pre></td></tr></table></figure><p>ä¸ºå•¥ä¼šå‡ºç°è¿™ç§æƒ…å†µå‘¢ï¼Ÿ</p><p>å› ä¸º Java ä¸­çš„æ³›å‹æ˜¯ä½¿ç”¨æ“¦é™¤æŠ€æœ¯æ¥å®ç°çš„ï¼š<strong>æ³›å‹æ“¦é™¤æ˜¯æŒ‡é€šè¿‡ç±»å‹å‚æ•°åˆå¹¶ï¼Œå°†æ³›å‹ç±»å‹å®ä¾‹å…³è”åˆ°åŒä¸€ä»½å­—èŠ‚ç ä¸Šã€‚ç¼–è¯‘å™¨åªä¸ºæ³›å‹ç±»å‹ç”Ÿæˆä¸€ä»½å­—èŠ‚ç ï¼Œå¹¶å°†å…¶å®ä¾‹å…³è”åˆ°è¿™ä»½å­—èŠ‚ç ä¸Š</strong></p><p>ä¹‹æ‰€ä»¥è¦ä½¿ç”¨æ³›å‹æ“¦é™¤æ˜¯ä¸ºäº†å…¼å®¹ JDK 1.5 ä¹‹å‰è¿è¡Œæ—¶çš„ç±»åŠ è½½å™¨ï¼Œé¿å…å› ä¸ºå¼•å…¥æ³›å‹è€Œå¯¼è‡´è¿è¡Œæ—¶åˆ›å»ºä¸å¿…è¦çš„ç±»</p><h4 id="2ã€æ³›å‹æ“¦é™¤çš„å…·ä½“æ­¥éª¤"><a href="#2ã€æ³›å‹æ“¦é™¤çš„å…·ä½“æ­¥éª¤" class="headerlink" title="2ã€æ³›å‹æ“¦é™¤çš„å…·ä½“æ­¥éª¤"></a>2ã€æ³›å‹æ“¦é™¤çš„å…·ä½“æ­¥éª¤</h4><p>1ï¼‰ã€æ“¦é™¤æ‰€æœ‰ç±»å‹å‚æ•°ä¿¡æ¯ï¼Œå¦‚æœç±»å‹å‚æ•°æ˜¯æœ‰ç•Œçš„ï¼Œåˆ™å°†æ¯ä¸ªå‚æ•°æ›¿æ¢ä¸ºå…¶ç¬¬ä¸€ä¸ªè¾¹ç•Œï¼›å¦‚æœç±»å‹å‚æ•°æ˜¯æ— ç•Œçš„ï¼Œåˆ™å°†å…¶æ›¿æ¢ä¸º Objectç±»å‹æ“¦é™¤çš„è§„åˆ™ï¼š</p><blockquote><p><code>&lt;T&gt;</code> æ“¦é™¤åå˜ä¸º Object </p><p><code>&lt;T extends A&gt;</code> æ“¦é™¤åå˜ä¸º A </p><p><code>&lt;? extends A&gt;</code>  æ“¦é™¤åå˜ä¸º A</p><p><code>&lt;? super A&gt;</code> æ“¦é™¤åå˜ä¸ºObject</p></blockquote><p>2ï¼‰ã€ï¼ˆå¿…è¦æ—¶ï¼‰æ’å…¥ç±»å‹è½¬æ¢ï¼Œä»¥ä¿æŒç±»å‹å®‰å…¨</p><p>3ï¼‰ã€ï¼ˆå¿…è¦æ—¶ï¼‰ç”Ÿæˆæ¡¥æ¥æ–¹æ³•ä»¥åœ¨å­ç±»ä¸­ä¿ç•™å¤šæ€æ€§</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//æƒ…å†µ1: æ“¦é™¤æ‰€æœ‰ç±»å‹å‚æ•°ä¿¡æ¯ï¼Œå¦‚æœç±»å‹å‚æ•°æ˜¯æœ‰ç•Œçš„ï¼Œåˆ™å°†æ¯ä¸ªå‚æ•°æ›¿æ¢ä¸ºå…¶ç¬¬ä¸€ä¸ªè¾¹ç•Œï¼›å¦‚æœç±»å‹å‚æ•°æ˜¯æ— ç•Œçš„ï¼Œåˆ™å°†å…¶æ›¿æ¢ä¸º Object</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Paint</span> &#123;<br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">draw</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;Paint.draw() called&quot;</span>);<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">//å¦‚æœä¸ç»™ T è®¾ç½®è¾¹ç•Œï¼Œé‚£ä¹ˆ work æ–¹æ³•é‡Œé¢çš„ t å°±è°ƒç”¨ä¸åˆ° draw æ–¹æ³•</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Painter</span>&lt;T <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Paint</span>&gt; &#123;<br>    <span class="hljs-keyword">private</span> T t;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Painter</span><span class="hljs-params">(T t)</span> &#123;<br>        <span class="hljs-built_in">this</span>.t = t;<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">work</span><span class="hljs-params">()</span> &#123;<br>        t.draw();<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">//æƒ…å†µ2ï¼šï¼ˆå¿…è¦æ—¶ï¼‰æ’å…¥ç±»å‹è½¬æ¢ï¼Œä»¥ä¿æŒç±»å‹å®‰å…¨</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">JavaGenericWipe</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        List&lt;String&gt; stringList = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();<br>        stringList.add(<span class="hljs-string">&quot;erdai&quot;</span>);<br>        stringList.add(<span class="hljs-string">&quot;666&quot;</span>);<br><br>        <span class="hljs-keyword">for</span> (String s : stringList) &#123;<br>            System.out.println(s);<br>        &#125;<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">//ç¼–è¯‘æ—¶ç”Ÿæˆçš„å­—èŠ‚ç æ–‡ä»¶ç¿»è¯‘è¿‡æ¥å¤§è‡´å¦‚ä¸‹</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">JavaGenericWipe</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">JavaGenericWipe</span><span class="hljs-params">()</span> &#123;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        List&lt;String&gt; stringList = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>();<br>        stringList.add(<span class="hljs-string">&quot;erdai&quot;</span>);<br>        stringList.add(<span class="hljs-string">&quot;666&quot;</span>);<br>        <span class="hljs-type">Iterator</span> <span class="hljs-variable">var2</span> <span class="hljs-operator">=</span> stringList.iterator();<br><br>        <span class="hljs-keyword">while</span>(var2.hasNext()) &#123;<br>            <span class="hljs-comment">//ç¼–è¯‘å™¨ç»™æˆ‘ä»¬åšäº†å¼ºè½¬çš„å·¥ä½œ</span><br>            <span class="hljs-type">String</span> <span class="hljs-variable">s</span> <span class="hljs-operator">=</span> (String)var2.next();<br>            System.out.println(s);<br>        &#125;<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">//æƒ…å†µ3 ï¼ˆå¿…è¦æ—¶ï¼‰ç”Ÿæˆæ¡¥æ¥æ–¹æ³•ä»¥åœ¨å­ç±»ä¸­ä¿ç•™å¤šæ€æ€§</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Node</span> &#123;<br>    <span class="hljs-keyword">public</span> Object data;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Node</span><span class="hljs-params">(Object data)</span> &#123;<br>        <span class="hljs-built_in">this</span>.data = data;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setData</span><span class="hljs-params">(Object data)</span> &#123;<br>        <span class="hljs-built_in">this</span>.data = data;<br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyNode</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Node</span> &#123;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">MyNode</span><span class="hljs-params">(Integer data)</span> &#123;<br>        <span class="hljs-built_in">super</span>(data);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setData</span><span class="hljs-params">(Integer data)</span> &#123;<br>        <span class="hljs-built_in">super</span>.setData(data);<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">//ç¼–è¯‘æ—¶ç”Ÿæˆçš„å­—èŠ‚ç æ–‡ä»¶ç¿»è¯‘è¿‡æ¥å¤§è‡´å¦‚ä¸‹</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyNode</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Node</span> &#123;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">MyNode</span><span class="hljs-params">(Integer data)</span> &#123;<br>        <span class="hljs-built_in">super</span>(data);<br>    &#125;<br>    <span class="hljs-comment">// ç¼–è¯‘å™¨ç”Ÿæˆçš„æ¡¥æ¥æ–¹æ³•</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setData</span><span class="hljs-params">(Object data)</span> &#123;<br>        setData((Integer) data);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setData</span><span class="hljs-params">(Integer data)</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;MyNode.setData&quot;</span>);<br>        <span class="hljs-built_in">super</span>.setData(data);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="3ã€ä¼ªæ³›å‹"><a href="#3ã€ä¼ªæ³›å‹" class="headerlink" title="3ã€ä¼ªæ³›å‹"></a>3ã€ä¼ªæ³›å‹</h4><p>Java ä¸­çš„æ³›å‹æ˜¯ä¸€ç§ç‰¹æ®Šçš„è¯­æ³•ç³–ï¼Œé€šè¿‡ç±»å‹æ“¦é™¤å®ç°ï¼Œè¿™ç§æ³›å‹ç§°ä¸ºä¼ªæ³›å‹ï¼Œæˆ‘ä»¬å¯ä»¥åå°„ç»•è¿‡ç¼–è¯‘å™¨æ³›å‹æ£€æŸ¥ï¼Œæ·»åŠ ä¸€ä¸ªä¸åŒç±»å‹çš„å‚æ•°</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//åå°„ç»•è¿‡ç¼–è¯‘å™¨æ£€æŸ¥</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>    <br>     List&lt;String&gt; stringList = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();<br>     stringList.add(<span class="hljs-string">&quot;erdai&quot;</span>);<br>     stringList.add(<span class="hljs-string">&quot;666&quot;</span>);<br><br>     <span class="hljs-comment">//ä½¿ç”¨åå°„å¢åŠ ä¸€ä¸ªæ–°çš„å…ƒç´ </span><br>     Class&lt;? <span class="hljs-keyword">extends</span> <span class="hljs-title class_">List</span>&gt; aClass = stringList.getClass();<br>     <span class="hljs-keyword">try</span> &#123;<br>         <span class="hljs-type">Method</span> <span class="hljs-variable">method</span> <span class="hljs-operator">=</span> aClass.getMethod(<span class="hljs-string">&quot;add&quot;</span>, Object.class);<br>         method.invoke(stringList,<span class="hljs-number">123</span>);<br>     &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>         e.printStackTrace();<br>     &#125;<br><br>     <span class="hljs-type">Iterator</span> <span class="hljs-variable">iterator</span> <span class="hljs-operator">=</span> stringList.iterator();<br>     <span class="hljs-keyword">while</span> (iterator.hasNext())&#123;<br>         System.out.println(iterator.next());<br>     &#125;<br>&#125;<br><span class="hljs-comment">//æ‰“å°ç»“æœ</span><br>erdai<br><span class="hljs-number">666</span><br><span class="hljs-number">123</span><br></code></pre></td></tr></table></figure><h4 id="4ã€æ³›å‹æ“¦é™¤è¿›é˜¶"><a href="#4ã€æ³›å‹æ“¦é™¤è¿›é˜¶" class="headerlink" title="4ã€æ³›å‹æ“¦é™¤è¿›é˜¶"></a>4ã€æ³›å‹æ“¦é™¤è¿›é˜¶</h4><p>ä¸‹é¢æˆ‘æŠ›å‡ºä¸€ä¸ªåœ¨å·¥ä½œä¸­ç»å¸¸ä¼šé‡åˆ°çš„é—®é¢˜ï¼š</p><p>åœ¨è¿›è¡Œç½‘ç»œè¯·æ±‚çš„æ—¶å€™ï¼Œä¼ å…¥ä¸€ä¸ªæ³›å‹çš„å®é™…ç±»å‹ï¼Œä¸ºå•¥èƒ½å¤Ÿæ­£ç¡®çš„è·å–åˆ°è¯¥æ³›å‹ç±»å‹ï¼Œå¹¶åˆ©ç”¨ Gson è½¬æ¢ä¸ºå®é™…çš„å¯¹è±¡ï¼Ÿ</p><p>ç­”ï¼šæ˜¯å› ä¸ºåœ¨è¿è¡ŒæœŸæˆ‘ä»¬å¯ä»¥ä½¿ç”¨åå°„è·å–åˆ°å…·ä½“çš„æ³›å‹ç±»å‹</p><p>What? æ³›å‹ä¸æ˜¯åœ¨ç¼–è¯‘çš„æ—¶å€™è¢«æ“¦é™¤äº†å—ï¼Ÿä¸ºå•¥åœ¨è¿è¡Œæ—¶è¿˜èƒ½å¤Ÿè·å–åˆ°å…·ä½“çš„æ³›å‹ç±»å‹ï¼ŸğŸ¤”ï¸</p><p>ç­”ï¼šæ³›å‹ä¸­æ‰€è°“çš„ç±»å‹æ“¦é™¤ï¼Œå…¶å®åªæ˜¯æ“¦é™¤ Code å±æ€§ä¸­çš„æ³›å‹ä¿¡æ¯ï¼Œåœ¨ç±»å¸¸é‡æ± å±æ€§ï¼ˆSignature å±æ€§ã€LocalVariableTypeTable å±æ€§ï¼‰ä¸­å…¶å®è¿˜ä¿ç•™ç€æ³›å‹ä¿¡æ¯ï¼Œè€Œç±»å¸¸é‡æ± ä¸­çš„å±æ€§å¯ä»¥è¢« class æ–‡ä»¶ï¼Œå­—æ®µè¡¨ï¼Œæ–¹æ³•è¡¨ç­‰æºå¸¦ï¼Œè¿™å°±ä½¿å¾—æˆ‘ä»¬å£°æ˜çš„æ³›å‹ä¿¡æ¯å¾—ä»¥ä¿ç•™ï¼Œè¿™ä¹Ÿæ˜¯æˆ‘ä»¬åœ¨è¿è¡Œæ—¶å¯ä»¥åå°„è·å–æ³›å‹ä¿¡æ¯çš„æ ¹æœ¬ä¾æ®</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//è¿™æ˜¯åç¼–è¯‘åçš„ JavaGenericClass.class æ–‡ä»¶ï¼Œå¯ä»¥çœ‹åˆ° T</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">JavaGenericClass</span>&lt;T&gt; &#123;<br><br>    <span class="hljs-keyword">private</span> T a;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">JavaGenericClass</span><span class="hljs-params">(T a)</span> &#123;<br>        <span class="hljs-built_in">this</span>.a = a;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> T <span class="hljs-title function_">getA</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> a;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setA</span><span class="hljs-params">(T a)</span> &#123;<br>        <span class="hljs-built_in">this</span>.a = a;<br>    &#125;<br>  <br>  <span class="hljs-comment">//...</span><br>&#125;<br></code></pre></td></tr></table></figure><p><strong>æ³¨æ„</strong>ï¼šJava æ˜¯åœ¨ JDK 1.5 å¼•å…¥çš„æ³›å‹ï¼Œä¸ºäº†å¼¥è¡¥æ³›å‹æ“¦é™¤çš„ä¸è¶³ï¼ŒJVM çš„ class æ–‡ä»¶ä¹Ÿåšäº†ç›¸åº”çš„ä¿®æ”¹ï¼Œå…¶ä¸­æœ€é‡è¦çš„å°±æ˜¯æ–°å¢äº† <strong>Signature</strong> å±æ€§è¡¨å’Œ <strong>LocalVariableTypeTable</strong> å±æ€§è¡¨</p><p>æˆ‘ä»¬çœ‹ä¸‹ä¸‹é¢è¿™æ®µä»£ç ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">class</span> <span class="hljs-title class_">ParentGeneric</span>&lt;T&gt; &#123;<br><br>&#125;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">SubClass</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">ParentGeneric</span>&lt;String&gt;&#123;<br><br>&#125;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">SubClass2</span>&lt;T&gt; <span class="hljs-keyword">extends</span> <span class="hljs-title class_">ParentGeneric</span>&lt;T&gt; &#123;<br><br>&#125;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">GenericGet</span> &#123;<br><br>    <span class="hljs-comment">//è·å–å®é™…çš„æ³›å‹ç±»å‹</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> &lt;T&gt; Type <span class="hljs-title function_">findGenericType</span><span class="hljs-params">(Class&lt;T&gt; cls)</span> &#123;<br>        <span class="hljs-type">Type</span> <span class="hljs-variable">genType</span> <span class="hljs-operator">=</span> cls.getGenericSuperclass();<br>        <span class="hljs-type">Type</span> <span class="hljs-variable">finalNeedType</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br>        <span class="hljs-keyword">if</span> (genType <span class="hljs-keyword">instanceof</span> ParameterizedType) &#123;<br>            Type[] params = ((ParameterizedType) genType).getActualTypeArguments();<br>            finalNeedType = params[<span class="hljs-number">0</span>];<br>        &#125;<br>        <span class="hljs-keyword">return</span> finalNeedType;<br>    &#125;<br>  <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-type">SubClass</span> <span class="hljs-variable">subClass</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SubClass</span>();<br>SubClass2&lt;Integer&gt; subClass2 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">SubClass2</span>&lt;Integer&gt;();<br>        <span class="hljs-comment">//æ‰“å° subClass è·å–çš„æ³›å‹</span><br>        System.out.println(<span class="hljs-string">&quot;subClass: &quot;</span> + findNeedClass(subClass.getClass()));<br>      <span class="hljs-comment">//æ‰“å°subClass2è·å–çš„æ³›å‹</span><br>        System.out.println(<span class="hljs-string">&quot;subClass2: &quot;</span> + findGenericType(subClass2.getClass()));<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">//è¿è¡Œè¿™æ®µä»£ç  æ‰“å°ç»“æœå¦‚ä¸‹</span><br>subClass: <span class="hljs-keyword">class</span> <span class="hljs-title class_">java</span>.lang.String<br>subClass2: T<br></code></pre></td></tr></table></figure><p>ä¸Šé¢ä»£ç ï¼š</p><p>1ã€ SubClass ç›¸å½“äºå¯¹ ParentGeneric<T> åšäº†èµ‹å€¼æ“ä½œ T &#x3D; Stringï¼Œæˆ‘ä»¬é€šè¿‡åå°„è·å–åˆ°äº†æ³›å‹ç±»å‹ä¸º String</p><p>2ã€SubClass2 å¯¹ ParentGeneric<T>æ²¡æœ‰åšèµ‹å€¼æ“ä½œ ï¼Œæˆ‘ä»¬é€šè¿‡åå°„è·å–åˆ°äº†æ³›å‹ç±»å‹ä¸º T </p><p>è¿™é‡Œå¤§å®¶è‚¯å®šä¼šæœ‰å¾ˆå¤šç–‘é—®ï¼Ÿ</p><p>1ã€ä¸ºå•¥ 1 ä¸­æ²¡æœ‰ä¼ å…¥ä»»ä½•æ³›å‹çš„ä¿¡æ¯å´èƒ½è·å–åˆ°æ³›å‹ç±»å‹å‘¢ï¼Ÿ</p><p>2ã€ä¸ºå•¥ 2 ä¸­æˆ‘åˆ›å»ºå¯¹è±¡çš„æ—¶å€™ä¼ å…¥çš„æ³›å‹æ˜¯ Integer ï¼Œè·å–çš„æ—¶å€™å˜æˆäº† T å‘¢ï¼Ÿ</p><p>ç°åœ¨æˆ‘ä»¬æ¥ä»”ç»†åˆ†æä¸€æ³¢ï¼š</p><p>ä¸Šé¢æˆ‘è®²è¿‡ï¼Œç±»å‹æ“¦é™¤å…¶å®åªæ˜¯æ“¦é™¤ Code å±æ€§ä¸­çš„æ³›å‹ä¿¡æ¯ï¼Œåœ¨ç±»å¸¸é‡æ± å±æ€§ä¸­è¿˜ä¿ç•™ç€æ³›å‹ä¿¡æ¯ï¼Œå› æ­¤ä¸Šé¢çš„ SubClass å’ŒSubClass2 åœ¨ç¼–è¯‘çš„æ—¶å€™å…¶å®ä¼šä¿ç•™å„è‡ªçš„æ³›å‹åˆ°å­—èŠ‚ç æ–‡ä»¶ä¸­ï¼Œä¸€ä¸ªæ˜¯ Stringï¼Œä¸€ä¸ªæ˜¯ T ã€‚è€Œ subClass å’Œ subClass2 æ˜¯è¿è¡Œæ—¶åŠ¨æ€åˆ›å»ºçš„ï¼Œè¿™ä¸ªæ—¶å€™ä½ å³ä½¿ä¼ å…¥äº†æ³›å‹ç±»å‹ï¼Œä¹Ÿä¼šè¢«æ“¦é™¤æ‰ï¼Œå› æ­¤æ‰ä¼šå‡ºç°ä¸Šé¢çš„ç»“æœï¼Œåˆ°è¿™é‡Œï¼Œå¤§å®¶æ˜¯å¦æ˜äº†äº†å‘¢ï¼Ÿ</p><p>å¦‚æœè¿˜æœ‰ç‚¹æ¨¡ç³Šï¼Œæˆ‘ä»¬å†æ¥çœ‹ä¸€ä¸ªä¾‹å­ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">class</span> <span class="hljs-title class_">ParentGeneric</span>&lt;T&gt; &#123;<br><br>&#125;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">GenericGet</span> &#123;<br>    <span class="hljs-comment">//è·å–å®é™…çš„æ³›å‹ç±»å‹</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> &lt;T&gt; Type <span class="hljs-title function_">findGenericType</span><span class="hljs-params">(Class&lt;T&gt; cls)</span> &#123;<br>       <span class="hljs-type">Type</span> <span class="hljs-variable">genType</span> <span class="hljs-operator">=</span> cls.getGenericSuperclass();<br>        <span class="hljs-type">Type</span> <span class="hljs-variable">finalNeedType</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br>        <span class="hljs-keyword">if</span> (genType <span class="hljs-keyword">instanceof</span> ParameterizedType) &#123;<br>            Type[] params = ((ParameterizedType) genType).getActualTypeArguments();<br>            finalNeedType = params[<span class="hljs-number">0</span>];<br>        &#125;<br>        <span class="hljs-keyword">return</span> finalNeedType;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        ParentGeneric&lt;String&gt; parentGeneric1 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ParentGeneric</span>&lt;String&gt;();<br>        ParentGeneric&lt;String&gt; parentGeneric2 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ParentGeneric</span>&lt;String&gt;()&#123;&#125;;<br><br>        <span class="hljs-comment">//æ‰“å° parentGeneric1 è·å–çš„æ³›å‹</span><br>        System.out.println(<span class="hljs-string">&quot;parentGeneric1: &quot;</span> + findGenericType(parentGeneric1.getClass()));<br>        <span class="hljs-comment">//æ‰“å° parentGeneric2 è·å–çš„æ³›å‹</span><br>        System.out.println(<span class="hljs-string">&quot;parentGeneric2: &quot;</span> + findGenericType(parentGeneric2.getClass()));<br><br>    &#125;<br>&#125;<br><span class="hljs-comment">//è¿è¡Œè¿™æ®µä»£ç  æ‰“å°ç»“æœå¦‚ä¸‹</span><br>parentGeneric1: <span class="hljs-literal">null</span><br>parentGeneric2: <span class="hljs-keyword">class</span> <span class="hljs-title class_">java</span>.lang.String<br></code></pre></td></tr></table></figure><p>ä¸Šè¿°ä»£ç  parentGeneric1 å’Œ parentGeneric2 å”¯ä¸€çš„åŒºåˆ«å°±æ˜¯å¤šäº† {}ï¼Œè·å–çš„ç»“æœå´æˆªç„¶ä¸åŒï¼Œæˆ‘ä»¬åœ¨æ¥ä»”ç»†åˆ†æä¸€æ³¢ï¼š</p><p>1ã€ ParentGeneric å£°æ˜çš„æ³›å‹ T åœ¨ç¼–è¯‘çš„æ—¶å€™å…¶å®æ˜¯ä¿ç•™åœ¨äº†å­—èŠ‚ç æ–‡ä»¶ä¸­ï¼ŒparentGeneric1 æ˜¯åœ¨è¿è¡Œæ—¶åˆ›å»ºçš„ï¼Œç”±äºæ³›å‹æ“¦é™¤ï¼Œæˆ‘ä»¬æ— æ³•é€šè¿‡åå°„è·å–å…¶ä¸­çš„ç±»å‹ï¼Œå› æ­¤æ‰“å°äº† null</p><p>è¿™ä¸ªåœ°æ–¹å¯èƒ½å¤§å®¶åˆä¼šæœ‰ä¸ªç–‘é—®äº†ï¼Œä½ æ—¢ç„¶ä¿ç•™äº†æ³›å‹ç±»å‹ä¸º Tï¼Œé‚£ä¹ˆæˆ‘è·å–çš„æ—¶å€™åº”è¯¥ä¸º T æ‰æ˜¯ï¼Œä¸ºå•¥æ‰“å°çš„ç»“æœæ˜¯ null å‘¢ï¼Ÿ</p><p>å¦‚æœä½ å¿ƒé‡Œæœ‰è¿™ä¸ªç–‘é—®ï¼Œè¯´æ˜ä½ æ€è€ƒçš„éå¸¸ç»†è‡´ï¼Œè¦ç†è§£è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬é¦–å…ˆè¦å¯¹ Java ç±»å‹ï¼ˆTypeï¼‰ç³»ç»Ÿæœ‰ä¸€å®šçš„äº†è§£ï¼Œè¿™å…¶å®å’Œæˆ‘ä¸Šé¢å†™çš„é‚£ä¸ªè·å–æ³›å‹ç±»å‹çš„æ–¹æ³•æœ‰å…³ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//è·å–å®é™…çš„æ³›å‹ç±»å‹</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> &lt;T&gt; Type <span class="hljs-title function_">findGenericType</span><span class="hljs-params">(Class&lt;T&gt; cls)</span> &#123;<br>    <span class="hljs-comment">//è·å–å½“å‰å¸¦æœ‰æ³›å‹çš„çˆ¶ç±»</span><br>    <span class="hljs-type">Type</span> <span class="hljs-variable">genType</span> <span class="hljs-operator">=</span> cls.getGenericSuperclass();<br>    <span class="hljs-type">Type</span> <span class="hljs-variable">finalNeedType</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br>    <span class="hljs-comment">//å¦‚æœå½“å‰ genType æ˜¯å‚æ•°åŒ–ç±»å‹åˆ™è¿›å…¥åˆ°æ¡ä»¶ä½“</span><br>    <span class="hljs-keyword">if</span> (genType <span class="hljs-keyword">instanceof</span> ParameterizedType) &#123;<br>      <span class="hljs-comment">//è·å–å‚æ•°ç±»å‹ &lt;&gt; é‡Œé¢çš„é‚£äº›å€¼,ä¾‹å¦‚ Map&lt;K,V&gt; é‚£ä¹ˆå°±å¾—åˆ° [K,V]çš„ä¸€ä¸ªæ•°ç»„</span><br>        Type[] params = ((ParameterizedType) genType).getActualTypeArguments();<br>      <span class="hljs-comment">//å°†ç¬¬ä¸€ä¸ªæ³›å‹ç±»å‹èµ‹å€¼ç»™ finalNeedType</span><br>        finalNeedType = params[<span class="hljs-number">0</span>];<br>    &#125;<br>    <span class="hljs-keyword">return</span> finalNeedType;<br>&#125;<br></code></pre></td></tr></table></figure><p>ä¸Šè¿°ä»£ç æˆ‘ä»¬éœ€è¦å…ˆè·å–è¿™ä¸ªç±»çš„æ³›å‹çˆ¶ç±»ï¼Œå¦‚æœæ˜¯å‚æ•°åŒ–ç±»å‹åˆ™è¿›å…¥åˆ°æ¡ä»¶ä½“ï¼Œè·å–å®é™…çš„æ³›å‹ç±»å‹å¹¶è¿”å›ã€‚å¦‚æœä¸æ˜¯åˆ™ç›´æ¥è¿”å› finalNeedType , é‚£ä¹ˆè¿™ä¸ªæ—¶å€™å°±ä¸º null äº†</p><p>åœ¨ä¾‹1ä¸­ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">SubClass1</span> <span class="hljs-variable">subClass1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SubClass1</span>();<br>SubClass2&lt;Integer&gt; subClass2 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">SubClass2</span>&lt;&gt;();<br>System.out.println(subClass1.getClass().getGenericSuperclass());<br>System.out.println(subClass2.getClass().getGenericSuperclass());<br><span class="hljs-comment">//è¿è¡Œç¨‹åº æ‰“å°ç»“æœå¦‚ä¸‹</span><br>com.dream.java_generic.share.ParentGeneric&lt;java.lang.String&gt;<br>com.dream.java_generic.share.ParentGeneric&lt;T&gt;<br></code></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°è·å–åˆ°äº†æ³›å‹çˆ¶ç±»ï¼Œå› æ­¤ä¼šèµ°åˆ°æ¡ä»¶ä½“é‡Œé¢è·å–åˆ°å®é™…çš„æ³›å‹ç±»å‹å¹¶è¿”å›</p><p>åœ¨ä¾‹2ä¸­:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java">ParentGeneric&lt;String&gt; parentGeneric1 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ParentGeneric</span>&lt;String&gt;();<br>System.out.println(parentGeneric1.getClass().getGenericSuperclass());<br><span class="hljs-comment">//è¿è¡Œç¨‹åº æ‰“å°ç»“æœå¦‚ä¸‹</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">java</span>.lang.Object<br></code></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°è·å–åˆ°çš„æ³›å‹çˆ¶ç±»æ˜¯ Objectï¼Œå› æ­¤è¿›ä¸å»æ¡ä»¶ä½“ï¼Œæ‰€ä»¥å°±è¿”å› null äº†</p><p>2ã€parentGeneric2 åœ¨åˆ›å»ºçš„æ—¶å€™åé¢åŠ äº† {}ï¼Œè¿™å°±ä½¿å¾— parentGeneric2 æˆä¸ºäº†ä¸€ä¸ªåŒ¿åå†…éƒ¨ç±»ï¼Œä¸”çˆ¶ç±»å°±æ˜¯ ParentGenericï¼Œå› ä¸ºåŒ¿åå†…éƒ¨ç±»æ˜¯åœ¨ç¼–è¯‘æ—¶åˆ›å»ºçš„ï¼Œé‚£ä¹ˆåœ¨ç¼–è¯‘çš„æ—¶å€™å°±ä¼šåˆ›å»ºå¹¶æºå¸¦å…·ä½“çš„æ³›å‹ä¿¡æ¯ï¼Œå› æ­¤ parentGeneric2 å¯ä»¥è·å–å…¶ä¸­çš„æ³›å‹ç±»å‹</p><p>é€šè¿‡ä¸Šé¢ä¸¤ä¸ªä¾‹å­æˆ‘ä»¬å¯ä»¥å¾—å‡ºç»“è®ºï¼š<strong>å¦‚æœåœ¨ç¼–è¯‘çš„æ—¶å€™å°±ä¿å­˜äº†æ³›å‹ç±»å‹åˆ°å­—èŠ‚ç ä¸­ï¼Œé‚£ä¹ˆåœ¨è¿è¡Œæ—¶æˆ‘ä»¬å°±å¯ä»¥é€šè¿‡åå°„è·å–åˆ°ï¼Œå¦‚æœåœ¨è¿è¡Œæ—¶ä¼ å…¥å®é™…çš„æ³›å‹ç±»å‹ï¼Œè¿™ä¸ªæ—¶å€™å°±ä¼šè¢«æ“¦é™¤ï¼Œåå°„è·å–ä¸åˆ°å½“å‰ä¼ å…¥çš„æ³›å‹å®é™…ç±»å‹</strong></p><p>ä¾‹å­1ä¸­æˆ‘ä»¬æŒ‡å®šäº†æ³›å‹çš„å®é™…ç±»å‹ä¸º Stringï¼Œç¼–è¯‘çš„æ—¶å€™å°±å°†å®ƒå­˜å‚¨åˆ°äº†å­—èŠ‚ç æ–‡ä»¶ä¸­ï¼Œå› æ­¤æˆ‘ä»¬è·å–åˆ°äº†æ³›å‹ç±»å‹ã€‚ä¾‹å­2ä¸­æˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªåŒ¿åå†…éƒ¨ç±»ï¼ŒåŒæ ·åœ¨ç¼–è¯‘çš„æ—¶å€™ä¼šè¿›è¡Œåˆ›å»ºå¹¶ä¿å­˜äº†å®é™…çš„æ³›å‹åˆ°å­—èŠ‚ç ä¸­ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥è·å–åˆ°ã€‚è€Œ parentGeneric1 æ˜¯åœ¨è¿è¡Œæ—¶åˆ›å»ºçš„ï¼Œè™½ç„¶ ParentGeneric å£°æ˜çš„æ³›å‹ T åœ¨ç¼–è¯‘æ—¶ä¹Ÿä¿ç•™åœ¨äº†å­—èŠ‚ç æ–‡ä»¶ä¸­ï¼Œä½†æ˜¯å®ƒä¼ å…¥çš„å®é™…ç±»å‹è¢«æ“¦é™¤äº†ï¼Œè¿™ç§æ³›å‹ä¹Ÿæ˜¯æ— æ³•é€šè¿‡åå°„è·å–çš„ï¼Œè®°ä½ä¸Šé¢è¿™æ¡ç»“è®ºï¼Œé‚£ä¹ˆå¯¹äºæ³›å‹ç±»å‹çš„è·å–ä½ å°±å¾—å¿ƒåº”æ‰‹äº†</p><h4 id="5ã€æ³›å‹è·å–ç»éªŒæ€»ç»“"><a href="#5ã€æ³›å‹è·å–ç»éªŒæ€»ç»“" class="headerlink" title="5ã€æ³›å‹è·å–ç»éªŒæ€»ç»“"></a>5ã€æ³›å‹è·å–ç»éªŒæ€»ç»“</h4><p>å…¶å®é€šè¿‡ä¸Šé¢ä¸¤ä¸ªä¾‹å­å¯ä»¥å‘ç°ï¼Œå½“æˆ‘ä»¬å®šä¹‰ä¸€ä¸ªå­ç±»ç»§æ‰¿ä¸€ä¸ªæ³›å‹çˆ¶ç±»ï¼Œå¹¶ç»™è¿™ä¸ªæ³›å‹ä¸€ä¸ªç±»å‹ï¼Œæˆ‘ä»¬å°±å¯ä»¥è·å–åˆ°è¿™ä¸ªæ³›å‹ç±»å‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//å®šä¹‰ä¸€ä¸ªå­ç±»ç»§æ‰¿æ³›å‹çˆ¶ç±»ï¼Œå¹¶ç»™è¿™ä¸ªæ³›å‹ä¸€ä¸ªå®é™…çš„ç±»å‹</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">SubClass</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">ParentGeneric</span>&lt;String&gt;&#123;<br><br>&#125;<br><br><span class="hljs-comment">//åŒ¿åå†…éƒ¨ç±»ï¼Œå…¶å®æˆ‘ä»¬å®šä¹‰çš„è¿™ä¸ªåŒ¿åå†…éƒ¨ç±»ä¹Ÿæ˜¯ä¸€ä¸ªå­ç±»ï¼Œå®ƒç»§æ‰¿äº†æ³›å‹çˆ¶ç±»ï¼Œå¹¶ç»™è¿™ä¸ªæ³›å‹ä¸€ä¸ªå®é™…çš„ç±»å‹</span><br>ParentGeneric&lt;String&gt; parentGeneric2 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ParentGeneric</span>&lt;String&gt;()&#123;&#125;;<br></code></pre></td></tr></table></figure><p><strong>å› æ­¤å¦‚æœæˆ‘ä»¬æƒ³è¦è·å–æŸä¸ªæ³›å‹ç±»å‹ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å­ç±»çš„å¸®åŠ©å»å–å‡ºè¯¥æ³›å‹ç±»å‹ï¼Œä¸€ç§è‰¯å¥½çš„ç¼–ç¨‹å®è·µå°±æ˜¯æŠŠå½“å‰éœ€è¦è·å–çš„æ³›å‹ç±»ç”¨ abstract å£°æ˜</strong></p><h3 id="3ã€è¾¹ç•Œ"><a href="#3ã€è¾¹ç•Œ" class="headerlink" title="3ã€è¾¹ç•Œ"></a>3ã€è¾¹ç•Œ</h3><p>è¾¹ç•Œå°±æ˜¯åœ¨æ³›å‹çš„å‚æ•°ä¸Šè®¾ç½®é™åˆ¶æ¡ä»¶ï¼Œè¿™æ ·å¯ä»¥å¼ºåˆ¶æ³›å‹å¯ä»¥ä½¿ç”¨çš„ç±»å‹ï¼Œæ›´é‡è¦çš„æ˜¯å¯ä»¥æŒ‰ç…§è‡ªå·±çš„è¾¹ç•Œç±»å‹æ¥è°ƒç”¨æ–¹æ³•</p><p>1ï¼‰ã€Java ä¸­è®¾ç½®è¾¹ç•Œä½¿ç”¨ extends å…³é”®å­—ï¼Œå®Œæ•´è¯­æ³•ç»“æ„ï¼š<code>&lt;T extends Bound&gt;</code> ï¼ŒBound å¯ä»¥æ˜¯ç±»å’Œæ¥å£ï¼Œå¦‚æœä¸æŒ‡å®šè¾¹ç•Œï¼Œé»˜è®¤è¾¹ç•Œä¸º Object</p><p>2ï¼‰ã€å¯ä»¥è®¾ç½®å¤šä¸ªè¾¹ç•Œï¼Œä¸­é—´ä½¿ç”¨ &amp; è¿æ¥ï¼Œå¤šä¸ªè¾¹ç•Œä¸­åªèƒ½æœ‰ä¸€ä¸ªè¾¹ç•Œæ˜¯ç±»ï¼Œä¸”ç±»å¿…é¡»æ”¾åœ¨æœ€å‰é¢ï¼Œç±»ä¼¼è¿™ç§è¯­æ³•ç»“æ„</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">&lt;T <span class="hljs-keyword">extends</span> <span class="hljs-title class_">ClassBound</span> &amp; InterfaceBound1 &amp; InterfaceBound2&gt;<br></code></pre></td></tr></table></figure><p>ä¸‹é¢æˆ‘ä»¬æ¥æ¼”ç¤ºä¸€ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ClassBound</span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">test1</span><span class="hljs-params">()</span>;<br>&#125;<br><br><span class="hljs-keyword">interface</span> <span class="hljs-title class_">InterfaceBound1</span>&#123;<br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">test2</span><span class="hljs-params">()</span>;<br>&#125;<br><br><span class="hljs-keyword">interface</span> <span class="hljs-title class_">InterfaceBound2</span>&#123;<br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">test3</span><span class="hljs-params">()</span>;<br>&#125;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">ParentClass</span> &lt;T <span class="hljs-keyword">extends</span> <span class="hljs-title class_">ClassBound</span> &amp; InterfaceBound1 &amp; InterfaceBound2&gt;&#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> T item;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">ParentClass</span><span class="hljs-params">(T item)</span> &#123;<br>        <span class="hljs-built_in">this</span>.item = item;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">test1</span><span class="hljs-params">()</span>&#123;<br>        item.test1();<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">test2</span><span class="hljs-params">()</span>&#123;<br>        item.test2();<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">test3</span><span class="hljs-params">()</span>&#123;<br>        item.test3();<br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">SubClass</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">ClassBound</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">InterfaceBound1</span>,InterfaceBound2 &#123;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">test1</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;test1&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">test2</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;test2&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">test3</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;test3&quot;</span>);<br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Bound</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-type">SubClass</span> <span class="hljs-variable">subClass</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SubClass</span>();<br>        ParentClass&lt;SubClass&gt; parentClass = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ParentClass</span>&lt;SubClass&gt;(subClass);<br>        parentClass.test1();<br>        parentClass.test2();<br>        parentClass.test3();<br>    &#125;<br>&#125;<br><span class="hljs-comment">//æ‰“å°ç»“æœ</span><br>test1<br>test2<br>test3<br></code></pre></td></tr></table></figure><h3 id="4ã€é€šé…ç¬¦"><a href="#4ã€é€šé…ç¬¦" class="headerlink" title="4ã€é€šé…ç¬¦"></a>4ã€é€šé…ç¬¦</h3><h4 id="1ã€æ³›å‹çš„åå˜ï¼Œé€†å˜å’Œä¸å˜"><a href="#1ã€æ³›å‹çš„åå˜ï¼Œé€†å˜å’Œä¸å˜" class="headerlink" title="1ã€æ³›å‹çš„åå˜ï¼Œé€†å˜å’Œä¸å˜"></a>1ã€æ³›å‹çš„åå˜ï¼Œé€†å˜å’Œä¸å˜</h4><p>æ€è€ƒä¸€ä¸ªé—®é¢˜ï¼Œä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">Number</span> <span class="hljs-variable">number</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Integer</span>(<span class="hljs-number">666</span>);<br>ArrayList&lt;Number&gt; numberList = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;Integer&gt;();<span class="hljs-comment">//ç¼–è¯‘å™¨æŠ¥é”™ type mismatch</span><br></code></pre></td></tr></table></figure><p>ä¸Šè¿°ä»£ç ï¼Œä¸ºå•¥ Number çš„å¯¹è±¡å¯ä»¥ç”± Integer å®ä¾‹åŒ–ï¼Œè€Œ <code>ArrayList&lt;Number&gt;</code> çš„å¯¹è±¡å´ä¸èƒ½ç”± <code>ArrayList&lt;Integer&gt;</code> å®ä¾‹åŒ–ï¼Ÿ</p><p>è¦æ˜ç™½ä¸Šé¢è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬é¦–å…ˆè¦æ˜ç™½ï¼Œä»€ä¹ˆæ˜¯æ³›å‹çš„åå˜ï¼Œé€†å˜å’Œä¸å˜</p><blockquote><p>1ï¼‰ã€æ³›å‹åå˜ï¼Œå‡è®¾æˆ‘å®šä¹‰äº†ä¸€ä¸ª <code>Class&lt;T&gt;</code> çš„æ³›å‹ç±»ï¼Œå…¶ä¸­ A æ˜¯ B çš„å­ç±»ï¼ŒåŒæ—¶ <code>Class&lt;A&gt;</code> ä¹Ÿæ˜¯ <code>Class&lt;B&gt;</code> çš„å­ç±»ï¼Œé‚£ä¹ˆæˆ‘ä»¬è¯´ Class åœ¨ T è¿™ä¸ªæ³›å‹ä¸Šæ˜¯åå˜çš„</p><p>2ï¼‰ã€æ³›å‹é€†å˜ï¼Œå‡è®¾æˆ‘å®šä¹‰äº†ä¸€ä¸ª <code>Class&lt;T&gt;</code> çš„æ³›å‹ç±»ï¼Œå…¶ä¸­ <code>A æ˜¯ B</code> çš„å­ç±»ï¼ŒåŒæ—¶ <code>Class&lt;B&gt;</code> ä¹Ÿæ˜¯ <code>Class&lt;A&gt;</code> çš„å­ç±»ï¼Œé‚£ä¹ˆæˆ‘ä»¬è¯´ Class åœ¨ T è¿™ä¸ªæ³›å‹ä¸Šæ˜¯é€†å˜çš„</p><p>3ï¼‰ã€æ³›å‹ä¸å˜ï¼Œå‡è®¾æˆ‘å®šä¹‰äº†ä¸€ä¸ª <code>Class&lt;T&gt; </code> çš„æ³›å‹ç±»ï¼Œå…¶ä¸­ A æ˜¯ B çš„å­ç±»ï¼ŒåŒæ—¶ <code>Class&lt;B&gt;</code> å’Œ <code>Class&lt;A&gt;</code> æ²¡æœ‰ç»§æ‰¿å…³ç³»ï¼Œé‚£ä¹ˆæˆ‘ä»¬è¯´ Class åœ¨ T è¿™ä¸ªæ³›å‹ä¸Šæ˜¯ä¸å˜çš„</p></blockquote><p>å› æ­¤æˆ‘ä»¬å¯ä»¥çŸ¥é“ <code>ArrayList&lt;Number&gt;</code> çš„å¯¹è±¡ä¸èƒ½ç”± <code>ArrayList&lt;Integer&gt;</code> å®ä¾‹åŒ–æ˜¯å› ä¸º ArrayList å½“å‰çš„æ³›å‹æ˜¯ä¸å˜çš„ï¼Œæˆ‘ä»¬è¦è§£å†³ä¸Šé¢æŠ¥é”™çš„é—®é¢˜ï¼Œå¯ä»¥è®© ArrayList å½“å‰çš„æ³›å‹æ”¯æŒåå˜ï¼Œå¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">Number</span> <span class="hljs-variable">number</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Integer</span>(<span class="hljs-number">666</span>);<br>ArrayList&lt;? <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Number</span>&gt; numberList = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;Integer&gt;();<br></code></pre></td></tr></table></figure><h4 id="2ã€æ³›å‹çš„ä¸Šè¾¹ç•Œé€šé…ç¬¦"><a href="#2ã€æ³›å‹çš„ä¸Šè¾¹ç•Œé€šé…ç¬¦" class="headerlink" title="2ã€æ³›å‹çš„ä¸Šè¾¹ç•Œé€šé…ç¬¦"></a>2ã€æ³›å‹çš„ä¸Šè¾¹ç•Œé€šé…ç¬¦</h4><p>1ï¼‰ã€æ³›å‹çš„ä¸Šè¾¹ç•Œé€šé…ç¬¦è¯­æ³•ç»“æ„ï¼š<code>&lt;? extends Bound&gt;</code>ï¼Œä½¿å¾—æ³›å‹æ”¯æŒåå˜ï¼Œå®ƒé™å®šçš„ç±»å‹æ˜¯å½“å‰ä¸Šè¾¹ç•Œç±»æˆ–è€…å…¶å­ç±»ï¼Œå¦‚æœæ˜¯æ¥å£çš„è¯å°±æ˜¯å½“å‰ä¸Šè¾¹ç•Œæ¥å£æˆ–è€…å®ç°ç±»ï¼Œä½¿ç”¨ä¸Šè¾¹ç•Œé€šé…ç¬¦çš„å˜é‡åªè¯»ï¼Œä¸å¯ä»¥å†™ï¼Œå¯ä»¥æ·»åŠ  null ï¼Œä½†æ˜¯æ²¡æ„ä¹‰</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">WildCard</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        List&lt;Integer&gt; integerList = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;Integer&gt;();<br>        List&lt;Number&gt; numberList = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;Number&gt;();<br>        integerList.add(<span class="hljs-number">666</span>);<br>        numberList.add(<span class="hljs-number">123</span>);<br><br>        getNumberData(integerList);<br>        getNumberData(numberList);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">getNumberData</span><span class="hljs-params">(List&lt;? extends Number&gt; data)</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;Number data :&quot;</span> + data.get(<span class="hljs-number">0</span>));<br>    &#125;<br>&#125;<br><span class="hljs-comment">//æ‰“å°ç»“æœ</span><br>Number data: <span class="hljs-number">666</span><br>Number data: <span class="hljs-number">123</span><br></code></pre></td></tr></table></figure><p>é—®é¢˜ï¼šä¸ºå•¥ä½¿ç”¨ä¸Šè¾¹ç•Œé€šé…ç¬¦çš„å˜é‡åªè¯»ï¼Œè€Œä¸èƒ½å†™ï¼Ÿ</p><p>1ã€<code>&lt;? extends Bound&gt;</code>,å®ƒé™å®šçš„ç±»å‹æ˜¯å½“å‰ä¸Šè¾¹ç•Œç±»æˆ–è€…å…¶å­ç±»ï¼Œå®ƒæ— æ³•ç¡®å®šè‡ªå·±å…·ä½“çš„ç±»å‹ï¼Œå› æ­¤ç¼–è¯‘å™¨æ— æ³•éªŒè¯ç±»å‹çš„å®‰å…¨ï¼Œæ‰€ä»¥ä¸èƒ½å†™</p><p>2ã€å‡è®¾å¯ä»¥å†™ï¼Œæˆ‘ä»¬å‘å®ƒé‡Œé¢æ·»åŠ è‹¥å¹²ä¸ªå­ç±»ï¼Œç„¶åç”¨ä¸€ä¸ªå…·ä½“çš„å­ç±»å»æ¥æ”¶ï¼ŒåŠ¿å¿…ä¼šé€ æˆç±»å‹è½¬æ¢å¼‚å¸¸</p><h4 id="3ã€æ³›å‹çš„ä¸‹è¾¹ç•Œé€šé…ç¬¦"><a href="#3ã€æ³›å‹çš„ä¸‹è¾¹ç•Œé€šé…ç¬¦" class="headerlink" title="3ã€æ³›å‹çš„ä¸‹è¾¹ç•Œé€šé…ç¬¦"></a>3ã€æ³›å‹çš„ä¸‹è¾¹ç•Œé€šé…ç¬¦</h4><p>1ï¼‰ã€æ³›å‹çš„ä¸‹è¾¹ç•Œé€šé…ç¬¦è¯­æ³•ç»“æ„ï¼š<code>&lt;? super Bound&gt;</code>ï¼Œä½¿å¾—æ³›å‹æ”¯æŒé€†å˜ï¼Œå®ƒé™å®šçš„ç±»å‹æ˜¯å½“å‰ä¸‹è¾¹ç•Œç±»æˆ–è€…å…¶çˆ¶ç±»ï¼Œå¦‚æœæ˜¯æ¥å£çš„è¯å°±æ˜¯å½“å‰ä¸‹è¾¹ç•Œæ¥å£æˆ–è€…å…¶çˆ¶æ¥å£ï¼Œä½¿ç”¨ä¸‹è¾¹ç•Œé€šé…ç¬¦çš„å˜é‡åªå†™ï¼Œä¸å»ºè®®è¯»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">WildCard</span> &#123;<br>  <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        List&lt;Number&gt; numberList = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;Number&gt;();<br>        List&lt;Object&gt; objectList = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;Object&gt;();<br>        setNumberData(numberList);<br>        setNumberData(objectList);<br>    &#125;<br>    <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setNumberData</span><span class="hljs-params">(List&lt;? <span class="hljs-built_in">super</span> Number&gt; data)</span> &#123;<br>        <span class="hljs-type">Number</span> <span class="hljs-variable">number</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Integer</span>(<span class="hljs-number">666</span>);<br>        data.add(number);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>é—®é¢˜ï¼šä¸ºå•¥ä½¿ç”¨ä¸‹è¾¹ç•Œé€šé…ç¬¦çš„å˜é‡å¯ä»¥å†™ï¼Œè€Œä¸å»ºè®®è¯»ï¼Ÿ</p><p>1ã€<code>&lt;? super Bound&gt;</code>ï¼Œå®ƒé™å®šçš„ç±»å‹æ˜¯å½“å‰ä¸‹è¾¹ç•Œç±»æˆ–è€…å…¶çˆ¶ç±»ï¼Œè™½ç„¶å®ƒä¹Ÿæ— æ³•ç¡®å®šè‡ªå·±å…·ä½“çš„ç±»å‹ï¼Œä½†æ ¹æ®å¤šæ€ï¼Œå®ƒèƒ½ä¿è¯è‡ªå·±æ·»åŠ çš„å…ƒç´ æ˜¯å®‰å…¨çš„ï¼Œå› æ­¤å¯ä»¥å†™</p><p>2ã€è·å–å€¼çš„æ—¶å€™ï¼Œä¼šè¿”å›ä¸€ä¸ª <code>Object</code> ç±»å‹çš„å€¼ï¼Œè€Œä¸èƒ½è·å–å®é™…ç±»å‹å‚æ•°ä»£è¡¨çš„ç±»å‹ï¼Œå› æ­¤å»ºè®®ä¸è¦å»è¯»ï¼Œå¦‚æœä½ å®åœ¨è¦å»è¯»ä¹Ÿè¡Œï¼Œä½†æ˜¯è¦æ³¨æ„ç±»å‹è½¬æ¢å¼‚å¸¸</p><h4 id="4ã€æ³›å‹çš„æ— è¾¹ç•Œé€šé…ç¬¦"><a href="#4ã€æ³›å‹çš„æ— è¾¹ç•Œé€šé…ç¬¦" class="headerlink" title="4ã€æ³›å‹çš„æ— è¾¹ç•Œé€šé…ç¬¦"></a>4ã€æ³›å‹çš„æ— è¾¹ç•Œé€šé…ç¬¦</h4><p>1ï¼‰ã€æ— è¾¹ç•Œé€šé…ç¬¦çš„è¯­æ³•ç»“æ„ï¼š<code>&lt;?&gt;</code>ï¼Œå®é™…ä¸Šå®ƒç­‰ä»·äº <code>&lt;? extends Object&gt;</code>ï¼Œä¹Ÿå°±æ˜¯è¯´å®ƒçš„ä¸Šè¾¹ç•Œæ˜¯ Object æˆ–å…¶å­ç±»ï¼Œå› æ­¤ä½¿ç”¨æ— ç•Œé€šé…ç¬¦çš„å˜é‡åŒæ ·åªè¯»ï¼Œä¸èƒ½å†™ï¼Œå¯ä»¥æ·»åŠ  null ï¼Œä½†æ˜¯æ²¡æ„ä¹‰</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">WildCard</span> &#123;<br>  <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        List&lt;String&gt; stringList = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;String&gt;();<br>        List&lt;Number&gt; numberList = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;Number&gt;();<br>        List&lt;Integer&gt; integerList = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;Integer&gt;();<br>        stringList.add(<span class="hljs-string">&quot;erdai&quot;</span>);<br>        numberList.add(<span class="hljs-number">666</span>);<br>        integerList.add(<span class="hljs-number">123</span>);<br>        getData(stringList);<br>        getData(numberList);<br>        getData(integerList);<br>    &#125;<br>    <br>     <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">getData</span><span class="hljs-params">(List&lt;?&gt; data)</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;data: &quot;</span> + data.get(<span class="hljs-number">0</span>));<br>    &#125;<br>&#125;<br><span class="hljs-comment">//æ‰“å°ç»“æœ</span><br>data: erdai<br>data: <span class="hljs-number">666</span><br>data: <span class="hljs-number">123</span><br></code></pre></td></tr></table></figure><h4 id="5ã€PECS-åŸåˆ™"><a href="#5ã€PECS-åŸåˆ™" class="headerlink" title="5ã€PECS åŸåˆ™"></a>5ã€PECS åŸåˆ™</h4><p>æ³›å‹ä»£ç çš„è®¾è®¡ï¼Œåº”éµå¾ª<strong>PECSåŸåˆ™ï¼ˆProducer extends Consumer superï¼‰ï¼š</strong></p><p>1ï¼‰ã€å¦‚æœåªéœ€è¦è·å–å…ƒç´ ï¼Œä½¿ç”¨ <code>&lt;? extends T&gt;</code></p><p>2ï¼‰ã€å¦‚æœåªéœ€è¦å­˜å‚¨ï¼Œä½¿ç”¨ <code>&lt;? super T&gt;</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//è¿™æ˜¯ Collections.java ä¸­ copy æ–¹æ³•çš„æºç </span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> &lt;T&gt; <span class="hljs-keyword">void</span> <span class="hljs-title function_">copy</span><span class="hljs-params">(List&lt;? <span class="hljs-built_in">super</span> T&gt; dest, List&lt;? extends T&gt; src)</span> &#123;<br>      <span class="hljs-comment">//...</span><br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™æ˜¯ä¸€ä¸ªå¾ˆç»å…¸çš„ä¾‹å­ï¼Œsrc è¡¨ç¤ºåŸå§‹é›†åˆï¼Œä½¿ç”¨äº† <code>&lt;? extends T&gt;</code>ï¼Œåªèƒ½ä»ä¸­è¯»å–å…ƒç´ ï¼Œdest è¡¨ç¤ºç›®æ ‡é›†åˆï¼Œåªèƒ½å¾€é‡Œé¢å†™å…ƒç´ ï¼Œå……åˆ†çš„ä½“ç°äº† PECS åŸåˆ™</p><h4 id="6ã€ä½¿ç”¨é€šé…ç¬¦æ€»ç»“"><a href="#6ã€ä½¿ç”¨é€šé…ç¬¦æ€»ç»“" class="headerlink" title="6ã€ä½¿ç”¨é€šé…ç¬¦æ€»ç»“"></a>6ã€ä½¿ç”¨é€šé…ç¬¦æ€»ç»“</h4><p>1ï¼‰ã€å½“ä½ åªæƒ³è¯»å–å€¼çš„æ—¶å€™ï¼Œä½¿ç”¨ <code>&lt;? extends T&gt;</code></p><p>2ï¼‰ã€å½“ä½ åªæƒ³å†™å…¥å€¼çš„æ—¶å€™ï¼Œä½¿ç”¨ <code>&lt;? super T&gt;</code></p><p>3ï¼‰ã€å½“ä½ æ—¢æƒ³è¯»å–å€¼åˆæƒ³å†™å…¥å€¼çš„æ—¶å€™ï¼Œå°±ä¸è¦ä½¿ç”¨é€šé…ç¬¦</p><h3 id="5ã€æ³›å‹çš„é™åˆ¶"><a href="#5ã€æ³›å‹çš„é™åˆ¶" class="headerlink" title="5ã€æ³›å‹çš„é™åˆ¶"></a>5ã€æ³›å‹çš„é™åˆ¶</h3><p>1ï¼‰ã€æ³›å‹ä¸èƒ½æ˜¾å¼åœ°å¼•ç”¨åœ¨è¿è¡Œæ—¶ç±»å‹çš„æ“ä½œé‡Œï¼Œå¦‚ instanceof æ“ä½œå’Œ new è¡¨è¾¾å¼ï¼Œè¿è¡Œæ—¶ç±»å‹åªé€‚ç”¨äºåŸç”Ÿç±»å‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">GenericLimitedClass</span>&lt;T&gt; &#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">test</span><span class="hljs-params">()</span>&#123;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">str</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;&quot;</span>;<br>      <span class="hljs-comment">//ç¼–è¯‘å™¨ä¸å…è®¸è¿™ç§æ“ä½œ</span><br>        <span class="hljs-keyword">if</span>(str <span class="hljs-keyword">instanceof</span> T)&#123;<br><br>        &#125;<br>        <span class="hljs-comment">//ç¼–è¯‘å™¨ä¸å…è®¸è¿™ç§æ“ä½œ</span><br>        <span class="hljs-type">T</span> <span class="hljs-variable">t</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">T</span>();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>2ï¼‰ã€ä¸èƒ½åˆ›å»ºæ³›å‹ç±»å‹çš„æ•°ç»„ï¼Œåªå¯ä»¥å£°æ˜ä¸€ä¸ªæ³›å‹ç±»å‹çš„æ•°ç»„å¼•ç”¨</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">GenericLimitedClass</span>&lt;T&gt; &#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">test</span><span class="hljs-params">()</span>&#123;<br>       GenericLimitedClass&lt;Test&gt;[] genericLimitedClasses;<br>       <span class="hljs-comment">//ç¼–è¯‘å™¨ä¸å…è®¸</span><br>       genericLimitedClasses = <span class="hljs-keyword">new</span> <span class="hljs-title class_">GenericLimitedClass</span>&lt;Test&gt;[<span class="hljs-number">10</span>];<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>3ï¼‰ã€ä¸èƒ½å£°æ˜ç±»å‹ä¸ºæ³›å‹çš„é™æ€å­—æ®µ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">GenericLimitedClass</span>&lt;T&gt; &#123;<br>    <span class="hljs-comment">//ç¼–è¯‘å™¨ä¸å…è®¸</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> T t;<br>&#125;<br></code></pre></td></tr></table></figure><p>4ï¼‰ã€æ³›å‹ç±»ä¸å¯ä»¥ç›´æ¥æˆ–é—´æ¥åœ°ç»§æ‰¿ Throwable</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//ç¼–è¯‘å™¨ä¸å…è®¸</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">GenericLimitedClass</span>&lt;T&gt; <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Throwable</span> &#123;<br>   <br>&#125;<br></code></pre></td></tr></table></figure><p>5ï¼‰ã€æ–¹æ³•ä¸­ä¸å¯ä»¥æ•è·ç±»å‹å‚æ•°çš„å®ä¾‹ï¼Œä½†æ˜¯å¯ä»¥åœ¨ throws è¯­å¥ä¸­ä½¿ç”¨ç±»å‹å‚æ•°</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">GenericLimitedClass</span>&lt;T&gt; &#123;<br>    <span class="hljs-keyword">private</span> &lt;T <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Throwable</span>&gt; <span class="hljs-keyword">void</span> <span class="hljs-title function_">test1</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> T&#123;<br>        <span class="hljs-keyword">try</span> &#123;<br><br>        <span class="hljs-comment">//ç¼–è¯‘å™¨ä¸å…è®¸</span><br>        &#125;<span class="hljs-keyword">catch</span> (T exception)&#123;<br><br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>6ï¼‰ã€ä¸€ä¸ªç±»ä¸å¯ä»¥é‡è½½åœ¨ç±»å‹æ“¦é™¤åæœ‰åŒæ ·æ–¹æ³•ç­¾åçš„æ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">GenericLimitedClass</span>&lt;T&gt; &#123;<br>    <span class="hljs-comment">//ç¼–è¯‘å™¨ä¸å…è®¸</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">test2</span><span class="hljs-params">(List&lt;String&gt; stringList)</span>&#123;<br><br>    &#125;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">test2</span><span class="hljs-params">(List&lt;Integer&gt; integerList)</span>&#123;<br><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="6ã€é—®é¢˜"><a href="#6ã€é—®é¢˜" class="headerlink" title="6ã€é—®é¢˜"></a>6ã€é—®é¢˜</h3><p>1ï¼‰ã€ç±»å‹è¾¹ç•Œå’Œé€šé…ç¬¦è¾¹ç•Œæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</p><p>ç±»å‹è¾¹ç•Œå¯ä»¥æœ‰å¤šä¸ªï¼Œé€šé…ç¬¦è¾¹ç•Œåªèƒ½æœ‰ä¸€ä¸ª</p><p>2ï¼‰ã€<code>List&lt;?&gt;</code> å’Œ <code>List&lt;Object&gt;</code> ä¸€æ ·å—ï¼Ÿ</p><p>ä¸ä¸€æ ·</p><p>1ã€ <code>List&lt;Object&gt;</code> å¯è¯»å†™ï¼Œä½†æ˜¯ List&lt;?&gt; åªè¯»</p><p>2ã€<code>List&lt;?&gt;</code>å¯ä»¥æœ‰å¾ˆå¤šå­ç±»ï¼Œä½†æ˜¯ <code>List&lt;Object&gt;</code> æ²¡æœ‰</p><h2 id="äºŒã€Kotlin-æ³›å‹"><a href="#äºŒã€Kotlin-æ³›å‹" class="headerlink" title="äºŒã€Kotlin æ³›å‹"></a>äºŒã€Kotlin æ³›å‹</h2><p>Kotlin æ³›å‹å’Œ Java æ³›å‹åŸºæœ¬ä¸Šæ˜¯ä¸€æ ·çš„ï¼Œåªä¸è¿‡åœ¨ Kotlin ä¸Šæœ‰äº›ä¸œè¥¿æ¢äº†æ–°çš„å†™æ³•</p><h3 id="1ã€æ³›å‹çš„åŸºæœ¬ç”¨æ³•"><a href="#1ã€æ³›å‹çš„åŸºæœ¬ç”¨æ³•" class="headerlink" title="1ã€æ³›å‹çš„åŸºæœ¬ç”¨æ³•"></a>1ã€æ³›å‹çš„åŸºæœ¬ç”¨æ³•</h3><p>1ï¼‰ã€åœ¨ Kotlin ä¸­æˆ‘ä»¬å®šä¹‰å’Œä½¿ç”¨æ³›å‹çš„æ–¹å¼å¦‚ä¸‹ï¼š</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-comment">//1ã€å®šä¹‰ä¸€ä¸ªæ³›å‹ç±»ï¼Œåœ¨ç±»ååé¢ä½¿ç”¨ &lt;T&gt; è¿™ç§è¯­æ³•ç»“æ„å°±æ˜¯ä¸ºè¿™ä¸ªç±»å®šä¹‰ä¸€ä¸ªæ³›å‹</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyClass</span>&lt;<span class="hljs-type">T</span>&gt;&#123;<br>  <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">method</span><span class="hljs-params">(params: <span class="hljs-type">T</span>)</span></span> &#123;<br>      <br>    &#125;<br>&#125;<br><span class="hljs-comment">//æ³›å‹è°ƒç”¨</span><br><span class="hljs-keyword">val</span> myClass = MyClass&lt;<span class="hljs-built_in">Int</span>&gt;()<br>myClass.method(<span class="hljs-number">12</span>)<br><br><span class="hljs-comment">//2ã€å®šä¹‰ä¸€ä¸ªæ³›å‹æ–¹æ³•ï¼Œåœ¨æ–¹æ³•åçš„å‰é¢åŠ ä¸Š &lt;T&gt; è¿™ç§è¯­æ³•ç»“æ„å°±æ˜¯ä¸ºè¿™ä¸ªæ–¹æ³•å®šä¹‰ä¸€ä¸ªæ³›å‹</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyClass</span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;T&gt;</span> <span class="hljs-title">method</span><span class="hljs-params">(params: <span class="hljs-type">T</span>)</span></span>&#123;<br><br>    &#125;<br>&#125;<br><span class="hljs-comment">//æ³›å‹è°ƒç”¨</span><br><span class="hljs-keyword">val</span> myClass = MyClass()<br>myClass.method&lt;<span class="hljs-built_in">Int</span>&gt;(<span class="hljs-number">12</span>)<br><span class="hljs-comment">//æ ¹æ® Kotlin ç±»å‹æ¨å¯¼æœºåˆ¶ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠæ³›å‹ç»™çœç•¥</span><br>myClass.method(<span class="hljs-number">12</span>)<br><br><span class="hljs-comment">//3ã€å®šä¹‰ä¸€ä¸ªæ³›å‹æ¥å£ï¼Œåœ¨æ¥å£ååé¢åŠ ä¸Š &lt;T&gt; è¿™ç§è¯­æ³•ç»“æ„å°±æ˜¯ä¸ºè¿™ä¸ªæ¥å£å®šä¹‰ä¸€ä¸ªæ³›å‹</span><br><span class="hljs-keyword">interface</span> <span class="hljs-title class_">MyInterface</span>&lt;<span class="hljs-type">T</span>&gt;&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">interfaceMethod</span><span class="hljs-params">(params: <span class="hljs-type">T</span>)</span></span><br>&#125;<br></code></pre></td></tr></table></figure><p>å¯¹æ¯” Java ä¸­å®šä¹‰æ³›å‹ï¼Œæˆ‘ä»¬å¯ä»¥å‘ç°ï¼šåœ¨å®šä¹‰ç±»å’Œæ¥å£æ³›å‹ä¸Šæ²¡æœ‰ä»»ä½•åŒºåˆ«ï¼Œåœ¨å®šä¹‰æ–¹æ³•æ³›å‹æ—¶ï¼ŒKotlin æ˜¯åœ¨æ–¹æ³•åå‰é¢æ·»åŠ æ³›å‹ï¼Œè€Œ Java æ˜¯åœ¨è¿”å›å€¼å‰é¢æ·»åŠ æ³›å‹</p><h3 id="2ã€è¾¹ç•Œ"><a href="#2ã€è¾¹ç•Œ" class="headerlink" title="2ã€è¾¹ç•Œ"></a>2ã€è¾¹ç•Œ</h3><p>1ï¼‰ã€ä¸ºæ³›å‹æŒ‡å®šè¾¹ç•Œï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <code>&lt;T : Class&gt;</code> è¿™ç§è¯­æ³•ç»“æ„ï¼Œå¦‚æœä¸æŒ‡å®šæ³›å‹çš„è¾¹ç•Œï¼Œé»˜è®¤ä¸º Any? </p><p>2ï¼‰ã€å¦‚æœæœ‰å¤šä¸ªè¾¹ç•Œï¼Œå¯ä»¥ä½¿ç”¨ where å…³é”®å­—ï¼Œä¸­é—´ä½¿ç”¨ : éš”å¼€ï¼Œå¤šä¸ªè¾¹ç•Œä¸­åªèƒ½æœ‰ä¸€ä¸ªè¾¹ç•Œæ˜¯ç±»ï¼Œä¸”ç±»å¿…é¡»æ”¾åœ¨æœ€å‰é¢</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-comment">//æƒ…å†µ1 å•ä¸ªè¾¹ç•Œ</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyClass1</span>&lt;<span class="hljs-type">T : Number</span>&gt; &#123;<br><br>    <span class="hljs-keyword">var</span> <span class="hljs-keyword">data</span>: T? = <span class="hljs-literal">null</span><br><br>    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;T : Number&gt;</span> <span class="hljs-title">method</span><span class="hljs-params">(params: <span class="hljs-type">T</span>)</span></span> &#123;<br><br>    &#125;<br>&#125;<br><br><span class="hljs-comment">//æƒ…å†µ2 å¤šä¸ªè¾¹ç•Œä½¿ç”¨ where å…³é”®å­—</span><br><span class="hljs-keyword">open</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Animal</span><br><span class="hljs-keyword">interface</span> <span class="hljs-title class_">Food</span><br><span class="hljs-keyword">interface</span> <span class="hljs-title class_">Food2</span><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyClass2</span>&lt;<span class="hljs-type">T</span>&gt; <span class="hljs-title">where</span> <span class="hljs-title">T</span> : <span class="hljs-type">Animal</span>, <span class="hljs-type">T</span> : <span class="hljs-type">Food</span>, <span class="hljs-type">T</span> : <span class="hljs-type">Food2</span> &#123;<br><br>    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;T&gt;</span> <span class="hljs-title">method</span><span class="hljs-params">(params: <span class="hljs-type">T</span>)</span></span> <span class="hljs-keyword">where</span> T : Animal, T : Food, T : Food2 &#123;<br><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="3ã€æ³›å‹å®åŒ–"><a href="#3ã€æ³›å‹å®åŒ–" class="headerlink" title="3ã€æ³›å‹å®åŒ–"></a>3ã€æ³›å‹å®åŒ–</h3><p>æ³›å‹å®åŒ–åœ¨ Java ä¸­æ˜¯ä¸å­˜åœ¨çš„ï¼ŒKotlin ä¸­ä¹‹æ‰€ä»¥èƒ½å®ç°æ³›å‹å®åŒ–ï¼Œæ˜¯å› ä¸ºä½¿ç”¨çš„å†…è”å‡½æ•°ä¼šå¯¹ä»£ç è¿›è¡Œæ›¿æ¢ï¼Œé‚£ä¹ˆåœ¨å†…è”å‡½æ•°ä¸­ä½¿ç”¨æ³›å‹ï¼Œæœ€ç»ˆä¹Ÿä¼šä½¿ç”¨å®é™…çš„ç±»å‹è¿›è¡Œæ›¿æ¢</p><p>1ï¼‰ã€ä½¿ç”¨å†…è”å‡½æ•°é…åˆ reified å…³é”®å­—å¯¹æ³›å‹è¿›è¡Œå®åŒ–ï¼Œè¯­æ³•ç»“æ„å¦‚ä¸‹ï¼š</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-keyword">inline</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;<span class="hljs-keyword">reified</span> T&gt;</span> <span class="hljs-title">getGenericType</span><span class="hljs-params">()</span></span> &#123;<br>  <br>&#125;<br></code></pre></td></tr></table></figure><p>å®æ“ä¸€ä¸‹ï¼š</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-keyword">inline</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;<span class="hljs-keyword">reified</span> T&gt;</span> <span class="hljs-title">getGenericType</span><span class="hljs-params">()</span></span> = T::<span class="hljs-keyword">class</span>.java<br><br><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>    <span class="hljs-comment">//æ³›å‹å®åŒ– è¿™ç§æƒ…å†µåœ¨ Java æ˜¯ä¼šè¢«ç±»å‹æ“¦é™¤çš„</span><br>    <span class="hljs-keyword">val</span> result1 = getGenericType&lt;String&gt;()<br>    <span class="hljs-keyword">val</span> result2 = getGenericType&lt;Number&gt;()<br>    println(result1)<br>    println(result2)<br>&#125;<br><span class="hljs-comment">//æ‰“å°ç»“æœ</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">java</span>.<span class="hljs-title">lang</span>.<span class="hljs-title">String</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">java</span>.<span class="hljs-title">lang</span>.<span class="hljs-title">Number</span><br></code></pre></td></tr></table></figure><p>2ï¼‰ã€å®é™…åº”ç”¨</p><p>åœ¨æˆ‘ä»¬è·³è½¬ Activity çš„æ—¶å€™é€šå¸¸ä¼šè¿™ä¹ˆæ“ä½œ</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-keyword">val</span> intent = Intent(mContext,TestActivity::<span class="hljs-keyword">class</span>.java)<br>mContext.startActivity(intent)<br></code></pre></td></tr></table></figure><p>æœ‰æ²¡æœ‰æ„Ÿè§‰å†™è¿™ç§ TestActivity::class.java çš„è¯­æ³•å¾ˆéš¾å—ï¼Œåæ­£æˆ‘æ˜¯è§‰å¾—å¾ˆéš¾å—ï¼Œé‚£ä¹ˆè¿™ä¸ªæ—¶å€™æˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨æ³›å‹å®åŒ–æ¢ä¸€ç§å†™æ³•ï¼š</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-comment">//å®šä¹‰ä¸€ä¸ªé¡¶å±‚å‡½æ•°</span><br><span class="hljs-keyword">inline</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;<span class="hljs-keyword">reified</span> T&gt;</span> <span class="hljs-title">startActivity</span><span class="hljs-params">(mContext: <span class="hljs-type">Context</span>)</span></span>&#123;<br>    <span class="hljs-keyword">val</span> intent = Intent(mContext,T::<span class="hljs-keyword">class</span>.java)<br>    mContext.startActivity(intent)<br>&#125;<br><br><span class="hljs-comment">//ä½¿ç”¨çš„æ—¶å€™</span><br>startActivity&lt;TestActivity&gt;(mContext)<br></code></pre></td></tr></table></figure><p>è¿™ç§å†™æ³•æ˜¯ä¸æ˜¯æ¸…çˆ½äº†å¾ˆå¤šï¼Œé‚£ä¹ˆåœ¨æˆ‘ä»¬è·³è½¬ Activity çš„æ—¶å€™ï¼Œå¯èƒ½ä¼šæºå¸¦ä¸€äº›å‚æ•°ï¼Œå¦‚ä¸‹ï¼š</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-keyword">val</span> intent  = Intent(mContext,TestActivity::<span class="hljs-keyword">class</span>.java)<br>intent.putExtra(<span class="hljs-string">&quot;params1&quot;</span>,<span class="hljs-string">&quot;erdai&quot;</span>)<br>intent.putExtra(<span class="hljs-string">&quot;params2&quot;</span>,<span class="hljs-string">&quot;666&quot;</span>)<br>mContext.startActivity(intent)<br></code></pre></td></tr></table></figure><p>è¿™ä¸ªæ—¶å€™æˆ‘ä»¬å¯ä»¥å¢åŠ ä¸€ä¸ªå‡½æ•°ç±»å‹çš„å‚æ•°ï¼Œä½¿ç”¨ Lambda è¡¨è¾¾å¼å»è°ƒç”¨ï¼Œå¦‚ä¸‹ï¼š</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-keyword">inline</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;<span class="hljs-keyword">reified</span> T&gt;</span> <span class="hljs-title">startActivity</span><span class="hljs-params">(mContext: <span class="hljs-type">Context</span>, block: <span class="hljs-type">Intent</span>.() -&gt; <span class="hljs-type">Unit</span>)</span></span>&#123;<br>    <span class="hljs-keyword">val</span> intent = Intent(mContext,T::<span class="hljs-keyword">class</span>.java)<br>    intent.block()<br>    mContext.startActivity(intent)<br>&#125;<br><br><span class="hljs-comment">//ä½¿ç”¨çš„æ—¶å€™</span><br>startActivity&lt;SecondActivity&gt;(mContext)&#123;       <br>  putExtra(<span class="hljs-string">&quot;params1&quot;</span>,<span class="hljs-string">&quot;erdai&quot;</span>)     <br>  putExtra(<span class="hljs-string">&quot;params2&quot;</span>,<span class="hljs-string">&quot;666&quot;</span>)<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="4ã€æ³›å‹åå˜ï¼Œé€†å˜å’Œä¸å˜"><a href="#4ã€æ³›å‹åå˜ï¼Œé€†å˜å’Œä¸å˜" class="headerlink" title="4ã€æ³›å‹åå˜ï¼Œé€†å˜å’Œä¸å˜"></a>4ã€æ³›å‹åå˜ï¼Œé€†å˜å’Œä¸å˜</h3><p>1ï¼‰ã€æ³›å‹åå˜çš„è¯­æ³•è§„åˆ™ï¼š<code>&lt;out T&gt;</code> ç±»ä¼¼äº Java çš„  <code>&lt;? extends Bound&gt;</code>ï¼Œå®ƒé™å®šçš„ç±»å‹æ˜¯å½“å‰ä¸Šè¾¹ç•Œç±»æˆ–è€…å…¶å­ç±»ï¼Œå¦‚æœæ˜¯æ¥å£çš„è¯å°±æ˜¯å½“å‰ä¸Šè¾¹ç•Œæ¥å£æˆ–è€…å®ç°ç±»ï¼Œåå˜çš„æ³›å‹å˜é‡åªè¯»ï¼Œä¸å¯ä»¥å†™ï¼Œå¯ä»¥æ·»åŠ  null ï¼Œä½†æ˜¯æ²¡æ„ä¹‰</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-keyword">open</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Person</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Student</span>: <span class="hljs-type">Person</span>()<br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Teacher</span>: <span class="hljs-type">Person</span>()<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">SimpleData</span>&lt;<span class="hljs-type">out T</span>&gt;&#123;<br><br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>    <span class="hljs-keyword">val</span> person: Person = Student()<br>    <span class="hljs-keyword">val</span> personGeneric: SimpleData&lt;Person&gt; = SimpleData&lt;Student&gt;()<br>    <span class="hljs-keyword">val</span> list1: ArrayList&lt;<span class="hljs-keyword">out</span> Person&gt; = ArrayList&lt;Student&gt;()<br>&#125;<br></code></pre></td></tr></table></figure><p>2ï¼‰ã€æ³›å‹é€†å˜çš„è¯­æ³•è§„åˆ™ï¼š<code>&lt;in T&gt;</code> ç±»ä¼¼äº Java çš„ <code>&lt;? super Bound&gt;</code>ï¼Œå®ƒé™å®šçš„ç±»å‹æ˜¯å½“å‰ä¸‹è¾¹ç•Œç±»æˆ–è€…å…¶çˆ¶ç±»ï¼Œå¦‚æœæ˜¯æ¥å£çš„è¯å°±æ˜¯å½“å‰ä¸‹è¾¹ç•Œæ¥å£æˆ–è€…å…¶çˆ¶æ¥å£ï¼Œé€†å˜çš„æ³›å‹å˜é‡åªèƒ½å†™ï¼Œä¸å»ºè®®è¯»</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-keyword">open</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Person</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Student</span>: <span class="hljs-type">Person</span>()<br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Teacher</span>: <span class="hljs-type">Person</span>()<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">SimpleData</span>&lt;<span class="hljs-type">in T</span>&gt;&#123;<br><br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>    <span class="hljs-keyword">val</span> person1: Person = Student()<br>    <span class="hljs-keyword">val</span> personGeneric1: SimpleData&lt;Student&gt; = SimpleData&lt;Person&gt;()<br>    <span class="hljs-keyword">val</span> list2: ArrayList&lt;<span class="hljs-keyword">in</span> Person&gt; = ArrayList&lt;Any&gt;()<br>&#125;<br></code></pre></td></tr></table></figure><p>5ï¼‰ã€æ³›å‹ä¸å˜å’Œ Java è¯­æ³•è§„åˆ™æ˜¯ä¸€æ ·çš„</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-keyword">open</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Person</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Student</span>: <span class="hljs-type">Person</span>()<br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Teacher</span>: <span class="hljs-type">Person</span>()<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">SimpleData</span>&lt;<span class="hljs-type">T</span>&gt;&#123;<br><br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>    <span class="hljs-keyword">val</span> person: Person = Student()<br>    <span class="hljs-comment">//ç¼–è¯‘å™¨ä¸å…è®¸</span><br>    <span class="hljs-keyword">val</span> personGeneric: SimpleData&lt;Person&gt; = SimpleData&lt;Student&gt;()<br>&#125;<br></code></pre></td></tr></table></figure><p>6ï¼‰ã€Kotlin ä½¿ç”¨ &lt;*&gt; è¿™ç§è¯­æ³•ç»“æ„æ¥è¡¨ç¤ºæ— ç•Œé€šé…ç¬¦ï¼Œå®ƒç­‰ä»·äº <code>&lt;out Any&gt;</code>ï¼Œç±»ä¼¼äº Java ä¸­çš„ &lt;?&gt;ï¼Œåœ¨å®šä¹‰ä¸€ä¸ªç±»çš„æ—¶å€™ä½ å¦‚æœä½¿ç”¨<code>&lt;out T : Number&gt;</code> ï¼Œé‚£ä¹ˆ * å°±ç›¸å½“äº <code>&lt;out Number&gt;</code></p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-keyword">class</span> <span class="hljs-title class_">KotlinGeneric</span>&lt;<span class="hljs-type">out T: Number</span>&gt;&#123;<br><br>&#125;<br><br><span class="hljs-comment">//æ— ç•Œé€šé…ç¬¦ ç­‰ä»·äº &lt;out Any&gt;ï¼Œä½†æ˜¯æˆ‘è¿™ä¸ªç±»é™åˆ¶äº†æ³›å‹è¾¹ç•Œä¸º Numberï¼Œå› æ­¤è¿™é‡Œç›¸å½“äº &lt;out Number&gt;</span><br><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>    <span class="hljs-keyword">val</span> noBound: KotlinGeneric&lt;*&gt; = KotlinGeneric&lt;<span class="hljs-built_in">Int</span>&gt;()<br> <br>    <span class="hljs-comment">//æ ¹æ®åå˜è§„åˆ™ ç¼–è¯‘å™¨ä¸å…è®¸è¿™æ ·å†™</span><br>    <span class="hljs-keyword">val</span> noBound: KotlinGeneric&lt;*&gt; = KotlinGeneric&lt;Any&gt;()<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="ä¸‰ã€æ³›å‹æ€»ç»“"><a href="#ä¸‰ã€æ³›å‹æ€»ç»“" class="headerlink" title="ä¸‰ã€æ³›å‹æ€»ç»“"></a>ä¸‰ã€æ³›å‹æ€»ç»“</h2><p>è¦å­¦å¥½ Kotlin æ³›å‹ï¼Œå°±è¦å…ˆå­¦ä¹ å¥½ Java  æ³›å‹ï¼Œæœ€åæ€»ç»“ä¸€ä¸‹è¿™ç¯‡æ–‡ç« è®²çš„å†…å®¹ï¼š</p><p>1ã€å›ç­”äº†ä¸€äº›å…³äºæ³›å‹çš„é—®é¢˜</p><p>2ã€è®²è§£äº† Java æ³›å‹ï¼Œå…¶ä¸­æˆ‘è§‰å¾—æ³›å‹æ“¦é™¤å’Œæ³›å‹çš„åå˜ï¼Œé€†å˜å’Œä¸å˜æ˜¯æ¯”è¾ƒéš¾ç†è§£çš„ï¼Œå› æ­¤å¤§å®¶å¯ä»¥å¤šèŠ±ç‚¹æ—¶é—´å»ç†è§£è¿™ä¸€å—</p><p>3ã€è®²è§£äº† Kotlin æ³›å‹ï¼Œç›¸å¯¹äº Java æ³›å‹ï¼ŒKotlinæ³›å‹å°±æ˜¯åœ¨è¯­æ³•ç»“æ„ä¸Šæœ‰äº›ä¸ä¸€æ ·ï¼Œä½†åŠŸèƒ½æ˜¯å®Œå…¨ä¸€æ ·çš„ï¼Œå¦å¤– Kotlin ä¸­çš„æ³›å‹å®åŒ–æ˜¯ Java ä¸­æ‰€æ²¡æœ‰çš„</p><p>å¥½äº†ï¼Œåˆ°è¿™é‡Œï¼ŒKotlin æ³›å‹å°±è®²å®Œäº†ï¼Œç›¸ä¿¡ä½ å¦‚æœä»å¤´çœ‹åˆ°è¿™é‡Œï¼Œæ”¶è·ä¸€å®šå¾ˆå¤šï¼Œå¦‚æœè§‰å¾—æˆ‘å†™å¾—è¿˜ä¸é”™ï¼Œè¯·ç»™æˆ‘ç‚¹ä¸ªèµå§ğŸ¤ï¼Œå¦‚æœæœ‰ä»»ä½•é—®é¢˜ï¼Œæ¬¢è¿è¯„è®ºåŒºä¸€èµ·è®¨è®º</p><p><strong>æ„Ÿè°¢ä½ é˜…è¯»è¿™ç¯‡æ–‡ç« </strong></p><blockquote><p><strong>ä½ çš„ç‚¹èµï¼Œè¯„è®ºï¼Œæ˜¯å¯¹æˆ‘å·¨å¤§çš„é¼“åŠ±ï¼</strong></p><p>æ¬¢è¿å…³æ³¨æˆ‘çš„<strong>å…¬ä¼—å·ï¼š</strong>  <a href="http://m6z.cn/6jwi7b"><strong>sweetying</strong></a> ï¼Œæ–‡ç« æ›´æ–°å¯ç¬¬ä¸€æ—¶é—´æ”¶åˆ°</p><p>å¦‚æœ<strong>æœ‰é—®é¢˜</strong>ï¼Œå…¬ä¼—å·å†…æœ‰åŠ æˆ‘å¾®ä¿¡çš„å…¥å£ï¼Œåœ¨æŠ€æœ¯å­¦ä¹ ã€ä¸ªäººæˆé•¿çš„é“è·¯ä¸Šï¼Œæˆ‘ä»¬ä¸€èµ·å‰è¿›ï¼</p></blockquote>]]></content>
    
    
    <categories>
      
      <category>Android</category>
      
      <category>Kotlin</category>
      
    </categories>
    
    
    <tags>
      
      <tag>åŸåˆ›</tag>
      
      <tag>Android</tag>
      
      <tag>Kotlin</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Kotlin ç³»åˆ—ï¼ˆä¸€ï¼‰ï¼šKotlinå…¥é—¨</title>
    <link href="/2022/10/11/Kotlin%20%E7%B3%BB%E5%88%97%EF%BC%88%E4%B8%80%EF%BC%89%EF%BC%9AKotlin%E5%85%A5%E9%97%A8/"/>
    <url>/2022/10/11/Kotlin%20%E7%B3%BB%E5%88%97%EF%BC%88%E4%B8%80%EF%BC%89%EF%BC%9AKotlin%E5%85%A5%E9%97%A8/</url>
    
    <content type="html"><![CDATA[<p><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/448dcf3e2a204e2d8ec6643313775c5c~tplv-k3u1fbpfcp-watermark.image"></p><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>Google åœ¨2017å¹´ I&#x2F;O å¤§ä¼šä¸Šå®£å¸ƒï¼ŒKotlin æ­£å¼æˆä¸º Android çš„ä¸€çº§å¼€å‘è¯­è¨€ï¼Œå’Œ Java å¹³èµ·å¹³åï¼ŒAndroidStudio ä¹Ÿå¯¹ Kotlin è¿›è¡Œäº†å…¨é¢çš„æ”¯æŒï¼Œä¸¤å¹´åï¼ŒGoogle åˆåœ¨2019å¹´ I&#x2F;O å¤§ä¼šä¸Šå®£å¸ƒï¼ŒKotlin å·²ç»æˆä¸º Android çš„ç¬¬ä¸€å¼€å‘è¯­è¨€ï¼Œè™½ç„¶è¯´ Java ä»ç„¶å¯ä»¥ç»§ç»­ä½¿ç”¨ï¼Œä½† Google æ›´åŠ æ¨èæˆ‘ä»¬ä½¿ç”¨ Kotlin æ¥å¼€å‘ Android åº”ç”¨ç¨‹åºï¼Œåç»­æä¾›çš„å®˜æ–¹ Api ä¹Ÿä¼šä¼˜å…ˆè€ƒè™‘ Kotlin ç‰ˆæœ¬ï¼Œè€Œä¸”ç°åœ¨çš„å¼€å‘è€…æ— è®ºæ˜¯å†™æŠ€æœ¯åšå®¢ï¼Œè¿˜æ˜¯ç¬¬ä¸‰æ–¹åº“ï¼ŒåŸºæœ¬ä¸Šéƒ½ç”¨çš„Kotlinï¼Œå¤–åŠ å…¬å¸æŠ€æœ¯æ¼”è¿›éœ€è¦ä½¿ç”¨åˆ° Kotlinï¼Œå› æ­¤å­¦ä¹  Kotlin ç¼–ç¨‹æ˜¯éå¸¸é‡è¦å’Œç´§æ€¥çš„ä¸€ä»¶äº‹æƒ…ã€‚</p><h2 id="Kotlin-ä»‹ç»"><a href="#Kotlin-ä»‹ç»" class="headerlink" title="Kotlin ä»‹ç»"></a>Kotlin ä»‹ç»</h2><p>å®˜ç½‘å¯¹ Kotlin çš„ä»‹ç»ï¼šA modern programming languagethat makes developers happier. ç¿»è¯‘è¿‡æ¥å°±æ˜¯ï¼š<strong>Kotlin æ˜¯ä¸€é—¨è®©å¼€å‘è€…æ›´å¼€å¿ƒçš„ç°ä»£ç¨‹åºè®¾è®¡è¯­è¨€ ã€‚</strong> ç”± JetBrains å…¬å¸å¼€å‘å’Œè®¾è®¡ï¼Œå®ƒä¹Ÿæ˜¯ä¸€é—¨åŸºäº JVM çš„é™æ€è¯­è¨€ã€‚</p><h2 id="é—®é¢˜"><a href="#é—®é¢˜" class="headerlink" title="é—®é¢˜"></a>é—®é¢˜</h2><p>åœ¨å­¦ä¹  Kotlin çš„æ—¶å€™æˆ‘å¿ƒé‡Œä¼šæœ‰ä¸€äº›ç–‘é—®ğŸ¤”ï¸ ï¼Ÿ</p><p>1ã€Android æ“ä½œç³»ç»Ÿæ˜¯ç”± Google å¼€å‘å‡ºæ¥çš„ï¼Œä¸ºå•¥ JetBrains ä½œä¸ºä¸€ä¸ªç¬¬ä¸‰æ–¹å…¬å¸ï¼Œå´èƒ½è®¾è®¡å‡ºä¸€é—¨è¯­è¨€æ¥å¼€å‘ Android åº”ç”¨ç¨‹åºï¼Ÿ</p><p>å› ä¸º Java è™šæ‹Ÿæœºï¼ˆAndroid ä¸­å« ARTï¼Œä¸€ç§åŸºäº Java è™šæ‹Ÿæœºä¼˜åŒ–çš„è™šæ‹Ÿæœºï¼‰å¹¶ä¸ç›´æ¥å’Œä½ ç¼–å†™çš„è¿™é—¨è¯­è¨€çš„æºä»£ç æ‰“äº¤é“ï¼Œè€Œæ˜¯å’Œä½ ç¼–è¯‘ä¹‹åçš„ class å­—èŠ‚ç æ–‡ä»¶æ‰“äº¤é“ã€‚åŸºäº JVM çš„è¯­è¨€ï¼Œå¦‚ Kotlinï¼ŒGroovyç­‰ï¼Œå®ƒä»¬éƒ½ä¼šæœ‰å„è‡ªçš„ç¼–è¯‘å™¨ï¼ŒæŠŠæºæ–‡ä»¶ç¼–è¯‘æˆ class å­—èŠ‚ç æ–‡ä»¶ï¼ŒJava è™šæ‹Ÿæœºä¸å…³å¿ƒ class å­—èŠ‚ç æ–‡ä»¶æ˜¯ä»å“ªé‡Œç¼–è¯‘è€Œæ¥ï¼Œåªè¦ç¬¦åˆè§„æ ¼çš„ class å­—èŠ‚ç æ–‡ä»¶ï¼Œå®ƒéƒ½èƒ½è¯†åˆ«ï¼Œæ­£æ˜¯å› ä¸ºè¿™ä¸ªåŸå› ï¼ŒJetBrains æ‰èƒ½ä»¥ä¸€ä¸ªç¬¬ä¸‰æ–¹å…¬å¸è®¾è®¡å‡ºä¸€é—¨æ¥å¼€å‘ Android åº”ç”¨ç¨‹åºçš„ç¼–ç¨‹è¯­è¨€</p><p>2ã€ä¸ºå•¥æœ‰äº† Java æ¥å¼€å‘ Android åº”ç”¨ç¨‹åºï¼ŒGoogle è¿˜è¦æ¨èä½¿ç”¨ Kotlin æ¥å¼€å‘ï¼Ÿ</p><p>åŸå› æœ‰å¾ˆå¤šï¼Œåˆ—ä¸¾ä¸»è¦çš„å‡ ç‚¹ï¼š</p><ul><li>1ï¼‰ã€Kotlin è¯­æ³•æ›´åŠ ç®€æ´ï¼Œä½¿ç”¨ Kotlin å¼€å‘çš„ä»£ç é‡å¯èƒ½ä¼šæ¯” Java å¼€å‘çš„å‡å°‘ 50% ç”šè‡³æ›´å¤š</li><li>2ï¼‰ã€Kotlin çš„è¯­æ³•æ›´åŠ é«˜çº§ï¼Œç›¸æ¯”äº Java è€æ—§çš„è¯­æ³•ï¼ŒKotlin å¢åŠ äº†å¾ˆå¤šç°ä»£é«˜çº§è¯­è¨€çš„è¯­æ³•ç‰¹æ€§ï¼Œå¤§å¤§æå‡äº†æˆ‘ä»¬çš„å¼€å‘æ•ˆç‡</li><li>3ï¼‰ã€Kotlin å’Œ Java æ˜¯ 100% å…¼å®¹çš„ï¼ŒKotlin å¯ä»¥ç›´æ¥è°ƒç”¨ Java ç¼–å†™çš„ä»£ç ï¼Œä¹Ÿå¯ä»¥æ— ç¼ä½¿ç”¨ Java ç¬¬ä¸‰æ–¹å¼€æºåº“ï¼Œè¿™ä½¿å¾— Kotlin åœ¨åŠ å…¥äº†è¯¸å¤šæ–°ç‰¹æ€§çš„åŒæ—¶ï¼Œè¿˜ç»§æ‰¿äº† Java çš„å…¨éƒ¨è´¢å¯Œ</li></ul><p>3ã€ä¸ºå•¥ Kotlin ä¸­è¦æ˜¾ç¤ºçš„å»å£°æ˜ä¸€ä¸ªéæŠ½è±¡ç±»å¯ç»§æ‰¿ï¼Œè€Œä¸åƒ Java é‚£æ ·å®šä¹‰çš„ç±»é»˜è®¤å¯ç»§æ‰¿ï¼Ÿ</p><p>å› ä¸ºä¸€ä¸ªç±»é»˜è®¤å¯è¢«ç»§æ‰¿çš„è¯ï¼Œå®ƒæ— æ³•é¢„çŸ¥å­ç±»ä¼šå¦‚ä½•å»å®ç°ï¼Œå› æ­¤å­˜åœ¨ä¸€äº›æœªçŸ¥çš„é£é™©ã€‚ç±»æ¯” val å…³é”®å­—æ˜¯åŒæ ·çš„é“ç†ï¼Œåœ¨ Java ä¸­ï¼Œé™¤éä½ ä¸»åŠ¨ç»™å˜é‡å£°æ˜ final å…³é”®å­—ï¼Œå¦åˆ™è¿™ä¸ªå˜é‡å°±æ˜¯å¯å˜çš„ï¼Œéšç€é¡¹ç›®å¤æ‚åº¦å¢åŠ ï¼Œå¤šäººåä½œå¼€å‘ï¼Œä½ æ°¸è¿œä¸çŸ¥é“ä¸€ä¸ªå¯å˜çš„å˜é‡ä¼šåœ¨ä»€ä¹ˆæ—¶å€™è¢«è°ä¿®æ”¹äº†ï¼Œå³ä½¿å®ƒåŸæœ¬ä¸åº”è¯¥ä¿®æ”¹ï¼Œä¹Ÿå¾ˆéš¾å»æ’æŸ¥é—®é¢˜ã€‚å› æ­¤ Kotlin è¿™æ ·çš„è®¾è®¡æ˜¯ä¸ºäº†è®©ç¨‹åºæ›´åŠ çš„å¥å£®ï¼Œä¹Ÿæ›´ç¬¦åˆé«˜è´¨é‡ç¼–ç çš„è§„èŒƒ</p><p>ä¸‹é¢æˆ‘ä»¬å°±æ­£å¼è¿›å…¥åˆ° Kotlin çš„å­¦ä¹ </p><p><strong>é™„ä¸Šä¸€å¼ å­¦ä¹  Kotlin çš„æ€ç»´å¯¼å›¾</strong></p><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/c02ae1fd55784c0593e53afa00fd1fec~tplv-k3u1fbpfcp-zoom-1.image" alt="image-20210116114509401"></p><p><strong>æ³¨æ„ï¼š Kotlin ç°ä½œä¸º Android ç¬¬ä¸€å¼€å‘è¯­è¨€ï¼ŒAndroidStudio ä½œä¸º Google çš„äº²å„¿å­ï¼Œå¯¹ Kotlin è¿›è¡Œäº†å®Œç¾çš„æ”¯æŒï¼Œå¼€å‘æç¤ºåº”æœ‰å°½æœ‰ï¼Œå› æ­¤ä¸‹é¢æ‰€æœ‰çš„æ¼”ç¤ºä»£ç éƒ½æ˜¯è·‘åœ¨ AndroidStudio ä¸Šçš„</strong></p><h2 id="ä¸€ã€å˜é‡å’Œå‡½æ•°"><a href="#ä¸€ã€å˜é‡å’Œå‡½æ•°" class="headerlink" title="ä¸€ã€å˜é‡å’Œå‡½æ•°"></a>ä¸€ã€å˜é‡å’Œå‡½æ•°</h2><h3 id="1ã€å˜é‡"><a href="#1ã€å˜é‡" class="headerlink" title="1ã€å˜é‡"></a>1ã€å˜é‡</h3><p>1ï¼‰ã€ä½¿ç”¨ valï¼ˆvalue çš„ç®€å†™ï¼‰å…³é”®å­—æ¥å£°æ˜ä¸€ä¸ªä¸å¯å˜çš„å˜é‡ï¼Œä¹Ÿå°±æ˜¯åªè¯»å˜é‡ï¼Œè¿™ç§å˜é‡åˆå§‹èµ‹å€¼åå°±ä¸èƒ½é‡æ–°èµ‹å€¼äº†ï¼Œå¯¹åº” Java ä¸­çš„ final å˜é‡</p><p>2ï¼‰ã€ä½¿ç”¨ var ï¼ˆvariable çš„ç®€å†™ï¼‰å…³é”®å­—ç”¨æ¥å£°æ˜ä¸€ä¸ªå¯å˜çš„å˜é‡ï¼Œä¹Ÿå°±æ˜¯å¯è¯»å†™å˜é‡ï¼Œè¿™ç§å˜é‡åˆå§‹èµ‹åˆå€¼åä»ç„¶å¯ä»¥é‡æ–°è¢«èµ‹å€¼ï¼Œå¯¹åº” Java ä¸­çš„é final å˜é‡</p><p>3ï¼‰ã€Kotlin ä¸­çš„æ¯ä¸€è¡Œä»£ç éƒ½ä¸ç”¨åŠ  ï¼›</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-comment">//åœ¨ Java ä¸­ï¼Œæˆ‘ä»¬ä¼šè¿™ä¹ˆå®šä¹‰</span><br>int a = <span class="hljs-number">10</span>;<br>boolean b = <span class="hljs-literal">true</span><br><br><span class="hljs-comment">//åœ¨ Kotlin ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥è¿™ä¹ˆå®šä¹‰ï¼Œå½“ç»™å˜é‡èµ‹å€¼åï¼ŒKotlin ç¼–è¯‘å™¨ä¼šè¿›è¡Œç±»å‹æ¨å¯¼</span><br><span class="hljs-comment">//å®šä¹‰ä¸€ä¸ªä¸å¯å˜çš„å˜é‡ a </span><br><span class="hljs-keyword">val</span> a = <span class="hljs-number">10</span><br><span class="hljs-comment">//å®šä¹‰ä¸€ä¸ªå¯å˜çš„å˜é‡ b</span><br><span class="hljs-keyword">var</span> b = <span class="hljs-literal">true</span><br><br><span class="hljs-comment">//å¦‚æœæˆ‘ä»¬æ˜¾ç¤ºçš„ç»™å˜é‡æŒ‡å®šç±»å‹ï¼ŒKotlin å°±ä¸ä¼šè¿›è¡Œç±»å‹æ¨å¯¼äº†</span><br><span class="hljs-keyword">val</span> a: <span class="hljs-built_in">Int</span> = <span class="hljs-number">10</span><br><span class="hljs-keyword">var</span> b: <span class="hljs-built_in">Boolean</span> = <span class="hljs-string">&quot;erdai&quot;</span><br></code></pre></td></tr></table></figure><p>å¦‚æœä½ è§‚å¯Ÿçš„ä»”ç»†ä¼šå‘ç°ï¼Œä¸Šè¿°ä»£ç  Kotlin å®šä¹‰å˜é‡ç»™å˜é‡æ˜¾ç¤ºçš„æŒ‡å®šç±»å‹æ—¶ï¼Œä½¿ç”¨çš„éƒ½æ˜¯é¦–å­—æ¯å¤§å°çš„ Intï¼ŒBooleanï¼Œè€Œåœ¨ Java ä¸­éƒ½æ˜¯å°å†™çš„ intï¼Œbooleanï¼Œè¿™è¡¨æ˜ï¼š <strong>Kotlin å®Œå…¨æŠ›å¼ƒäº† Java ä¸­çš„åŸºæœ¬æ•°æ®ç±»å‹ï¼Œå…¨éƒ¨éƒ½æ˜¯å¯¹è±¡æ•°æ®ç±»å‹ã€‚</strong> ä¸‹é¢ç»™å‡ºä¸€ä¸ª Java å’Œ Kotlin æ•°æ®ç±»å‹å¯¹ç…§è¡¨ï¼š</p><table><thead><tr><th>Java åŸºæœ¬æ•°æ®ç±»å‹</th><th>Kotlin å¯¹è±¡æ•°æ®ç±»å‹</th><th>æ•°æ®ç±»å‹è¯´æ˜</th></tr></thead><tbody><tr><td>byte</td><td>Byte</td><td>å­—èŠ‚å‹</td></tr><tr><td>short</td><td>Short</td><td>çŸ­æ•´å‹</td></tr><tr><td>int</td><td>Int</td><td>æ•´å‹</td></tr><tr><td>long</td><td>Long</td><td>é•¿æ•´å‹</td></tr><tr><td>float</td><td>Float</td><td>å•ç²¾åº¦æµ®ç‚¹æ•°</td></tr><tr><td>double</td><td>Double</td><td>åŒç²¾åº¦æµ®ç‚¹æ•°</td></tr><tr><td>char</td><td>Char</td><td>å­—ç¬¦å‹</td></tr><tr><td>boolean</td><td>Boolean</td><td>å¸ƒå°”å‹</td></tr></tbody></table><h3 id="2ã€å¸¸é‡"><a href="#2ã€å¸¸é‡" class="headerlink" title="2ã€å¸¸é‡"></a>2ã€å¸¸é‡</h3><p>Kotlin ä¸­å®šä¹‰ä¸€ä¸ªå¸¸é‡éœ€è¦æ»¡è¶³ä¸‰ä¸ªæ¡ä»¶</p><p>1ï¼‰ã€ä½¿ç”¨ const val æ¥ä¿®é¥°ï¼Œå¹¶åˆå§‹åŒ–</p><p>2ï¼‰ã€ä¿®é¥°çš„ç±»å‹åªèƒ½æ˜¯å­—ç¬¦ä¸²å’ŒåŸºç¡€å¯¹è±¡ç±»å‹</p><p>3ï¼‰ã€åªèƒ½ä¿®é¥°é¡¶å±‚çš„å¸¸é‡ï¼Œobject ä¿®é¥°çš„æˆå‘˜ï¼Œcompanion object çš„æˆå‘˜ï¼Œè¿™äº›æ¦‚å¿µåé¢è¿˜ä¼šè®²åˆ°</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-comment">//å®šä¹‰ä¸€ä¸ªé¡¶å±‚çš„å¸¸é‡ï¼Œè¿™ä¸ªå¸¸é‡ä¸æ”¾åœ¨ä»»ä½•çš„ç±»ä¸­</span><br><span class="hljs-keyword">const</span> <span class="hljs-keyword">val</span> CONSTANT = <span class="hljs-string">&quot;This is a constant&quot;</span><br><br><span class="hljs-comment">//å®šä¹‰ä¸€ä¸ª object ä¿®é¥°çš„å•ä¾‹ç±»ï¼Œç±»ä¸­å®šä¹‰ä¸€ä¸ªå¸¸é‡</span><br><span class="hljs-keyword">object</span> SingeTon &#123;<br>    <span class="hljs-keyword">const</span> <span class="hljs-keyword">val</span> CONSTANT = <span class="hljs-string">&quot;This is a constant&quot;</span><br>&#125;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">KotlinPractice</span> &#123;<br>    <span class="hljs-comment">//å®šä¹‰ä¸€ä¸ª companion object ä¿®é¥°çš„ä¼´ç”Ÿå¯¹è±¡ï¼Œé‡Œé¢å®šä¹‰ä¸€ä¸ªå¸¸é‡</span><br>    <span class="hljs-keyword">companion</span> <span class="hljs-keyword">object</span>&#123;<br>        <span class="hljs-keyword">const</span> <span class="hljs-keyword">val</span> CONSTANT = <span class="hljs-string">&quot;This is a constant&quot;</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="3ã€å‡½æ•°"><a href="#3ã€å‡½æ•°" class="headerlink" title="3ã€å‡½æ•°"></a>3ã€å‡½æ•°</h3><p>1ï¼‰ã€å‡½æ•°å’Œæ–¹æ³•æ˜¯åŒä¸€ä¸ªæ¦‚å¿µï¼Œåœ¨ Java ä¸­æˆ‘ä»¬ä¹ æƒ¯å«æ–¹æ³• (method)ï¼Œä½†æ˜¯ Kotlin ä¸­å°±éœ€è¦å«å‡½æ•° (function)</p><p>2ï¼‰ã€å‡½æ•°æ˜¯è¿è¡Œä»£ç çš„è½½ä½“,åƒæˆ‘ä»¬ä½¿ç”¨è¿‡çš„ main å‡½æ•°å°±æ˜¯ä¸€ä¸ªå‡½æ•°</p><p>Kotlin ä¸­å®šä¹‰è¯­æ³•çš„è§„åˆ™ï¼š</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">methodName</span><span class="hljs-params">(param1: <span class="hljs-type">Int</span>, param2: <span class="hljs-type">Int</span>)</span></span>: <span class="hljs-built_in">Int</span> &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span><br>&#125;<br><br><span class="hljs-comment">//ä¸‹é¢è¿™ä¸¤ä¸ªæ–¹æ³•æ•ˆæœæ˜¯ä¸€æ ·çš„</span><br><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">methodName1</span><span class="hljs-params">(params: <span class="hljs-type">Int</span>,params2: <span class="hljs-type">Int</span>)</span></span>: <span class="hljs-built_in">Unit</span>&#123;<br><br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">methodName1</span><span class="hljs-params">(params: <span class="hljs-type">Int</span>,params2: <span class="hljs-type">Int</span>)</span></span>&#123;<br><br>&#125;<br></code></pre></td></tr></table></figure><p>ä¸Šè¿°å‡½æ•°è¯­æ³•è§£é‡Šï¼š</p><ul><li>fun ( function çš„ç¼©å†™ ) æ˜¯å®šä¹‰ä¸€ä¸ªå‡½æ•°çš„å…³é”®å­—ï¼Œæ— è®ºä½ å®šä¹‰ä»€ä¹ˆå‡½æ•°ï¼Œéƒ½è¦ç”¨ fun æ¥å£°æ˜</li><li>å‡½æ•°åç§°å¯ä»¥éšä¾¿å–ï¼Œå°±åƒ Java é‡Œé¢å®šä¹‰å‡½æ•°åä¸€æ ·</li><li>å‡½æ•°åé‡Œé¢çš„å‚æ•°å¯ä»¥æœ‰ä»»æ„å¤šä¸ªï¼Œå‚æ•°çš„å£°æ˜æ ¼å¼ä¸ºï¼šâ€å‚æ•°åâ€ï¼šâ€å‚æ•°ç±»å‹â€</li><li>å‚æ•°ååé¢è¿™éƒ¨åˆ†ä»£è¡¨è¿”å›å€¼ï¼Œæˆ‘ä»¬è¿™è¿”å›çš„æ˜¯ä¸€ä¸ª Int ç±»å‹çš„å€¼ï¼Œè¿™éƒ¨åˆ†æ˜¯å¯é€‰çš„ï¼Œå¦‚æœä¸å®šä¹‰ï¼Œé»˜è®¤è¿”å›å€¼ä¸º Unitï¼Œä¸” Unit å¯çœç•¥</li></ul><p>å®è·µä¸€ä¸‹ï¼š</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>    <span class="hljs-keyword">val</span> number1 = <span class="hljs-number">15</span><br>    <span class="hljs-keyword">val</span> number2 = <span class="hljs-number">20</span><br>    <span class="hljs-keyword">val</span> maxNumber = largeNumber(number1,number2)<br>    println(maxNumber)<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">largeNumber</span><span class="hljs-params">(number1: <span class="hljs-type">Int</span>,number2: <span class="hljs-type">Int</span>)</span></span> : <span class="hljs-built_in">Int</span>&#123;<br>    <span class="hljs-comment">//è°ƒç”¨é¡¶å±‚ max å‡½æ•°è®¡ç®—ä¸¤è€…ä¸­çš„æœ€å¤§å€¼</span><br>    <span class="hljs-keyword">return</span> max(number1,number2)<br>&#125;<br><br><span class="hljs-comment">//æ‰“å°ç»“æœ</span><br><span class="hljs-number">20</span><br></code></pre></td></tr></table></figure><p><strong>Kotlin è¯­æ³•ç³–ï¼šå½“ä¸€ä¸ªå‡½æ•°ä½“ä¸­åªæœ‰ä¸€è¡Œä»£ç çš„æ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥ä¸ç¼–å†™å‡½æ•°ä½“ï¼Œå¯ä»¥å°†å”¯ä¸€çš„ä¸€è¡Œä»£ç å†™åœ¨å‡½æ•°å®šä¹‰çš„å°¾éƒ¨ï¼Œä¸­é—´ç”¨ &#x3D; è¿æ¥å³å¯</strong></p><p>é‚£ä¹ˆä¸Šè¿° largeNumber è¿™ä¸ªå‡½æ•°æˆ‘ä»¬æ”¹é€ ä¸€ä¸‹ï¼š</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-comment">//æ ¹æ®ä¸Šè¿°è¯­æ³•ç³–ï¼Œæˆ‘ä»¬çœç•¥äº†å‡½æ•°ä½“çš„ &#123;&#125; å’Œ return å…³é”®å­—ï¼Œå¢å‡çš„ = è¿æ¥</span><br><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">largeNumber</span><span class="hljs-params">(number1: <span class="hljs-type">Int</span>,number2: <span class="hljs-type">Int</span>)</span></span> : <span class="hljs-built_in">Int</span> = max(number1,number2)<br><span class="hljs-comment">//æ ¹æ® Kotlin ç±»å‹æ¨å¯¼æœºåˆ¶ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥æŠŠå‡½æ•°çš„è¿”å›å€¼ç»™çœç•¥ï¼Œæœ€ç»ˆå˜æˆäº†è¿™æ ·</span><br><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">largeNumber</span><span class="hljs-params">(number1: <span class="hljs-type">Int</span>,number2: <span class="hljs-type">Int</span>)</span></span> = max(number1,number2)<br></code></pre></td></tr></table></figure><h2 id="äºŒã€ç¨‹åºçš„é€»è¾‘æ§åˆ¶"><a href="#äºŒã€ç¨‹åºçš„é€»è¾‘æ§åˆ¶" class="headerlink" title="äºŒã€ç¨‹åºçš„é€»è¾‘æ§åˆ¶"></a>äºŒã€ç¨‹åºçš„é€»è¾‘æ§åˆ¶</h2><h3 id="1ã€if-æ¡ä»¶è¯­å¥"><a href="#1ã€if-æ¡ä»¶è¯­å¥" class="headerlink" title="1ã€if æ¡ä»¶è¯­å¥"></a>1ã€if æ¡ä»¶è¯­å¥</h3><p>1ï¼‰ã€Kotlin ä¸­çš„ if æ¡ä»¶è¯­å¥é™¤äº†ç»§æ‰¿äº† Java ä¸­ if æ¡ä»¶è¯­å¥çš„æ‰€æœ‰ç‰¹æ€§ï¼Œä¸”å¯ä»¥æŠŠæ¯ä¸€ä¸ªæ¡ä»¶ä¸­çš„æœ€åä¸€è¡Œä»£ç ä½œä¸ºè¿”å›å€¼</p><p>æˆ‘ä»¬æ”¹é€ ä¸€ä¸‹ä¸Šè¿° largeNumber å‡½æ•°çš„å†…éƒ¨å®ç°ï¼š</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-comment">//Kotlin ä¸­æŠŠæ¯ä¸€ä¸ªæ¡ä»¶ä¸­çš„æœ€åä¸€è¡Œä»£ç ä½œä¸ºè¿”å›å€¼</span><br><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">largeNumber</span><span class="hljs-params">(number1: <span class="hljs-type">Int</span>,number2: <span class="hljs-type">Int</span>)</span></span> : <span class="hljs-built_in">Int</span>&#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">if</span>(number1 &gt; number2)&#123;<br>      number1<br>    &#125;<span class="hljs-keyword">else</span> &#123;<br>      number2<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">//æ ¹æ®ä¸Šé¢å­¦ä¹ çš„è¯­æ³•ç³–å’Œ Kotlin ç±»å‹æ¨å¯¼æœºåˆ¶ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥ç®€å†™ largeNumber å‡½æ•°ï¼Œæœ€ç»ˆå˜æˆäº†è¿™æ ·</span><br><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">largeNumber</span><span class="hljs-params">(number1: <span class="hljs-type">Int</span>,number2: <span class="hljs-type">Int</span>)</span></span> = <span class="hljs-keyword">if</span>(number1 &gt; number2) number1 <span class="hljs-keyword">else</span> number <span class="hljs-number">2</span><br></code></pre></td></tr></table></figure><h3 id="2ã€when-æ¡ä»¶è¯­å¥"><a href="#2ã€when-æ¡ä»¶è¯­å¥" class="headerlink" title="2ã€when æ¡ä»¶è¯­å¥"></a>2ã€when æ¡ä»¶è¯­å¥</h3><p>ç±»æ¯” Java ä¸­çš„ Switch è¯­å¥å­¦ä¹ ï¼ŒJava ä¸­çš„ Switch å¹¶ä¸æ€ä¹ˆå¥½ç”¨ï¼š</p><p>1ï¼‰ã€Switch è¯­å¥åªèƒ½æ”¯æŒä¸€äº›ç‰¹å®šçš„ç±»å‹ï¼Œå¦‚æ•´å‹ï¼ŒçŸ­äºæ•´å‹ï¼Œå­—ç¬¦ä¸²ï¼Œæšä¸¾ç±»å‹ã€‚å¦‚æœæˆ‘ä»¬ä½¿ç”¨çš„å¹¶éè¿™å‡ ç§ç±»å‹ï¼ŒSwitch å¹¶ä¸å¯ç”¨</p><p>2ï¼‰ã€Switch è¯­å¥çš„ case æ¡ä»¶éƒ½è¦åœ¨æœ€ååŠ ä¸Šä¸€ä¸ª break</p><p>è¿™äº›é—®é¢˜åœ¨ Kotlin ä¸­éƒ½å¾—åˆ°äº†è§£å†³ï¼Œè€Œä¸” Kotlin è¿˜åŠ å…¥äº†è®¸å¤šå¼ºå¤§çš„æ–°ç‰¹æ€§ï¼š</p><p>1ï¼‰ã€when æ¡ä»¶è¯­å¥ä¹Ÿæ˜¯æœ‰è¿”å›å€¼çš„ï¼Œå’Œ if æ¡ä»¶è¯­å¥ç±»ä¼¼ï¼Œæ¡ä»¶ä¸­çš„æœ€åä¸€è¡Œä»£ç ä½œä¸ºè¿”å›å€¼</p><p>2ï¼‰ã€when æ¡ä»¶è¯­å¥å…è®¸ä¼ å…¥ä»»æ„ç±»å‹çš„å‚æ•°</p><p>3ï¼‰ã€when æ¡ä»¶ä½“ä¸­æ¡ä»¶æ ¼å¼ï¼šåŒ¹é…å€¼ -&gt; { æ‰§è¡Œé€»è¾‘ }</p><p>4ï¼‰ã€when æ¡ä»¶è¯­å¥å’Œ if æ¡ä»¶è¯­å¥ä¸€æ ·ï¼Œå½“æ¡ä»¶ä½“é‡Œé¢åªæœ‰ä¸€è¡Œä»£ç çš„æ—¶å€™ï¼Œæ¡ä»¶ä½“çš„ {} å¯çœç•¥</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-comment">//when ä¸­æœ‰å‚æ•°çš„æƒ…å†µ</span><br><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">getScore</span><span class="hljs-params">(name: <span class="hljs-type">String</span>)</span></span> = <span class="hljs-keyword">when</span> (name) &#123;<br>    <span class="hljs-string">&quot;tom&quot;</span> -&gt; <span class="hljs-number">99</span><br>    <span class="hljs-string">&quot;jim&quot;</span> -&gt; <span class="hljs-number">80</span><br>    <span class="hljs-string">&quot;lucy&quot;</span> -&gt; <span class="hljs-number">70</span><br>    <span class="hljs-keyword">else</span> -&gt; <span class="hljs-number">0</span><br>&#125;<br><br><span class="hljs-comment">//when ä¸­æ— å‚æ•°çš„æƒ…å†µï¼ŒKotin ä¸­åˆ¤æ–­å­—ç¬¦ä¸²æˆ–è€…å¯¹è±¡æ˜¯å¦ç›¸ç­‰ï¼Œç›´æ¥ä½¿ç”¨ == æ“ä½œç¬¦å³å¯</span><br><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">getScore</span><span class="hljs-params">(name: <span class="hljs-type">String</span>)</span></span> = <span class="hljs-keyword">when</span> &#123;<br>    name == <span class="hljs-string">&quot;tom&quot;</span> -&gt; <span class="hljs-number">99</span><br>    name == <span class="hljs-string">&quot;jim&quot;</span> -&gt; <span class="hljs-number">80</span><br>    name ==<span class="hljs-string">&quot;lucy&quot;</span> -&gt; <span class="hljs-number">70</span><br>    <span class="hljs-keyword">else</span> -&gt; <span class="hljs-number">0</span><br>&#125;<br></code></pre></td></tr></table></figure><h3 id="3ã€å¾ªç¯è¯­å¥"><a href="#3ã€å¾ªç¯è¯­å¥" class="headerlink" title="3ã€å¾ªç¯è¯­å¥"></a>3ã€å¾ªç¯è¯­å¥</h3><p>ä¸»è¦æœ‰ä»¥ä¸‹ä¸¤ç§å¾ªç¯ï¼š</p><p>1ï¼‰ã€while å¾ªç¯ï¼Œè¿™ç§å¾ªç¯å’Œ Java æ²¡æœ‰ä»»ä½•åŒºåˆ«</p><p>2ï¼‰ã€for å¾ªç¯ï¼ŒJava ä¸­å¸¸ç”¨çš„å¾ªç¯æœ‰ï¼šfor-iï¼Œfor-eachï¼ŒKotlin ä¸­ä¸»è¦æ˜¯ï¼šfor-in</p><p><strong>åŒºé—´</strong></p><p>1ï¼‰ã€ä½¿ç”¨ .. è¡¨ç¤ºåˆ›å»ºä¸¤ç«¯éƒ½æ˜¯é—­åŒºé—´çš„å‡åºåŒºé—´</p><p>2ï¼‰ã€ä½¿ç”¨ until è¡¨ç¤ºåˆ›å»ºå·¦ç«¯æ˜¯é—­åŒºé—´å³ç«¯æ˜¯å¼€åŒºé—´çš„å‡åºåŒºé—´</p><p>3ï¼‰ã€ä½¿ç”¨ downTo è¡¨ç¤ºåˆ›å»ºä¸¤ç«¯éƒ½æ˜¯é—­åŒºé—´çš„é™åºåŒºé—´</p><p>4ï¼‰ã€åœ¨åŒºé—´çš„åé¢åŠ ä¸Š step ï¼Œè¡¨ç¤ºè·³è¿‡å‡ ä¸ªå…ƒç´ </p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-comment">//æ³¨æ„: Kotlin ä¸­å¯ä»¥ä½¿ç”¨å­—ç¬¦ä¸²å†…åµŒè¡¨è¾¾å¼ï¼Œä¹Ÿå°±æ˜¯åœ¨å­—ç¬¦ä¸²ä¸­å¯ä»¥å¼•ç”¨å˜é‡ï¼Œåç»­è¿˜ä¼šè®²åˆ°</span><br><span class="hljs-comment">//æƒ…å†µ1</span><br><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>    <span class="hljs-comment">//ä½¿ç”¨ .. è¡¨ç¤ºåˆ›å»ºä¸¤ç«¯éƒ½æ˜¯é—­åŒºé—´çš„å‡åºåŒºé—´</span><br>    <span class="hljs-keyword">for</span> (i <span class="hljs-keyword">in</span> <span class="hljs-number">0.</span><span class="hljs-number">.10</span>)&#123;<br>        print(<span class="hljs-string">&quot;<span class="hljs-variable">$i</span> &quot;</span>)<br>    &#125;<br>&#125;<br><span class="hljs-comment">//æ‰“å°ç»“æœ</span><br><span class="hljs-number">0</span> <span class="hljs-number">1</span> <span class="hljs-number">2</span> <span class="hljs-number">3</span> <span class="hljs-number">4</span> <span class="hljs-number">5</span> <span class="hljs-number">6</span> <span class="hljs-number">7</span> <span class="hljs-number">8</span> <span class="hljs-number">9</span> <span class="hljs-number">10</span><br><br><span class="hljs-comment">//æƒ…å†µ2</span><br><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>    <span class="hljs-comment">//ä½¿ç”¨ until è¡¨ç¤ºåˆ›å»ºå·¦ç«¯æ˜¯é—­åŒºé—´å³ç«¯æ˜¯å¼€åŒºé—´çš„å‡åºåŒºé—´</span><br>    <span class="hljs-keyword">for</span> (i <span class="hljs-keyword">in</span> <span class="hljs-number">0</span> until <span class="hljs-number">10</span>)&#123;<br>        print(<span class="hljs-string">&quot;<span class="hljs-variable">$i</span> &quot;</span>)<br>    &#125;<br>&#125;<br><span class="hljs-comment">//æ‰“å°ç»“æœ</span><br><span class="hljs-number">0</span> <span class="hljs-number">1</span> <span class="hljs-number">2</span> <span class="hljs-number">3</span> <span class="hljs-number">4</span> <span class="hljs-number">5</span> <span class="hljs-number">6</span> <span class="hljs-number">7</span> <span class="hljs-number">8</span> <span class="hljs-number">9</span><br><br><span class="hljs-comment">//æƒ…å†µ3</span><br><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>    <span class="hljs-comment">//ä½¿ç”¨ downTo è¡¨ç¤ºåˆ›å»ºä¸¤ç«¯éƒ½æ˜¯é—­åŒºé—´çš„é™åºåŒºé—´</span><br>    <span class="hljs-keyword">for</span> (i <span class="hljs-keyword">in</span> <span class="hljs-number">10</span> downTo <span class="hljs-number">0</span>)&#123;<br>        print(<span class="hljs-string">&quot;<span class="hljs-variable">$i</span> &quot;</span>)<br>    &#125;<br>&#125;<br><span class="hljs-comment">//æ‰“å°ç»“æœ</span><br><span class="hljs-number">10</span> <span class="hljs-number">9</span> <span class="hljs-number">8</span> <span class="hljs-number">7</span> <span class="hljs-number">6</span> <span class="hljs-number">5</span> <span class="hljs-number">4</span> <span class="hljs-number">3</span> <span class="hljs-number">2</span> <span class="hljs-number">1</span> <span class="hljs-number">0</span><br><br><span class="hljs-comment">//æƒ…å†µ4</span><br><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>    <span class="hljs-comment">//ä½¿ç”¨ downTo è¡¨ç¤ºåˆ›å»ºä¸¤ç«¯éƒ½æ˜¯é—­åŒºé—´çš„é™åºåŒºé—´,æ¯æ¬¡åœ¨è·³è¿‡3ä¸ªå…ƒç´ </span><br>    <span class="hljs-keyword">for</span> (i <span class="hljs-keyword">in</span> <span class="hljs-number">10</span> downTo <span class="hljs-number">0</span> step <span class="hljs-number">3</span>)&#123;<br>        print(<span class="hljs-string">&quot;<span class="hljs-variable">$i</span> &quot;</span>)<br>    &#125;<br>&#125;<br><span class="hljs-comment">//æ‰“å°ç»“æœ</span><br><span class="hljs-number">10</span> <span class="hljs-number">7</span> <span class="hljs-number">4</span> <span class="hljs-number">1</span> <br></code></pre></td></tr></table></figure><h2 id="ä¸‰ã€é¢å‘å¯¹è±¡ç¼–ç¨‹"><a href="#ä¸‰ã€é¢å‘å¯¹è±¡ç¼–ç¨‹" class="headerlink" title="ä¸‰ã€é¢å‘å¯¹è±¡ç¼–ç¨‹"></a>ä¸‰ã€é¢å‘å¯¹è±¡ç¼–ç¨‹</h2><p>å¯¹äºé¢å‘å¯¹è±¡ç¼–ç¨‹çš„ç†è§£ï¼šé¢å‘å¯¹è±¡çš„è¯­è¨€æ˜¯å¯ä»¥åˆ›å»ºç±»çš„ï¼Œç±»æ˜¯å¯¹äº‹ç‰©ä¸€ç§çš„å°è£…ï¼Œä¾‹å¦‚äººï¼Œæ±½è½¦æˆ‘ä»¬éƒ½å¯ä»¥æŠŠä»–ä»¬å°è£…æˆç±»ï¼Œç±»åé€šå¸¸æ˜¯åè¯ï¼Œç±»ä¸­æœ‰è‡ªå·±çš„å­—æ®µå’Œå‡½æ•°ï¼Œå­—æ®µè¡¨ç¤ºè¯¥ç±»æ‹¥æœ‰çš„å±æ€§ï¼Œé€šå¸¸ä¹Ÿæ˜¯åè¯ï¼Œå°±åƒäººå¯ä»¥æ‹¥æœ‰å§“åå’Œå¹´é¾„ï¼Œæ±½è½¦å¯ä»¥æ‹¥æœ‰å“ç‰Œå’Œä»·æ ¼ï¼Œå‡½æ•°è¡¨ç¤ºè¯¥ç±»æ‹¥æœ‰é‚£äº›è¡Œä¸ºï¼Œä¸€èˆ¬ä¸ºåŠ¨è¯ï¼Œå°±åƒäººéœ€è¦åƒé¥­ç¡è§‰ï¼Œæ±½è½¦å¯ä»¥é©¾é©¶å’Œä¿å…»ï¼Œé€šè¿‡è¿™ç§ç±»çš„å°è£…ï¼Œæˆ‘ä»¬å°±å¯ä»¥åœ¨é€‚å½“çš„åœ°æ–¹åˆ›å»ºè¿™äº›ç±»ï¼Œç„¶åè°ƒç”¨ä»–ä»¬çš„å­—æ®µå’Œå‡½æ•°æ¥æ»¡è¶³å®é™…çš„ç¼–ç¨‹éœ€æ±‚ï¼Œè¿™å°±æ˜¯é¢å‘å¯¹è±¡ç¼–ç¨‹æœ€åŸºæœ¬çš„æ€æƒ³</p><h3 id="1ã€ç±»ä¸å¯¹è±¡"><a href="#1ã€ç±»ä¸å¯¹è±¡" class="headerlink" title="1ã€ç±»ä¸å¯¹è±¡"></a>1ã€ç±»ä¸å¯¹è±¡</h3><p>æˆ‘ä»¬ä½¿ç”¨ AndroidStudio åˆ›å»ºä¸€ä¸ª Person ç±»ï¼Œåœ¨å¼¹å‡ºçš„å¯¹è¯æ¡†ä¸­è¾“å…¥ Person ï¼Œé€‰æ‹©Classï¼Œå¯¹è¯æ¡†é»˜è®¤æƒ…å†µä¸‹è‡ªåŠ¨é€‰ä¸­çš„æ˜¯åˆ›å»ºä¸€ä¸ªFileï¼ŒFile é€šå¸¸æ˜¯ç”¨äºç¼–å†™ Kotlin é¡¶å±‚å‡½æ•°å’Œæ‰©å±•å‡½æ•°ç­‰ï¼Œå¦‚ä¸‹å›¾ï¼š</p><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/71d1af4be3224b1c8bc6e8b0264aa18b~tplv-k3u1fbpfcp-zoom-1.image" alt="image-20210316190225365"></p><p>1ï¼‰ã€å½“æˆ‘ä»¬åœ¨ç±»ä¸­åˆ›å»ºå±æ€§çš„æ—¶å€™ï¼ŒKotlin ä¼šè‡ªåŠ¨å¸®æˆ‘ä»¬åˆ›å»º get å’Œ set æ–¹æ³•</p><p>2ï¼‰ã€Kotlin ä¸­å®ä¾‹åŒ–å¯¹è±¡å’Œ Java ç±»ä¼¼ï¼Œä½†æ˜¯æŠŠ new å…³é”®å­—ç»™å»æ‰äº†</p><p>3ï¼‰ã€ä¸€èˆ¬åœ¨ç±»ä¸­ï¼Œæˆ‘ä»¬ä¼šç”¨ var å…³é”®å­—å»å®šä¹‰ä¸€ä¸ªå±æ€§ï¼Œå› ä¸ºå±æ€§ä¸€èˆ¬æ˜¯å¯å˜çš„ï¼Œå¦‚æœä½ ç¡®å®šæŸä¸ªå±æ€§ä¸éœ€è¦æ”¹å˜ï¼Œåˆ™ç”¨ val</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Person</span> &#123;<br>    <span class="hljs-keyword">var</span> name = <span class="hljs-string">&quot;&quot;</span><br>    <span class="hljs-keyword">var</span> age = <span class="hljs-number">0</span><br><br>    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">sleep</span><span class="hljs-params">()</span></span>&#123;<br>        println(<span class="hljs-string">&quot;<span class="hljs-variable">$name</span> is sleep, He is <span class="hljs-variable">$age</span> years old.&quot;</span>)<br>    &#125;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>    <span class="hljs-keyword">val</span> person = Person()<br>    person.name = <span class="hljs-string">&quot;erdai&quot;</span><br>    person.age = <span class="hljs-number">20</span><br>    person.sleep()<br>&#125;<br><span class="hljs-comment">//æ‰“å°ç»“æœ</span><br>erdai <span class="hljs-keyword">is</span> sleep, He <span class="hljs-keyword">is</span> <span class="hljs-number">20</span> years old.<br></code></pre></td></tr></table></figure><h3 id="2ã€ç»§æ‰¿ä¸æ„é€ å‡½æ•°"><a href="#2ã€ç»§æ‰¿ä¸æ„é€ å‡½æ•°" class="headerlink" title="2ã€ç»§æ‰¿ä¸æ„é€ å‡½æ•°"></a>2ã€ç»§æ‰¿ä¸æ„é€ å‡½æ•°</h3><h4 id="ç»§æ‰¿"><a href="#ç»§æ‰¿" class="headerlink" title="ç»§æ‰¿"></a>ç»§æ‰¿</h4><p>1ï¼‰ã€Kotlin ä¸­è§„å®šï¼Œå¦‚æœè¦å£°æ˜ä¸€ä¸ªéæŠ½è±¡ç±»å¯ç»§æ‰¿ï¼Œå¿…é¡»åŠ ä¸Š open å…³é”®å­—ï¼Œå¦åˆ™ä¸å¯ç»§æ‰¿ï¼Œè¿™ç‚¹å’Œ Java ä¸­ä¸åŒï¼ŒJava ä¸­çš„ç±»é»˜è®¤æ˜¯å¯è¢«ç»§æ‰¿çš„ï¼ŒEffective Java è¿™æœ¬ä¹¦ä¸­æåˆ°ï¼šå¦‚æœä¸€ä¸ªç±»ä¸æ˜¯ä¸“é—¨ä¸ºç»§æ‰¿è€Œè®¾è®¡çš„ï¼Œé‚£ä¹ˆå°±åº”è¯¥ä¸»åŠ¨å°†å®ƒåŠ ä¸Š final å£°æ˜ï¼Œç¦æ­¢ä»–å¯ä»¥è¢«ç»§æ‰¿</p><p>2ï¼‰ã€Kotlinä¸­çš„ç»§æ‰¿å’Œå®ç°éƒ½æ˜¯ç”¨ : è¡¨ç¤º</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-comment">//å£°æ˜ Person ç±»å¯ä»¥è¢«ç»§æ‰¿</span><br><span class="hljs-keyword">open</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Person</span> &#123;<br>    <span class="hljs-keyword">var</span> name = <span class="hljs-string">&quot;&quot;</span><br>    <span class="hljs-keyword">var</span> age = <span class="hljs-number">0</span><br>  <br>    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">sleep</span><span class="hljs-params">()</span></span> &#123;<br>        println(<span class="hljs-string">&quot;<span class="hljs-variable">$name</span> is sleep, He is <span class="hljs-variable">$age</span> years old.&quot;</span>)<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">//å®šä¹‰ Student ç»§æ‰¿ Person ç±»</span><br><span class="hljs-comment">//ä¸ºå•¥ Person åé¢ä¼šæœ‰ä¸€ä¸ªæ‹¬å·å‘¢ï¼Ÿå› ä¸ºå­ç±»çš„æ„é€ å‡½æ•°å¿…é¡»è°ƒç”¨çˆ¶ç±»ä¸­çš„æ„é€ å‡½æ•°ï¼Œåœ¨ Java ä¸­ï¼Œå­ç±»çš„æ„é€ å‡½æ•°ä¼šéšå¼çš„å»è°ƒç”¨</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Student</span> : <span class="hljs-type">Person</span>()&#123;<br>    <br>&#125;<br></code></pre></td></tr></table></figure><h4 id="æ„é€ å‡½æ•°"><a href="#æ„é€ å‡½æ•°" class="headerlink" title="æ„é€ å‡½æ•°"></a>æ„é€ å‡½æ•°</h4><p>1ï¼‰ã€ä¸»æ„é€ å‡½æ•°çš„ç‰¹ç‚¹æ˜¯æ²¡æœ‰å‡½æ•°ä½“ï¼Œç›´æ¥è·Ÿåœ¨ç±»åçš„åé¢å³å¯ï¼Œå¦‚æœéœ€è¦åœ¨ä¸»æ„é€ å‡½æ•°é‡Œé¢åšé€»è¾‘ï¼Œå¤å†™ init å‡½æ•°å³å¯</p><p>2ï¼‰ã€ä¸»æ„é€ å‡½æ•°ä¸­å£°æ˜æˆ val æˆ–è€… var çš„å‚æ•°å°†è‡ªåŠ¨æˆä¸ºè¯¥ç±»çš„å­—æ®µï¼Œå¦‚æœä¸åŠ ï¼Œé‚£ä¹ˆè¯¥å­—æ®µçš„ä½œç”¨åŸŸä»…é™å®šåœ¨ä¸»æ„é€ å‡½æ•°ä¸­</p><p>3ï¼‰ã€æ¬¡æ„é€ å‡½æ•°æ˜¯é€šè¿‡ constructor å…³é”®å­—æ¥å®šä¹‰çš„</p><p>4ï¼‰ã€å½“ä¸€ä¸ªç±»æ²¡æœ‰æ˜¾ç¤ºçš„å®šä¹‰ä¸»æ„é€ å‡½æ•°ï¼Œä½†æ˜¯å®šä¹‰äº†æ¬¡æ„é€ å‡½æ•°æ—¶ï¼Œé‚£ä¹ˆè¢«ç»§æ‰¿çš„ç±»åé¢ä¸éœ€è¦åŠ  ()</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-comment">//å®šä¹‰ Student ç±»ï¼Œå®šä¹‰ä¸»æ„é€ å‡½æ•°ï¼Œå®šä¹‰å±æ€§ sno å’Œ grade, ç»§æ‰¿ Person ç±»</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Student</span>(<span class="hljs-keyword">var</span> sno: String, <span class="hljs-keyword">var</span> grade: <span class="hljs-built_in">Int</span>) : Person() &#123;<br>        <span class="hljs-comment">//åšä¸€äº›åˆå§‹åŒ–çš„é€»è¾‘</span><br>  <span class="hljs-keyword">init</span> &#123;<br>        name = <span class="hljs-string">&quot;erdai&quot;</span><br>        age = <span class="hljs-number">20</span><br>    &#125;<br>    <br>    <span class="hljs-comment">//å£°æ˜å¸¦ä¸€ä¸ªå‚æ•°çš„æ¬¡æ„é€ å‡½æ•°</span><br>    <span class="hljs-keyword">constructor</span>(sno: String): <span class="hljs-keyword">this</span>(sno,<span class="hljs-number">8</span>)&#123;<br><br>    &#125;<br><br>    <span class="hljs-comment">//å£°æ˜ä¸€ä¸ªæ— å‚çš„æ¬¡æ„é€ å‡½æ•°</span><br>    <span class="hljs-keyword">constructor</span>(): <span class="hljs-keyword">this</span>(<span class="hljs-string">&quot;123&quot;</span>,<span class="hljs-number">7</span>)&#123;<br><br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">printInfo</span><span class="hljs-params">()</span></span>&#123;<br>        println(<span class="hljs-string">&quot;I am <span class="hljs-variable">$name</span>, <span class="hljs-variable">$age</span> yeas old, sno: <span class="hljs-variable">$sno</span>, grade: <span class="hljs-variable">$grade</span>&quot;</span>)<br>    &#125;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>    <span class="hljs-keyword">val</span> student1 = Student()<br>    <span class="hljs-keyword">val</span> student2 = Student(<span class="hljs-string">&quot;456&quot;</span>)<br>    <span class="hljs-keyword">val</span> student3 = Student(<span class="hljs-string">&quot;789&quot;</span>,<span class="hljs-number">9</span>)<br>    student1.printInfo()<br>    student2.printInfo()<br>    student3.printInfo()<br>&#125;<br><span class="hljs-comment">//æ‰“å°ç»“æœ</span><br>I am erdai, <span class="hljs-number">20</span> yeas old, sno: <span class="hljs-number">123</span>, grade: <span class="hljs-number">7</span><br>I am erdai, <span class="hljs-number">20</span> yeas old, sno: <span class="hljs-number">456</span>, grade: <span class="hljs-number">8</span><br>I am erdai, <span class="hljs-number">20</span> yeas old, sno: <span class="hljs-number">789</span>, grade: <span class="hljs-number">9</span><br><br><span class="hljs-comment">//ä¸€ç§ç‰¹æ®Šæƒ…å†µï¼šå½“ä¸€ä¸ªç±»æ²¡æœ‰æ˜¾ç¤ºçš„å®šä¹‰ä¸»æ„é€ å‡½æ•°ï¼Œä½†æ˜¯å®šä¹‰äº†æ¬¡æ„é€ å‡½æ•°æ—¶ï¼Œé‚£ä¹ˆè¢«ç»§æ‰¿çš„ç±»åé¢ä¸éœ€è¦åŠ  ()</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Student</span> : <span class="hljs-type">Person</span>&#123;<br>    <span class="hljs-keyword">constructor</span>() : <span class="hljs-keyword">super</span>()&#123;<br>        <br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="3ã€æ¥å£"><a href="#3ã€æ¥å£" class="headerlink" title="3ã€æ¥å£"></a>3ã€æ¥å£</h3><p>1ï¼‰ã€Kotlin å’Œ Java ä¸­å®šä¹‰æ¥å£æ²¡æœ‰ä»»ä½•åŒºåˆ«</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-comment">//å®šä¹‰æ¥å£ä¸­çš„ä¸€ç³»åˆ—çš„æŠ½è±¡è¡Œä¸º Kotlin ä¸­å¢åŠ äº†æ¥å£ä¸­å®šä¹‰çš„å‡½æ•°å¯ä»¥æœ‰é»˜è®¤å®ç°ï¼Œå…¶å® Java åœ¨ JDK1.8 ä¹‹åä¹Ÿå¼€å§‹æ”¯æŒè¿™ä¸ªåŠŸèƒ½</span><br><span class="hljs-keyword">interface</span> <span class="hljs-title class_">Study</span>&#123;<br>     <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">readBooks</span><span class="hljs-params">()</span></span><br>     <span class="hljs-comment">//å¦‚æœå­ç±»æ²¡æœ‰é‡å†™è¿™ä¸ªæ–¹æ³•,é‚£ä¹ˆå°±ä¼šè°ƒç”¨è¿™ä¸ªæ–¹æ³•çš„é»˜è®¤å®ç°</span><br>     <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">doHomework</span><span class="hljs-params">()</span></span>&#123;<br>         println(<span class="hljs-string">&quot;do homework default implementation&quot;</span>)<br>     &#125;<br>&#125;<br><br><span class="hljs-comment">//å®šä¹‰ä¸€ä¸ªå¯è¢«ç»§æ‰¿çš„ People ç±»ï¼Œæœ‰ name å’Œ age ä¸¤ä¸ªå±æ€§</span><br><span class="hljs-keyword">open</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">People</span>(<span class="hljs-keyword">val</span> name: String,<span class="hljs-keyword">val</span> age: <span class="hljs-built_in">Int</span>)&#123;<br><br>&#125;<br><br><span class="hljs-comment">//å®šä¹‰ä¸€ä¸ª Student ç±»ï¼Œç»§æ‰¿ People ç±»ï¼Œå®ç° Study æ¥å£</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Student</span>(name: String, age: <span class="hljs-built_in">Int</span>) : People(name, age),Study&#123;<br>    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">readBooks</span><span class="hljs-params">()</span></span> &#123;<br>        println(<span class="hljs-string">&quot;<span class="hljs-variable">$name</span> is read book&quot;</span>)<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">//å®šä¹‰çš„ä¸€ä¸ªæ–¹æ³• ç„¶ååœ¨mainå‡½æ•°è°ƒç”¨</span><br><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">doStudy</span><span class="hljs-params">(study: <span class="hljs-type">Study</span>)</span></span>&#123;<br>    study.readBooks()<br>    study.doHomework()<br>&#125;<br><br><span class="hljs-comment">//mainå‡½æ•°è°ƒç”¨</span><br><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span>&#123;<br>    <span class="hljs-keyword">val</span> student = Student(<span class="hljs-string">&quot;erdai&quot;</span>,<span class="hljs-number">20</span>)<br>    <span class="hljs-comment">//è¿™é‡Œstudentå®ç°äº†Studyæ¥å£,è¿™ç§å«åšé¢å‘æ¥å£ç¼–ç¨‹,ä¹Ÿå¯ä»¥ç§°ä¸ºå¤šæ€</span><br>    doStydy(student)<br>&#125;<br><br><span class="hljs-comment">//æ‰“å°ç»“æœ</span><br>erdai <span class="hljs-keyword">is</span> read book<br><span class="hljs-keyword">do</span> homework default implementation<br><br></code></pre></td></tr></table></figure><h3 id="4ã€å‡½æ•°çš„å¯è§æ€§ä¿®é¥°ç¬¦"><a href="#4ã€å‡½æ•°çš„å¯è§æ€§ä¿®é¥°ç¬¦" class="headerlink" title="4ã€å‡½æ•°çš„å¯è§æ€§ä¿®é¥°ç¬¦"></a>4ã€å‡½æ•°çš„å¯è§æ€§ä¿®é¥°ç¬¦</h3><table><thead><tr><th>ä¿®é¥°ç¬¦</th><th>Java</th><th>Kotlin</th></tr></thead><tbody><tr><td>public</td><td>æ‰€æœ‰ç±»å¯è§</td><td>æ‰€æœ‰ç±»å¯è§(é»˜è®¤)</td></tr><tr><td>private</td><td>å½“å‰ç±»å¯è§</td><td>å½“å‰ç±»å¯è§</td></tr><tr><td>protected</td><td>å½“å‰ç±»,å­ç±»,åŒä¸€ä¸ªåŒ…ä¸‹çš„å¯è§</td><td>å½“å‰ç±»å’Œå­ç±»å¯è§</td></tr><tr><td>default</td><td>åŒä¸€ä¸ªåŒ…ä¸‹çš„å¯è§(é»˜è®¤)</td><td>æ— </td></tr><tr><td>internal</td><td>æ— </td><td>åŒä¸€ä¸ªæ¨¡å—ä¸­çš„ç±»å¯è§</td></tr></tbody></table><h3 id="5ã€æ•°æ®ç±»ä¸å•ä¾‹ç±»"><a href="#5ã€æ•°æ®ç±»ä¸å•ä¾‹ç±»" class="headerlink" title="5ã€æ•°æ®ç±»ä¸å•ä¾‹ç±»"></a>5ã€æ•°æ®ç±»ä¸å•ä¾‹ç±»</h3><h4 id="æ•°æ®ç±»"><a href="#æ•°æ®ç±»" class="headerlink" title="æ•°æ®ç±»"></a>æ•°æ®ç±»</h4><p>1ï¼‰ã€åœ¨ Java ä¸­ï¼Œæ•°æ®ç±»é€šå¸¸éœ€è¦é‡å†™ equals( )ï¼ŒhashCode( )ï¼ŒtoString( ) è¿™å‡ ä¸ªæ–¹æ³•ï¼Œå…¶ä¸­ equals( ) æ–¹æ³•ç”¨äºåˆ¤æ–­ä¸¤ä¸ªæ•°æ®ç±»æ˜¯å¦ç›¸ç­‰ã€‚hashCode( ) æ–¹æ³•ä½œä¸º equals( ) çš„é…å¥—æ–¹æ³•ï¼Œä¹Ÿéœ€è¦ä¸€èµ·é‡å†™ï¼Œå¦åˆ™ä¼šå¯¼è‡´ hash ç›¸å…³çš„ç³»ç»Ÿç±»æ— æ³•æ­£å¸¸å·¥ä½œï¼ŒtoString( ) æ–¹æ³•åˆ™ç”¨äºæä¾›æ›´æ¸…æ™°çš„è¾“å…¥æ—¥å¿—ï¼Œå¦åˆ™ä¸€ä¸ªæ•°æ®ç±»é»˜è®¤æ‰“å°å‡ºæ¥çš„æ˜¯ä¸€è¡Œå†…å­˜åœ°å€</p><p>2ï¼‰ã€åœ¨ Kotlin ä¸­ï¼Œæˆ‘ä»¬åªéœ€è¦ä½¿ç”¨ data å…³é”®å­—å»ä¿®é¥°ä¸€ä¸ªç±»ï¼ŒKotlin å°±ä¼šè‡ªåŠ¨å¸®æˆ‘ä»¬ç”Ÿæˆ Java éœ€è¦é‡å†™çš„é‚£äº›æ–¹æ³•</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-comment">//åœ¨ Java ä¸­ï¼Œæˆ‘ä»¬ä¼šè¿™ä¹ˆå†™</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Cellphone</span> &#123;<br>    <br>    String brand;<br>    double price;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> boolean equals(Object o) &#123;<br>        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span> == o) <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>        <span class="hljs-keyword">if</span> (o == <span class="hljs-literal">null</span> || getClass() != o.getClass()) <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>        Cellphone cellphone = (Cellphone) o;<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">Double</span>.compare(cellphone.price, price) == <span class="hljs-number">0</span> &amp;&amp;<br>                Objects.equals(brand, cellphone.brand);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> int hashCode() &#123;<br>        <span class="hljs-keyword">return</span> Objects.hash(brand, price);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> String toString() &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;Cellphone&#123;&quot;</span> +<br>                <span class="hljs-string">&quot;brand=&#x27;&quot;</span> + brand + <span class="hljs-string">&#x27;\&#x27;&#x27;</span> +<br>                <span class="hljs-string">&quot;, price=&quot;</span> + price +<br>                <span class="hljs-string">&#x27;&#125;&#x27;</span>;<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">//åœ¨ Kotlin ä¸­ï¼Œä½ ä¼šå‘ç°æ˜¯å¦‚æ­¤çš„ç®€æ´</span><br><span class="hljs-keyword">data</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Cellphone</span>(<span class="hljs-keyword">val</span> brand: String, <span class="hljs-keyword">val</span> price: <span class="hljs-built_in">Double</span>)<br></code></pre></td></tr></table></figure><h4 id="å•ä¾‹ç±»"><a href="#å•ä¾‹ç±»" class="headerlink" title="å•ä¾‹ç±»"></a>å•ä¾‹ç±»</h4><p>1ï¼‰ã€Kotlin ä¸­ï¼Œæˆ‘ä»¬åªéœ€è¦ä½¿ç”¨ object å…³é”®å­—å»æ›¿æ¢ class å…³é”®å­—å°±å¯ä»¥å»å®šä¹‰ä¸€ä¸ªå•ä¾‹ç±»äº†</p><p>2ï¼‰ã€è°ƒç”¨å•ä¾‹ç±»ä¸­çš„æ–¹æ³•ä¹Ÿæ¯”è¾ƒç®€å•ï¼Œç›´æ¥ä½¿ç”¨ç±»å . ä¸Šæ–¹æ³•å°±å¯ä»¥äº†ï¼Œç±»ä¼¼äº Java ä¸­çš„é™æ€æ–¹æ³•è°ƒç”¨æ–¹å¼</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-comment">//javaä¸­å•ä¾‹ æ‡’æ±‰å¼</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Singleton</span>&#123;<br>  <span class="hljs-keyword">private</span> static Singleton instance;<br>  <br>  <span class="hljs-keyword">public</span> synchronized static Singleton getInstace() &#123;<br>      <span class="hljs-keyword">if</span>(instance == <span class="hljs-literal">null</span>)&#123;<br>            instance = new Singleton();<br>          &#125;<br>      <span class="hljs-keyword">return</span> instance;<br>    &#125;<br>  <br>  <span class="hljs-keyword">public</span> void singleonTest()&#123;<br>      System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">&quot;singletonTest in Java is called.&quot;</span>);<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">//Kotlinä¸­çš„å•ä¾‹</span><br><span class="hljs-keyword">object</span> Singleton&#123;<br>  <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">singletonTest</span><span class="hljs-params">()</span></span>&#123;<br>      println(<span class="hljs-string">&quot;singletonTest in Kotlin is called.&quot;</span>)<br>    &#125;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>    Singleton.singletonTest()<br>&#125;<br><span class="hljs-comment">//æ‰“å°ç»“æœ</span><br>singletonTest <span class="hljs-keyword">in</span> Kotlin <span class="hljs-keyword">is</span> called.<br></code></pre></td></tr></table></figure><h2 id="Lambda-ç¼–ç¨‹"><a href="#Lambda-ç¼–ç¨‹" class="headerlink" title="Lambda ç¼–ç¨‹"></a>Lambda ç¼–ç¨‹</h2><p>Kotlin ä»ç¬¬ä¸€ä¸ªç‰ˆæœ¬å°±å¼€å§‹æ”¯æŒäº† Lambda ç¼–ç¨‹ï¼Œå¹¶ä¸” Kotlin ä¸­çš„ Lambda è¡¨è¾¾å¼æä¸ºå¼ºå¤§ï¼Œæœ¬ç« æˆ‘ä»¬å­¦ä¹  Lambda ç¼–ç¨‹çš„ä¸€äº›åŸºç¡€çŸ¥è¯†ï¼š</p><p>1ï¼‰ã€ç®€å•æ¥è¯´ï¼ŒLambda å°±æ˜¯ä¸€æ®µå¯ä»¥ä½œä¸ºå‚æ•°ä¼ é€’çš„ä»£ç ï¼Œå®ƒå¯ä»¥ä½œä¸ºå‡½æ•°çš„å‚æ•°ï¼Œè¿”å›å€¼ï¼ŒåŒæ—¶ä¹Ÿå¯ä»¥èµ‹å€¼ç»™ä¸€ä¸ªå˜é‡</p><p>2ï¼‰ã€Lambda å®Œæ•´çš„è¡¨è¾¾å¼çš„è¯­æ³•ç»“æ„ï¼š{ å‚æ•°å1ï¼šå‚æ•°ç±»å‹ï¼Œå‚æ•°å2ï¼šå‚æ•°ç±»å‹ -&gt; å‡½æ•°ä½“ }</p><p>3ï¼‰ã€å¾ˆå¤šæ—¶å€™ï¼Œæˆ‘ä»¬ä¼šä½¿ç”¨ç®€åŒ–å½¢å¼çš„è¯­æ³•ç»“æ„ï¼Œç›´æ¥å°±æ˜¯ä¸€ä¸ªå‡½æ•°ä½“ï¼š{å‡½æ•°ä½“}ï¼Œè¿™ç§æƒ…å†µæ˜¯å½“ Lambda è¡¨è¾¾å¼çš„å‚æ•°åˆ—è¡¨ä¸­åªæœ‰ä¸€ä¸ªå‚æ•°çš„æ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠå‚æ•°ç»™çœç•¥ï¼Œé»˜è®¤ä¼šæœ‰ä¸ª it å‚æ•°</p><p>4ï¼‰ã€Kotlin ä¸­è§„å®šï¼Œå½“ Lambda è¡¨è¾¾å¼ä½œä¸ºå‡½æ•°çš„æœ€åä¸€ä¸ªå‚æ•°çš„æ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠ Lambda è¡¨è¾¾å¼ç§»åˆ°å‡½æ•°æ‹¬å·çš„å¤–é¢</p><p>5ï¼‰ã€Kotlin ä¸­è§„å®šï¼Œå½“ Lambda è¡¨è¾¾å¼æ˜¯å‡½æ•°çš„å”¯ä¸€å‚æ•°çš„æ—¶å€™ï¼Œå‡½æ•°çš„æ‹¬å·å¯ä»¥çœç•¥</p><h3 id="1ã€é›†åˆçš„åˆ›å»ºå’Œéå†"><a href="#1ã€é›†åˆçš„åˆ›å»ºå’Œéå†" class="headerlink" title="1ã€é›†åˆçš„åˆ›å»ºå’Œéå†"></a>1ã€é›†åˆçš„åˆ›å»ºå’Œéå†</h3><p>1ï¼‰ã€ä¸å¯å˜é›†åˆï¼šåœ¨é›†åˆåˆå§‹åŒ–ä¹‹åï¼Œæˆ‘ä»¬ä¸èƒ½å¯¹å…¶è¿›è¡Œå¢åˆ æ”¹æ“ä½œ</p><p>2ï¼‰ã€å¯å˜é›†åˆï¼šåœ¨é›†åˆåˆå§‹åŒ–ä¹‹åï¼Œæˆ‘ä»¬è¿˜èƒ½å¯¹å…¶è¿›è¡Œå¢åˆ æ”¹æ“ä½œ</p><table><thead><tr><th>ä¸å¯å˜é›†åˆ</th><th>å¯å˜é›†åˆ</th></tr></thead><tbody><tr><td>listOf</td><td>mutableListOf</td></tr><tr><td>setOf</td><td>mutableSetOf</td></tr><tr><td>mapOf</td><td>mutableMapOf</td></tr></tbody></table><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-comment">//List é›†åˆ </span><br><span class="hljs-comment">//å®šä¹‰ä¸€ä¸ªä¸å¯å˜ List é›†åˆ</span><br><span class="hljs-keyword">val</span> list1 = listOf(<span class="hljs-string">&quot;Apple&quot;</span>,<span class="hljs-string">&quot;Banana&quot;</span>,<span class="hljs-string">&quot;Orange&quot;</span>,<span class="hljs-string">&quot;Pear&quot;</span>,<span class="hljs-string">&quot;Grape&quot;</span>)<br><span class="hljs-comment">//å®šä¹‰ä¸€ä¸ªå¯å˜ List é›†åˆ</span><br><span class="hljs-keyword">val</span> list2 = mutableListOf(<span class="hljs-string">&quot;Apple&quot;</span>,<span class="hljs-string">&quot;Banana&quot;</span>,<span class="hljs-string">&quot;Orange&quot;</span>,<span class="hljs-string">&quot;Pear&quot;</span>,<span class="hljs-string">&quot;Grape&quot;</span>)<br><span class="hljs-comment">//æ·»åŠ å…ƒç´ </span><br>list2.add(<span class="hljs-string">&quot;Watermelon&quot;</span>)<br><span class="hljs-keyword">for</span> (i <span class="hljs-keyword">in</span> list2) &#123;<br>    print(<span class="hljs-string">&quot;<span class="hljs-variable">$i</span> &quot;</span>)<br>&#125;<br><span class="hljs-comment">//æ‰“å°ç»“æœ</span><br>Apple Banana Orange Pear Grape Watermelon<br><br><span class="hljs-comment">//Set é›†åˆå’Œ List é›†åˆç”¨æ³•å®Œå…¨ä¸€æ ·</span><br><span class="hljs-comment">//å®šä¹‰ä¸€ä¸ªä¸å¯å˜ Set é›†åˆ</span><br><span class="hljs-keyword">val</span> set1 = setOf(<span class="hljs-string">&quot;Apple&quot;</span>,<span class="hljs-string">&quot;Banana&quot;</span>,<span class="hljs-string">&quot;Orange&quot;</span>,<span class="hljs-string">&quot;Pear&quot;</span>,<span class="hljs-string">&quot;Grape&quot;</span>)<br><span class="hljs-comment">//å®šä¹‰ä¸€ä¸ªå¯å˜ Set é›†åˆ</span><br><span class="hljs-keyword">val</span> set2 = mutableSetOf(<span class="hljs-string">&quot;Apple&quot;</span>,<span class="hljs-string">&quot;Banana&quot;</span>,<span class="hljs-string">&quot;Orange&quot;</span>,<span class="hljs-string">&quot;Pear&quot;</span>,<span class="hljs-string">&quot;Grape&quot;</span>)<br><span class="hljs-comment">//æ·»åŠ å…ƒç´ </span><br>set2.add(<span class="hljs-string">&quot;Watermelon&quot;</span>)<br><span class="hljs-keyword">for</span> (i <span class="hljs-keyword">in</span> set2) &#123;<br>    print(<span class="hljs-string">&quot;<span class="hljs-variable">$i</span> &quot;</span>)<br>&#125;<br><span class="hljs-comment">//æ‰“å°ç»“æœ</span><br>Apple Banana Orange Pear Grape Watermelon<br><br><span class="hljs-comment">//Map é›†åˆ</span><br><span class="hljs-comment">//å®šä¹‰ä¸€ä¸ªä¸å¯å˜ Map é›†åˆ</span><br><span class="hljs-keyword">val</span> map1 = mapOf(<span class="hljs-string">&quot;Apple&quot;</span> to <span class="hljs-number">1</span>,<span class="hljs-string">&quot;Banana&quot;</span> to <span class="hljs-number">2</span>,<span class="hljs-string">&quot;Orange&quot;</span> to <span class="hljs-number">3</span>, <span class="hljs-string">&quot;Pear&quot;</span> to <span class="hljs-number">4</span>,<span class="hljs-string">&quot;Grape&quot;</span> to <span class="hljs-number">5</span>)<br><span class="hljs-comment">//å®šä¹‰ä¸€ä¸ªå¯å˜ Map é›†åˆ</span><br><span class="hljs-keyword">val</span> map2 = mutableMapOf(<span class="hljs-string">&quot;Apple&quot;</span> to <span class="hljs-number">1</span>,<span class="hljs-string">&quot;Banana&quot;</span> to <span class="hljs-number">2</span>,<span class="hljs-string">&quot;Orange&quot;</span> to <span class="hljs-number">3</span>, <span class="hljs-string">&quot;Pear&quot;</span> to <span class="hljs-number">4</span>,<span class="hljs-string">&quot;Grape&quot;</span> to <span class="hljs-number">5</span>)<br><span class="hljs-comment">//å½“å‰ key å­˜åœ¨åˆ™ä¿®æ”¹å…ƒç´ ï¼Œä¸å­˜åœ¨åˆ™æ·»åŠ å…ƒç´ </span><br>map2[<span class="hljs-string">&quot;Watermelon&quot;</span>] = <span class="hljs-number">6</span><br><span class="hljs-keyword">for</span> ((key,value) <span class="hljs-keyword">in</span> map2) &#123;<br>    print(<span class="hljs-string">&quot;<span class="hljs-variable">$key</span>: <span class="hljs-variable">$value</span> &quot;</span>)<br>&#125;<br><span class="hljs-comment">//æ‰“å°ç»“æœ</span><br>Apple: <span class="hljs-number">1</span> Banana: <span class="hljs-number">2</span> Orange: <span class="hljs-number">3</span> Pear: <span class="hljs-number">4</span> Grape: <span class="hljs-number">5</span> Watermelon: <span class="hljs-number">6</span> <br></code></pre></td></tr></table></figure><h3 id="2ã€é›†åˆçš„å‡½æ•°å¼-API"><a href="#2ã€é›†åˆçš„å‡½æ•°å¼-API" class="headerlink" title="2ã€é›†åˆçš„å‡½æ•°å¼ API"></a>2ã€é›†åˆçš„å‡½æ•°å¼ API</h3><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-comment">//å®šä¹‰ä¸€ä¸ªä¸å¯å˜ List é›†åˆ</span><br><span class="hljs-keyword">val</span> list1 = listOf(<span class="hljs-string">&quot;Apple&quot;</span>,<span class="hljs-string">&quot;Banana&quot;</span>,<span class="hljs-string">&quot;Orange&quot;</span>,<span class="hljs-string">&quot;Pear&quot;</span>,<span class="hljs-string">&quot;Grape&quot;</span>,<span class="hljs-string">&quot;Watermelon&quot;</span>)<br><span class="hljs-comment">//ç°åœ¨æˆ‘æƒ³æ‰“å°é›†åˆä¸­è‹±æ–‡åå­—æœ€é•¿çš„å­—ç¬¦ä¸²ï¼Œæˆ‘ä»¬å¯ä»¥è¿™ä¹ˆåš</span><br><span class="hljs-comment">//æ–¹å¼1</span><br><span class="hljs-keyword">var</span> maxLengthFruit = <span class="hljs-string">&quot;&quot;</span><br><span class="hljs-keyword">for</span> (fruit <span class="hljs-keyword">in</span> list1) &#123;<br>    <span class="hljs-keyword">if</span>(fruit.length &gt; maxLengthFruit.length)&#123;<br>        maxLengthFruit = fruit<br>    &#125;<br>&#125;<br>print(maxLengthFruit)<br><span class="hljs-comment">//æ‰“å°ç»“æœ</span><br>Watermelon<br><br><span class="hljs-comment">//ä½†æ˜¯å¦‚æœä½¿ç”¨å‡½æ•°å¼ Api å°†ä¼šå˜å¾—æ›´åŠ ç®€å•, maxBy å‡½æ•°ä¼šæ ¹æ®ä½ çš„æ¡ä»¶éå†å¾—åˆ°ç¬¦åˆæ¡ä»¶çš„æœ€å¤§å€¼</span><br><span class="hljs-comment">//æ–¹å¼2</span><br><span class="hljs-keyword">val</span> maxLengthFruit = list1.maxBy &#123;<br>    it.length<br>&#125;<br>print(maxLengthFruit)<br><span class="hljs-comment">//æ‰“å°ç»“æœ</span><br>Watermelon<br><br><span class="hljs-comment">//é€šè¿‡ maxBy å‡½æ•°ç»“åˆ Lambda è¡¨è¾¾å¼è¯­æ³•ç»“æ„ï¼Œæˆ‘ä»¬æ¥å‰–ææ–¹å¼2è¿™ç§å†™æ³•çš„åŸç†, å¦‚ä¸‹æ‰€ç¤º</span><br><span class="hljs-comment">//1</span><br><span class="hljs-keyword">val</span> list1 = listOf(<span class="hljs-string">&quot;Apple&quot;</span>,<span class="hljs-string">&quot;Banana&quot;</span>,<span class="hljs-string">&quot;Orange&quot;</span>,<span class="hljs-string">&quot;Pear&quot;</span>,<span class="hljs-string">&quot;Grape&quot;</span>,<span class="hljs-string">&quot;Watermelon&quot;</span>)<br><span class="hljs-keyword">val</span> lambda = &#123;fruit: String -&gt; fruit.length&#125;<br><span class="hljs-comment">//maxBy å‡½æ•°å®é™…ä¸Šæ¥æ”¶çš„æ˜¯ä¸€ä¸ªå‡½æ•°ç±»å‹çš„å‚æ•°ï¼Œåç»­è®²é«˜é˜¶å‡½æ•°çš„æ—¶å€™ä¼šè®²åˆ°ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬è¿™é‡Œå¯ä»¥ä¼ å…¥ä¸€ä¸ª Lambda è¡¨è¾¾å¼</span><br><span class="hljs-keyword">val</span> maxLengthFruit = list1.maxBy(lambda)<br><br><span class="hljs-comment">//2 æ›¿æ¢ lambda</span><br><span class="hljs-keyword">val</span> maxLengthFruit = list1.maxBy(&#123;fruit: String -&gt; fruit.length&#125;)<br><br><span class="hljs-comment">//3 Kotlin ä¸­è§„å®šï¼Œå½“ Lambda è¡¨è¾¾å¼ä½œä¸ºå‡½æ•°çš„æœ€åä¸€ä¸ªå‚æ•°çš„æ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠ Lambda è¡¨è¾¾å¼ç§»åˆ°å‡½æ•°æ‹¬å·çš„å¤–é¢</span><br><span class="hljs-keyword">val</span> maxLengthFruit = list1.maxBy()&#123;fruit: String -&gt; fruit.length&#125;<br><br><span class="hljs-comment">//4 Kotlin ä¸­è§„å®šï¼Œå½“ Lambda è¡¨è¾¾å¼æ˜¯å‡½æ•°çš„å”¯ä¸€å‚æ•°çš„æ—¶å€™ï¼Œå‡½æ•°çš„æ‹¬å·å¯ä»¥çœç•¥</span><br><span class="hljs-keyword">val</span> maxLengthFruit = list1.maxBy&#123;fruit: String -&gt; fruit.length&#125;<br><br><span class="hljs-comment">//5 å½“ Lambda è¡¨è¾¾å¼çš„å‚æ•°åˆ—è¡¨ä¸­åªæœ‰ä¸€ä¸ªå‚æ•°çš„æ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠå‚æ•°ç»™çœç•¥ï¼Œé»˜è®¤ä¼šæœ‰ä¸ª it å‚æ•°</span><br><span class="hljs-keyword">val</span> maxLengthFruit = list1.maxBy&#123; it.length &#125;<br><br><span class="hljs-comment">//ç»è¿‡ä¸Šé¢ 1-&gt;2-&gt;3-&gt;4-&gt;5 è¿™å‡ ä¸ªæ­¥éª¤ï¼Œæˆ‘ä»¬æœ€ç»ˆå¾—åˆ°äº† 5 çš„è¿™ç§å†™æ³•</span><br></code></pre></td></tr></table></figure><p>é›†åˆä¸­è¿˜æœ‰å¾ˆå¤šè¿™æ ·çš„å‡½æ•°å¼ Apiï¼Œä¸‹é¢æˆ‘ä»¬é€šè¿‡ list é›†åˆæ¥å®è·µä¸€ä¸‹å…¶ä»–çš„ä¸€äº›å‡½æ•°å¼ Apiï¼š</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-keyword">val</span> list = listOf(<span class="hljs-string">&quot;Apple&quot;</span>,<span class="hljs-string">&quot;Banana&quot;</span>,<span class="hljs-string">&quot;Orange&quot;</span>,<span class="hljs-string">&quot;Pear&quot;</span>,<span class="hljs-string">&quot;Grape&quot;</span>,<span class="hljs-string">&quot;Watermelon&quot;</span>)<br><span class="hljs-comment">//1</span><br><span class="hljs-comment">//é€šè¿‡ map æ“ä½œï¼ŒæŠŠä¸€ä¸ªå…ƒç´ æ˜ å°„æˆä¸€ä¸ªæ–°çš„å…ƒç´ </span><br><span class="hljs-keyword">val</span> newList = list.map&#123;<br>  it.toUpperCase()<br>&#125;<br><span class="hljs-keyword">for</span> (s <span class="hljs-keyword">in</span> newList) &#123;<br>    print(<span class="hljs-string">&quot;<span class="hljs-variable">$s</span> &quot;</span>)<br>&#125;<br><span class="hljs-comment">//æ‰“å°ç»“æœ</span><br>APPLE BANANA ORANGE PEAR GRAPE WATERMELON <br><br><span class="hljs-comment">//2</span><br><span class="hljs-comment">//é€šè¿‡ filter ç­›é€‰æ“ä½œï¼Œç­›é€‰é•¿åº¦å°äºç­‰äº5çš„å­—ç¬¦ä¸²</span><br><span class="hljs-keyword">val</span> newList = list.filter &#123;<br>    it.length &lt;= <span class="hljs-number">5</span><br>&#125;<br><span class="hljs-keyword">for</span> (s <span class="hljs-keyword">in</span> newList) &#123;<br>    print(<span class="hljs-string">&quot;<span class="hljs-variable">$s</span> &quot;</span>)<br>&#125;<br><span class="hljs-comment">//æ‰“å°ç»“æœ</span><br>Apple Pear Grape<br></code></pre></td></tr></table></figure><h3 id="3ã€Java-å‡½æ•°å¼-API-çš„ä½¿ç”¨"><a href="#3ã€Java-å‡½æ•°å¼-API-çš„ä½¿ç”¨" class="headerlink" title="3ã€Java å‡½æ•°å¼ API çš„ä½¿ç”¨"></a>3ã€Java å‡½æ•°å¼ API çš„ä½¿ç”¨</h3><p>1ï¼‰ã€Kotlin ä¸­è°ƒç”¨ Java æ–¹æ³•ä¹Ÿå¯ä»¥ä½¿ç”¨å‡½æ•°å¼ Api ,ä½†å¿…é¡»æ»¡è¶³ä¸¤ä¸ªæ¡ä»¶ï¼š1ã€å¾—æ˜¯ç”¨ Java ç¼–å†™çš„æ¥å£ 2ã€æ¥å£ä¸­åªæœ‰ä¸€ä¸ªå¾…å®ç°çš„æ–¹æ³•</p><p>2)ã€Kotlin ä¸­å†™åŒ¿åå†…éƒ¨ç±»å’Œ Java æœ‰ä¸€ç‚¹åŒºåˆ«ï¼ŒKotlin ä¸­å› ä¸ºæŠ›å¼ƒäº† new å…³é”®å­—ï¼Œæ”¹ç”¨ object å…³é”®å­—å°±å¯ä»¥äº†</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-comment">//java ä¸­çš„åŒ¿åå†…éƒ¨ç±»</span><br>new Thread(new Runnable() &#123;<br>     <span class="hljs-meta">@Override</span><br>     <span class="hljs-keyword">public</span> void run() &#123;<br><br>     &#125;<br>&#125;).start();<br><br><span class="hljs-comment">//Kotlin ä¸­å¯ä»¥è¿™ä¹ˆå†™</span><br>Thread(<span class="hljs-keyword">object</span> : Runnable&#123;<br>    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">run</span><span class="hljs-params">()</span></span> &#123;<br>            <br>    &#125;<br>&#125;).start()<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * æˆ‘ä»¬æ¥ç€æ¥ç®€åŒ– Kotlin ä¸­çš„å†™æ³•</span><br><span class="hljs-comment"> * å› ä¸º Runnable ç±»ä¸­åªæœ‰ä¸€ä¸ªå¾…å®ç°æ–¹æ³•ï¼Œå³ä½¿è¿™é‡Œæ²¡æœ‰æ˜¾ç¤ºçš„é‡å†™ run() æ–¹æ³•ï¼Œ</span><br><span class="hljs-comment"> * Kotlin ä¹Ÿèƒ½æ˜ç™½åé¢çš„ Lambda è¡¨è¾¾å¼å°±æ˜¯è¦åœ¨ run() æ–¹æ³•ä¸­å®ç°çš„å†…å®¹</span><br><span class="hljs-comment"> */</span><br>Thread(Runnable&#123;<br>  <br>&#125;).start()<br><br><span class="hljs-comment">//å› ä¸ºæ˜¯å•æŠ½è±¡æ–¹æ³•æ¥å£ï¼Œæˆ‘ä»¬å¯ä»¥å°†æ¥å£åè¿›è¡Œçœç•¥</span><br>Thread(&#123;<br>  <br>&#125;).start()<br><br><span class="hljs-comment">//å½“ Lambda è¡¨è¾¾å¼ä½œä¸ºå‡½æ•°çš„æœ€åä¸€ä¸ªå‚æ•°çš„æ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠ Lambda è¡¨è¾¾å¼ç§»åˆ°å‡½æ•°æ‹¬å·çš„å¤–é¢</span><br>Thread()&#123;<br>  <br>&#125;.start()<br><br><span class="hljs-comment">//å½“ Lambda è¡¨è¾¾å¼æ˜¯å‡½æ•°çš„å”¯ä¸€å‚æ•°çš„æ—¶å€™ï¼Œå‡½æ•°çš„æ‹¬å·å¯ä»¥çœç•¥</span><br>Thread&#123;<br>  <br>&#125;.start()<br></code></pre></td></tr></table></figure><h2 id="å››ã€ç©ºæŒ‡é’ˆæ£€æŸ¥"><a href="#å››ã€ç©ºæŒ‡é’ˆæ£€æŸ¥" class="headerlink" title="å››ã€ç©ºæŒ‡é’ˆæ£€æŸ¥"></a>å››ã€ç©ºæŒ‡é’ˆæ£€æŸ¥</h2><p>Android ç³»ç»Ÿä¸Šå¥”æºƒæœ€é«˜çš„å¼‚å¸¸å°±æ˜¯ç©ºæŒ‡é’ˆå¼‚å¸¸ï¼ˆNullPointerExceptionï¼‰ï¼Œé€ æˆè¿™ç§ç°è±¡çš„ä¸»è¦åŸå› æ˜¯å› ä¸ºç©ºæŒ‡é’ˆæ˜¯ä¸€ç§ä¸å—ç¼–ç¨‹è¯­è¨€æ£€æŸ¥çš„è¿è¡Œæ—¶å¼‚å¸¸ï¼Œåªèƒ½ç”±ç¨‹åºå‘˜ä¸»åŠ¨é€šè¿‡é€»è¾‘åˆ¤æ–­æ¥é¿å…ï¼Œä½†å³ä½¿åœ¨å‡ºè‰²çš„ç¨‹åºå‘˜ï¼Œä¹Ÿä¸å¯èƒ½å°†æ‰€æœ‰æ½œåœ¨çš„ç©ºæŒ‡é’ˆå¼‚å¸¸éƒ½è€ƒè™‘åˆ°ã€‚ä½†æ˜¯è¿™ç§æƒ…å†µåœ¨ Kotlin ä¸Šå¾—åˆ°äº†å¾ˆå¥½çš„è§£å†³ï¼ŒKotlin æŠŠç©ºæŒ‡é’ˆå¼‚å¸¸æå‰åˆ°äº†ç¼–è¯‘æœŸå»æ£€æŸ¥ï¼Œè¿™æ ·çš„åšæ³•å‡ ä¹æœç»äº†ç©ºæŒ‡é’ˆå¼‚å¸¸ï¼Œä½†æ˜¯è¿™æ ·å­ä¼šå¯¼è‡´ä»£ç å˜å¾—æ¯”è¾ƒéš¾å†™ï¼Œä¸è¿‡ Kotlin æä¾›äº†ä¸€ç³»åˆ—çš„è¾…åŠ©å·¥å…·ï¼Œè®©æˆ‘ä»¬èƒ½è½»æ¾çš„å¤„ç†å„ç§åˆ¤ç©ºçš„æƒ…å†µï¼Œä¸‹é¢æˆ‘ä»¬å°±æ¥å­¦ä¹ å®ƒ</p><h3 id="1ã€å¯ç©ºç±»å‹ç³»ç»Ÿå’Œåˆ¤ç©ºè¾…åŠ©å·¥å…·"><a href="#1ã€å¯ç©ºç±»å‹ç³»ç»Ÿå’Œåˆ¤ç©ºè¾…åŠ©å·¥å…·" class="headerlink" title="1ã€å¯ç©ºç±»å‹ç³»ç»Ÿå’Œåˆ¤ç©ºè¾…åŠ©å·¥å…·"></a>1ã€å¯ç©ºç±»å‹ç³»ç»Ÿå’Œåˆ¤ç©ºè¾…åŠ©å·¥å…·</h3><p>1ï¼‰ã€åœ¨ç±»å‹åé¢åŠ ä¸Š ? ï¼Œè¡¨ç¤ºå¯ç©ºç±»å‹ï¼ŒKotlin é»˜è®¤æ‰€æœ‰çš„å‚æ•°å’Œå˜é‡ä¸å¯ä¸ºç©º</p><p>2ï¼‰ã€åœ¨å¯¹è±¡è°ƒç”¨çš„æ—¶å€™ï¼Œä½¿ç”¨ ?. æ“ä½œç¬¦ï¼Œå®ƒè¡¨ç¤ºå¦‚æœå½“å‰å¯¹è±¡ä¸ä¸ºç©ºåˆ™è°ƒç”¨ï¼Œä¸ºç©ºåˆ™ä»€ä¹ˆéƒ½ä¸åš</p><p>3ï¼‰ã€?: æ“ä½œç¬¦è¡¨ç¤ºå¦‚æœå·¦è¾¹çš„ç»“æœä¸ä¸ºç©ºï¼Œè¿”å›å·¦è¾¹çš„ç»“æœï¼Œå¦åˆ™è¿”å›å³è¾¹çš„ç»“æœ</p><p>4ï¼‰ã€åœ¨å¯¹è±¡åé¢åŠ  !! æ“ä½œç¬¦è¡¨ç¤ºå‘Šè¯‰Kotlinæˆ‘è¿™é‡Œä¸€å®šä¸ä¼šä¸ºç©º,ä½ ä¸ç”¨è¿›è¡Œæ£€æµ‹äº†ï¼Œå¦‚æœä¸ºç©ºï¼Œåˆ™æŠ›å‡ºç©ºæŒ‡é’ˆå¼‚å¸¸</p><p>5ï¼‰ã€let å‡½æ•°ï¼Œæä¾›å‡½æ•°å¼ Apiï¼Œå¹¶æŠŠå½“å‰è°ƒç”¨çš„å¯¹è±¡å½“ä½œå‚æ•°ä¼ é€’åˆ° Lambda è¡¨è¾¾å¼ä¸­</p><p><strong>æƒ…å†µ1ï¼š</strong> åœ¨ç±»å‹åé¢åŠ ä¸Š ? ï¼Œè¡¨ç¤ºå¯ç©ºç±»å‹ï¼ŒKotlin é»˜è®¤æ‰€æœ‰çš„å‚æ•°å’Œå˜é‡ä¸å¯ä¸ºç©º</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-keyword">interface</span> <span class="hljs-title class_">Study</span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">readBooks</span><span class="hljs-params">()</span></span><br>    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">domeHomework</span><span class="hljs-params">()</span></span>&#123;<br>        println(<span class="hljs-string">&quot;do homework default implementation&quot;</span>)<br>    &#125;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">doStudy</span><span class="hljs-params">(study: <span class="hljs-type">Study</span>)</span></span>&#123;<br>    study.readBooks()<br>    study.domeHomework()<br>&#125;<br></code></pre></td></tr></table></figure><p>ä¸Šé¢è¿™æ®µä»£ç æ˜¯ä¸ä¼šå‡ºç°ç©ºæŒ‡é’ˆå¼‚å¸¸çš„ï¼Œå¦‚æœä½ å°è¯•å‘ doStudy è¿™ä¸ªæ–¹æ³•ä¼ é€’ä¸€ä¸ª null ï¼Œç¼–è¯‘å™¨ä¼šæŠ¥é”™ï¼š</p><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/0d3e0d4640674c8cbfb70c4cb81b0ef0~tplv-k3u1fbpfcp-zoom-1.image" alt="image-20210317101826003"></p><p>å› æ­¤è¿™ç§æƒ…å†µæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨å¯ç©ºç±»å‹ï¼ŒæŠŠ Study æ”¹æˆ Studyï¼Ÿï¼Œå¦‚ä¸‹å›¾ï¼š</p><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/0aeed15a301b4de1b3c6b3f5c43eed42~tplv-k3u1fbpfcp-zoom-1.image" alt="image-20210317104058401"></p><p>ä½ ä¼šå‘ç°è™½ç„¶è°ƒç”¨ doStudy æ–¹æ³•ä¸æŠ¥é”™äº†ï¼Œä½†æ˜¯ doStudy å†…éƒ¨çš„è°ƒç”¨å´æŠ¥é”™äº†ï¼Œå› ä¸ºæ­¤æ—¶ doStudy æ¥å—ä¸€ä¸ªå¯ç©ºçš„ç±»å‹å‚æ•°ï¼Œå¯èƒ½ä¼šé€ æˆå†…éƒ¨çš„ç©ºæŒ‡é’ˆï¼Œ Kotlin ç¼–è¯‘å™¨ä¸å…è®¸è¿™ç§æƒ…å†µå­˜åœ¨ï¼Œé‚£ä¹ˆæˆ‘ä»¬è¿›è¡Œå¦‚ä¸‹æ”¹é€ å°±å¥½äº†ï¼š</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">doStudy</span><span class="hljs-params">(study: <span class="hljs-type">Study</span>?)</span></span>&#123;<br>    <span class="hljs-keyword">if</span>(study != <span class="hljs-literal">null</span>)&#123;<br>        study.readBooks()<br>        study.domeHomework()<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><strong>æƒ…å†µ2ï¼š</strong> åœ¨å¯¹è±¡è°ƒç”¨çš„æ—¶å€™ï¼Œä½¿ç”¨ ?. æ“ä½œç¬¦ï¼Œå®ƒè¡¨ç¤ºå¦‚æœå½“å‰å¯¹è±¡ä¸ä¸ºç©ºåˆ™è°ƒç”¨ï¼Œä¸ºç©ºåˆ™ä»€ä¹ˆéƒ½ä¸åš</p><p>é’ˆå¯¹ä¸Šé¢çš„ doStudy æ–¹æ³•ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥è¿™ä¹ˆåšï¼š</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">doStudy</span><span class="hljs-params">(study: <span class="hljs-type">Study</span>?)</span></span>&#123;<br>    study?.readBooks()<br>    study?.domeHomework()<br>&#125;<br></code></pre></td></tr></table></figure><p><strong>æƒ…å†µ3ï¼š</strong> ?: æ“ä½œç¬¦è¡¨ç¤ºå¦‚æœå·¦è¾¹çš„ç»“æœä¸ä¸ºç©ºï¼Œè¿”å›å·¦è¾¹çš„ç»“æœï¼Œå¦åˆ™è¿”å›å³è¾¹çš„ç»“æœ</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-comment">//å¹³æ—¶æˆ‘ä»¬å¯èƒ½å†™è¿™æ ·çš„ä»£ç </span><br><span class="hljs-keyword">val</span> a = <span class="hljs-keyword">if</span> (b != <span class="hljs-literal">null</span>) &#123;<br>    b<br>&#125; <span class="hljs-keyword">else</span> &#123;<br>    c<br>&#125;<br><br><span class="hljs-comment">//ä½¿ç”¨ ?: æ“ä½œç¬¦å¯ä»¥ç®€åŒ–æˆè¿™æ ·</span><br><span class="hljs-keyword">val</span> a = b ?: c<br></code></pre></td></tr></table></figure><p><strong>æƒ…å†µ4ï¼š</strong> åœ¨å¯¹è±¡åé¢åŠ  !! æ“ä½œç¬¦è¡¨ç¤ºå‘Šè¯‰Kotlinæˆ‘è¿™é‡Œä¸€å®šä¸ä¼šä¸ºç©º,ä½ ä¸ç”¨è¿›è¡Œæ£€æµ‹äº†ï¼Œå¦‚æœä¸ºç©ºï¼Œåˆ™æŠ›å‡ºç©ºæŒ‡é’ˆå¼‚å¸¸</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-comment">//ä¸‹é¢è¿™æ®µä»£ç ç¼–è¯‘é€šä¸è¿‡ï¼Œå› ä¸º printName æ–¹æ³•é‡Œçš„ name å¹¶ä¸çŸ¥é“ä½ åœ¨å¤–é¢åšäº†éç©ºåˆ¤æ–­</span><br><span class="hljs-keyword">val</span> name: String? = <span class="hljs-string">&quot;erdai&quot;</span><br><br><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">printName</span><span class="hljs-params">()</span></span>&#123;<br>    <span class="hljs-keyword">val</span> upperCaseName = name.toUpperCase()<br>    print(upperCaseName)<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>    <span class="hljs-keyword">if</span>(name != <span class="hljs-literal">null</span>)&#123;<br>       printName()<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">//å› æ­¤åœ¨ä¸Šé¢è¿™ç§æ˜ç¡®ä¸ä¼šä¸ºç©ºçš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ !! æ“ä½œç¬¦ï¼Œæ”¹é€ ä¸€ä¸‹ printName æ–¹æ³•</span><br><span class="hljs-comment">//åŒæ—¶è¦æé†’ä¸€ä¸‹è‡ªå·±ï¼Œæ˜¯å¦å­˜åœ¨æ›´å¥½çš„å®ç°æ–¹å¼ï¼Œå› ä¸ºä½¿ç”¨è¿™ç§æ“ä½œç¬¦ï¼Œè¿˜æ˜¯ä¼šå­˜åœ¨æ½œåœ¨çš„ç©ºæŒ‡é’ˆå¼‚å¸¸</span><br><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">printName</span><span class="hljs-params">()</span></span>&#123;<br>    <span class="hljs-keyword">val</span> upperCaseName = name!!.toUpperCase()<br>    print(upperCaseName)<br>&#125;<br><span class="hljs-comment">//æ‰“å°ç»“æœ</span><br>ERDAI<br></code></pre></td></tr></table></figure><p><strong>æƒ…å†µ5ï¼š</strong> let å‡½æ•°ï¼Œæä¾›å‡½æ•°å¼ Apiï¼Œå¹¶æŠŠå½“å‰è°ƒç”¨çš„å¯¹è±¡å½“ä½œå‚æ•°ä¼ é€’åˆ° Lambda è¡¨è¾¾å¼ä¸­</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-comment">//è¿™æ˜¯æˆ‘ä»¬æƒ…å†µ2 å®ç°çš„æ–¹å¼ï¼Œä½†æ˜¯å¦‚æœè¿™ç§è°ƒç”¨æ–¹å¼ä¸€å¤šï¼Œä¼šæ˜¾å¾—ç‰¹åˆ«å•°å—¦ï¼Œä¾‹å¦‚ï¼š</span><br><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">doStudy</span><span class="hljs-params">(study: <span class="hljs-type">Study</span>?)</span></span>&#123;<br>    study?.readBooks()<br>    study?.domeHomework()<br>    study?.a()<br>    study?.b()<br>&#125;<br><span class="hljs-comment">//ä¸Šé¢è¿™ç§æƒ…å†µç­‰åŒäºå¦‚ä¸‹ä»£ç :</span><br><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">doStudy</span><span class="hljs-params">(study: <span class="hljs-type">Study</span>?)</span></span>&#123;<br>    <span class="hljs-keyword">if</span>(study != <span class="hljs-literal">null</span>)&#123;<br>      study?.readBooks()<br>    &#125;<br>  <br>    <span class="hljs-keyword">if</span>(study != <span class="hljs-literal">null</span>)&#123;<br>     study?.domeHomework()<br>    &#125;<br>  <br>    <span class="hljs-keyword">if</span>(study != <span class="hljs-literal">null</span>)&#123;<br>     study?.a()<br>    &#125;<br>  <br>    <span class="hljs-keyword">if</span>(study != <span class="hljs-literal">null</span>)&#123;<br>      study?.b()<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">//è¿™ä¸ªæ—¶å€™æˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨ let å‡½æ•°æ¥æ“ä½œäº†</span><br><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">doStudy</span><span class="hljs-params">(study: <span class="hljs-type">Study</span>?)</span></span>&#123;<br>    study?.let&#123;<br>      it.readBooks()<br>      it.domeHomework()<br>      it.a()<br>      it.b()<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="äº”ã€Kotlinä¸­çš„å°é­”æœ¯"><a href="#äº”ã€Kotlinä¸­çš„å°é­”æœ¯" class="headerlink" title="äº”ã€Kotlinä¸­çš„å°é­”æœ¯"></a>äº”ã€Kotlinä¸­çš„å°é­”æœ¯</h2><h3 id="1ã€å­—ç¬¦ä¸²çš„å†…åµŒè¡¨è¾¾å¼"><a href="#1ã€å­—ç¬¦ä¸²çš„å†…åµŒè¡¨è¾¾å¼" class="headerlink" title="1ã€å­—ç¬¦ä¸²çš„å†…åµŒè¡¨è¾¾å¼"></a>1ã€å­—ç¬¦ä¸²çš„å†…åµŒè¡¨è¾¾å¼</h3><p>1ï¼‰ã€Kotlin ä¸­ï¼Œå­—ç¬¦ä¸²é‡Œé¢å¯ä»¥ä½¿ç”¨ ${} å¼•ç”¨å˜é‡å€¼å’Œè¡¨è¾¾å¼ï¼Œå½“ {} é‡Œé¢åªæœ‰ä¸€ä¸ªå˜é‡ï¼Œéè¡¨è¾¾å¼æ—¶ï¼Œ{}ä¹Ÿå¯ä»¥å»æ‰</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>    <span class="hljs-keyword">val</span> a = <span class="hljs-string">&quot;erdai&quot;</span><br>    <span class="hljs-keyword">val</span> b = <span class="hljs-string">&quot;666&quot;</span><br>    print(<span class="hljs-string">&quot;<span class="hljs-variable">$a</span> <span class="hljs-subst">$&#123;a + b&#125;</span>&quot;</span>)<br>&#125;<br><span class="hljs-comment">//æ‰“å°ç»“æœ</span><br>erdai erdai666<br></code></pre></td></tr></table></figure><h3 id="2ã€å‡½æ•°çš„å‚æ•°é»˜è®¤å€¼"><a href="#2ã€å‡½æ•°çš„å‚æ•°é»˜è®¤å€¼" class="headerlink" title="2ã€å‡½æ•°çš„å‚æ•°é»˜è®¤å€¼"></a>2ã€å‡½æ•°çš„å‚æ•°é»˜è®¤å€¼</h3><p>1ï¼‰ã€å®šä¹‰ä¸€ä¸ªå‡½æ•°æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ç»™å‡½æ•°çš„å‚æ•°æ·»åŠ ä¸€ä¸ªé»˜è®¤å€¼ï¼Œè¿™æ ·å­æˆ‘ä»¬å°±ä¸éœ€è¦å»ä¼ é‚£ä¸ªå‚æ•°</p><p>2ï¼‰ã€åœ¨æˆ‘ä»¬è°ƒç”¨ä¸€ä¸ªå‡½æ•°æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ key value çš„å½¢å¼æ¥ä¼ å‚</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-comment">//æƒ…å†µ1ï¼šå®šä¹‰ä¸€ä¸ªå‡½æ•°æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ç»™å‡½æ•°çš„å‚æ•°æ·»åŠ ä¸€ä¸ªé»˜è®¤å€¼ï¼Œè¿™æ ·å­æˆ‘ä»¬å°±ä¸éœ€è¦å»ä¼ é‚£ä¸ªå‚æ•°</span><br><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">printParams</span><span class="hljs-params">(name: <span class="hljs-type">String</span>,age: <span class="hljs-type">Int</span> = <span class="hljs-number">20</span>)</span></span>&#123;<br>    print(<span class="hljs-string">&quot;I am <span class="hljs-variable">$name</span>, <span class="hljs-variable">$age</span> years old.&quot;</span>)<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>    printParams(<span class="hljs-string">&quot;erdai&quot;</span>)<br>&#125;<br><span class="hljs-comment">//æ‰“å°ç»“æœ</span><br>I am erdai, <span class="hljs-number">20</span> years old.<br><br><span class="hljs-comment">//å½“ç„¶æˆ‘ä»¬ä¹Ÿå¯ä»¥é€‰æ‹©è¦†ç›–é»˜è®¤å‚æ•°</span><br><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>    printParams(<span class="hljs-string">&quot;erdai&quot;</span>,<span class="hljs-number">25</span>)<br>&#125;<br><span class="hljs-comment">//æ‰“å°ç»“æœ</span><br>I am erdai, <span class="hljs-number">25</span> years old.<br><br><span class="hljs-comment">//æƒ…å†µ2ï¼šåœ¨æˆ‘ä»¬è°ƒç”¨ä¸€ä¸ªå‡½æ•°æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ key value çš„å½¢å¼æ¥ä¼ å‚</span><br><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>    <span class="hljs-comment">//æ³¨æ„ printParams æ–¹æ³•çš„ä¸€ä¸ªå‚æ•°æ˜¯ name ,ç¬¬äºŒä¸ªæ‰æ˜¯ age, ä½†æ˜¯é€šè¿‡ key value çš„å½¢å¼æ¥ä¼ å‚å°±ä¸ä¼šå‡ºç°å‚æ•°é¡ºåºé—®é¢˜</span><br>    printParams(age = <span class="hljs-number">19</span>,name = <span class="hljs-string">&quot;erdai666&quot;</span>)<br>&#125;<br><span class="hljs-comment">//æ‰“å°ç»“æœ</span><br>I am erdai666, <span class="hljs-number">19</span> years old.<br></code></pre></td></tr></table></figure><p><strong>å°æŠ€å·§ï¼šæˆ‘ä»¬å¯ä»¥é€šè¿‡å‡½æ•°çš„å‚æ•°é»˜è®¤å€¼æ¥ä»£æ›¿æ¬¡æ„é€ å‡½æ•°ï¼Œä½¿ç”¨ä¸»æ„é€ å‡½æ•°å°±å¥½äº†</strong></p><h2 id="å…­ã€æ ‡å‡†å‡½æ•°å’Œé™æ€æ–¹æ³•"><a href="#å…­ã€æ ‡å‡†å‡½æ•°å’Œé™æ€æ–¹æ³•" class="headerlink" title="å…­ã€æ ‡å‡†å‡½æ•°å’Œé™æ€æ–¹æ³•"></a>å…­ã€æ ‡å‡†å‡½æ•°å’Œé™æ€æ–¹æ³•</h2><h3 id="1ã€æ ‡å‡†å‡½æ•°letï¼Œalsoï¼Œwithï¼Œrun-å’Œ-apply"><a href="#1ã€æ ‡å‡†å‡½æ•°letï¼Œalsoï¼Œwithï¼Œrun-å’Œ-apply" class="headerlink" title="1ã€æ ‡å‡†å‡½æ•°letï¼Œalsoï¼Œwithï¼Œrun å’Œ apply"></a>1ã€æ ‡å‡†å‡½æ•°letï¼Œalsoï¼Œwithï¼Œrun å’Œ apply</h3><p>1ï¼‰ã€let å‡½æ•°ï¼Œå¿…é¡»è®©æŸä¸ªå¯¹è±¡è°ƒç”¨ï¼Œæ¥æ”¶ä¸€ä¸ª Lambda è¡¨è¾¾å¼å‚æ•°ï¼ŒLambda è¡¨è¾¾å¼ä¸­çš„å‚æ•°ä¸ºå½“å‰è°ƒç”¨è€…ï¼Œä¸”æœ€åä¸€è¡Œä»£ç ä½œä¸ºè¿”å›å€¼</p><p>2ï¼‰ã€also å‡½æ•°ï¼Œå¿…é¡»è®©æŸä¸ªå¯¹è±¡è°ƒç”¨ï¼Œæ¥æ”¶ä¸€ä¸ª Lambda è¡¨è¾¾å¼å‚æ•°ï¼ŒLambda è¡¨è¾¾å¼ä¸­çš„å‚æ•°ä¸ºå½“å‰è°ƒç”¨è€…ï¼Œæ— æ³•æŒ‡å®šè¿”å›å€¼ï¼Œè¿™ä¸ªå‡½æ•°è¿”å›çš„æ˜¯å½“å‰è°ƒç”¨å¯¹è±¡æœ¬èº«</p><p>3ï¼‰ã€with å‡½æ•°ï¼Œæ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªä¸ºä»»æ„ç±»å‹å‚æ•°ï¼Œç¬¬äºŒä¸ªä¸º Lambda è¡¨è¾¾å¼å‚æ•°ï¼ŒLambda è¡¨è¾¾å¼ä¸­æ‹¥æœ‰ç¬¬ä¸€ä¸ªå‚æ•°çš„ä¸Šä¸‹æ–‡ this ï¼Œä¸”æœ€åä¸€è¡Œä»£ç ä½œä¸ºè¿”å›å€¼</p><p>4ï¼‰ã€run å‡½æ•°ï¼Œå¿…é¡»è®©æŸä¸ªå¯¹è±¡è°ƒç”¨ï¼Œæ¥æ”¶ä¸€ä¸ª Lambda è¡¨è¾¾å¼å‚æ•°ï¼ŒLambda è¡¨è¾¾å¼ä¸­æ‹¥æœ‰å½“å‰è°ƒç”¨å¯¹è±¡çš„ä¸Šä¸‹æ–‡ this ï¼Œä¸”æœ€åä¸€è¡Œä»£ç ä½œä¸ºè¿”å›å€¼</p><p>5ï¼‰ã€apply å‡½æ•°ï¼Œå¿…é¡»è®©æŸä¸ªå¯¹è±¡è°ƒç”¨ï¼Œæ¥æ”¶ä¸€ä¸ª Lambda è¡¨è¾¾å¼å‚æ•°ï¼ŒLambda è¡¨è¾¾å¼ä¸­æ‹¥æœ‰å½“å‰è°ƒç”¨å¯¹è±¡çš„ä¸Šä¸‹æ–‡ this ï¼Œæ— æ³•æŒ‡å®šè¿”å›å€¼ï¼Œè¿™ä¸ªå‡½æ•°è¿”å›çš„æ˜¯å½“å‰è°ƒç”¨å¯¹è±¡æœ¬èº«</p><p><strong>æ³¨æ„ï¼šåœ¨Lambda è¡¨è¾¾å¼ä¸­ï¼Œæ‹¥æœ‰å¯¹è±¡çš„ä¸Šä¸‹æ–‡ thisï¼Œå’Œæ‹¥æœ‰è¯¥å¯¹è±¡æ˜¯ä¸€æ ·çš„ï¼Œåªä¸è¿‡ this å¯çœç•¥ï¼Œè€Œæ‹¥æœ‰è¯¥å¯¹è±¡æˆ‘ä»¬å¯ä»¥è‡ªå®šä¹‰å‚æ•°åï¼Œå¦‚æœä¸å†™è¯¥å‚æ•°ï¼Œé»˜è®¤ä¼šæœ‰ä¸ª it å‚æ•°</strong></p><p>ä¸‹é¢é€šè¿‡ä»£ç æ¥æ„Ÿå—ä¸€ä¸‹ï¼š</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * æƒ…å†µ1ï¼šlet å‡½æ•°</span><br><span class="hljs-comment"> * 1ã€åˆ›å»ºä¸€ä¸ª StringBuilder å¯¹è±¡è°ƒç”¨ let å‡½æ•°ï¼ŒLambda è¡¨è¾¾å¼ä¸­çš„å‚æ•°ä¸º StringBuilder å¯¹è±¡</span><br><span class="hljs-comment"> * 2ã€å½“ Lambda è¡¨è¾¾å¼ä¸­åªæœ‰ä¸€ä¸ªå‚æ•°çš„æ—¶å€™å¯çœç•¥ï¼Œé»˜è®¤ä¼šæœ‰ä¸ª it çš„å‚æ•°ï¼Œè¿”å›å€¼å³ä¸º Lambda è¡¨è¾¾å¼ä¸­æœ€åä¸€è¡Œä»£ç </span><br><span class="hljs-comment"> */</span><br><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>    <span class="hljs-keyword">val</span> name = <span class="hljs-string">&quot;erdai&quot;</span><br>    <span class="hljs-keyword">val</span> age = <span class="hljs-number">20</span><br>    <span class="hljs-keyword">val</span> returnValue = StringBuilder().let &#123;<br>        it.append(name).append(<span class="hljs-string">&quot; &quot;</span>).append(age)<br>    &#125;<br>    println(returnValue)<br>&#125;<br><span class="hljs-comment">//æ‰“å°ç»“æœ</span><br>erdai <span class="hljs-number">20</span><br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * æƒ…å†µ2ï¼šalso å‡½æ•°</span><br><span class="hljs-comment"> * 1ã€åˆ›å»ºä¸€ä¸ª StringBuilder å¯¹è±¡è°ƒç”¨ also å‡½æ•°ï¼ŒLambda è¡¨è¾¾å¼ä¸­çš„å‚æ•°ä¸º StringBuilder å¯¹è±¡</span><br><span class="hljs-comment"> * 2ã€å½“ Lambda è¡¨è¾¾å¼ä¸­åªæœ‰ä¸€ä¸ªå‚æ•°çš„æ—¶å€™å¯çœç•¥ï¼Œé»˜è®¤ä¼šæœ‰ä¸ª it çš„å‚æ•°ï¼Œæ— æ³•æŒ‡å®šè¿”å›å€¼ï¼Œè¿”å›è°ƒç”¨å¯¹è±¡æœ¬èº«</span><br><span class="hljs-comment"> */</span><br><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>    <span class="hljs-keyword">val</span> name = <span class="hljs-string">&quot;erdai&quot;</span><br>    <span class="hljs-keyword">val</span> age = <span class="hljs-number">20</span><br>    <span class="hljs-keyword">val</span> stringBuilder = StringBuilder().also &#123;<br>        it.append(name).append(<span class="hljs-string">&quot; &quot;</span>).append(age)<br>    &#125;<br>    println(stringBuilder.toString())<br>&#125;<br><span class="hljs-comment">//æ‰“å°ç»“æœ</span><br>erdai <span class="hljs-number">20</span><br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * æƒ…å†µ3ï¼šwith å‡½æ•°</span><br><span class="hljs-comment"> * 1ã€æ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªå‚æ•°ä¸º StringBuilder å¯¹è±¡ï¼Œç¬¬äºŒä¸ªå‚æ•°ä¸º Lambda è¡¨è¾¾å¼ï¼Œ</span><br><span class="hljs-comment"> * 2ã€Lambda è¡¨è¾¾å¼ä¸­æ‹¥æœ‰ StringBuilder å¯¹è±¡çš„ä¸Šä¸‹æ–‡ this, è¿”å›å€¼å³ä¸º Lambda è¡¨è¾¾å¼ä¸­çš„æœ€åä¸€è¡Œä»£ç </span><br><span class="hljs-comment"> */</span><br><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>    <span class="hljs-keyword">val</span> name = <span class="hljs-string">&quot;erdai&quot;</span><br>    <span class="hljs-keyword">val</span> age = <span class="hljs-number">20</span><br>    <span class="hljs-keyword">val</span> returnValue = with(StringBuilder()) &#123;<br>        append(name).append(<span class="hljs-string">&quot; &quot;</span>).append(age)<br>    &#125;<br>    println(returnValue)<br>&#125;<br><span class="hljs-comment">//æ‰“å°ç»“æœ</span><br>erdai <span class="hljs-number">20</span><br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * æƒ…å†µ4ï¼šrun å‡½æ•°</span><br><span class="hljs-comment"> * 1ã€åˆ›å»ºä¸€ä¸ª StringBuilder å¯¹è±¡è°ƒç”¨ also å‡½æ•°ï¼ŒLambda è¡¨è¾¾å¼ä¸­æ‹¥æœ‰ StringBuilder å¯¹è±¡çš„ä¸Šä¸‹æ–‡ this</span><br><span class="hljs-comment"> * 2ã€è¿”å›å€¼å³ä¸º Lambda è¡¨è¾¾å¼ä¸­çš„æœ€åä¸€è¡Œä»£ç </span><br><span class="hljs-comment"> */</span><br><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>    <span class="hljs-keyword">val</span> name = <span class="hljs-string">&quot;erdai&quot;</span><br>    <span class="hljs-keyword">val</span> age = <span class="hljs-number">20</span><br><br>    <span class="hljs-keyword">val</span> returnValue = StringBuilder().run &#123;<br>        append(name).append(<span class="hljs-string">&quot; &quot;</span>).append(age)<br>    &#125;<br>    println(returnValue)<br>&#125;<br><span class="hljs-comment">//æ‰“å°ç»“æœ</span><br>erdai <span class="hljs-number">20</span><br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * æƒ…å†µ5ï¼šapply å‡½æ•°</span><br><span class="hljs-comment"> * 1ã€åˆ›å»ºä¸€ä¸ª StringBuilder å¯¹è±¡è°ƒç”¨ apply å‡½æ•°ï¼ŒLambda è¡¨è¾¾å¼ä¸­æ‹¥æœ‰ StringBuilder å¯¹è±¡çš„ä¸Šä¸‹æ–‡ this</span><br><span class="hljs-comment"> * 2ã€æ— æ³•æŒ‡å®šè¿”å›å€¼ï¼Œè¿”å›è°ƒç”¨å¯¹è±¡æœ¬èº«</span><br><span class="hljs-comment"> */</span><br><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>    <span class="hljs-keyword">val</span> name = <span class="hljs-string">&quot;erdai&quot;</span><br>    <span class="hljs-keyword">val</span> age = <span class="hljs-number">20</span><br><br>    <span class="hljs-keyword">val</span> stringBuilder = StringBuilder().apply &#123;<br>        append(name).append(<span class="hljs-string">&quot; &quot;</span>).append(age)<br>    &#125;<br>    println(stringBuilder.toString())<br>&#125;<br><span class="hljs-comment">//æ‰“å°ç»“æœ</span><br>erdai <span class="hljs-number">20</span><br></code></pre></td></tr></table></figure><p>å…¶å®ä¸Šé¢ 5 ä¸ªæ ‡å‡†å‡½æ•°æœ‰å¾ˆå¤šç›¸ä¼¼çš„åœ°æ–¹ï¼Œæˆ‘ä»¬éœ€ææ¸…æ¥šå®ƒä»¬å·®å¼‚ä¹‹å¤„ï¼Œä¸‹é¢æˆ‘ä»¬ç”¨ä¸€ä¸ªå›¾è¡¨æ¥æ€»ç»“ä¸€ä¸‹ï¼š</p><table><thead><tr><th align="left">æ ‡å‡†å‡½æ•°</th><th>å‡½æ•°å‚æ•°</th><th>æ˜¯å¦æ˜¯æ‰©å±•å‡½æ•°</th><th>è¿”å›å€¼</th></tr></thead><tbody><tr><td align="left">T.let</td><td>it</td><td>æ˜¯</td><td>æœ€åä¸€è¡Œä»£ç </td></tr><tr><td align="left">T.also</td><td>it</td><td>æ˜¯</td><td>å¯¹è±¡æœ¬èº«</td></tr><tr><td align="left">with</td><td>this</td><td>å¦</td><td>æœ€åä¸€è¡Œä»£ç </td></tr><tr><td align="left">T.run</td><td>this</td><td>æ˜¯</td><td>æœ€åä¸€è¡Œä»£ç </td></tr><tr><td align="left">T.apply</td><td>this</td><td>æ˜¯</td><td>å¯¹è±¡æœ¬èº«</td></tr></tbody></table><h3 id="2ã€å®šä¹‰é™æ€æ–¹æ³•"><a href="#2ã€å®šä¹‰é™æ€æ–¹æ³•" class="headerlink" title="2ã€å®šä¹‰é™æ€æ–¹æ³•"></a>2ã€å®šä¹‰é™æ€æ–¹æ³•</h3><p>Kotlin ä¸­æ²¡æœ‰ç›´æ¥æä¾›å®šä¹‰ä¸ºé™æ€æ–¹æ³•çš„å…³é”®å­—ï¼Œä½†æ˜¯æä¾›äº†ä¸€äº›ç±»ä¼¼çš„è¯­æ³•ç‰¹æ€§æ¥æ”¯æŒé™æ€æ–¹æ³•è°ƒç”¨çš„å†™æ³•</p><p>1ï¼‰ã€ä½¿ç”¨ companion object ä¸ºä¸€ä¸ªç±»åˆ›å»ºä¸€ä¸ªä¼´ç”Ÿç±»ï¼Œç„¶åè°ƒç”¨è¿™ä¸ªä¼´ç”Ÿç±»çš„æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•ä¸å«é™æ€æ–¹æ³•ï¼Œä½†æ˜¯å¯ä»¥å½“ä½œé™æ€æ–¹æ³•è°ƒç”¨</p><p>2ï¼‰ã€ä½¿ç”¨ object å…³é”®å­—å®šä¹‰ä¸€ä¸ªå•ä¾‹ç±»ï¼Œé€šè¿‡å•ä¾‹ç±»ï¼Œå»è°ƒç”¨æ–¹æ³•ï¼Œè¿™ç§æ–¹æ³•ä¹Ÿä¸å«é™æ€æ–¹æ³•ï¼Œä½†æ˜¯å¯ä»¥å½“ä½œé™æ€æ–¹æ³•è°ƒç”¨</p><p>3ï¼‰ã€å¦‚æœæƒ³å®šä¹‰çœŸæ­£çš„é™æ€æ–¹æ³•ï¼ŒKotlin ä¸­ä¹Ÿæä¾›äº†ä¸¤ç§æ–¹å¼ï¼š1ã€ä½¿ç”¨ @JvmStatic æ³¨è§£ï¼Œä¸”æ³¨è§£åªèƒ½åŠ åœ¨ä¼´ç”Ÿç±»å’Œå•ä¾‹ç±»ä¸Šçš„æ–¹æ³•ä¸Šé¢  2ã€å®šä¹‰é¡¶å±‚æ–¹æ³•</p><p>4ï¼‰ã€é¡¶å±‚æ–¹æ³•å°±æ˜¯ä¸å®šä¹‰åœ¨ä»»ä½•ç±»ä¸­çš„æ–¹æ³•ï¼Œé¡¶å±‚æ–¹æ³•åœ¨ä»»ä½•ä½ç½®éƒ½èƒ½è¢«è°ƒç”¨åˆ°ï¼ŒKotlin ç¼–è¯‘å™¨ä¼šæŠŠæ‰€æœ‰çš„é¡¶å±‚æ–¹æ³•ç¼–è¯‘æˆé™æ€æ–¹æ³•</p><p>5ï¼‰ã€å¦‚æœåœ¨ Java ä¸­è°ƒç”¨é¡¶å±‚æ–¹æ³•ï¼ŒJava é»˜è®¤æ˜¯æ²¡æœ‰é¡¶å±‚æ–¹æ³•çš„æ¦‚å¿µçš„ï¼ŒKotlin ç¼–è¯‘å™¨ä¼šç”Ÿæˆä¸€ä¸ªæˆ‘ä»¬å®šä¹‰è¿™ä¸ªæ–‡ä»¶çš„ Java ç±»ï¼Œä¾‹å¦‚æˆ‘åœ¨ Kotlin ä¸­çš„ Util.kt æ–‡ä»¶ä¸­å®šä¹‰äº†ä¸€ä¸ªé¡¶å±‚æ–¹æ³•ï¼Œé‚£ä¹ˆå°±ä¼šç”Ÿæˆä¸€ä¸ª UtilKt çš„ Java ç±»ä¾›åœ¨ Java ä¸­è°ƒç”¨</p><p>6ï¼‰ã€åœ¨ Kotlin ä¸­æ¯”è¾ƒå¸¸ç”¨çš„æ˜¯ å•ä¾‹ï¼Œä¼´ç”Ÿç±»å’Œé¡¶å±‚æ–¹æ³•ï¼Œ@JvmStatic æ³¨è§£ç”¨çš„æ¯”è¾ƒå°‘</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-comment">//åœ¨ Java ä¸­æˆ‘ä»¬å¯ä»¥è¿™æ ·å®šä¹‰ä¸€ä¸ªé™æ€æ–¹æ³•</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Util</span> &#123;<br>  <br>    <span class="hljs-keyword">public</span> static void doAction()&#123;<br>        System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">&quot;do something&quot;</span>);<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">//Kotlin ä¸­ç±»ä¼¼è¿™æ ·é™æ€è°ƒç”¨å¤šç§å¤šæ ·</span><br><span class="hljs-comment">//æƒ…å†µ1ï¼šä½¿ç”¨ companion object ä¸ºä¸€ä¸ªç±»åˆ›å»ºä¸€ä¸ªä¼´ç”Ÿç±»</span><br><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>   Util.doAction()<br>&#125;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Util</span>&#123;<br>    <span class="hljs-keyword">companion</span> <span class="hljs-keyword">object</span>&#123;<br>        <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">doAction</span><span class="hljs-params">()</span></span>&#123;<br>            println(<span class="hljs-string">&quot;do something&quot;</span>)<br>        &#125;<br>    &#125;<br>&#125;<br><span class="hljs-comment">//æ‰“å°ç»“æœ</span><br><span class="hljs-keyword">do</span> something<br><br><span class="hljs-comment">//æƒ…å†µ2ï¼šä½¿ç”¨ object å…³é”®å­—å®šä¹‰ä¸€ä¸ªå•ä¾‹ç±»</span><br><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>   Util.doAction()<br>&#125;<br><br><span class="hljs-keyword">object</span> Util &#123;<br><br>    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">doAction</span><span class="hljs-params">()</span></span> &#123;<br>        println(<span class="hljs-string">&quot;do something&quot;</span>)<br>    &#125;<br>&#125;<br><span class="hljs-comment">//æ‰“å°ç»“æœ</span><br><span class="hljs-keyword">do</span> something<br><br><span class="hljs-comment">//æƒ…å†µ3ï¼š1ã€ä½¿ç”¨ @JvmStatic æ³¨è§£ 2ã€å®šä¹‰é¡¶å±‚æ–¹æ³•</span><br><span class="hljs-comment">//1</span><br><span class="hljs-comment">//å•ä¾‹ç±»</span><br><span class="hljs-keyword">object</span> Util &#123;<br>  <br>    <span class="hljs-meta">@JvmStatic</span><br>    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">doAction</span><span class="hljs-params">()</span></span> &#123;<br>        println(<span class="hljs-string">&quot;do something&quot;</span>)<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">//ä¼´ç”Ÿç±»</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Util</span> &#123;<br>  <br>    <span class="hljs-keyword">companion</span> <span class="hljs-keyword">object</span>&#123;<br>        <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">doAction</span><span class="hljs-params">()</span></span> &#123;<br>            println(<span class="hljs-string">&quot;do something&quot;</span>)<br>        &#125;<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">//2 ä½¿ç”¨ AndroidStudio æ–°å»ºä¸€ä¸ªæ–‡ä»¶ï¼Œåœ¨å¼¹æ¡†ä¸­é€‰æ‹© File å³å¯ï¼Œæˆ‘ä»¬åœ¨è¿™ä¸ª File ä¸­ç¼–å†™ä¸€ä¸ªé¡¶å±‚æ–¹æ³•</span><br><span class="hljs-comment">//é¡¶å±‚æ–¹æ³•åœ¨ä»»ä½•ä½ç½®éƒ½èƒ½è°ƒç”¨åˆ°</span><br><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">doAction</span><span class="hljs-params">()</span></span>&#123;<br>    println(<span class="hljs-string">&quot;do something&quot;</span>)<br>&#125;<br></code></pre></td></tr></table></figure><p>ä¸Šè¿°ä»£ç å¤§å®¶å¯ä»¥å°† Kotlin æ–‡ä»¶è½¬æ¢æˆ Java æ–‡ä»¶çœ‹ä¸€ä¸‹ï¼Œä½ å°±ä¼šå‘ç°å®šä¹‰çœŸæ­£çš„é™æ€æ–¹æ³•å’Œéé™æ€æ–¹æ³•çš„åŒºåˆ«</p><h2 id="ä¸ƒã€å»¶è¿Ÿåˆå§‹åŒ–å’Œå¯†å°ç±»"><a href="#ä¸ƒã€å»¶è¿Ÿåˆå§‹åŒ–å’Œå¯†å°ç±»" class="headerlink" title="ä¸ƒã€å»¶è¿Ÿåˆå§‹åŒ–å’Œå¯†å°ç±»"></a>ä¸ƒã€å»¶è¿Ÿåˆå§‹åŒ–å’Œå¯†å°ç±»</h2><h3 id="1ã€å¯¹å˜é‡å»¶è¿Ÿåˆå§‹åŒ–"><a href="#1ã€å¯¹å˜é‡å»¶è¿Ÿåˆå§‹åŒ–" class="headerlink" title="1ã€å¯¹å˜é‡å»¶è¿Ÿåˆå§‹åŒ–"></a>1ã€å¯¹å˜é‡å»¶è¿Ÿåˆå§‹åŒ–</h3><p>1ï¼‰ã€ä½¿ç”¨ lateinit å…³é”®å­—å¯¹ä¸€ä¸ªå˜é‡å»¶è¿Ÿåˆå§‹åŒ–</p><p>ä½¿ç”¨  lateinit å…³é”®å­—æ³¨æ„äº‹é¡¹ï¼š</p><p>1ã€åªèƒ½ä½œç”¨äº var å±æ€§ï¼Œä¸”è¯¥å±æ€§æ²¡æœ‰è‡ªå®šä¹‰ get å’Œ set æ–¹æ³•</p><p>2ã€è¯¥å±æ€§å¿…é¡»æ˜¯éç©ºç±»å‹ï¼Œä¸”ä¸èƒ½æ˜¯åŸç”Ÿç±»å‹</p><p>2ï¼‰ã€å½“ä½ å¯¹ä¸€ä¸ªå˜é‡ä½¿ç”¨äº† lateinit å…³é”®å­—ï¼ŒKotlin ç¼–è¯‘å™¨å°±ä¸ä¼šåœ¨å»æ£€æŸ¥è¿™ä¸ªå˜é‡æ˜¯å¦ä¼šä¸ºç©ºäº†ï¼Œæ­¤æ—¶ä½ è¦ç¡®ä¿å®ƒåœ¨è¢«è°ƒç”¨ä¹‹å‰å·²ç»åˆå§‹åŒ–äº†ï¼Œå¦åˆ™ç¨‹åºè¿è¡Œçš„æ—¶å€™ä¼šæŠ¥é”™ï¼Œå¯ä»¥ä½¿ç”¨ ::object.isInitialized è¿™ç§å›ºå®šçš„è¯­æ³•ç»“æ„åˆ¤æ–­å˜é‡æ˜¯å¦å·²ç»åˆå§‹åŒ–</p><p>3ï¼‰ã€ä½¿ç”¨ by lazy å¯¹ä¸€ä¸ªå˜é‡å»¶è¿Ÿåˆå§‹åŒ–</p><p>ä½¿ç”¨ by lazy æ³¨æ„äº‹é¡¹ï¼š</p><p>1ã€åªèƒ½ä½œç”¨äº val å±æ€§</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-comment">//æƒ…å†µ1ï¼šä½¿ç”¨ lateinit å…³é”®å­—å¯¹ä¸€ä¸ªå˜é‡å»¶è¿Ÿåˆå§‹åŒ–</span><br><span class="hljs-keyword">lateinit</span> <span class="hljs-keyword">var</span> name: String<br><br><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>   name = <span class="hljs-string">&quot;erdai&quot;</span><br>   println(name)<br>&#125;<br><span class="hljs-comment">//æ‰“å°ç»“æœ</span><br>erdai<br><br><span class="hljs-comment">//æƒ…å†µ2: ä½¿ç”¨ ::object.isInitialized è¿™ç§å›ºå®šçš„è¯­æ³•ç»“æ„åˆ¤æ–­å˜é‡æ˜¯å¦å·²ç»åˆå§‹åŒ–</span><br><span class="hljs-keyword">lateinit</span> <span class="hljs-keyword">var</span> name: String<br><br><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>    <span class="hljs-keyword">if</span>(::name.isInitialized)&#123;<br>        println(name)<br>    &#125;<span class="hljs-keyword">else</span>&#123;<br>        println(<span class="hljs-string">&quot;name not been initialized&quot;</span>)<br>    &#125;<br>&#125;<br><span class="hljs-comment">//æ‰“å°ç»“æœ</span><br>name not been initialized<br><br><span class="hljs-comment">//æƒ…å†µ3: ä½¿ç”¨ by lazy å¯¹ä¸€ä¸ªå˜é‡å»¶è¿Ÿåˆå§‹åŒ–</span><br><span class="hljs-comment">//ç‰¹ç‚¹ï¼šè¯¥å±æ€§è°ƒç”¨çš„æ—¶å€™æ‰ä¼šåˆå§‹åŒ–ï¼Œä¸” lazy åé¢çš„ Lambda è¡¨è¾¾å¼åªä¼šæ‰§è¡Œä¸€æ¬¡</span><br><span class="hljs-keyword">val</span> name: String <span class="hljs-keyword">by</span> lazy &#123;<br>    <span class="hljs-string">&quot;erdai&quot;</span><br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>    println(name)<br>&#125;<br><span class="hljs-comment">//æ‰“å°ç»“æœ</span><br>erdai<br></code></pre></td></tr></table></figure><h3 id="2ã€ä½¿ç”¨å¯†å°ç±»ä¼˜åŒ–ä»£ç "><a href="#2ã€ä½¿ç”¨å¯†å°ç±»ä¼˜åŒ–ä»£ç " class="headerlink" title="2ã€ä½¿ç”¨å¯†å°ç±»ä¼˜åŒ–ä»£ç "></a>2ã€ä½¿ç”¨å¯†å°ç±»ä¼˜åŒ–ä»£ç </h3><p>å¯†å°ç±»èƒ½ä½¿æˆ‘ä»¬å†™å‡ºæ›´åŠ è§„èŒƒå’Œå®‰å…¨çš„ä»£ç </p><p>1ï¼‰ã€ä½¿ç”¨ sealed class å®šä¹‰ä¸€ä¸ªå¯†å°ç±»</p><p>2ï¼‰ã€å¯†å°ç±»åŠå…¶å­ç±»ï¼Œåªèƒ½å®šä¹‰åœ¨åŒä¸€ä¸ªæ–‡ä»¶çš„é¡¶å±‚ä½ç½®</p><p>3ï¼‰ã€å¯†å°ç±»å¯è¢«ç»§æ‰¿</p><p>4ï¼‰ã€å½“æˆ‘ä»¬ä½¿ç”¨æ¡ä»¶è¯­å¥çš„æ—¶å€™ï¼Œéœ€è¦å®ç°å¯†å°ç±»æ‰€æœ‰å­ç±»çš„æƒ…å†µï¼Œé¿å…å†™å‡ºæ°¸è¿œä¸ä¼šæ‰§è¡Œçš„ä»£ç </p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-comment">//åœ¨ä½¿ç”¨å¯†å°ç±»ä¹‹å‰æˆ‘ä»¬å¯èƒ½ä¼šå†™å‡ºè¿™ç§ä»£ç </span><br><span class="hljs-keyword">interface</span> <span class="hljs-title class_">Result</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Success</span> : <span class="hljs-type">Result</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Failure</span> : <span class="hljs-type">Result</span><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * é‚£ä¹ˆæ­¤æ—¶å¦‚æœæˆ‘æ–°å¢ä¸€ä¸ªç±»å®ç° Result æ¥å£ï¼Œç¼–è¯‘å™¨å¹¶ä¸ä¼šæç¤ºæˆ‘ä»¬å»æ–°å¢æ–°çš„æ¡ä»¶åˆ†æ”¯</span><br><span class="hljs-comment"> * å¦‚æœæˆ‘ä»¬æ²¡æœ‰æ–°å¢ç›¸åº”çš„æ¡ä»¶åˆ†æ”¯ï¼Œé‚£ä¹ˆå°±ä¼šå‡ºç°æ‰§è¡Œ else çš„æƒ…å†µ</span><br><span class="hljs-comment"> * å…¶å®è¿™ä¸ª else å°±æ˜¯ä¸€ä¸ªæ— ç”¨åˆ†æ”¯ï¼Œè¿™ä»…ä»…æ˜¯ä¸ºäº†æ»¡è¶³ç¼–è¯‘å™¨çš„è¦æ±‚</span><br><span class="hljs-comment"> */</span><br><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">getResultMsg</span><span class="hljs-params">(result: <span class="hljs-type">Result</span>)</span></span> = <span class="hljs-keyword">when</span> (result)&#123;<br>    <span class="hljs-keyword">is</span> Success -&gt; <span class="hljs-string">&quot;Success&quot;</span><br>    <span class="hljs-keyword">is</span> Failure -&gt; <span class="hljs-string">&quot;Failure&quot;</span><br>    <span class="hljs-keyword">else</span> -&gt; <span class="hljs-keyword">throw</span> RuntimeException()<br>&#125;<br><br><span class="hljs-comment">//åœ¨ä½¿ç”¨å¯†å°ç±»ä¹‹å</span><br><span class="hljs-keyword">sealed</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Result</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Success</span> : <span class="hljs-type">Result</span>()<br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Failure</span> : <span class="hljs-type">Result</span>()<br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * æ­¤æ—¶æˆ‘ä»¬å°±é¿å…äº†å†™ else åˆ†æ”¯ï¼Œè¿™ä¸ªæ—¶å€™å¦‚æœæˆ‘æ–°å¢ä¸€ä¸ªç±»å®ç° Result å¯†å°ç±»</span><br><span class="hljs-comment"> * ç¼–è¯‘å™¨å°±ä¼šæç¤ºå¼‚å¸¸ï¼Œéœ€è¦ when å»æ–°å¢ç›¸åº”çš„æ¡ä»¶åˆ†æ”¯</span><br><span class="hljs-comment"> */</span><br><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">getResultMsg</span><span class="hljs-params">(result: <span class="hljs-type">Result</span>)</span></span> = <span class="hljs-keyword">when</span> (result)&#123;<br>    <span class="hljs-keyword">is</span> Success -&gt; <span class="hljs-string">&quot;Success&quot;</span><br>    <span class="hljs-keyword">is</span> Failure -&gt; <span class="hljs-string">&quot;Failure&quot;</span><br>&#125;<br></code></pre></td></tr></table></figure><h2 id="å…«ã€æ‰©å±•å‡½æ•°å’Œè¿ç®—ç¬¦"><a href="#å…«ã€æ‰©å±•å‡½æ•°å’Œè¿ç®—ç¬¦" class="headerlink" title="å…«ã€æ‰©å±•å‡½æ•°å’Œè¿ç®—ç¬¦"></a>å…«ã€æ‰©å±•å‡½æ•°å’Œè¿ç®—ç¬¦</h2><h3 id="1ã€å¤§æœ‰ç”¨é€”çš„æ‰©å±•å‡½æ•°"><a href="#1ã€å¤§æœ‰ç”¨é€”çš„æ‰©å±•å‡½æ•°" class="headerlink" title="1ã€å¤§æœ‰ç”¨é€”çš„æ‰©å±•å‡½æ•°"></a>1ã€å¤§æœ‰ç”¨é€”çš„æ‰©å±•å‡½æ•°</h3><p>æ‰©å±•å‡½æ•°å…è®¸æˆ‘ä»¬å»æ‰©å±•ä¸€ä¸ªç±»çš„å‡½æ•°ï¼Œè¿™ç§ç‰¹æ€§æ˜¯ Java ä¸­æ‰€æ²¡æœ‰çš„</p><p>1ï¼‰ã€æ‰©å±•å‡½æ•°çš„è¯­æ³•ç»“æ„å¦‚ä¸‹ï¼š</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-function"><span class="hljs-keyword">fun</span> ClassName.<span class="hljs-title">methodName</span><span class="hljs-params">(params1: <span class="hljs-type">Int</span>, params2: <span class="hljs-type">Int</span>)</span></span> : <span class="hljs-built_in">Int</span>&#123;<br>  <br>&#125;<br></code></pre></td></tr></table></figure><p>ç›¸æ¯”äºæ™®é€šçš„å‡½æ•°ï¼Œæ‰©å±•å‡½æ•°åªéœ€è¦åœ¨å‡½æ•°å‰é¢åŠ ä¸Šä¸€ä¸ª ClassName. çš„è¯­æ³•ç»“æ„ï¼Œå°±è¡¨ç¤ºæŠŠè¯¥å‡½æ•°æ·»åŠ åˆ°æŒ‡å®šçš„ç±»ä¸­</p><p>2ï¼‰ã€ä¸€èˆ¬æˆ‘ä»¬è¦å®šä¹‰å“ªä¸ªç±»çš„æ‰©å±•å‡½æ•°ï¼Œæˆ‘ä»¬å°±å®šä¹‰ä¸€ä¸ªåŒåçš„ Kotlin æ–‡ä»¶ï¼Œä¾¿äºåç»­æŸ¥æ‰¾ï¼Œè™½ç„¶è¯´ä¹Ÿå¯ä»¥å®šä¹‰åœ¨ä»»ä½•ä¸€ä¸ªç±»ä¸­ï¼Œä½†æ˜¯æ›´æ¨èå°†å®ƒå®šä¹‰æˆé¡¶å±‚æ–¹æ³•ï¼Œè¿™æ ·å¯ä»¥è®©æ‰©å±•æ–¹æ³•æ‹¥æœ‰å…¨å±€çš„è®¿é—®åŸŸ</p><p>3ï¼‰ã€æ‰©å±•å‡½æ•°é»˜è®¤æ‹¥æœ‰è¿™ä¸ªç±»çš„ä¸Šä¸‹æ–‡ç¯å¢ƒ</p><p>ä¾‹å¦‚æˆ‘ä»¬ç°åœ¨è¦ç»™ String è¿™ä¸ªç±»æ‰©å±•ä¸€ä¸ª printString æ–¹æ³•ï¼Œæˆ‘ä»¬å°±å¯ä»¥æ–°å»ºä¸€ä¸ª String.kt çš„æ–‡ä»¶ï¼Œç„¶ååœ¨è¿™ä¸ªæ–‡ä»¶ä¸‹é¢ç¼–å†™æ‰©å±•å‡½æ•°ï¼š</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-function"><span class="hljs-keyword">fun</span> String.<span class="hljs-title">printString</span><span class="hljs-params">()</span></span>&#123;<br>    println(<span class="hljs-keyword">this</span>)<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>    <span class="hljs-keyword">val</span> name = <span class="hljs-string">&quot;erdai&quot;</span><br>    name.printString()<br>&#125;<br><span class="hljs-comment">//æ‰“å°ç»“æœ</span><br>erdai<br></code></pre></td></tr></table></figure><h3 id="2ã€æœ‰è¶£çš„è¿ç®—ç¬¦é‡è½½"><a href="#2ã€æœ‰è¶£çš„è¿ç®—ç¬¦é‡è½½" class="headerlink" title="2ã€æœ‰è¶£çš„è¿ç®—ç¬¦é‡è½½"></a>2ã€æœ‰è¶£çš„è¿ç®—ç¬¦é‡è½½</h3><p>Kotlin çš„è¿ç®—ç¬¦é‡è½½å…è®¸æˆ‘ä»¬è®©ä»»æ„ä¸¤ä¸ªå¯¹è±¡è¿›è¡Œç›¸åŠ ï¼Œæˆ–è€…æ˜¯è¿›è¡Œå…¶ä»–æ›´å¤šçš„è¿ç®—æ“ä½œ</p><p>1ï¼‰è¿ç®—ç¬¦é‡è½½ä½¿ç”¨çš„æ˜¯ operator å…³é”®å­—ï¼Œæˆ‘ä»¬åªéœ€è¦åœ¨æŒ‡å®šå‡½æ•°å‰é¢åŠ ä¸Š operator å…³é”®å­—ï¼Œå°±å¯ä»¥å®ç°è¿ç®—ç¬¦é‡è½½çš„åŠŸèƒ½äº†ã€‚</p><p>ä¸Šé¢æ‰€è¯´çš„æŒ‡å®šå‡½æ•°æœ‰ä¸‹é¢è¿™äº›ï¼Œå¦‚å›¾ï¼š</p><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/df8ae50fc7cf4799bebe405014069ddd~tplv-k3u1fbpfcp-zoom-1.image" alt="image-20210319102601471"></p><p>2ï¼‰ä¾‹å¦‚æˆ‘ç°åœ¨è¦å®ç°ä¸¤ä¸ªå¯¹è±¡ç›¸åŠ çš„åŠŸèƒ½ï¼Œå®ƒçš„è¯­æ³•ç»“æ„å¦‚ä¸‹ï¼š</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Obj</span> &#123;<br>   <span class="hljs-keyword">operator</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">plus</span><span class="hljs-params">(obj: <span class="hljs-type">Obj</span>)</span></span>: Obj&#123;<br>     <span class="hljs-comment">//do something</span><br>   &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ä¸‹é¢æˆ‘ä»¬æ¥å®ç°ä¸€ä¸ªé‡‘é’±ç›¸åŠ çš„ä¾‹å­ï¼š</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Money</span>(<span class="hljs-keyword">val</span> value: <span class="hljs-built_in">Int</span>) &#123;<br><br>    <span class="hljs-comment">//å®ç°è¿ç®—ç¬¦é‡è½½ Money + Money</span><br>    <span class="hljs-keyword">operator</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">plus</span><span class="hljs-params">(money: <span class="hljs-type">Money</span>)</span></span>: Money &#123;<br>        <span class="hljs-keyword">val</span> sum = value + money.value<br>        <span class="hljs-keyword">return</span> Money(sum)<br>    &#125;<br><br>    <span class="hljs-comment">//å®ç°è¿ç®—ç¬¦é‡è½½ Money + Int</span><br>    <span class="hljs-keyword">operator</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">plus</span><span class="hljs-params">(money: <span class="hljs-type">Int</span>)</span></span>: Money&#123;<br>        <span class="hljs-keyword">val</span> sum = value + money<br>        <span class="hljs-keyword">return</span> Money(sum)<br>    &#125;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>    <span class="hljs-keyword">val</span> money1 = Money(<span class="hljs-number">15</span>)<br>    <span class="hljs-keyword">val</span> money2 = Money(<span class="hljs-number">20</span>)<br>    <span class="hljs-keyword">val</span> money3 = money1 + money2<br>    <span class="hljs-keyword">val</span> money4 = money3 + <span class="hljs-number">15</span><br>    println(money3.value)<br>    print(money4.value)<br>&#125;<br><br><span class="hljs-comment">//æ‰“å°ç»“æœ</span><br><span class="hljs-number">35</span><br><span class="hljs-number">50</span><br></code></pre></td></tr></table></figure><h2 id="ä¹ã€é«˜é˜¶å‡½æ•°è¯¦è§£"><a href="#ä¹ã€é«˜é˜¶å‡½æ•°è¯¦è§£" class="headerlink" title="ä¹ã€é«˜é˜¶å‡½æ•°è¯¦è§£"></a>ä¹ã€é«˜é˜¶å‡½æ•°è¯¦è§£</h2><p>é«˜é˜¶å‡½æ•°å’Œ Lambda è¡¨è¾¾å¼æ˜¯å¯†ä¸å¯åˆ†çš„ï¼Œåœ¨ä¹‹å‰çš„ç« èŠ‚ï¼Œæˆ‘ä»¬å­¦ä¹ äº†ä¸€äº› å‡½æ•°å¼ Api çš„ç”¨æ³•ï¼Œä½ ä¼šå‘ç°ï¼Œå®ƒä»¬éƒ½ä¼šæœ‰ä¸€ä¸ªå…±åŒçš„ç‰¹ç‚¹ï¼šéœ€è¦ä¼ å…¥ä¸€ä¸ª Lambda è¡¨è¾¾å¼ä½œä¸ºå‚æ•°ã€‚åƒè¿™ç§æ¥æ”¶ Lambda è¡¨è¾¾å¼çš„å‡½æ•°æˆ‘ä»¬å°±å¯ä»¥ç§°ä¹‹ä¸ºå…·æœ‰å‡½æ•°å¼ç¼–ç¨‹é£æ ¼çš„ Apiï¼Œè€Œå¦‚æœä½ è¦å®šä¹‰è‡ªå·±çš„å‡½æ•°å¼ Apiï¼Œé‚£ä¹ˆå°±éœ€è¦ä½¿ç”¨é«˜é˜¶å‡½æ•°æ¥å®ç°äº†</p><h3 id="1ã€å®šä¹‰é«˜é˜¶å‡½æ•°"><a href="#1ã€å®šä¹‰é«˜é˜¶å‡½æ•°" class="headerlink" title="1ã€å®šä¹‰é«˜é˜¶å‡½æ•°"></a>1ã€å®šä¹‰é«˜é˜¶å‡½æ•°</h3><p>1ï¼‰é«˜é˜¶å‡½æ•°çš„å®šä¹‰ï¼šä¸€ä¸ªå‡½æ•°æ¥æ”¶å¦å¤–ä¸€ä¸ªå‡½æ•°ä½œä¸ºå‚æ•°ï¼Œæˆ–è€…è¿”å›å€¼ï¼Œé‚£ä¹ˆå°±å¯ä»¥ç§°ä¹‹ä¸ºé«˜é˜¶å‡½æ•°</p><p>Kotlin ä¸­æ–°å¢äº†å‡½æ•°ç±»å‹ï¼Œå¦‚æœæˆ‘ä»¬å°†è¿™ç§å‡½æ•°ç±»å‹æ·»åŠ åˆ°ä¸€ä¸ªå‡½æ•°çš„å‚æ•°å£°æ˜æˆ–è€…è¿”å›å€¼ï¼Œé‚£ä¹ˆè¿™å°±æ˜¯ä¸€ä¸ªé«˜é˜¶å‡½æ•°</p><p>2ï¼‰å‡½æ•°ç±»å‹çš„è¯­æ³•è§„åˆ™å¦‚ä¸‹</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs kotlin">(String,<span class="hljs-built_in">Int</span>) -&gt; <span class="hljs-built_in">Unit</span><br><span class="hljs-comment">//æˆ–è€…å¦‚ä¸‹</span><br>() -&gt; <span class="hljs-built_in">Unit</span><br></code></pre></td></tr></table></figure><p>-&gt; çš„å·¦è¾¹å£°æ˜å‡½æ•°æ¥æ”¶ä»€ä¹ˆç±»å‹çš„å‚æ•°ï¼Œ-&gt; çš„å³è¾¹å£°æ˜çš„æ˜¯å‡½æ•°çš„è¿”å›å€¼ï¼Œç°åœ¨æˆ‘ä»¬æ¥å£°æ˜ä¸€ä¸ªé«˜é˜¶å‡½æ•°ï¼š</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">example</span><span class="hljs-params">(func: (<span class="hljs-type">String</span>,<span class="hljs-type">Int</span>) -&gt; <span class="hljs-type">Unit</span>)</span></span> &#123;<br>    <span class="hljs-comment">//do something</span><br>&#125;<br></code></pre></td></tr></table></figure><p>3ï¼‰é«˜é˜¶å‡½æ•°çš„è°ƒç”¨ï¼Œæˆ‘ä»¬åªéœ€è¦åœ¨å‚æ•°ååé¢åŠ ä¸Šä¸€å¯¹æ‹¬å·ï¼Œä¼ å…¥å¯¹åº”ç±»å‹çš„å‚æ•°å³å¯ï¼Œä¾‹å¦‚ä»¥ä¸Šé¢å®šä¹‰çš„è¿™ä¸ªé«˜é˜¶å‡½æ•°ä¸ºä¾‹å­ï¼š</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">example</span><span class="hljs-params">(func: (<span class="hljs-type">String</span>,<span class="hljs-type">Int</span>) -&gt; <span class="hljs-type">Unit</span>)</span></span> &#123;<br>    <span class="hljs-comment">//å‡½æ•°ç±»å‹è°ƒç”¨</span><br>    func(<span class="hljs-string">&quot;erdai&quot;</span>,<span class="hljs-number">666</span>)<br>&#125;<br></code></pre></td></tr></table></figure><p>ä¸‹é¢æˆ‘ä»¬å°±æ¥å®è·µä¸€ä¸‹ï¼š</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-comment">//æˆ‘ä»¬ä½¿ç”¨é«˜é˜¶å‡½æ•°æ¥è·å–ä¸¤ä¸ªæ•°ç›¸åŠ çš„å’Œ</span><br><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">numberPlus</span><span class="hljs-params">(num1: <span class="hljs-type">Int</span>,num2: <span class="hljs-type">Int</span>,func: (<span class="hljs-type">Int</span>,<span class="hljs-type">Int</span>) -&gt; <span class="hljs-type">Int</span>)</span></span>: <span class="hljs-built_in">Int</span>&#123;<br>    <span class="hljs-keyword">val</span> sum = func(num1,num2)<br>    <span class="hljs-keyword">return</span> sum<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">plus</span><span class="hljs-params">(num1: <span class="hljs-type">Int</span>,num2: <span class="hljs-type">Int</span>)</span></span>: <span class="hljs-built_in">Int</span>&#123;<br>    <span class="hljs-keyword">return</span> num1 + num2<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">minus</span><span class="hljs-params">(num1: <span class="hljs-type">Int</span>,num2: <span class="hljs-type">Int</span>)</span></span>: <span class="hljs-built_in">Int</span>&#123;<br>    <span class="hljs-keyword">return</span> num1 - num2<br>&#125;<br><br><span class="hljs-comment">//è°ƒç”¨é«˜é˜¶å‡½æ•°çš„ä¸¤ç§æ–¹å¼</span><br><span class="hljs-comment">//æ–¹å¼1ï¼šæˆå‘˜å¼•ç”¨ï¼Œä½¿ç”¨ ::plusï¼Œ::minusè¿™ç§å†™æ³•å¼•ç”¨ä¸€ä¸ªå‡½æ•°</span><br><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>    <span class="hljs-keyword">val</span> numberPlus = numberPlus(<span class="hljs-number">10</span>, <span class="hljs-number">20</span>, ::plus)<br>    <span class="hljs-keyword">val</span> numberMinus = numberPlus(<span class="hljs-number">10</span>, <span class="hljs-number">20</span>, ::minus)<br>    println(numberPlus)<br>    println(numberMinus)<br>&#125;<br><span class="hljs-comment">//æ‰“å°ç»“æœ</span><br><span class="hljs-number">30</span><br>-<span class="hljs-number">10</span><br><br><span class="hljs-comment">//æ–¹å¼2ï¼šä½¿ç”¨ Lambda è¡¨è¾¾å¼çš„å†™æ³•</span><br><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>    <span class="hljs-keyword">val</span> numberPlus = numberPlus(<span class="hljs-number">10</span>, <span class="hljs-number">20</span>)&#123; num1,num2 -&gt;<br>        num1 + num2<br>    &#125;<br>    <span class="hljs-keyword">val</span> numberMinus = numberPlus(<span class="hljs-number">10</span>, <span class="hljs-number">20</span>)&#123; num1,num2 -&gt;<br>        num1 - num2<br>    &#125;<br>    println(numberPlus)<br>    println(numberMinus)<br>&#125;<br><span class="hljs-comment">//æ‰“å°ç»“æœ</span><br><span class="hljs-number">30</span><br>-<span class="hljs-number">10</span><br></code></pre></td></tr></table></figure><p>å…¶ä¸­ä½¿ç”¨ Lambda è¡¨è¾¾å¼çš„å†™æ³•æ˜¯é«˜é˜¶å‡½æ•°ä¸­æœ€æ™®éçš„è°ƒç”¨æ–¹å¼</p><h3 id="2ã€å†…è”å‡½æ•°çš„ä½œç”¨"><a href="#2ã€å†…è”å‡½æ•°çš„ä½œç”¨" class="headerlink" title="2ã€å†…è”å‡½æ•°çš„ä½œç”¨"></a>2ã€å†…è”å‡½æ•°çš„ä½œç”¨</h3><p>1ï¼‰å†…è”å‡½æ•°å¯ä»¥æ¶ˆé™¤ Lambda è¡¨è¾¾å¼è¿è¡Œæ—¶å¸¦æ¥çš„å¼€é”€</p><p>Kotlin ä»£ç æœ€ç»ˆè¿˜æ˜¯ä¼šè½¬æ¢æˆ Java å­—èŠ‚ç æ–‡ä»¶ï¼Œä¸¾ä¸ªğŸŒ°ï¼š</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">numberPlus</span><span class="hljs-params">(num1: <span class="hljs-type">Int</span>,num2: <span class="hljs-type">Int</span>,func: (<span class="hljs-type">Int</span>,<span class="hljs-type">Int</span>) -&gt; <span class="hljs-type">Int</span>)</span></span>: <span class="hljs-built_in">Int</span>&#123;<br>    <span class="hljs-keyword">val</span> sum = func(num1,num2)<br>    <span class="hljs-keyword">return</span> sum<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>  <span class="hljs-keyword">val</span> num1 = <span class="hljs-number">10</span><br>  <span class="hljs-keyword">val</span> num2 = <span class="hljs-number">20</span><br>    <span class="hljs-keyword">val</span> numberPlus = numberPlus(num1, num2)&#123; num1,num2 -&gt;<br>        num1 + num2<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">//ä¸Šé¢è¿™äº›ä»£ç æœ€ç»ˆè½¬æ¢æˆ Java ä»£ç å¤§æ¦‚ä¼šå˜æˆè¿™æ ·ï¼š</span><br><span class="hljs-keyword">public</span> static int numberPlus(int num1, int num2, Function operation)&#123;<br>  int sum = (int) operation.invoke(num1,num2);<br>  <span class="hljs-keyword">return</span> sum;<br>&#125;<br><br><span class="hljs-keyword">public</span> static void main()&#123;<br>  int num1 = <span class="hljs-number">10</span>;<br>  int num2 = <span class="hljs-number">20</span>;<br>  int sum = numberPlus(num1,num2,new Function()&#123;<br>      <span class="hljs-meta">@Override</span><br>      <span class="hljs-keyword">public</span> Integer invoke(Integer num1,Integer num2)&#123;<br>          <span class="hljs-keyword">return</span> num1 + num2;<br>        &#125;<br>    &#125;);<br>&#125;<br></code></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ï¼Œè½¬æ¢ä¹‹åï¼ŒnumberPlus å‡½æ•°çš„ç¬¬ä¸‰ä¸ªå‚æ•°å˜æˆäº†ä¸€ä¸ª Function æ¥å£ï¼Œè¿™æ˜¯ä¸€ç§ Kotlin çš„å†…ç½®æ¥å£ï¼Œé‡Œé¢æœ‰ä¸€ä¸ªå¾…å®ç°çš„ invoke å‡½æ•°ï¼Œè€Œ numberPlus å‡½æ•°å…¶å®å°±æ˜¯è°ƒç”¨äº† Function æ¥å£çš„ invoke å‡½æ•°ï¼Œå¹¶æŠŠ num1 å’Œ num2 ä¼ äº†è¿›å»ã€‚ä¹‹å‰çš„ Lambda è¡¨è¾¾å¼åœ¨è¿™é‡Œå˜æˆäº† Function æ¥å£çš„åŒ¿åç±»å®ç°ï¼Œè¿™å°±æ˜¯ Lambda è¡¨è¾¾å¼çš„åº•å±‚è½¬æ¢é€»è¾‘ï¼Œå› æ­¤æˆ‘ä»¬æ¯è°ƒç”¨ä¸€æ¬¡ Lambda è¡¨è¾¾å¼ï¼Œéƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„åŒ¿åç±»å®ä¾‹ï¼Œè¿™æ ·å°±ä¼šé€ æˆé¢å¤–çš„å†…å­˜å’Œæ€§èƒ½å¼€é”€ã€‚ä½†æ˜¯æˆ‘ä»¬ä½¿ç”¨å†…è”å‡½æ•°ï¼Œå°±å¯ä»¥å¾ˆå¥½çš„å»è§£å†³è¿™ä¸ªé—®é¢˜</p><p>2ï¼‰å®šä¹‰é«˜é˜¶å‡½æ•°æ—¶åŠ ä¸Š inline å…³é”®å­—ä¿®é¥°ï¼Œæˆ‘ä»¬å°±å¯ä»¥æŠŠè¿™ä¸ªå‡½æ•°ç§°ä¹‹ä¸ºå†…è”å‡½æ•°</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-comment">//å®šä¹‰ä¸€ä¸ªå†…è”å‡½æ•°</span><br><span class="hljs-keyword">inline</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">numberPlus</span><span class="hljs-params">(num1: <span class="hljs-type">Int</span>,num2: <span class="hljs-type">Int</span>,func: (<span class="hljs-type">Int</span>,<span class="hljs-type">Int</span>) -&gt; <span class="hljs-type">Int</span>)</span></span>: <span class="hljs-built_in">Int</span>&#123;<br>    <span class="hljs-keyword">val</span> sum = func(num1,num2)<br>    <span class="hljs-keyword">return</span> sum<br>&#125;<br></code></pre></td></tr></table></figure><p><strong>é‚£è¿™é‡Œæˆ‘å°±ä¼šæœ‰ä¸ªç–‘é—®ï¼Œä¸ºå•¥å†…è”å‡½æ•°èƒ½æ¶ˆé™¤ Lambda è¡¨è¾¾å¼è¿è¡Œæ—¶å¸¦æ¥çš„å¼€é”€å‘¢ï¼Ÿ</strong></p><p>è¿™ä¸ªæ—¶å€™æˆ‘ä»¬å°±éœ€è¦å»å‰–æä¸€ä¸‹å†…è”å‡½æ•°çš„å·¥ä½œåŸç†äº†ï¼Œå¦‚ä¸‹ï¼š</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-keyword">inline</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">numberPlus</span><span class="hljs-params">(num1: <span class="hljs-type">Int</span>,num2: <span class="hljs-type">Int</span>,func: (<span class="hljs-type">Int</span>,<span class="hljs-type">Int</span>) -&gt; <span class="hljs-type">Int</span>)</span></span>: <span class="hljs-built_in">Int</span>&#123;<br>    <span class="hljs-keyword">val</span> sum = func(num1,num2)<br>    <span class="hljs-keyword">return</span> sum<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>    <span class="hljs-keyword">val</span> num1 = <span class="hljs-number">10</span><br>    <span class="hljs-keyword">val</span> num2 = <span class="hljs-number">20</span><br>    <span class="hljs-keyword">val</span> numberPlus = numberPlus(num1, num2)&#123; num1,num2 -&gt;<br>        num1 + num2<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><strong>ç¬¬ä¸€æ­¥æ›¿æ¢è¿‡ç¨‹ï¼šKotlin ç¼–è¯‘å™¨ä¼šæŠŠ Lambda è¡¨è¾¾å¼ä¸­çš„ä»£ç æ›¿æ¢åˆ°å‡½æ•°ç±»å‹å‚æ•°è°ƒç”¨çš„åœ°æ–¹</strong> ï¼Œå¦‚ä¸‹å›¾ï¼š</p><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/3d72c3b1f9004f1f8fbea4f3f8353a3b~tplv-k3u1fbpfcp-zoom-1.image" alt="image-20210318103738396"></p><p>æ›¿æ¢åä»£ç å˜æˆäº†è¿™æ ·ï¼š</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-keyword">inline</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">numberPlus</span><span class="hljs-params">(num1: <span class="hljs-type">Int</span>,num2: <span class="hljs-type">Int</span>,func: (<span class="hljs-type">Int</span>,<span class="hljs-type">Int</span>) -&gt; <span class="hljs-type">Int</span>)</span></span>: <span class="hljs-built_in">Int</span>&#123;<br>    <span class="hljs-keyword">val</span> sum = num1 + num2<br>    <span class="hljs-keyword">return</span> sum<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>    <span class="hljs-keyword">val</span> num1 = <span class="hljs-number">10</span><br>    <span class="hljs-keyword">val</span> num2 = <span class="hljs-number">20</span><br>    <span class="hljs-keyword">val</span> numberPlus = numberPlus(num1, num2);<br>&#125;<br></code></pre></td></tr></table></figure><p><strong>ç¬¬äºŒæ­¥æ›¿æ¢è¿‡ç¨‹ï¼šKotlin ç¼–è¯‘å™¨ä¼šæŠŠå†…è”å‡½æ•°ä¸­çš„å…¨éƒ¨ä»£ç æ›¿æ¢åˆ°å‡½æ•°è°ƒç”¨çš„åœ°æ–¹</strong> ï¼Œå¦‚ä¸‹å›¾ï¼š </p><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/3ed6033ee5354e8e8752ac4255fbb2ce~tplv-k3u1fbpfcp-zoom-1.image" alt="image-20210318104214303"></p><p>æ›¿æ¢åä»£ç å˜æˆäº†è¿™æ ·ï¼š</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>    <span class="hljs-keyword">val</span> num1 = <span class="hljs-number">10</span><br>    <span class="hljs-keyword">val</span> num2 = <span class="hljs-number">20</span><br>    <span class="hljs-keyword">val</span> numberPlus = num1 + num2<br>&#125;<br></code></pre></td></tr></table></figure><p>ä¸Šè¿°æ­¥éª¤å°±æ˜¯å†…è”å‡½æ•°çš„ä¸€ä¸ªå·¥ä½œæµç¨‹ï¼š<strong>Kotlin ç¼–è¯‘å™¨ä¼šæŠŠå†…è”å‡½æ•°ä¸­çš„ä»£ç åœ¨ç¼–è¯‘çš„æ—¶å€™è‡ªåŠ¨æ›¿æ¢åˆ°è°ƒç”¨å®ƒçš„åœ°æ–¹</strong> ï¼Œè¿™æ ·ä¹Ÿå°±ä¸å­˜åœ¨è¿è¡Œæ—¶çš„å¼€é”€äº†</p><p>3ï¼‰ä½¿ç”¨ noinline å…³é”®å­—ä¿®é¥°çš„å‡½æ•°ç±»å‹å‚æ•°ï¼Œè¡¨ç¤ºè¯¥å‡½æ•°ç±»å‹å‚æ•°ä¸éœ€è¦è¿›è¡Œå†…è”</p><p>ä¸€èˆ¬ä½¿ç”¨ noinline å…³é”®å­—ï¼Œæ˜¯åœ¨ä¸€ä¸ªå†…è”å‡½æ•°ä¸­å­˜åœ¨å¤šä¸ªå‡½æ•°ç±»å‹çš„å‚æ•°</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-comment">//ä½¿ç”¨å†…è”å‡½æ•°å®šä¹‰çš„é«˜é˜¶å‡½æ•°ï¼Œå…¶é‡Œé¢çš„å‡½æ•°ç±»å‹å‚æ•°éƒ½ä¼šè¿›è¡Œå†…è”ï¼Œå› æ­¤è¿™é‡Œä½¿ç”¨ noinline è¡¨ç¤ºæˆ‘è¿™ä¸ªå‡½æ•°ç±»å‹å‚æ•°ä¸éœ€è¦å†…è”</span><br><span class="hljs-keyword">inline</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">inlineTest</span><span class="hljs-params">(block1: () -&gt; <span class="hljs-type">Unit</span>, <span class="hljs-keyword">noinline</span> block2: () -&gt; <span class="hljs-type">Unit</span>)</span></span>&#123;<br>  <br>&#125;<br></code></pre></td></tr></table></figure><p>å‰é¢æˆ‘ä»¬è®²åˆ°ï¼Œä½¿ç”¨å†…è”å‡½æ•°èƒ½å‡å°‘è¿è¡Œæ—¶å¼€é”€ï¼Œä¸ºå•¥ç°åœ¨åˆè¦å‡ºæ¥ä¸ª noinline å…³é”®å­—å®šä¹‰ä¸éœ€è¦å†…è”å‘¢ï¼ŸåŸå› å¦‚ä¸‹ï¼š</p><p>1ã€å†…è”å‡½æ•°åœ¨ç¼–è¯‘çš„æ—¶å€™ä¼šè¿›è¡Œä»£ç æ›¿æ¢ï¼Œå› æ­¤å®ƒæ²¡æœ‰çœŸæ­£çš„å‚æ•°å±æ€§ï¼Œå®ƒçš„å‡½æ•°ç±»å‹å‚æ•°åªèƒ½ä¼ é€’ç»™å¦å¤–ä¸€ä¸ªå†…è”å‡½æ•°ï¼Œè€Œéå†…è”å‡½æ•°çš„å‡½æ•°ç±»å‹å‚æ•°å¯ä»¥è‡ªç”±çš„ä¼ é€’ç»™å…¶ä»–ä»»ä½•å‡½æ•°</p><p>2ã€å†…è”å‡½æ•°æ‰€å¼•ç”¨çš„ Lambda è¡¨è¾¾å¼å¯ä»¥ä½¿ç”¨ return å…³é”®å­—æ¥è¿›è¡Œå‡½æ•°è¿”å›ï¼Œéå†…è”å‡½æ•°æ‰€å¼•ç”¨çš„ Lambda è¡¨è¾¾å¼å¯ä»¥ä½¿ç”¨ return@Method è¯­æ³•ç»“æ„æ¥è¿›è¡Œå±€éƒ¨è¿”å›</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-comment">//æƒ…å†µ1ï¼šéå†…è”å‡½æ•°æ‰€å¼•ç”¨çš„ Lambda è¡¨è¾¾å¼å¯ä»¥ä½¿ç”¨ return å…³é”®å­—æ¥è¿›è¡Œå±€éƒ¨è¿”å›</span><br><span class="hljs-comment">//å®šä¹‰ä¸€ä¸ªéå†…è”çš„é«˜é˜¶å‡½æ•°</span><br><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">printString</span><span class="hljs-params">(str: <span class="hljs-type">String</span>, block: (<span class="hljs-type">String</span>) -&gt; <span class="hljs-type">Unit</span>)</span></span>&#123;<br>    println(<span class="hljs-string">&quot;printString start...&quot;</span>)<br>    block(str)<br>    println(<span class="hljs-string">&quot;printString end...&quot;</span>)<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>    println(<span class="hljs-string">&quot;main start...&quot;</span>)<br>    <span class="hljs-keyword">val</span> str = <span class="hljs-string">&quot;&quot;</span><br>    printString(str)&#123;<br>        println(<span class="hljs-string">&quot;lambda start...&quot;</span>)<br>      <span class="hljs-comment">/**</span><br><span class="hljs-comment">         * 1ï¼Œéå†…è”å‡½æ•°ä¸èƒ½ç›´æ¥ä½¿ç”¨ return å…³é”®å­—è¿›è¡Œå±€éƒ¨è¿”å›</span><br><span class="hljs-comment"> * 2ï¼Œéœ€è¦ä½¿ç”¨ return<span class="hljs-doctag">@printString</span> è¿›è¡Œå±€éƒ¨è¿”å›</span><br><span class="hljs-comment">         */</span><br>        <span class="hljs-keyword">if</span> (str.isEmpty())<span class="hljs-keyword">return</span><span class="hljs-symbol">@printString</span><br>        println(it)<br>        println(<span class="hljs-string">&quot;lambda end...&quot;</span>)<br>    &#125;<br>    println(<span class="hljs-string">&quot;main end...&quot;</span>)<br>&#125;<br><span class="hljs-comment">//æ‰“å°ç»“æœ</span><br>main start...<br>printString start...<br>lambda start...<br>printString end...<br>main end...<br><br><span class="hljs-comment">//æƒ…å†µ2ï¼šå†…è”å‡½æ•°æ‰€å¼•ç”¨çš„ Lambda è¡¨è¾¾å¼å¯ä»¥ä½¿ç”¨ return å…³é”®å­—æ¥è¿›è¡Œå‡½æ•°è¿”å›</span><br><span class="hljs-comment">//å®šä¹‰ä¸€ä¸ªéå†…è”çš„é«˜é˜¶å‡½æ•°</span><br><span class="hljs-keyword">inline</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">printString</span><span class="hljs-params">(str: <span class="hljs-type">String</span>, block: (<span class="hljs-type">String</span>) -&gt; <span class="hljs-type">Unit</span>)</span></span>&#123;<br>    println(<span class="hljs-string">&quot;printString start...&quot;</span>)<br>    block(str)<br>    println(<span class="hljs-string">&quot;printString end...&quot;</span>)<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>    println(<span class="hljs-string">&quot;main start...&quot;</span>)<br>    <span class="hljs-keyword">val</span> str = <span class="hljs-string">&quot;&quot;</span><br>    printString(str)&#123;<br>        println(<span class="hljs-string">&quot;lambda start...&quot;</span>)<br>        <span class="hljs-keyword">if</span> (str.isEmpty())<span class="hljs-keyword">return</span><br>        println(it)<br>        println(<span class="hljs-string">&quot;lambda end...&quot;</span>)<br>    &#125;<br>    println(<span class="hljs-string">&quot;main end...&quot;</span>)<br>&#125;<br><span class="hljs-comment">//å› ä¸ºå†…è”å‡½æ•°ä¼šè¿›è¡Œä»£ç æ›¿æ¢ï¼Œå› æ­¤è¿™ä¸ª return å°±ç›¸å½“äºå¤–å±‚å‡½æ•°è°ƒç”¨çš„ä¸€ä¸ªè¿”å›ï¼Œå¦‚ä¸‹ä»£ç ï¼š</span><br><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>    println(<span class="hljs-string">&quot;main start...&quot;</span>)<br>    <span class="hljs-keyword">val</span> str = <span class="hljs-string">&quot;&quot;</span><br>    println(<span class="hljs-string">&quot;printString start...&quot;</span>)<br>    println(<span class="hljs-string">&quot;lambda start...&quot;</span>)<br>    <span class="hljs-keyword">if</span> (str.isEmpty())<span class="hljs-keyword">return</span><br>    println(str)<br>    println(<span class="hljs-string">&quot;lambda end...&quot;</span>)<br>    println(<span class="hljs-string">&quot;printString end...&quot;</span>)<br>    println(<span class="hljs-string">&quot;main end...&quot;</span>)<br>&#125;<br><br><span class="hljs-comment">//æ‰“å°ç»“æœ</span><br>main start...<br>printString start...<br>lambda start...<br></code></pre></td></tr></table></figure><p>4ï¼‰ã€ä½¿ç”¨ crossinline å…³é”®å­—ä¿è¯å†…è”å‡½æ•°çš„ Lambda è¡¨è¾¾å¼ä¸­ä¸€å®šä¸ä¼šä½¿ç”¨ return å…³é”®å­—ï¼Œä½†æ˜¯è¿˜æ˜¯å¯ä»¥ä½¿ç”¨ return@Method è¯­æ³•ç»“æ„è¿›è¡Œå±€éƒ¨è¿”å›ï¼Œå…¶ä»–æ–¹é¢å’Œå†…è”å‡½æ•°ç‰¹æ€§ä¸€è‡´</p><p>ä¸¾ä¸ªä½¿ç”¨ crossinline åœºæ™¯çš„ğŸŒ° ï¼š</p><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/7c7beec9bdbb4e789d1814381accc36f~tplv-k3u1fbpfcp-zoom-1.image" alt="image-20210318115342264"></p><p>ä¸Šé¢å›¾ç‰‡ä¸­çš„ä»£ç æŠ¥é”™äº†ï¼Œç¼–è¯‘å™¨æç¤ºæˆ‘ä»¬çš„å¤§è‡´åŸå› æ˜¯ï¼šè¿™ä¸ªåœ°æ–¹ä¸èƒ½ä½¿ç”¨ inline ,å› ä¸ºå®ƒå¯èƒ½åŒ…å«éå±€éƒ¨çš„ return è¿”å›ï¼Œæ·»åŠ  crossinline ä¿®é¥°ç¬¦å»ä¿®é¥°è¿™ä¸ªå‡½æ•°ç±»å‹çš„å‚æ•°ã€‚</p><p>ä¸ºå•¥å‘¢ï¼Ÿæˆ‘ä»¬æ¥åˆ†æä¸€ä¸‹ï¼š</p><p>æˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ª Runnable å¯¹è±¡ï¼Œåœ¨ Runnable ä¸­çš„ Lambda è¡¨è¾¾å¼ä¸­è°ƒç”¨äº†å‡½æ•°ç±»å‹å‚æ•°ï¼ŒLambda è¡¨è¾¾å¼åœ¨ç¼–è¯‘çš„æ—¶å€™ä¼šè¢«è½¬æ¢æˆåŒ¿åå†…éƒ¨ç±»çš„æ–¹å¼ï¼Œå†…è”å‡½æ•°å…è®¸æˆ‘ä»¬åœ¨ Lambda è¡¨è¾¾å¼ä¸­ä½¿ç”¨ return å…³é”®å­—è¿›è¡Œå‡½æ•°è¿”å›ï¼Œä½†æ˜¯ç”±äºæˆ‘ä»¬æ˜¯åœ¨åŒ¿åç±»ä¸­è°ƒç”¨çš„å‡½æ•°ç±»å‹å‚æ•°ï¼Œæ­¤æ—¶æ˜¯ä¸å¯èƒ½è¿›è¡Œå¤–å±‚è°ƒç”¨å‡½æ•°è¿”å›çš„ï¼Œæœ€å¤šæ˜¯åœ¨åŒ¿åå‡½æ•°ä¸­è¿›è¡Œè¿”å›ï¼Œå› æ­¤è¿™é‡Œå°±æç¤ºäº†é”™è¯¯ï¼ŒçŸ¥é“äº†åŸå› é‚£æˆ‘ä»¬ä½¿ç”¨ crossinline å…³é”®å­—æ¥ä¿®æ”¹ä¸€ä¸‹</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-keyword">inline</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">runRunnable</span><span class="hljs-params">(<span class="hljs-keyword">crossinline</span> block: () -&gt; <span class="hljs-type">Unit</span>)</span></span> &#123;<br>    println(<span class="hljs-string">&quot;runRunnable start...&quot;</span>)<br>    <span class="hljs-keyword">val</span> runnable = Runnable &#123;<br>        block()<br>    &#125;<br>    runnable.run()<br>    println(<span class="hljs-string">&quot;runRunnable end...&quot;</span>)<br>&#125;<br><br><br><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>    println(<span class="hljs-string">&quot;main start...&quot;</span>)<br>    runRunnable &#123;<br>        println(<span class="hljs-string">&quot;lambda start...&quot;</span>)<br>        <span class="hljs-keyword">return</span><span class="hljs-symbol">@runRunnable</span><br>        println(<span class="hljs-string">&quot;lambda end...&quot;</span>)<br>    &#125;<br>    println(<span class="hljs-string">&quot;main end...&quot;</span>)<br>&#125;<br><span class="hljs-comment">//æ‰“å°ç»“æœ</span><br>main start...<br>runRunnable start...<br>lambda start...<br>runRunnable end...<br>main end...<br></code></pre></td></tr></table></figure><h2 id="åã€æ³›å‹å’Œå§”æ‰˜"><a href="#åã€æ³›å‹å’Œå§”æ‰˜" class="headerlink" title="åã€æ³›å‹å’Œå§”æ‰˜"></a>åã€æ³›å‹å’Œå§”æ‰˜</h2><h3 id="1ã€æ³›å‹çš„åŸºæœ¬ç”¨æ³•"><a href="#1ã€æ³›å‹çš„åŸºæœ¬ç”¨æ³•" class="headerlink" title="1ã€æ³›å‹çš„åŸºæœ¬ç”¨æ³•"></a>1ã€æ³›å‹çš„åŸºæœ¬ç”¨æ³•</h3><p>1ï¼‰ã€é¦–å…ˆæˆ‘ä»¬è§£é‡Šä¸‹ä»€ä¹ˆæ˜¯æ³›å‹ï¼Œæ³›å‹å°±æ˜¯å‚æ•°åŒ–ç±»å‹ï¼Œå®ƒå…è®¸æˆ‘ä»¬åœ¨ä¸æŒ‡å®šå…·ä½“ç±»å‹çš„æƒ…å†µä¸‹è¿›è¡Œç¼–ç¨‹ã€‚æˆ‘ä»¬åœ¨å®šä¹‰ä¸€ä¸ªç±»ï¼Œæ–¹æ³•ï¼Œæˆ–è€…æ¥å£çš„æ—¶å€™ï¼Œç»™ä»–ä»¬åŠ ä¸Šä¸€ä¸ªç±»å‹å‚æ•°ï¼Œå°±æ˜¯ä¸ºè¿™ä¸ªç±»ï¼Œæ–¹æ³•ï¼Œæˆ–è€…æ¥å£æ·»åŠ äº†ä¸€ä¸ªæ³›å‹</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-comment">//1ã€å®šä¹‰ä¸€ä¸ªæ³›å‹ç±»ï¼Œåœ¨ç±»ååé¢ä½¿ç”¨ &lt;T&gt; è¿™ç§è¯­æ³•ç»“æ„å°±æ˜¯ä¸ºè¿™ä¸ªç±»å®šä¹‰ä¸€ä¸ªæ³›å‹</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyClass</span>&lt;<span class="hljs-type">T</span>&gt;&#123;<br>  <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">method</span><span class="hljs-params">(params: <span class="hljs-type">T</span>)</span></span> &#123;<br>      <br>    &#125;<br>&#125;<br><span class="hljs-comment">//æ³›å‹è°ƒç”¨</span><br><span class="hljs-keyword">val</span> myClass = MyClass&lt;<span class="hljs-built_in">Int</span>&gt;()<br>myClass.method(<span class="hljs-number">12</span>)<br><br><span class="hljs-comment">//2ã€å®šä¹‰ä¸€ä¸ªæ³›å‹æ–¹æ³•ï¼Œåœ¨æ–¹æ³•åçš„å‰é¢åŠ ä¸Š &lt;T&gt; è¿™ç§è¯­æ³•ç»“æ„å°±æ˜¯ä¸ºè¿™ä¸ªæ–¹æ³•å®šä¹‰ä¸€ä¸ªæ³›å‹</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyClass</span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;T&gt;</span> <span class="hljs-title">method</span><span class="hljs-params">(params: <span class="hljs-type">T</span>)</span></span>&#123;<br><br>    &#125;<br>&#125;<br><span class="hljs-comment">//æ³›å‹è°ƒç”¨</span><br><span class="hljs-keyword">val</span> myClass = MyClass()<br>myClass.method&lt;<span class="hljs-built_in">Int</span>&gt;(<span class="hljs-number">12</span>)<br><span class="hljs-comment">//æ ¹æ® Kotlin ç±»å‹æ¨å¯¼æœºåˆ¶ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠæ³›å‹ç»™çœç•¥</span><br>myClass.method(<span class="hljs-number">12</span>)<br><br><span class="hljs-comment">//3ã€å®šä¹‰ä¸€ä¸ªæ³›å‹æ¥å£ï¼Œåœ¨æ¥å£ååé¢åŠ ä¸Š &lt;T&gt; è¿™ç§è¯­æ³•ç»“æ„å°±æ˜¯ä¸ºè¿™ä¸ªæ¥å£å®šä¹‰ä¸€ä¸ªæ³›å‹</span><br><span class="hljs-keyword">interface</span> <span class="hljs-title class_">MyInterface</span>&lt;<span class="hljs-type">T</span>&gt;&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">interfaceMethod</span><span class="hljs-params">(params: <span class="hljs-type">T</span>)</span></span><br>&#125;<br></code></pre></td></tr></table></figure><p>ä¸Šé¢çš„ T ä¸æ˜¯å›ºå®šçš„ï¼Œå¯ä»¥æ˜¯ä»»æ„å•è¯å’Œå­—æ¯ï¼Œä½†æ˜¯å®šä¹‰çš„æ³›å‹å°½é‡åšåˆ°è§åçŸ¥ä¹‰</p><p>2ï¼‰ã€ä¸ºæ³›å‹æŒ‡å®šä¸Šç•Œï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <code>&lt;T : Class&gt;</code> è¿™ç§è¯­æ³•ç»“æ„ï¼Œå¦‚æœä¸æŒ‡å®šæ³›å‹çš„ä¸Šç•Œï¼Œé»˜è®¤ä¸º Any? ç±»å‹</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyClass</span>&#123;<br>  <span class="hljs-comment">//æˆ‘ä»¬æŒ‡å®šäº†æ³›å‹çš„ä¸Šç•Œä¸º Number, é‚£ä¹ˆæˆ‘ä»¬å°±åªèƒ½ä¼ å…¥æ•°å­—ç±»å‹çš„å‚æ•°äº†</span><br>  <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;T : Number&gt;</span> <span class="hljs-title">method</span><span class="hljs-params">(params: <span class="hljs-type">T</span>)</span></span> &#123;<br>      <br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="2ã€ç±»å§”æ‰˜å’Œå§”æ‰˜å±æ€§"><a href="#2ã€ç±»å§”æ‰˜å’Œå§”æ‰˜å±æ€§" class="headerlink" title="2ã€ç±»å§”æ‰˜å’Œå§”æ‰˜å±æ€§"></a>2ã€ç±»å§”æ‰˜å’Œå§”æ‰˜å±æ€§</h3><p>å§”æ‰˜æ¨¡å¼çš„æ„ä¹‰ï¼š<strong>åœ¨äºæˆ‘ä»¬å¤§éƒ¨åˆ†æ–¹æ³•å®ç°å¯ä»¥è°ƒç”¨è¾…åŠ©å¯¹è±¡å»å®ç°ï¼Œå°‘éƒ¨åˆ†æ–¹æ³•çš„å®ç°ç”±è‡ªå·±æ¥é‡å†™ï¼Œç”šè‡³åŠ å…¥ä¸€äº›è‡ªå·±ç‹¬æœ‰çš„æ–¹æ³•ï¼Œä½¿æˆ‘ä»¬è¿™ä¸ªç±»å˜æˆä¸€ä¸ªå…¨æ–°æ•°æ®ç»“æ„çš„ç±»</strong></p><p>1ï¼‰ã€ç±»å§”æ‰˜æ ¸å¿ƒæ€æƒ³å°±æ˜¯æŠŠä¸€ä¸ªç±»çš„å…·ä½“å®ç°å§”æ‰˜ç»™å¦å¤–ä¸€ä¸ªç±»ï¼Œä½¿ç”¨ by å…³é”®å­—è¿›è¡Œå§”æ‰˜</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-comment">//å®šä¹‰ä¸€ä¸ª MySet ç±»ï¼Œå®ƒé‡Œé¢çš„å…·ä½“å®ç°éƒ½å§”æ‰˜ç»™äº† HashSet è¿™ä¸ªç±»ï¼Œè¿™æ˜¯æ˜¯ç±»å§”æ‰˜</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">MySet</span>&lt;<span class="hljs-type">T</span>&gt;(<span class="hljs-keyword">val</span> helperSet: HashSet&lt;T&gt;) : Set&lt;T&gt;&#123;<br><br>    <span class="hljs-keyword">override</span> <span class="hljs-keyword">val</span> size: <span class="hljs-built_in">Int</span> <span class="hljs-keyword">get</span>() = helperSet.size<br><br>    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">contains</span><span class="hljs-params">(element: <span class="hljs-type">T</span>)</span></span> = helperSet.contains(element)<br><br>    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">containsAll</span><span class="hljs-params">(elements: <span class="hljs-type">Collection</span>&lt;<span class="hljs-type">T</span>&gt;)</span></span> = helperSet.containsAll(elements)<br><br>    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">isEmpty</span><span class="hljs-params">()</span></span> = helperSet.isEmpty()<br><br>    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">iterator</span><span class="hljs-params">()</span></span> = helperSet.iterator()<br>&#125;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * å¦‚æœæˆ‘ä»¬ä½¿ç”¨ by å…³é”®å­—ï¼Œä¸Šé¢çš„ä»£ç å°†ä¼šå˜å¾—éå¸¸æ•´æ´ï¼ŒåŒæ—¶æˆ‘ä»¬å¯ä»¥å¯¹æŸä¸ªæ–¹æ³•è¿›è¡Œé‡å†™æˆ–è€…æ–°å¢æ–¹æ³•</span><br><span class="hljs-comment"> * é‚£ä¹ˆ MySet å°±å˜æˆäº†ä¸€ä¸ªå…¨æ–°çš„æ•°æ®ç»“æ„ç±»</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">MySet</span>&lt;<span class="hljs-type">T</span>&gt;(<span class="hljs-keyword">val</span> helperSet: HashSet&lt;T&gt;) : Set&lt;T&gt; <span class="hljs-keyword">by</span> helperSet&#123;<br>     <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">helloWord</span><span class="hljs-params">()</span></span>&#123;<br>        println(<span class="hljs-string">&quot;Hello World&quot;</span>)<br>    &#125;<br>    <br>    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">isEmpty</span><span class="hljs-params">()</span></span> = <span class="hljs-literal">false</span><br>&#125;<br></code></pre></td></tr></table></figure><p>2ï¼‰ã€å±æ€§å§”æ‰˜çš„æ ¸å¿ƒæ€æƒ³æ˜¯å°†ä¸€ä¸ªå±æ€§çš„å…·ä½“å®ç°å§”æ‰˜ç»™å¦ä¸€ä¸ªç±»å»å®Œæˆ</p><p>å±æ€§å§”æ‰˜çš„è¯­æ³•ç»“æ„å¦‚ä¸‹ï¼š</p> <figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * ä½¿ç”¨ by å…³é”®å­—è¿æ¥äº†å·¦è¾¹çš„ p å±æ€§å’Œå³è¾¹çš„ Delegate å®ä¾‹</span><br><span class="hljs-comment"> * è¿™ç§å†™æ³•å°±ä»£è¡¨ç€å°† p å±æ€§çš„å…·ä½“å®ç°å§”æ‰˜ç»™äº† Delegate å»å®Œæˆ</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyClass</span>&#123;<br><br>    <span class="hljs-keyword">var</span> p <span class="hljs-keyword">by</span> Delegate()<br>&#125;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * ä¸‹é¢æ˜¯ä¸€ä¸ªè¢«å§”æ‰˜ç±»çš„ä»£ç å®ç°æ¨¡ç‰ˆ</span><br><span class="hljs-comment"> * ä¸€ã€getValue æ–¹æ³•å’ŒsetValue æ–¹æ³•å¿…é¡»ä½¿ç”¨ operator å…³é”®å­—ä¿®é¥°</span><br><span class="hljs-comment"> * </span><br><span class="hljs-comment"> * äºŒã€getValue æ–¹æ³•ä¸»è¦æ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼š</span><br><span class="hljs-comment"> * 1ã€ç¬¬ä¸€ä¸ªå‚æ•°è¡¨æ˜ Delegate ç±»çš„å§”æ‰˜åŠŸèƒ½å¯ä»¥åœ¨ä»€ä¹ˆç±»ä¸­ä½¿ç”¨</span><br><span class="hljs-comment"> * 2ã€ç¬¬äºŒä¸ªå‚æ•° KProperty&lt;*&gt; æ˜¯ Kotlin ä¸­çš„ä¸€ä¸ªå±æ€§æ“ä½œç±»ï¼Œ</span><br><span class="hljs-comment"> *    å¯ç”¨äºè·å–å„ç§å±æ€§çš„ç›¸å…³å€¼ï¼Œ&lt;*&gt;è¿™ç§æ³›å‹çš„å†™æ³•ç±»ä¼¼ Java çš„</span><br><span class="hljs-comment"> *    &lt;?&gt;ï¼Œè¡¨ç¤ºæˆ‘ä¸å…³å¿ƒæ³›å‹çš„å…·ä½“ç±»å‹</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * ä¸‰ã€setValue æ–¹æ³•ä¹Ÿæ˜¯ç›¸ä¼¼çš„ï¼Œæ¥æ”¶ä¸‰ä¸ªå‚æ•°ï¼š</span><br><span class="hljs-comment"> * 1ã€å‰é¢ä¸¤ä¸ªå‚æ•°å’Œ getValue æ˜¯ä¸€æ ·çš„</span><br><span class="hljs-comment"> * 2ã€ç¬¬ä¸‰ä¸ªå‚æ•°è¡¨ç¤ºå…·ä½“è¦èµ‹å€¼ç»™å§”æ‰˜å±æ€§çš„å€¼ï¼Œè¿™ä¸ªå‚æ•°çš„ç±»å‹å¿…é¡»å’Œ</span><br><span class="hljs-comment"> *    getValue æ–¹æ³•è¿”å›å€¼çš„ç±»å‹ä¿æŒä¸€è‡´</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * ä¸€ç§ç‰¹æ®Šæƒ…å†µï¼šç”¨ val å®šä¹‰çš„å˜é‡ä¸éœ€è¦å®ç° setValue æ–¹æ³•ï¼Œå› ä¸º val</span><br><span class="hljs-comment"> *             å…³é”®å­—å£°æ˜çš„å±æ€§åªå¯è¯»ï¼Œèµ‹å€¼ä¹‹åå°±ä¸èƒ½æ›´æ”¹äº†</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Delegate</span>&#123;<br>    <br>    <span class="hljs-keyword">var</span> propValue: Any? = <span class="hljs-literal">null</span><br><br>    <span class="hljs-keyword">operator</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">getValue</span><span class="hljs-params">(any: <span class="hljs-type">Any</span>?,prop: <span class="hljs-type">KProperty</span>&lt;*&gt;)</span></span>: Any?&#123;<br>        <span class="hljs-keyword">return</span> propValue<br>    &#125;<br><br>    <span class="hljs-keyword">operator</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">setValue</span><span class="hljs-params">(any: <span class="hljs-type">Any</span>?,prop: <span class="hljs-type">KProperty</span>&lt;*&gt;,value: <span class="hljs-type">Any</span>?)</span></span>&#123;<br>        propValue = value<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="åä¸€ã€ä½¿ç”¨-infix-å‡½æ•°æ„å»ºæ›´å¯è¯»çš„è¯­æ³•"><a href="#åä¸€ã€ä½¿ç”¨-infix-å‡½æ•°æ„å»ºæ›´å¯è¯»çš„è¯­æ³•" class="headerlink" title="åä¸€ã€ä½¿ç”¨ infix å‡½æ•°æ„å»ºæ›´å¯è¯»çš„è¯­æ³•"></a>åä¸€ã€ä½¿ç”¨ infix å‡½æ•°æ„å»ºæ›´å¯è¯»çš„è¯­æ³•</h2><p>infix å‡½æ•°è¯­æ³•ç»“æ„å¯è¯»æ€§é«˜ï¼Œç›¸æ¯”äºè°ƒç”¨ä¸€ä¸ªå‡½æ•°ï¼Œå®ƒæ›´æ¥è¿‘äºä½¿ç”¨è‹±è¯­ A to B è¿™æ ·çš„è¯­æ³•ç»“æ„</p><p>ä¾‹å¦‚æˆ‘ä»¬è°ƒç”¨ä¸€ä¸ªå‡½æ•°ä¼šä½¿ç”¨ï¼š A.to(B) è¿™ç§ç»“æ„ï¼Œä½†æ˜¯ä½¿ç”¨ infix å‡½æ•°æˆ‘ä»¬å¯ä»¥è¿™ä¹ˆå†™ï¼šA to Bï¼Œè¿™ç§è¯­æ³•æˆ‘ä»¬åœ¨è®² Map çš„æ—¶å€™ç”¨è¿‡</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-comment">//å®šä¹‰ä¸€ä¸ªä¸å¯å˜ Map é›†åˆ</span><br><span class="hljs-keyword">val</span> map1 = mapOf(<span class="hljs-string">&quot;Apple&quot;</span> to <span class="hljs-number">1</span>,<span class="hljs-string">&quot;Banana&quot;</span> to <span class="hljs-number">2</span>,<span class="hljs-string">&quot;Orange&quot;</span> to <span class="hljs-number">3</span>, <span class="hljs-string">&quot;Pear&quot;</span> to <span class="hljs-number">4</span>,<span class="hljs-string">&quot;Grape&quot;</span> to <span class="hljs-number">5</span>)<br></code></pre></td></tr></table></figure><p>1ï¼‰ã€åœ¨å‡½æ•°å‰é¢åŠ ä¸Š infix å…³é”®å­—ï¼Œå°±å¯ä»¥å£°æ˜è¿™æ˜¯ä¸€ä¸ª infix å‡½æ•°</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-comment">//å¯¹ String å¢åŠ ä¸€ä¸ªæ‰©å±•çš„ infix å‡½æ•°ï¼Œæœ€ç»ˆè°ƒç”¨çš„è¿˜æ˜¯ String çš„ startsWith å‡½æ•°</span><br><span class="hljs-keyword">infix</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> String.<span class="hljs-title">beginWith</span><span class="hljs-params">(string: <span class="hljs-type">String</span>)</span></span> = startsWith(string)<br><br><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>    <span class="hljs-keyword">val</span> name = <span class="hljs-string">&quot;erdai&quot;</span><br>    println(name beginWith <span class="hljs-string">&quot;er&quot;</span>)<br>&#125;<br><span class="hljs-comment">//æ‰“å°ç»“æœ</span><br><span class="hljs-literal">true</span><br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬å†æ¥å®ç°ä¸€ä¸ªåˆå§‹åŒ– Map æ—¶é‡Œé¢ä¼ å…¥ A to B è¿™ç§ infix å‡½æ•°</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-comment">//è¿™æ˜¯ A to B çš„æºç å®ç°</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">infix</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;A, B&gt;</span> A.<span class="hljs-title">to</span><span class="hljs-params">(that: <span class="hljs-type">B</span>)</span></span>: Pair&lt;A, B&gt; = Pair(<span class="hljs-keyword">this</span>, that)<br><br><span class="hljs-comment">//æˆ‘ä»¬ä»¿ç…§å®ƒå†™ä¸€ä¸ª</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">infix</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;A,B&gt;</span> A.<span class="hljs-title">with</span><span class="hljs-params">(that: <span class="hljs-type">B</span>)</span></span>: Pair&lt;A,B&gt; = Pair(<span class="hljs-keyword">this</span>,that)<br><br><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>    <span class="hljs-keyword">val</span> map = mapOf(<span class="hljs-string">&quot;Apple&quot;</span> with <span class="hljs-number">1</span>,<span class="hljs-string">&quot;Banana&quot;</span> with <span class="hljs-number">2</span>,<span class="hljs-string">&quot;Orange&quot;</span> with <span class="hljs-number">3</span>,<span class="hljs-string">&quot;Pear&quot;</span> with <span class="hljs-number">4</span>,<span class="hljs-string">&quot;Grape&quot;</span> with <span class="hljs-number">5</span>)<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="åäºŒã€ä½¿ç”¨-DSL-æ„å»ºä¸“æœ‰çš„è¯­æ³•ç»“æ„"><a href="#åäºŒã€ä½¿ç”¨-DSL-æ„å»ºä¸“æœ‰çš„è¯­æ³•ç»“æ„" class="headerlink" title="åäºŒã€ä½¿ç”¨ DSL æ„å»ºä¸“æœ‰çš„è¯­æ³•ç»“æ„"></a>åäºŒã€ä½¿ç”¨ DSL æ„å»ºä¸“æœ‰çš„è¯­æ³•ç»“æ„</h2><p>1ï¼‰ã€DSL ä»‹ç»</p><p>DSLè‹±æ–‡å…¨ç§°ï¼š<strong>domain specific language</strong>ï¼Œä¸­æ–‡ç¿»è¯‘å³é¢†åŸŸç‰¹å®šè¯­è¨€ï¼Œä¾‹å¦‚ï¼šHTMLï¼ŒXMLç­‰ DSL è¯­è¨€</p><p><strong>ç‰¹ç‚¹</strong></p><ul><li>è§£å†³ç‰¹å®šé¢†åŸŸçš„ä¸“æœ‰é—®é¢˜</li><li>å®ƒä¸ç³»ç»Ÿç¼–ç¨‹è¯­è¨€èµ°çš„æ˜¯ä¸¤ä¸ªæç«¯ï¼Œç³»ç»Ÿç¼–ç¨‹è¯­è¨€æ˜¯å¸Œæœ›è§£å†³æ‰€æœ‰çš„é—®é¢˜ï¼Œæ¯”å¦‚ Java è¯­è¨€å¸Œæœ›èƒ½åš Android å¼€å‘ï¼Œåˆå¸Œæœ›èƒ½åšåå°å¼€å‘ï¼Œå®ƒå…·æœ‰æ¨ªå‘æ‰©å±•çš„ç‰¹æ€§ã€‚è€Œ DSL å…·æœ‰çºµå‘æ·±å…¥è§£å†³ç‰¹å®šé¢†åŸŸä¸“æœ‰é—®é¢˜çš„ç‰¹æ€§ã€‚</li></ul><p>æ€»çš„æ¥è¯´ï¼ŒDSL çš„<strong>æ ¸å¿ƒæ€æƒ³</strong>å°±æ˜¯ï¼šâ€œæ±‚ä¸“ä¸æ±‚å…¨ï¼Œè§£å†³ç‰¹å®šé¢†åŸŸçš„é—®é¢˜â€ã€‚</p><p>2ï¼‰Kotin DSL </p><p>é¦–å…ˆä»‹ç»ä¸€ä¸‹Gradleï¼šGradle æ˜¯ä¸€ä¸ªå¼€æºçš„è‡ªåŠ¨åŒ–æ„å»ºå·¥å…·ï¼Œæ˜¯ä¸€ç§åŸºäº Groovy æˆ– Kotin çš„ DSLã€‚æˆ‘ä»¬çš„ Android åº”ç”¨å°±æ˜¯ä½¿ç”¨ Gradle æ„å»ºçš„ï¼Œå› æ­¤åç»­å†™è„šæœ¬ï¼Œå†™æ’ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ Kotlin å»ç¼–å†™ï¼Œè€Œä¸” AndroidStudio å¯¹ Kotlin çš„æ”¯æŒå¾ˆå‹å¥½ï¼Œå„ç§æç¤ºï¼Œå†™èµ·æ¥å¾ˆçˆ½ã€‚</p><p>å¯¹äºæˆ‘ä»¬ Android å¼€å‘ï¼Œåœ¨ build.gradle æ–‡ä»¶é‡Œé¢æ·»åŠ ä¾èµ–çš„æ–¹å¼å¾ˆå¸¸è§ï¼š</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs kotlin">dependencies &#123;<br>    implementation <span class="hljs-string">&#x27;androidx.core:core-ktx:1.3.2&#x27;</span><br>    implementation <span class="hljs-string">&#x27;androidx.appcompat:appcompat:1.2.0&#x27;</span><br>&#125;<br></code></pre></td></tr></table></figure><p>ä¸Šé¢è¿™ç§å†™æ³•æ˜¯ä¸€ç§åŸºäº Groovy çš„ DSLï¼Œä¸‹é¢æˆ‘ä»¬å°±ä½¿ç”¨ Kotlin æ¥å®ç°ä¸€ä¸ªç±»ä¼¼çš„ DSLï¼š</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Dependency</span> &#123;<br><br>    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">implementation</span><span class="hljs-params">(lib: <span class="hljs-type">String</span>)</span></span>&#123;<br><br>    &#125;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">dependencies</span><span class="hljs-params">(block: <span class="hljs-type">Dependency</span>.() -&gt; <span class="hljs-type">Unit</span>)</span></span>&#123;<br>    <span class="hljs-keyword">val</span> dependency = Dependency()<br>    dependency.block()<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>    <span class="hljs-comment">//å› ä¸º Groovy å’Œ Kotlin è¯­æ³•ä¸åŒï¼Œå› æ­¤å†™æ³•ä¼šæœ‰ä¸€ç‚¹åŒºåˆ«</span><br>    dependencies &#123;<br>        implementation (<span class="hljs-string">&quot;androidx.core:core-ktx:1.3.2&quot;</span>)<br>        implementation (<span class="hljs-string">&quot;androidx.appcompat:appcompat:1.2.0&quot;</span>)<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="åä¸‰ã€Java-ä¸-Kotlin-ä»£ç ä¹‹é—´çš„è½¬æ¢"><a href="#åä¸‰ã€Java-ä¸-Kotlin-ä»£ç ä¹‹é—´çš„è½¬æ¢" class="headerlink" title="åä¸‰ã€Java ä¸ Kotlin ä»£ç ä¹‹é—´çš„è½¬æ¢"></a>åä¸‰ã€Java ä¸ Kotlin ä»£ç ä¹‹é—´çš„è½¬æ¢</h2><h3 id="Java-ä»£ç è½¬-Kotlin-ä»£ç "><a href="#Java-ä»£ç è½¬-Kotlin-ä»£ç " class="headerlink" title="Java ä»£ç è½¬ Kotlin ä»£ç "></a>Java ä»£ç è½¬ Kotlin ä»£ç </h3><p>æ–¹å¼æœ‰2ï¼š</p><p>1ï¼‰ã€ç›´æ¥å°† Java ä»£ç å¤åˆ¶åˆ° Kotlin æ–‡ä»¶ä¸­ï¼ŒAndroidStudio ä¼šå‡ºæ¥æç¤ºæ¡†è¯¢é—®ä½ æ˜¯å¦è½¬æ¢</p><p>2ï¼‰ã€æ‰“å¼€è¦è½¬æ¢çš„ Java æ–‡ä»¶ï¼Œåœ¨å¯¼èˆªæ ç‚¹å‡» Code -&gt; Convert Java File to Kotlin File</p><h3 id="Kotlin-ä»£ç è½¬-Java-ä»£ç "><a href="#Kotlin-ä»£ç è½¬-Java-ä»£ç " class="headerlink" title="Kotlin ä»£ç è½¬ Java ä»£ç "></a>Kotlin ä»£ç è½¬ Java ä»£ç </h3><p>æ‰“å¼€å½“å‰éœ€è¦è½¬æ¢çš„ Kotlin æ–‡ä»¶ï¼Œåœ¨å¯¼èˆªæ ç‚¹å‡» Tools -&gt; Kotlin -&gt;Show Kotlin Bytecode ï¼Œä¼šå‡ºæ¥å¦‚ä¸‹ç•Œé¢ï¼š</p><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/c0008a17b27f4c8990ad726501654dbd~tplv-k3u1fbpfcp-zoom-1.image" alt="image-20210318152946177"></p><p>ç‚¹å‡» Decompile å°±å¯ä»¥æŠŠ Kotlin å­—èŠ‚ç æ–‡ä»¶åç¼–è¯‘æˆ Java ä»£ç äº†</p><h2 id="åå››ã€æ€»ç»“"><a href="#åå››ã€æ€»ç»“" class="headerlink" title="åå››ã€æ€»ç»“"></a>åå››ã€æ€»ç»“</h2><p>æœ¬ç¯‡æ–‡ç« å¾ˆé•¿ï¼Œæˆ‘ä»¬ä»‹ç»äº† Kotlin å¤§éƒ¨åˆ†çŸ¥è¯†ç‚¹ï¼ŒæŒ‰ç…§æ–‡ç« å¼€å¤´çš„æ€ç»´å¯¼å›¾ï¼Œæˆ‘ä»¬å°±åªå‰©ä¸‹ Kotlin æ³›å‹é«˜çº§ç‰¹æ€§å’Œ Kotlin æºç¨‹æ²¡æœ‰è®²äº†ï¼Œè¿™ä¸¤éƒ¨åˆ†ç›¸å¯¹æ¥è¯´æ¯”è¾ƒéš¾ï¼Œå’‹ä»¬åç»­åœ¨æ¥ä»”ç»†åˆ†æã€‚ç›¸ä¿¡ä½ å¦‚æœä»å¤´çœ‹åˆ°è¿™é‡Œï¼Œæ”¶è·ä¸€å®šå¾ˆå¤šï¼Œå¦‚æœè§‰å¾—æˆ‘å†™å¾—è¿˜ä¸é”™ï¼Œè¯·ç»™æˆ‘ç‚¹ä¸ªèµå§ğŸ¤</p><h3 id="å‚è€ƒå’Œæ¨è"><a href="#å‚è€ƒå’Œæ¨è" class="headerlink" title="å‚è€ƒå’Œæ¨è"></a>å‚è€ƒå’Œæ¨è</h3><p>[ç¬¬ä¸€è¡Œä»£ç  Android ç¬¬3ç‰ˆ] ï¼šéƒ­ç¥å‡ºå“ï¼Œå¿…å±ç²¾å“ï¼Œå¯¹ Kotlin çš„è®²è§£å†™å¾—é€šä¿—æ˜“æ‡‚</p><blockquote><p><strong>ä½ çš„ç‚¹èµï¼Œè¯„è®ºï¼Œæ˜¯å¯¹æˆ‘å·¨å¤§çš„é¼“åŠ±ï¼</strong></p><p>æ¬¢è¿å…³æ³¨æˆ‘çš„<strong>å…¬ä¼—å·ï¼š</strong>  <a href="http://m6z.cn/6jwi7b"><strong>sweetying</strong></a> ï¼Œæ–‡ç« æ›´æ–°å¯ç¬¬ä¸€æ—¶é—´æ”¶åˆ°</p><p>å¦‚æœ<strong>æœ‰é—®é¢˜</strong>ï¼Œå…¬ä¼—å·å†…æœ‰åŠ æˆ‘å¾®ä¿¡çš„å…¥å£ï¼Œåœ¨æŠ€æœ¯å­¦ä¹ ã€ä¸ªäººæˆé•¿çš„é“è·¯ä¸Šï¼Œæˆ‘ä»¬ä¸€èµ·å‰è¿›ï¼</p></blockquote>]]></content>
    
    
    <categories>
      
      <category>Android</category>
      
      <category>Kotlin</category>
      
    </categories>
    
    
    <tags>
      
      <tag>åŸåˆ›</tag>
      
      <tag>Android</tag>
      
      <tag>Kotlin</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Androidå­—ä½“ç³»åˆ— ï¼ˆå››ï¼‰ï¼šå…¨å±€æ›¿æ¢å­—ä½“æ–¹å¼</title>
    <link href="/2022/10/11/Android%E5%AD%97%E4%BD%93%E7%B3%BB%E5%88%97%20%EF%BC%88%E5%9B%9B%EF%BC%89%EF%BC%9A%E5%85%A8%E5%B1%80%E6%9B%BF%E6%8D%A2%E5%AD%97%E4%BD%93%E6%96%B9%E5%BC%8F/"/>
    <url>/2022/10/11/Android%E5%AD%97%E4%BD%93%E7%B3%BB%E5%88%97%20%EF%BC%88%E5%9B%9B%EF%BC%89%EF%BC%9A%E5%85%A8%E5%B1%80%E6%9B%BF%E6%8D%A2%E5%AD%97%E4%BD%93%E6%96%B9%E5%BC%8F/</url>
    
    <content type="html"><![CDATA[<p><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/a81428b3b57d46fd953022835fecb19e~tplv-k3u1fbpfcp-watermark.image"></p><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>å¾ˆé«˜å…´é‡è§ä½ ~</p><p>åœ¨æœ¬ç³»åˆ—çš„ä¸Šä¸€ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬äº†è§£äº† Xml ä¸­çš„å­—ä½“ï¼Œè¿˜æ²¡æœ‰çœ‹è¿‡ä¸Šä¸€ç¯‡æ–‡ç« çš„æœ‹å‹ï¼Œå»ºè®®å…ˆå»é˜…è¯» <a href="https://juejin.cn/post/6974388756275019812">Androidå­—ä½“ç³»åˆ— ï¼ˆä¸‰ï¼‰ï¼šXmlä¸­çš„å­—ä½“</a>ï¼Œæœ‰äº†å‰é¢çš„åŸºç¡€ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å°±çœ‹ä¸‹ Android ä¸­å…¨å±€æ›¿æ¢å­—ä½“çš„å‡ ç§æ–¹å¼</p><p><strong>æ³¨æ„ï¼šæœ¬æ–‡æ‰€å±•ç¤ºçš„ç³»ç»Ÿæºç éƒ½æ˜¯åŸºäºAndroid-30 ï¼Œå¹¶æå–æ ¸å¿ƒéƒ¨åˆ†è¿›è¡Œåˆ†æ</strong></p><p> <a href="https://github.com/sweetying520/ChangeDefaultFontDemo">Github Demo åœ°å€</a> , å¤§å®¶å¯ä»¥çœ‹ Demo è·Ÿéšæˆ‘çš„æ€è·¯ä¸€èµ·åˆ†æ</p><h2 id="ä¸€ã€æ–¹å¼ä¸€ï¼šé€šè¿‡éå†-ViewTreeï¼Œå…¨å±€æ›¿æ¢å­—ä½“"><a href="#ä¸€ã€æ–¹å¼ä¸€ï¼šé€šè¿‡éå†-ViewTreeï¼Œå…¨å±€æ›¿æ¢å­—ä½“" class="headerlink" title="ä¸€ã€æ–¹å¼ä¸€ï¼šé€šè¿‡éå† ViewTreeï¼Œå…¨å±€æ›¿æ¢å­—ä½“"></a>ä¸€ã€æ–¹å¼ä¸€ï¼šé€šè¿‡éå† ViewTreeï¼Œå…¨å±€æ›¿æ¢å­—ä½“</h2><p>ä¹‹å‰æˆ‘è®²è¿‡ï¼šåœ¨ Android ä¸­ï¼Œæˆ‘ä»¬ä¸€èˆ¬ä¼šç›´æ¥æˆ–é—´æ¥çš„é€šè¿‡ TextView æ§ä»¶å»æ‰¿è½½å­—ä½“çš„æ˜¾ç¤ºï¼Œå› ä¸ºå…³äº Android æä¾›çš„æ‰¿è½½å­—ä½“æ˜¾ç¤ºçš„æ§ä»¶éƒ½ä¼šç›´æ¥æˆ–é—´æ¥ç»§æ‰¿ TextViewã€‚ </p><p>é‚£ä¹ˆè¿™å°±æ˜¯ä¸€ä¸ªçªç ´å£ï¼š<strong>æˆ‘ä»¬å¯ä»¥åœ¨ Activity æˆ– Fragment çš„åŸºç±»é‡Œé¢è·å–å½“å‰å¸ƒå±€çš„ ViewTreeï¼Œéå† ViewTree ï¼Œè·å– TextView åŠå…¶å­ç±»ï¼Œæ‰¹é‡ä¿®æ”¹å®ƒä»¬çš„å­—ä½“ï¼Œä»è€Œè¾¾åˆ°å…¨å±€æ›¿æ¢å­—ä½“çš„æ•ˆæœã€‚</strong></p><p>ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-comment">//å…¨å±€æ›¿æ¢å­—ä½“å·¥å…·ç±»</span><br><span class="hljs-keyword">object</span> ChangeDefaultFontUtils &#123;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">const</span> <span class="hljs-keyword">val</span> NOTO_SANS_BOLD = R.font.noto_sans_bold<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * æ–¹å¼ä¸€: éå†å¸ƒå±€çš„ ViewTree, æ‰¾åˆ° TextView åŠå…¶å­ç±»è¿›è¡Œæ‰¹é‡æ›¿æ¢</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> mContext ä¸Šä¸‹æ–‡</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> rootView æ ¹View</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">changeDefaultFont</span><span class="hljs-params">(mContext: <span class="hljs-type">Context</span>?, rootView: <span class="hljs-type">View</span>?)</span></span>&#123;<br>        <span class="hljs-keyword">when</span>(rootView)&#123;<br>            <span class="hljs-keyword">is</span> ViewGroup -&gt; &#123;<br>                rootView.forEach &#123;<br>                    changeDefaultFont(mContext,it)<br>                &#125;<br>            &#125;<br>            <span class="hljs-keyword">is</span> TextView -&gt; &#123;<br>                <span class="hljs-keyword">try</span> &#123;<br>                    <span class="hljs-keyword">val</span> typeface = ResourcesCompat.getFont(mContext!!, NOTO_SANS_BOLD)<br>                    <span class="hljs-keyword">val</span> fontStyle = rootView.typeface?.style ?: Typeface.NORMAL<br>                    rootView.setTypeface(typeface,fontStyle)<br>                &#125; <span class="hljs-keyword">catch</span> (e: Exception) &#123;<br>                    e.printStackTrace()<br>                &#125;<br>            &#125;<br>        &#125;<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">//Activity åŸºç±»</span><br><span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">BaseActivity</span>: <span class="hljs-type">AppCompatActivity</span>()&#123;<br><br>    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onCreate</span><span class="hljs-params">(savedInstanceState: <span class="hljs-type">Bundle</span>?)</span></span> &#123;<br>        <span class="hljs-keyword">super</span>.onCreate(savedInstanceState)<br>        <span class="hljs-keyword">val</span> mRootView = LayoutInflater.from(<span class="hljs-keyword">this</span>).inflate(getLayoutId(), <span class="hljs-literal">null</span>)<br>        setContentView(mRootView)<br>        ChangeDefaultFontUtils.changeDefaultFont(<span class="hljs-keyword">this</span>,mRootView)<br>        initView()<br>    &#125;<br><br>    <span class="hljs-comment">/**è·å–å¸ƒå±€Id*/</span><br>    <span class="hljs-keyword">abstract</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">getLayoutId</span><span class="hljs-params">()</span></span>: <span class="hljs-built_in">Int</span><br><br>    <span class="hljs-comment">/**åˆå§‹åŒ–*/</span><br>    <span class="hljs-keyword">abstract</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">initView</span><span class="hljs-params">()</span></span><br>&#125;<br><br><span class="hljs-comment">//MainActivity</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">MainActivity</span> : <span class="hljs-type">BaseActivity</span>() &#123;<br><br>    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">getLayoutId</span><span class="hljs-params">()</span></span>: <span class="hljs-built_in">Int</span> &#123;<br>        <span class="hljs-keyword">return</span> R.layout.activity_main<br>    &#125;<br><br>    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">initView</span><span class="hljs-params">()</span></span> &#123;<br><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ä¸Šè¿°ä»£ç ï¼š</p><p>1ã€åˆ›å»ºäº†ä¸€ä¸ªå…¨å±€æ›¿æ¢å­—ä½“çš„å·¥å…·ç±»ï¼Œä¸»è¦é€»è¾‘ï¼š</p><p>åˆ¤æ–­å½“å‰ rootView æ˜¯å¦æ˜¯ä¸€ä¸ª ViewGroupï¼Œå¦‚æœæ˜¯ï¼Œéå†å–å‡ºå…¶æ‰€æœ‰çš„å­ Viewï¼Œç„¶åé€’å½’è°ƒç”¨ changeDefaultFont æ–¹æ³•ã€‚å†åˆ¤æ–­æ˜¯å¦æ˜¯ TextView æˆ–å…¶å­ç±»ï¼Œå¦‚æœæ˜¯å°±æ›¿æ¢å­—ä½“</p><p>2ã€åˆ›å»ºäº†ä¸€ä¸ª Activity åŸºç±»ï¼Œå¹¶åœ¨å…¶ä¸­å†™å…¥å­—ä½“æ›¿æ¢çš„é€»è¾‘</p><p>3ã€æœ€åè®©ä¸Šå±‚ Activity ç»§æ‰¿åŸºç±» Activity</p><p>é€»è¾‘å¾ˆç®€å•ï¼Œåœ¨çœ‹ä¸‹æˆ‘ä»¬ç¼–å†™çš„ Xml çš„ä¸€ä¸ªæ•ˆæœï¼š</p><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/92b45198f4a6491f9be4eeb275ac4461~tplv-k3u1fbpfcp-zoom-1.image" alt="image-20210616144417422"></p><p>æ¥ä¸‹æ¥æˆ‘ä»¬è¿è¡Œçœ‹ä¸‹å®é™…æ›¿æ¢åçš„ä¸€ä¸ªæ•ˆæœï¼š</p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/7879ac4a76214c1bad6841f20cd0bf04~tplv-k3u1fbpfcp-zoom-1.image" alt="image-20210616144927196" style="zoom:50%;" /><p>å¯ä»¥çœ‹åˆ°ï¼Œå­—ä½“è¢«æ›¿æ¢äº†ã€‚</p><p>ç°åœ¨æˆ‘ä»¬æ¥è®¨è®ºä¸€ä¸‹è¿™ç§æ–¹å¼çš„ä¼˜ç¼ºç‚¹ï¼š</p><p><strong>ä¼˜ç‚¹</strong>ï¼šæˆ‘ä»¬ä¸éœ€è¦ä¿®æ”¹ Xml å¸ƒå±€ï¼Œä¸éœ€è¦é‡å†™å¤šä¸ªæ§ä»¶ï¼Œåªéœ€è¦åœ¨ <strong>inflate View</strong> ä¹‹åè°ƒä¸€ä¸‹å°±å¯ä»¥äº†</p><p><strong>ç¼ºç‚¹</strong>ï¼šä¸éš¾å‘ç°è¿™ç§æ–¹å¼ä¼šéå† Xml æ–‡ä»¶ä¸­çš„æ‰€æœ‰ View å’Œ ViewGroupï¼Œä½†æ˜¯å¦‚æœå‡ºç° RecyclerView , ListViewï¼Œæˆ–è€…å…¶ä»– ViewGroup é‡Œé¢åŠ¨æ€æ·»åŠ  Viewï¼Œé‚£ä¹ˆæˆ‘ä»¬è¿˜æ˜¯éœ€è¦å»æ‰‹åŠ¨æ·»åŠ æ›¿æ¢çš„é€»è¾‘ï¼Œå¦åˆ™å­—ä½“ä¸ä¼šç”Ÿæ•ˆã€‚è€Œä¸”å®ƒæ¯æ¬¡é€’å½’éå† ViewTreeï¼Œæ€§èƒ½ä¸Šå¤šå°‘ä¼šæœ‰ç‚¹å½±å“</p><p>æ¥ä¸‹æ¥æˆ‘ä»¬çœ‹ç¬¬äºŒç§æ–¹å¼</p><h2 id="äºŒã€æ–¹å¼äºŒï¼šé€šè¿‡-LayoutInflaterï¼Œå…¨å±€æ›¿æ¢å­—ä½“"><a href="#äºŒã€æ–¹å¼äºŒï¼šé€šè¿‡-LayoutInflaterï¼Œå…¨å±€æ›¿æ¢å­—ä½“" class="headerlink" title="äºŒã€æ–¹å¼äºŒï¼šé€šè¿‡ LayoutInflaterï¼Œå…¨å±€æ›¿æ¢å­—ä½“"></a>äºŒã€æ–¹å¼äºŒï¼šé€šè¿‡ LayoutInflaterï¼Œå…¨å±€æ›¿æ¢å­—ä½“</h2><p>è®²è¿™ç§æ–¹å¼å‰ï¼Œæˆ‘ä»¬é¦–å…ˆè¦å¯¹ LayoutInflater çš„ inflate è¿‡ç¨‹æœ‰ä¸€å®šçš„äº†è§£ï¼Œä»¥ AppCompatActivity çš„ setContentView ä¸ºä¾‹å¤§è‡´è¯´ä¸‹æµç¨‹ï¼š</p><p><strong>æˆ‘ä»¬åœ¨ Activity çš„ setContentView ä¸­ä¼ å…¥ä¸€ä¸ªå¸ƒå±€ Xmlï¼ŒActivity ä¼šé€šè¿‡ä»£ç†ç±» AppCompatDelegateImpl æŠŠå®ƒäº¤ç”± LayoutInflater è¿›è¡Œè§£æï¼Œè§£æå‡ºæ¥åï¼Œä¼šäº¤ç”±è‡ªå·±çš„ 3 ä¸ªå·¥å‚å»åˆ›å»º Viewï¼Œä¼˜å…ˆçº§åˆ†åˆ«æ˜¯mFactory2ã€mFactoryã€mPrivateFactory</strong></p><p>æµç¨‹å¤§æ¦‚å°±è¯´åˆ°è¿™é‡Œï¼Œå…·ä½“è¿‡ç¨‹æˆ‘åç»­ä¼šå†™ä¸€ç¯‡æ–‡ç« ä¸“é—¨å»è®²ã€‚</p><p>mFactory2ã€mFactory ï¼Œç³»ç»Ÿæä¾›äº†å¼€æ”¾çš„ Api ç»™æˆ‘ä»¬å»è®¾ç½®ï¼Œå¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//ä»¥ä¸‹ä¸¤ä¸ªæ–¹æ³•åœ¨ LayoutInflaterCompat.java æ–‡ä»¶ä¸­</span><br><span class="hljs-meta">@Deprecated</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setFactory</span><span class="hljs-params">(<span class="hljs-meta">@NonNull</span> LayoutInflater inflater, <span class="hljs-meta">@NonNull</span> LayoutInflaterFactory factory)</span> &#123;<br>    <span class="hljs-keyword">if</span> (Build.VERSION.SDK_INT &gt;= <span class="hljs-number">21</span>) &#123;<br>        inflater.setFactory2(factory != <span class="hljs-literal">null</span> ? <span class="hljs-keyword">new</span> <span class="hljs-title class_">Factory2Wrapper</span>(factory) : <span class="hljs-literal">null</span>);<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-keyword">final</span> LayoutInflater.<span class="hljs-type">Factory2</span> <span class="hljs-variable">factory2</span> <span class="hljs-operator">=</span> factory != <span class="hljs-literal">null</span><br>                ? <span class="hljs-keyword">new</span> <span class="hljs-title class_">Factory2Wrapper</span>(factory) : <span class="hljs-literal">null</span>;<br>        inflater.setFactory2(factory2);<br><br>        <span class="hljs-keyword">final</span> LayoutInflater.<span class="hljs-type">Factory</span> <span class="hljs-variable">f</span> <span class="hljs-operator">=</span> inflater.getFactory();<br>        <span class="hljs-keyword">if</span> (f <span class="hljs-keyword">instanceof</span> LayoutInflater.Factory2) &#123;<br>            forceSetFactory2(inflater, (LayoutInflater.Factory2) f);<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            forceSetFactory2(inflater, factory2);<br>        &#125;<br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setFactory2</span><span class="hljs-params">(<span class="hljs-meta">@NonNull</span> LayoutInflater inflater, <span class="hljs-meta">@NonNull</span> LayoutInflater.Factory2 factory)</span> &#123;<br>    inflater.setFactory2(factory);<br>  <br>    <span class="hljs-keyword">if</span> (Build.VERSION.SDK_INT &lt; <span class="hljs-number">21</span>) &#123;<br>        <span class="hljs-keyword">final</span> LayoutInflater.<span class="hljs-type">Factory</span> <span class="hljs-variable">f</span> <span class="hljs-operator">=</span> inflater.getFactory();<br>        <span class="hljs-keyword">if</span> (f <span class="hljs-keyword">instanceof</span> LayoutInflater.Factory2) &#123;<br>            forceSetFactory2(inflater, (LayoutInflater.Factory2) f);<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            forceSetFactory2(inflater, factory);<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™ä¸¤ä¸ªæ–¹æ³•åœ¨ LayoutInflaterCompat è¿™ä¸ªç±»ä¸­ï¼ŒLayoutInflaterCompat æ˜¯ LayoutInflater ä¸€ä¸ªè¾…åŠ©ç±»ï¼Œå¯ä»¥çœ‹åˆ°ï¼š</p><p>1ã€setFactory æ–¹æ³•ä½¿ç”¨äº† @Deprecated æ³¨è§£è¡¨ç¤ºè¿™ä¸ª Api è¢«å¼ƒç”¨</p><p>2ã€setFactory2 æ˜¯ Android 3.0 å¼•å…¥çš„ï¼Œå®ƒå’Œ setFactory åŠŸèƒ½æ˜¯ä¸€è‡´çš„ï¼ŒåŒºåˆ«å°±åœ¨äºä¼ å…¥çš„æ¥å£å‚æ•°ä¸ä¸€æ ·ï¼ŒsetFactory2 çš„æ¥å£å‚æ•°è¦å¤šå®ç°ä¸€ä¸ªæ–¹æ³•</p><p>åˆ©ç”¨ setFactory ç³»åˆ—æ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥ï¼š</p><p><strong>1ï¼‰ã€æ‹¿åˆ° LayoutInflater inflate è¿‡ç¨‹ä¸­ Xml æ§ä»¶å¯¹åº”çš„åç§°å’Œå±æ€§</strong></p><p><strong>2ï¼‰ã€æˆ‘ä»¬å¯ä»¥å¯¹æ§ä»¶è¿›è¡Œæ›¿æ¢æˆ–è€…åšç›¸å…³çš„é€»è¾‘å¤„ç†</strong></p><p>çœ‹ä¸ªå®é™…ä¾‹å­ï¼šè¿˜æ˜¯æ–¹å¼ä¸€çš„ä»£ç ï¼Œæˆ‘ä»¬åœ¨ BaseActivity ä¸­å¢åŠ å¦‚ä¸‹ä»£ç ï¼š</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-comment">//Activity åŸºç±»</span><br><span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">BaseActivity</span>: <span class="hljs-type">AppCompatActivity</span>()&#123;<br><br>   <span class="hljs-comment">//æ–°å¢éƒ¨åˆ†</span><br>   <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> TAG: String? = javaClass.simpleName<br>  <br>    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onCreate</span><span class="hljs-params">(savedInstanceState: <span class="hljs-type">Bundle</span>?)</span></span> &#123;<br>      <span class="hljs-comment">//...</span><br>      <span class="hljs-comment">//æ–°å¢éƒ¨åˆ†ï¼Œå…¶ä½™ä»£ç çœç•¥</span><br>      LayoutInflaterCompat.setFactory2(layoutInflater,<span class="hljs-keyword">object</span> : LayoutInflater.Factory2&#123;<br>            <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onCreateView</span><span class="hljs-params">(parent: <span class="hljs-type">View</span>?, name: <span class="hljs-type">String</span>, context: <span class="hljs-type">Context</span>, attrs: <span class="hljs-type">AttributeSet</span></span></span><br><span class="hljs-params"><span class="hljs-function">            )</span></span>: View? &#123;<br>                Log.d(TAG, <span class="hljs-string">&quot;name: <span class="hljs-variable">$name</span>&quot;</span> )<br>                <span class="hljs-keyword">for</span> (i <span class="hljs-keyword">in</span> <span class="hljs-number">0</span> until attrs.attributeCount)&#123;<br>                    Log.d(TAG, <span class="hljs-string">&quot;attr: <span class="hljs-subst">$&#123;attrs.getAttributeName(i)&#125;</span> <span class="hljs-subst">$&#123;attrs.getAttributeValue(i)&#125;</span>&quot;</span>)<br>                &#125;<br>              <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span><br>            &#125;<br><br>            <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onCreateView</span><span class="hljs-params">(name: <span class="hljs-type">String</span>, context: <span class="hljs-type">Context</span>, attrs: <span class="hljs-type">AttributeSet</span>)</span></span>: View? &#123;<br>                <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span><br>            &#125;<br><br>        &#125;)<br>        <span class="hljs-keyword">super</span>.onCreate(savedInstanceState)<br>       <span class="hljs-comment">//...</span><br>    &#125;<br><br>    <span class="hljs-comment">//...</span><br>&#125;<br></code></pre></td></tr></table></figure><p><strong>æ³¨æ„</strong>ï¼šä¸Šé¢ LayoutInflaterCompat.setFactory2 æ–¹æ³•å¿…é¡»æ”¾åœ¨ super.onCreate(savedInstanceState) çš„å‰é¢ï¼Œä¸ç„¶ä¼šæŠ¥é”™ï¼Œå› ä¸ºç³»ç»Ÿä¼šåœ¨ AppCompatActivity çš„ oncreate æ–¹æ³•ç»™ LayoutInflater è®¾ç½®ä¸€ä¸ª Factoryï¼Œè€Œå¦‚æœåœ¨å·²ç»è®¾ç½®çš„æƒ…å†µä¸‹å†å»è®¾ç½®ï¼ŒLayoutInflater çš„ setFactory ç³»åˆ—æ–¹æ³•å°±ä¼šæŠ›å¼‚å¸¸ï¼Œæºç å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//AppCompatActivity çš„ oncreate</span><br><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onCreate</span><span class="hljs-params">(<span class="hljs-meta">@Nullable</span> Bundle savedInstanceState)</span> &#123;<br>    <span class="hljs-keyword">final</span> <span class="hljs-type">AppCompatDelegate</span> <span class="hljs-variable">delegate</span> <span class="hljs-operator">=</span> getDelegate();<br>    <span class="hljs-comment">//è°ƒç”¨ AppCompatDelegateImpl çš„ installViewFactory è®¾ç½® Factory</span><br>    delegate.installViewFactory();<br>    <span class="hljs-comment">//...</span><br>&#125;<br><br><span class="hljs-comment">//AppCompatDelegateImpl çš„ installViewFactory</span><br><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">installViewFactory</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-type">LayoutInflater</span> <span class="hljs-variable">layoutInflater</span> <span class="hljs-operator">=</span> LayoutInflater.from(mContext);<br>    <span class="hljs-keyword">if</span> (layoutInflater.getFactory() == <span class="hljs-literal">null</span>) &#123;<br>      <span class="hljs-comment">//å¦‚æœå½“å‰ LayoutInflater çš„ Factory ä¸ºç©ºï¼Œåˆ™è¿›è¡Œè®¾ç½®</span><br>        LayoutInflaterCompat.setFactory2(layoutInflater, <span class="hljs-built_in">this</span>);<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>      <span class="hljs-comment">//å¦‚æœä¸ä¸ºç©ºï¼Œåˆ™è¿›è¡Œ Log æ—¥å¿—æ‰“å°</span><br>        <span class="hljs-keyword">if</span> (!(layoutInflater.getFactory2() <span class="hljs-keyword">instanceof</span> AppCompatDelegateImpl)) &#123;<br>            Log.i(TAG, <span class="hljs-string">&quot;The Activity&#x27;s LayoutInflater already has a Factory installed&quot;</span><br>                    + <span class="hljs-string">&quot; so we can not install AppCompat&#x27;s&quot;</span>);<br>        &#125;<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">//LayoutInflater çš„ setFactory2</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setFactory2</span><span class="hljs-params">(Factory2 factory)</span> &#123;<br>    <span class="hljs-comment">//å¦‚æœå·²ç»è®¾ç½®ï¼Œåˆ™æŠ›å¼‚å¸¸</span><br>    <span class="hljs-keyword">if</span> (mFactorySet) &#123;<br>        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalStateException</span>(<span class="hljs-string">&quot;A factory has already been set on this LayoutInflater&quot;</span>);<br>    &#125;<br>    <span class="hljs-keyword">if</span> (factory == <span class="hljs-literal">null</span>) &#123;<br>        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">NullPointerException</span>(<span class="hljs-string">&quot;Given factory can not be null&quot;</span>);<br>    &#125;<br>    mFactorySet = <span class="hljs-literal">true</span>;<br>    <span class="hljs-comment">//...</span><br>&#125;<br></code></pre></td></tr></table></figure><p><strong>æ³¨æ„</strong>ï¼šä¸Šé¢ AppCompatActivity ä¸­è®¾ç½® Factory æ˜¯ android.appcompat  1.1.0 ç‰ˆæœ¬ï¼Œè€Œå¦‚æœæ˜¯æ›´é«˜çš„ç‰ˆæœ¬ï¼Œå¦‚ 1.3.0ï¼Œå¯èƒ½è®¾ç½®çš„åœ°æ–¹ä¼šæœ‰ç‚¹å˜åŒ–ï¼Œä½†æ˜¯ä¸å½±å“æˆ‘ä»¬è®¾ç½®ä½ç½®çš„å˜åŒ–ï¼Œæ„Ÿå…´è¶£çš„å¯ä»¥å»çœ‹ä¸‹æºç ï¼Œè¿™é‡Œä½ åªè¦çŸ¥é“æˆ‘ä»¬å¿…é¡»åœ¨ Activity çš„ super.onCreate(savedInstanceState) ä¹‹å‰è®¾ç½® Factory å°±å¯ä»¥äº†</p><p>è¿è¡Œåº”ç”¨ç¨‹åºï¼Œçœ‹ä¸‹å‡ ä¸ªä¸»è¦æ§ä»¶çš„æˆªå›¾æ‰“å°ä¿¡æ¯ï¼š</p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/d11def9507f94b05bfd95556137142ee~tplv-k3u1fbpfcp-zoom-1.image" alt="image-20210616150016885" style="zoom:50%;" /><p>ä» Log è¾“å‡ºå¯ä»¥çœ‹å‡ºï¼Œä½ æ‰€æœ‰çš„ Xml æ§ä»¶ï¼Œéƒ½ä¼šç»è¿‡ LayoutInflaterFactory.onCreateView æ–¹æ³•èµ°ä¸€éå»å®ç°åˆå§‹åŒ–çš„è¿‡ç¨‹ï¼Œåœ¨å…¶ä¸­å¯ä»¥æœ‰æ•ˆçš„åˆ†è¾¨å‡ºæ˜¯ä»€ä¹ˆæ§ä»¶ï¼Œä»¥åŠå®ƒæœ‰ä»€ä¹ˆå±æ€§ã€‚å¹¶ä¸” onCreateView æ–¹æ³•çš„è¿”å›å€¼å°±æ˜¯ä¸€ä¸ª Viewï¼Œå› æ­¤æˆ‘ä»¬åœ¨æ­¤å¤„å¯ä»¥å¯¹æ§ä»¶è¿›è¡Œæ›¿æ¢æˆ–è€…åšç›¸å…³çš„é€»è¾‘å¤„ç†</p><p>åˆ°è¿™é‡Œï¼Œä½ æ˜¯å¦æœ‰äº†å…¨ä½“æ›¿æ¢å­—ä½“çš„æ€è·¯äº†å‘¢ï¼Ÿ</p><p>ç­”æ¡ˆå·²ç»å¾ˆæ˜äº†ï¼š<strong>åˆ©ç”¨è‡ªå®šä¹‰çš„ Factory è¿›è¡Œå­—ä½“çš„æ›¿æ¢</strong></p><p>è¿™ç§æ–¹å¼æˆ‘ä»¬åªéœ€è¦åœ¨ BaseActivity é‡Œé¢æ“ä½œå°±å¯ä»¥äº†ï¼Œè€Œä¸”æœ‰æ•ˆçš„è§£å†³äº†æ–¹å¼ä¸€å¸¦æ¥çš„é—®é¢˜ï¼Œæé«˜äº†æ•ˆç‡ï¼Œå¦‚ä¸‹ï¼š</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">BaseActivity</span>: <span class="hljs-type">AppCompatActivity</span>()&#123;<br><br>    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onCreate</span><span class="hljs-params">(savedInstanceState: <span class="hljs-type">Bundle</span>?)</span></span> &#123;<br>        LayoutInflaterCompat.setFactory2(layoutInflater,<span class="hljs-keyword">object</span> : LayoutInflater.Factory2&#123;<br>            <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onCreateView</span><span class="hljs-params">(parent: <span class="hljs-type">View</span>?, name: <span class="hljs-type">String</span>, context: <span class="hljs-type">Context</span>, attrs: <span class="hljs-type">AttributeSet</span></span></span><br><span class="hljs-params"><span class="hljs-function">            )</span></span>: View? &#123;<br>                <span class="hljs-keyword">var</span> view: View? = <span class="hljs-literal">null</span><br>                <span class="hljs-keyword">if</span>(<span class="hljs-number">1</span> == name.indexOf(<span class="hljs-string">&quot;.&quot;</span>))&#123;<br>                    <span class="hljs-comment">//è¡¨ç¤ºè‡ªå®šä¹‰ View</span><br>                    <span class="hljs-comment">//é€šè¿‡åå°„åˆ›å»º</span><br>                    view = layoutInflater.createView(name,<span class="hljs-literal">null</span>,attrs)<br>                &#125;<br><br>                <span class="hljs-keyword">if</span>(view == <span class="hljs-literal">null</span>)&#123;<br>                    <span class="hljs-comment">//é€šè¿‡ç³»ç»Ÿåˆ›å»ºä¸€ç³»åˆ— appcompat çš„ View</span><br>                    view = delegate.createView(parent, name, context, attrs)<br>                &#125;<br><br>                <span class="hljs-keyword">if</span>(view <span class="hljs-keyword">is</span> TextView)&#123;<br>                    <span class="hljs-comment">//å¦‚æœæ˜¯ TextView æˆ–å…¶å­ç±»ï¼Œåˆ™è¿›è¡Œå­—ä½“çš„æ›¿æ¢</span><br>                    ChangeDefaultFontUtils.changeDefaultFont(<span class="hljs-keyword">this</span><span class="hljs-symbol">@BaseActivity</span>,view)<br>                &#125;<br><br>                <span class="hljs-keyword">return</span> view<br>            &#125;<br><br>            <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onCreateView</span><span class="hljs-params">(name: <span class="hljs-type">String</span>, context: <span class="hljs-type">Context</span>, attrs: <span class="hljs-type">AttributeSet</span>)</span></span>: View? &#123;<br>                <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span><br>            &#125;<br><br>        &#125;)<br>        <span class="hljs-keyword">super</span>.onCreate(savedInstanceState)<br>        setContentView(getLayoutId())<br>        initView()<br>    &#125;<br><br>    <span class="hljs-comment">/**è·å–å¸ƒå±€Id*/</span><br>    <span class="hljs-keyword">abstract</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">getLayoutId</span><span class="hljs-params">()</span></span>: <span class="hljs-built_in">Int</span><br><br>    <span class="hljs-comment">/**åˆå§‹åŒ–*/</span><br>    <span class="hljs-keyword">abstract</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">initView</span><span class="hljs-params">()</span></span><br>&#125;<br></code></pre></td></tr></table></figure><p>ä¸Šè¿°ä»£ç æˆ‘ä»¬åšäº†ï¼š</p><p>1ã€åˆ¤æ–­æ˜¯è‡ªå®šä¹‰ View ï¼Œé€šè¿‡åå°„åˆ›å»º</p><p>2ã€åˆ¤æ–­æ˜¯ç³»ç»Ÿæä¾›çš„ä¸€äº›æ§ä»¶ï¼Œä½¿ç”¨ appcompat ç³»åˆ— View è¿›è¡Œæ›¿æ¢</p><p>3ã€åˆ¤æ–­æ˜¯ TextView æˆ–å…¶å­ç±»ï¼Œè¿›è¡Œå­—ä½“çš„æ›¿æ¢</p><p>è¿è¡Œåº”ç”¨ç¨‹åºï¼Œæœ€ç»ˆå®ç°äº†å’Œæ–¹å¼ä¸€ä¸€æ ·çš„æ•ˆæœï¼š</p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/0f36137458d145c3a1847624f1db2c4b~tplv-k3u1fbpfcp-zoom-1.image" alt="image-20210616144927196" style="zoom:50%;" /><h2 id="ä¸‰ã€æ–¹å¼ä¸‰ï¼šé€šè¿‡é…ç½®åº”ç”¨ä¸»é¢˜ï¼Œå…¨å±€æ›¿æ¢é»˜è®¤å­—ä½“"><a href="#ä¸‰ã€æ–¹å¼ä¸‰ï¼šé€šè¿‡é…ç½®åº”ç”¨ä¸»é¢˜ï¼Œå…¨å±€æ›¿æ¢é»˜è®¤å­—ä½“" class="headerlink" title="ä¸‰ã€æ–¹å¼ä¸‰ï¼šé€šè¿‡é…ç½®åº”ç”¨ä¸»é¢˜ï¼Œå…¨å±€æ›¿æ¢é»˜è®¤å­—ä½“"></a>ä¸‰ã€æ–¹å¼ä¸‰ï¼šé€šè¿‡é…ç½®åº”ç”¨ä¸»é¢˜ï¼Œå…¨å±€æ›¿æ¢é»˜è®¤å­—ä½“</h2><p>è¿™ç§æ–¹å¼æŒºç®€å•çš„ï¼Œåœ¨ application ä¸­ï¼Œé€šè¿‡ android:theme æ¥é…ç½®ä¸€ä¸ª App çš„ä¸»é¢˜ã€‚ä¸€èˆ¬æ–°åˆ›å»ºçš„é¡¹ç›®ï¼Œéƒ½æ˜¯ä¼šæœ‰ä¸€ä¸ªé»˜è®¤åŸºç¡€ä¸»é¢˜ã€‚åœ¨å…¶ä¸­è¿½åŠ å…³äºå­—ä½“çš„å±æ€§ï¼Œå°±å¯ä»¥å®Œæˆå…¨å±€é»˜è®¤å­—ä½“çš„æ›¿æ¢ï¼Œåœ¨ä¸»é¢˜ä¸­æˆ‘ä»¬å¯ä»¥å¯¹ä»¥ä¸‹ä¸‰ä¸ªå±æ€§è¿›è¡Œé…ç½®ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">item</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;android:typeface&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">item</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">item</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;android:fontFamily&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">item</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">item</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;android:textStyle&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">item</span>&gt;</span><br></code></pre></td></tr></table></figure><p>è¿™ä¸‰è€…çš„è®¾ç½®å’Œå…³ç³»æˆ‘ä»¬åœ¨æœ¬ç³»åˆ—çš„ç¬¬ä¸€ç¯‡æ–‡ç« ä¸­å·²ç»è®²è¿‡ï¼Œè¿˜ä¸æ¸…æ¥šçš„å¯ä»¥å»çœ‹ä¸‹ <a href="https://juejin.cn/post/6973064546420260878#heading-5">ä¼ é€é—¨</a></p><p>å…³äº Xml ä¸­ä½¿ç”¨å­—ä½“çš„åŠŸèƒ½ï¼Œæˆ‘ä»¬ä¸Šç¯‡æ–‡ç« ä¹Ÿå·²ç»è®²è¿‡ï¼Œè¿˜ä¸æ¸…æ¥šçš„å¯ä»¥å»çœ‹ä¸‹ <a href="https://juejin.cn/post/6974388756275019812">ä¼ é€é—¨</a></p><p>å› ä¸ºæˆ‘ä»¬åªéœ€è¦é…ç½®é»˜è®¤å­—ä½“ï¼Œæ‰€ä»¥æ–°å¢ä¸€è¡Œå¦‚ä¸‹é…ç½®ï¼Œå°±å¯ä»¥å®ç°å…¨å±€æ›¿æ¢é»˜è®¤å­—ä½“çš„æ•ˆæœäº†ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">style</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;Theme.ChangeDefaultFontDemo&quot;</span> <span class="hljs-attr">parent</span>=<span class="hljs-string">&quot;Theme.MaterialComponents.DayNight.DarkActionBar.Bridge&quot;</span>&gt;</span><span class="language-xml"></span><br><span class="language-xml">//...</span><br><span class="language-xml">  <span class="hljs-tag">&lt;<span class="hljs-name">item</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;android:fontFamily&quot;</span>&gt;</span>@font/noto_sans_bold<span class="hljs-tag">&lt;/<span class="hljs-name">item</span>&gt;</span></span><br><span class="language-xml">  //...</span><br><span class="language-xml"></span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span><br></code></pre></td></tr></table></figure><p>é‚£ä¹ˆå‡¡äº‹éƒ½æœ‰æ„å¤–ï¼Œå‡å¦‚ä½ çš„ Activity å¼•ç”¨äº†è‡ªå®šä¹‰ä¸»é¢˜ï¼Œä¸”è‡ªå®šä¹‰ä¸»é¢˜æ²¡æœ‰ç»§æ‰¿åŸºç¡€ä¸»é¢˜ï¼Œé‚£ä¹ˆä½ å°±éœ€è¦è¡¥ä¸Šè¿™ä¸€è¡Œé…ç½®ï¼Œä¸ç„¶é…ç½®çš„é»˜è®¤å­—ä½“ä¸ä¼šç”Ÿæ•ˆ</p><h2 id="å››ã€æ–¹å¼å››ï¼šé€šè¿‡åå°„ï¼Œå…¨å±€æ›¿æ¢é»˜è®¤å­—ä½“"><a href="#å››ã€æ–¹å¼å››ï¼šé€šè¿‡åå°„ï¼Œå…¨å±€æ›¿æ¢é»˜è®¤å­—ä½“" class="headerlink" title="å››ã€æ–¹å¼å››ï¼šé€šè¿‡åå°„ï¼Œå…¨å±€æ›¿æ¢é»˜è®¤å­—ä½“"></a>å››ã€æ–¹å¼å››ï¼šé€šè¿‡åå°„ï¼Œå…¨å±€æ›¿æ¢é»˜è®¤å­—ä½“</h2><p>é€šè¿‡åå°„ä¿®æ”¹ï¼Œå…¶å®å’Œæ–¹å¼ä¸‰æœ‰ç‚¹ç±»ä¼¼ã€‚å› ä¸ºåœ¨  Android Support Library 26 ä¹‹å‰ï¼Œæˆ‘ä»¬ä¸èƒ½ç›´æ¥åœ¨ Xml ä¸­è®¾ç½®ç¬¬ä¸‰æ–¹å­—ä½“ï¼Œè€Œåªèƒ½è®¾ç½®ç³»ç»Ÿæä¾›çš„ä¸€äº›é»˜è®¤å­—ä½“ï¼Œæ‰€ä»¥é€šè¿‡åå°„è¿™ç§æ–¹å¼ï¼Œå¯ä»¥æŠŠç³»ç»Ÿé»˜è®¤çš„å­—ä½“æ›¿æ¢ä¸ºç¬¬ä¸‰æ–¹çš„å­—ä½“ã€‚è€Œç°åœ¨æˆ‘ä»¬ä½¿ç”¨çš„ç‰ˆæœ¬åŸºæœ¬ä¸Šéƒ½ä¼šå¤§äºç­‰äº 26ï¼Œå› æ­¤é€šè¿‡é…ç½®åº”ç”¨ä¸»é¢˜çš„æ–¹å¼å°±å¯ä»¥å®ç°å…¨å±€æ›¿æ¢é»˜è®¤å­—ä½“çš„æ•ˆæœã€‚ä½†æ˜¯è¿™é‡Œå¹¶ä¸å¦¨ç¢æˆ‘ä»¬è®²åå°„ä¿®æ”¹é»˜è®¤å­—ä½“ã€‚</p><h3 id="1ã€æ­¥éª¤ä¸€ï¼šåœ¨-App-çš„ä¸»é¢˜é…ç½®é»˜è®¤å­—ä½“"><a href="#1ã€æ­¥éª¤ä¸€ï¼šåœ¨-App-çš„ä¸»é¢˜é…ç½®é»˜è®¤å­—ä½“" class="headerlink" title="1ã€æ­¥éª¤ä¸€ï¼šåœ¨  App çš„ä¸»é¢˜é…ç½®é»˜è®¤å­—ä½“"></a>1ã€æ­¥éª¤ä¸€ï¼šåœ¨  App çš„ä¸»é¢˜é…ç½®é»˜è®¤å­—ä½“</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">style</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;Theme.ChangeDefaultFontDemo&quot;</span> <span class="hljs-attr">parent</span>=<span class="hljs-string">&quot;Theme.MaterialComponents.DayNight.DarkActionBar.Bridge&quot;</span>&gt;</span><span class="language-xml"></span><br><span class="language-xml">//...</span><br><span class="language-xml">  <span class="hljs-tag">&lt;<span class="hljs-name">item</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;android:typeface&quot;</span>&gt;</span>serif<span class="hljs-tag">&lt;/<span class="hljs-name">item</span>&gt;</span></span><br><span class="language-xml">  //...</span><br><span class="language-xml"></span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span><br></code></pre></td></tr></table></figure><p>è¿™é‡Œéšä¾¿é€‰ä¸€ä¸ªé»˜è®¤å­—ä½“ï¼Œåç»­æˆ‘ä»¬åå°„çš„æ—¶å€™éœ€è¦æ‹¿åˆ°ä½ è¿™ä¸ªé€‰çš„é»˜è®¤å­—ä½“ï¼Œç„¶åè¿›è¡Œä¸€ä¸ªæ›¿æ¢</p><p><strong>æ³¨æ„</strong>: è¿™é‡Œå¿…é¡»é…ç½® <strong>android:typeface</strong> ï¼Œå…¶ä»–ä¸¤ä¸ªä¸è¡Œï¼Œåœ¨æœ¬ç³»åˆ—çš„ç¬¬ä¸€ç¯‡ä¸­ï¼Œå…³äº typefaceï¼ŒtextStyle å’Œ fontFamily å±æ€§ä¸‰è€…çš„å…³ç³»æˆ‘ä»¬åˆ†æè¿‡ï¼Œè¿˜ä¸æ¸…æ¥šçš„å¯ä»¥å»çœ‹çœ‹ <a href="https://juejin.cn/post/6973064546420260878#heading-5">ä¼ é€é—¨</a>ï¼š</p><p>setTypefaceFromAttrs æ–¹æ³•æ˜¯ TextView æœ€ç»ˆè®¾ç½®å­—ä½“çš„æ–¹æ³•ï¼Œ<strong>å½“ typeface å’Œ familyName éƒ½ä¸ºç©ºï¼Œåˆ™ä¼šæ ¹æ® typefaceIndex çš„å€¼å–ç›¸åº”çš„ç³»ç»Ÿé»˜è®¤å­—ä½“</strong>ã€‚å½“æˆ‘ä»¬è®¾ç½®  <strong>android:typeface</strong>  å±æ€§æ—¶ï¼Œä¼šå°†å¯¹åº”çš„å±æ€§å€¼èµ‹ç»™ typefaceIndex ï¼Œå¹¶æŠŠ familyName ç½®ä¸º nullï¼Œè€Œ typeface é»˜è®¤ä¸º nullï¼Œå› æ­¤æ»¡è¶³æ¡ä»¶</p><h3 id="2ã€é€šè¿‡åå°„ä¿®æ”¹-Typeface-é»˜è®¤å­—ä½“"><a href="#2ã€é€šè¿‡åå°„ä¿®æ”¹-Typeface-é»˜è®¤å­—ä½“" class="headerlink" title="2ã€é€šè¿‡åå°„ä¿®æ”¹ Typeface é»˜è®¤å­—ä½“"></a>2ã€é€šè¿‡åå°„ä¿®æ”¹ Typeface é»˜è®¤å­—ä½“</h3><p><strong>æ³¨æ„</strong>ï¼šGoogle åœ¨ Android 9.0 åŠä¹‹åå¯¹åå°„åšäº†é™åˆ¶ï¼Œè¢«ä½¿ç”¨ <code>@hide</code> æ ‡è®°çš„å±æ€§å’Œæ–¹æ³•é€šè¿‡åå°„æ‹¿ä¸åˆ°</p><p>åœ¨ Typeface ä¸­ï¼Œè‡ªå¸¦çš„ä¸€äº›é»˜è®¤å­—ä½“è¢«æ ‡è®°çš„æ˜¯ <strong>public static final</strong>ï¼Œå› æ­¤è¿™é‡Œæ— éœ€æ‹…å¿ƒåå°„çš„é™åˆ¶</p><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/ae1c4453f9f94bc08754628b525bd687~tplv-k3u1fbpfcp-zoom-1.image" alt="image-20210618174439624"></p><p>å› ä¸ºåœ¨ä¸Šä¸€æ­¥é…ç½®çš„ä¸»é¢˜ä¸­ï¼Œæˆ‘ä»¬è®¾ç½®çš„æ˜¯ serif ï¼Œæ‰€ä»¥è¿™é‡Œæ›¿æ¢å®ƒå°±å¥½äº†ï¼Œå®Œæ•´çš„æ–¹æ³•å°±æ˜¯é€šè¿‡åå°„æ‹¿åˆ° Typeface çš„é»˜è®¤å­—ä½“ SERIFï¼Œç„¶åä½¿ç”¨åå°„å°†å®ƒä¿®æ”¹æˆæˆ‘ä»¬éœ€è¦çš„å­—ä½“å³å¯ï¼š</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-keyword">object</span> ChangeDefaultFontUtils &#123;<br>    <span class="hljs-keyword">const</span> <span class="hljs-keyword">val</span> NOTO_SANS_BOLD = R.font.noto_sans_bold<br>    <br>    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">changeDefaultFont</span><span class="hljs-params">(mContext: <span class="hljs-type">Context</span>)</span></span> &#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-keyword">val</span> typeface = ResourcesCompat.getFont(mContext, NOTO_SANS_BOLD)<br>            <span class="hljs-keyword">val</span> defaultField = Typeface::<span class="hljs-keyword">class</span>.java.getDeclaredField(<span class="hljs-string">&quot;SERIF&quot;</span>)<br>            defaultField.isAccessible = <span class="hljs-literal">true</span><br>            defaultField[<span class="hljs-literal">null</span>] = typeface<br>        &#125; <span class="hljs-keyword">catch</span> (e: Exception) &#123;<br>            e.printStackTrace()<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="3ã€åœ¨-Application-é‡Œé¢ï¼Œè°ƒç”¨æ›¿æ¢çš„æ–¹æ³•"><a href="#3ã€åœ¨-Application-é‡Œé¢ï¼Œè°ƒç”¨æ›¿æ¢çš„æ–¹æ³•" class="headerlink" title="3ã€åœ¨ Application é‡Œé¢ï¼Œè°ƒç”¨æ›¿æ¢çš„æ–¹æ³•"></a>3ã€åœ¨ Application é‡Œé¢ï¼Œè°ƒç”¨æ›¿æ¢çš„æ–¹æ³•</h3><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyApplication</span> : <span class="hljs-type">Application</span>() &#123;<br>    <br>    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onCreate</span><span class="hljs-params">()</span></span> &#123;<br>        <span class="hljs-keyword">super</span>.onCreate()<br>        ChangeDefaultFontUtils.changeDefaultFont(<span class="hljs-keyword">this</span>)<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>é‚£ä¹ˆç»è¿‡ä¸Šé¢çš„ä¸‰ä¸ªæ­¥éª¤ï¼Œæˆ‘ä»¬åŒæ ·å¯ä»¥å®ç°å…¨å±€æ›¿æ¢é»˜è®¤å­—ä½“çš„æ•ˆæœ</p><h2 id="äº”ã€é¡¹ç›®å®è·µ"><a href="#äº”ã€é¡¹ç›®å®è·µ" class="headerlink" title="äº”ã€é¡¹ç›®å®è·µ"></a>äº”ã€é¡¹ç›®å®è·µ</h2><p>å›åˆ°æˆ‘ä»¬å‰©ä¸‹çš„éœ€æ±‚ï¼š<strong>å…¨å±€æ›¿æ¢é»˜è®¤å­—ä½“</strong></p><p>1ã€æ–¹å¼ä¸€å’Œæ–¹å¼äºŒéƒ½æ˜¯å…¨å±€æ›¿æ¢å­—ä½“ï¼Œä¼šå°†æˆ‘ä»¬ä¹‹å‰å·²ç»è®¾ç½®å¥½çš„å­—ä½“ç»™è¦†ç›–ï¼Œå› æ­¤å¹¶ä¸é€‚åˆ</p><p>2ã€æ–¹å¼ä¸‰å’Œæ–¹å¼å››éƒ½æ˜¯å…¨å±€æ›¿æ¢é»˜è®¤å­—ä½“ï¼Œæˆ‘ä»¬ä¹‹å‰å·²ç»è®¾ç½®å¥½çš„å­—ä½“ä¸ä¼šè¢«è¦†ç›–ï¼Œæ»¡è¶³æˆ‘ä»¬çš„è¦æ±‚ï¼Œä½†æ˜¯æ–¹å¼å››é€šè¿‡åå°„ï¼Œæ˜¯å› ä¸ºä¹‹å‰æˆ‘ä»¬ä¸èƒ½ç›´æ¥åœ¨ Xml é‡Œé¢è®¾ç½®ç¬¬ä¸‰æ–¹å­—ä½“ã€‚ä» Android Support Library 26 åŠä¹‹åæ”¯æŒåœ¨ Xml é‡Œé¢è®¾ç½®é»˜è®¤å­—ä½“äº†ï¼Œå› æ­¤æˆ‘åœ¨é¡¹ç›®å®è·µä¸­ï¼Œæœ€ç»ˆé€‰æ‹©äº†æ–¹å¼ä¸‰å®ç°äº†å…¨å±€æ›¿æ¢é»˜è®¤å­—ä½“çš„æ•ˆæœï¼Œéœ€æ±‚å®Œç»“ ğŸ‰</p><h2 id="å…­ã€æ€»ç»“"><a href="#å…­ã€æ€»ç»“" class="headerlink" title="å…­ã€æ€»ç»“"></a>å…­ã€æ€»ç»“</h2><p>æœ€åå›é¡¾ä¸€ä¸‹æˆ‘ä»¬è®²çš„é‡ç‚¹çŸ¥è¯†ï¼š</p><p>1ã€é€šè¿‡éå† ViewTreeï¼Œå…¨å±€æ›¿æ¢å­—ä½“ï¼Œè¿™ç§æ–¹å¼æ¯æ¬¡éƒ½éœ€è¦é€’å½’éå†ï¼Œæœ‰æ€§èƒ½é—®é¢˜</p><p>2ã€é€šè¿‡ LayoutInflater è®¾ç½®è‡ªå®šä¹‰ Factory å…¨å±€æ›¿æ¢å­—ä½“ï¼Œæ•ˆç‡é«˜</p><p>3ã€é€šè¿‡é…ç½®åº”ç”¨ä¸»é¢˜å…¨å±€æ›¿æ¢é»˜è®¤å­—ä½“ï¼Œç®€å•é«˜æ•ˆ</p><p>4ã€é€šè¿‡åå°„å…¨å±€æ›¿æ¢é»˜è®¤å­—ä½“ï¼Œç›¸å¯¹äº 3ï¼Œæ€§èƒ½ä¼šå·®ç‚¹ï¼Œä½¿ç”¨æ­¥éª¤ä¹Ÿç›¸å¯¹å¤æ‚</p><p>5ã€æˆ‘åœ¨é¡¹ç›®å®è·µè¿‡ç¨‹ä¸­çš„ä¸€ä¸ªé€‰æ‹©</p><p>å¥½äº†ï¼Œæœ¬ç³»åˆ—æ–‡ç« åˆ°è¿™é‡Œå°±ç»“æŸäº†ï¼Œå¸Œæœ›èƒ½ç»™ä½ å¸¦æ¥å¸®åŠ© ğŸ¤ </p><p><strong>æ„Ÿè°¢ä½ é˜…è¯»è¿™ç¯‡æ–‡ç« </strong></p><h3 id="å‚è€ƒå’Œæ¨è"><a href="#å‚è€ƒå’Œæ¨è" class="headerlink" title="å‚è€ƒå’Œæ¨è"></a>å‚è€ƒå’Œæ¨è</h3><p><a href="https://segmentfault.com/a/1190000011401796">å…¨å±€ä¿®æ”¹é»˜è®¤å­—ä½“ï¼Œé€šè¿‡åå°„ä¹Ÿèƒ½åšåˆ°</a></p><blockquote><p><strong>ä½ çš„ç‚¹èµï¼Œè¯„è®ºï¼Œæ˜¯å¯¹æˆ‘å·¨å¤§çš„é¼“åŠ±ï¼</strong></p><p>æ¬¢è¿å…³æ³¨æˆ‘çš„<strong>å…¬ä¼—å·ï¼š</strong>  <a href="http://m6z.cn/6jwi7b"><strong>sweetying</strong></a> ï¼Œæ–‡ç« æ›´æ–°å¯ç¬¬ä¸€æ—¶é—´æ”¶åˆ°</p><p>å¦‚æœ<strong>æœ‰é—®é¢˜</strong>ï¼Œå…¬ä¼—å·å†…æœ‰åŠ æˆ‘å¾®ä¿¡çš„å…¥å£ï¼Œåœ¨æŠ€æœ¯å­¦ä¹ ã€ä¸ªäººæˆé•¿çš„é“è·¯ä¸Šï¼Œæˆ‘ä»¬ä¸€èµ·å‰è¿›ï¼</p></blockquote>]]></content>
    
    
    <categories>
      
      <category>Android</category>
      
      <category>Font</category>
      
    </categories>
    
    
    <tags>
      
      <tag>åŸåˆ›</tag>
      
      <tag>Android</tag>
      
      <tag>Android Font</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Androidå­—ä½“ç³»åˆ— ï¼ˆä¸‰ï¼‰ï¼šXmlä¸­çš„å­—ä½“</title>
    <link href="/2022/10/11/Android%E5%AD%97%E4%BD%93%E7%B3%BB%E5%88%97%20%EF%BC%88%E4%B8%89%EF%BC%89%EF%BC%9AXml%E4%B8%AD%E7%9A%84%E5%AD%97%E4%BD%93/"/>
    <url>/2022/10/11/Android%E5%AD%97%E4%BD%93%E7%B3%BB%E5%88%97%20%EF%BC%88%E4%B8%89%EF%BC%89%EF%BC%9AXml%E4%B8%AD%E7%9A%84%E5%AD%97%E4%BD%93/</url>
    
    <content type="html"><![CDATA[<p><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/36399f41828345aeab208b30e8556362~tplv-k3u1fbpfcp-watermark.image"></p><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>å¾ˆé«˜å…´é‡è§ä½ ~</p><p>åœ¨æœ¬ç³»åˆ—çš„ä¸Šä¸€ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å¯¹ Typeface è¿›è¡Œäº†æ·±å…¥çš„è§£æï¼Œè¿˜æ²¡æœ‰çœ‹è¿‡ä¸Šä¸€ç¯‡æ–‡ç« çš„æœ‹å‹ï¼Œå»ºè®®å…ˆå»é˜…è¯» <a href="https://juejin.cn/post/6973553157326503943">Androidå­—ä½“ç³»åˆ— ï¼ˆäºŒï¼‰ï¼šTypefaceå®Œå…¨è§£æ</a>ã€‚æ¥ä¸‹æ¥æˆ‘ä»¬çœ‹ä¸‹ Google æ¨å‡ºçš„ Xml ä¸­ä½¿ç”¨å­—ä½“</p><h2 id="ä¸€ã€Xml-ä¸­å­—ä½“ä»‹ç»"><a href="#ä¸€ã€Xml-ä¸­å­—ä½“ä»‹ç»" class="headerlink" title="ä¸€ã€Xml ä¸­å­—ä½“ä»‹ç»"></a>ä¸€ã€Xml ä¸­å­—ä½“ä»‹ç»</h2><p>Google åœ¨ Android Support Library 26 å¼•å…¥äº† Xml ä¸­è®¾ç½®å­—ä½“è¿™é¡¹æ–°åŠŸèƒ½ï¼Œå®ƒå¯ä»¥è®©ä½ å°†å­—ä½“å½“æˆèµ„æºå»ä½¿ç”¨ï¼Œä½ å¯ä»¥åœ¨ res&#x2F;font&#x2F; æ–‡ä»¶å¤¹ä¸­æ·»åŠ  font æ–‡ä»¶ï¼Œå°†å­—ä½“æ†ç»‘ä¸ºèµ„æºã€‚è¿™äº›å­—ä½“ä¼šåœ¨ R æ–‡ä»¶ä¸­ç¼–è¯‘ï¼Œå¯ç›´æ¥åœ¨ Android Studio ä¸­ä½¿ç”¨ï¼Œå¦‚:</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs xml">@font/myfont <br>R.font.myfont<br></code></pre></td></tr></table></figure><p><strong>æ³¨æ„</strong>ï¼šè¦ä½¿ç”¨ Xml å­—ä½“åŠŸèƒ½ï¼Œéœ€å¼•å…¥ Android Support Library 26 åŠæ›´é«˜ç‰ˆæœ¬ä¸”è¦åœ¨ Android 4.1 åŠæ›´é«˜ç‰ˆæœ¬çš„è®¾å¤‡</p><h2 id="äºŒã€ä½¿ç”¨æ­¥éª¤"><a href="#äºŒã€ä½¿ç”¨æ­¥éª¤" class="headerlink" title="äºŒã€ä½¿ç”¨æ­¥éª¤"></a>äºŒã€ä½¿ç”¨æ­¥éª¤</h2><p>1ã€å³é”®ç‚¹å‡» <strong>res</strong> æ–‡ä»¶å¤¹ï¼Œç„¶åè½¬åˆ° <strong>New &gt; Android resource directory</strong></p><p>2ã€åœ¨ <strong>Resource type</strong> åˆ—è¡¨ä¸­ï¼Œé€‰æ‹© <strong>font</strong>ï¼Œç„¶åç‚¹å‡» <strong>OK</strong></p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/cd62460948db4b58890928b39f79f5d1~tplv-k3u1fbpfcp-zoom-1.image" alt="image-20210616203615018" style="zoom:50%;" /><p>3ã€åœ¨ <strong>font</strong> æ–‡ä»¶å¤¹ä¸­æ·»åŠ å­—ä½“æ–‡ä»¶</p><blockquote><p>å…³äºå­—ä½“ï¼Œæ¨èä¸¤ä¸ªå…è´¹ä¸‹è½½çš„ç½‘ç«™</p><p><a href="https://fonts.google.com/">https://fonts.google.com/</a></p><p><a href="https://www.1001freefonts.com/">https://www.1001freefonts.com/</a></p></blockquote><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/569d3b8d750e4d3ebf07598940d2523f~tplv-k3u1fbpfcp-zoom-1.image" alt="image-20210616203940427" style="zoom:50%;" /><p>æ·»åŠ ä¹‹åå°±ä¼šç”Ÿæˆ R.font.ma_shan_zhenng_regular å’Œ R.font.noto_sans_bold</p><p>4ã€åŒå‡»å­—ä½“æ–‡ä»¶å¯é¢„è§ˆå½“å‰å­—ä½“</p><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/5da14193f7c94277a54a15e39832c291~tplv-k3u1fbpfcp-zoom-1.image" alt="image-20210616204148155"></p><p>ä»¥ä¸Š 4 ä¸ªæ­¥éª¤å®Œæˆåæˆ‘ä»¬å°±å¯ä»¥åœ¨ Xml ä¸­ä½¿ç”¨å­—ä½“äº†</p><p>5ã€åˆ›å»º font family</p><p>1ï¼‰ã€å³é”®ç‚¹å‡» font æ–‡ä»¶å¤¹ï¼Œç„¶åè½¬åˆ° <strong>New &gt; Font resource file</strong>ã€‚æ­¤æ—¶å°†æ˜¾ç¤º <strong>New Resource File</strong> çª—å£ã€‚</p><p>2ï¼‰ã€è¾“å…¥æ–‡ä»¶åï¼Œç„¶åç‚¹å‡» <strong>OK</strong>ã€‚æ–°çš„å­—ä½“èµ„æº Xml ä¼šåœ¨ç¼–è¾‘å™¨ä¸­æ‰“å¼€ã€‚</p><p>3ï¼‰ã€å°†å„ä¸ªå­—ä½“æ–‡ä»¶ã€æ ·å¼å’Œç²—ç»†å±æ€§éƒ½å°è£…åœ¨ <code>&lt;font&gt;</code> å…ƒç´ ä¸­ã€‚å¦‚ä¸‹ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;utf-8&quot;</span>?&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">font-family</span> <span class="hljs-attr">xmlns:tools</span>=<span class="hljs-string">&quot;http://schemas.android.com/tools&quot;</span></span><br><span class="hljs-tag">    <span class="hljs-attr">xmlns:android</span>=<span class="hljs-string">&quot;http://schemas.android.com/apk/res/android&quot;</span></span><br><span class="hljs-tag">    <span class="hljs-attr">tools:ignore</span>=<span class="hljs-string">&quot;UnusedAttribute&quot;</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">font</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:fontStyle</span>=<span class="hljs-string">&quot;normal&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:fontWeight</span>=<span class="hljs-string">&quot;400&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:font</span>=<span class="hljs-string">&quot;@font/ma_shan_zheng_regular&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">tools:ignore</span>=<span class="hljs-string">&quot;UnusedAttribute&quot;</span> /&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">font</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:fontStyle</span>=<span class="hljs-string">&quot;normal&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:fontWeight</span>=<span class="hljs-string">&quot;400&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:font</span>=<span class="hljs-string">&quot;@font/noto_sans_bold&quot;</span></span><br><span class="hljs-tag">         /&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">font-family</span>&gt;</span><br></code></pre></td></tr></table></figure><p>å®è·µå‘ç°ä½¿ç”¨ font family å­˜åœ¨ä¸€äº›å‘ï¼š</p><p>1ã€ä¾‹å¦‚æˆ‘ä¸Šé¢æ·»åŠ äº†ä¸¤ä¸ª font æ ‡ç­¾ï¼Œè¿™ä¸ªæ—¶å€™åœ¨ Xml é‡Œé¢å¼•ç”¨å°†ä¸ä¼šæœ‰ä»»ä½•æ•ˆæœï¼Œè€Œä¸”è®¾ç½®çš„ fontStyle ç­‰å±æ€§ä¸ä¼šç”Ÿæ•ˆã€‚</p><p>2ã€å½“åªæ·»åŠ äº†ä¸€ä¸ª font æ ‡ç­¾ï¼Œæ­¤æ—¶å­—ä½“ä¼šç”Ÿæ•ˆï¼Œä½†æ˜¯è®¾ç½®çš„ fontStyle ç­‰å±æ€§è¿˜æ˜¯ä¸ä¼šç”Ÿæ•ˆ</p><p>å› æ­¤æˆ‘ä»¬åœ¨ä½¿ç”¨çš„æ—¶å€™å»ºè®®ç›´æ¥å¯¹å­—ä½“èµ„æºè¿›è¡Œå¼•ç”¨ï¼Œæ ·å¼ç²—ç»†è¿™äº›åœ¨è¿›è¡Œå•ç‹¬çš„è®¾ç½®</p><h2 id="ä¸‰ã€åœ¨-XML-å¸ƒå±€ä¸­ä½¿ç”¨å­—ä½“"><a href="#ä¸‰ã€åœ¨-XML-å¸ƒå±€ä¸­ä½¿ç”¨å­—ä½“" class="headerlink" title="ä¸‰ã€åœ¨ XML å¸ƒå±€ä¸­ä½¿ç”¨å­—ä½“"></a>ä¸‰ã€åœ¨ XML å¸ƒå±€ä¸­ä½¿ç”¨å­—ä½“</h2><p>ç›´æ¥åœ¨å¸ƒå±€ Xml ä¸­ä½¿ç”¨ fontFamily å±æ€§è¿›è¡Œå¼•ç”¨ï¼Œå¦‚ä¸‹å›¾ï¼š</p><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/81fe6df932464ebaa318c945c2cf8a82~tplv-k3u1fbpfcp-zoom-1.image" alt="image-20210616205129045"></p><h2 id="å››ã€åœ¨æ ·å¼ä¸­æ·»åŠ å¹¶ä½¿ç”¨å­—ä½“"><a href="#å››ã€åœ¨æ ·å¼ä¸­æ·»åŠ å¹¶ä½¿ç”¨å­—ä½“" class="headerlink" title="å››ã€åœ¨æ ·å¼ä¸­æ·»åŠ å¹¶ä½¿ç”¨å­—ä½“"></a>å››ã€åœ¨æ ·å¼ä¸­æ·»åŠ å¹¶ä½¿ç”¨å­—ä½“</h2><p>1ã€åœ¨ style.xml ä¸­æ·»åŠ æ ·å¼</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">style</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;customfontstyle&quot;</span> <span class="hljs-attr">parent</span>=<span class="hljs-string">&quot;Theme.ChangeDefaultFontDemo&quot;</span>&gt;</span><span class="language-xml"></span><br><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">item</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;android:fontFamily&quot;</span>&gt;</span>@font/noto_sans_bold<span class="hljs-tag">&lt;/<span class="hljs-name">item</span>&gt;</span></span><br><span class="language-xml"></span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span><br></code></pre></td></tr></table></figure><p>2ã€åœ¨å¸ƒå±€ Xml ä¸­ä½¿ç”¨ï¼Œå¦‚ä¸‹å›¾ï¼š</p><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/294f76797cd44994a3a753eb7327c6ae~tplv-k3u1fbpfcp-zoom-1.image" alt="image-20210616205611588"></p><h2 id="äº”ã€åœ¨ä»£ç ä¸­ä½¿ç”¨å­—ä½“"><a href="#äº”ã€åœ¨ä»£ç ä¸­ä½¿ç”¨å­—ä½“" class="headerlink" title="äº”ã€åœ¨ä»£ç ä¸­ä½¿ç”¨å­—ä½“"></a>äº”ã€åœ¨ä»£ç ä¸­ä½¿ç”¨å­—ä½“</h2><p>åœ¨ä»£ç ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ ResourcesCompat æˆ– Resource çš„ gontFont æ–¹æ³•æ‹¿åˆ° Typeface å¯¹è±¡ï¼Œç„¶åè°ƒç”¨ç›¸å…³çš„ Api å»è®¾ç½®å°±è¡Œäº†ï¼Œä¾‹å¦‚ï¼š</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-comment">//æ–¹å¼1</span><br><span class="hljs-keyword">val</span> typeface = ResourcesCompat.getFont(context, R.font.myfont)<br><span class="hljs-comment">//æ–¹å¼2</span><br><span class="hljs-keyword">val</span> typeface = resources.getFont(R.font.myfont)<br><span class="hljs-comment">//è®¾ç½®å­—ä½“</span><br>textView.typeface = typeface<br></code></pre></td></tr></table></figure><p>ä¸ºäº†æ–¹ä¾¿åœ¨ä»£ç ä¸­ä½¿ç”¨ï¼Œæˆ‘ä»¬å¯ä»¥è¿›è¡Œåˆç†çš„å°è£…ï¼š</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-keyword">object</span> FontUtil &#123;<br><br>    <span class="hljs-keyword">const</span> <span class="hljs-keyword">val</span> NOTO_SANS_BOLD = R.font.noto_sans_bold<br>    <span class="hljs-keyword">const</span> <span class="hljs-keyword">val</span> MA_SHAN_ZHENG_REGULAR = R.font.ma_shan_zheng_regular<br><br>    <span class="hljs-comment">/**ç¼“å­˜å­—ä½“ Map*/</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> cacheTypeFaceMap: HashMap&lt;<span class="hljs-built_in">Int</span>,Typeface&gt; = HashMap()<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * è®¾ç½® NotoSanUIBold å­—ä½“</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">setNotoSanUIBold</span><span class="hljs-params">(mTextView: <span class="hljs-type">TextView</span>)</span></span>&#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            mTextView.typeface = getTypeface(NOTO_SANS_BOLD)<br>        &#125; <span class="hljs-keyword">catch</span> (e: Exception) &#123;<br>            e.printStackTrace()<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * è®¾ç½® MaShanZhengRegular å­—ä½“</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">setMaShanZhengRegular</span><span class="hljs-params">(mTextView: <span class="hljs-type">TextView</span>)</span></span>&#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            mTextView.typeface = getTypeface(MA_SHAN_ZHENG_REGULAR)<br>        &#125; <span class="hljs-keyword">catch</span> (e: Exception) &#123;<br>            e.printStackTrace()<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * è·å–å­—ä½“ Typeface å¯¹è±¡</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">getTypeface</span><span class="hljs-params">(fontResName: <span class="hljs-type">Int</span>)</span></span>: Typeface? &#123;<br>        <span class="hljs-keyword">val</span> cacheTypeface = cacheTypeFaceMap[fontResName]<br>        <span class="hljs-keyword">if</span> (cacheTypeface != <span class="hljs-literal">null</span>) &#123;<br>            <span class="hljs-keyword">return</span> cacheTypeface<br>        &#125;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-keyword">val</span> typeface: Typeface? = ResourcesCompat.getFont(MyApplication.mApplication, fontResName)<br>            cacheTypeFaceMap[fontResName] = typeface!!<br>            typeface<br>        &#125; <span class="hljs-keyword">catch</span> (e: Exception) &#123;<br>            e.printStackTrace()<br>            Typeface.DEFAULT<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>é‚£ä¹ˆåç»­æˆ‘ä»¬åœ¨ä»£ç ä¸­ä½¿ç”¨å­—ä½“ï¼Œå°±åªéœ€è°ƒä¸€è¡Œä»£ç å°± Ok äº†</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs kotlin">FontUtil.setMaShanZhengRegular(mTextView1)<br>FontUtil.setNotoSanUIBold(mTextView2)<br></code></pre></td></tr></table></figure><h2 id="å…­ã€é¡¹ç›®éœ€æ±‚å®è·µ"><a href="#å…­ã€é¡¹ç›®éœ€æ±‚å®è·µ" class="headerlink" title="å…­ã€é¡¹ç›®éœ€æ±‚å®è·µ"></a>å…­ã€é¡¹ç›®éœ€æ±‚å®è·µ</h2><p>å›é¡¾ä¸€ä¸‹æˆ‘æ¥åˆ°çš„é¡¹ç›®éœ€æ±‚ï¼š<strong>å…¨å±€æ›¿æ¢å½“å‰é¡¹ç›®ä¸­çš„é»˜è®¤å­—ä½“ï¼Œå¹¶å¼•å…¥ UI è®¾è®¡å¸ˆæä¾›çš„ä¸€äº›æ–°å­—ä½“</strong></p><p>åœ¨å­¦ä¹ æœ¬ç¯‡æ–‡ç« ä¹‹å‰ï¼Œæˆ‘ä»¬å¼•å…¥å­—ä½“éƒ½æ˜¯æ”¾åœ¨ assets æ–‡ä»¶ç›®å½•ä¸‹ï¼Œè¿™ä¸ªç›®å½•ä¸‹çš„å­—ä½“æ–‡ä»¶ï¼Œæˆ‘ä»¬åªèƒ½åœ¨ä»£ç ä¸­è·å–å¹¶ä½¿ç”¨ã€‚é‚£ä¹ˆé€šè¿‡æœ¬ç¯‡æ–‡ç« çš„è®²è§£ï¼Œæˆ‘ä»¬ä¸ä»…å¯ä»¥åœ¨ä»£ç ä¸­è¿›è¡Œä½¿ç”¨ï¼Œè¿˜å¯ä»¥åœ¨ Xml ä¸­è¿›è¡Œä½¿ç”¨ã€‚ç°åœ¨æˆ‘ä»¬è§£å†³äº†ä¸€åŠçš„éœ€æ±‚ï¼Œå…³äºå…¨å±€æ›¿æ¢é»˜è®¤å­—ä½“è¿˜éœ€ç­‰åˆ°ä¸‹ä¸€ç¯‡æ–‡ç« ğŸ˜„</p><h2 id="ä¸ƒã€æ€»ç»“"><a href="#ä¸ƒã€æ€»ç»“" class="headerlink" title="ä¸ƒã€æ€»ç»“"></a>ä¸ƒã€æ€»ç»“</h2><p>å›é¡¾ä¸‹æœ¬ç¯‡æ–‡ç« æˆ‘ä»¬è®²çš„ä¸€äº›é‡ç‚¹å†…å®¹ï¼š</p><p>1ã€å°†å­—ä½“æ”¾åœ¨ res çš„ font ç›®å½•ä¸‹ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥åœ¨ Xml ä¸­ä½¿ç”¨å­—ä½“äº†</p><p>2ã€é€šè¿‡å­—ä½“ R èµ„æºç´¢å¼•è·å–å­—ä½“æ–‡ä»¶ï¼Œå°è£…ç›¸åº”çš„å­—ä½“å·¥å…·ç±»ï¼Œåœ¨ä»£ç ä¸­ä¼˜é›…çš„ä½¿ç”¨</p><p>å¥½äº†ï¼Œæœ¬ç¯‡æ–‡ç« åˆ°è¿™é‡Œå°±ç»“æŸäº†ï¼Œå¸Œæœ›èƒ½ç»™ä½ å¸¦æ¥å¸®åŠ© ğŸ¤ </p><p><a href="https://github.com/sweetying520/ChangeDefaultFontDemo">Github Demo åœ°å€</a></p><p><strong>æ„Ÿè°¢ä½ é˜…è¯»è¿™ç¯‡æ–‡ç« </strong></p><h3 id="ä¸‹ç¯‡é¢„å‘Š"><a href="#ä¸‹ç¯‡é¢„å‘Š" class="headerlink" title="ä¸‹ç¯‡é¢„å‘Š"></a>ä¸‹ç¯‡é¢„å‘Š</h3><p>ä¸‹ç¯‡æ–‡ç« æˆ‘ä¼šè®² Android å…¨å±€æ›¿æ¢å­—ä½“çš„å‡ ç§æ–¹å¼ï¼Œæ•¬è¯·æœŸå¾…å§ ğŸ˜„</p><h3 id="å‚è€ƒå’Œæ¨è"><a href="#å‚è€ƒå’Œæ¨è" class="headerlink" title="å‚è€ƒå’Œæ¨è"></a>å‚è€ƒå’Œæ¨è</h3><p><a href="https://developer.android.com/guide/topics/ui/look-and-feel/fonts-in-xml#kotlin">XML ä¸­çš„å­—ä½“</a></p><blockquote><p><strong>ä½ çš„ç‚¹èµï¼Œè¯„è®ºï¼Œæ˜¯å¯¹æˆ‘å·¨å¤§çš„é¼“åŠ±ï¼</strong></p><p>æ¬¢è¿å…³æ³¨æˆ‘çš„<strong>å…¬ä¼—å·ï¼š</strong>  <a href="http://m6z.cn/6jwi7b"><strong>sweetying</strong></a> ï¼Œæ–‡ç« æ›´æ–°å¯ç¬¬ä¸€æ—¶é—´æ”¶åˆ°</p><p>å¦‚æœ<strong>æœ‰é—®é¢˜</strong>ï¼Œå…¬ä¼—å·å†…æœ‰åŠ æˆ‘å¾®ä¿¡çš„å…¥å£ï¼Œåœ¨æŠ€æœ¯å­¦ä¹ ã€ä¸ªäººæˆé•¿çš„é“è·¯ä¸Šï¼Œæˆ‘ä»¬ä¸€èµ·å‰è¿›ï¼</p></blockquote>]]></content>
    
    
    <categories>
      
      <category>Android</category>
      
      <category>Font</category>
      
    </categories>
    
    
    <tags>
      
      <tag>åŸåˆ›</tag>
      
      <tag>Android</tag>
      
      <tag>Android Font</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Androidå­—ä½“ç³»åˆ— ï¼ˆäºŒï¼‰ï¼šTypefaceå®Œå…¨è§£æ</title>
    <link href="/2022/10/11/Android%E5%AD%97%E4%BD%93%E7%B3%BB%E5%88%97%20%EF%BC%88%E4%BA%8C%EF%BC%89%EF%BC%9ATypeface%E5%AE%8C%E5%85%A8%E8%A7%A3%E6%9E%90/"/>
    <url>/2022/10/11/Android%E5%AD%97%E4%BD%93%E7%B3%BB%E5%88%97%20%EF%BC%88%E4%BA%8C%EF%BC%89%EF%BC%9ATypeface%E5%AE%8C%E5%85%A8%E8%A7%A3%E6%9E%90/</url>
    
    <content type="html"><![CDATA[<p><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/fdb4cdd562d9482db27894476dea9ac9~tplv-k3u1fbpfcp-watermark.image"></p><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>å¾ˆé«˜å…´é‡è§ä½ ~</p><p>åœ¨æœ¬ç³»åˆ—çš„ä¸Šä¸€ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬ä»‹ç»äº†å…³äº Android å­—ä½“çš„ä¸€äº›åŸºç¡€çŸ¥è¯†ï¼Œè¿˜æ²¡æœ‰çœ‹è¿‡ä¸Šä¸€ç¯‡æ–‡ç« çš„æœ‹å‹ï¼Œå»ºè®®å…ˆå»é˜…è¯» <a href="https://juejin.cn/post/6973064546420260878">Androidå­—ä½“ç³»åˆ— ï¼ˆä¸€ï¼‰ï¼šAndroidå­—ä½“åŸºç¡€</a>ï¼Œä½ ä¼šå‘ç°ï¼Œæˆ‘ä»¬è®¾ç½®çš„é‚£ä¸‰ä¸ªå±æ€§æœ€ç»ˆéƒ½ä¼šå»æ„å»ºä¸€ä¸ª Typeface å¯¹è±¡ï¼Œä»Šå¤©æˆ‘ä»¬å°±å¥½å¥½çš„æ¥è®²è®²å®ƒ</p><p><strong>æ³¨æ„ï¼šæœ¬æ–‡æ‰€å±•ç¤ºçš„ç³»ç»Ÿæºç éƒ½æ˜¯åŸºäºAndroid-30 ï¼Œå¹¶æå–æ ¸å¿ƒéƒ¨åˆ†è¿›è¡Œåˆ†æ</strong></p><h2 id="ä¸€ã€Typeface-ä»‹ç»"><a href="#ä¸€ã€Typeface-ä»‹ç»" class="headerlink" title="ä¸€ã€Typeface ä»‹ç»"></a>ä¸€ã€Typeface ä»‹ç»</h2><p><strong>Typeface è´Ÿè´£ Android å­—ä½“çš„åŠ è½½ä»¥åŠå¯¹ä¸Šå±‚æä¾›ç›¸å…³å­—ä½“ API çš„è°ƒç”¨</strong></p><p>å¦‚æœä½ æƒ³è¦æ“ä½œå­—ä½“ï¼Œæ— è®ºæ˜¯ä½¿ç”¨ Android ç³»ç»Ÿè‡ªå¸¦çš„å­—ä½“ï¼Œè¿˜æ˜¯åŠ è½½è‡ªå·±å†…ç½®çš„ .ttf(TureType) æˆ–è€… .otf(OpenType) æ ¼å¼çš„å­—ä½“æ–‡ä»¶ï¼Œä½ éƒ½éœ€è¦ä½¿ç”¨åˆ° Typeface è¿™ä¸ªç±»ã€‚å› æ­¤æˆ‘ä»¬è¦å…¨å±€ä¿®æ”¹å­—ä½“ï¼Œé¦–å…ˆå°±è¦æŠŠ Typeface ç»™å¼„æ˜ç™½</p><h2 id="äºŒã€Typeface-æºç åˆ†æ"><a href="#äºŒã€Typeface-æºç åˆ†æ" class="headerlink" title="äºŒã€Typeface æºç åˆ†æ"></a>äºŒã€Typeface æºç åˆ†æ</h2><p>æºç åˆ†æç¯èŠ‚å¯èƒ½æ¯”è¾ƒæ¯ç‡¥ï¼ŒåšæŒå°±æ˜¯èƒœåˆ© â›½ï¸</p><h3 id="1ã€Typeface-åˆå§‹åŒ–"><a href="#1ã€Typeface-åˆå§‹åŒ–" class="headerlink" title="1ã€Typeface åˆå§‹åŒ–"></a>1ã€Typeface åˆå§‹åŒ–</h3><p>Typeface è¿™ä¸ªç±»ä¼šåœ¨ Android åº”ç”¨ç¨‹åºå¯åŠ¨çš„è¿‡ç¨‹ä¸­ï¼Œé€šè¿‡åå°„çš„æ–¹å¼è¢«åŠ è½½ã€‚ç‚¹å‡»æºç å¯ä»¥çœ‹åˆ°å®ƒé‡Œé¢æœ‰ä¸€ä¸ª static ä»£ç å—ï¼Œå®ƒä¼šéšç€ç±»çš„åŠ è½½è€ŒåŠ è½½ï¼Œå¹¶ä¸”åªä¼šåŠ è½½ä¸€æ¬¡ï¼ŒTypeface å°±æ˜¯é€šè¿‡è¿™ç§æ–¹å¼æ¥è¿›è¡Œåˆå§‹åŒ–çš„ï¼Œå¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">static</span> &#123;<br>    <span class="hljs-comment">//åˆ›å»ºä¸€ä¸ªå­˜æ”¾å­—ä½“çš„ Map</span><br>    <span class="hljs-keyword">final</span> HashMap&lt;String, Typeface&gt; systemFontMap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();<br>    <span class="hljs-comment">//å°†ç³»ç»Ÿçš„ä¸€äº›é»˜è®¤å­—ä½“æ”¾å…¥ Map ä¸­</span><br>    initSystemDefaultTypefaces(systemFontMap,SystemFonts.getRawSystemFallbackMap(),SystemFonts.getAliases());<br>    <span class="hljs-comment">//unmodifiableMap æ–¹æ³•çš„ä½œç”¨å°±æ˜¯å°†å½“å‰ Map è¿›è¡ŒåŒ…è£…ï¼Œè¿”å›ä¸€ä¸ªä¸å¯ä¿®æ”¹çš„Mapï¼Œå¦‚æœè°ƒç”¨ä¿®æ”¹æ–¹æ³•å°±ä¼šæŠ›å¼‚å¸¸</span><br>  sSystemFontMap = Collections.unmodifiableMap(systemFontMap);<br><br>    <span class="hljs-comment">// We can&#x27;t assume DEFAULT_FAMILY available on Roboletric.</span><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * è®¾ç½®ç³»ç»Ÿé»˜è®¤å­—ä½“  DEFAULT_FAMILY = &quot;sans-serif&quot;;</span><br><span class="hljs-comment">     * å› æ­¤ç³»ç»Ÿé»˜è®¤çš„å­—ä½“å°±æ˜¯ sans-serif</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">if</span> (sSystemFontMap.containsKey(DEFAULT_FAMILY)) &#123;<br>        setDefault(sSystemFontMap.get(DEFAULT_FAMILY));<br>    &#125;<br><br>    <span class="hljs-comment">// Set up defaults and typefaces exposed in public API</span><br>    <span class="hljs-comment">//ä¸€äº›ç³»ç»Ÿé»˜è®¤çš„å­—ä½“</span><br>    DEFAULT         = create((String) <span class="hljs-literal">null</span>, <span class="hljs-number">0</span>);<br>    DEFAULT_BOLD    = create((String) <span class="hljs-literal">null</span>, Typeface.BOLD);<br>    SANS_SERIF      = create(<span class="hljs-string">&quot;sans-serif&quot;</span>, <span class="hljs-number">0</span>);<br>    SERIF           = create(<span class="hljs-string">&quot;serif&quot;</span>, <span class="hljs-number">0</span>);<br>    MONOSPACE       = create(<span class="hljs-string">&quot;monospace&quot;</span>, <span class="hljs-number">0</span>);<br>    <span class="hljs-comment">//åˆå§‹åŒ–ä¸€ä¸ª sDefaults æ•°ç»„ï¼Œå¹¶é¢„åŠ è½½å¥½ç²—ä½“ã€æ–œä½“ç­‰ä¸€äº›å¸¸ç”¨çš„ Style</span><br>    sDefaults = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Typeface</span>[] &#123;<br>        DEFAULT,<br>        DEFAULT_BOLD,<br>        create((String) <span class="hljs-literal">null</span>, Typeface.ITALIC),<br>        create((String) <span class="hljs-literal">null</span>, Typeface.BOLD_ITALIC),<br>    &#125;;<br><br>    <span class="hljs-comment">//...</span><br>&#125;<br></code></pre></td></tr></table></figure><p>ä¸Šè¿°ä»£ç å†™äº†è¯¦ç»†çš„æ³¨é‡Šï¼Œæˆ‘ä»¬å¯ä»¥å‘ç°ï¼ŒTypeface åˆå§‹åŒ–ä¸»è¦åšäº†ï¼š</p><p>1ã€å°†ç³»ç»Ÿçš„ä¸€äº›é»˜è®¤å­—ä½“æ”¾å…¥ä¸€ä¸ª Map ä¸­</p><p>2ã€è®¾ç½®é»˜è®¤çš„å­—ä½“</p><p>3ã€åˆå§‹åŒ–ä¸€äº›é»˜è®¤å­—ä½“</p><p>4ã€åˆå§‹åŒ–ä¸€ä¸ª sDefaults æ•°ç»„ï¼Œå­˜æ”¾ä¸€äº›å¸¸ç”¨çš„ Style</p><p>å®Œæˆäº† Typeface çš„åˆå§‹åŒ–ï¼Œæ¥ä¸‹æ¥çœ‹ Typeface æä¾›äº†ä¸€ç³»åˆ—åˆ›å»ºå­—ä½“çš„ API ï¼Œå…¶ä¸­å¯¹ä¸Šå±‚å¼€æ”¾è°ƒç”¨çš„æœ‰å¦‚ä¸‹å‡ ä¸ªï¼š</p><p><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/837f18d801a1409fa99f4e3ba024f981~tplv-k3u1fbpfcp-watermark.image" alt="image-20210614130149262.png"></p><p>ä¸‹é¢æˆ‘ä»¬æ¥é‡ç‚¹åˆ†æè¿™å‡ ä¸ªæ–¹æ³•</p><h3 id="2ã€é€šè¿‡-Typeface-å’Œ-Style-è·å–æ–°çš„-Typeface"><a href="#2ã€é€šè¿‡-Typeface-å’Œ-Style-è·å–æ–°çš„-Typeface" class="headerlink" title="2ã€é€šè¿‡ Typeface å’Œ Style è·å–æ–°çš„ Typeface"></a>2ã€é€šè¿‡ Typeface å’Œ Style è·å–æ–°çš„ Typeface</h3><p>å¯¹åº”ä¸Šé¢æˆªå›¾çš„ç¬¬ä¸€ä¸ª API , çœ‹ä¸‹å®ƒçš„æºç ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Typeface <span class="hljs-title function_">create</span><span class="hljs-params">(Typeface family, <span class="hljs-meta">@Style</span> <span class="hljs-type">int</span> style)</span> &#123;<br>    <span class="hljs-comment">//åˆ¤æ–­å½“å‰æ˜¯å¦è®¾ç½®äº† style , å¦‚æœæ²¡æœ‰è®¾ç½®ï¼Œç½®ä¸º NORMAL</span><br>    <span class="hljs-keyword">if</span> ((style &amp; ~STYLE_MASK) != <span class="hljs-number">0</span>) &#123;<br>        style = NORMAL;<br>    &#125;<br>    <span class="hljs-comment">//åˆ¤æ–­å½“å‰ä¼ å…¥çš„ Typeface æ˜¯å¦ä¸ºç©ºï¼Œå¦‚æœæ˜¯ï¼Œç½®ä¸ºé»˜è®¤å­—ä½“</span><br>    <span class="hljs-keyword">if</span> (family == <span class="hljs-literal">null</span>) &#123;<br>        family = sDefaultTypeface;<br>    &#125;<br><br>    <span class="hljs-comment">// Return early if we&#x27;re asked for the same face/style</span><br>    <span class="hljs-comment">//å¦‚æœå½“å‰ Typeface çš„ mStyle å±æ€§å’Œä¼ å…¥çš„ style ç›¸åŒï¼Œç›´æ¥è¿”å› Typeface å¯¹è±¡</span><br>    <span class="hljs-keyword">if</span> (family.mStyle == style) &#123;<br>        <span class="hljs-keyword">return</span> family;<br>    &#125;<br><br>    <span class="hljs-keyword">final</span> <span class="hljs-type">long</span> <span class="hljs-variable">ni</span> <span class="hljs-operator">=</span> family.native_instance;<br><br>    Typeface typeface;<br>    <span class="hljs-comment">//ä½¿ç”¨ sStyledCacheLock ä¿è¯çº¿ç¨‹å®‰å…¨</span><br>    <span class="hljs-keyword">synchronized</span> (sStyledCacheLock) &#123;<br>      <span class="hljs-comment">//ä»ç¼“å­˜ä¸­è·å–å­˜æ”¾ Typeface çš„ SparseArray</span><br>        SparseArray&lt;Typeface&gt; styles = sStyledTypefaceCache.get(ni);<br>        <span class="hljs-keyword">if</span> (styles == <span class="hljs-literal">null</span>) &#123;<br>            <span class="hljs-comment">//å­˜æ”¾ Typeface çš„ SparseArray ä¸ºç©ºï¼Œæ–°åˆ›å»ºä¸€ä¸ªï¼Œå®¹é‡ä¸º 4</span><br>            styles = <span class="hljs-keyword">new</span> <span class="hljs-title class_">SparseArray</span>&lt;Typeface&gt;(<span class="hljs-number">4</span>);<br>            <span class="hljs-comment">//å°†å½“å‰ å­˜æ”¾ Typeface çš„ SparseArray æ”¾å…¥ç¼“å­˜ä¸­</span><br>            sStyledTypefaceCache.put(ni, styles);<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-comment">//å­˜æ”¾ Typeface çš„ SparseArray ä¸ä¸ºç©ºï¼Œç›´æ¥è·å– Typeface å¹¶è¿”å›</span><br>            typeface = styles.get(style);<br>            <span class="hljs-keyword">if</span> (typeface != <span class="hljs-literal">null</span>) &#123;<br>                <span class="hljs-keyword">return</span> typeface;<br>            &#125;<br>        &#125;<br><br>      <span class="hljs-comment">//é€šè¿‡ native å±‚æ„å»ºåˆ›å»º Typeface çš„å‚æ•°å¹¶åˆ›å»º Typeface å¯¹è±¡</span><br>        typeface = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Typeface</span>(nativeCreateFromTypeface(ni, style));<br>      <span class="hljs-comment">//å°†æ–°åˆ›å»ºçš„  Typeface å¯¹è±¡æ”¾å…¥ SparseArray ä¸­ç¼“å­˜èµ·æ¥</span><br>        styles.put(style, typeface);<br>    &#125;<br>    <span class="hljs-keyword">return</span> typeface;<br>&#125;<br></code></pre></td></tr></table></figure><p>ä»ä¸Šè¿°ä»£ç æˆ‘ä»¬å¯ä»¥çŸ¥é“ï¼š</p><p>1ã€å½“ä½ è®¾ç½®çš„ Typeface å’Œ Style ä¸º null å’Œ 0 æ—¶ï¼Œä¼šç»™å®ƒä»¬è®¾ç½®ä¸€ä¸ªé»˜è®¤å€¼</p><p><strong>æ³¨æ„</strong>ï¼šè¿™é‡Œçš„ Style ï¼Œå¯¹åº”ä¸Šä¸€ç¯‡ä¸­è®²çš„ android:textStyle å±æ€§ä¼ é€’çš„å€¼ï¼Œç”¨äºè®¾å®šå­—ä½“çš„ç²—ä½“ã€æ–œä½“ç­‰å‚æ•°</p><p>2ã€å¦‚æœå½“å‰è®¾ç½®çš„ Typeface çš„ mStyle å±æ€§å’Œä¼ å…¥çš„ Style ç›¸åŒï¼Œç›´æ¥å°† Typeface ç»™è¿”å›</p><p>3ã€ä»ç¼“å­˜ä¸­è·å–å­˜æ”¾ Typeface çš„å®¹å™¨ï¼Œå¦‚æœç¼“å­˜ä¸­å­˜åœ¨ï¼Œåˆ™ä»å®¹å™¨ä¸­å–å‡ºè¯¥ Typeface å¹¶è¿”å›</p><p>4ã€å¦‚æœä¸å­˜åœ¨ï¼Œåˆ™åˆ›å»ºæ–°çš„å®¹å™¨å¹¶åŠ å…¥ç¼“å­˜ï¼Œç„¶åé€šè¿‡ native å±‚åˆ›å»º Typefaceï¼Œå¹¶æŠŠå½“å‰ Typeface æ”¾å…¥åˆ°å®¹å™¨ä¸­</p><p><strong>å› æ­¤æˆ‘ä»¬åœ¨ä½¿ç”¨çš„æ—¶å€™æ— éœ€æ‹…å¿ƒæ•ˆç‡é—®é¢˜ï¼Œå®ƒä¼šæŠŠæˆ‘ä»¬ä¼ å…¥çš„å­—ä½“è¿›è¡Œä¸€ä¸ªç¼“å­˜ï¼Œåç»­éƒ½æ˜¯ä»ç¼“å­˜ä¸­å»æ‹¿çš„</strong></p><h3 id="3ã€é€šè¿‡å­—ä½“åç§°å’Œ-Style-è·å–å­—ä½“"><a href="#3ã€é€šè¿‡å­—ä½“åç§°å’Œ-Style-è·å–å­—ä½“" class="headerlink" title="3ã€é€šè¿‡å­—ä½“åç§°å’Œ Style è·å–å­—ä½“"></a>3ã€é€šè¿‡å­—ä½“åç§°å’Œ Style è·å–å­—ä½“</h3><p>å¯¹åº”ä¸Šé¢æˆªå›¾çš„ç¬¬äºŒä¸ª APIï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Typeface <span class="hljs-title function_">create</span><span class="hljs-params">(String familyName, <span class="hljs-meta">@Style</span> <span class="hljs-type">int</span> style)</span> &#123;<br>    <span class="hljs-comment">//è°ƒç”¨æˆªå›¾çš„ç¬¬ä¸€ä¸ª API</span><br>    <span class="hljs-keyword">return</span> create(getSystemDefaultTypeface(familyName), style);<br>&#125;<br><br><span class="hljs-comment">//è·å–ç³»ç»Ÿæä¾›çš„ä¸€äº›é»˜è®¤å­—ä½“ï¼Œå¦‚æœè·å–ä¸åˆ°åˆ™è¿”å›ç³»ç»Ÿçš„é»˜è®¤å­—ä½“</span><br><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> Typeface <span class="hljs-title function_">getSystemDefaultTypeface</span><span class="hljs-params">(<span class="hljs-meta">@NonNull</span> String familyName)</span> &#123;<br>    <span class="hljs-type">Typeface</span> <span class="hljs-variable">tf</span> <span class="hljs-operator">=</span> sSystemFontMap.get(familyName);<br>    <span class="hljs-keyword">return</span> tf == <span class="hljs-literal">null</span> ? Typeface.DEFAULT : tf;<br>&#125;<br></code></pre></td></tr></table></figure><p>1ã€è¿™ä¸ªåˆ›å»º Typeface çš„ API å¾ˆç®€å•ï¼Œå°±æ˜¯è°ƒç”¨å®ƒçš„ä¸€ä¸ªé‡è½½æ–¹æ³•ï¼Œæˆ‘ä»¬å·²ç»åˆ†æè¿‡</p><p>2ã€getSystemDefaultTypeface ä¸»è¦æ˜¯é€šè¿‡ sSystemFontMap è·å–å­—ä½“ï¼Œè€Œè¿™ä¸ª sSystemFontMap åœ¨ Typeface åˆå§‹åŒ–çš„æ—¶å€™ä¼šå­˜æ”¾ç³»ç»Ÿæä¾›çš„ä¸€äº›é»˜è®¤å­—ä½“ï¼Œå› æ­¤è¿™é‡Œç›´æ¥å–å°±å¯ä»¥äº†</p><h3 id="4ã€é€šè¿‡-Typeface-ã€weight-ç²—ä½“-å’Œ-italic-æ–œä½“-è·å–æ–°çš„-Typeface"><a href="#4ã€é€šè¿‡-Typeface-ã€weight-ç²—ä½“-å’Œ-italic-æ–œä½“-è·å–æ–°çš„-Typeface" class="headerlink" title="4ã€é€šè¿‡ Typeface ã€weight(ç²—ä½“) å’Œ italic(æ–œä½“) è·å–æ–°çš„ Typeface"></a>4ã€é€šè¿‡ Typeface ã€weight(ç²—ä½“) å’Œ italic(æ–œä½“) è·å–æ–°çš„ Typeface</h3><p>å¯¹åº”ä¸Šé¢æˆªå›¾çš„ç¬¬ä¸‰ä¸ª API</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-meta">@NonNull</span> Typeface <span class="hljs-title function_">create</span><span class="hljs-params">(<span class="hljs-meta">@Nullable</span> Typeface family,</span><br><span class="hljs-params">            <span class="hljs-meta">@IntRange(from = 1, to = 1000)</span> <span class="hljs-type">int</span> weight, <span class="hljs-type">boolean</span> italic)</span> &#123;<br>    <span class="hljs-comment">//æ ¡éªŒä¼ å…¥çš„ weight å±æ€§æ˜¯å¦åœ¨èŒƒå›´å†…</span><br>    Preconditions.checkArgumentInRange(weight, <span class="hljs-number">0</span>, <span class="hljs-number">1000</span>, <span class="hljs-string">&quot;weight&quot;</span>);<br>    <span class="hljs-keyword">if</span> (family == <span class="hljs-literal">null</span>) &#123;<br>      <span class="hljs-comment">//å¦‚æœå½“å‰ä¼ å…¥çš„ Typeface ä¸º null, åˆ™ç½®ä¸ºé»˜è®¤å€¼</span><br>        family = sDefaultTypeface;<br>    &#125;<br>    <span class="hljs-comment">//è°ƒç”¨ createWeightStyle æ–¹æ³•åˆ›å»º Typeface</span><br>    <span class="hljs-keyword">return</span> createWeightStyle(family, weight, italic);<br>&#125;<br><br><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-meta">@NonNull</span> Typeface <span class="hljs-title function_">createWeightStyle</span><span class="hljs-params">(<span class="hljs-meta">@NonNull</span> Typeface base,</span><br><span class="hljs-params">            <span class="hljs-meta">@IntRange(from = 1, to = 1000)</span> <span class="hljs-type">int</span> weight, <span class="hljs-type">boolean</span> italic)</span> &#123;<br>    <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">key</span> <span class="hljs-operator">=</span> (weight &lt;&lt; <span class="hljs-number">1</span>) | (italic ? <span class="hljs-number">1</span> : <span class="hljs-number">0</span>);<br><br>    Typeface typeface;<br>    <span class="hljs-comment">//ä½¿ç”¨ sWeightCacheLock ä¿è¯çº¿ç¨‹å®‰å…¨</span><br>    <span class="hljs-keyword">synchronized</span>(sWeightCacheLock) &#123;<br>        SparseArray&lt;Typeface&gt; innerCache = sWeightTypefaceCache.get(base.native_instance);<br>        <span class="hljs-keyword">if</span> (innerCache == <span class="hljs-literal">null</span>) &#123;<br>            <span class="hljs-comment">//ç¼“å­˜ Typeface çš„ SparseArray ä¸º null, æ–°å»ºå¹¶ç¼“å­˜</span><br>            innerCache = <span class="hljs-keyword">new</span> <span class="hljs-title class_">SparseArray</span>&lt;&gt;(<span class="hljs-number">4</span>);<br>            sWeightTypefaceCache.put(base.native_instance, innerCache);<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-comment">//ä»ç¼“å­˜ä¸­æ‹¿å– typeface å¹¶è¿”å›</span><br>            typeface = innerCache.get(key);<br>            <span class="hljs-keyword">if</span> (typeface != <span class="hljs-literal">null</span>) &#123;<br>                <span class="hljs-keyword">return</span> typeface;<br>            &#125;<br>        &#125;<br><span class="hljs-comment">//é€šè¿‡ native åˆ›å»º Typeface å¯¹è±¡</span><br>        typeface = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Typeface</span>(<br>                nativeCreateFromTypefaceWithExactStyle(base.native_instance, weight, italic));<br>        <span class="hljs-comment">//å°† Typeface åŠ å…¥ç¼“å­˜</span><br>      innerCache.put(key, typeface);<br>    &#125;<br>    <span class="hljs-keyword">return</span> typeface;<br>&#125;<br></code></pre></td></tr></table></figure><p>é€šè¿‡ä¸Šè¿°ä»£ç å¯ä»¥çŸ¥é“ï¼Œä»–ä¸æˆªå›¾ä¸€ API çš„æºç å¾ˆç±»ä¼¼ï¼Œæ— éå°±æ˜¯å°†ä¹‹å‰éœ€è¦è®¾ç½®çš„ Style æ¢æˆäº† weight å’Œ italicï¼Œé‡Œé¢çš„å®ç°æœºåˆ¶æ˜¯ç±»ä¼¼çš„</p><h3 id="5ã€é€šè¿‡-AssetManager-å’Œå¯¹åº”å­—ä½“è·¯å¾„è·å–å­—ä½“"><a href="#5ã€é€šè¿‡-AssetManager-å’Œå¯¹åº”å­—ä½“è·¯å¾„è·å–å­—ä½“" class="headerlink" title="5ã€é€šè¿‡ AssetManager å’Œå¯¹åº”å­—ä½“è·¯å¾„è·å–å­—ä½“"></a>5ã€é€šè¿‡ AssetManager å’Œå¯¹åº”å­—ä½“è·¯å¾„è·å–å­—ä½“</h3><p>å¯¹åº”ä¸Šé¢æˆªå›¾çš„ç¬¬å››ä¸ª API</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Typeface <span class="hljs-title function_">createFromAsset</span><span class="hljs-params">(AssetManager mgr, String path)</span> &#123;<br>    <span class="hljs-comment">//å‚æ•°æ£€æŸ¥</span><br>    Preconditions.checkNotNull(path); <span class="hljs-comment">// for backward compatibility</span><br>    Preconditions.checkNotNull(mgr);<br><br>    <span class="hljs-comment">//é€šè¿‡ Typeface çš„ Builder æ¨¡å¼æ„å»º typeface</span><br>    <span class="hljs-type">Typeface</span> <span class="hljs-variable">typeface</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Builder</span>(mgr, path).build();<br>    <span class="hljs-comment">//å¦‚æœæ„å»ºçš„ typeface ä¸ä¸ºç©ºåˆ™è¿”å›</span><br>    <span class="hljs-keyword">if</span> (typeface != <span class="hljs-literal">null</span>) <span class="hljs-keyword">return</span> typeface;<br>    <span class="hljs-comment">// check if the file exists, and throw an exception for backward compatibility</span><br>    <span class="hljs-comment">//çœ‹å½“å‰å­—ä½“è·¯å¾„æ˜¯å¦å­˜åœ¨ï¼Œä¸å­˜åœ¨ç›´æ¥æŠ›å¼‚å¸¸</span><br>    <span class="hljs-keyword">try</span> (<span class="hljs-type">InputStream</span> <span class="hljs-variable">inputStream</span> <span class="hljs-operator">=</span> mgr.open(path)) &#123;<br>    &#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;<br>        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">&quot;Font asset not found &quot;</span> + path);<br>    &#125;<br>    <span class="hljs-comment">//å¦‚æœæ„å»ºçš„å­—ä½“ä¸º null åˆ™è¿”å›é»˜è®¤å­—ä½“</span><br>    <span class="hljs-keyword">return</span> Typeface.DEFAULT;<br>&#125;<br><br><span class="hljs-comment">//æ¥ç€çœ‹ Typeface çš„ Builder æ¨¡å¼æ„å»º typeface</span><br><span class="hljs-comment">//Builder æ„é€ æ–¹æ³• ä¸»è¦å°±æ˜¯åˆå§‹åŒ– mFontBuilder å’Œä¸€äº›å‚æ•°</span><br><span class="hljs-keyword">public</span> <span class="hljs-title function_">Builder</span><span class="hljs-params">(<span class="hljs-meta">@NonNull</span> AssetManager assetManager, <span class="hljs-meta">@NonNull</span> String path, <span class="hljs-type">boolean</span> isAsset,</span><br><span class="hljs-params">                <span class="hljs-type">int</span> cookie)</span> &#123;<br>    mFontBuilder = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Font</span>.Builder(assetManager, path, isAsset, cookie);<br>    mAssetManager = assetManager;<br>    mPath = path;<br>&#125;<br><br><span class="hljs-comment">//build æ–¹æ³•</span><br><span class="hljs-keyword">public</span> Typeface <span class="hljs-title function_">build</span><span class="hljs-params">()</span> &#123;<br>  <span class="hljs-comment">//å¦‚æœ mFontBuilder ä¸º nullï¼Œåˆ™ä¼šè°ƒç”¨ resolveFallbackTypeface æ–¹æ³•</span><br>  <span class="hljs-comment">//resolveFallbackTypeface å†…éƒ¨ä¼šè°ƒç”¨ createWeightStyle åˆ›å»º Typeface å¹¶è¿”å›</span><br>    <span class="hljs-keyword">if</span> (mFontBuilder == <span class="hljs-literal">null</span>) &#123;<br>        <span class="hljs-keyword">return</span> resolveFallbackTypeface();<br>    &#125;<br>    <span class="hljs-keyword">try</span> &#123;<br>      <span class="hljs-comment">//é€šè¿‡ mFontBuilder æ„å»º Font</span><br>        <span class="hljs-keyword">final</span> <span class="hljs-type">Font</span> <span class="hljs-variable">font</span> <span class="hljs-operator">=</span> mFontBuilder.build();<br>      <span class="hljs-comment">//ä½¿ç”¨ createAssetUid æ–¹æ³•è·å–åˆ°è¿™ä¸ªå­—ä½“çš„å”¯ä¸€ key</span><br>        <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">key</span> <span class="hljs-operator">=</span> mAssetManager == <span class="hljs-literal">null</span> ? <span class="hljs-literal">null</span> : createAssetUid(<br>                mAssetManager, mPath, font.getTtcIndex(), font.getAxes(),<br>                mWeight, mItalic,<br>                mFallbackFamilyName == <span class="hljs-literal">null</span> ? DEFAULT_FAMILY : mFallbackFamilyName);<br>        <span class="hljs-keyword">if</span> (key != <span class="hljs-literal">null</span>) &#123;<br>            <span class="hljs-comment">// Dynamic cache lookup is only for assets.</span><br>            <span class="hljs-comment">//ä½¿ç”¨ sDynamicCacheLock ä¿è¯çº¿ç¨‹å®‰å…¨</span><br>            <span class="hljs-keyword">synchronized</span> (sDynamicCacheLock) &#123;<br>              <span class="hljs-comment">//é€šè¿‡ key ä»ç¼“å­˜ä¸­æ‹¿å­—ä½“</span><br>                <span class="hljs-keyword">final</span> <span class="hljs-type">Typeface</span> <span class="hljs-variable">typeface</span> <span class="hljs-operator">=</span> sDynamicTypefaceCache.get(key);<br>              <span class="hljs-comment">//å¦‚æœå½“å‰å­—ä½“ä¸ä¸º null ç›´æ¥è¿”å›</span><br>                <span class="hljs-keyword">if</span> (typeface != <span class="hljs-literal">null</span>) &#123;<br>                    <span class="hljs-keyword">return</span> typeface;<br>                &#125;<br>            &#125;<br>        &#125;<br>      <span class="hljs-comment">//å¦‚æœå½“å‰å­—ä½“ä¸å­˜åœ¨ï¼Œé€šè¿‡ Builder æ¨¡å¼æ„å»º FontFamily å¯¹è±¡</span><br>      <span class="hljs-comment">//é€šè¿‡ FontFamily æ„å»º CustomFallbackBuilder å¯¹è±¡</span><br>     <span class="hljs-comment">//æœ€ç»ˆé€šè¿‡ CustomFallbackBuilder æ„å»º Typeface å¯¹è±¡</span><br>        <span class="hljs-keyword">final</span> <span class="hljs-type">FontFamily</span> <span class="hljs-variable">family</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">FontFamily</span>.Builder(font).build();<br>        <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">weight</span> <span class="hljs-operator">=</span> mWeight == RESOLVE_BY_FONT_TABLE<br>                ? font.getStyle().getWeight() : mWeight;<br>        <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">slant</span> <span class="hljs-operator">=</span> mItalic == RESOLVE_BY_FONT_TABLE<br>                ? font.getStyle().getSlant() : mItalic;<br>        <span class="hljs-keyword">final</span> <span class="hljs-type">CustomFallbackBuilder</span> <span class="hljs-variable">builder</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CustomFallbackBuilder</span>(family)<br>                .setStyle(<span class="hljs-keyword">new</span> <span class="hljs-title class_">FontStyle</span>(weight, slant));<br>        <span class="hljs-keyword">if</span> (mFallbackFamilyName != <span class="hljs-literal">null</span>) &#123;<br>            builder.setSystemFallback(mFallbackFamilyName);<br>        &#125;<br>      <span class="hljs-comment">//builder.build æ–¹æ³•å†…éƒ¨æœ€ç»ˆä¼šé€šè¿‡è°ƒç”¨ native å±‚åˆ›å»º Typeface å¯¹è±¡</span><br>        <span class="hljs-keyword">final</span> <span class="hljs-type">Typeface</span> <span class="hljs-variable">typeface</span> <span class="hljs-operator">=</span> builder.build();<br>      <span class="hljs-comment">//ç¼“å­˜ Typeface å¯¹è±¡å¹¶è¿”å›</span><br>        <span class="hljs-keyword">if</span> (key != <span class="hljs-literal">null</span>) &#123;<br>            <span class="hljs-keyword">synchronized</span> (sDynamicCacheLock) &#123;<br>                sDynamicTypefaceCache.put(key, typeface);<br>            &#125;<br>        &#125;<br>        <span class="hljs-keyword">return</span> typeface;<br>    &#125; <span class="hljs-keyword">catch</span> (IOException | IllegalArgumentException e) &#123;<br>      <span class="hljs-comment">//å¦‚æœæµç¨‹æœ‰ä»»ä½•å¼‚å¸¸ï¼Œåˆ™å†…éƒ¨ä¼šè°ƒç”¨ createWeightStyle åˆ›å»º Typeface å¹¶è¿”å›</span><br>        <span class="hljs-keyword">return</span> resolveFallbackTypeface();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ä¸Šè¿°ä»£ç æ­¥éª¤ï¼š</p><p>1ã€å¤§é‡è¿ç”¨äº† Builder æ¨¡å¼å»æ„å»ºç›¸å…³å¯¹è±¡</p><p>2ã€å…·ä½“é€»è¾‘å°±æ˜¯ä½¿ç”¨ createAssetUid æ–¹æ³•è·å–åˆ°å½“å‰å­—ä½“çš„å”¯ä¸€ key ï¼Œé€šè¿‡è¿™ä¸ªå”¯ä¸€ key ï¼Œä»ç¼“å­˜ä¸­è·å–å·²ç»è¢«åŠ è½½è¿‡çš„å­—ä½“ï¼Œå¦‚æœæ²¡æœ‰ï¼Œåˆ™åˆ›å»ºä¸€ä¸ª FontFamily å¯¹è±¡ï¼Œç»è¿‡ä¸€ç³»åˆ— Builder æ¨¡å¼ï¼Œæœ€ç»ˆè°ƒç”¨ native å±‚åˆ›å»º Typeface å¯¹è±¡ï¼Œå¹¶å°†è¿™ä¸ª Typeface å¯¹è±¡åŠ å…¥ç¼“å­˜å¹¶è¿”å›</p><p>3ã€å¦‚æœæµç¨‹æœ‰ä»»ä½•å¼‚å¸¸ï¼Œå†…éƒ¨ä¼šè°ƒç”¨ createWeightStyle åˆ›å»º Typeface å¹¶è¿”å›</p><h3 id="6ã€é€šè¿‡å­—ä½“æ–‡ä»¶è·å–å­—ä½“"><a href="#6ã€é€šè¿‡å­—ä½“æ–‡ä»¶è·å–å­—ä½“" class="headerlink" title="6ã€é€šè¿‡å­—ä½“æ–‡ä»¶è·å–å­—ä½“"></a>6ã€é€šè¿‡å­—ä½“æ–‡ä»¶è·å–å­—ä½“</h3><p>å¯¹åº”ä¸Šé¢æˆªå›¾çš„ç¬¬äº”ä¸ª API</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Typeface <span class="hljs-title function_">createFromFile</span><span class="hljs-params">(<span class="hljs-meta">@Nullable</span> File file)</span> &#123;<br>    <span class="hljs-comment">// For the compatibility reasons, leaving possible NPE here.</span><br>    <span class="hljs-comment">// See android.graphics.cts.TypefaceTest#testCreateFromFileByFileReferenceNull</span><br>    <span class="hljs-comment">//é€šè¿‡ Typeface çš„ Builder æ¨¡å¼æ„å»º typeface</span><br>    <span class="hljs-type">Typeface</span> <span class="hljs-variable">typeface</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Builder</span>(file).build();<br>    <span class="hljs-keyword">if</span> (typeface != <span class="hljs-literal">null</span>) <span class="hljs-keyword">return</span> typeface;<br><br>    <span class="hljs-comment">// check if the file exists, and throw an exception for backward compatibility</span><br>    <span class="hljs-comment">//æ–‡ä»¶ä¸å­˜åœ¨ï¼ŒæŠ›å¼‚å¸¸</span><br>    <span class="hljs-keyword">if</span> (!file.exists()) &#123;<br>        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">&quot;Font asset not found &quot;</span> + file.getAbsolutePath());<br>    &#125;<br>    <span class="hljs-comment">//å¦‚æœæ„å»ºçš„å­—ä½“ä¸º null åˆ™è¿”å›é»˜è®¤å­—ä½“</span><br>    <span class="hljs-keyword">return</span> Typeface.DEFAULT;<br>&#125;<br><br><span class="hljs-comment">//Builder å¦å¤–ä¸€ä¸ªæ„é€ æ–¹æ³• ä¸»è¦æ˜¯åˆå§‹åŒ– mFontBuilder</span><br><span class="hljs-keyword">public</span> <span class="hljs-title function_">Builder</span><span class="hljs-params">(<span class="hljs-meta">@NonNull</span> File path)</span> &#123;<br>    mFontBuilder = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Font</span>.Builder(path);<br>    mAssetManager = <span class="hljs-literal">null</span>;<br>    mPath = <span class="hljs-literal">null</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>ä»ä¸Šè¿°ä»£ç å¯ä»¥çŸ¥é“ï¼Œè¿™ç§æ–¹å¼ä¸»è¦ä¹Ÿæ˜¯é€šè¿‡ Builder æ¨¡å¼å»æ„å»º Typeface å¯¹è±¡ï¼Œå…·ä½“é€»è¾‘æˆ‘ä»¬åˆšæ‰å·²ç»åˆ†æè¿‡</p><h3 id="7ã€é€šè¿‡å­—ä½“è·¯å¾„è·å–å­—ä½“"><a href="#7ã€é€šè¿‡å­—ä½“è·¯å¾„è·å–å­—ä½“" class="headerlink" title="7ã€é€šè¿‡å­—ä½“è·¯å¾„è·å–å­—ä½“"></a>7ã€é€šè¿‡å­—ä½“è·¯å¾„è·å–å­—ä½“</h3><p>å¯¹åº”ä¸Šé¢æˆªå›¾çš„ç¬¬å…­ä¸ª API</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Typeface <span class="hljs-title function_">createFromFile</span><span class="hljs-params">(<span class="hljs-meta">@Nullable</span> String path)</span> &#123;<br>    Preconditions.checkNotNull(path); <span class="hljs-comment">// for backward compatibility</span><br>    <span class="hljs-keyword">return</span> createFromFile(<span class="hljs-keyword">new</span> <span class="hljs-title class_">File</span>(path));<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™ä¸ªå°±æ›´ç®€å•äº†ï¼Œä¸»è¦å°±æ˜¯åˆ›å»ºæ–‡ä»¶å¯¹è±¡ç„¶åè°ƒç”¨å¦å¤–ä¸€ä¸ªé‡è½½æ–¹æ³•</p><h3 id="8ã€Typeface-ç›¸å…³-Native-æ–¹æ³•"><a href="#8ã€Typeface-ç›¸å…³-Native-æ–¹æ³•" class="headerlink" title="8ã€Typeface ç›¸å…³ Native æ–¹æ³•"></a>8ã€Typeface ç›¸å…³ Native æ–¹æ³•</h3><p>åœ¨ Typeface ä¸­ï¼Œæ‰€æœ‰æœ€ç»ˆæ“ä½œåˆ°åŠ è½½å­—ä½“çš„éƒ¨åˆ†ï¼Œå…¨éƒ¨éƒ½æ˜¯ native çš„æ–¹æ³•ã€‚è€Œ native æ–¹æ³•å°±æ˜¯ä»¥æ•ˆç‡è‘—ç§°çš„ï¼Œè¿™é‡Œåªéœ€è¦ä¿è¯ä¸é¢‘ç¹çš„è°ƒç”¨ï¼ˆTypeface å·²ç»åšå¥½äº†ç¼“å­˜ï¼Œä¸ä¼šé¢‘ç¹çš„è°ƒç”¨ï¼‰ï¼ŒåŸºæœ¬ä¸Šä¹Ÿä¸ä¼šå­˜åœ¨æ•ˆç‡çš„é—®é¢˜ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">native</span> <span class="hljs-type">long</span> <span class="hljs-title function_">nativeCreateFromTypeface</span><span class="hljs-params">(<span class="hljs-type">long</span> native_instance, <span class="hljs-type">int</span> style)</span>;<br><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">native</span> <span class="hljs-type">long</span> <span class="hljs-title function_">nativeCreateFromTypefaceWithExactStyle</span><span class="hljs-params">(</span><br><span class="hljs-params">            <span class="hljs-type">long</span> native_instance, <span class="hljs-type">int</span> weight, <span class="hljs-type">boolean</span> italic)</span>;<br><span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> clean up: change List&lt;FontVariationAxis&gt; to FontVariationAxis[]</span><br><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">native</span> <span class="hljs-type">long</span> <span class="hljs-title function_">nativeCreateFromTypefaceWithVariation</span><span class="hljs-params">(</span><br><span class="hljs-params">            <span class="hljs-type">long</span> native_instance, List&lt;FontVariationAxis&gt; axes)</span>;<br><span class="hljs-meta">@UnsupportedAppUsage</span><br><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">native</span> <span class="hljs-type">long</span> <span class="hljs-title function_">nativeCreateWeightAlias</span><span class="hljs-params">(<span class="hljs-type">long</span> native_instance, <span class="hljs-type">int</span> weight)</span>;<br><span class="hljs-meta">@UnsupportedAppUsage</span><br><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">native</span> <span class="hljs-type">long</span> <span class="hljs-title function_">nativeCreateFromArray</span><span class="hljs-params">(<span class="hljs-type">long</span>[] familyArray, <span class="hljs-type">int</span> weight, <span class="hljs-type">int</span> italic)</span>;<br><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">native</span> <span class="hljs-type">int</span>[] nativeGetSupportedAxes(<span class="hljs-type">long</span> native_instance);<br><br><span class="hljs-meta">@CriticalNative</span><br><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">native</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">nativeSetDefault</span><span class="hljs-params">(<span class="hljs-type">long</span> nativePtr)</span>;<br><br><span class="hljs-meta">@CriticalNative</span><br><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">native</span> <span class="hljs-type">int</span>  <span class="hljs-title function_">nativeGetStyle</span><span class="hljs-params">(<span class="hljs-type">long</span> nativePtr)</span>;<br><br><span class="hljs-meta">@CriticalNative</span><br><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">native</span> <span class="hljs-type">int</span>  <span class="hljs-title function_">nativeGetWeight</span><span class="hljs-params">(<span class="hljs-type">long</span> nativePtr)</span>;<br><br><span class="hljs-meta">@CriticalNative</span><br><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">native</span> <span class="hljs-type">long</span> <span class="hljs-title function_">nativeGetReleaseFunc</span><span class="hljs-params">()</span>;<br><br><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">native</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">nativeRegisterGenericFamily</span><span class="hljs-params">(String str, <span class="hljs-type">long</span> nativePtr)</span>;<br></code></pre></td></tr></table></figure><p>åˆ°è¿™é‡Œï¼Œå…³äº Typeface æºç éƒ¨åˆ†æˆ‘ä»¬å°±ä»‹ç»å®Œäº†ï¼Œä¸‹é¢çœ‹ä¸‹å®ƒçš„ä¸€äº›å…¶ä»–ç»†èŠ‚</p><h2 id="ä¸‰ã€Typeface-å…¶å®ƒç»†èŠ‚"><a href="#ä¸‰ã€Typeface-å…¶å®ƒç»†èŠ‚" class="headerlink" title="ä¸‰ã€Typeface å…¶å®ƒç»†èŠ‚"></a>ä¸‰ã€Typeface å…¶å®ƒç»†èŠ‚</h2><h3 id="1ã€é»˜è®¤ä½¿ç”¨"><a href="#1ã€é»˜è®¤ä½¿ç”¨" class="headerlink" title="1ã€é»˜è®¤ä½¿ç”¨"></a>1ã€é»˜è®¤ä½¿ç”¨</h3><p>åœ¨åˆå§‹åŒ–é‚£éƒ¨åˆ†ï¼ŒTypeface å¯¹å­—ä½“å’Œ Style æœ‰ä¸€äº›é»˜è®¤å®ç°</p><p>å¦‚æœæˆ‘ä»¬åªæƒ³ç”¨ç³»ç»Ÿé»˜è®¤çš„å­—ä½“ï¼Œç›´æ¥æ‹¿ä¸Šé¢çš„å¸¸é‡ç”¨å°± ok äº†ï¼Œå¦‚ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java">Typeface.DEFAULT<br>Typeface.DEFAULT_BOLD<br>Typeface.SANS_SERIF<br>Typeface.SERIF<br>Typeface.MONOSPACE<br></code></pre></td></tr></table></figure><p>è€Œå¦‚æœæƒ³è¦è®¾ç½® Style ï¼Œæˆ‘ä»¬ä¸èƒ½é€šè¿‡ sDefaults ç›´æ¥å»æ‹¿ï¼Œå› ä¸ºä¸Šå±‚è°ƒç”¨ä¸åˆ° sDefaultsï¼Œä½†æ˜¯å¯ä»¥é€šè¿‡ Typeface æä¾›çš„ API è·å–ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Typeface <span class="hljs-title function_">defaultFromStyle</span><span class="hljs-params">(<span class="hljs-meta">@Style</span> <span class="hljs-type">int</span> style)</span> &#123;<br>    <span class="hljs-keyword">return</span> sDefaults[style];<br>&#125;<br><br><span class="hljs-comment">//å…·ä½“è°ƒç”¨</span><br>Typeface.defaultFromStyle(Typeface.NORMAL)<br>Typeface.defaultFromStyle(Typeface.BOLD)<br>Typeface.defaultFromStyle(Typeface.ITALIC)<br>Typeface.defaultFromStyle(Typeface.BOLD_ITALIC)<br></code></pre></td></tr></table></figure><h3 id="2ã€Typeface-ä¸­çš„-Style"><a href="#2ã€Typeface-ä¸­çš„-Style" class="headerlink" title="2ã€Typeface ä¸­çš„ Style"></a>2ã€Typeface ä¸­çš„ Style</h3><p>1ï¼‰ã€Typeface ä¸­çš„ Style å¯ä»¥é€šè¿‡ android:textStyle å±æ€§å»è®¾ç½®ç²—ä½“ã€æ–œä½“ç­‰æ ·å¼</p><p>2ï¼‰ã€åœ¨ Typeface ä¸­ï¼Œè¿™äº›æ ·å¼ä¹Ÿå¯¹åº”äº†ä¸€ä¸ªä¸ªçš„å¸¸é‡ï¼Œå¹¶ä¸” Typeface ä¹Ÿæä¾›äº†å¯¹åº”çš„ Apiï¼Œè®©æˆ‘ä»¬è·å–åˆ°å½“å‰å­—ä½“çš„æ ·å¼</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// Style</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">NORMAL</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">BOLD</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">ITALIC</span> <span class="hljs-operator">=</span> <span class="hljs-number">2</span>;<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">BOLD_ITALIC</span> <span class="hljs-operator">=</span> <span class="hljs-number">3</span>;<br><br><span class="hljs-comment">/** Returns the typeface&#x27;s intrinsic style attributes */</span><br><span class="hljs-keyword">public</span> <span class="hljs-meta">@Style</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getStyle</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-keyword">return</span> mStyle;<br>&#125;<br><br><span class="hljs-comment">/** Returns true if getStyle() has the BOLD bit set. */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">isBold</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-keyword">return</span> (mStyle &amp; BOLD) != <span class="hljs-number">0</span>;<br>&#125;<br><br><span class="hljs-comment">/** Returns true if getStyle() has the ITALIC bit set. */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">isItalic</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-keyword">return</span> (mStyle &amp; ITALIC) != <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="3ã€FontFamily-ä»‹ç»"><a href="#3ã€FontFamily-ä»‹ç»" class="headerlink" title="3ã€FontFamily ä»‹ç»"></a>3ã€FontFamily ä»‹ç»</h3><p><strong>FontFamily</strong> ä¸»è¦å°±æ˜¯ç”¨æ¥æ„å»º Typeface çš„ä¸€ä¸ªç±»ï¼Œæ³¨æ„å’Œåœ¨ Xml å±æ€§ä¸­è®¾ç½®çš„ android:fontFamily åŒºåˆ†å¼€æ¥å°±å¥½äº†</p><h2 id="å››ã€æ€»ç»“"><a href="#å››ã€æ€»ç»“" class="headerlink" title="å››ã€æ€»ç»“"></a>å››ã€æ€»ç»“</h2><p>æ€»ç»“ä¸‹æœ¬ç¯‡æ–‡ç« æ‰€è®²çš„ä¸€äº›é‡ç‚¹å†…å®¹ï¼š</p><p>1ã€Typeface åˆå§‹åŒ–å¯¹å­—ä½“å’Œ Style ä¼šæœ‰ä¸€äº›é»˜è®¤å®ç°</p><p>2ã€Typeface create ç³»åˆ—æ–¹æ³•æ”¯æŒä»ç³»ç»Ÿé»˜è®¤å­—ä½“ã€ assets ç›®å½•ã€å­—ä½“æ–‡ä»¶ä»¥åŠå­—ä½“è·¯å¾„å»è·å–å­—ä½“</p><p>3ã€Typeface æœ¬èº«æ”¯æŒç¼“å­˜ï¼Œæˆ‘ä»¬åœ¨ä½¿ç”¨çš„æ—¶å€™æ— éœ€æ³¨æ„æ•ˆç‡é—®é¢˜</p><p>å¥½äº†ï¼Œæœ¬ç¯‡æ–‡ç« åˆ°è¿™é‡Œå°±ç»“æŸäº†ï¼Œå¸Œæœ›èƒ½ç»™ä½ å¸¦æ¥å¸®åŠ© ğŸ¤ </p><p><strong>æ„Ÿè°¢ä½ é˜…è¯»è¿™ç¯‡æ–‡ç« </strong></p><h3 id="ä¸‹ç¯‡é¢„å‘Š"><a href="#ä¸‹ç¯‡é¢„å‘Š" class="headerlink" title="ä¸‹ç¯‡é¢„å‘Š"></a>ä¸‹ç¯‡é¢„å‘Š</h3><p>ä¸‹ç¯‡æ–‡ç« æˆ‘ä¼šè®²åœ¨ Xml ä¸­ä½¿ç”¨å­—ä½“ï¼Œæ•¬è¯·æœŸå¾…å§ ğŸ˜„</p><h3 id="å‚è€ƒå’Œæ¨è"><a href="#å‚è€ƒå’Œæ¨è" class="headerlink" title="å‚è€ƒå’Œæ¨è"></a>å‚è€ƒå’Œæ¨è</h3><p><a href="https://segmentfault.com/a/1190000011299442">Android ä¿®æ”¹å­—ä½“ï¼Œè·³ä¸è¿‡çš„ Typeface</a></p><blockquote><p><strong>ä½ çš„ç‚¹èµï¼Œè¯„è®ºï¼Œæ˜¯å¯¹æˆ‘å·¨å¤§çš„é¼“åŠ±ï¼</strong></p><p>æ¬¢è¿å…³æ³¨æˆ‘çš„<strong>å…¬ä¼—å·ï¼š</strong>  <a href="http://m6z.cn/6jwi7b"><strong>sweetying</strong></a> ï¼Œæ–‡ç« æ›´æ–°å¯ç¬¬ä¸€æ—¶é—´æ”¶åˆ°</p><p>å¦‚æœ<strong>æœ‰é—®é¢˜</strong>ï¼Œå…¬ä¼—å·å†…æœ‰åŠ æˆ‘å¾®ä¿¡çš„å…¥å£ï¼Œåœ¨æŠ€æœ¯å­¦ä¹ ã€ä¸ªäººæˆé•¿çš„é“è·¯ä¸Šï¼Œæˆ‘ä»¬ä¸€èµ·å‰è¿›ï¼</p></blockquote>]]></content>
    
    
    <categories>
      
      <category>Android</category>
      
      <category>Font</category>
      
    </categories>
    
    
    <tags>
      
      <tag>åŸåˆ›</tag>
      
      <tag>Android</tag>
      
      <tag>Android Font</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Androidå­—ä½“ç³»åˆ— ï¼ˆä¸€ï¼‰ï¼šAndroidå­—ä½“åŸºç¡€</title>
    <link href="/2022/10/11/Android%E5%AD%97%E4%BD%93%E7%B3%BB%E5%88%97%20%EF%BC%88%E4%B8%80%EF%BC%89%EF%BC%9AAndroid%E5%AD%97%E4%BD%93%E5%9F%BA%E7%A1%80/"/>
    <url>/2022/10/11/Android%E5%AD%97%E4%BD%93%E7%B3%BB%E5%88%97%20%EF%BC%88%E4%B8%80%EF%BC%89%EF%BC%9AAndroid%E5%AD%97%E4%BD%93%E5%9F%BA%E7%A1%80/</url>
    
    <content type="html"><![CDATA[<p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/860547fcae1c47e5ab8d633d991a54db~tplv-k3u1fbpfcp-watermark.image"></p><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>å¾ˆé«˜å…´é‡è§ä½ ~</p><p>æœ€è¿‘æ¥åˆ°ä¸€ä¸ªéœ€æ±‚ï¼Œå¤§è‡´å†…å®¹æ˜¯ï¼šå…¨å±€æ›¿æ¢å½“å‰é¡¹ç›®ä¸­çš„é»˜è®¤å­—ä½“ï¼Œå¹¶å¼•å…¥ UI è®¾è®¡å¸ˆæä¾›çš„ä¸€äº›æ–°å­—ä½“ã€‚äºæ˜¯å¯¹å­—ä½“åšäº†äº›ç ”ç©¶ï¼ŒæŠŠè‡ªå·±çš„ä¸€äº›å¿ƒå¾—åˆ†äº«ç»™å¤§å®¶ã€‚</p><p><strong>æ³¨æ„ï¼šæœ¬æ–‡æ‰€å±•ç¤ºçš„ç³»ç»Ÿæºç éƒ½æ˜¯åŸºäºAndroid-30 ï¼Œå¹¶æå–æ ¸å¿ƒéƒ¨åˆ†è¿›è¡Œåˆ†æ</strong></p><h2 id="ä¸€ã€Android-é»˜è®¤å­—ä½“ä»‹ç»"><a href="#ä¸€ã€Android-é»˜è®¤å­—ä½“ä»‹ç»" class="headerlink" title="ä¸€ã€Android é»˜è®¤å­—ä½“ä»‹ç»"></a>ä¸€ã€Android é»˜è®¤å­—ä½“ä»‹ç»</h2><p>1ã€Android ç³»ç»Ÿé»˜è®¤ä½¿ç”¨çš„æ˜¯ä¸€æ¬¾å«åš <strong>Roboto</strong> çš„å­—ä½“ï¼Œè¿™ä¹Ÿæ˜¯ Google æ¨èä½¿ç”¨çš„ä¸€æ¬¾å­—ä½“ <a href="https://fonts.google.com/specimen/Roboto">ä¼ é€é—¨</a>ã€‚å®ƒæä¾›äº†å¤šç§å­—ä½“å½¢å¼çš„é€‰æ‹©ï¼Œä¾‹å¦‚ï¼šç²—ä½“ï¼Œæ–œä½“ç­‰ç­‰ã€‚</p><p>2ã€åœ¨ Android ä¸­ï¼Œæˆ‘ä»¬ä¸€èˆ¬ä¼šç›´æ¥æˆ–é—´æ¥çš„é€šè¿‡ TextView æ§ä»¶å»æ‰¿è½½å­—ä½“çš„æ˜¾ç¤ºï¼Œå› ä¸ºå…³äº Android æä¾›çš„æ‰¿è½½å­—ä½“æ˜¾ç¤ºçš„æ§ä»¶éƒ½ä¼šç›´æ¥æˆ–é—´æ¥ç»§æ‰¿ TextViewï¼Œä¾‹å¦‚ï¼šEditTextï¼ŒButton ç­‰ç­‰ï¼Œä¸‹é¢ç»™å‡ºä¸€å¼  TextView ç»§æ‰¿å›¾ï¼š</p><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/d39161a73f724a768e1eabde15b04c4e~tplv-k3u1fbpfcp-zoom-1.image" alt="image-20210612124458481"></p><p>3ã€TextView ä¸­æœ‰ä¸‰ä¸ªå±æ€§å¯ä»¥è®¾ç½®å­—ä½“çš„æ˜¾ç¤ºï¼š</p><p>1ï¼‰ã€textStyle</p><p>2ï¼‰ã€typeface</p><p>3ï¼‰ã€fontFamily</p><p>ä¸‹é¢æˆ‘ä»¬é‡ç‚¹ä»‹ç»ä¸‹è¿™ä¸‰ä¸ªå±æ€§</p><h2 id="äºŒã€textStyle"><a href="#äºŒã€textStyle" class="headerlink" title="äºŒã€textStyle"></a>äºŒã€textStyle</h2><p><strong>textStyle</strong> ä¸»è¦ç”¨æ¥è®¾ç½®å­—ä½“çš„æ ·å¼ï¼Œæˆ‘ä»¬çœ‹ä¸‹å®ƒåœ¨ TextView çš„è‡ªå®šä¹‰å±æ€§ä¸­çš„ä¸€ä¸ªä½“ç°ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs xml">//TextView çš„è‡ªå®šä¹‰å±æ€§ textStyle<br><span class="hljs-tag">&lt;<span class="hljs-name">attr</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;textStyle&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">flag</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;normal&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;0&quot;</span> /&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">flag</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;bold&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;1&quot;</span> /&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">flag</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;italic&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;2&quot;</span> /&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">attr</span>&gt;</span><br></code></pre></td></tr></table></figure><p>ä»ä¸Šè¿°è‡ªå®šä¹‰å±æ€§ä¸­æˆ‘ä»¬å¯ä»¥çŸ¥é“ï¼š</p><p>1ã€textStyle ä¸»è¦æœ‰ 3 ç§æ ·å¼ï¼š</p><ul><li>normalï¼šé»˜è®¤å­—ä½“ </li><li>boldï¼šç²—ä½“</li><li>italicï¼šæ–œä½“</li></ul><p>2ã€textStyle æ˜¯ç”¨ flag æ¥æ‰¿è½½çš„ï¼Œflag è¡¨ç¤ºçš„å€¼å¯ä»¥åšæˆ–è¿ç®—ï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬å¯ä»¥è®¾ç½®å¤šç§å­—ä½“æ ·å¼è¿›è¡Œå åŠ </p><p>æ¥ä¸‹æ¥æˆ‘ä»¬åœ¨ xml ä¸­è®¾ç½®ä¸€ä¸‹ï¼Œå¦‚ä¸‹å›¾ï¼š</p><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/2e2f6c4a7ba141e0b05c0c45bd802b0a~tplv-k3u1fbpfcp-zoom-1.image" alt="image-20210612205549971"></p><p>å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬ç»™ TextView çš„ textStyle å±æ€§è®¾ç½®äº†<strong>ç²—ä½“å’Œæ–œä½“</strong>ä¸¤ç§æ ·å¼å åŠ ï¼Œå³è¾¹å¯ä»¥çœ‹åˆ°é¢„è§ˆæ•ˆæœ</p><p>åŒæ ·æˆ‘ä»¬ä¹Ÿå¯ä»¥åœ¨ä»£ç ä¸­å¯¹å…¶è¿›è¡Œè®¾ç½®ï¼Œä½†æ˜¯åœ¨ä»£ç ä¸­è®¾ç½®å­—ä½“æ ·å¼åªèƒ½è®¾ç½®ä¸€ç§ï¼Œä¸èƒ½å åŠ ï¼š</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs kotlin">mTextView.setTypeface(<span class="hljs-literal">null</span>, Typeface.BOLD)<br></code></pre></td></tr></table></figure><h2 id="ä¸‰ã€typeface"><a href="#ä¸‰ã€typeface" class="headerlink" title="ä¸‰ã€typeface"></a>ä¸‰ã€typeface</h2><p><strong>typeface</strong> ä¸»è¦ç”¨äºè®¾ç½® TextView çš„å­—ä½“ï¼Œæˆ‘ä»¬çœ‹ä¸‹å®ƒåœ¨ TextView çš„è‡ªå®šä¹‰å±æ€§ä¸­çš„ä¸€ä¸ªä½“ç°ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs xml">//TextView çš„è‡ªå®šä¹‰å±æ€§ typeface<br><span class="hljs-tag">&lt;<span class="hljs-name">attr</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;typeface&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">enum</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;normal&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;0&quot;</span> /&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">enum</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;sans&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;1&quot;</span> /&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">enum</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;serif&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;2&quot;</span> /&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">enum</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;monospace&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;3&quot;</span> /&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">attr</span>&gt;</span><br></code></pre></td></tr></table></figure><p>ä»ä¸Šè¿°è‡ªå®šä¹‰å±æ€§ä¸­æˆ‘ä»¬å¯ä»¥çŸ¥é“ï¼š</p><p>1ã€typeface æä¾›äº† 4 ç§å­—ä½“:</p><ul><li>noramlï¼šæ™®é€šå­—ä½“ï¼Œç³»ç»Ÿé»˜è®¤ä½¿ç”¨çš„å­—ä½“</li><li>sansï¼šéè¡¬çº¿å­—ä½“</li><li>serifï¼šè¡¬çº¿å­—ä½“</li><li>monospaceï¼šç­‰å®½å­—ä½“</li></ul><p>2ã€typeface æ˜¯ç”¨ enum æ¥æ‰¿è½½çš„ï¼Œenum è¡¨ç¤ºæšä¸¾ç±»å‹ï¼Œæ¯æ¬¡åªèƒ½é€‰æ‹©ä¸€ä¸ªï¼Œå› æ­¤æˆ‘ä»¬æ¯æ¬¡åªèƒ½è®¾ç½®ä¸€ç§å­—ä½“ï¼Œä¸èƒ½å åŠ </p><p>æ¥ä¸‹æ¥æˆ‘ä»¬åœ¨ xml ä¸­è®¾ç½®ä¸€ä¸‹ï¼Œå¦‚ä¸‹å›¾ï¼š</p><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/af5a02a649b74a8b8ca9eb05eeb7bbff~tplv-k3u1fbpfcp-zoom-1.image" alt="image-20210612133722082"></p><p>ç®€å•ä»‹ç»è¿™å‡ ç§å­—ä½“çš„åŒºåˆ«ï¼š</p><p>serif (è¡¬çº¿å­—ä½“)ï¼šåœ¨å­—çš„ç¬”åˆ’å¼€å§‹åŠç»“æŸçš„åœ°æ–¹æœ‰é¢å¤–çš„è£…é¥°ï¼Œè€Œä¸”ç¬”åˆ’çš„ç²—ç»†ä¼šå› ç›´æ¨ªçš„ä¸åŒè€Œæœ‰ä¸åŒç›¸</p><p>sans (éè¡¬çº¿å­—ä½“)ï¼šæ²¡æœ‰ serif å­—ä½“è¿™äº›é¢å¤–çš„è£…é¥°ï¼Œå’Œ noraml å­—ä½“æ˜¯ä¸€æ ·çš„</p><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/cdccfc3d87ec4fc29d5e8459f6a0972d~tplv-k3u1fbpfcp-zoom-1.image" alt="image-20210612134441993"></p><p>monospace (ç­‰å®½å­—ä½“)ï¼šé™åˆ¶æ¯ä¸ªå­—ç¬¦çš„å®½åº¦ï¼Œè®©å®ƒä»¬è¾¾åˆ°ä¸€ä¸ªç­‰å®½çš„æ•ˆæœ</p><p>åŒæ ·æˆ‘ä»¬ä¹Ÿå¯ä»¥åœ¨ä»£ç ä¸­è¿›è¡Œè®¾ç½®ï¼š</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs kotlin">mTv.setTypeface(Typeface.SERIF)<br></code></pre></td></tr></table></figure><h2 id="å››ã€fontFamily"><a href="#å››ã€fontFamily" class="headerlink" title="å››ã€fontFamily"></a>å››ã€fontFamily</h2><p>fontFamily ç›¸å½“äºæ˜¯åŠ å¼ºç‰ˆçš„ typefaceï¼Œå®ƒè¡¨ç¤º android ç³»ç»Ÿæ”¯æŒçš„ä¸€ç³»åˆ—å­—ä½“ï¼Œæ¯ä¸ªå­—ä½“éƒ½æœ‰ä¸€ä¸ªåˆ«åï¼Œæˆ‘ä»¬é€šè¿‡åˆ«åå°±èƒ½è®¾ç½®è¿™ç§å­—ä½“ï¼Œçœ‹ä¸‹å®ƒåœ¨ TextView çš„è‡ªå®šä¹‰å±æ€§ä¸­çš„ä¸€ä¸ªä½“ç°ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs xml">//TextView çš„è‡ªå®šä¹‰å±æ€§ fontFamily<br><span class="hljs-tag">&lt;<span class="hljs-name">attr</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;fontFamily&quot;</span> <span class="hljs-attr">format</span>=<span class="hljs-string">&quot;string&quot;</span> /&gt;</span><br></code></pre></td></tr></table></figure><p>ä»ä¸Šè¿°è‡ªå®šä¹‰å±æ€§ä¸­æˆ‘ä»¬å¯ä»¥çŸ¥é“ï¼š</p><p>fontFamily æ¥æ”¶çš„æ˜¯ä¸€ä¸ª String ç±»å‹çš„å€¼ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬å¯ä»¥é€šè¿‡å­—ä½“åˆ«åè®¾ç½®è¿™ç§å­—ä½“ï¼Œå¦‚ä¸‹å›¾ï¼š</p><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/eb550779d94c4e2d9765e9e965a64239~tplv-k3u1fbpfcp-zoom-1.image" alt="fontFamily"></p><p>å¯ä»¥çœ‹åˆ°ï¼Œå®ƒç»†è‡´çš„åŒºåˆ†äº†æ¯ä¸ªç³»åˆ—å­—ä½“çš„æ ·å¼ï¼ŒåŒæ ·æˆ‘ä»¬åœ¨ xml ä¸­å¯¹å®ƒè¿›è¡Œä¸€ä¸ªè®¾ç½®ï¼š</p><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/58193c885a64490aaf7d5f2f77b50348~tplv-k3u1fbpfcp-zoom-1.image" alt="image-20210612212209243"><br>æˆ‘ä»¬åœ¨ä»£ç ä¸­åœ¨å¯¹ä»–è¿›è¡Œä¸€ä¸ªè®¾ç½®ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">mTv.setTypeface(Typeface.create(<span class="hljs-string">&quot;sans-serif-medium&quot;</span>,Typeface.NORMAL))<br></code></pre></td></tr></table></figure><p><strong>å€¼çš„æ³¨æ„çš„æ˜¯</strong>ï¼šfontFamily è®¾ç½®çš„æŸäº›å­—ä½“æœ‰å…¼å®¹æ€§é—®é¢˜ï¼Œå¦‚æˆ‘ä¸Šé¢è®¾ç½®çš„ sans-serif-medium å­—ä½“ï¼Œå®ƒåœ¨ Android ç³»ç»Ÿç‰ˆæœ¬å¤§äºç­‰äº 21 æ‰ä¼šç”Ÿæ•ˆï¼Œå¦‚æœå°äº 21 ï¼Œåˆ™ä¼šä½¿ç”¨é»˜è®¤å­—ä½“ï¼Œå› æ­¤æˆ‘ä»¬åœ¨ä½¿ç”¨ fontFamily<br>å±æ€§æ—¶ï¼Œéœ€è¦æ³¨æ„è¿™ä¸ªé—®é¢˜</p><p>åˆ°è¿™é‡Œï¼Œæˆ‘ä»¬å°±æŠŠå½±å“ Android å­—ä½“çš„ 3 ä¸ªå±æ€§ç»™è®²å®Œäº†ï¼Œä½†æ˜¯æˆ‘å¿ƒé‡Œæœ‰ä¸ªç–‘é—®ğŸ¤”ï¸ ï¼Ÿå‡è®¾æˆ‘è¿™ä¸‰ä¸ªå±æ€§åŒæ—¶è®¾ç½®ï¼Œä¼šä¸€èµ·ç”Ÿæ•ˆå—ï¼Ÿ</p><p>å¸¦ç€è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬æ¢ç´¢ä¸€ä¸‹æºç </p><h2 id="äº”ã€textStyleï¼Œtypefaceï¼ŒfontFamily-ä¸‰è€…å…³ç³»åˆ†æ"><a href="#äº”ã€textStyleï¼Œtypefaceï¼ŒfontFamily-ä¸‰è€…å…³ç³»åˆ†æ" class="headerlink" title="äº”ã€textStyleï¼Œtypefaceï¼ŒfontFamily ä¸‰è€…å…³ç³»åˆ†æ"></a>äº”ã€textStyleï¼Œtypefaceï¼ŒfontFamily ä¸‰è€…å…³ç³»åˆ†æ</h2><p>TextView åœ¨æˆ‘ä»¬ä½¿ç”¨å®ƒä¹‹å‰éœ€è¿›è¡Œä¸€ä¸ªåˆå§‹åŒ–ï¼Œæœ€ç»ˆä¼šè°ƒç”¨å®ƒå‚æ•°æœ€å¤šçš„é‚£ä¸ªæ„é€ æ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-title function_">TextView</span><span class="hljs-params">(Context context, <span class="hljs-meta">@Nullable</span> AttributeSet attrs, <span class="hljs-type">int</span> defStyleAttr, <span class="hljs-type">int</span> defStyleRes)</span> &#123;<br>    <span class="hljs-built_in">super</span>(context, attrs, defStyleAttr, defStyleRes);<br>  <span class="hljs-comment">//çœç•¥æˆå¨ä»£ç .....</span><br>  <span class="hljs-comment">//è¯»å–è®¾ç½®çš„å±æ€§</span><br>  readTextAppearance(context, appearance, attributes, <span class="hljs-literal">false</span> <span class="hljs-comment">/* styleArray */</span>);<br>  <span class="hljs-comment">//è®¾ç½®å­—ä½“</span><br>  applyTextAppearance(attributes);<br> &#125;<br><br><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">applyTextAppearance</span><span class="hljs-params">(TextAppearanceAttributes attributes)</span> &#123;<br>   <span class="hljs-comment">//çœç•¥æˆå¨ä»£ç .....</span><br>  setTypefaceFromAttrs(attributes.mFontTypeface, attributes.mFontFamily,<br>                attributes.mTypefaceIndex, attributes.mTextStyle, attributes.mFontWeight);<br>&#125;<br></code></pre></td></tr></table></figure><p>ä¸Šé¢è¿™æ¡è°ƒç”¨é“¾ï¼Œé¦–å…ˆä¼šè¯»å– TextView è®¾ç½®çš„ç›¸å…³å±æ€§ï¼Œæˆ‘ä»¬çœ‹ä¸‹ä¸å­—ä½“ç›¸å…³çš„å‡ ä¸ªï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">readTextAppearance</span><span class="hljs-params">(Context context, TypedArray appearance,</span><br><span class="hljs-params">            TextAppearanceAttributes attributes, <span class="hljs-type">boolean</span> styleArray)</span> &#123;<br>  <span class="hljs-comment">//...</span><br>  <span class="hljs-keyword">switch</span> (index) &#123;<br>     <span class="hljs-keyword">case</span> com.android.internal.R.styleable.TextAppearance_typeface:<br>                attributes.mTypefaceIndex = appearance.getInt(attr, attributes.mTypefaceIndex);<br>                <span class="hljs-keyword">if</span> (attributes.mTypefaceIndex != -<span class="hljs-number">1</span> &amp;&amp; !attributes.mFontFamilyExplicit) &#123;<br>                    attributes.mFontFamily = <span class="hljs-literal">null</span>;<br>                &#125;<br>                <span class="hljs-keyword">break</span>;<br>            <span class="hljs-keyword">case</span> com.android.internal.R.styleable.TextAppearance_fontFamily:<br>                <span class="hljs-keyword">if</span> (!context.isRestricted() &amp;&amp; context.canLoadUnsafeResources()) &#123;<br>                    <span class="hljs-keyword">try</span> &#123;<br>                        attributes.mFontTypeface = appearance.getFont(attr);<br>                    &#125; <span class="hljs-keyword">catch</span> (UnsupportedOperationException | Resources.NotFoundException e) &#123;<br>                        <span class="hljs-comment">// Expected if it is not a font resource.</span><br>                    &#125;<br>                &#125;<br>                <span class="hljs-keyword">if</span> (attributes.mFontTypeface == <span class="hljs-literal">null</span>) &#123;<br>                    attributes.mFontFamily = appearance.getString(attr);<br>                &#125;<br>                attributes.mFontFamilyExplicit = <span class="hljs-literal">true</span>;<br>                <span class="hljs-keyword">break</span>;<br>            <span class="hljs-keyword">case</span> com.android.internal.R.styleable.TextAppearance_textStyle:<br>                attributes.mTextStyle = appearance.getInt(attr, attributes.mTextStyle);<br>                <span class="hljs-keyword">break</span>;<br>            <span class="hljs-comment">//...</span><br>       <span class="hljs-keyword">default</span>:<br>     &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ä»ä¸Šè¿°ä»£ç ä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼š</p><p>1ã€å½“æˆ‘ä»¬è®¾ç½® typeface å±æ€§æ—¶ï¼Œä¼šå°†å¯¹åº”çš„å±æ€§å€¼èµ‹ç»™ mTypefaceIndex ï¼Œå¹¶æŠŠ mFontFamily ç½®ä¸º null</p><p>2ã€å½“æˆ‘ä»¬è®¾ç½® fontFamily å±æ€§æ—¶ï¼Œé¦–å…ˆä¼šé€šè¿‡ appearance.getFont() æ–¹æ³•å»è·å–å­—ä½“æ–‡ä»¶ï¼Œå¦‚æœèƒ½è·å–åˆ°ï¼Œåˆ™èµ‹å€¼ç»™ mFontTypefaceï¼Œå¦‚æœè·å–ä¸åˆ°ï¼Œåˆ™é€šè¿‡ appearance.getString() æ–¹æ³•å–è·å–å½“å‰å­—ä½“åˆ«åå¹¶èµ‹å€¼ç»™ mFontFamily</p><p><strong>æ³¨æ„</strong>ï¼šå½“æˆ‘ä»¬ç»™ fontFamily è®¾ç½®äº†ä¸€äº›ç¬¬ä¸‰æ–¹å­—ä½“ï¼Œé‚£ä¹ˆæ­¤æ—¶  appearance.getFont() æ–¹æ³•å°±è·å–ä¸åˆ°å­—ä½“</p><p>3ã€å½“æˆ‘ä»¬è®¾ç½® textStyle å±æ€§æ—¶ï¼Œä¼šå°†è·å–çš„å±æ€§å€¼èµ‹ç»™ mTextStyle </p><p>ä¸Šè¿°æ–¹æ³•èµ°å®Œäº†ï¼Œä¼šè°ƒ setTypefaceFromAttrs() æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•å°±æ˜¯æœ€ç»ˆ TextView è®¾ç½®å­—ä½“çš„æ–¹æ³•ï¼Œæˆ‘ä»¬æ¥è§£æä¸‹è¿™ä¸ªæ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setTypefaceFromAttrs</span><span class="hljs-params">(<span class="hljs-meta">@Nullable</span> Typeface typeface, <span class="hljs-meta">@Nullable</span> String familyName,</span><br><span class="hljs-params">            <span class="hljs-meta">@XMLTypefaceAttr</span> <span class="hljs-type">int</span> typefaceIndex, <span class="hljs-meta">@Typeface</span>.Style <span class="hljs-type">int</span> style,</span><br><span class="hljs-params">            <span class="hljs-meta">@IntRange(from = -1, to = FontStyle.FONT_WEIGHT_MAX)</span> <span class="hljs-type">int</span> weight)</span> &#123;<br>    <span class="hljs-keyword">if</span> (typeface == <span class="hljs-literal">null</span> &amp;&amp; familyName != <span class="hljs-literal">null</span>) &#123;<br>        <span class="hljs-comment">// Lookup normal Typeface from system font map.</span><br>        <span class="hljs-keyword">final</span> <span class="hljs-type">Typeface</span> <span class="hljs-variable">normalTypeface</span> <span class="hljs-operator">=</span> Typeface.create(familyName, Typeface.NORMAL);<br>        resolveStyleAndSetTypeface(normalTypeface, style, weight);<br>    &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (typeface != <span class="hljs-literal">null</span>) &#123;<br>        resolveStyleAndSetTypeface(typeface, style, weight);<br>    &#125; <span class="hljs-keyword">else</span> &#123;  <span class="hljs-comment">// both typeface and familyName is null.</span><br>        <span class="hljs-keyword">switch</span> (typefaceIndex) &#123;<br>            <span class="hljs-keyword">case</span> SANS:<br>                resolveStyleAndSetTypeface(Typeface.SANS_SERIF, style, weight);<br>                <span class="hljs-keyword">break</span>;<br>            <span class="hljs-keyword">case</span> SERIF:<br>                resolveStyleAndSetTypeface(Typeface.SERIF, style, weight);<br>                <span class="hljs-keyword">break</span>;<br>            <span class="hljs-keyword">case</span> MONOSPACE:<br>                resolveStyleAndSetTypeface(Typeface.MONOSPACE, style, weight);<br>                <span class="hljs-keyword">break</span>;<br>            <span class="hljs-keyword">case</span> DEFAULT_TYPEFACE:<br>            <span class="hljs-keyword">default</span>:<br>                resolveStyleAndSetTypeface(<span class="hljs-literal">null</span>, style, weight);<br>                <span class="hljs-keyword">break</span>;<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ä¸Šè¿°ä»£ç æ­¥éª¤ï¼š</p><p>1ã€å½“ typeface ä¸ºç©ºå¹¶ä¸” familyName ä¸ä¸ºç©ºæ—¶ï¼Œå– familyName çš„å­—ä½“</p><p>2ã€å½“ typeface ä¸ä¸ºç©ºå¹¶ä¸” familyName ä¸ºç©ºæ—¶ï¼Œå– typeface çš„å­—ä½“</p><p>3ã€å½“ typeface å’Œ familyName éƒ½ä¸ºç©ºï¼Œåˆ™æ ¹æ® typefaceIndex çš„å€¼å–ç›¸åº”çš„å­—ä½“</p><p>4ã€typeface ï¼ŒfamilyName å’Œ typefaceIndex åœ¨æˆ‘ä»¬åˆ†æçš„ readTextAppearance æ–¹æ³•ä¼šè¢«èµ‹å€¼</p><p>5ã€resolveStyleAndSetTypefce æ–¹æ³•ä¼šè¿›è¡Œå­—ä½“å’Œå­—ä½“æ ·å¼çš„è®¾ç½®</p><p>6ã€style æ˜¯åœ¨ readTextAppearance æ–¹æ³•ä¸­èµ‹å€¼çš„ï¼Œä»–å’Œè®¾ç½®å­—ä½“å¹¶ä¸å†²çª</p><p>å¥½ï¼Œç°åœ¨ä»£ç åˆ†æçš„å·®ä¸å¤šäº†ï¼Œæˆ‘ä»¬å†æ¥çœ‹ä¸‹ä¸Šé¢é‚£ä¸ªç–‘é—®ï¼Ÿæˆ‘ä»¬ä½¿ç”¨å‡è®¾æ³•æ¥è¿›è¡Œæ¨å¯¼ï¼š</p><p>å‡è®¾åœ¨ Xml ä¸­ï¼Œ typefaceï¼ŒfamilyName å’Œ textStyle æˆ‘éƒ½è®¾ç½®äº†ï¼Œé‚£ä¹ˆæ ¹æ®ä¸Šé¢åˆ†æï¼š</p><p>1ã€textStyle è‚¯å®šä¼šç”Ÿæ•ˆ</p><p>2ã€å½“è®¾ç½®äº† typeface å±æ€§ï¼ŒtypefaceIndex ä¼šè¢«èµ‹å€¼ï¼ŒåŒæ—¶ familyName ä¼šç½®ä¸ºç©º</p><p>3ã€å½“è®¾ç½®äº† familyName å±æ€§ï¼Œåˆ†æƒ…å†µï¼š1ã€å¦‚æœè®¾ç½®çš„æ˜¯ç³»ç»Ÿå­—ä½“ï¼Œtypeface ä¼šè¢«èµ‹å€¼ï¼ŒfamilyName è¿˜æ˜¯ä¸ºç©ºã€‚2ã€å¦‚æœè®¾ç½®çš„æ˜¯ç¬¬ä¸‰æ–¹å­—ä½“ï¼Œtypeface ä¸ºç©ºï¼ŒfamilyName è¢«èµ‹å€¼</p><p>å› æ­¤ï¼Œå½“æˆ‘ä»¬è®¾ç½®äº†è¿™ä¸ªä¸‰ä¸ªå±æ€§ï¼Œtypeface å’Œ familyName æ€»æœ‰ä¸€ä¸ªä¸ä¼šä¸ºç©ºï¼Œå› æ­¤ä¸ä¼šèµ°ç¬¬ä¸‰ä¸ªæ¡ä»¶ä½“ï¼Œé‚£ä¹ˆ typeface è®¾ç½®çš„å±æ€§å°±ä¸ä¼šç”Ÿæ•ˆäº†ï¼Œè€Œå‰©ä¸‹çš„ä¸¤ä¸ªå±æ€§éƒ½èƒ½å¤Ÿç”Ÿæ•ˆ</p><p>æœ€åå¯¹è¿™ä¸‰ä¸ªå±æ€§åšä¸€ä¸ªæ€»ç»“ï¼š</p><p><strong>1ã€fontFamilyã€typeface å±æ€§ç”¨äºå­—ä½“è®¾ç½®ï¼Œå¦‚æœéƒ½è®¾ç½®äº†ï¼Œä¼˜å…ˆä½¿ç”¨ fontFamily å±æ€§ï¼Œtypeface å±æ€§ä¸ä¼šç”Ÿæ•ˆ</strong></p><p><strong>2ã€textStyle ç”¨äºå­—ä½“æ ·å¼è®¾ç½®ï¼Œä¸å­—ä½“è®¾ç½®ä¸ä¼šäº§ç”Ÿå†²çª</strong></p><p>ä¸Šé¢è¿™æ®µæºç åˆ†æå¯èƒ½æœ‰ç‚¹ç»•ï¼Œå¦‚æœæœ‰ä¸æ¸…æ¥šçš„åœ°æ–¹ï¼Œæ¬¢è¿è¯„è®ºåŒºç»™æˆ‘ç•™è¨€æé—®</p><h2 id="å…­ã€TextView-è®¾ç½®å­—ä½“å±æ€§æºç åˆ†æ"><a href="#å…­ã€TextView-è®¾ç½®å­—ä½“å±æ€§æºç åˆ†æ" class="headerlink" title="å…­ã€TextView è®¾ç½®å­—ä½“å±æ€§æºç åˆ†æ"></a>å…­ã€TextView è®¾ç½®å­—ä½“å±æ€§æºç åˆ†æ</h2><p>é€šè¿‡ä¸Šé¢æºç çš„åˆ†æï¼Œæˆ‘ä»¬æ¸…æ¥šäº† fontFamilyï¼Œtypeface å’Œ textStyle è¿™ä¸‰è€…çš„å…³ç³»ã€‚æ¥ä¸‹æ¥æˆ‘ä»¬ç ”ç©¶ä¸€ä¸‹ï¼Œæˆ‘ä»¬è®¾ç½®çš„è¿™äº›å±æ€§æ˜¯æ€ä¹ˆå®ç°è¿™äº›æ•ˆæœçš„å‘¢ï¼Ÿåˆåˆ°äº†æºç åˆ†æç¯èŠ‚ğŸ˜‚ï¼Œå¯èƒ½ä¼šæœ‰ç‚¹æ¯ç‡¥ï¼Œä½†æ˜¯å¦‚æœä½ èƒ½å¤Ÿè®¤çœŸçœ‹å®Œï¼Œä¸€å®šä¼šæ”¶è·å¾ˆå¤šï¼Œå¹²å°±å®Œäº†</p><p>æˆ‘ä»¬ä¸Šé¢ç”¨ Xml æˆ–ä»£ç è®¾ç½®çš„å­—ä½“å±æ€§ï¼Œæœ€ç»ˆéƒ½ä¼šèµ°åˆ° TextView çš„ setTypeface é‡è½½æ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//é‡è½½æ–¹æ³•ä¸€</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setTypeface</span><span class="hljs-params">(<span class="hljs-meta">@Nullable</span> Typeface tf)</span> &#123;<br>    <span class="hljs-keyword">if</span> (mTextPaint.getTypeface() != tf) &#123;<br>      <span class="hljs-comment">//é€šè¿‡ mTextPaint è®¾ç½®å­—ä½“</span><br>        mTextPaint.setTypeface(tf);<br>      <br>      <span class="hljs-comment">//åˆ·æ–°é‡ç»˜</span><br>        <span class="hljs-keyword">if</span> (mLayout != <span class="hljs-literal">null</span>) &#123;<br>            nullLayouts();<br>            requestLayout();<br>            invalidate();<br>        &#125;<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">//é‡è½½æ–¹æ³•äºŒ</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setTypeface</span><span class="hljs-params">(<span class="hljs-meta">@Nullable</span> Typeface tf, <span class="hljs-meta">@Typeface</span>.Style <span class="hljs-type">int</span> style)</span> &#123;<br>  <span class="hljs-keyword">if</span> (style &gt; <span class="hljs-number">0</span>) &#123;<br>        <span class="hljs-keyword">if</span> (tf == <span class="hljs-literal">null</span>) &#123;<br>            tf = Typeface.defaultFromStyle(style);<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            tf = Typeface.create(tf, style);<br>        &#125;<br><span class="hljs-comment">//è°ƒç”¨é‡è½½æ–¹æ³•ä¸€ï¼Œè®¾ç½®å­—ä½“</span><br>        setTypeface(tf);<br>      <span class="hljs-comment">//ç»è¿‡ä¸€äº›ç®—æ³•</span><br>        <span class="hljs-type">int</span> <span class="hljs-variable">typefaceStyle</span> <span class="hljs-operator">=</span> tf != <span class="hljs-literal">null</span> ? tf.getStyle() : <span class="hljs-number">0</span>;<br>        <span class="hljs-type">int</span> <span class="hljs-variable">need</span> <span class="hljs-operator">=</span> style &amp; ~typefaceStyle;<br>      <span class="hljs-comment">//æ‰“å¼€ç”»ç¬”çš„ç²—ä½“å’Œæ–œä½“</span><br>        mTextPaint.setFakeBoldText((need &amp; Typeface.BOLD) != <span class="hljs-number">0</span>);<br>        mTextPaint.setTextSkewX((need &amp; Typeface.ITALIC) != <span class="hljs-number">0</span> ? -<span class="hljs-number">0.25f</span> : <span class="hljs-number">0</span>);<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        mTextPaint.setFakeBoldText(<span class="hljs-literal">false</span>);<br>        mTextPaint.setTextSkewX(<span class="hljs-number">0</span>);<br>        setTypeface(tf);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>åˆ†æä¸‹ä¸Šè¿°ä»£ç ï¼š</p><p>é‡è½½æ–¹æ³•ä¸€ï¼š</p><p>TextView è®¾ç½®å­—ä½“å®é™…ä¸Šå°±æ˜¯æ“ä½œ mTextPaintï¼ŒmTextPaint æ˜¯ TextPaint çš„ç±»å¯¹è±¡ï¼Œç»§æ‰¿è‡ª Paint å³ç”»ç¬”ï¼Œå› æ­¤æˆ‘ä»¬è®¾ç½®çš„å­—ä½“å®é™…ä¸Šä¼šé€šè¿‡è°ƒç”¨ç”»ç¬”çš„æ–¹æ³•æ¥è¿›è¡Œç»˜åˆ¶</p><p>é‡è½½æ–¹æ³•äºŒï¼š</p><p>ç›¸å¯¹äºé‡è½½æ–¹æ³•ä¸€ï¼Œæ³•äºŒå¤šä¼ é€’äº†ä¸€ä¸ª textStyle å‚æ•°ï¼Œä¸»è¦ç”¨æ¥æ ‡è®°ç²—ä½“å’Œæ–œä½“çš„ï¼š</p><p>1ï¼‰ã€å¦‚æœè®¾ç½®äº† textStyle ï¼Œè¿›å…¥ç¬¬ä¸€ä¸ªæ¡ä»¶ä½“ï¼Œåˆ†æƒ…å†µï¼š1ã€å¦‚æœä¼ è¿›æ¥çš„ tf ä¸º null ï¼Œåˆ™ä¼šæ ¹æ®ä¼ å…¥çš„ style å»è·å– Typeface å­—ä½“ï¼Œ2ã€å¦‚æœä¸ä¸º null ï¼Œåˆ™ä¼šæ ¹æ®ä¼ å…¥çš„ tf å’Œ style å»è·å– Typeface å­—ä½“ã€‚è®¾ç½®å¥½å­—ä½“åï¼Œæ¥ä¸‹æ¥è¿˜ä¼šæ‰“å¼€ç”»ç¬”çš„ç²—ä½“å’Œæ–œä½“è®¾ç½®</p><p>2ï¼‰ã€å¦‚æœæ²¡æœ‰è®¾ç½® textStyleï¼Œåˆ™åªä¼šè®¾ç½®å­—ä½“ï¼Œå¹¶æŠŠç”»ç¬”çš„ç²—æ–œä½“è®¾ç½®ç½®ä¸º false å’Œ 0</p><p>ä»ä¸Šè¿°åˆ†ææˆ‘ä»¬å¯ä»¥å¾—çŸ¥ï¼š<strong>TextView è®¾ç½®å­—ä½“å’Œå­—ä½“æ ·å¼æœ€ç»ˆéƒ½æ˜¯é€šè¿‡ç”»ç¬”æ¥å®Œæˆçš„</strong></p><h2 id="ä¸ƒã€æ€»ç»“"><a href="#ä¸ƒã€æ€»ç»“" class="headerlink" title="ä¸ƒã€æ€»ç»“"></a>ä¸ƒã€æ€»ç»“</h2><p>æœ¬ç¯‡æ–‡ç« ä¸»è¦è®²äº†ï¼š</p><p>1ã€Android å­—ä½“å¤§æ¦‚çš„ä¸€ä¸ªä»‹ç»</p><p>2ã€å…³äºå½±å“ Android å­—ä½“æ˜¾ç¤ºçš„ä¸‰ä¸ªå±æ€§</p><p>3ã€textStyleï¼Œtypefaceï¼ŒfontFamily ä¸‰è€…çš„ä¸€ä¸ªå…³ç³»</p><p>4ã€è®¾ç½®çš„è¿™ä¸‰ä¸ªå±æ€§æ˜¯æ€ä¹ˆå®ç°è¿™äº›æ•ˆæœçš„ï¼Ÿ</p><p>å¯èƒ½å¤§å®¶ä¼šé—®ï¼Œä½ ä¸Šé¢é‚£ä¸ªéœ€æ±‚è¿˜æ²¡è®²æ€ä¹ˆå°±è¦ç»“æŸäº†å‘¢ï¼Ÿæˆ‘ä¸Šé¢é‚£ä¸ªéœ€æ±‚ï¼Œä»¥ä»Šå¤©æ‰€è®²çš„çŸ¥è¯†å¯èƒ½è¿˜å®ç°ä¸äº†ï¼Œåˆ«ç€æ€¥ï¼Œå…³äº Android å­—ä½“æˆ‘å‡†å¤‡å†™ä¸ªç³»åˆ—ï¼Œå› ä¸ºå†…å®¹å®åœ¨æ˜¯å¤ªå¤šäº†ã€‚è¿™ä¸ªç³»åˆ—æ–‡ç« ä¸ä¼šè®©å¤§å®¶ç­‰å¤ªä¹…ï¼Œå› ä¸ºåœ¨å‚åŠ æ˜é‡‘ 6 æœˆæ›´æ–‡æŒ‘æˆ˜ï¼Œå‡†å¤‡çˆ†è‚ 9 ç¯‡ğŸ˜„</p><p>å¥½äº†ï¼Œæœ¬ç¯‡æ–‡ç« åˆ°è¿™é‡Œå°±ç»“æŸäº†ï¼Œå¦‚æœæœ‰ä»»ä½•é—®é¢˜ï¼Œæ¬¢è¿ç»™æˆ‘ç•™è¨€ï¼Œæˆ‘ä»¬è¯„è®ºåŒºä¸€èµ·è®¨è®ºğŸ¤</p><p><strong>æ„Ÿè°¢ä½ é˜…è¯»è¿™ç¯‡æ–‡ç« </strong></p><blockquote><p><strong>ä½ çš„ç‚¹èµï¼Œè¯„è®ºï¼Œæ˜¯å¯¹æˆ‘å·¨å¤§çš„é¼“åŠ±ï¼</strong></p><p>æ¬¢è¿å…³æ³¨æˆ‘çš„<strong>å…¬ä¼—å·ï¼š</strong>  <a href="http://m6z.cn/6jwi7b"><strong>sweetying</strong></a> ï¼Œæ–‡ç« æ›´æ–°å¯ç¬¬ä¸€æ—¶é—´æ”¶åˆ°</p><p>å¦‚æœ<strong>æœ‰é—®é¢˜</strong>ï¼Œå…¬ä¼—å·å†…æœ‰åŠ æˆ‘å¾®ä¿¡çš„å…¥å£ï¼Œåœ¨æŠ€æœ¯å­¦ä¹ ã€ä¸ªäººæˆé•¿çš„é“è·¯ä¸Šï¼Œæˆ‘ä»¬ä¸€èµ·å‰è¿›ï¼</p></blockquote>]]></content>
    
    
    <categories>
      
      <category>Android</category>
      
      <category>Font</category>
      
    </categories>
    
    
    <tags>
      
      <tag>åŸåˆ›</tag>
      
      <tag>Android</tag>
      
      <tag>Android Font</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Gradle ç³»åˆ— ï¼ˆå››ï¼‰ã€Gradle æ’ä»¶å®æˆ˜åº”ç”¨</title>
    <link href="/2022/10/11/Gradle%20%E7%B3%BB%E5%88%97%20%EF%BC%88%E5%9B%9B%EF%BC%89%E3%80%81Gradle%20%E6%8F%92%E4%BB%B6%E5%AE%9E%E6%88%98%E5%BA%94%E7%94%A8/"/>
    <url>/2022/10/11/Gradle%20%E7%B3%BB%E5%88%97%20%EF%BC%88%E5%9B%9B%EF%BC%89%E3%80%81Gradle%20%E6%8F%92%E4%BB%B6%E5%AE%9E%E6%88%98%E5%BA%94%E7%94%A8/</url>
    
    <content type="html"><![CDATA[<p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/0e23167cf69c4ce5b86bd8ddf3640aec~tplv-k3u1fbpfcp-watermark.image"></p><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>å¾ˆé«˜å…´é‡è§ä½ ~</p><p>å…³äº Gradle å­¦ä¹ ï¼Œæˆ‘æ‰€ç†è§£çš„æµç¨‹å¦‚ä¸‹å›¾ï¼š</p><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/3e010cee57604e179607243e027608d4~tplv-k3u1fbpfcp-zoom-1.image" alt="Gradle_learning"></p><p>åœ¨æœ¬ç³»åˆ—çš„ä¸Šä¸€ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬è®²äº†è‡ªå®šä¹‰ Gradle æ’ä»¶ç›¸å…³çš„å†…å®¹ï¼Œå®Œæˆäº†ç¬¬ä¸‰ä¸ªç¯èŠ‚ã€‚è¿˜æ²¡æœ‰çœ‹è¿‡ä¸Šä¸€ç¯‡æ–‡ç« çš„æœ‹å‹ï¼Œå»ºè®®å…ˆå»é˜…è¯» <a href="https://juejin.cn/post/6988051489306443789">Gradle ç³»åˆ— ï¼ˆä¸‰ï¼‰ã€Gradle æ’ä»¶å¼€å‘</a>ã€‚</p><p>ä»Šå¤©æˆ‘ä»¬ä»‹ç»çš„è¿˜æ˜¯ç¯èŠ‚ä¸‰ï¼šGradle æ’ä»¶å®æˆ˜åº”ç”¨</p><p><a href="https://github.com/sweetying520/GradleDemo">Github Demo åœ°å€</a> , å¤§å®¶å¯ä»¥ç»“åˆ demo ä¸€èµ·çœ‹ï¼Œæ•ˆæœæ æ æ»´ğŸº</p><h2 id="ä¸€ã€å›é¡¾"><a href="#ä¸€ã€å›é¡¾" class="headerlink" title="ä¸€ã€å›é¡¾"></a>ä¸€ã€å›é¡¾</h2><p>ä¹‹å‰åœ¨è®² <a href="https://juejin.cn/post/6979191724983713805">Android APT ç³»åˆ— ï¼ˆå››ï¼‰ï¼šAPT å®æˆ˜åº”ç”¨</a> çš„æ—¶å€™ï¼Œæˆ‘ä»¬åšäº†ä¸€æ¬¡å¸ƒå±€ä¼˜åŒ–ï¼ŒAndroid ä¸­å°‘é‡çš„ç³»ç»Ÿæ§ä»¶æ˜¯é€šè¿‡ <code>new</code> çš„æ–¹å¼åˆ›å»ºå‡ºæ¥çš„ï¼Œè€Œå¤§éƒ¨åˆ†æ§ä»¶å¦‚ <code>androidx.appcompat.widget</code> ä¸‹çš„æ§ä»¶ï¼Œè‡ªå®šä¹‰æ§ä»¶ï¼Œç¬¬ä¸‰æ–¹æ§ä»¶ç­‰ç­‰ï¼Œéƒ½æ˜¯é€šè¿‡åå°„åˆ›å»ºçš„ã€‚å¤§é‡çš„åå°„åˆ›å»ºå¤šå¤šå°‘å°‘ä¼šå¸¦æ¥ä¸€äº›æ€§èƒ½é—®é¢˜ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦å»è§£å†³åå°„åˆ›å»ºçš„é—®é¢˜ï¼Œæˆ‘çš„è§£å†³æ€è·¯æ˜¯ï¼š</p><blockquote><p>1ã€é€šè¿‡ç¼–å†™ Android æ’ä»¶è·å– Xml å¸ƒå±€ä¸­çš„æ‰€æœ‰æ§ä»¶</p><p>2ã€æ‹¿åˆ°æ§ä»¶åï¼Œé€šè¿‡ APT ç”Ÿæˆç”¨ <code>new</code> çš„æ–¹å¼åˆ›å»º View çš„ç±»</p><p>3ã€æœ€åé€šè¿‡åå°„è·å–å½“å‰ç±»å¹¶åœ¨åŸºç±»é‡Œé¢å®Œæˆæ›¿æ¢</p></blockquote><p>å…¶ä¸­ 1 çš„å…·ä½“æµç¨‹æ˜¯ï¼šé€šè¿‡ Android æ’ä»¶è·å–æ‰€æœ‰ Xml å¸ƒå±€ä¸­çš„æ§ä»¶åç§°ï¼Œå¹¶å†™å…¥åˆ°ä¸€ä¸ª<code>.txt</code>æ–‡ä»¶ä¸­ã€‚å›  Gradle ç³»åˆ—è¿˜æ²¡è®²ï¼Œå½“æ—¶åªæ˜¯å‡è®¾è¿™ä¹ˆä¸€ä¸ªæ–‡ä»¶å·²ç»å­˜åœ¨ï¼Œé‚£ä¹ˆç°åœ¨æˆ‘ä»¬å·²ç»ä¼šäº†å¦‚ä½•è‡ªå®šä¹‰ Gradle æ’ä»¶ï¼Œæˆ‘ä»¬å°±æ¥å®ç°ä¸€ä¸‹å®ƒã€‚</p><p>åœ¨æ­¤ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦å…ˆäº†è§£ Extension å’Œ Variants ï¼Œåç»­ä¼šç”¨åˆ°</p><h2 id="äºŒã€Extension-ä»‹ç»"><a href="#äºŒã€Extension-ä»‹ç»" class="headerlink" title="äºŒã€Extension ä»‹ç»"></a>äºŒã€Extension ä»‹ç»</h2><h3 id="1ï¼‰ã€ä»€ä¹ˆæ˜¯-Extension-ï¼Ÿ"><a href="#1ï¼‰ã€ä»€ä¹ˆæ˜¯-Extension-ï¼Ÿ" class="headerlink" title="1ï¼‰ã€ä»€ä¹ˆæ˜¯ Extension ï¼Ÿ"></a>1ï¼‰ã€ä»€ä¹ˆæ˜¯ Extension ï¼Ÿ</h3><p>Extension ä¸­æ–‡æ„æ€å³æ‰©å±•ã€‚å®ƒçš„ä½œç”¨å°±æ˜¯é€šè¿‡å®ç°è‡ªå®šä¹‰çš„ Extensionï¼Œå¯ä»¥åœ¨ Gradle è„šæœ¬æ–‡ä»¶ä¸­å¢åŠ ç±»ä¼¼ android è¿™æ ·å‘½åçš„ç©ºé—´é…ç½®ï¼ŒGradle å¯ä»¥è¯†åˆ«è¿™ç§é…ç½®ï¼Œå¹¶è¯»å–é‡Œé¢çš„é…ç½®å†…å®¹ã€‚ä»¥ä¸€æ®µæˆ‘ä»¬ç†Ÿæ‚‰çš„ Android é…ç½®ä¸ºä¾‹ï¼Œå¦‚ä¸‹ï¼š</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs groovy">android &#123;<br>    compileSdkVersion <span class="hljs-number">30</span><br><br>    defaultConfig &#123;<br>        applicationId <span class="hljs-string">&#x27;com.dream.gradledemo&#x27;</span><br>        minSdkVersion <span class="hljs-number">19</span><br>        targetSdkVersion <span class="hljs-number">30</span><br>        versionCode <span class="hljs-number">1</span><br>        versionName <span class="hljs-string">&#x27;1.0&#x27;</span><br><br>        testInstrumentationRunner <span class="hljs-string">&quot;androidx.test.runner.AndroidJUnitRunner&quot;</span><br>    &#125;<br><br>    buildTypes &#123;<br>        release &#123;<br>            minifyEnabled <span class="hljs-literal">false</span><br>            proguardFiles getDefaultProguardFile(<span class="hljs-string">&#x27;proguard-android-optimize.txt&#x27;</span>), <span class="hljs-string">&#x27;proguard-rules.pro&#x27;</span><br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ä¸Šè¿°ä»£ç ä¹‹æ‰€ä»¥èƒ½å¤Ÿè¿™æ ·é…ç½®ï¼Œæ˜¯å› ä¸º Android Gradle Plugin å®šä¹‰äº†è¿™äº› Extension </p><p>é‚£ä¹ˆå¦‚ä½•å»è‡ªå®šä¹‰ Extension å‘¢ï¼Ÿ</p><p>ç­”ï¼šé€šè¿‡ ExtensionContainer</p><h3 id="2ï¼‰ã€é€šè¿‡-ExtensionContainer-è‡ªå®šä¹‰-Extension"><a href="#2ï¼‰ã€é€šè¿‡-ExtensionContainer-è‡ªå®šä¹‰-Extension" class="headerlink" title="2ï¼‰ã€é€šè¿‡ ExtensionContainer è‡ªå®šä¹‰ Extension"></a>2ï¼‰ã€é€šè¿‡ ExtensionContainer è‡ªå®šä¹‰ Extension</h3><p>ExtensionContainer å’Œ TaskContainer å¾ˆç±»ä¼¼ï¼Œä¸Šç¯‡æ–‡ç« æˆ‘ä»¬è®²åˆ° TaskContainer å°±æ˜¯ç®¡ç† Task çš„ä¸€ä¸ªå®¹å™¨ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ TaskContainer å»å¯¹ Task è¿›è¡Œç›¸åº”çš„æ“ä½œã€‚åŒç†ï¼ŒExtensionContainer æ˜¯ç®¡ç† Extension çš„ä¸€ä¸ªå®¹å™¨ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ ExtensionContainer å»å¯¹ Extension è¿›è¡Œç›¸åº”çš„æ“ä½œï¼ŒExtensionContainer åŒæ ·å¯ä»¥é€šè¿‡ Project å¯¹è±¡è·å–åˆ°ï¼š</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs groovy"><span class="hljs-comment">//å½“å‰åœ¨ app çš„ build.gradle æ–‡ä»¶ä¸­</span><br><br><span class="hljs-comment">//ä¸‹é¢è¿™ 4 ç§æ–¹å¼æ‹¿åˆ°çš„éƒ½æ˜¯åŒä¸€ä¸ªå®ä¾‹</span><br><span class="hljs-comment">//æ–¹å¼1</span><br>extensions<br><span class="hljs-comment">//æ–¹å¼2</span><br>project.extensions<br><span class="hljs-comment">//æ–¹å¼3</span><br>getExtensions()<br><span class="hljs-comment">//æ–¹å¼4</span><br>project.getExtensions()<br></code></pre></td></tr></table></figure><p>é€šè¿‡ ExtensionContainer åˆ›å»ºæ‰©å±•çš„æ–¹å¼æœ‰ä¸¤ç§ï¼š</p><p>1ã€é€šè¿‡ ExtensionContainer çš„ create ç³»åˆ—æ–¹æ³•åˆ›å»º Extension</p><p>2ã€é€šè¿‡ ExtensionContainer çš„ add ç³»åˆ—æ–¹æ³•åˆ›å»º Extension</p><h3 id="3ï¼‰ã€é€šè¿‡-ExtensionContainer-çš„-create-ç³»åˆ—æ–¹æ³•åˆ›å»º-Extension"><a href="#3ï¼‰ã€é€šè¿‡-ExtensionContainer-çš„-create-ç³»åˆ—æ–¹æ³•åˆ›å»º-Extension" class="headerlink" title="3ï¼‰ã€é€šè¿‡ ExtensionContainer çš„ create ç³»åˆ—æ–¹æ³•åˆ›å»º Extension"></a>3ï¼‰ã€é€šè¿‡ ExtensionContainer çš„ create ç³»åˆ—æ–¹æ³•åˆ›å»º Extension</h3><p>é¦–å…ˆçœ‹ä¸€çœ¼ ExtensionContainer æä¾›çš„ create ç³»åˆ—æ–¹æ³•ï¼š</p><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/b025403581ff4f5fad2a4f888e786500~tplv-k3u1fbpfcp-zoom-1.image" alt="image-20210725182159725"></p><p>ä¸Šè¿°æˆªå›¾å¯ä»¥çœ‹åˆ°å®ƒæœ‰ä¸‰ä¸ªé‡è½½æ–¹æ³•ï¼Œæˆ‘ä»¬ä¸€ä¸€ä»‹ç»ä¸‹</p><h4 id="1ã€ç¬¬ä¸€ä¸ªé‡è½½æ–¹æ³•"><a href="#1ã€ç¬¬ä¸€ä¸ªé‡è½½æ–¹æ³•" class="headerlink" title="1ã€ç¬¬ä¸€ä¸ªé‡è½½æ–¹æ³•"></a>1ã€ç¬¬ä¸€ä¸ªé‡è½½æ–¹æ³•</h4><p><strong>å‚æ•°ä»‹ç»ï¼š</strong></p><blockquote><p>sï¼šè¦åˆ›å»ºçš„ Extension çš„åå­—ï¼Œå¯ä»¥æ˜¯ä»»æ„ç¬¦åˆå‘½åè§„åˆ™çš„å­—ç¬¦ä¸²ï¼Œä¸èƒ½ä¸å·²æœ‰çš„é‡å¤ï¼Œå¦åˆ™ä¼šæŠ›å¼‚å¸¸</p><p>aClassï¼šè¯¥ Extension çš„ Class ç±»å‹å¯¹è±¡</p><p>objectsï¼šå½“å‰ç±»çš„æ„é€ å‡½æ•°å‚æ•°å€¼ï¼Œè¯¥å‚æ•°ä¸ºå¯é€‰é¡¹ï¼Œä¸å¡«åˆ™å–é»˜è®¤å€¼</p></blockquote><h4 id="2ã€ç¬¬äºŒä¸ªé‡è½½æ–¹æ³•"><a href="#2ã€ç¬¬äºŒä¸ªé‡è½½æ–¹æ³•" class="headerlink" title="2ã€ç¬¬äºŒä¸ªé‡è½½æ–¹æ³•"></a>2ã€ç¬¬äºŒä¸ªé‡è½½æ–¹æ³•</h4><p><strong>å‚æ•°ä»‹ç»ï¼š</strong></p><blockquote><p>aClassï¼šåˆ›å»ºçš„ Extension å®ä¾‹æš´éœ²å‡ºæ¥çš„ Class ç±»å‹å¯¹è±¡ï¼Œä¸€èˆ¬è¿™é‡Œæˆ‘ä»¬ä¼šæŒ‡å®šçˆ¶ç±»çš„ Class ç±»å‹å¯¹è±¡</p><p>sï¼šè¦åˆ›å»ºçš„ Extension çš„åå­—ï¼Œå¯ä»¥æ˜¯ä»»æ„ç¬¦åˆå‘½åè§„åˆ™çš„å­—ç¬¦ä¸²ï¼Œä¸èƒ½ä¸å·²æœ‰çš„é‡å¤ï¼Œå¦åˆ™ä¼šæŠ›å¼‚å¸¸</p><p>aClass1ï¼šè¯¥ Extension å…·ä½“çš„å®ç° Class ç±»å‹å¯¹è±¡</p><p>objectsï¼šå…·ä½“å®ç°ç±»çš„æ„é€ å‡½æ•°å‚æ•°å€¼ï¼Œè¯¥å‚æ•°ä¸ºå¯é€‰é¡¹ï¼Œä¸å¡«åˆ™å–é»˜è®¤å€¼</p></blockquote><h4 id="3ã€ç¬¬ä¸‰ä¸ªé‡è½½æ–¹æ³•"><a href="#3ã€ç¬¬ä¸‰ä¸ªé‡è½½æ–¹æ³•" class="headerlink" title="3ã€ç¬¬ä¸‰ä¸ªé‡è½½æ–¹æ³•"></a>3ã€ç¬¬ä¸‰ä¸ªé‡è½½æ–¹æ³•</h4><p><strong>å‚æ•°ä»‹ç»ï¼š</strong></p><blockquote><p>typeOfï¼šåˆ›å»ºçš„ Extension å®ä¾‹æš´éœ²å‡ºæ¥çš„ TypeOf ç±»å‹å¯¹è±¡ï¼Œä¸€èˆ¬è¿™é‡Œæˆ‘ä»¬ä¼šæŒ‡å®šçˆ¶ç±»çš„ TypeOf ç±»å‹å¯¹è±¡</p><p>sï¼šè¦åˆ›å»ºçš„ Extension çš„åå­—ï¼Œå¯ä»¥æ˜¯ä»»æ„ç¬¦åˆå‘½åè§„åˆ™çš„å­—ç¬¦ä¸²ï¼Œä¸èƒ½ä¸å·²æœ‰çš„é‡å¤ï¼Œå¦åˆ™ä¼šæŠ›å¼‚å¸¸</p><p>aClassï¼šè¯¥ Extension å…·ä½“çš„å®ç° Class ç±»å‹å¯¹è±¡</p><p>objectsï¼šå…·ä½“å®ç°ç±»çš„æ„é€ å‡½æ•°å‚æ•°å€¼ï¼Œè¯¥å‚æ•°ä¸ºå¯é€‰é¡¹ï¼Œä¸å¡«åˆ™å–é»˜è®¤å€¼</p></blockquote><h4 id="4ã€å…·ä½“ä½¿ç”¨"><a href="#4ã€å…·ä½“ä½¿ç”¨" class="headerlink" title="4ã€å…·ä½“ä½¿ç”¨"></a>4ã€å…·ä½“ä½¿ç”¨</h4><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><code class="hljs groovy"><span class="hljs-comment">//å½“å‰åœ¨ app çš„ build.gradle æ–‡ä»¶ä¸­</span><br><br><span class="hljs-comment">//ç¬¬ä¸€æ­¥ï¼šå¢åŠ å®ä½“ç±»é…ç½®</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Animal</span>&#123;<br><br>    String animalName<br>    <span class="hljs-type">int</span> legs<br><br>    Animal()&#123;<br><br>    &#125;<br><br>    Animal(String animalName) &#123;<br>        <span class="hljs-variable language_">this</span>.animalName = animalName<br>    &#125;<br><br>    String toString() &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;This animal is $animalName, it has $legs legs.&quot;</span><br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Dog</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Animal</span>&#123;<br>    <span class="hljs-type">int</span> age = <span class="hljs-number">5</span><br><br>    Dog()&#123;<br>      <br>    &#125;<br><br>    Dog(<span class="hljs-type">int</span> age) &#123;<br>        <span class="hljs-variable language_">this</span>.age = age<br>    &#125;<br><br>    String toString() &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">super</span>.toString() + <span class="hljs-string">&quot; Its age is $age.&quot;</span><br>    &#125;<br>&#125;<br><br><span class="hljs-comment">//ç¬¬äºŒæ­¥ï¼šåˆ›å»º Extension</span><br><span class="hljs-comment">//=================== ExtensionContainer create ç¬¬ä¸€ä¸ªé‡è½½æ–¹æ³• =========================</span><br>project.extensions.create(<span class="hljs-string">&#x27;animal1&#x27;</span>,Dog)<br><br><span class="hljs-comment">//=================== ExtensionContainer create ç¬¬äºŒä¸ªé‡è½½æ–¹æ³• =========================</span><br>project.extensions.create(Animal,<span class="hljs-string">&#x27;animal2&#x27;</span>,Dog,<span class="hljs-number">10</span>)<br><br><span class="hljs-comment">//=================== ExtensionContainer create ç¬¬ä¸‰ä¸ªé‡è½½æ–¹æ³• =========================</span><br>project.extensions.create(TypeOf.typeOf(Animal),<span class="hljs-string">&#x27;animal3&#x27;</span>,Dog,<span class="hljs-number">15</span>)<br><br><span class="hljs-comment">//ç¬¬ä¸‰æ­¥ï¼šè¿›è¡Œè¯­å¥å—é…ç½®</span><br>animal1&#123;<br>    animalName <span class="hljs-string">&#x27;å¤§é»„&#x27;</span><br>    legs <span class="hljs-number">4</span><br>&#125;<br><br>animal2&#123;<br>    animalName <span class="hljs-string">&#x27;äºŒé»„&#x27;</span><br>    legs <span class="hljs-number">4</span><br>&#125;<br><br>animal3&#123;<br>    animalName <span class="hljs-string">&#x27;ä¸‰é»„&#x27;</span><br>    legs <span class="hljs-number">4</span><br>&#125;<br><br><span class="hljs-comment">//ç¬¬å››æ­¥ï¼šç¼–å†™ Task è¿›è¡Œæµ‹è¯•</span><br>project.task(<span class="hljs-string">&#x27;testTask&#x27;</span>)&#123;<br>    doLast &#123;<br>        println project.animal1<br>        println project.animal2<br>        println project.animal3<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">//æ‰§è¡Œ testTask</span><br>./gradlew testTask<br><br><span class="hljs-comment">//æ‰“å°ç»“æœ</span><br>&gt; <span class="hljs-attr">Task :</span><span class="hljs-attr">app:</span>testTask<br>This animal is å¤§é»„, it has <span class="hljs-number">4</span> legs. Its age is <span class="hljs-number">5.</span><br>This animal is äºŒé»„, it has <span class="hljs-number">4</span> legs. Its age is <span class="hljs-number">10.</span><br>This animal is ä¸‰é»„, it has <span class="hljs-number">4</span> legs. Its age is <span class="hljs-number">15.</span><br></code></pre></td></tr></table></figure><p><strong>æ³¨æ„ï¼š</strong> Groovy è¯­æ³•è§„å®šï¼Œå½“ä¼ å…¥ Class å¯¹è±¡ä½œä¸ºå‚æ•°çš„æ—¶å€™ï¼Œ<code>.class</code> åç¼€å¯çœç•¥ï¼Œå¦‚ï¼š<code>Animal.class</code> å¯ä»¥å†™æˆ <code>Animal</code>ï¼Œå¯¹ Groovy è¯­æ³•è¿˜ä¸ç†Ÿçš„å¯ä»¥æŸ¥çœ‹æˆ‘è¿™ç¯‡æ–‡ç«  <a href="https://juejin.cn/post/6939662617224937503">ä¼ é€é—¨</a></p><h3 id="4ï¼‰ã€é€šè¿‡-ExtensionContainer-çš„-add-ç³»åˆ—æ–¹æ³•åˆ›å»º-Extension"><a href="#4ï¼‰ã€é€šè¿‡-ExtensionContainer-çš„-add-ç³»åˆ—æ–¹æ³•åˆ›å»º-Extension" class="headerlink" title="4ï¼‰ã€é€šè¿‡ ExtensionContainer çš„ add ç³»åˆ—æ–¹æ³•åˆ›å»º Extension"></a>4ï¼‰ã€é€šè¿‡ ExtensionContainer çš„ add ç³»åˆ—æ–¹æ³•åˆ›å»º Extension</h3><p>é¦–å…ˆè¿˜æ˜¯å…ˆçœ‹ä¸€çœ¼ ExtensionContainer æä¾›çš„ add ç³»åˆ—æ–¹æ³•ï¼š</p><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/ee01092e480f4907803dcec035daf77a~tplv-k3u1fbpfcp-zoom-1.image" alt="image-20210725181835083"></p><p>å¯ä»¥çœ‹åˆ°å®ƒä¹Ÿæœ‰ä¸‰ä¸ªé‡è½½æ–¹æ³•ï¼Œæˆ‘ä»¬ä¸€ä¸€ä»‹ç»ä¸‹</p><h4 id="1ã€ç¬¬ä¸€ä¸ªé‡è½½æ–¹æ³•-1"><a href="#1ã€ç¬¬ä¸€ä¸ªé‡è½½æ–¹æ³•-1" class="headerlink" title="1ã€ç¬¬ä¸€ä¸ªé‡è½½æ–¹æ³•"></a>1ã€ç¬¬ä¸€ä¸ªé‡è½½æ–¹æ³•</h4><p><strong>å‚æ•°ä»‹ç»ï¼š</strong></p><blockquote><p>sï¼šè¦åˆ›å»ºçš„ Extension çš„åå­—ï¼Œå¯ä»¥æ˜¯ä»»æ„ç¬¦åˆå‘½åè§„åˆ™çš„å­—ç¬¦ä¸²ï¼Œä¸èƒ½ä¸å·²æœ‰çš„é‡å¤ï¼Œå¦åˆ™ä¼šæŠ›å¼‚å¸¸</p><p>oï¼šObject ç±»å‹ï¼Œå¯ä»¥æ˜¯å®ä¾‹å¯¹è±¡æˆ– Class å¯¹è±¡</p></blockquote><h4 id="2ã€ç¬¬äºŒä¸ªé‡è½½æ–¹æ³•-1"><a href="#2ã€ç¬¬äºŒä¸ªé‡è½½æ–¹æ³•-1" class="headerlink" title="2ã€ç¬¬äºŒä¸ªé‡è½½æ–¹æ³•"></a>2ã€ç¬¬äºŒä¸ªé‡è½½æ–¹æ³•</h4><p><strong>å‚æ•°ä»‹ç»ï¼š</strong></p><blockquote><p>aClassï¼šåˆ›å»ºçš„ Extension å®ä¾‹æš´éœ²å‡ºæ¥çš„ Class ç±»å‹å¯¹è±¡ï¼Œä¸€èˆ¬è¿™é‡Œæˆ‘ä»¬ä¼šæŒ‡å®šçˆ¶ç±»çš„ Class ç±»å‹å¯¹è±¡</p><p>sï¼šè¦åˆ›å»ºçš„ Extension çš„åå­—ï¼Œå¯ä»¥æ˜¯ä»»æ„ç¬¦åˆå‘½åè§„åˆ™çš„å­—ç¬¦ä¸²ï¼Œä¸èƒ½ä¸å·²æœ‰çš„é‡å¤ï¼Œå¦åˆ™ä¼šæŠ›å¼‚å¸¸</p><p>tï¼šObject ç±»å‹ï¼Œå…·ä½“çš„ Class å¯¹è±¡æˆ–å®ä¾‹å¯¹è±¡</p></blockquote><h4 id="3ã€ç¬¬ä¸‰ä¸ªé‡è½½æ–¹æ³•-1"><a href="#3ã€ç¬¬ä¸‰ä¸ªé‡è½½æ–¹æ³•-1" class="headerlink" title="3ã€ç¬¬ä¸‰ä¸ªé‡è½½æ–¹æ³•"></a>3ã€ç¬¬ä¸‰ä¸ªé‡è½½æ–¹æ³•</h4><p><strong>å‚æ•°ä»‹ç»ï¼š</strong></p><blockquote><p>typeOfï¼šåˆ›å»ºçš„ Extension å®ä¾‹æš´éœ²å‡ºæ¥çš„ TypeOf ç±»å‹å¯¹è±¡ï¼Œä¸€èˆ¬è¿™é‡Œæˆ‘ä»¬ä¼šæŒ‡å®šçˆ¶ç±»çš„ TypeOf ç±»å‹å¯¹è±¡</p><p>sï¼šè¦åˆ›å»ºçš„ Extension çš„åå­—ï¼Œå¯ä»¥æ˜¯ä»»æ„ç¬¦åˆå‘½åè§„åˆ™çš„å­—ç¬¦ä¸²ï¼Œä¸èƒ½ä¸å·²æœ‰çš„é‡å¤ï¼Œå¦åˆ™ä¼šæŠ›å¼‚å¸¸</p><p>tï¼šObject ç±»å‹ï¼Œå…·ä½“çš„ Class å¯¹è±¡æˆ–å®ä¾‹å¯¹è±¡</p></blockquote><h4 id="4ã€å…·ä½“ä½¿ç”¨-1"><a href="#4ã€å…·ä½“ä½¿ç”¨-1" class="headerlink" title="4ã€å…·ä½“ä½¿ç”¨"></a>4ã€å…·ä½“ä½¿ç”¨</h4><p>æˆ‘ä»¬ä¿®æ”¹ä¸Šè¿°ä»£ç çš„ç¬¬äºŒæ­¥å’Œç¬¬ä¸‰æ­¥å®ç°ä¸ä¹‹å‰ä¸€æ ·çš„æ‰“å°æ•ˆæœ</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs groovy"><span class="hljs-comment">//å½“å‰åœ¨ app çš„ build.gradle æ–‡ä»¶ä¸­</span><br><br><span class="hljs-comment">//=================== ExtensionContainer add ç¬¬ä¸€ä¸ªé‡è½½æ–¹æ³• =========================</span><br>project.extensions.add(<span class="hljs-string">&#x27;animal1&#x27;</span>,Dog)<br><br><span class="hljs-comment">//=================== ExtensionContainer add ç¬¬äºŒä¸ªé‡è½½æ–¹æ³• =========================</span><br>project.extensions.add(Animal,<span class="hljs-string">&#x27;animal2&#x27;</span>,<span class="hljs-keyword">new</span> Dog(<span class="hljs-number">10</span>))<br><br><span class="hljs-comment">//=================== ExtensionContainer add ç¬¬ä¸‰ä¸ªé‡è½½æ–¹æ³• =========================</span><br>project.extensions.add(TypeOf.typeOf(Animal),<span class="hljs-string">&#x27;animal3&#x27;</span>,<span class="hljs-keyword">new</span> Dog(<span class="hljs-number">15</span>))<br><br>animal1&#123;<br>    animalName <span class="hljs-string">&#x27;å¤§é»„&#x27;</span><br>    legs <span class="hljs-number">4</span><br>&#125;<br><br><span class="hljs-comment">//æ³¨æ„è¿™é‡Œä½¿ç”¨äº† = å·</span><br>animal2&#123;<br>    animalName = <span class="hljs-string">&#x27;äºŒé»„&#x27;</span><br>    legs = <span class="hljs-number">4</span><br>&#125;<br><br><span class="hljs-comment">//æ³¨æ„è¿™é‡Œä½¿ç”¨äº† = å·</span><br>animal3&#123;<br>    animalName = <span class="hljs-string">&#x27;ä¸‰é»„&#x27;</span><br>    legs = <span class="hljs-number">4</span><br>&#125;<br></code></pre></td></tr></table></figure><p><strong>æ³¨æ„ï¼š</strong> ä¸Šè¿° add ç³»åˆ—ç¬¬äºŒä¸ªå’Œç¬¬ä¸‰ä¸ªé‡è½½æ–¹æ³•ï¼Œå½“æˆ‘ä»¬æ˜¾ç¤ºçš„åˆ›å»ºäº†ç±»å®ä¾‹ï¼Œé‚£ä¹ˆåœ¨è¿›è¡Œ Extension é…ç½®çš„æ—¶å€™ï¼Œéœ€è¦åŠ ä¸Š <strong>&#x3D;</strong> å·ï¼Œå¦åˆ™ä¼šæŠ¥é”™</p><h3 id="5ï¼‰ã€å®šä¹‰å±æ€§åŒåçš„æ–¹æ³•å»æ‰-x3D-å·"><a href="#5ï¼‰ã€å®šä¹‰å±æ€§åŒåçš„æ–¹æ³•å»æ‰-x3D-å·" class="headerlink" title="5ï¼‰ã€å®šä¹‰å±æ€§åŒåçš„æ–¹æ³•å»æ‰ &#x3D; å·"></a>5ï¼‰ã€å®šä¹‰å±æ€§åŒåçš„æ–¹æ³•å»æ‰ &#x3D; å·</h3><p>å¦‚æœæƒ³å»æ‰ä¸Šè¿°ä½¿ç”¨ add ç³»åˆ—ç¬¬äºŒä¸ªå’Œç¬¬ä¸‰ä¸ªé‡è½½æ–¹æ³•é…ç½®è¯­å¥çš„ <strong>&#x3D;</strong> å·ï¼Œæˆ‘ä»¬å¯ä»¥å®šä¹‰å’Œå±æ€§åŒåçš„æ–¹æ³•ï¼Œå¦‚ä¸‹ï¼š</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs groovy"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Animal</span>&#123;<br><br>    String animalName<br>    <span class="hljs-type">int</span> legs<br><br>    <span class="hljs-type">void</span> animalName(String animalName)&#123;<br>        <span class="hljs-variable language_">this</span>.animalName = animalName<br>    &#125;<br><br>    <span class="hljs-type">void</span> legs(<span class="hljs-type">int</span> legs)&#123;<br>        <span class="hljs-variable language_">this</span>.legs = legs<br>    &#125;<br>    <span class="hljs-comment">//...</span><br>&#125;<br><br><span class="hljs-comment">//é‚£ä¹ˆè¿™ä¸ªæ—¶å€™å°±å¯ä»¥è¿™æ ·å†™äº†</span><br>animal2&#123;<br>    animalName <span class="hljs-string">&#x27;äºŒé»„&#x27;</span><br>    legs <span class="hljs-number">4</span><br>&#125;<br><br>animal3&#123;<br>    animalName = <span class="hljs-string">&#x27;ä¸‰é»„&#x27;</span><br>    legs = <span class="hljs-number">4</span><br>&#125;<br></code></pre></td></tr></table></figure><h3 id="6ï¼‰ã€create-ç³»åˆ—æ–¹æ³•å’Œ-add-ç³»åˆ—æ–¹æ³•æ¯”è¾ƒ"><a href="#6ï¼‰ã€create-ç³»åˆ—æ–¹æ³•å’Œ-add-ç³»åˆ—æ–¹æ³•æ¯”è¾ƒ" class="headerlink" title="6ï¼‰ã€create ç³»åˆ—æ–¹æ³•å’Œ add ç³»åˆ—æ–¹æ³•æ¯”è¾ƒ"></a>6ï¼‰ã€create ç³»åˆ—æ–¹æ³•å’Œ add ç³»åˆ—æ–¹æ³•æ¯”è¾ƒ</h3><h4 id="ç›¸åŒç‚¹ï¼š"><a href="#ç›¸åŒç‚¹ï¼š" class="headerlink" title="ç›¸åŒç‚¹ï¼š"></a>ç›¸åŒç‚¹ï¼š</h4><blockquote><p>1ã€éƒ½å¯ä»¥é€šè¿‡é”®å€¼å¯¹çš„æ–¹å¼è¿›è¡Œé…ç½®ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ <strong>&#x3D;</strong> è¿›è¡Œé…ç½®ï¼Œæœ€ç»ˆè°ƒç”¨çš„éƒ½æ˜¯å±æ€§çš„ setter æ–¹æ³•</p><p>2ã€éƒ½ä¼šæŠ›å¼‚å¸¸ï¼šå½“éœ€è¦åˆ›å»ºçš„ Extension å·²ç»å­˜åœ¨çš„æ—¶å€™ï¼Œå³ Extension é‡å¤ï¼Œåˆ™ä¼šæŠ›å¼‚å¸¸</p></blockquote><h4 id="ä¸åŒç‚¹ï¼š"><a href="#ä¸åŒç‚¹ï¼š" class="headerlink" title="ä¸åŒç‚¹ï¼š"></a>ä¸åŒç‚¹ï¼š</h4><blockquote><p>1ã€create ç³»åˆ—æ–¹æ³•ä¼šå°†ä¼ å…¥çš„æ³›å‹ T ä½œä¸ºè¿”å›å€¼ã€‚add ç³»åˆ—æ–¹æ³•å¹¶ä¸ä¼š</p><p>2ã€add ç³»åˆ—ç¬¬äºŒä¸ªå’Œç¬¬ä¸‰ä¸ªé‡è½½æ–¹æ³•ï¼Œå½“æˆ‘ä»¬æ˜¾ç¤ºçš„åˆ›å»ºäº†ç±»å®ä¾‹ï¼Œåœ¨è¿›è¡Œ Extension é…ç½®çš„æ—¶å€™éœ€åŠ ä¸Š <strong>&#x3D;</strong> ï¼Œcreate ç³»åˆ—æ–¹æ³•ä¸éœ€è¦</p></blockquote><h3 id="7ï¼‰ã€é€šè¿‡-ExtensionContainer-getByName-å’Œ-findByName-ç³»åˆ—æ–¹æ³•æŸ¥æ‰¾-Extension"><a href="#7ï¼‰ã€é€šè¿‡-ExtensionContainer-getByName-å’Œ-findByName-ç³»åˆ—æ–¹æ³•æŸ¥æ‰¾-Extension" class="headerlink" title="7ï¼‰ã€é€šè¿‡ ExtensionContainer getByName å’Œ findByName ç³»åˆ—æ–¹æ³•æŸ¥æ‰¾ Extension"></a>7ï¼‰ã€é€šè¿‡ ExtensionContainer getByName å’Œ findByName ç³»åˆ—æ–¹æ³•æŸ¥æ‰¾ Extension</h3><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs groovy"><span class="hljs-comment">//1ã€find ç³»åˆ—æ–¹æ³•</span><br>Object findByName(String name)<br>&lt;T&gt; T findByType(Class&lt;T&gt; type)<br><br><span class="hljs-comment">//2ã€get ç³»åˆ—æ–¹æ³•</span><br>Object getByName(String name)<br>&lt;T&gt; T getByType(Class&lt;T&gt; type)<br><br><span class="hljs-comment">//3ã€find ç³»åˆ—æ–¹æ³•å’Œ get ç³»åˆ—æ–¹æ³•åŒºåˆ«</span><br><span class="hljs-comment">//get ç³»åˆ—æ–¹æ³•æ‰¾ä¸åˆ°ä¼šæŠ›å¼‚å¸¸ï¼Œfind ç³»åˆ—æ–¹æ³•ä¸ä¼š</span><br><br><span class="hljs-comment">//4ã€å…·ä½“ä½¿ç”¨</span><br>println project.extensions.getByName(<span class="hljs-string">&quot;animal1&quot;</span>)<br>println project.extensions.getByName(<span class="hljs-string">&quot;animal2&quot;</span>)<br>println project.extensions.getByName(<span class="hljs-string">&quot;animal3&quot;</span>)<br><br>println project.extensions.findByName(<span class="hljs-string">&quot;animal1&quot;</span>)<br>println project.extensions.findByName(<span class="hljs-string">&quot;animal2&quot;</span>)<br>println project.extensions.findByName(<span class="hljs-string">&quot;animal3&quot;</span>)<br><br><span class="hljs-comment">//æ‰“å°ç»“æœå‡ä¸º</span><br>This animal is å¤§é»„, it has <span class="hljs-number">4</span> legs. Its age is <span class="hljs-number">5.</span><br>This animal is äºŒé»„, it has <span class="hljs-number">4</span> legs. Its age is <span class="hljs-number">10.</span><br>This animal is ä¸‰é»„, it has <span class="hljs-number">4</span> legs. Its age is <span class="hljs-number">15.</span><br></code></pre></td></tr></table></figure><h3 id="8ï¼‰ã€é…ç½®åµŒå¥—-Extension"><a href="#8ï¼‰ã€é…ç½®åµŒå¥—-Extension" class="headerlink" title="8ï¼‰ã€é…ç½®åµŒå¥— Extension"></a>8ï¼‰ã€é…ç½®åµŒå¥— Extension</h3><h5 id="1ã€é€šè¿‡å®šä¹‰æ–¹æ³•é…ç½®åµŒå¥—-Extension"><a href="#1ã€é€šè¿‡å®šä¹‰æ–¹æ³•é…ç½®åµŒå¥—-Extension" class="headerlink" title="1ã€é€šè¿‡å®šä¹‰æ–¹æ³•é…ç½®åµŒå¥— Extension"></a>1ã€é€šè¿‡å®šä¹‰æ–¹æ³•é…ç½®åµŒå¥— Extension</h5><p>æˆ‘ä»¬ç»å¸¸åœ¨ android é…ç½®å—çœ‹åˆ°è¿™ç§åµŒå¥— Extension ï¼Œå¦‚ä¸‹ï¼š</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs groovy">android &#123;<br>    compileSdkVersion <span class="hljs-number">30</span><br>    defaultConfig &#123;<br>        applicationId <span class="hljs-string">&#x27;com.dream.gradledemo&#x27;</span><br>        minSdkVersion <span class="hljs-number">19</span><br>        targetSdkVersion <span class="hljs-number">30</span><br>        versionCode <span class="hljs-number">1</span><br>        versionName <span class="hljs-string">&#x27;1.0&#x27;</span><br>    &#125;<br>    <span class="hljs-comment">//...</span><br>&#125;<br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬å®ç°ä¸€ä¸ªç±»ä¼¼çš„ï¼š</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><code class="hljs groovy"><span class="hljs-comment">//å½“å‰åœ¨ app çš„ build.gradle æ–‡ä»¶ä¸­</span><br><br><span class="hljs-comment">//ç¬¬ä¸€æ­¥ï¼šå¢åŠ å®ä½“ç±»é…ç½®</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">AndroidExt</span>&#123;<br>    <span class="hljs-type">int</span> compileSdkVersionExt<br><br>    DefaultConfigExt defaultConfigExt = <span class="hljs-keyword">new</span> DefaultConfigExt()<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * æ–¹å¼1:</span><br><span class="hljs-comment">     * é€šè¿‡ Action åˆ›å»ºå†…éƒ¨ Extensionï¼Œåç§°ä¸ºæ–¹æ³•å defaultConfig</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * @param action å¯æ‰§è¡Œçš„åŠ¨ä½œï¼Œå®è´¨ä¸Šæ˜¯ä¸€ä¸ªä»£ç å—</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-type">void</span> defaultConfigExt(Action&lt;DefaultConfigExt&gt; action) &#123;<br>        action.execute(defaultConfigExt)<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * æ–¹å¼2:</span><br><span class="hljs-comment">     * é€šè¿‡ ConfigureUtil åˆ›å»ºå†…éƒ¨ Extensionï¼Œåç§°ä¸ºæ–¹æ³•å defaultConfig</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * @param closure é—­åŒ…ï¼Œå®è´¨ä¸Šæ˜¯ä¸€ä¸ªä»£ç å—</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-type">void</span> defaultConfigExt(Closure&lt;DefaultConfigExt&gt; closure) &#123;<br>        org.gradle.util.ConfigureUtil.configure(closure, defaultConfigExt)<br>    &#125;<br><br>&#125;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">DefaultConfigExt</span>&#123;<br>    String applicationIdExt<br>    <span class="hljs-type">int</span> minSdkVersionExt<br>    <span class="hljs-type">int</span> targetSdkVersionExt<br>    <span class="hljs-type">int</span> versionCodeExt<br>    String versionNameExt<br>&#125;<br><br><span class="hljs-comment">//ç¬¬äºŒæ­¥ï¼šåˆ›å»º Extension</span><br>project.extensions.create(<span class="hljs-string">&#x27;androidExt&#x27;</span>,AndroidExt)<br><br><span class="hljs-comment">//ç¬¬ä¸‰æ­¥ï¼šè¿›è¡Œè¯­å¥å—é…ç½®</span><br>androidExt &#123;<br>    compileSdkVersionExt <span class="hljs-number">30</span><br>    defaultConfigExt &#123;<br>        applicationIdExt = <span class="hljs-string">&#x27;com.dream.gradledemo&#x27;</span><br>        minSdkVersionExt = <span class="hljs-number">19</span><br>        targetSdkVersionExt = <span class="hljs-number">30</span><br>        versionCodeExt = <span class="hljs-number">1</span><br>        versionNameExt = <span class="hljs-string">&#x27;1.0&#x27;</span><br>    &#125;<br>&#125;<br><br><span class="hljs-comment">//ç¬¬å››æ­¥ï¼šç¼–å†™ Task è¿›è¡Œæµ‹è¯•</span><br>project.tasks.create(<span class="hljs-string">&#x27;extensionNested&#x27;</span>)&#123;<br>    doLast &#123;<br>        println project.androidExt.compileSdkVersionExt<br>        println project.androidExt.defaultConfigExt.applicationIdExt<br>        println project.androidExt.defaultConfigExt.minSdkVersionExt<br>        println project.androidExt.defaultConfigExt.targetSdkVersionExt<br>        println project.androidExt.defaultConfigExt.versionCodeExt<br>        println project.androidExt.defaultConfigExt.versionNameExt<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">//æ‰§è¡Œ extensionNested</span><br>./gradlew extensionNested<br><br><span class="hljs-comment">//æ‰“å°ç»“æœ</span><br>&gt; <span class="hljs-attr">Task :</span><span class="hljs-attr">app:</span>extensionNested<br><span class="hljs-number">30</span><br>com.dream.gradledemo<br><span class="hljs-number">19</span><br><span class="hljs-number">30</span><br><span class="hljs-number">1</span><br><span class="hljs-number">1.0</span><br></code></pre></td></tr></table></figure><p>ä¸Šè¿°ä»£ç æˆ‘ä»¬å®ç°äº†ä¸€ä¸ªå’Œ android é…ç½®å—ç±»ä¼¼çš„é…ç½®ï¼Œå…³é”®ä»£ç åœ¨äºï¼š</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs groovy">DefaultConfigExt defaultConfigExt = <span class="hljs-keyword">new</span> DefaultConfigExt()<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * æ–¹å¼1:</span><br><span class="hljs-comment"> * é€šè¿‡ Action åˆ›å»ºå†…éƒ¨ Extensionï¼Œåç§°ä¸ºæ–¹æ³•å defaultConfig</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * @param action å¯æ‰§è¡Œçš„åŠ¨ä½œï¼Œå®è´¨ä¸Šæ˜¯ä¸€ä¸ªä»£ç å—</span><br><span class="hljs-comment"> */</span><br><span class="hljs-type">void</span> defaultConfigExt(Action&lt;DefaultConfigExt&gt; action) &#123;<br>    action.execute(defaultConfigExt)<br>&#125;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * æ–¹å¼2:</span><br><span class="hljs-comment"> * é€šè¿‡ ConfigureUtil åˆ›å»ºå†…éƒ¨ Extensionï¼Œåç§°ä¸ºæ–¹æ³•å defaultConfig</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * @param closure é—­åŒ…ï¼Œå®è´¨ä¸Šæ˜¯ä¸€ä¸ªä»£ç å—</span><br><span class="hljs-comment"> */</span><br><span class="hljs-type">void</span> defaultConfigExt(Closure&lt;DefaultConfigExt&gt; closure) &#123;<br>    org.gradle.util.ConfigureUtil.configure(closure, defaultConfigExt)<br>&#125;<br></code></pre></td></tr></table></figure><p>ä¸Šé¢ä¿©ä¸ªæ–¹æ³•æ˜¯ç”¨æ¥åˆ›å»ºå†…éƒ¨ Extensionï¼Œå®é™…ä½¿ç”¨åªéœ€è¦å…¶ä¸­ä¸€ä¸ªæ–¹æ³•å°±è¡Œï¼Œ<strong>éœ€è¦æ³¨æ„çš„æ˜¯æ–¹æ³•çš„åå­—å°½é‡å’Œå±æ€§çš„åå­—ä¿æŒä¸€è‡´</strong></p><p>ä¸çŸ¥ä½ æœ‰æ²¡æœ‰å‘ç°ï¼Œä¸Šè¿°æˆ‘çš„ defaultConfigExt é…ç½®å—ä¸­éƒ½åŠ äº† <strong>&#x3D;</strong> å·ï¼Œå®ƒå’Œæˆ‘ä»¬å®é™…çš„ android é…ç½®å—è¿˜æ˜¯æœ‰ç‚¹åŒºåˆ«ï¼Œå¯èƒ½ä½ ä¼šé—®ï¼Œæˆ‘èƒ½ä¸èƒ½æŠŠ <strong>&#x3D;</strong> å·ç»™å»æ‰å‘¢ï¼Ÿ</p><p>ç­”ï¼šä¸èƒ½ã€‚å¦‚æœæƒ³å»æ‰ï¼š</p><p>1ã€ä½¿ç”¨ ExtensionContainer ç³»åˆ— API åˆ›å»ºåµŒå¥— Extension</p><p>2ã€åˆ›å»ºä¸å±æ€§åŒåçš„æ–¹æ³•</p><p>åˆ›å»ºä¸å±æ€§åŒåçš„æ–¹æ³•å·²ç»æ¼”ç¤ºè¿‡ï¼Œæˆ‘ä»¬ä¸»è¦æ¼”ç¤ºä¸€ä¸‹ä½¿ç”¨ ExtensionContainer ç³»åˆ— API åˆ›å»ºåµŒå¥— Extension</p><h5 id="2ã€é€šè¿‡-ExtensionContainer-ç³»åˆ—åˆ›å»º-Extension-API-é…ç½®åµŒå¥—-Extension"><a href="#2ã€é€šè¿‡-ExtensionContainer-ç³»åˆ—åˆ›å»º-Extension-API-é…ç½®åµŒå¥—-Extension" class="headerlink" title="2ã€é€šè¿‡ ExtensionContainer ç³»åˆ—åˆ›å»º Extension API é…ç½®åµŒå¥— Extension"></a>2ã€é€šè¿‡ ExtensionContainer ç³»åˆ—åˆ›å»º Extension API é…ç½®åµŒå¥— Extension</h5><p>é€šè¿‡ ExtensionContainer åˆ›å»º Extension æˆ‘ä»¬éƒ½è®²è¿‡äº†ï¼Œè¿™é‡Œç›´æ¥ä¸Šä»£ç ï¼š</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs groovy"><span class="hljs-keyword">class</span> <span class="hljs-title class_">AndroidExt</span>&#123;<br>    <span class="hljs-type">int</span> compileSdkVersionExt<br>  <br>    AndroidExt()&#123;<br>      <span class="hljs-comment">//æ³¨æ„ï¼šè¿™é‡Œçš„ extensions æ˜¯å±äº AndroidExt çš„ï¼Œå¹¶ä¸æ˜¯ project å¯¹è±¡çš„</span><br>        extensions.create(<span class="hljs-string">&#x27;defaultConfigExt&#x27;</span>,DefaultConfigExt)<br>    &#125;<br>&#125;<br><br><br>extensions.create(<span class="hljs-string">&#x27;defaultConfigExt&#x27;</span>,DefaultConfigExt)<br><span class="hljs-comment">//ä¸Šé¢è¿™å¥é…ç½®ç­‰åŒäºä¸‹é¢</span><br>project.extensions.create(<span class="hljs-string">&#x27;androidExt&#x27;</span>,AndroidExt)<br>project.androidExt.extensions.create(<span class="hljs-string">&#x27;defaultConfigExt&#x27;</span>,DefaultConfigExt)<br></code></pre></td></tr></table></figure><p>ä¸Šè¿°ä»£ç åœ¨ AndroidExt çš„æ„é€ æ–¹æ³•é‡Œé¢åˆ›å»ºäº†ä¸€ä¸ª DefaultConfigExt çš„æ‰©å±•ï¼Œè¿™æ ·å°±èƒ½å®ç°æŠŠ defaultConfigExt é…ç½®å—ä¸­çš„ <strong>&#x3D;</strong> ç»™å»æ‰</p><h3 id="9ï¼‰ã€é…ç½®ä¸å›ºå®šæ•°é‡-Extension"><a href="#9ï¼‰ã€é…ç½®ä¸å›ºå®šæ•°é‡-Extension" class="headerlink" title="9ï¼‰ã€é…ç½®ä¸å›ºå®šæ•°é‡ Extension"></a>9ï¼‰ã€é…ç½®ä¸å›ºå®šæ•°é‡ Extension</h3><p>æˆ‘ä»¬ç»å¸¸åœ¨ android é…ç½®å—çœ‹åˆ°è¿™ç§ä¸å›ºå®šæ•°é‡çš„ Extension ï¼Œå¦‚ä¸‹ï¼š</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs groovy">buildTypes &#123;<br>    release &#123;<br>        <span class="hljs-comment">//å¼€å¯æ··æ·†</span><br>        minifyEnabled <span class="hljs-literal">true</span><br>        <span class="hljs-comment">//èµ„æºå¯¹é½</span><br>        zipAlignEnabled <span class="hljs-literal">true</span><br>        <span class="hljs-comment">//æ˜¯å¦å¼€å¯ debug æ¨¡å¼</span><br>        debuggable <span class="hljs-literal">false</span><br>        <span class="hljs-comment">//...</span><br>    &#125;<br>    debug &#123;<br>        minifyEnabled <span class="hljs-literal">false</span><br>        zipAlignEnabled <span class="hljs-literal">false</span><br>        debuggable <span class="hljs-literal">true</span><br>        <span class="hljs-comment">//...</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™ç§ç±»å‹å¯ä»¥ç”¨äºåœ¨ä»£ç å—ä¸­åˆ›å»ºæ–°çš„æŒ‡å®šç±»å‹çš„å¯¹è±¡ã€‚</p><p>å…ˆæ¥çœ‹ä¸€ä¸‹ buildTypes å¯¹åº”çš„æºç ï¼š</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs groovy"><span class="hljs-keyword">public</span> <span class="hljs-type">void</span> buildTypes(Action&lt;? super NamedDomainObjectContainer&lt;BuildType&gt;&gt; action) &#123;<br>    this.checkWritability();<br>    action.execute(this.buildTypes);<br>&#125;<br></code></pre></td></tr></table></figure><p>å®ƒä¼ å…¥çš„æ˜¯ä¸€ä¸ª BuildType ç±»å‹åˆ—è¡¨çš„ Actionï¼Œå…¶ä¸­å¯ä»¥çœ‹åˆ° NamedDomainObjectContainer ï¼Œè¿™ä¸ªä¸œè¥¿å¾ˆé‡è¦ï¼Œæˆ‘ä»¬æ¥ä»‹ç»ä¸€ä¸‹å®ƒ</p><h5 id="1ã€NamedDomainObjectContainer-ä»‹ç»"><a href="#1ã€NamedDomainObjectContainer-ä»‹ç»" class="headerlink" title="1ã€NamedDomainObjectContainer ä»‹ç»"></a>1ã€NamedDomainObjectContainer ä»‹ç»</h5><p>NamedDomainObjectContainer ä¸­æ–‡ç¿»è¯‘å³å‘½åé¢†åŸŸå¯¹è±¡å®¹å™¨ï¼Œè¿½æ ¹æº¯æºå®ƒç»§æ‰¿è‡ª <code>Collection&lt;T&gt;</code>ã€‚å®ƒçš„ä½œç”¨æ˜¯åœ¨è„šæœ¬æ–‡ä»¶ä¸­åˆ›å»ºå¯¹è±¡ï¼Œä¸”åˆ›å»ºçš„å¯¹è±¡å¿…é¡»è¦æœ‰ name è¿™ä¸ªå±æ€§ä½œä¸ºå®¹å™¨å†…å…ƒç´ çš„æ ‡è¯†ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ Project å¯¹è±¡çš„ container ç³»åˆ—æ–¹æ³•è·å– NamedDomainObjectContainer å¯¹è±¡ï¼š</p><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/32c3f85769ec493789feddcd96990ea4~tplv-k3u1fbpfcp-zoom-1.image" alt="image-20210725223142994"></p><p>ä¸‹é¢æˆ‘ä»¬æ¥å®ç°ä¸€ä¸ª buildTypes é…ç½®å—ç±»ä¼¼çš„é…ç½®</p><h5 id="2ã€ç±»ä¼¼-buildTypes-é…ç½®å—å¤š-Extension-å®ç°"><a href="#2ã€ç±»ä¼¼-buildTypes-é…ç½®å—å¤š-Extension-å®ç°" class="headerlink" title="2ã€ç±»ä¼¼ buildTypes é…ç½®å—å¤š Extension å®ç°"></a>2ã€ç±»ä¼¼ buildTypes é…ç½®å—å¤š Extension å®ç°</h5><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><code class="hljs groovy"><span class="hljs-comment">//å½“å‰åœ¨ app çš„ build.gradle ä¸­</span><br><br><span class="hljs-comment">//ç¬¬ä¸€æ­¥ï¼šå¢åŠ å®ä½“ç±»é…ç½®</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">BuildTypesConfigExt</span>&#123;<br>    <span class="hljs-comment">//æ³¨æ„ï¼šå¿…é¡»è¦æœ‰ name å±æ€§è¿›è¡Œæ ‡è¯†</span><br>    String name<br>    <span class="hljs-type">boolean</span> minifyEnabledExt<br>    <span class="hljs-type">boolean</span> zipAlignEnabled<br>    <span class="hljs-type">boolean</span> debuggableExt<br><br>    BuildTypesConfigExt(String name) &#123;<br>        <span class="hljs-variable language_">this</span>.name = name<br>    &#125;<br><br>    <span class="hljs-comment">//=====================é…ç½®ä¸å±æ€§åŒåçš„æ–¹æ³•================</span><br>    <span class="hljs-type">void</span> minifyEnabledExt(<span class="hljs-type">boolean</span> minifyEnabledExt) &#123;<br>        <span class="hljs-variable language_">this</span>.minifyEnabledExt = minifyEnabledExt<br>    &#125;<br><br>    <span class="hljs-type">void</span> zipAlignEnabled(<span class="hljs-type">boolean</span> zipAlignEnabled) &#123;<br>        <span class="hljs-variable language_">this</span>.zipAlignEnabled = zipAlignEnabled<br>    &#125;<br><br>    <span class="hljs-type">void</span> debuggableExt(<span class="hljs-type">boolean</span> debuggableExt) &#123;<br>        <span class="hljs-variable language_">this</span>.debuggableExt = debuggableExt<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">//ç¬¬äºŒæ­¥ï¼šæ„å»ºå‘½åé¢†åŸŸå¯¹è±¡å®¹å™¨ï¼Œå¹¶æ·»åŠ åˆ° Extension</span><br>NamedDomainObjectContainer&lt;BuildTypesConfigExt&gt; container = project.container(BuildTypesConfigExt)<br>project.extensions.add(<span class="hljs-string">&#x27;buildTypesExt&#x27;</span>,container)<br><br><span class="hljs-comment">//ç¬¬ä¸‰æ­¥ï¼šè¿›è¡Œè¯­å¥å—é…ç½®</span><br>buildTypesExt &#123;<br>    release &#123;<br>        minifyEnabledExt <span class="hljs-literal">true</span><br>        zipAlignEnabled <span class="hljs-literal">true</span><br>        debuggableExt <span class="hljs-literal">false</span><br>    &#125;<br><br>    debug &#123;<br>        minifyEnabledExt <span class="hljs-literal">false</span><br>        zipAlignEnabled <span class="hljs-literal">false</span><br>        debuggableExt <span class="hljs-literal">true</span><br>    &#125;<br>&#125;<br><br><span class="hljs-comment">//ç¬¬å››æ­¥ï¼šç¼–å†™ Task è¿›è¡Œæµ‹è¯•</span><br>project.tasks.create(<span class="hljs-string">&quot;buildTypesTask&quot;</span>)&#123;<br>    doLast &#123;<br>        project.buildTypesExt.each&#123;<br>            println <span class="hljs-string">&quot;$it.name: $it.minifyEnabledExt $it.zipAlignEnabled $it.debuggableExt&quot;</span><br>        &#125;<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">//æ‰§è¡Œ buildTypesTask</span><br>./gradlew buildTypesTask<br><br><span class="hljs-comment">//æ‰“å°ç»“æœ</span><br>&gt; <span class="hljs-attr">Task :</span><span class="hljs-attr">app:</span>buildTypesTask<br><span class="hljs-attr">debug:</span> <span class="hljs-literal">false</span> <span class="hljs-literal">false</span> <span class="hljs-literal">true</span><br><span class="hljs-attr">release:</span> <span class="hljs-literal">true</span> <span class="hljs-literal">true</span> <span class="hljs-literal">false</span><br></code></pre></td></tr></table></figure><p>åˆ°è¿™é‡Œï¼Œå…³äº Extension æˆ‘ä»¬å°±ä»‹ç»å®Œäº†ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬ä»‹ç»ä¸€ä¸‹å˜ä½“ï¼ˆVariantsï¼‰</p><h2 id="ä¸‰ã€å˜ä½“-Variants-ä»‹ç»"><a href="#ä¸‰ã€å˜ä½“-Variants-ä»‹ç»" class="headerlink" title="ä¸‰ã€å˜ä½“ (Variants) ä»‹ç»"></a>ä¸‰ã€å˜ä½“ (Variants) ä»‹ç»</h2><p>å˜ä½“å±äº Android Gradle Pluginï¼ˆåç»­ç»Ÿç§° AGPï¼‰ é‡Œé¢éœ€è¦ä»‹ç»çš„çŸ¥è¯†ç‚¹ï¼Œåç»­ç­‰æˆ‘ä»¬è®²åˆ°  AGP çš„æ—¶å€™åœ¨åšè¯¦ç»†ä»‹ç»ã€‚è¿™é‡Œæš‚æ—¶å…ˆä»‹ç»ä¸€äº›æ¥ä¸‹æ¥ä¼šç”¨åˆ°çš„</p><p> AGP ç»™ android å¯¹è±¡æä¾›äº†ä¸‰ç§ç±»å‹å˜ä½“ï¼ˆVariantsï¼‰ï¼š</p><blockquote><p>1ã€applicationVariantsï¼šåªé€‚ç”¨äº app plugin</p><p>2ã€libraryVariantsï¼šåªé€‚ç”¨äº library plugin</p><p>3ã€testVariantsï¼šåœ¨ app plugin ä¸ libarary plugin ä¸­éƒ½é€‚ç”¨ï¼Œè¿™ä¸ªä¸€èˆ¬å¾ˆå°‘ç”¨</p></blockquote><p>å…¶ä¸­æˆ‘ä»¬æœ€å¸¸ç”¨çš„ä¾¿æ˜¯ applicationVariantsï¼Œæˆ‘ä»¬æ¥ä»‹ç»ä¸€ä¸‹å®ƒ</p><h3 id="1ï¼‰ã€applicationVariants-ä½¿ç”¨"><a href="#1ï¼‰ã€applicationVariants-ä½¿ç”¨" class="headerlink" title="1ï¼‰ã€applicationVariants ä½¿ç”¨"></a>1ï¼‰ã€applicationVariants ä½¿ç”¨</h3><p>æˆ‘ä»¬å¯ä»¥é€šè¿‡ Project å¯¹è±¡è·å– android è¿™ä¸ªå±æ€§ï¼Œç„¶åé€šè¿‡ android åœ¨å»è·å–å˜ä½“å¦‚ä¸‹ï¼š</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs groovy"><span class="hljs-comment">//å½“å‰åœ¨ app çš„ build.gradle æ–‡ä»¶ä¸­</span><br><span class="hljs-comment">//æ–¹å¼1</span><br>android.applicationVariants<br><span class="hljs-comment">//æ–¹å¼2</span><br>project.android.applicationVariants<br><span class="hljs-comment">//æ–¹å¼3</span><br>project.property(<span class="hljs-string">&#x27;android&#x27;</span>).applicationVariants<br></code></pre></td></tr></table></figure><p>ä¸Šè¿° 3 ç§æ–¹å¼è·å–çš„éƒ½æ˜¯åŒä¸€ä¸ªå˜ä½“</p><p>ä¸ºäº†æ›´å¥½çš„æ¼”ç¤ºï¼Œæˆ‘ä»¬åœ¨ app çš„ build.gradle å¢åŠ å¦‚ä¸‹å†…å®¹ï¼š</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs groovy">android &#123;<br>    <span class="hljs-comment">//...</span><br><br>    buildTypes &#123;<br>        debug&#123;<br><br>        &#125;<br><br>        release &#123;<br>            minifyEnabled <span class="hljs-literal">false</span><br>            proguardFiles getDefaultProguardFile(<span class="hljs-string">&#x27;proguard-android-optimize.txt&#x27;</span>), <span class="hljs-string">&#x27;proguard-rules.pro&#x27;</span><br>        &#125;<br>    &#125;<br><br><br><br>    productFlavors&#123;<br><br>        flavorDimensions <span class="hljs-string">&#x27;isFree&#x27;</span><br><br>        baidu&#123;<br>            dimension <span class="hljs-string">&#x27;isFree&#x27;</span><br>        &#125;<br><br>        google&#123;<br>            dimension <span class="hljs-string">&#x27;isFree&#x27;</span><br>        &#125;<br><br>        winxin&#123;<br>            dimension <span class="hljs-string">&#x27;isFree&#x27;</span><br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ä¸Šè¿°é…ç½®ä¼šäº§ç”Ÿ 6 ä¸ªå˜ä½“ï¼Œ<strong>å®é™…ä¸Šå˜ä½“æ˜¯é€šè¿‡ buildTypes å’Œ productFlavors çš„æ’åˆ—ç»„åˆæ‰€äº§ç”Ÿçš„</strong>ï¼Œæˆ‘ä»¬éå†æ‰“å°ä¸€ä¸‹æ¯ä¸ªå˜ä½“çš„ name å’Œ baseName</p><p><strong>æ³¨æ„</strong>ï¼š</p><p>1ã€ä» AGP 3.0 å¼€å§‹ï¼Œå¿…é¡»è‡³å°‘æ˜ç¡®æŒ‡å®šä¸€ä¸ª flavor dimension</p><p>2ã€é€šè¿‡ android å¯¹è±¡è·å–çš„ applicationVariants æˆ– libraryVariants æ˜¯æ‰€æœ‰çš„å˜ä½“ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡éå†å–å‡ºæ¯ä¸€ä¸ªå˜ä½“</p><p>3ã€å…³äºå˜ä½“èƒ½å¤Ÿæ“ä½œçš„å±æ€§å’Œæ–¹æ³•ï¼Œå¤§å®¶å¯ä»¥å»æŸ¥é˜… AGP å®˜æ–¹æ–‡æ¡£ï¼Œè¿™é‡Œæä¾›ä¸€ä¸ªä¸­æ–‡ç‰ˆçš„ï¼Œ<a href="https://chaosleong.gitbooks.io/gradle-for-android/content/advanced_build_customization/manipulating_tasks.html">ä¼ é€é—¨</a></p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs groovy"><span class="hljs-comment">//å½“å‰åœ¨ app çš„ build.gradle æ–‡ä»¶ä¸­</span><br>afterEvaluate &#123;<br>    project.android.applicationVariants.all&#123; variant -&gt;<br>        println <span class="hljs-string">&quot;$variant.name $variant.baseName&quot;</span><br>    &#125;<br>&#125;<br><span class="hljs-comment">//æ‰“å°ç»“æœ</span><br>&gt; Configure <span class="hljs-attr">project :</span>app<br>baiduDebug baidu-debug<br>googleDebug google-debug<br>winxinDebug winxin-debug<br>baiduRelease baidu-release<br>googleRelease google-release<br>winxinRelease winxin-release<br></code></pre></td></tr></table></figure><p>ä»ä¸Šé¢æˆ‘ä»¬å°±èƒ½çœ‹åˆ° name å’Œ baseName çš„ä¸€ä¸ªåŒºåˆ«</p><h3 id="2ï¼‰ã€å¯¹-applicationVariants-ä¸­çš„-Task-è¿›è¡Œ-Hook"><a href="#2ï¼‰ã€å¯¹-applicationVariants-ä¸­çš„-Task-è¿›è¡Œ-Hook" class="headerlink" title="2ï¼‰ã€å¯¹ applicationVariants ä¸­çš„ Task è¿›è¡Œ Hook"></a>2ï¼‰ã€å¯¹ applicationVariants ä¸­çš„ Task è¿›è¡Œ Hook</h3><p>é€šå¸¸æˆ‘ä»¬ä¼šä½¿ç”¨å˜ä½“æ¥å¯¹æ„å»ºè¿‡ç¨‹ä¸­çš„ Task è¿›è¡Œ hookï¼Œå¦‚ä¸‹ï¼š</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs groovy"><span class="hljs-comment">//å½“å‰åœ¨ app çš„ build.gradle æ–‡ä»¶ä¸­</span><br>afterEvaluate &#123;<br>    project.android.applicationVariants.all&#123; variant -&gt;<br>        <span class="hljs-keyword">def</span> task = variant.mergeResources<br>        println <span class="hljs-string">&quot;$task.name&quot;</span><br>    &#125;<br>&#125;<br><br><br><span class="hljs-comment">//æ‰“å°ç»“æœ</span><br>&gt; Configure <span class="hljs-attr">project :</span>app<br>mergeBaiduDebugResources<br>mergeGoogleDebugResources<br>mergeWinxinDebugResources<br>mergeBaiduReleaseResources<br>mergeGoogleReleaseResources<br>mergeWinxinReleaseResources<br></code></pre></td></tr></table></figure><p>ä¸Šè¿°æ“ä½œæˆ‘ä»¬æ‹¿åˆ°äº†æ‰€æœ‰å˜ä½“å¯¹åº”çš„ mergeResources Task å¹¶æ‰“å°äº†å®ƒçš„åç§°</p><h3 id="3ï¼‰ã€ä½¿ç”¨-applicationVariants-å¯¹-APK-è¿›è¡Œé‡å‘½å"><a href="#3ï¼‰ã€ä½¿ç”¨-applicationVariants-å¯¹-APK-è¿›è¡Œé‡å‘½å" class="headerlink" title="3ï¼‰ã€ä½¿ç”¨ applicationVariants å¯¹ APK è¿›è¡Œé‡å‘½å"></a>3ï¼‰ã€ä½¿ç”¨ applicationVariants å¯¹ APK è¿›è¡Œé‡å‘½å</h3><p>applicationVariants ä¸­æ¯ä¸€ä¸ªå˜ä½“å¯¹åº”çš„è¾“å‡ºæ–‡ä»¶ä¾¿æ˜¯ä¸€ä¸ª APKï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥é€šè¿‡ applicationVariants å¯¹ APK è¿›è¡Œé‡å‘½åï¼Œå¦‚ä¸‹ï¼š</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs groovy"><span class="hljs-comment">//å½“å‰åœ¨ app çš„ build.gradle æ–‡ä»¶ä¸­</span><br><br>project.android.applicationVariants.all&#123; variant -&gt;<br>    variant.outputs.all&#123;<br>        outputFileName = <span class="hljs-string">&quot;$&#123;variant.baseName&#125;&quot;</span> + <span class="hljs-string">&quot;.apk&quot;</span><br>        println outputFileName<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">//æ‰“å°ç»“æœ</span><br>&gt; Configure <span class="hljs-attr">project :</span>app<br>baidu-debug.apk<br>google-debug.apk<br>winxin-debug.apk<br>baidu-release.apk<br>google-release.apk<br>winxin-release.apk<br></code></pre></td></tr></table></figure><p>å…³äºå˜ä½“æˆ‘ä»¬æš‚æ—¶å°±ä»‹ç»åˆ°è¿™</p><h2 id="å››ã€è·å–-App-ä¸­æ‰€æœ‰-Xml-æ§ä»¶å®æˆ˜åº”ç”¨"><a href="#å››ã€è·å–-App-ä¸­æ‰€æœ‰-Xml-æ§ä»¶å®æˆ˜åº”ç”¨" class="headerlink" title="å››ã€è·å– App ä¸­æ‰€æœ‰ Xml æ§ä»¶å®æˆ˜åº”ç”¨"></a>å››ã€è·å– App ä¸­æ‰€æœ‰ Xml æ§ä»¶å®æˆ˜åº”ç”¨</h2><p>Okï¼Œäº†è§£äº† Extension å’Œ Variants ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬æ­£å¼è¿›å…¥ Gradle æ’ä»¶å®æˆ˜åº”ç”¨ï¼Œå…³äºå¦‚ä½•è‡ªå®šä¹‰ Gradle æ’ä»¶ï¼Œå‚è€ƒæˆ‘çš„ä¸Šä¸€ç¯‡æ–‡ç« <a href="https://juejin.cn/post/6988051489306443789">ä¼ é€é—¨</a>ï¼Œä¸€äº›ç»†èŠ‚æˆ‘ä»¬å°±ç•¥è¿‡äº†</p><h3 id="1ï¼‰ã€æ€è·¯åˆ†æ"><a href="#1ï¼‰ã€æ€è·¯åˆ†æ" class="headerlink" title="1ï¼‰ã€æ€è·¯åˆ†æ"></a>1ï¼‰ã€æ€è·¯åˆ†æ</h3><p>åœ¨ Android æ‰“åŒ…æ„å»ºæµç¨‹ä¸­ï¼Œ<code>merge...Resources</code> è¿™ä¸ª Task ä¼šå¯¹æ‰€æœ‰çš„èµ„æºæ–‡ä»¶è¿›è¡Œåˆå¹¶ï¼Œè€Œ <code>merge...Resources</code> ä¸­é—´çš„ <code>...</code> ä¼šæ ¹æ®å˜ä½“çš„ä¸åŒè€Œå˜åŒ–ï¼ŒåŒæ—¶å¯¹è¾“å‡ºçš„æ–‡ä»¶ç›®å½•ä¹Ÿæœ‰ä¸€å®šçš„å½±å“ï¼Œä¾‹å¦‚ï¼š</p><p>1ã€å¦‚æœå½“å‰è¿è¡Œçš„æ˜¯ debug ç¯å¢ƒï¼Œé‚£ä¹ˆå˜ä½“å³ debugï¼Œåœ¨ Android æ‰“åŒ…æ„å»ºæµç¨‹ä¸­ï¼Œå°±ä¼šé€šè¿‡ <strong>mergeDebugResources</strong> è¿™ä¸ª Task å¯¹æ‰€æœ‰çš„èµ„æºè¿›è¡Œåˆå¹¶ï¼Œå¹¶å°†åˆå¹¶çš„æ–‡ä»¶è¾“å‡ºåˆ°ï¼š&#x2F;build&#x2F;intermediates&#x2F;incremental&#x2F;mergeDebugResources&#x2F;merger.xml</p><p>2ã€å¦‚æœå½“å‰è¿è¡Œçš„æ˜¯ release ç¯å¢ƒï¼Œé‚£ä¹ˆå˜ä½“å³ releaseï¼Œåœ¨ Android æ‰“åŒ…æ„å»ºæµç¨‹ä¸­ï¼Œå°±ä¼šé€šè¿‡ <strong>mergeReleaseResources</strong> è¿™ä¸ª Task å¯¹æ‰€æœ‰çš„èµ„æºè¿›è¡Œåˆå¹¶ï¼Œå¹¶å°†åˆå¹¶çš„æ–‡ä»¶è¾“å‡ºåˆ°ï¼š&#x2F;build&#x2F;intermediates&#x2F;incremental&#x2F;mergeReleaseResources&#x2F;merger.xml</p><p>é‚£ä¹ˆæˆ‘ä»¬æ˜¯å¦å¯ä»¥ï¼š<strong>è‡ªå®šä¹‰ Gradle æ’ä»¶ï¼Œå°†è‡ªå·±ç¼–å†™çš„ Task æŒ‚æ¥åˆ° mergeâ€¦Resources åé¢ï¼Œç„¶åéå† merger.xml è¿™ä¸ªæ–‡ä»¶ï¼ŒæŠŠå®ƒé‡Œé¢æ‰€æœ‰ Xml ä¸­çš„ View è¾“å‡ºåˆ°ä¸€ä¸ª .txt æ–‡ä»¶ä¸­</strong></p><p>å—¯ï¼Œæ„Ÿè§‰å¯è¡Œï¼Œå¹²å°±å®Œäº†</p><h3 id="2ï¼‰ã€å®æˆ˜åº”ç”¨"><a href="#2ï¼‰ã€å®æˆ˜åº”ç”¨" class="headerlink" title="2ï¼‰ã€å®æˆ˜åº”ç”¨"></a>2ï¼‰ã€å®æˆ˜åº”ç”¨</h3><p>é¦–å…ˆçœ‹ä¸€çœ¼åˆå§‹çŠ¶æ€ä¸‹ï¼Œæˆ‘ä»¬çš„é¡¹ç›®ç»“æ„ï¼š</p><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/be848f2ca214433790596d648237e3e7~tplv-k3u1fbpfcp-zoom-1.image" alt="init_plugin_constructor"></p><h4 id="1ã€ç¬¬ä¸€æ­¥ï¼šè‡ªå®šä¹‰æ’ä»¶ï¼Œå°†è‡ªå®šä¹‰-Task-æŒ‚æ¥åˆ°-mergeâ€¦Resources"><a href="#1ã€ç¬¬ä¸€æ­¥ï¼šè‡ªå®šä¹‰æ’ä»¶ï¼Œå°†è‡ªå®šä¹‰-Task-æŒ‚æ¥åˆ°-mergeâ€¦Resources" class="headerlink" title="1ã€ç¬¬ä¸€æ­¥ï¼šè‡ªå®šä¹‰æ’ä»¶ï¼Œå°†è‡ªå®šä¹‰ Task æŒ‚æ¥åˆ°  mergeâ€¦Resources"></a>1ã€ç¬¬ä¸€æ­¥ï¼šè‡ªå®šä¹‰æ’ä»¶ï¼Œå°†è‡ªå®šä¹‰ Task æŒ‚æ¥åˆ°  mergeâ€¦Resources</h4><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><code class="hljs groovy"><span class="hljs-keyword">package</span> com.dream.xmlviewscanplugin<br><br><span class="hljs-keyword">import</span> org.gradle.api.Plugin<br><span class="hljs-keyword">import</span> org.gradle.api.Project<br><span class="hljs-keyword">import</span> org.gradle.api.Task<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * æ‰«æ Xml Plugin</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">XmlViewScanPlugin</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Plugin</span>&lt;Project&gt;&#123;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-type">void</span> apply(Project project) &#123;<br>        println <span class="hljs-string">&#x27;Hello XmlViewScanPlugin&#x27;</span><br>        <span class="hljs-comment">//æ·»åŠ é»‘åå•æ‰©å±•é…ç½®</span><br>        project.extensions.create(<span class="hljs-string">&#x27;ignore&#x27;</span>,IgnoreViewExtension)<br><br>        project.afterEvaluate &#123;<br>            <span class="hljs-comment">//æ˜¯å¦æ˜¯ Android æ’ä»¶</span><br>            <span class="hljs-keyword">def</span> isAppPlugin = project.plugins.hasPlugin(<span class="hljs-string">&#x27;com.android.application&#x27;</span>)<br><br>            <span class="hljs-comment">//è·å–å˜ä½“</span><br>            <span class="hljs-keyword">def</span> variants<br>            <span class="hljs-keyword">if</span>(isAppPlugin)&#123;<br>                variants = project.android.applicationVariants<br>            &#125;<span class="hljs-keyword">else</span> &#123;<br>                variants = project.android.libraryVariants<br>            &#125;<br><br>            variants.each&#123; variant -&gt;<br>                <span class="hljs-comment">//é€šè¿‡å˜ä½“è·å–å¯¹åº”çš„ merge...Resources</span><br>                Task mergeResourcesTask = variant.mergeResources<br><br>                <span class="hljs-comment">//å®šä¹‰è‡ªå®šä¹‰ Task æ‰©å±•å‰ç¼€</span><br>                <span class="hljs-keyword">def</span> prefix = variant.name<br>                <span class="hljs-comment">//è·å–æˆ‘ä»¬è‡ªå®šä¹‰çš„ Task</span><br>                Task xmlViewScanTask = project.tasks.create(<span class="hljs-string">&quot;$&#123;prefix&#125;XmlViewScanTask&quot;</span>, XmlViewScanTask,variant)<br><br>                <span class="hljs-comment">//å°†æˆ‘ä»¬è‡ªå®šä¹‰çš„ Task æŒ‚æ¥åˆ° mergeResourcesTask</span><br>                mergeResourcesTask.finalizedBy(xmlViewScanTask)<br>            &#125;<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="2ã€ç¬¬äºŒæ­¥ï¼šç¼–å†™è‡ªå®šä¹‰-Task-ï¼Œå°†æ‰«æå‡ºæ¥çš„æ§ä»¶å†™å…¥åˆ°æ–‡ä»¶ä¸­"><a href="#2ã€ç¬¬äºŒæ­¥ï¼šç¼–å†™è‡ªå®šä¹‰-Task-ï¼Œå°†æ‰«æå‡ºæ¥çš„æ§ä»¶å†™å…¥åˆ°æ–‡ä»¶ä¸­" class="headerlink" title="2ã€ç¬¬äºŒæ­¥ï¼šç¼–å†™è‡ªå®šä¹‰ Task ï¼Œå°†æ‰«æå‡ºæ¥çš„æ§ä»¶å†™å…¥åˆ°æ–‡ä»¶ä¸­"></a>2ã€ç¬¬äºŒæ­¥ï¼šç¼–å†™è‡ªå®šä¹‰ Task ï¼Œå°†æ‰«æå‡ºæ¥çš„æ§ä»¶å†™å…¥åˆ°æ–‡ä»¶ä¸­</h4><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br></pre></td><td class="code"><pre><code class="hljs groovy"><span class="hljs-keyword">package</span> com.dream.xmlviewscanplugin<br><br><span class="hljs-keyword">import</span> com.android.build.gradle.api.BaseVariant<br><span class="hljs-keyword">import</span> groovy.util.slurpersupport.GPathResult<br><span class="hljs-keyword">import</span> groovy.util.slurpersupport.Node<br><span class="hljs-keyword">import</span> org.gradle.api.DefaultTask<br><span class="hljs-keyword">import</span> org.gradle.api.Task<br><span class="hljs-keyword">import</span> org.gradle.api.tasks.TaskAction<br><span class="hljs-keyword">import</span> javax.inject.Inject<br><span class="hljs-keyword">import</span> java.util.function.Consumer<br><span class="hljs-keyword">import</span> java.util.function.Predicate<br><span class="hljs-keyword">import</span> java.util.stream.Stream<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * æ‰«æ Xml Task</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">XmlViewScanTask</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">DefaultTask</span> &#123;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * Xml å¸ƒå±€ä¸­è¢«æ·»åŠ è¿›æ¥çš„ View</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">private</span> Set&lt;String&gt; mXmlScanViewSet = <span class="hljs-keyword">new</span> HashSet&lt;&gt;()<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * å½“å‰å˜ä½“</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">private</span> BaseVariant variant<br><br>    <span class="hljs-meta">@Inject</span><br>    XmlViewScanTask(BaseVariant variant) &#123;<br>        <span class="hljs-variable language_">this</span>.variant = variant<br>    &#125;<br><br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * æ‰§è¡Œ xml æ‰«æ Task</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@TaskAction</span><br>    <span class="hljs-type">void</span> performXmlScanTask() &#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            println <span class="hljs-string">&#x27;performXmlScanTask start...&#x27;</span><br><br>            <span class="hljs-comment">//åˆ›å»ºéœ€è¦è¾“å‡º View çš„æ–‡ä»¶è·¯å¾„</span><br>            File outputFile = <span class="hljs-keyword">new</span> File(project.buildDir.path + <span class="hljs-string">&quot;/$&#123;variant.name&#125;_xml_scan_view/xml_scan_view.txt&quot;</span>)<br>            <span class="hljs-keyword">if</span> (!outputFile.parentFile.exists()) &#123;<br>                outputFile.parentFile.mkdirs()<br>            &#125;<br>            <span class="hljs-keyword">if</span> (outputFile.exists()) &#123;<br>                outputFile.delete()<br>            &#125;<br>            outputFile.createNewFile()<br>            println <span class="hljs-string">&#x27;file create success...&#x27;</span><br>            mXmlScanViewSet.clear()<br><br>            <span class="hljs-comment">//è·å– merger.xml æ–‡ä»¶</span><br>            Task mergeResourcesTask = variant.mergeResources<br>            String mergerPath = <span class="hljs-string">&quot;$&#123;project.buildDir.path&#125;/intermediates/incremental/$&#123;mergeResourcesTask.name&#125;/merger.xml&quot;</span><br>            File mergerFile = <span class="hljs-keyword">new</span> File(mergerPath)<br><br>            <span class="hljs-comment">//å¼€å§‹è§£æ  merger.xml</span><br>            XmlSlurper xmlSlurper = <span class="hljs-keyword">new</span> XmlSlurper()<br>            GPathResult result = xmlSlurper.parse(mergerFile)<br>            <span class="hljs-keyword">if</span> (result.children()) &#123;<br>                result.childNodes().forEachRemaining(<span class="hljs-keyword">new</span> Consumer() &#123;<br>                    <span class="hljs-meta">@Override</span><br>                    <span class="hljs-type">void</span> accept(Object o) &#123;<br>                        parseNode(o)<br>                    &#125;<br>                &#125;)<br>            &#125;<br>            println <span class="hljs-string">&#x27;merger.xml parsing success...&#x27;</span><br><br><br>            <span class="hljs-comment">//åˆ°è¿™é‡Œï¼Œæ‰€æœ‰çš„ xml æ§ä»¶éƒ½è¢«æ·»åŠ åˆ°äº†mXmScanViewSet</span><br>            <span class="hljs-comment">//æ¥ä¸‹æ¥æˆ‘ä»¬å°±éœ€è¦è¯»å–é»‘åå•ä¸­çš„ View å¹¶ç»™è¿‡æ»¤æ‰</span><br>            Stream&lt;String&gt; viewNameStream<br>            <span class="hljs-comment">//æ˜¯å¦å¼€å¯é»‘åå•è¿‡æ»¤åŠŸèƒ½</span><br>            <span class="hljs-keyword">if</span>(project.ignore.isEnable)&#123;<br>                println <span class="hljs-string">&#x27;blacklist enable...&#x27;</span><br>                viewNameStream = filterXmlScanViewSet()<br><br>                <span class="hljs-comment">//å¦‚æœæ­¤æ—¶æ²¡æœ‰é…ç½®é»‘åå• viewNameStream è¿˜æ˜¯ä¼šä¸º null</span><br>                <span class="hljs-keyword">if</span>(viewNameStream == <span class="hljs-literal">null</span>)&#123;<br>                    viewNameStream = mXmlScanViewSet.stream()<br>                &#125;<br>            &#125;<span class="hljs-keyword">else</span> &#123;<br>                println <span class="hljs-string">&#x27;blacklist disable...&#x27;</span><br>                viewNameStream = mXmlScanViewSet.stream()<br>            &#125;<br><br>            <span class="hljs-comment">//å°† viewName å†™å…¥æ–‡ä»¶ä¸­</span><br>            PrintWriter printWriter = <span class="hljs-keyword">new</span> PrintWriter(<span class="hljs-keyword">new</span> FileWriter(outputFile))<br>            viewNameStream.forEach(<span class="hljs-keyword">new</span> Consumer&lt;String&gt;() &#123;<br>                <span class="hljs-meta">@Override</span><br>                <span class="hljs-type">void</span> accept(String viewName) &#123;<br>                    printWriter.println(viewName)<br>                &#125;<br>            &#125;)<br>            printWriter.flush()<br>            printWriter.close()<br>            println <span class="hljs-string">&#x27;write all viewName to file success...&#x27;</span><br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            e.printStackTrace()<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * è¿‡æ»¤é»‘åå•ä¸­çš„ viewName</span><br><span class="hljs-comment">     * @return Stream&lt;String&gt;</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">private</span> Stream&lt;String&gt; filterXmlScanViewSet() &#123;<br>        List&lt;String&gt; ignoreViewList = project.ignore.ignoreViewList<br>        Stream&lt;String&gt; viewNameStream = <span class="hljs-literal">null</span><br>        <span class="hljs-keyword">if</span> (ignoreViewList) &#123;<br>            println <span class="hljs-string">&quot;ignoreViewList: $ignoreViewList&quot;</span><br>            viewNameStream = mXmlScanViewSet.stream().filter(<span class="hljs-keyword">new</span> Predicate&lt;String&gt;() &#123;<br>                <span class="hljs-meta">@Override</span><br>                <span class="hljs-type">boolean</span> test(String viewName) &#123;<br>                    <span class="hljs-keyword">for</span> (String <span class="hljs-attr">ignoreViewName :</span> ignoreViewList) &#123;<br>                        <span class="hljs-keyword">if</span> (viewName == ignoreViewName) &#123;<br>                            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span><br>                        &#125;<br>                    &#125;<br>                    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span><br>                &#125;<br>            &#125;)<br>        &#125;<span class="hljs-keyword">else</span> &#123;<br>            println <span class="hljs-string">&#x27;ignoreViewList is null, no filter...&#x27;</span><br>        &#125;<br>        <span class="hljs-keyword">return</span> viewNameStream<br>    &#125;<br><br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * é€’å½’è§£æ merger.xml ä¸­çš„ Node èŠ‚ç‚¹</span><br><span class="hljs-comment">     * </span><br><span class="hljs-comment">     * merger.xml æ–‡ä»¶ä¸­çš„å¸ƒå±€æ–‡ä»¶æ ‡ç­¾å¦‚ä¸‹ï¼š</span><br><span class="hljs-comment">     * &lt;file name=&quot;activity_main&quot;</span><br><span class="hljs-comment">     *       path=&quot;/Users/zhouying/learning/GradleDemo/app/src/main/res/layout/activity_main.xml&quot;</span><br><span class="hljs-comment">     *       qualifiers=&quot;&quot;</span><br><span class="hljs-comment">     *       type=&quot;layout&quot;/&gt;</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">void</span> parseNode(Object obj) &#123;<br>        <span class="hljs-keyword">if</span> (obj <span class="hljs-keyword">instanceof</span> Node) &#123;<br>            Node node = obj<br><br>            <span class="hljs-keyword">if</span> (node) &#123;<br>                <span class="hljs-keyword">if</span> (<span class="hljs-string">&quot;file&quot;</span> == node.name() &amp;&amp; <span class="hljs-string">&quot;layout&quot;</span> == node.attributes().get(<span class="hljs-string">&quot;type&quot;</span>)) &#123;<br>                    <span class="hljs-comment">//è·å–å¸ƒå±€æ–‡ä»¶</span><br>                    String layoutPath = node.attributes().get(<span class="hljs-string">&quot;path&quot;</span>)<br>                    File layoutFile = <span class="hljs-keyword">new</span> File(layoutPath)<br><br>                    <span class="hljs-comment">//å¼€å§‹è§£æå¸ƒå±€æ–‡ä»¶</span><br>                    XmlSlurper xmlSlurper = <span class="hljs-keyword">new</span> XmlSlurper()<br>                    GPathResult result = xmlSlurper.parse(layoutFile)<br>                    String viewName = result.name()<br>                    mXmlScanViewSet.add(viewName)<br><br>                    <span class="hljs-keyword">if</span> (result.children()) &#123;<br>                        result.childNodes().forEachRemaining(<span class="hljs-keyword">new</span> Consumer() &#123;<br>                            <span class="hljs-meta">@Override</span><br>                            <span class="hljs-type">void</span> accept(Object o) &#123;<br>                              <span class="hljs-comment">//é€’å½’è§£æå­èŠ‚ç‚¹</span><br>                                parseLayoutNode(o)<br>                            &#125;<br>                        &#125;)<br>                    &#125;<br>                &#125; <span class="hljs-keyword">else</span> &#123;<br>                    <span class="hljs-comment">//å¦‚æœä¸æ˜¯å¸ƒå±€æ–‡ä»¶ï¼Œé€’å½’è°ƒç”¨</span><br>                    node.childNodes().forEachRemaining(<span class="hljs-keyword">new</span> Consumer() &#123;<br>                        <span class="hljs-meta">@Override</span><br>                        <span class="hljs-type">void</span> accept(Object o) &#123;<br>                            parseNode(o)<br>                        &#125;<br>                    &#125;)<br><br>                &#125;<br>            &#125;<br>        &#125;<br>    &#125;<br><br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * é€’å½’è§£æ layout å¸ƒå±€å­èŠ‚ç‚¹</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">void</span> parseLayoutNode(Object obj) &#123;<br>        <span class="hljs-keyword">if</span> (obj <span class="hljs-keyword">instanceof</span> Node) &#123;<br>            Node node = obj<br>            <span class="hljs-keyword">if</span> (node) &#123;<br>                mXmlScanViewSet.add(node.name())<br>                node.childNodes().findAll &#123;<br>                    parseLayoutNode(it)<br>                &#125;<br>            &#125;<br>        &#125;<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><p><strong>æ³¨æ„ï¼š</strong> </p><p>1ã€ä¸Šè¿°è¿™ç§é€šè¿‡åˆ›å»ºä¸€ä¸ªç±»è‡ªå®šä¹‰ Task æ–¹å¼ï¼Œæ„é€ æ–¹æ³•å¿…é¡»ä½¿ç”¨ <code> @javax.inject.Inject</code> æ³¨è§£æ ‡è¯†ï¼Œå¦‚æœå±æ€§æ²¡æœ‰ä½¿ç”¨ <code>private</code>ä¿®é¥°ç¬¦ä¿®é¥°ï¼Œä¹Ÿéœ€è¦ä½¿ç”¨ <code> @javax.inject.Inject</code> æ³¨è§£æ ‡è¯†ï¼Œå¦åˆ™ Gradle ä¼šæŠ¥é”™</p><p>2ã€è‡ªå®šä¹‰ä¸€ä¸ªæ–¹æ³•ï¼Œæ–¹æ³•åéšæ„å–ï¼Œç„¶åä½¿ç”¨ <code>@TaskAction</code> æ³¨è§£æ ‡è¯†ï¼Œé‚£ä¹ˆè¿™ä¸ªæ–¹æ³•å°±ä¼šåœ¨ Gradle çš„æ‰§è¡Œé˜¶æ®µå»æ‰§è¡Œ</p><p>3ã€ä½¿ç”¨ä¸€äº›ç±»æ—¶ï¼Œæ³¨æ„åŒ…ååˆ«å¯¼é”™äº†</p><h4 id="3ã€ç¬¬ä¸‰æ­¥ï¼šå°†æ’ä»¶å‘å¸ƒåˆ°æœ¬åœ°ä»“åº“è¿›è¡Œå¼•ç”¨"><a href="#3ã€ç¬¬ä¸‰æ­¥ï¼šå°†æ’ä»¶å‘å¸ƒåˆ°æœ¬åœ°ä»“åº“è¿›è¡Œå¼•ç”¨" class="headerlink" title="3ã€ç¬¬ä¸‰æ­¥ï¼šå°†æ’ä»¶å‘å¸ƒåˆ°æœ¬åœ°ä»“åº“è¿›è¡Œå¼•ç”¨"></a>3ã€ç¬¬ä¸‰æ­¥ï¼šå°†æ’ä»¶å‘å¸ƒåˆ°æœ¬åœ°ä»“åº“è¿›è¡Œå¼•ç”¨</h4><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs groovy"><span class="hljs-comment">//1ã€æ‰§è¡Œå‘å¸ƒæ’ä»¶çš„ Task æˆ–é€šè¿‡ Gradle å¯è§†åŒ–ç•Œé¢è¿›è¡Œå‘å¸ƒ</span><br><br><span class="hljs-comment">//2ã€æ’ä»¶ä¾èµ–å¼•ç”¨</span><br><span class="hljs-comment">//æ ¹ build.gradle ä¸­</span><br>buildscript &#123;<br>    repositories &#123;<br>      <span class="hljs-comment">//...</span><br>        <span class="hljs-comment">//æœ¬åœ° Maven ä»“åº“</span><br>        maven&#123;<br>            url uri(<span class="hljs-string">&#x27;XmlViewScanPlugin&#x27;</span>)<br>        &#125;<br>    &#125;<br>    dependencies &#123;<br>      <span class="hljs-comment">//...</span><br>        <span class="hljs-comment">//å¼•å…¥æ’ä»¶ä¾èµ–</span><br>        classpath <span class="hljs-string">&#x27;com.dream:xmlviewscanplugin:1.0.2&#x27;</span><br>    &#125;<br>&#125;<br><br><span class="hljs-comment">//app build.gradle ä¸­</span><br>apply <span class="hljs-attr">plugin:</span> <span class="hljs-string">&#x27;XmlViewScanPlugin&#x27;</span><br></code></pre></td></tr></table></figure><p>ç»è¿‡ä¸Šé¢ 3 æ­¥ä¹‹åï¼Œæˆ‘ä»¬å°±å¯ä»¥è¿›è¡Œä¸€ä¸ªæ•ˆæœéªŒè¯äº†</p><h4 id="4ã€æ•ˆæœéªŒè¯"><a href="#4ã€æ•ˆæœéªŒè¯" class="headerlink" title="4ã€æ•ˆæœéªŒè¯"></a>4ã€æ•ˆæœéªŒè¯</h4><p>1ã€å…ˆçœ‹ä¸€ä¸‹æˆ‘ä»¬çš„å¸ƒå±€æ–‡ä»¶ activity_main.xmlï¼š</p><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/a612bddf8241459a8d662586ccaaf741~tplv-k3u1fbpfcp-zoom-1.image" alt="image-20210728130458228"></p><p>2ã€æ¥ä¸‹æ¥è¿è¡Œé¡¹ç›®çœ‹ä¸€ä¸‹æˆ‘ä»¬çš„ view æ˜¯å¦è¢«è¾“å‡ºåˆ° <code>.txt</code>æ–‡ä»¶ä¸­</p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/200b0daa1c4e4668b9de44215a993c04~tplv-k3u1fbpfcp-zoom-1.image" alt="image-20210728130807224" style="zoom:50%;" /><p>ä¸Šè¿°æˆªå›¾å¯ä»¥çœ‹åˆ°ï¼Œæ‰€æœ‰çš„ View è¢«è¾“å‡ºåˆ°äº†<code>.txt</code>æ–‡ä»¶ä¸­ã€‚æ¥ä¸‹æ¥æˆ‘ä»¬åœ¨éªŒè¯ä¸€ä¸‹é»‘åå•åŠŸèƒ½</p><p>3ã€åœ¨ app çš„ build.gradle æ·»åŠ é»‘åå•é…ç½®</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs groovy">ignore &#123;<br>    ignoreViewList = [<br>            <span class="hljs-string">&#x27;TextView&#x27;</span><br>    ]<br>&#125;<br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬æŠŠ TextView åŠ å…¥äº†é»‘åå•ï¼Œè¿è¡Œé¡¹ç›®ï¼Œå¯ä»¥çœ‹åˆ°æˆ‘ä»¬ç”Ÿæˆçš„ <code>.txt</code>æ–‡ä»¶æ²¡æœ‰ TextView äº†</p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/79e53b707f3e401c86b28831704e7edb~tplv-k3u1fbpfcp-zoom-1.image" alt="image-20210728141118681" style="zoom:50%;" /><p>è‡³æ­¤ï¼Œå…³äº Gradle æ’ä»¶å®æˆ˜åº”ç”¨å°±è®²å®Œäº†</p><h2 id="äº”ã€æ€»ç»“"><a href="#äº”ã€æ€»ç»“" class="headerlink" title="äº”ã€æ€»ç»“"></a>äº”ã€æ€»ç»“</h2><p>æœ¬ç¯‡æ–‡ç« è®²çš„ä¸€äº›é‡ç‚¹å†…å®¹ï¼š</p><p>1ã€Extension çš„è¯¦ç»†ä»‹ç»ï¼Œé‡ç‚¹æŒæ¡ï¼š</p><blockquote><p>1ã€å®šä¹‰ Extension çš„å‡ ç§æ–¹æ³•ï¼Œå‚æ•°åŒºåˆ«</p><p>2ã€å¦‚ä½•å®šä¹‰ Extension èƒ½å¤Ÿå»æ‰ &#x3D; å·</p><p>3ã€å¦‚ä½•å®šä¹‰åµŒå¥— Extension å’Œ å¤šä¸ªä¸å›ºå®šæ•°é‡çš„ Extension</p></blockquote><p>2ã€é€šè¿‡å˜ä½“å¯¹æ„å»ºæµç¨‹ä¸­çš„ Task è¿›è¡Œ Hook</p><p>3ã€è‡ªå®šä¹‰ Gradle æ’ä»¶å°†æ‰€æœ‰ Xml ä¸­çš„ View è¾“å‡ºåˆ°ä¸€ä¸ª<code>.txt</code>æ–‡ä»¶ä¸­</p><p>å¥½äº†ï¼Œæœ¬ç¯‡æ–‡ç« åˆ°è¿™é‡Œå°±ç»“æŸäº†ï¼Œå¸Œæœ›èƒ½ç»™ä½ å¸¦æ¥å¸®åŠ© ğŸ¤ </p><p><strong>æ„Ÿè°¢ä½ é˜…è¯»è¿™ç¯‡æ–‡ç« </strong></p><h3 id="ä¸‹ç¯‡é¢„å‘Š"><a href="#ä¸‹ç¯‡é¢„å‘Š" class="headerlink" title="ä¸‹ç¯‡é¢„å‘Š"></a>ä¸‹ç¯‡é¢„å‘Š</h3><p>ä¸‹ç¯‡æ–‡ç« æˆ‘ä¼šè®²è‡ªå®šä¹‰ Gradle Transformï¼Œæ•¬è¯·æœŸå¾…å§ğŸ˜„</p><h3 id="å‚è€ƒå’Œæ¨è"><a href="#å‚è€ƒå’Œæ¨è" class="headerlink" title="å‚è€ƒå’Œæ¨è"></a>å‚è€ƒå’Œæ¨è</h3><p><a href="https://juejin.cn/post/6844904135314128903">æ·±åº¦æ¢ç´¢ Gradle è‡ªåŠ¨åŒ–æ„å»ºæŠ€æœ¯ï¼ˆå››ã€è‡ªå®šä¹‰ Gradle æ’ä»¶)</a></p><p><a href="https://www.jianshu.com/p/58d86b4c0ee5">Android Gradleå­¦ä¹ (äº”)ï¼šExtensionè¯¦è§£</a></p><p><a href="https://juejin.cn/post/6986806041618939917">Gradle åˆ›å»ºæ‰©å±•å±æ€§è¯¦è§£</a></p><blockquote><p><strong>ä½ çš„ç‚¹èµï¼Œè¯„è®ºï¼Œæ˜¯å¯¹æˆ‘å·¨å¤§çš„é¼“åŠ±ï¼</strong></p><p>æ¬¢è¿å…³æ³¨æˆ‘çš„<strong>å…¬ä¼—å·ï¼š</strong>  <a href="http://m6z.cn/6jwi7b"><strong>sweetying</strong></a> ï¼Œæ–‡ç« æ›´æ–°å¯ç¬¬ä¸€æ—¶é—´æ”¶åˆ°</p><p>å¦‚æœ<strong>æœ‰é—®é¢˜</strong>ï¼Œå…¬ä¼—å·å†…æœ‰åŠ æˆ‘å¾®ä¿¡çš„å…¥å£ï¼Œåœ¨æŠ€æœ¯å­¦ä¹ ã€ä¸ªäººæˆé•¿çš„é“è·¯ä¸Šï¼Œæˆ‘ä»¬ä¸€èµ·å‰è¿›ï¼</p></blockquote>]]></content>
    
    
    <categories>
      
      <category>Android</category>
      
      <category>Gradle</category>
      
    </categories>
    
    
    <tags>
      
      <tag>åŸåˆ›</tag>
      
      <tag>Android</tag>
      
      <tag>Gradle</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Gradle ç³»åˆ— ï¼ˆä¸‰ï¼‰ã€Gradle æ’ä»¶å¼€å‘</title>
    <link href="/2022/10/11/Gradle%20%E7%B3%BB%E5%88%97%20%EF%BC%88%E4%B8%89%EF%BC%89%E3%80%81Gradle%20%E6%8F%92%E4%BB%B6%E5%BC%80%E5%8F%91/"/>
    <url>/2022/10/11/Gradle%20%E7%B3%BB%E5%88%97%20%EF%BC%88%E4%B8%89%EF%BC%89%E3%80%81Gradle%20%E6%8F%92%E4%BB%B6%E5%BC%80%E5%8F%91/</url>
    
    <content type="html"><![CDATA[<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/88e8b68394d54c0c958f093127b3ce96~tplv-k3u1fbpfcp-watermark.image"></p><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>å¾ˆé«˜å…´é‡è§ä½ ~</p><p>å…³äº Gradle å­¦ä¹ ï¼Œæˆ‘æ‰€ç†è§£çš„æµç¨‹å¦‚ä¸‹å›¾ï¼š</p><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/c09f872b2165474f81381f51f996cde5~tplv-k3u1fbpfcp-zoom-1.image" alt="Gradle_learning"></p><p>åœ¨æœ¬ç³»åˆ—çš„ä¸Šä¸€ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬è®²äº† Gradle çš„ç”Ÿå‘½å‘¨æœŸåŠä¸€äº›å¸¸ç”¨ APIï¼Œäº†è§£äº† Settingsï¼ŒProjectï¼ŒTask ç­‰ç­‰ï¼Œå®Œæˆäº†ç¬¬äºŒä¸ªç¯èŠ‚ã€‚è¿˜æ²¡æœ‰çœ‹è¿‡ä¸Šä¸€ç¯‡æ–‡ç« çš„æœ‹å‹ï¼Œå»ºè®®å…ˆå»é˜…è¯» <a href="https://juejin.cn/post/6986191903888769032">Gradle ç³»åˆ— ï¼ˆäºŒï¼‰ã€Gradle æŠ€æœ¯æ¢ç´¢</a>ã€‚</p><p>ä»Šå¤©æˆ‘ä»¬ä¸»è¦ä»‹ç»ç¯èŠ‚ä¸‰ï¼šç†Ÿæ‚‰è‡ªå®šä¹‰ Gradle æ’ä»¶</p><p>Gradle ç»™æˆ‘ä»¬æä¾›äº†æ„å»ºåº”ç”¨çš„æ ¸å¿ƒåŠŸèƒ½ï¼Œä½†æ˜¯å¦‚æœè¦ç¼–è¯‘æ„å»º Android å·¥ç¨‹ï¼Œå°±éœ€è¦é€šè¿‡ Gradle æ’ä»¶æ¥å®ç°äº†ï¼ŒGoogle å¼€å‘äº†ä¸€å¥— Android Gradle Plugin æ’ä»¶ä¸“é—¨æ¥ç¼–è¯‘æ„å»º Android å·¥ç¨‹ã€‚æˆ‘ä»¬åœ¨æ—¥å¸¸å¼€å‘ä¸­ä¹Ÿå¯ä»¥è‡ªå®šä¹‰ Gradle æ’ä»¶å»å®Œæˆä¸€äº›ç‰¹å®šçš„åŠŸèƒ½</p><p><a href="https://github.com/sweetying520/GradleDemo">Github Demo åœ°å€</a> , å¤§å®¶å¯ä»¥ç»“åˆ demo ä¸€èµ·çœ‹ï¼Œæ•ˆæœæ æ æ»´ğŸº</p><h2 id="ä¸€ã€Gradle-æ’ä»¶ä»‹ç»"><a href="#ä¸€ã€Gradle-æ’ä»¶ä»‹ç»" class="headerlink" title="ä¸€ã€Gradle æ’ä»¶ä»‹ç»"></a>ä¸€ã€Gradle æ’ä»¶ä»‹ç»</h2><h3 id="1ï¼‰ã€ä»€ä¹ˆæ˜¯-Gradle-æ’ä»¶ï¼Ÿ"><a href="#1ï¼‰ã€ä»€ä¹ˆæ˜¯-Gradle-æ’ä»¶ï¼Ÿ" class="headerlink" title="1ï¼‰ã€ä»€ä¹ˆæ˜¯ Gradle æ’ä»¶ï¼Ÿ"></a>1ï¼‰ã€ä»€ä¹ˆæ˜¯ Gradle æ’ä»¶ï¼Ÿ</h3><p>ç®€å•çš„ç†è§£ï¼šGradle æ’ä»¶å°±æ˜¯å°è£…äº†ä¸€ç³»åˆ— Task å¹¶æ‰§è¡Œ</p><h3 id="2ï¼‰ã€æ’ä»¶åˆ†ç±»"><a href="#2ï¼‰ã€æ’ä»¶åˆ†ç±»" class="headerlink" title="2ï¼‰ã€æ’ä»¶åˆ†ç±»"></a>2ï¼‰ã€æ’ä»¶åˆ†ç±»</h3><p>Android ä¸‹çš„ Gradle æ’ä»¶åˆ†ä¸ºä¸¤ç§ï¼š</p><p>1)ã€è„šæœ¬æ’ä»¶</p><p>è„šæœ¬æ’ä»¶å°±æ˜¯åœ¨ Android å·¥ç¨‹ä¸­åˆ›å»ºä¸€ä¸ª <code>.gradle</code>ä¸ºåç¼€çš„æ–‡ä»¶ï¼Œç„¶åé€šè¿‡ <code>apply from</code> çš„æ–¹å¼å»å¼•ç”¨è¿™ä¸ªæ’ä»¶</p><p>2)ã€å¯¹è±¡æ’ä»¶</p><p>å¯¹è±¡æ’ä»¶å°±æ˜¯å®ç°äº†  <code>org.gradle.api.plugins</code> æ¥å£çš„æ’ä»¶ï¼ŒGradle æœ¬èº«å°±ç»™æˆ‘ä»¬æä¾›äº†ä¸€ç³»åˆ—å¯¹è±¡æ’ä»¶ï¼Œå¦‚ï¼š<code>java</code> ï¼Œ<code>groovy</code> ï¼Œ<code>maven-publish</code> ç­‰ç­‰ã€‚è€Œå¦‚æœæˆ‘ä»¬è¦è‡ªå®šä¹‰å¯¹è±¡æ’ä»¶ï¼Œåˆ™æœ‰ä»¥ä¸‹ä¸‰ç§ç¼–å†™å½¢å¼ï¼š</p><p>1ã€åœ¨ build.gradle æ–‡ä»¶ä¸­ç›´æ¥ç¼–å†™</p><p>2ã€åœ¨ buildSrc é»˜è®¤æ’ä»¶ç›®å½•ä¸‹ç¼–å†™</p><p>3ã€åœ¨è‡ªå®šä¹‰é¡¹ç›®ä¸‹ç¼–å†™</p><p>ç„¶åé€šè¿‡ <code>apply plugin</code> çš„æ–¹å¼å»å¼•ç”¨è¿™ä¸ªæ’ä»¶</p><p>ä¸‹é¢æˆ‘ä»¬å°±æ¥ä¸€ä¸€æ¼”ç¤ºä¸€ä¸‹</p><h2 id="äºŒã€è„šæœ¬æ’ä»¶"><a href="#äºŒã€è„šæœ¬æ’ä»¶" class="headerlink" title="äºŒã€è„šæœ¬æ’ä»¶"></a>äºŒã€è„šæœ¬æ’ä»¶</h2><p>1ï¼‰ã€åˆ›å»ºä¸€ä¸ªä»¥ <code>.gradle</code> ä¸ºåç¼€çš„æ–‡ä»¶ï¼Œåå­—éšæ„å–ã€‚è¿™é‡Œæˆ‘åœ¨æ ¹ç›®å½•ä¸‹åˆ›å»ºäº†ä¸€ä¸ª script.gradle çš„æ–‡ä»¶å¹¶éšæ„ç¼–å†™äº†ä¸€äº›é€»è¾‘</p><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/fea94ae1d3d04696960ef930ad82a052~tplv-k3u1fbpfcp-zoom-1.image" alt="image-20210721213439960"></p><p>2ï¼‰ã€åœ¨ build.gradle ä¸­é€šè¿‡ <code>apply from</code> è¿›è¡Œæ’ä»¶çš„å¼•ç”¨ï¼Œæˆ‘ä»¬å¯ä»¥ä¼ å…¥ä¸€ä¸ªç»å¯¹è·¯å¾„ï¼Œä¹Ÿå¯ä»¥ä¼ å…¥ä¸€ä¸ªç›¸å¯¹è·¯å¾„ï¼Œå¦‚ä¸‹ï¼š</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs groovy"><span class="hljs-comment">//å½“å‰åœ¨ app çš„ build.gradle ä¸­</span><br><br><span class="hljs-comment">//ç›¸å¯¹è·¯å¾„</span><br>apply <span class="hljs-attr">from:</span> <span class="hljs-string">&#x27;../script.gradle&#x27;</span><br><br><span class="hljs-comment">//ç»å¯¹è·¯å¾„</span><br>apply <span class="hljs-attr">from:</span> rootDir.path + <span class="hljs-string">&#x27;/script.gradle&#x27;</span><br></code></pre></td></tr></table></figure><p><strong>æ³¨æ„</strong>ï¼šä¸Šè¿°æ–¹å¼çš„å¼•ç”¨å®é™…ä¸Šæ˜¯è°ƒç”¨äº†project å¯¹è±¡çš„ apply æ–¹æ³•ï¼Œæ–¹æ³•ä¸­ä¼ å…¥ä¸€ä¸ª mapã€‚map çš„ key æ˜¯ <code>from</code>ï¼Œvalue æ˜¯ <code>../script.gradle</code> ã€‚<code>apply plugin: &#39;...&#39;</code> ä¹Ÿæ˜¯åŒæ ·çš„é“ç†</p><p>3ï¼‰ã€ä½¿ç”¨æ’ä»¶æä¾›çš„åŠŸèƒ½</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs groovy"><span class="hljs-comment">//å½“å‰åœ¨ app çš„ build.gradle ä¸­</span><br><br><span class="hljs-comment">//1ã€æ‰“å°æ‰©å±•å±æ€§</span><br>println property1<br>println property2<br><br><span class="hljs-comment">//2ã€æ‰§è¡Œ scriptTask</span><br>./gradlew scriptTask<br><br><span class="hljs-comment">//æ‰§è¡Œç»“æœ</span><br>&gt; Configure <span class="hljs-attr">project :</span>app<br>erdai<br><span class="hljs-number">666</span><br><br>&gt; <span class="hljs-attr">Task :</span><span class="hljs-attr">app:</span>scriptTask<br>Hello, I am Script Plugin<br></code></pre></td></tr></table></figure><h2 id="ä¸‰ã€å¯¹è±¡æ’ä»¶"><a href="#ä¸‰ã€å¯¹è±¡æ’ä»¶" class="headerlink" title="ä¸‰ã€å¯¹è±¡æ’ä»¶"></a>ä¸‰ã€å¯¹è±¡æ’ä»¶</h2><p>ä¸Šé¢è®²åˆ°å¯¹è±¡æ’ä»¶å°±æ˜¯å®ç°äº† <code>org.gradle.api.plugin</code> æ¥å£çš„æ’ä»¶ï¼Œè‡ªå®šä¹‰å¯¹è±¡æ’ä»¶ä¸»è¦æœ‰ä»¥ä¸‹ä¸‰ç§ç¼–å†™å½¢å¼ï¼š</p><p><strong>æ³¨æ„ï¼š</strong> ä¸‹é¢æ¼”ç¤ºçš„æ’ä»¶éƒ½æ˜¯é€šè¿‡ groovy è¯­æ³•ç¼–å†™çš„</p><h3 id="1ï¼‰ã€build-gradle-æ–‡ä»¶ä¸­ç›´æ¥ç¼–å†™"><a href="#1ï¼‰ã€build-gradle-æ–‡ä»¶ä¸­ç›´æ¥ç¼–å†™" class="headerlink" title="1ï¼‰ã€build.gradle æ–‡ä»¶ä¸­ç›´æ¥ç¼–å†™"></a>1ï¼‰ã€build.gradle æ–‡ä»¶ä¸­ç›´æ¥ç¼–å†™</h3><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs groovy"><span class="hljs-comment">//å½“å‰åœ¨ app çš„ build.gradle ä¸­</span><br><br><span class="hljs-comment">//1ã€é€šè¿‡ apply plugin å¼•ç”¨å½“å‰æ’ä»¶</span><br>apply <span class="hljs-attr">plugin:</span> Method1Plugin<br><br><span class="hljs-comment">//2ã€è‡ªå®šä¹‰å¯¹è±¡æ’ä»¶</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Method1Plugin</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Plugin</span>&lt;Project&gt; &#123;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-type">void</span> apply(Project project) &#123;<br>        println <span class="hljs-string">&#x27;æˆ‘æ˜¯è‡ªå®šä¹‰ Method1Plugin &#x27;</span><br><br>        project.task(<span class="hljs-string">&quot;Method1PluginTask&quot;</span>)&#123;<br>            doLast &#123;<br>                println <span class="hljs-string">&#x27;Method1PluginTask exec success...&#x27;</span><br>            &#125;<br>        &#125;<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">//3ã€æ‰§è¡Œ Method1PluginTask</span><br>./gradlew Method1PluginTask<br><br><span class="hljs-comment">//æ‰“å°ç»“æœ</span><br>&gt; Configure <span class="hljs-attr">project :</span>app<br>I am Method1Plugin <br><br>&gt; <span class="hljs-attr">Task :</span><span class="hljs-attr">app:</span>Method1PluginTask<br>Method1PluginTask exec success...<br></code></pre></td></tr></table></figure><p>ä½†è¿™ç§æ–¹å¼æœ‰ä¸€ä¸ªå¾ˆå¤§çš„ç¼ºç‚¹ï¼š<strong>åªèƒ½åœ¨å½“å‰ build.gradle è„šæœ¬æ–‡ä»¶ä¸‹ä½¿ç”¨ï¼Œå…¶ä»–çš„  build.gradle ç”¨ä¸äº†ï¼Œå±€é™æ€§å¾ˆå¼º</strong></p><p>é‚£ä¹ˆè¿™ä¸ªæ—¶å€™æˆ‘ä»¬å°±å¯ä»¥è€ƒè™‘ä½¿ç”¨ buildSrc çš„æ–¹å¼æ¥ç¼–å†™æ’ä»¶</p><h3 id="2ï¼‰ã€buildSrc-é»˜è®¤æ’ä»¶ç›®å½•ä¸‹ç¼–å†™"><a href="#2ï¼‰ã€buildSrc-é»˜è®¤æ’ä»¶ç›®å½•ä¸‹ç¼–å†™" class="headerlink" title="2ï¼‰ã€buildSrc é»˜è®¤æ’ä»¶ç›®å½•ä¸‹ç¼–å†™"></a>2ï¼‰ã€buildSrc é»˜è®¤æ’ä»¶ç›®å½•ä¸‹ç¼–å†™</h3><p>åœ¨ Android å·¥ç¨‹ä¸­ï¼ŒbuildSrc æ˜¯ Gradle é»˜è®¤çš„æ’ä»¶ç›®å½•ï¼Œç¼–è¯‘ Gradle çš„æ—¶å€™ä¼šè‡ªåŠ¨è¯†åˆ«è¿™ä¸ªç›®å½•ï¼Œå› æ­¤åœ¨ buildSrc ä¸‹ç¼–å†™çš„æ’ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥è¿›è¡Œå¼•ç”¨ã€‚<strong>é€šå¸¸æˆ‘ä»¬ä¼šä½¿ç”¨è¿™ç§æ–¹å¼è¿›è¡Œæ’ä»¶çš„è°ƒè¯•</strong></p><p>buildSrc æ–¹å¼å…·ä½“ä½¿ç”¨æ­¥éª¤å¦‚ä¸‹ï¼š</p><h4 id="1ã€æ­¥éª¤ä¸€"><a href="#1ã€æ­¥éª¤ä¸€" class="headerlink" title="1ã€æ­¥éª¤ä¸€"></a>1ã€æ­¥éª¤ä¸€</h4><p>é¦–å…ˆåˆ›å»ºä¸€ä¸ªåä¸º <strong>buildSrc</strong> çš„ Java Module (å»ºç«‹ Android Module ä¹Ÿå¯ä»¥ï¼Œä½†æ˜¯åˆ é™¤çš„ä¸œè¥¿å¤šğŸ˜‚)ï¼Œåªä¿ç•™ <strong>build.gradle</strong> æ–‡ä»¶å’Œ <strong>src&#x2F;main</strong> ç›®å½•ï¼Œå…¶ä½™çš„å…¨éƒ¨åˆ é™¤</p><p><strong>æ³¨æ„</strong>ï¼š</p><p>1ã€åˆ›å»ºçš„ Module åå­—ä¸€å®šè¦æ˜¯ buildSrc , ä¸ç„¶ä¼šæ‰¾ä¸åˆ°æ’ä»¶</p><p>2ã€buildSrc çš„æ‰§è¡Œæ—¶æœºä¸ä»…æ—©äºä»»ä½•â¼€ä¸ª projectï¼ˆbuild.gradleï¼‰ï¼Œè€Œä¸”ä¹Ÿæ—©äº settings.gradle</p><p>3ã€å½“ä½ åˆ›å»ºä¸€ä¸ª buildSrc Module åï¼ˆæ— è®ºæ˜¯ Java Module è¿˜æ˜¯ Android Moduleï¼‰ï¼ŒGradle æ„å»ºçš„æ—¶å€™ä¼šåœ¨ settings.gradle æ–‡ä»¶ä¸­å¼•å…¥å½“å‰ moduleï¼Œ å› æ­¤å®ƒä¼šè¢«æ‰§è¡Œä¸¤éï¼Œè¿™ä¸ªæ—¶å€™ Gradle ä¼šæŠ¥å¦‚ä¸‹é”™è¯¯ï¼š</p><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/48731dd12c4d4829940395f69a83e7fa~tplv-k3u1fbpfcp-zoom-1.image" alt="image-20210722104436027"></p><p>å¤§è‡´æ„æ€æ˜¯ï¼šâ€™buildSrcâ€™ ä¸èƒ½ç”¨ä½œé¡¹ç›®åï¼Œå› ä¸ºå®ƒæ˜¯ä¿ç•™åã€‚å› æ­¤æˆ‘ä»¬éœ€è¦åˆ é™¤ settings.gradle æ–‡ä»¶ä¸­å¼•å…¥çš„ buildSrc é…ç½®</p><h4 id="2ã€æ­¥éª¤äºŒ"><a href="#2ã€æ­¥éª¤äºŒ" class="headerlink" title="2ã€æ­¥éª¤äºŒ"></a>2ã€æ­¥éª¤äºŒ</h4><p>ä¿®æ”¹ build.gradle æ–‡ä»¶ä¸­çš„å†…å®¹</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs groovy"><span class="hljs-comment">//ä¾èµ– groovy æ’ä»¶ï¼Œè¿™ä¸ªæ˜¯ Gradle å†…ç½®çš„æ’ä»¶</span><br>apply <span class="hljs-attr">plugin:</span> <span class="hljs-string">&#x27;groovy&#x27;</span><br><br><span class="hljs-comment">//å¼•å…¥ç›¸å…³çš„ä¾èµ–</span><br>dependencies &#123;<br>    <span class="hljs-comment">//Groovy DSL</span><br>    implementation gradleApi()<br>    <span class="hljs-comment">//Gradle DSL</span><br>    implementation localGroovy()<br>&#125;<br><br><span class="hljs-comment">//å¼•å…¥ç›¸å…³çš„ä»“åº“</span><br>repositories &#123;<br>    mavenCentral()<br>&#125;<br><br><span class="hljs-comment">//æŒ‡å®šå¥½ç›¸å…³èµ„æºç›®å½•ï¼Œå®é™…ä¸Šä¹Ÿå¯ä»¥ä¸ç”¨æŒ‡å®šï¼ŒAndroidStudio èƒ½å¤Ÿè‡ªåŠ¨è¯†åˆ«å‡ºæ¥</span><br>sourceSets &#123;<br>    main &#123;<br>        groovy &#123;<br>            srcDir <span class="hljs-string">&#x27;src/main/groovy&#x27;</span><br>        &#125;<br>      <br>      resources &#123;<br>            srcDir <span class="hljs-string">&#x27;src/main/resources&#x27;</span><br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ä¿®æ”¹å¥½åï¼Œ build ä¸€ä¸‹é¡¹ç›®ï¼Œè¿™ä¸ªæ—¶å€™ä½ å°±èƒ½çœ‹åˆ° Gradle æŠŠå®ƒè¯†åˆ«ä¸ºä¸€ä¸ªæ’ä»¶ç›®å½•äº†</p><h4 id="3ã€æ­¥éª¤ä¸‰"><a href="#3ã€æ­¥éª¤ä¸‰" class="headerlink" title="3ã€æ­¥éª¤ä¸‰"></a>3ã€æ­¥éª¤ä¸‰</h4><p>åœ¨ src&#x2F;main ä¸‹åˆ›å»º groovy ç›®å½•ï¼Œç„¶åæ ¹æ®è‡ªå·±å–œå¥½åˆ›å»ºæ’ä»¶ä»£ç å­˜æ”¾çš„åŒ…è·¯å¾„ï¼Œç¼–å†™æ’ä»¶å³å¯ï¼Œæˆ‘ç¼–å†™çš„æ’ä»¶ä»£ç å¦‚ä¸‹æˆªå›¾ï¼š</p><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/7ad37d5e82334a7298b3b764a4eb78f4~tplv-k3u1fbpfcp-zoom-1.image" alt="image-20210722160741350"></p><p><strong>æ³¨æ„ï¼š</strong></p><p>1ã€æˆ‘è¿™é‡Œæ˜¯ç”¨ groovy è¯­æ³•å†™çš„ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ª <code>.groovy</code> ä¸ºåç¼€çš„æ–‡ä»¶ç¼–å†™æ’ä»¶ä»£ç ï¼Œæˆ‘åˆ›å»ºçš„æ˜¯ï¼š BuildSrcPlugin.groovy</p><p>2ã€åˆ›å»ºçš„ groovy æ–‡ä»¶é‡Œé¢å•¥éƒ½æ²¡æœ‰ï¼Œéœ€è¦æˆ‘ä»¬æ‰‹åŠ¨å¼•å…¥åŒ…è·¯å¾„ï¼Œç„¶åè¿›è¡Œç›¸å…³é€»è¾‘ç¼–å†™</p><h4 id="4ã€æ­¥éª¤å››"><a href="#4ã€æ­¥éª¤å››" class="headerlink" title="4ã€æ­¥éª¤å››"></a>4ã€æ­¥éª¤å››</h4><p>è¿™ä¸€æ­¥å®é™…ä¸Šå°±æ˜¯æ³¨å†Œæˆ‘ä»¬ç¼–å†™çš„æ’ä»¶ç±»ï¼Œæ–¹ä¾¿å¤–éƒ¨å¼•ç”¨ï¼Œä»‹ç»ä¸¤ç§æ³¨å†Œæ–¹å¼ï¼š</p><p>1ã€åˆ›å»ºä¸€ç³»åˆ—æ–‡ä»¶å¤¹è¿›è¡Œæ’ä»¶æ³¨å†Œ</p><p>2ã€é€šè¿‡ Gradle é…ç½®è¿›è¡Œæ’ä»¶æ³¨å†Œ</p><h5 id="1ã€åˆ›å»ºä¸€ç³»åˆ—æ–‡ä»¶å¤¹è¿›è¡Œæ’ä»¶æ³¨å†Œ"><a href="#1ã€åˆ›å»ºä¸€ç³»åˆ—æ–‡ä»¶å¤¹è¿›è¡Œæ’ä»¶æ³¨å†Œ" class="headerlink" title="1ã€åˆ›å»ºä¸€ç³»åˆ—æ–‡ä»¶å¤¹è¿›è¡Œæ’ä»¶æ³¨å†Œ"></a>1ã€åˆ›å»ºä¸€ç³»åˆ—æ–‡ä»¶å¤¹è¿›è¡Œæ’ä»¶æ³¨å†Œ</h5><p>åœ¨  src&#x2F;main ä¸‹åˆ›å»º resources ç›®å½•ï¼Œåœ¨  resources ç›®å½•ä¸‹åˆ›å»º META-INF ç›®å½•ï¼Œåœ¨ META-INF ç›®å½•ä¸‹åˆ›å»º gradle-plugins ç›®å½•ï¼Œåœ¨ gradle-plugins ç›®å½•ä¸‹åˆ›å»º <code>.properties</code> ä¸ºåç¼€çš„æ–‡ä»¶ï¼Œåå­—å¯ä»¥æ ¹æ®è‡ªå·±çš„å–œå¥½å–ï¼Œæœ€ååœ¨åˆ›å»ºçš„ properties æ–‡ä»¶ä¸‹æ ‡è¯†è¯¥æ’ä»¶å¯¹åº”çš„ç±»è·¯å¾„å³å¯å®Œæˆæ’ä»¶çš„æ³¨å†Œï¼Œå¦‚ä¸‹ï¼š</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs groovy">implementation-<span class="hljs-keyword">class</span>=com.dream.plugin.BuildSrcPlugin<br></code></pre></td></tr></table></figure><p><strong>æ³¨æ„</strong>ï¼š</p><p>1ã€ä¸Šé¢çš„ç›®å½•åç§°éƒ½æ˜¯å›ºå®šçš„ï¼Œåˆ«å†™é”™äº†ï¼Œä¸ç„¶å¼•ç”¨çš„æ—¶å€™ä¼šæ‰¾ä¸åˆ°æ’ä»¶</p><p>2ã€ä½ åˆ›å»ºçš„è¿™ä¸ª properties æ–‡ä»¶çš„åå­—å¾ˆé‡è¦ï¼Œåç»­å¼•ç”¨æ’ä»¶å°±æ˜¯æ ¹æ®è¿™ä¸ªåç§°æ¥çš„ï¼Œä¾‹å¦‚æˆ‘åˆ›å»ºçš„åç§°ä¸º <strong>BuildSrcPlugin.properties</strong> , é‚£ä¹ˆå¼•ç”¨æ’ä»¶çš„æ—¶å€™å°±æ˜¯è¿™æ ·ï¼š</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs groovy">apply <span class="hljs-attr">plugin:</span> <span class="hljs-string">&#x27;BuildSrcPlugin&#x27;</span><br></code></pre></td></tr></table></figure><p>ä¸Šé¢ä¸‰ï¼Œå››æ­¥éª¤å®Œæˆåï¼Œé¡¹ç›®ç»“æ„å¦‚ä¸‹å›¾ï¼š</p><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/2cd9b620154744b5882de52ccd4aae62~tplv-k3u1fbpfcp-zoom-1.image" alt="image-20210722143609118"></p><p>è¿™ç§æ³¨å†Œæ–¹å¼æ¯”è¾ƒå›ºå®šï¼Œå®¹æ˜“å‡ºé”™ï¼Œä¸æ¨èä½¿ç”¨ï¼Œä¸‹é¢ä»‹ç»å¦å¤–ä¸€ç§æ³¨å†Œæ–¹å¼</p><h5 id="2ã€é€šè¿‡-Gradle-é…ç½®è¿›è¡Œæ’ä»¶æ³¨å†Œ"><a href="#2ã€é€šè¿‡-Gradle-é…ç½®è¿›è¡Œæ’ä»¶æ³¨å†Œ" class="headerlink" title="2ã€é€šè¿‡ Gradle é…ç½®è¿›è¡Œæ’ä»¶æ³¨å†Œ"></a>2ã€é€šè¿‡ Gradle é…ç½®è¿›è¡Œæ’ä»¶æ³¨å†Œ</h5><p>åœ¨æ’ä»¶çš„ build.gradle ä¸­è¿›è¡Œå¦‚ä¸‹é…ç½®ï¼š</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs groovy"><span class="hljs-comment">//...</span><br><span class="hljs-comment">//1ã€å¼•å…¥ java-gradle-plugin æ’ä»¶</span><br>apply <span class="hljs-attr">plugin:</span> <span class="hljs-string">&#x27;java-gradle-plugin&#x27;</span><br><br><br><span class="hljs-comment">//2ã€è¿›è¡Œæ’ä»¶æ³¨å†Œç›¸å…³çš„é…ç½®</span><br>gradlePlugin &#123;<br>    plugins &#123;<br>        greeting &#123;<br>            <span class="hljs-comment">// æ’ä»¶id</span><br>            id = <span class="hljs-string">&#x27;BuildSrcPlugin&#x27;</span><br>            <span class="hljs-comment">// æ’ä»¶å®ç°ç±»</span><br>            implementationClass = <span class="hljs-string">&#x27;com.dream.plugin.BuildSrcPlugin&#x27;</span><br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™ç§æ–¹å¼æ¯”è¾ƒç®€å•ï¼Œä¸å®¹æ˜“å‡ºé”™ï¼Œæ¨èä½¿ç”¨</p><p>ok, ç»è¿‡ä¸Šé¢ 4 ä¸ªæ­¥éª¤ï¼Œæˆ‘ä»¬çš„æ’ä»¶å°±ç¼–å†™å®Œæˆäº†ï¼Œæ¥ä¸‹æ¥ç›´æ¥å¼•ç”¨å³å¯ï¼Œåœ¨éœ€è¦çš„ build.gradle è¿›è¡Œå¼•ç”¨ï¼š</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs groovy"><span class="hljs-comment">//å½“å‰åœ¨ app çš„ build.gradle ä¸‹</span><br><br>apply <span class="hljs-attr">plugin:</span> <span class="hljs-string">&#x27;BuildSrcPlugin&#x27;</span><br><br><span class="hljs-comment">//å› ä¸ºå½“å‰æ’ä»¶ä¸­çš„ Task æŒ‚æ¥åˆ°äº†æ„å»ºæµç¨‹ä¸­çš„ Taskï¼Œæˆ‘ä»¬ç›´æ¥è¿è¡Œé¡¹ç›®å°±å¯ä»¥çœ‹åˆ°æ‰“å°ç»“æœï¼Œå¦‚ä¸‹æˆªå›¾</span><br></code></pre></td></tr></table></figure><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/534911a6b92e463588a32874ec3f3548~tplv-k3u1fbpfcp-zoom-1.image" alt="image-20210722142743405"></p><p>buildSrc æ–¹å¼çš„ç¼ºç‚¹ï¼š<strong>åªèƒ½åœ¨å½“å‰å·¥ç¨‹ä¸­ä½¿ç”¨ï¼Œå…¶ä»–çš„é¡¹ç›®å·¥ç¨‹ä½¿ç”¨ä¸äº†ï¼Œé‚£å¦‚æœæˆ‘å¸Œæœ›ç¼–å†™çš„æ’ä»¶å…¶ä»–é¡¹ç›®ä¹Ÿèƒ½ç”¨ï¼Œè¿™ç§æ–¹å¼å°±åšä¸åˆ°äº†</strong></p><h3 id="3ï¼‰ã€åœ¨è‡ªå®šä¹‰é¡¹ç›®ä¸‹ç¼–å†™"><a href="#3ï¼‰ã€åœ¨è‡ªå®šä¹‰é¡¹ç›®ä¸‹ç¼–å†™" class="headerlink" title="3ï¼‰ã€åœ¨è‡ªå®šä¹‰é¡¹ç›®ä¸‹ç¼–å†™"></a>3ï¼‰ã€åœ¨è‡ªå®šä¹‰é¡¹ç›®ä¸‹ç¼–å†™</h3><p>å‰é¢æˆ‘ä»¬è®²åˆ°ï¼ŒbuildSrc æ–¹å¼çš„ç¼ºç‚¹å°±æ˜¯åªèƒ½åœ¨å½“å‰é¡¹ç›®å·¥ç¨‹ä¸‹ä½¿ç”¨ï¼Œå¦‚æœè¦åœ¨å…¶ä»–çš„å·¥ç¨‹ä½¿ç”¨ï¼Œåˆ™ä½¿ç”¨ä¸äº†ã€‚é‚£ä¹ˆè¿™ä¸ªæ—¶å€™æˆ‘ä»¬å°±å¯ä»¥é‡‡ç”¨è‡ªå®šä¹‰é¡¹ç›®ä¸‹ç¼–å†™æ’ä»¶ï¼Œç„¶åæŠŠå½“å‰æ’ä»¶å‘å¸ƒåˆ°è¿œç¨‹ä»“åº“ï¼Œæœ€åå¯¹æ’ä»¶è¿›è¡Œå¼•ç”¨å³å¯</p><p>ç±»ä¼¼äº Android Gradle Plugin çš„æ’ä»¶å¼•ç”¨ï¼Œå¦‚ä¸‹ï¼š</p><p>1ã€åœ¨æ ¹ build.gradle ä¸­æ·»åŠ å¦‚ä¸‹ä»£ç :</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs groovy">buildscript &#123;<br>    <span class="hljs-comment">//é…ç½®æ’ä»¶çš„ä»“åº“åœ°å€</span><br>    repositories &#123;<br>        google()<br>        mavenCentral()<br>    &#125;<br>    <span class="hljs-comment">//é…ç½®æ’ä»¶çš„ä¾èµ–</span><br>    dependencies &#123;<br>        classpath <span class="hljs-string">&quot;com.android.tools.build:gradle:4.2.1&quot;</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>2ã€åœ¨å­ build.gradle ä¸­å¼•ç”¨æ’ä»¶</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs groovy"><span class="hljs-comment">//1ã€å¦‚æœæ˜¯ Android åº”ç”¨å·¥ç¨‹</span><br>apply <span class="hljs-attr">plugin:</span> <span class="hljs-string">&#x27;com.android.application&#x27;</span><br><br><span class="hljs-comment">//2ã€å¦‚æœæ˜¯ Android åº“å·¥ç¨‹</span><br>apply <span class="hljs-attr">plugin:</span> <span class="hljs-string">&#x27;com.android.library&#x27;</span><br></code></pre></td></tr></table></figure><p>ä¾è‘«èŠ¦ç”»ç“¢ï¼Œæˆ‘ä»¬ä¹Ÿæ¥å®ç°ä¸€ä¸ªç±»ä¼¼äº Android Gradle Plugin çš„æ’ä»¶å¼•ç”¨</p><p><strong>æ³¨æ„ï¼š</strong> è¿™ç§æ–¹å¼ç¼–å†™æ’ä»¶å’Œ buildSrc æ–¹å¼éå¸¸çš„ç±»ä¼¼ï¼ŒåŒºåˆ«å°±åœ¨äºï¼š</p><blockquote><p>1ã€è‡ªå®šä¹‰äº†é¡¹ç›®åç§°</p><p>2ã€å¢åŠ äº†ä¸Šä¼ åˆ°è¿œç¨‹ä»“åº“çš„é…ç½®</p></blockquote><p>å› æ­¤å¦‚æœä½ ä¸æƒ³é€šè¿‡è‡ªå®šä¹‰é¡¹ç›®çš„æ–¹å¼ç¼–å†™æ’ä»¶ï¼Œä½ å¯ä»¥æŠŠä¸Šä¼ åˆ°è¿œç¨‹ä»“åº“çš„é…ç½®å†™åœ¨ buildSrc çš„ build.gradle é‡Œé¢ï¼Œç„¶åè¿›è¡Œä¸Šä¼ </p><p>ä¸‹é¢æˆ‘ä»¬å°±é€šè¿‡è‡ªå®šä¹‰é¡¹ç›®çš„æ–¹å¼å»ç¼–å†™ä¸€ä¸ªæ’ä»¶</p><h4 id="1ã€è‡ªå®šä¹‰ä¸€ä¸ª-Java-Moduleï¼Œåå­—ä»»æ„å–"><a href="#1ã€è‡ªå®šä¹‰ä¸€ä¸ª-Java-Moduleï¼Œåå­—ä»»æ„å–" class="headerlink" title="1ã€è‡ªå®šä¹‰ä¸€ä¸ª Java Moduleï¼Œåå­—ä»»æ„å–"></a>1ã€è‡ªå®šä¹‰ä¸€ä¸ª Java Moduleï¼Œåå­—ä»»æ„å–</h4><p>æˆ‘è¿™é‡Œè‡ªå®šä¹‰äº†ä¸€ä¸ª customplugin çš„ Java Moduleï¼Œå…¶ä½™æ­¥éª¤å’Œ buildSrc æ–¹å¼åŸºæœ¬ä¸€æ ·ï¼Œå”¯ä¸€çš„ä¸åŒå°±æ˜¯ build.gradle è¿™ä¸ªæ–‡ä»¶ä¸­æ–°å¢äº†ä¸Šä¼ åˆ° Maven çš„é…ç½®ï¼Œè¿™é‡Œæˆ‘æ˜¯ä¸Šä¼ åˆ°æœ¬åœ° Maven</p><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/842ac9d4e76e4cadb1481ffca307aeeb~tplv-k3u1fbpfcp-zoom-1.image" alt="image-20210723155621390"></p><p>çœ‹ä¸€çœ¼æˆ‘ä»¬çš„ build.gradle æ–‡ä»¶ï¼š</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><code class="hljs groovy">apply <span class="hljs-attr">plugin:</span> <span class="hljs-string">&#x27;groovy&#x27;</span><br>apply <span class="hljs-attr">plugin:</span> <span class="hljs-string">&#x27;java-gradle-plugin&#x27;</span><br>apply <span class="hljs-attr">plugin:</span> <span class="hljs-string">&#x27;maven&#x27;</span><br><br><br><span class="hljs-comment">//å¼•å…¥ç›¸å…³çš„ä¾èµ–</span><br>dependencies &#123;<br>    <span class="hljs-comment">//Groovy DSL</span><br>    implementation gradleApi()<br>    <span class="hljs-comment">//Gradle DSL</span><br>    implementation localGroovy()<br>&#125;<br><br><span class="hljs-comment">//å¼•å…¥ç›¸å…³çš„ä»“åº“</span><br>repositories &#123;<br>    mavenCentral()<br>&#125;<br><br><span class="hljs-comment">//Gradle é…ç½®çš„æ–¹å¼æ³¨å†Œæ’ä»¶</span><br>gradlePlugin &#123;<br>    plugins &#123;<br>        greeting &#123;<br>            <span class="hljs-comment">// æ’ä»¶id</span><br>            id = <span class="hljs-string">&#x27;CustomPlugin&#x27;</span><br>            <span class="hljs-comment">// æ’ä»¶å®ç°ç±»</span><br>            implementationClass = <span class="hljs-string">&#x27;com.dream.plugin.CustomPlugin&#x27;</span><br>        &#125;<br>    &#125;<br>&#125;<br><br><br><span class="hljs-comment">//å°†æ’ä»¶æ‰“åŒ…ä¸Šä¼ åˆ°æœ¬åœ°mavenä»“åº“</span><br>uploadArchives &#123;<br>    repositories &#123;<br>        mavenDeployer &#123;<br>            <span class="hljs-comment">//æŒ‡å®š maven å‘å¸ƒä¸‰å‰‘å®¢</span><br>            pom.groupId = <span class="hljs-string">&#x27;com.dream&#x27;</span><br>            pom.artifactId = <span class="hljs-string">&#x27;customplugin&#x27;</span><br>            pom.version = <span class="hljs-string">&#x27;1.0.0&#x27;</span><br>            <span class="hljs-comment">//æŒ‡å®šæœ¬åœ° maven ä»“åº“çš„è·¯å¾„ï¼Œè¿™é‡Œæˆ‘æŒ‡å®šçš„å°±æ˜¯å½“å‰ Module ç›®å½•ä¸‹</span><br>            repository(<span class="hljs-attr">url:</span> uri(<span class="hljs-string">&#x27;../customplugin&#x27;</span>))<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ä¸Šè¿°é…ç½®æ–‡ä»¶æ–°å¢çš„å†…å®¹ï¼š</p><p>1ã€é‡‡ç”¨äº† Gradle é…ç½®çš„æ–¹å¼è¿›è¡Œæ’ä»¶çš„æ³¨å†Œ</p><p>2ã€å¢åŠ äº†ä¸Šä¼ åˆ° maven æœ¬åœ°ä»“åº“çš„é…ç½®</p><p>æ¥ç€çœ‹ä¸€çœ¼æˆ‘ä»¬çš„é¡¹ç›®ç»“æ„å’Œç¼–å†™çš„æ’ä»¶ï¼š</p><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/d3d5d3e543dd4b58851958448fe435e4~tplv-k3u1fbpfcp-zoom-1.image" alt="image-20210722201238241"></p><h4 id="2ã€å°†å½“å‰æ’ä»¶å‘å¸ƒåˆ°æœ¬åœ°-Maven-ä»“åº“"><a href="#2ã€å°†å½“å‰æ’ä»¶å‘å¸ƒåˆ°æœ¬åœ°-Maven-ä»“åº“" class="headerlink" title="2ã€å°†å½“å‰æ’ä»¶å‘å¸ƒåˆ°æœ¬åœ° Maven ä»“åº“"></a>2ã€å°†å½“å‰æ’ä»¶å‘å¸ƒåˆ°æœ¬åœ° Maven ä»“åº“</h4><p>æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸¤ç§æ–¹å¼å»æ“ä½œï¼š</p><blockquote><p>1ã€æ‰§è¡Œ <code>./gradlew uploadArchives</code> å‘½ä»¤</p><p>2ã€åœ¨ AndroidStudio æ‰¾åˆ° Gradle å¯è§†åŒ–ç•Œé¢çš„ uploadArchives Task ç‚¹å‡»å‘å¸ƒ</p></blockquote><p>å¦‚æœä¸Šä¼ æˆåŠŸï¼Œä½ å°†çœ‹åˆ°å¦‚ä¸‹ä¸€äº›æ–‡ä»¶ï¼š</p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/1b1ee1594cad4394be3515a825a4ade6~tplv-k3u1fbpfcp-zoom-1.image" alt="image-20210722203228840"  /><p>ä¸Šä¼ åˆ°æœ¬åœ° Maven ä»“åº“æˆåŠŸåï¼Œæˆ‘ä»¬å°±å¯ä»¥åƒä½¿ç”¨ Android Gradle Plugin é‚£æ ·ä½¿ç”¨æ’ä»¶äº†</p><h4 id="3ã€æ’ä»¶ä¾èµ–é…ç½®"><a href="#3ã€æ’ä»¶ä¾èµ–é…ç½®" class="headerlink" title="3ã€æ’ä»¶ä¾èµ–é…ç½®"></a>3ã€æ’ä»¶ä¾èµ–é…ç½®</h4><p><strong>æ³¨æ„</strong>ï¼šæ’ä»¶ä¾èµ–å°±æ˜¯æˆ‘ä»¬åœ¨ä¸Šä¼ åˆ° Maven ä»“åº“é…ç½®çš„é‚£ä¸‰å‰‘å®¢ï¼Œæ ¼å¼ä¸ºï¼š</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs groovy">classpath <span class="hljs-string">&#x27;[groupId]:[artifactId]:[version]&#x27;</span> <br></code></pre></td></tr></table></figure><p>å¦‚ä¸‹ï¼š</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs groovy"><span class="hljs-comment">//åœ¨æ ¹ build.gradle ä¸­å¼•å…¥æœ¬åœ°ä»“åº“å’Œæ’ä»¶ä¾èµ–</span><br>buildscript &#123;<br>    repositories &#123;<br>        google()<br>        mavenCentral()<br>        jcenter()<br>      <span class="hljs-comment">//å¼•å…¥æœ¬åœ° Maven ä»“åº“</span><br>        maven&#123;<br>            url uri(<span class="hljs-string">&#x27;customplugin&#x27;</span>)<br>        &#125;<br>    &#125;<br>    dependencies &#123;<br>        classpath <span class="hljs-string">&quot;com.android.tools.build:gradle:4.2.1&quot;</span><br>      <span class="hljs-comment">//å¼•å…¥æ’ä»¶ä¾èµ–</span><br>        classpath <span class="hljs-string">&quot;com.dream:customplugin:1.0.0&quot;</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ä¸Šè¿°æ­¥éª¤å®Œæˆä¹‹åï¼Œæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨æ’ä»¶äº†ï¼Œåœ¨éœ€è¦çš„ build.gradle è¿›è¡Œå¼•ç”¨ï¼š</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs groovy"><span class="hljs-comment">//å½“å‰åœ¨ app çš„ build.gradle ä¸‹</span><br><br>apply <span class="hljs-attr">plugin:</span> <span class="hljs-string">&#x27;CustomPlugin&#x27;</span><br><br><span class="hljs-comment">//å› ä¸ºå½“å‰æ’ä»¶ä¸­çš„ Task æŒ‚æ¥åˆ°äº†æ„å»ºæµç¨‹ä¸­çš„ Taskï¼Œæˆ‘ä»¬ç›´æ¥è¿è¡Œé¡¹ç›®å°±å¯ä»¥çœ‹åˆ°æ‰“å°ç»“æœï¼Œå¦‚ä¸‹æˆªå›¾</span><br></code></pre></td></tr></table></figure><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/75c517e03ea14ed9812d78d9b867dd32~tplv-k3u1fbpfcp-zoom-1.image" alt="image-20210722204535977"  /><p>è‡³æ­¤ï¼Œå…³äºå¯¹è±¡æ’ä»¶çš„ç¼–å†™åŠåº”ç”¨å°±è®²çš„å·®ä¸å¤šäº†ï¼Œæ¥ä¸‹æ¥è®²ä¸‹å¦‚ä½•å‘å¸ƒæ’ä»¶åˆ°è¿œç¨‹ä»“åº“</p><h2 id="å››ã€å‘å¸ƒæ’ä»¶åˆ°è¿œç¨‹ä»“åº“"><a href="#å››ã€å‘å¸ƒæ’ä»¶åˆ°è¿œç¨‹ä»“åº“" class="headerlink" title="å››ã€å‘å¸ƒæ’ä»¶åˆ°è¿œç¨‹ä»“åº“"></a>å››ã€å‘å¸ƒæ’ä»¶åˆ°è¿œç¨‹ä»“åº“</h2><p>æˆ‘ä»¬å¸¸ç”¨çš„è¿œç¨‹ä»“åº“æœ‰ï¼šJcenterï¼ŒmavenCentralï¼ŒMaven ç§æœä»“åº“ï¼ŒJitPackç­‰ç­‰</p><p><strong>å…³äº Jcenter</strong></p><p>Jcenter å®˜æ–¹åœ¨ 2021.2.3 å‘å¸ƒå£°æ˜å³å°†åœæ­¢ Jcenter çš„è¿è¥</p><blockquote><p>è‡ª 2021.3.31åä¸åœ¨æ¥å—ä»»ä½•æ–°çš„æäº¤ï¼Œåœ¨2022.2.1å‰ï¼Œä½ è¿˜æ˜¯å¯ä»¥æ­£å¸¸æ‹‰å–2021.3.31å‰æäº¤çš„åº“</p></blockquote><p>å› æ­¤è¿™é‡Œå°±ä¸è®²å¦‚ä½•å‘å¸ƒæ’ä»¶åˆ° Jcenter</p><p><strong>å…³äº mavenCentral</strong></p><p>è‡ª Jcenter å®£å¸ƒå³å°†åœæ­¢æœåŠ¡åï¼Œå¾ˆå¤šç¬¬ä¸‰æ–¹åº“å’Œæ’ä»¶éƒ½è¿ç§»åˆ°äº† mavenCentral ï¼Œä½†æ˜¯å‘å¸ƒ mavenCentral æµç¨‹ç›¸å¯¹æ¯”è¾ƒå¤æ‚ï¼Œè¿™é‡Œä¸åšè¿‡å¤šèµ˜è¿°ï¼Œåç»­æˆ‘ä¼šä¸“é—¨å†™ä¸€éæ–‡ç« æ•™å¤§å®¶å¦‚ä½•ä¸Šä¼ åˆ° mavenCentral</p><h3 id="1ï¼‰ã€å‘å¸ƒæ’ä»¶åˆ°-Maven-ç§æœä»“åº“"><a href="#1ï¼‰ã€å‘å¸ƒæ’ä»¶åˆ°-Maven-ç§æœä»“åº“" class="headerlink" title="1ï¼‰ã€å‘å¸ƒæ’ä»¶åˆ° Maven ç§æœä»“åº“"></a>1ï¼‰ã€å‘å¸ƒæ’ä»¶åˆ° Maven ç§æœä»“åº“</h3><p>å¦‚æœæœ‰ Maven ç§æœä»“åº“ï¼Œé‚£å‘å¸ƒæ’ä»¶å°†ä¼šå˜å¾—å¼‚å¸¸ç®€å•ï¼Œä½ åªéœ€è¦å°† build.gradle é‡Œé¢çš„æœ¬åœ°ä»“åº“æ”¹æˆè¿œç¨‹ä»“åº“åœ°å€ï¼Œå¹¶éªŒè¯ç”¨æˆ·åå¯†ç å³å¯ï¼Œå¦‚ä¸‹ï¼š</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs groovy"><span class="hljs-comment">//å¼•å…¥ maven æ’ä»¶</span><br>apply <span class="hljs-attr">plugin:</span> <span class="hljs-string">&#x27;maven&#x27;</span><br><br><span class="hljs-comment">//å°†æ’ä»¶æ‰“åŒ…ä¸Šä¼ åˆ°è¿œç¨‹ maven ä»“åº“</span><br>uploadArchives &#123;<br>    repositories &#123;<br>        mavenDeployer &#123;<br>            <span class="hljs-comment">//æŒ‡å®š maven å‘å¸ƒä¸‰å‰‘å®¢</span><br>            pom.groupId = <span class="hljs-string">&#x27;com.dream&#x27;</span><br>            pom.artifactId = <span class="hljs-string">&#x27;customplugin&#x27;</span><br>            pom.version = <span class="hljs-string">&#x27;1.0.0&#x27;</span><br>            <span class="hljs-comment">//æŒ‡å®šè¿œç¨‹ä»“åº“</span><br>            repository(<span class="hljs-attr">url:</span> <span class="hljs-string">&#x27;ä½ çš„è¿œç¨‹ä»“åº“åœ°å€&#x27;</span>)&#123;<br>              authentication(<span class="hljs-attr">userName:</span> <span class="hljs-string">&#x27;ç”¨æˆ·å&#x27;</span>, <span class="hljs-attr">password:</span> <span class="hljs-string">&quot;å¯†ç &quot;</span>)<br>            &#125;<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><strong>æ³¨æ„ï¼š</strong> ä¸€èˆ¬å…¬å¸éƒ½ä¼šæ­å»ºè‡ªå·±çš„ Maven ä»“åº“</p><h3 id="2ï¼‰ã€å‘å¸ƒæ’ä»¶åˆ°-JitPack"><a href="#2ï¼‰ã€å‘å¸ƒæ’ä»¶åˆ°-JitPack" class="headerlink" title="2ï¼‰ã€å‘å¸ƒæ’ä»¶åˆ° JitPack"></a>2ï¼‰ã€å‘å¸ƒæ’ä»¶åˆ° JitPack</h3><p>ä¹‹å‰æˆ‘å†™è¿‡ä¸€ç¯‡æ–‡ç« æ•™å¤§å®¶å¦‚ä½•ä¸Šä¼ ç¬¬ä¸‰æ–¹åº“åˆ° JitPack <a href="https://juejin.cn/post/6916061679079915528#heading-9">ä¼ é€é—¨</a> ï¼Œå®é™…ä¸Šä¸Šä¼ æ’ä»¶ä¹Ÿæ˜¯åŒæ ·çš„æ“ä½œ</p><h4 id="1ã€åˆ›å»ºå¥½é¡¹ç›®å¹¶ç¼–å†™-Gradle-æ’ä»¶"><a href="#1ã€åˆ›å»ºå¥½é¡¹ç›®å¹¶ç¼–å†™-Gradle-æ’ä»¶" class="headerlink" title="1ã€åˆ›å»ºå¥½é¡¹ç›®å¹¶ç¼–å†™ Gradle æ’ä»¶"></a>1ã€åˆ›å»ºå¥½é¡¹ç›®å¹¶ç¼–å†™ Gradle æ’ä»¶</h4><p>è¿™ä¸€æ­¥æˆ‘ä»¬å·²ç»å®Œæˆï¼Œä½†æ˜¯æœ‰ä¸€ä¸ªéœ€è¦æ³¨æ„çš„åœ°æ–¹ï¼š</p><p><strong>ä½ çš„é¡¹ç›®åç§°ï¼ˆæ ¹å·¥ç¨‹çš„åç§°ï¼‰å°†ä¼šä½œä¸ºæ’ä»¶ä¾èµ–çš„ artifactIdï¼Œå› æ­¤æˆ‘ä»¬åœ¨åˆ›å»ºé¡¹ç›®çš„æ—¶å€™å°½é‡å–ä¸€ä¸ªå¥½ç‚¹çš„åå­—</strong></p><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/8064a27b3f004af3a40b2f0b99d236c1~tplv-k3u1fbpfcp-zoom-1.image" alt="image-20210723155739473"></p><h4 id="2ã€é…ç½®å¥½ä¸Šä¼ æ’ä»¶å¹¶å°†é¡¹ç›®ä¸Šä¼ è‡³-Github"><a href="#2ã€é…ç½®å¥½ä¸Šä¼ æ’ä»¶å¹¶å°†é¡¹ç›®ä¸Šä¼ è‡³-Github" class="headerlink" title="2ã€é…ç½®å¥½ä¸Šä¼ æ’ä»¶å¹¶å°†é¡¹ç›®ä¸Šä¼ è‡³ Github"></a>2ã€é…ç½®å¥½ä¸Šä¼ æ’ä»¶å¹¶å°†é¡¹ç›®ä¸Šä¼ è‡³ Github</h4><p>ä¸Šä¼  JitPack æ’ä»¶ <a href="https://github.com/dcendents/android-maven-gradle-plugin">ä¼ é€é—¨</a></p><p>åœ¨æ ¹ build.gradle æ–‡ä»¶ä¸‹æ·»åŠ å¦‚ä¸‹æ’ä»¶ä¾èµ–ï¼š</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs groovy">buildscript &#123;<br>    <span class="hljs-comment">//...</span><br>    dependencies &#123;<br>      <span class="hljs-comment">//...</span><br>        <span class="hljs-comment">//ä¸Šä¼  JitPack æ’ä»¶ä¾èµ–</span><br>        classpath <span class="hljs-string">&#x27;com.github.dcendents:android-maven-gradle-plugin:2.1&#x27;</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>åœ¨æ’ä»¶çš„ build.gradle è¿›è¡Œå¦‚ä¸‹é…ç½®ï¼š</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs groovy">apply <span class="hljs-attr">plugin:</span> <span class="hljs-string">&#x27;com.github.dcendents.android-maven&#x27;</span><br><span class="hljs-comment">//ç»„å com.github æ˜¯å›ºå®šçš„ï¼Œåé¢çš„ sweetying520 æ˜¯æˆ‘ Github çš„ç”¨æˆ·åï¼Œæ›¿æ¢æˆä½ è‡ªå·±çš„å°±å¯ä»¥äº†</span><br>group = <span class="hljs-string">&#x27;com.github.sweetying520&#x27;</span><br></code></pre></td></tr></table></figure><p><strong>æ³¨æ„ï¼š</strong> </p><p>1ã€å®é™…æµ‹è¯•å‘ç°ï¼Œä¸Šé¢çš„ group ä½ é…ç½®æˆå…¶ä»–çš„æˆ–ä¸å†™å‡ºæ¥éƒ½æ— æ‰€è°“ï¼Œæœ€ç»ˆçš„ groupId éƒ½ä¼šæ˜¯ï¼š<code>com.github.sweetying520</code></p><p>2ã€å¦å¤–æˆ‘ä»¬ä¸Šä¼ çš„æ’ä»¶åœ¨ Github è¢«è¯´æ˜ä¸ºåºŸå¼ƒäº†ï¼Œå¹¶æ¨èæˆ‘ä»¬ä½¿ç”¨ <code>maven-publish</code> æ’ä»¶ <a href="https://developer.android.com/studio/build/maven-publish-plugin">ä¼ é€é—¨</a> å»ä¸Šä¼ ï¼Œä½†åœ¨å®é™…æµ‹è¯•è¿‡ç¨‹ä¸­ï¼Œæˆ‘å‘ç°ä½¿ç”¨  <code>maven-publish</code> æ’ä»¶ä¸Šä¼ åˆ° JitPack ä¼šä½¿å¾—æ’ä»¶çš„ä¾èµ–åœ°å€ç‰¹åˆ«é•¿ï¼Œè¿™é‡Œå°±ä¸ä»‹ç»äº†ã€‚è™½ç„¶ä¹‹å‰çš„æ’ä»¶è¢«æ ‡è¯†ä¸ºåºŸå¼ƒï¼Œä½†æ˜¯å¹¶ä¸å¦¨ç¢æˆ‘ä»¬ä½¿ç”¨</p><p>ç»è¿‡ä¸Šé¢çš„ä¸¤æ­¥ï¼Œæˆ‘ä»¬å°±æœ‰äº† groupId å’Œ artifactIdï¼Œå› ä¸ºæˆ‘çš„é¡¹ç›®åç§°å«ï¼šGradleDemoï¼Œé‚£ä¹ˆæ­¤æ—¶çš„ä¾èµ–å¦‚ä¸‹ï¼š</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs groovy">com.github.<span class="hljs-attr">sweetying520:</span>GradleDemo<br></code></pre></td></tr></table></figure><p>é‚£ä¹ˆç°åœ¨å°±è¿˜å·® version äº†ï¼Œè¦è·å– version ï¼Œæˆ‘ä»¬å°±å…ˆè¦æŠŠé¡¹ç›®ä¸Šä¼ è‡³ Githubï¼Œä¸Šä¼ æˆåŠŸåï¼Œæ¥ç€è¿›è¡Œä¸‹ä¸€æ­¥</p><h4 id="3ã€æ‰“å¼€é¡¹ç›®çš„-Github-ä¸»é¡µï¼Œåˆ›å»ºä¸€ä¸ª-Release-æˆ–-Tag"><a href="#3ã€æ‰“å¼€é¡¹ç›®çš„-Github-ä¸»é¡µï¼Œåˆ›å»ºä¸€ä¸ª-Release-æˆ–-Tag" class="headerlink" title="3ã€æ‰“å¼€é¡¹ç›®çš„ Github ä¸»é¡µï¼Œåˆ›å»ºä¸€ä¸ª Release æˆ– Tag"></a>3ã€æ‰“å¼€é¡¹ç›®çš„ Github ä¸»é¡µï¼Œåˆ›å»ºä¸€ä¸ª Release æˆ– Tag</h4><p>è¿™ä¸€æ­¥å»ºè®®å‚è€ƒæˆ‘ä¹‹å‰å†™çš„é‚£ç¯‡æ–‡ç«   <a href="https://juejin.cn/post/6916061679079915528#heading-9">ä¼ é€é—¨</a> </p><h4 id="4ã€å°†é¡¹ç›®ä»“åº“-Github-åœ°å€æäº¤åˆ°-JitPack"><a href="#4ã€å°†é¡¹ç›®ä»“åº“-Github-åœ°å€æäº¤åˆ°-JitPack" class="headerlink" title="4ã€å°†é¡¹ç›®ä»“åº“ Github åœ°å€æäº¤åˆ° JitPack"></a>4ã€å°†é¡¹ç›®ä»“åº“ Github åœ°å€æäº¤åˆ° <a href="https://link.juejin.cn/?target=https://jitpack.io/">JitPack</a></h4><blockquote><p>1ã€æ‰“å¼€ <a href="https://link.juejin.cn/?target=https://jitpack.io/">JitPack</a> ï¼Œå¹¶ç™»é™†ï¼ˆä½¿ç”¨ä½ è‡ªå·±çš„ Github è´¦å·ç™»é™†å³å¯ï¼‰</p><p>2ã€å°†ä½ é¡¹ç›®ä»“åº“ Github åœ°å€æ”¾å…¥æœç´¢æ ï¼Œç‚¹å‡»look upï¼Œè¿™ä¸ªæ—¶å€™å°±ä¼šè¿›è¡Œç¼–è¯‘ï¼Œå¦‚æœç¼–è¯‘æˆåŠŸï¼Œé‚£ä¹ˆå°±è¯æ˜ä½ æˆåŠŸçš„å°†æ’ä»¶ä¸Šä¼ åˆ° JitPack äº†</p></blockquote><p>ä¸‹é¢çš„ Version æ˜¯æˆ‘ä¹‹å‰ç”Ÿæˆçš„ä¸€äº›ç‰ˆæœ¬</p><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/48b574c3c1174a9098bafd64fc3a3af1~tplv-k3u1fbpfcp-zoom-1.image" alt="image-20210723115443338"></p><p>ç¼–è¯‘å®Œæˆå JitPack ä¼šè‡ªåŠ¨ç»™ä½ ç”Ÿæˆç›¸å…³çš„é…ç½®ä¿¡æ¯ï¼ŒæŒ‰ç…§å¦‚ä¸‹é…ç½®ï¼Œé…ç½®ä½ çš„é¡¹ç›®å³å¯</p><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/33197a69700d4b1fa42086d21956e364~tplv-k3u1fbpfcp-zoom-1.image" alt="image-20210723115812720"></p><p><strong>æ³¨æ„ï¼š</strong> ä¸Šè¿°æˆªå›¾æ˜¯æ•™æˆ‘ä»¬å¦‚ä½•å¼•ç”¨ç¬¬ä¸‰æ–¹åº“ï¼Œè€Œæˆ‘ä»¬ä¸Šä¼ çš„æ˜¯æ’ä»¶ï¼Œå› æ­¤æŒ‰ç…§æ’ä»¶çš„ä¾èµ–å¼•å…¥è§„åˆ™å³å¯ï¼Œå¦‚ä¸‹ï¼š</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs groovy"><span class="hljs-comment">//å½“å‰åœ¨æ ¹ build.gradle ä¸‹</span><br><br>buildscript &#123;<br>    repositories &#123;<br>      <span class="hljs-comment">//...</span><br><br>        <span class="hljs-comment">//è¿œç¨‹ JitPack ä»“åº“åœ°å€</span><br>        maven &#123;<br>            url <span class="hljs-string">&#x27;https://jitpack.io&#x27;</span><br>        &#125;<br>    &#125;<br>    dependencies &#123;<br>      <span class="hljs-comment">//...</span><br>      <br>        <span class="hljs-comment">//å¼•å…¥æ’ä»¶ä¾èµ–</span><br>        classpath <span class="hljs-string">&#x27;com.github.sweetying520:GradleDemo:1.0.1&#x27;</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥æˆ‘ä»¬å°±å¯ä»¥æ„‰å¿«çš„ä½¿ç”¨æ’ä»¶äº†</p><h4 id="5ã€å…³äºåç»­ç‰ˆæœ¬æ›´æ–°"><a href="#5ã€å…³äºåç»­ç‰ˆæœ¬æ›´æ–°" class="headerlink" title="5ã€å…³äºåç»­ç‰ˆæœ¬æ›´æ–°"></a>5ã€å…³äºåç»­ç‰ˆæœ¬æ›´æ–°</h4><p>1ã€å°†ä¿®æ”¹å¥½çš„ä¸œè¥¿ä¸Šä¼ åˆ° Github</p><p>2ã€æ‰“å¼€é¡¹ç›®çš„ Github ä¸»é¡µï¼Œåˆ›å»ºä¸€ä¸ª Release æˆ– Tagï¼ˆè¿™ä¸ªæ­¥éª¤å°±æ˜¯é‡å¤æ­¥éª¤3ï¼‰</p><p>3ã€å°†é¡¹ç›®çš„ä»“åº“æäº¤åˆ° <a href="https://link.juejin.cn/?target=https://jitpack.io/">JitPack</a>ï¼ˆè¿™ä¸ªæ­¥éª¤å°±æ˜¯é‡å¤æ­¥éª¤4ï¼‰</p><h2 id="äº”ã€æ’ä»¶è°ƒè¯•"><a href="#äº”ã€æ’ä»¶è°ƒè¯•" class="headerlink" title="äº”ã€æ’ä»¶è°ƒè¯•"></a>äº”ã€æ’ä»¶è°ƒè¯•</h2><p>æˆ‘ä»¬åœ¨å¼€å‘æ’ä»¶çš„è¿‡ç¨‹ä¸­å¯èƒ½ä¼šé‡åˆ°å„ç§é—®é¢˜ï¼Œé‚£ä¹ˆè¿™ä¸ªæ—¶å€™å¯¹æ’ä»¶è°ƒè¯•å°±æ˜¾å¾—å°¤ä¸ºé‡è¦äº†ã€‚<strong>æœ€ç®€å•çš„æ–¹å¼å°±æ˜¯æ‰“å° Log æ—¥å¿—</strong>ï¼Œä½†æ˜¯æ‰“å° Log æ—¥å¿—åŠŸèƒ½æ¯”è¾ƒæœ‰é™ï¼Œæ»¡è¶³ä¸äº†æˆ‘ä»¬çš„æ—¥å¸¸å¼€å‘ã€‚æ¥ä¸‹æ¥ä»‹ç»ä¸€ä¸‹å¼ºå¤§çš„ debug æ–¹å¼</p><p>ä»¥ä¸Šé¢ç¼–å†™çš„ buildSrc æ–¹å¼ä¸ºä¾‹ï¼Œæˆ‘ä»¬å¯¹å®ƒè¿›è¡Œä¸€ä¸ª debugï¼Œæ’ä»¶çš„è°ƒè¯•åˆ†ä¸ºå¦‚ä¸‹ä¸¤ç§ï¼š</p><p>1ã€ç®€å•ç‰ˆè°ƒè¯•ï¼šç›´æ¥åœ¨ AndroidStudio æä¾›çš„ Gradle å¯è§†åŒ–ç•Œé¢ï¼Œæ‰¾åˆ°éœ€è¦è°ƒè¯•çš„ Taskï¼Œæ‰“å¼€å¯é€‰é¡¹ï¼Œé€‰æ‹© debug å³å¯</p><p>2ã€å¤æ‚ç‰ˆè°ƒè¯•ï¼šé€šè¿‡ Gradle å‘½ä»¤ç»“åˆä¸€äº›ç›¸å…³çš„é…ç½®å¼€å¯è°ƒè¯•åŠŸèƒ½</p><h3 id="1ï¼‰ã€ç®€å•ç‰ˆè°ƒè¯•"><a href="#1ï¼‰ã€ç®€å•ç‰ˆè°ƒè¯•" class="headerlink" title="1ï¼‰ã€ç®€å•ç‰ˆè°ƒè¯•"></a>1ï¼‰ã€ç®€å•ç‰ˆè°ƒè¯•</h3><p>ç›´æ¥åœ¨ AndroidStudio æä¾›çš„ Gradle å¯è§†åŒ–ç•Œé¢ï¼Œæ‰¾åˆ°éœ€è¦è°ƒè¯•çš„ Taskï¼Œæ‰“å¼€å¯é€‰é¡¹ï¼Œé€‰æ‹© debug å³å¯</p><p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/beca96f53fb541ad946361f986bd4a6c~tplv-k3u1fbpfcp-watermark.image" alt="debug_gradle_simple_use.png"></p><p>æ¥ä¸‹æ¥çš„æ­¥éª¤å°±å’Œæˆ‘ä»¬è°ƒè¯• Java ä»£ç æ˜¯ä¸€æ ·çš„</p><p><strong>æ³¨æ„ï¼š</strong> æå‰æ‰“å¥½æ–­ç‚¹</p><p>è¿™ç§æ–¹å¼ä½¿ç”¨æå…¶ç®€å•ï¼Œæ¨èä½¿ç”¨</p><h3 id="2ï¼‰ã€å¤æ‚ç‰ˆè°ƒè¯•"><a href="#2ï¼‰ã€å¤æ‚ç‰ˆè°ƒè¯•" class="headerlink" title="2ï¼‰ã€å¤æ‚ç‰ˆè°ƒè¯•"></a>2ï¼‰ã€å¤æ‚ç‰ˆè°ƒè¯•</h3><p>é€šè¿‡ Gradle å‘½ä»¤ç»“åˆä¸€äº›ç›¸å…³çš„é…ç½®å¼€å¯è°ƒè¯•åŠŸèƒ½</p><h4 id="1ã€æ–°å¢ä¸€ä¸ª-Remote-ç±»å‹çš„-Configuration"><a href="#1ã€æ–°å¢ä¸€ä¸ª-Remote-ç±»å‹çš„-Configuration" class="headerlink" title="1ã€æ–°å¢ä¸€ä¸ª Remote ç±»å‹çš„ Configuration"></a>1ã€æ–°å¢ä¸€ä¸ª Remote ç±»å‹çš„ Configuration</h4><p>ç¬¬ä¸€æ­¥ï¼šç‚¹å‡»å›¾ä¸­çš„ Edit Configurationsâ€¦</p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/e5eb33347e0b4da49759f67c43601410~tplv-k3u1fbpfcp-zoom-1.image" alt="image-20210722150428439" style="zoom:50%;" /><p>ç¬¬äºŒæ­¥ï¼šç‚¹å‡»å›¾ä¸­ 1 çš„ + å·ï¼Œé€‰æ‹© 2 </p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/2272681c45044c77b9d67f62fd628372~tplv-k3u1fbpfcp-zoom-1.image" alt="image-20210722150750481" style="zoom:50%;" /><p>ç¬¬ä¸‰æ­¥ï¼š1 ä¸­çš„åå­—éšæ„å–ï¼Œç„¶åç‚¹å‡» 2 ï¼Œå³å¯å®Œæˆ  Remote ç±»å‹ Configuration çš„åˆ›å»º</p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/84ede40ea66c4915808bbc3b436742cc~tplv-k3u1fbpfcp-zoom-1.image" alt="image-20210722151029556" style="zoom:50%;" /><p>ç¬¬å››æ­¥ï¼šåˆ‡æ¢åˆ°åˆšæ‰åˆ›å»ºçš„ erdai Configuration</p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/6ff3fe29e49142bba44e9b949598b00a~tplv-k3u1fbpfcp-zoom-1.image" alt="image-20210722151407226" style="zoom:50%;" /><h4 id="2ã€æ‰§è¡Œ-Gradle-å‘½ä»¤ï¼š-gradlew-éœ€è¦æ‰§è¡Œçš„Task-Dorg-gradle-debug-true-no-daemon"><a href="#2ã€æ‰§è¡Œ-Gradle-å‘½ä»¤ï¼š-gradlew-éœ€è¦æ‰§è¡Œçš„Task-Dorg-gradle-debug-true-no-daemon" class="headerlink" title="2ã€æ‰§è¡Œ Gradle å‘½ä»¤ï¼š./gradlew éœ€è¦æ‰§è¡Œçš„Task -Dorg.gradle.debug=true --no-daemon"></a>2ã€æ‰§è¡Œ Gradle å‘½ä»¤ï¼š<code>./gradlew éœ€è¦æ‰§è¡Œçš„Task -Dorg.gradle.debug=true --no-daemon</code></h4><p>ä»¥æ‰§è¡Œ assembleDebug è¿™ä¸ª task ä¸ºä¾‹ï¼š</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs groovy">./gradlew assembleDebug -Dorg.gradle.debug=<span class="hljs-literal">true</span> --no-daemon<br></code></pre></td></tr></table></figure><p>æ­¤æ—¶æˆ‘ä»¬çš„å‘½ä»¤ä¼šè¿›å…¥ä¸€ä¸ªé”å®šçŠ¶æ€ï¼Œç­‰å¾…æˆ‘ä»¬è¿›è¡Œä¸‹ä¸€æ­¥æ“ä½œï¼Œå¦‚ä¸‹å›¾ï¼š</p><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/8cd10b40fc3943b49ca49e382be442aa~tplv-k3u1fbpfcp-zoom-1.image" alt="image-20210722152335257"></p><h4 id="3ã€æ‰“å¥½å›¾ä¸­-1-çš„æ–­ç‚¹ï¼Œç‚¹å‡»-2-çš„-debug-æŒ‰é’®ï¼Œå°±å¯ä»¥è¿›è¡Œæ„‰å¿«çš„è°ƒè¯•äº†"><a href="#3ã€æ‰“å¥½å›¾ä¸­-1-çš„æ–­ç‚¹ï¼Œç‚¹å‡»-2-çš„-debug-æŒ‰é’®ï¼Œå°±å¯ä»¥è¿›è¡Œæ„‰å¿«çš„è°ƒè¯•äº†" class="headerlink" title="3ã€æ‰“å¥½å›¾ä¸­ 1 çš„æ–­ç‚¹ï¼Œç‚¹å‡» 2 çš„ debug æŒ‰é’®ï¼Œå°±å¯ä»¥è¿›è¡Œæ„‰å¿«çš„è°ƒè¯•äº†"></a>3ã€æ‰“å¥½å›¾ä¸­ 1 çš„æ–­ç‚¹ï¼Œç‚¹å‡» 2 çš„ debug æŒ‰é’®ï¼Œå°±å¯ä»¥è¿›è¡Œæ„‰å¿«çš„è°ƒè¯•äº†</h4><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/379fcb2762e949beaab3dbe0f65e0204~tplv-k3u1fbpfcp-zoom-1.image" alt="image-20210722152553072"></p><p>æ¥ä¸‹æ¥çš„æ­¥éª¤å°±å’Œæˆ‘ä»¬è°ƒè¯• Java ä»£ç æ˜¯ä¸€æ ·çš„ã€‚è¿™ç§æ–¹å¼ç¨å¾®å¤æ‚ä¸€ç‚¹</p><h2 id="å…­ã€æ€»ç»“"><a href="#å…­ã€æ€»ç»“" class="headerlink" title="å…­ã€æ€»ç»“"></a>å…­ã€æ€»ç»“</h2><p>æœ¬ç¯‡æ–‡ç« è®²çš„ä¸€äº›é‡ç‚¹å†…å®¹ï¼š</p><p>1ã€è„šæœ¬æ’ä»¶çš„å®šä¹‰ä¸ä½¿ç”¨</p><p>2ã€å¯¹è±¡æ’ä»¶å®šä¹‰çš„ä¸‰ç§æ–¹å¼åŠå…·ä½“ä½¿ç”¨ï¼Œæ³¨æ„æ–‡ä¸­æåˆ°çš„ä¸€äº›ç»†èŠ‚ç‚¹</p><p>3ã€å‘å¸ƒ Gradle æ’ä»¶åˆ°è¿œç¨‹ä»“åº“ï¼šå…·ä½“ä»‹ç»äº†å¦‚ä½•å‘å¸ƒ Gradle æ’ä»¶åˆ° JitPack</p><p>4ã€å¦‚ä½•è°ƒè¯•æ’ä»¶ï¼Œç®€å•ç‰ˆè°ƒè¯•æ•ˆç‡é«˜</p><p>å¥½äº†ï¼Œæœ¬ç¯‡æ–‡ç« åˆ°è¿™é‡Œå°±ç»“æŸäº†ï¼Œå¸Œæœ›èƒ½ç»™ä½ å¸¦æ¥å¸®åŠ© ğŸ¤ </p><p><strong>æ„Ÿè°¢ä½ é˜…è¯»è¿™ç¯‡æ–‡ç« </strong></p><h3 id="ä¸‹ç¯‡é¢„å‘Š"><a href="#ä¸‹ç¯‡é¢„å‘Š" class="headerlink" title="ä¸‹ç¯‡é¢„å‘Š"></a>ä¸‹ç¯‡é¢„å‘Š</h3><p>ä¸‹ç¯‡æ–‡ç« æˆ‘ä¼šè®²è‡ªå®šä¹‰ç¬¬ä¸‰æ–¹æ’ä»¶å®æˆ˜åº”ç”¨ï¼Œæ•¬è¯·æœŸå¾…å§ğŸ˜„</p><h3 id="å‚è€ƒå’Œæ¨è"><a href="#å‚è€ƒå’Œæ¨è" class="headerlink" title="å‚è€ƒå’Œæ¨è"></a>å‚è€ƒå’Œæ¨è</h3><p><a href="https://juejin.cn/post/6844904135314128903">æ·±åº¦æ¢ç´¢ Gradle è‡ªåŠ¨åŒ–æ„å»ºæŠ€æœ¯ï¼ˆå››ã€è‡ªå®šä¹‰ Gradle æ’ä»¶)</a></p><p><a href="https://juejin.cn/post/6937940389496094751">Gradleå­¦ä¹ ç³»åˆ—ï¼ˆä¸‰ï¼‰ï¼šGradleæ’ä»¶</a></p><p><a href="https://juejin.cn/post/6956517422606057479#heading-1">è¡¥é½AndroidæŠ€èƒ½æ ‘ - ç©è½¬Gradleæ’ä»¶ </a></p><p><a href="https://juejin.cn/post/6985188709356273701">æˆ‘æƒ³è°ƒè¯•ä¸‹build.gradle | Gradle è°ƒè¯•</a></p><blockquote><p><strong>ä½ çš„ç‚¹èµï¼Œè¯„è®ºï¼Œæ˜¯å¯¹æˆ‘å·¨å¤§çš„é¼“åŠ±ï¼</strong></p><p>æ¬¢è¿å…³æ³¨æˆ‘çš„<strong>å…¬ä¼—å·ï¼š</strong>  <a href="http://m6z.cn/6jwi7b"><strong>sweetying</strong></a> ï¼Œæ–‡ç« æ›´æ–°å¯ç¬¬ä¸€æ—¶é—´æ”¶åˆ°</p><p>å¦‚æœ<strong>æœ‰é—®é¢˜</strong>ï¼Œå…¬ä¼—å·å†…æœ‰åŠ æˆ‘å¾®ä¿¡çš„å…¥å£ï¼Œåœ¨æŠ€æœ¯å­¦ä¹ ã€ä¸ªäººæˆé•¿çš„é“è·¯ä¸Šï¼Œæˆ‘ä»¬ä¸€èµ·å‰è¿›ï¼</p></blockquote>]]></content>
    
    
    <categories>
      
      <category>Android</category>
      
      <category>Gradle</category>
      
    </categories>
    
    
    <tags>
      
      <tag>åŸåˆ›</tag>
      
      <tag>Android</tag>
      
      <tag>Gradle</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Gradle ç³»åˆ— ï¼ˆäºŒï¼‰ã€Gradle æŠ€æœ¯æ¢ç´¢</title>
    <link href="/2022/10/11/Gradle%20%E7%B3%BB%E5%88%97%20%EF%BC%88%E4%BA%8C%EF%BC%89%E3%80%81Gradle%20%E6%8A%80%E6%9C%AF%E6%8E%A2%E7%B4%A2/"/>
    <url>/2022/10/11/Gradle%20%E7%B3%BB%E5%88%97%20%EF%BC%88%E4%BA%8C%EF%BC%89%E3%80%81Gradle%20%E6%8A%80%E6%9C%AF%E6%8E%A2%E7%B4%A2/</url>
    
    <content type="html"><![CDATA[<p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/53d3bd66723741b5a9f491bdde66be50~tplv-k3u1fbpfcp-watermark.image"></p><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>å¾ˆé«˜å…´é‡è§ä½ ~</p><p>è¿™åˆæ˜¯ä¸€ä¸ªæ–°çš„ç³»åˆ—ï¼Œå…³äº Gradle å­¦ä¹ ï¼Œæˆ‘æ‰€ç†è§£çš„æµç¨‹å¦‚ä¸‹å›¾ï¼š</p><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/f65d4a418c9f4c209d6eb3d26a452fba~tplv-k3u1fbpfcp-zoom-1.image" alt="Gradle_learning"></p><p>åœ¨æœ¬ç³»åˆ—çš„ä¸Šä¸€ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å¯¹ Gradle çš„ä¸€äº›åŸºç¡€æ¦‚å¿µåŠ Groovy è¯­æ³•è¿›è¡Œäº†è®²è§£ï¼Œå®Œæˆäº†ç¬¬ä¸€ä¸ªç¯èŠ‚ã€‚è¿˜æ²¡æœ‰çœ‹è¿‡ä¸Šä¸€ç¯‡æ–‡ç« çš„æœ‹å‹ï¼Œå»ºè®®å…ˆå»é˜…è¯» <a href="https://juejin.cn/post/6939662617224937503">Gradle ç³»åˆ— ï¼ˆä¸€ï¼‰ã€Gradleç›¸å…³æ¦‚å¿µç†è§£ï¼ŒGroovyåŸºç¡€</a>ã€‚</p><p>ä»Šå¤©æˆ‘ä»¬ä¸»è¦ä»‹ç»ç¯èŠ‚äºŒï¼šç†Ÿæ‚‰ Gradle å¸¸ç”¨ APIï¼Œäº†è§£ Settingsï¼ŒProjectï¼ŒTask ç­‰ç­‰ã€‚</p><p><a href="https://github.com/sweetying520/GradleDemo">Github Demo åœ°å€</a> , å¤§å®¶å¯ä»¥ç»“åˆ demo ä¸€èµ·çœ‹ï¼Œæ•ˆæœæ æ æ»´ğŸº</p><p>ä¸‹é¢å°±æ­£å¼è¿›å…¥ Gradle çš„å­¦ä¹ </p><h2 id="ä¸€ã€Gradle-æ„å»ºæµç¨‹"><a href="#ä¸€ã€Gradle-æ„å»ºæµç¨‹" class="headerlink" title="ä¸€ã€Gradle æ„å»ºæµç¨‹"></a>ä¸€ã€Gradle æ„å»ºæµç¨‹</h2><h3 id="1ï¼‰ã€Gradle-æ„å»ºé˜¶æ®µ"><a href="#1ï¼‰ã€Gradle-æ„å»ºé˜¶æ®µ" class="headerlink" title="1ï¼‰ã€Gradle æ„å»ºé˜¶æ®µ"></a>1ï¼‰ã€Gradle æ„å»ºé˜¶æ®µ</h3><p>Gradle æ„å»ºæµç¨‹ä¸»è¦åˆ†ä¸ºä¸‰ä¸ªé˜¶æ®µï¼š</p><p>1ã€åˆå§‹åŒ–é˜¶æ®µ</p><p>2ã€é…ç½®é˜¶æ®µ</p><p>3ã€æ‰§è¡Œé˜¶æ®µ</p><h4 id="1ã€åˆå§‹åŒ–é˜¶æ®µ"><a href="#1ã€åˆå§‹åŒ–é˜¶æ®µ" class="headerlink" title="1ã€åˆå§‹åŒ–é˜¶æ®µ"></a>1ã€åˆå§‹åŒ–é˜¶æ®µ</h4><p>Gradle åˆå§‹åŒ–é˜¶æ®µä¸»è¦å°±æ˜¯æ‰§è¡Œ settings.gradle è„šæœ¬ï¼Œæ„å»º Project å¯¹è±¡</p><p>æˆ‘ä»¬ä½¿ç”¨ AndroidStudio æ–°å»ºä¸€ä¸ª Android é¡¹ç›®çš„æ—¶å€™ä¼šè‡ªåŠ¨ç”Ÿæˆ settings.gradle æ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs groovy">rootProject.name = <span class="hljs-string">&quot;GradleDemo&quot;</span><br>include <span class="hljs-string">&#x27;:app&#x27;</span><br></code></pre></td></tr></table></figure><p>1ã€æŒ‡å®šé¡¹ç›®æ ¹ Project çš„åç§°</p><p>2ã€ä½¿ç”¨ include å¯¼å…¥ app å·¥ç¨‹</p><p>å®é™…ä¸Š settings.gradle å¯¹åº”ä¸€ä¸ª Settings å¯¹è±¡ï¼Œinclude å°±æ˜¯ Settings å¯¹è±¡ä¸‹çš„ä¸€ä¸ªæ–¹æ³•ï¼Œå®ƒçš„ä½œç”¨å°±æ˜¯å¼•ç”¨å“ªäº›å·¥ç¨‹éœ€è¦åŠ å…¥æ„å»ºã€‚ç„¶å Gradle ä¼šä¸ºæ¯ä¸ªå¸¦æœ‰ build.gradle è„šæœ¬æ–‡ä»¶çš„å·¥ç¨‹æ„å»ºä¸€ä¸ªä¸ä¹‹å¯¹åº”çš„ Project å¯¹è±¡</p><h5 id="1ã€include-æ‰©å±•"><a href="#1ã€include-æ‰©å±•" class="headerlink" title="1ã€include æ‰©å±•"></a>1ã€include æ‰©å±•</h5><p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ include + project æ–¹æ³•å¼•ç”¨ä»»ä½•ä½ç½®ä¸‹çš„å·¥ç¨‹ï¼Œå¦‚ä¸‹ï¼š</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs groovy">include <span class="hljs-string">&#x27;:test&#x27;</span><br>project(<span class="hljs-string">&#x27;:test&#x27;</span>).projectDir = file(<span class="hljs-string">&#x27;å½“å‰å·¥ç¨‹çš„ç»å¯¹è·¯å¾„&#x27;</span>)<br></code></pre></td></tr></table></figure><p>é€šå¸¸æˆ‘ä¼šä½¿ç”¨è¿™ç§æ–¹å¼å¼•ç”¨è‡ªå·±å†™çš„åº“è¿›è¡Œè°ƒè¯•ï¼Œéå¸¸çš„æ–¹ä¾¿</p><p>ä½†æœ‰çš„æ—¶å€™ä¼šé‡åˆ°åŒæ—¶å¼•å…¥äº† AAR å’Œæºç çš„æƒ…å†µï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ include + projectï¼Œç»“åˆä¸€äº›å…¶ä»–çš„é…ç½®ï¼Œæ¥å®ç° AAR å’Œæºç çš„å¿«é€Ÿåˆ‡æ¢ï¼Œå…·ä½“æ­¥éª¤å¦‚ä¸‹ï¼š</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs groovy"><span class="hljs-comment">//æ­¥éª¤ä¸€ï¼šåœ¨ settings.gradle ä¸­å¼•å…¥æºç å·¥ç¨‹</span><br>include <span class="hljs-string">&#x27;:test&#x27;</span><br>project(<span class="hljs-string">&#x27;:test&#x27;</span>).projectDir = file(<span class="hljs-string">&#x27;å½“å‰å·¥ç¨‹çš„ç»å¯¹è·¯å¾„&#x27;</span>)<br><br><span class="hljs-comment">//æ­¥éª¤äºŒï¼šåœ¨æ ¹ build.gradle ä¸‹è¿›è¡Œå¦‚ä¸‹é…ç½®</span><br>allprojects &#123;<br>    configurations.all &#123;<br>        resolutionStrategy &#123;<br>            dependencySubstitution &#123;<br>                substitute module(<span class="hljs-string">&quot;com.dream:test&quot;</span>) with project(<span class="hljs-string">&#x27;:test&#x27;</span>)<br>            &#125;<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h5 id="2ã€Settings"><a href="#2ã€Settings" class="headerlink" title="2ã€Settings"></a>2ã€Settings</h5><p>å…³äº Settings çš„æ‰€æœ‰å±æ€§å’Œæ–¹æ³•ï¼Œå¦‚ä¸‹å›¾ï¼š</p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/353d7348729c4e50bd3ebb0ed107c623~tplv-k3u1fbpfcp-zoom-1.image" alt="image-20210707215114352" style="zoom:50%;" /><p>ç»“åˆå®˜ç½‘æä¾›çš„æ–‡æ¡£ <a href="https://docs.gradle.org/current/javadoc/org/gradle/api/initialization/Settings.html">ä¼ é€é—¨</a> å»æŸ¥çœ‹ï¼Œæ•ˆæœæ æ çš„ğŸ˜„</p><h4 id="2ã€é…ç½®é˜¶æ®µ"><a href="#2ã€é…ç½®é˜¶æ®µ" class="headerlink" title="2ã€é…ç½®é˜¶æ®µ"></a>2ã€é…ç½®é˜¶æ®µ</h4><p>Gradle é…ç½®é˜¶æ®µä¸»è¦å°±æ˜¯è§£æ Project å¯¹è±¡(build.gradle è„šæœ¬æ–‡ä»¶)ï¼Œæ„å»º Task æœ‰å‘æ— ç¯å›¾</p><p>é…ç½®é˜¶æ®µä¼šæ‰§è¡Œçš„ä»£ç ï¼š<strong>é™¤ Task çš„ Action ä¸­ç¼–å†™çš„ä»£ç éƒ½ä¼šè¢«æ‰§è¡Œ</strong>ï¼Œä¸æ‡‚ Action çš„ç»§ç»­å¾€ä¸‹çœ‹ï¼Œåé¢ä¼šè®²åˆ°ã€‚å¦‚ï¼š</p><p>1ã€build.gradle ä¸­çš„å„ç§è¯­å¥</p><p>2ã€Task é…ç½®æ®µè¯­å¥</p><p>é…ç½®é˜¶æ®µå®Œæˆåï¼Œæ•´ä¸ªå·¥ç¨‹çš„ Task ä¾èµ–å…³ç³»éƒ½ç¡®å®šäº†ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ Gradle  å¯¹è±¡çš„ getTaskGraph æ–¹æ³•è®¿é—® Task ,å¯¹åº”çš„ç±»ä¸º TaskExecutionGraph ï¼Œå…³äº TaskExecutionGraph API æ–‡æ¡£ <a href="https://docs.gradle.org/current/javadoc/org/gradle/api/execution/TaskExecutionGraph.html">ä¼ é€é—¨</a></p><p><strong>æ³¨æ„ï¼š</strong> æ‰§è¡Œä»»ä½• Gradle å‘½ä»¤ï¼Œåœ¨åˆå§‹åŒ–é˜¶æ®µå’Œé…ç½®é˜¶æ®µçš„ä»£ç éƒ½ä¼šè¢«æ‰§è¡Œ</p><h4 id="3ã€æ‰§è¡Œé˜¶æ®µ"><a href="#3ã€æ‰§è¡Œé˜¶æ®µ" class="headerlink" title="3ã€æ‰§è¡Œé˜¶æ®µ"></a>3ã€æ‰§è¡Œé˜¶æ®µ</h4><p>Gradle æ‰§è¡Œé˜¶æ®µä¸»è¦å°±æ˜¯æ‰§è¡Œ Task åŠå…¶ä¾èµ–çš„ Task</p><h3 id="2ï¼‰ã€Gradle-ç”Ÿå‘½å‘¨æœŸ-Hook-ç‚¹"><a href="#2ï¼‰ã€Gradle-ç”Ÿå‘½å‘¨æœŸ-Hook-ç‚¹" class="headerlink" title="2ï¼‰ã€Gradle ç”Ÿå‘½å‘¨æœŸ Hook ç‚¹"></a>2ï¼‰ã€Gradle ç”Ÿå‘½å‘¨æœŸ Hook ç‚¹</h3><p>å¼•ç”¨ joe_H ä¸€å¼ å®Œæ•´çš„ Gradle ç”Ÿå‘½å‘¨æœŸå›¾ï¼Œå¦‚ä¸‹ï¼š</p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/403a1114a8ad4d8bb725224a70dedc5a~tplv-k3u1fbpfcp-zoom-1.image" alt="image-20210704212912830" style="zoom:50%;" /><p>ä¸Šå›¾å¯¹ Gradle ç”Ÿå‘½å‘¨æœŸæ€»ç»“çš„å¾ˆåˆ°ä½ï¼Œæˆ‘ä»¬è§£æä¸€æ³¢ï¼š</p><p><strong>æ³¨æ„</strong>ï¼šGradle æ‰§è¡Œè„šæœ¬æ–‡ä»¶çš„æ—¶å€™ä¼šç”Ÿæˆå¯¹åº”çš„å®ä¾‹ï¼Œä¸»è¦æœ‰å¦‚ä¸‹ä¸‰ç§å¯¹è±¡ï¼š</p><blockquote><p>1ã€Gradle å¯¹è±¡ï¼šåœ¨é¡¹ç›®åˆå§‹åŒ–æ—¶æ„å»ºï¼Œå…¨å±€å•ä¾‹å­˜åœ¨ï¼Œåªæœ‰è¿™ä¸€ä¸ªå¯¹è±¡</p><p>2ã€Project å¯¹è±¡ï¼šæ¯ä¸€ä¸ª build.gradle éƒ½ä¼šè½¬æ¢æˆä¸€ä¸ª Project å¯¹è±¡</p><p>3ã€Settings å¯¹è±¡ï¼šSeetings.gradle ä¼šè½¬å˜æˆä¸€ä¸ª Seetings å¯¹è±¡</p></blockquote><p>1ã€Gradle åœ¨å„ä¸ªé˜¶æ®µéƒ½æä¾›äº†ç”Ÿå‘½å‘¨æœŸå›è°ƒï¼Œåœ¨æ·»åŠ ç›‘å¬å™¨çš„æ—¶å€™éœ€è¦æ³¨æ„ï¼š<strong>ç›‘å¬å™¨è¦åœ¨ç”Ÿå‘½å‘¨æœŸå›è°ƒä¹‹å‰æ·»åŠ ï¼Œå¦åˆ™ä¼šå¯¼è‡´æœ‰äº›å›è°ƒæ”¶ä¸åˆ°</strong></p><p>2ã€Gradle åˆå§‹åŒ–é˜¶æ®µ</p><ul><li>åœ¨ settings.gradle æ‰§è¡Œå®Œåï¼Œä¼šå›è°ƒ Gradle å¯¹è±¡çš„ settingsEvaluated æ–¹æ³•</li><li>åœ¨æ„å»ºæ‰€æœ‰å·¥ç¨‹ build.gradle å¯¹åº”çš„ Project å¯¹è±¡åï¼Œä¹Ÿå°±æ˜¯åˆå§‹åŒ–é˜¶æ®µå®Œæ¯•ï¼Œä¼šå›è°ƒ Gradle å¯¹è±¡çš„ projectsLoaded æ–¹æ³•</li></ul><p>3ã€Gradle é…ç½®é˜¶æ®µï¼š</p><ul><li>Gradle ä¼šå¾ªç¯æ‰§è¡Œæ¯ä¸ªå·¥ç¨‹çš„ build.gradle è„šæœ¬æ–‡ä»¶</li><li>åœ¨æ‰§è¡Œå½“å‰å·¥ç¨‹ build.gradle å‰ï¼Œä¼šå›è°ƒ Gradle å¯¹è±¡çš„ beforeProject æ–¹æ³•å’Œå½“å‰ Project å¯¹è±¡çš„ beforeEvaluate æ–¹æ³•</li><li>åœ¨æ‰§è¡Œå½“å‰å·¥ç¨‹ build.gradle åï¼Œä¼šå›è°ƒ Gradle å¯¹è±¡çš„ afterProject æ–¹æ³•å’Œå½“å‰ Project å¯¹è±¡çš„ afterEvaluate æ–¹æ³•</li><li>åœ¨æ‰€æœ‰å·¥ç¨‹çš„ build.gradle æ‰§è¡Œå®Œæ¯•åï¼Œä¼šå›è°ƒ Gradle å¯¹è±¡çš„ projectsEvaluated æ–¹æ³•</li><li>åœ¨æ„å»º Task ä¾èµ–æœ‰å‘æ— ç¯å›¾åï¼Œä¹Ÿå°±æ˜¯é…ç½®é˜¶æ®µå®Œæ¯•ï¼Œä¼šå›è°ƒ TaskExecutionGraph å¯¹è±¡çš„ whenReady æ–¹æ³•</li></ul><p><strong>æ³¨æ„</strong>ï¼š Gradle å¯¹è±¡çš„ beforeProjectï¼ŒafterProject æ–¹æ³•å’Œ Project å¯¹è±¡çš„ beforeEvaluate ï¼ŒafterEvaluate æ–¹æ³•å›è°ƒæ—¶æœºæ˜¯ä¸€è‡´çš„ï¼ŒåŒºåˆ«åœ¨äºï¼š</p><blockquote><p>1ã€Gradle å¯¹è±¡çš„ beforeProjectï¼ŒafterProject æ–¹æ³•é’ˆå¯¹é¡¹ç›®ä¸‹çš„æ‰€æœ‰å·¥ç¨‹ï¼Œå³æ¯ä¸ªå·¥ç¨‹çš„ build.gradle æ‰§è¡Œå‰åéƒ½ä¼šæ”¶åˆ°è¿™ä¸¤ä¸ªæ–¹æ³•çš„å›è°ƒ</p><p>2ã€ Project å¯¹è±¡çš„ beforeEvaluate ï¼ŒafterEvaluate æ–¹æ³•é’ˆå¯¹å½“å‰å·¥ç¨‹ï¼Œå³å½“å‰å·¥ç¨‹çš„ build.gradle æ‰§è¡Œå‰åä¼šæ”¶åˆ°è¿™ä¸¤ä¸ªæ–¹æ³•çš„å›è°ƒ</p></blockquote><p>4ã€æ‰§è¡Œé˜¶æ®µï¼š</p><ul><li>Gradle ä¼šå¾ªç¯æ‰§è¡Œ Task åŠå…¶ä¾èµ–çš„ Task</li><li>åœ¨å½“å‰ Task æ‰§è¡Œä¹‹å‰ï¼Œä¼šå›è°ƒ TaskExecutionGraph å¯¹è±¡çš„ beforeTask æ–¹æ³•</li><li>åœ¨å½“å‰ Task æ‰§è¡Œä¹‹åï¼Œä¼šå›è°ƒ TaskExecutionGraph å¯¹è±¡çš„ afterTask æ–¹æ³•</li></ul><p>5ã€å½“æ‰€æœ‰çš„ Task æ‰§è¡Œå®Œæ¯•åï¼Œä¼šå›è°ƒ Gradle å¯¹è±¡çš„ buildFinish æ–¹æ³•</p><p>äº†è§£äº† Gradle ç”Ÿå‘½å‘¨æœŸåï¼Œæˆ‘ä»¬å°±å¯ä»¥æ ¹æ®è‡ªå·±çš„éœ€æ±‚æ·»åŠ  Hookã€‚ä¾‹å¦‚ï¼šæˆ‘ä»¬å¯ä»¥æ‰“å° Gradle æ„å»ºè¿‡ç¨‹ä¸­ï¼Œå„ä¸ªé˜¶æ®µåŠå„ä¸ª Task çš„è€—æ—¶</p><h3 id="3ï¼‰ã€æ‰“å°-Gradle-æ„å»ºå„ä¸ªé˜¶æ®µåŠå„ä¸ªä»»åŠ¡çš„è€—æ—¶"><a href="#3ï¼‰ã€æ‰“å°-Gradle-æ„å»ºå„ä¸ªé˜¶æ®µåŠå„ä¸ªä»»åŠ¡çš„è€—æ—¶" class="headerlink" title="3ï¼‰ã€æ‰“å° Gradle æ„å»ºå„ä¸ªé˜¶æ®µåŠå„ä¸ªä»»åŠ¡çš„è€—æ—¶"></a>3ï¼‰ã€æ‰“å° Gradle æ„å»ºå„ä¸ªé˜¶æ®µåŠå„ä¸ªä»»åŠ¡çš„è€—æ—¶</h3><p>åœ¨ settings.gradle æ·»åŠ å¦‚ä¸‹ä»£ç ï¼š</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><code class="hljs groovy"><span class="hljs-comment">//åˆå§‹åŒ–é˜¶æ®µå¼€å§‹æ—¶é—´</span><br><span class="hljs-type">long</span> beginOfSetting = System.currentTimeMillis()<br><span class="hljs-comment">//é…ç½®é˜¶æ®µå¼€å§‹æ—¶é—´</span><br><span class="hljs-keyword">def</span> beginOfConfig<br><span class="hljs-comment">//é…ç½®é˜¶æ®µæ˜¯å¦å¼€å§‹äº†ï¼Œåªæ‰§è¡Œä¸€æ¬¡</span><br><span class="hljs-keyword">def</span> configHasBegin = <span class="hljs-literal">false</span><br><span class="hljs-comment">//å­˜æ”¾æ¯ä¸ª build.gradle æ‰§è¡Œä¹‹å‰çš„æ—¶é—´</span><br><span class="hljs-keyword">def</span> beginOfProjectConfig = <span class="hljs-keyword">new</span> HashMap()<br><span class="hljs-comment">//æ‰§è¡Œé˜¶æ®µå¼€å§‹æ—¶é—´</span><br><span class="hljs-keyword">def</span> beginOfTaskExecute<br><span class="hljs-comment">//åˆå§‹åŒ–é˜¶æ®µæ‰§è¡Œå®Œæ¯•</span><br>gradle.projectsLoaded &#123;<br>    println <span class="hljs-string">&quot;åˆå§‹åŒ–æ€»è€—æ—¶ $&#123;System.currentTimeMillis() - beginOfSetting&#125; ms&quot;</span><br>&#125;<br><br><span class="hljs-comment">//build.gradle æ‰§è¡Œå‰</span><br>gradle.beforeProject &#123;Project project -&gt;<br>    <span class="hljs-keyword">if</span>(!configHasBegin)&#123;<br>        configHasBegin = <span class="hljs-literal">true</span><br>        beginOfConfig = System.currentTimeMillis()<br>    &#125;<br>    beginOfProjectConfig.put(project,System.currentTimeMillis())<br>&#125;<br><br><span class="hljs-comment">//build.gradle æ‰§è¡Œå</span><br>gradle.afterProject &#123;Project project -&gt;<br>    <span class="hljs-keyword">def</span> begin = beginOfProjectConfig.get(project)<br>    println <span class="hljs-string">&quot;é…ç½®é˜¶æ®µï¼Œ$project è€—æ—¶ï¼š$&#123;System.currentTimeMillis() - begin&#125; ms&quot;</span><br>&#125;<br><br><span class="hljs-comment">//é…ç½®é˜¶æ®µå®Œæ¯•</span><br>gradle.taskGraph.whenReady &#123;<br>    println <span class="hljs-string">&quot;é…ç½®é˜¶æ®µæ€»è€—æ—¶ï¼š$&#123;System.currentTimeMillis() - beginOfConfig&#125; ms&quot;</span><br>    beginOfTaskExecute = System.currentTimeMillis()<br>&#125;<br><br><span class="hljs-comment">//æ‰§è¡Œé˜¶æ®µ</span><br>gradle.taskGraph.beforeTask &#123;Task task -&gt;<br>    task.doFirst &#123;<br>        task.ext.beginOfTask = System.currentTimeMillis()<br>    &#125;<br><br>    task.doLast &#123;<br>        println <span class="hljs-string">&quot;æ‰§è¡Œé˜¶æ®µï¼Œ$task è€—æ—¶ï¼š$&#123;System.currentTimeMillis() - task.ext.beginOfTask&#125; ms&quot;</span><br>    &#125;<br>&#125;<br><br><span class="hljs-comment">//æ‰§è¡Œé˜¶æ®µå®Œæ¯•</span><br>gradle.buildFinished &#123;<br>    println <span class="hljs-string">&quot;æ‰§è¡Œé˜¶æ®µæ€»è€—æ—¶ï¼š$&#123;System.currentTimeMillis() - beginOfTaskExecute&#125;&quot;</span><br>&#125;<br><br><span class="hljs-comment">//æ‰§è¡Œ Gradle å‘½ä»¤</span><br>./gradlew clean<br><br><span class="hljs-comment">//æ‰“å°ç»“æœå¦‚ä¸‹ï¼š</span><br>åˆå§‹åŒ–æ€»è€—æ—¶ <span class="hljs-number">140</span> ms<br><br>&gt; Configure <span class="hljs-attr">project :</span><br>é…ç½®é˜¶æ®µï¼Œroot project <span class="hljs-string">&#x27;GradleDemo&#x27;</span> è€—æ—¶ï¼š<span class="hljs-number">1181</span> ms<br><br>&gt; Configure <span class="hljs-attr">project :</span>app<br>é…ç½®é˜¶æ®µï¼Œproject <span class="hljs-string">&#x27;:app&#x27;</span> è€—æ—¶ï¼š<span class="hljs-number">1122</span> ms<br>é…ç½®é˜¶æ®µæ€»è€—æ—¶ï¼š<span class="hljs-number">2735</span> ms<br><br>&gt; <span class="hljs-attr">Task :</span>clean<br>æ‰§è¡Œé˜¶æ®µï¼Œtask <span class="hljs-string">&#x27;:clean&#x27;</span> è€—æ—¶ï¼š<span class="hljs-number">0</span> ms<br><br>&gt; <span class="hljs-attr">Task :</span><span class="hljs-attr">app:</span>clean<br>æ‰§è¡Œé˜¶æ®µï¼Œtask <span class="hljs-string">&#x27;:app:clean&#x27;</span> è€—æ—¶ï¼š<span class="hljs-number">1</span> ms<br>æ‰§è¡Œé˜¶æ®µæ€»è€—æ—¶ï¼š<span class="hljs-number">325</span><br></code></pre></td></tr></table></figure><p>äº†è§£äº† Gradle çš„ä¸‰ä¸ªé˜¶æ®µåŠç”Ÿå‘½å‘¨æœŸï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å°±å­¦ä¹  Gradle çš„ä¸€äº›æ ¸å¿ƒ API</p><h2 id="äºŒã€Project-ä»‹ç»"><a href="#äºŒã€Project-ä»‹ç»" class="headerlink" title="äºŒã€Project ä»‹ç»"></a>äºŒã€Project ä»‹ç»</h2><p>å¯¹äºä¸€ä¸ª Android é¡¹ç›®ï¼Œbuild.gradle è„šæœ¬æ–‡ä»¶æ˜¯æˆ‘ä»¬ç»å¸¸æ“ä½œçš„æ–‡ä»¶ä¹‹ä¸€ï¼Œè€Œæ¯ä¸ª build.gradle å°±å¯¹åº”äº†ä¸€ä¸ª Project å¯¹è±¡ï¼Œå› æ­¤å­¦ä¹ å¥½   Project å¯¹åº”çš„ API èƒ½å¸®åŠ©æˆ‘ä»¬æ›´å¥½çš„å»æ“ä½œ build.gradle è„šæœ¬æ–‡ä»¶, åŒæ—¶ä¹Ÿèƒ½çœ‹æ‡‚å¤§ä½¬ä»¬æ‰€å†™çš„ä¸€äº›é…ç½®è¯­å¥ã€‚</p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/e9bc9ab568af4fb2af66bcb398926898~tplv-k3u1fbpfcp-zoom-1.image" alt="image-20210718164127432" style="zoom:50%;" /><p>é¦–å…ˆçœ‹ä¸€çœ¼æˆ‘çš„é¡¹ç›®ç»“æ„ï¼Œåç»­å°±æ˜¯åŸºäºå®ƒæ¥åšæ¼”ç¤º</p><p><strong>æ³¨æ„</strong>ï¼š</p><p>1ã€ä¸‹é¢æ‰€æ¼”ç¤ºçš„ API éƒ½æ˜¯ä¸€äº›å¸¸ç”¨çš„ APIï¼Œå¯¹ API ä½¿ç”¨æœ‰ç–‘é—®çš„å¯ä»¥å»æŸ¥è¯¢å®˜æ–¹æ–‡æ¡£</p><p>2ã€API çš„æ¼”ç¤ºå¦‚æœæ²¡åšç‰¹æ®Šè¯´æ˜ï¼Œåˆ™æ˜¯åœ¨ app çš„ build.gradle æ–‡ä»¶ä¸‹æ“ä½œçš„</p><h3 id="1ï¼‰ã€Project-API"><a href="#1ï¼‰ã€Project-API" class="headerlink" title="1ï¼‰ã€Project API"></a>1ï¼‰ã€Project API</h3><p><a href="https://docs.gradle.org/current/javadoc/org/gradle/api/Project.html">Project API æ–‡æ¡£</a>ï¼Œæˆ‘ä»¬ä¸»è¦ä»‹ç»ä¸€äº›å¸¸ç”¨çš„ API</p><h4 id="1ã€getRootProject-æ–¹æ³•"><a href="#1ã€getRootProject-æ–¹æ³•" class="headerlink" title="1ã€getRootProject æ–¹æ³•"></a>1ã€getRootProject æ–¹æ³•</h4><p>è·å–æ ¹ Project å¯¹è±¡</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs groovy">println getRootProject()<br><br><span class="hljs-comment">//æ‰“å°ç»“æœ</span><br>&gt; Configure <span class="hljs-attr">project :</span>app<br>root project <span class="hljs-string">&#x27;GradleDemo&#x27;</span><br></code></pre></td></tr></table></figure><h4 id="2ã€getRootDir-æ–¹æ³•"><a href="#2ã€getRootDir-æ–¹æ³•" class="headerlink" title="2ã€getRootDir æ–¹æ³•"></a>2ã€getRootDir æ–¹æ³•</h4><p>è·å–æ ¹ç›®å½•æ–‡ä»¶å¤¹è·¯å¾„</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs groovy">println getRootDir()<br><br><span class="hljs-comment">//æ‰“å°ç»“æœ</span><br>&gt; Configure <span class="hljs-attr">project :</span>app<br><span class="hljs-regexp">/Users/</span>zhouying<span class="hljs-regexp">/learning/</span>GradleDemo<br></code></pre></td></tr></table></figure><h4 id="3ã€getBuildDir-æ–¹æ³•"><a href="#3ã€getBuildDir-æ–¹æ³•" class="headerlink" title="3ã€getBuildDir æ–¹æ³•"></a>3ã€getBuildDir æ–¹æ³•</h4><p>è·å–å½“å‰ Project çš„ build æ–‡ä»¶å¤¹è·¯å¾„</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs groovy">println getBuildDir()<br><br><span class="hljs-comment">//æ‰“å°ç»“æœ</span><br>&gt; Configure <span class="hljs-attr">project :</span>app<br><span class="hljs-regexp">/Users/</span>zhouying<span class="hljs-regexp">/learning/</span>GradleDemo<span class="hljs-regexp">/app/</span>build<br></code></pre></td></tr></table></figure><h4 id="4ã€getParent-æ–¹æ³•"><a href="#4ã€getParent-æ–¹æ³•" class="headerlink" title="4ã€getParent æ–¹æ³•"></a>4ã€getParent æ–¹æ³•</h4><p>è·å–å½“å‰çˆ¶ Project å¯¹è±¡</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs groovy">println getParent()<br><br><span class="hljs-comment">//æ‰“å°ç»“æœ</span><br>&gt; Configure <span class="hljs-attr">project :</span>app<br>root project <span class="hljs-string">&#x27;GradleDemo&#x27;</span><br></code></pre></td></tr></table></figure><h4 id="5ã€getAllprojects-æ–¹æ³•"><a href="#5ã€getAllprojects-æ–¹æ³•" class="headerlink" title="5ã€getAllprojects æ–¹æ³•"></a>5ã€getAllprojects æ–¹æ³•</h4><p>è·å–å½“å‰ Project åŠå…¶å­ Project å¯¹è±¡ï¼Œè¿”å›å€¼æ˜¯ä¸€ä¸ª Set é›†åˆ</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs groovy"><span class="hljs-comment">//å½“å‰åœ¨æ ¹å·¥ç¨‹çš„ build.gradle æ–‡ä»¶ä¸‹</span><br>println getAllprojects()<br><br><span class="hljs-comment">//æ‰“å°ç»“æœ</span><br>&gt; Configure <span class="hljs-attr">project :</span><br>[root project <span class="hljs-string">&#x27;GradleDemo&#x27;</span>, project <span class="hljs-string">&#x27;:app&#x27;</span>]<br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬è¿˜å¯ä»¥ä½¿ç”¨å…¶é—­åŒ…çš„å½¢å¼</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs groovy">allprojects &#123;<br>    println it<br>&#125;<br><br><span class="hljs-comment">//æ‰“å°ç»“æœ</span><br>&gt; Configure <span class="hljs-attr">project :</span><br>root project <span class="hljs-string">&#x27;GradleDemo&#x27;</span><br>project <span class="hljs-string">&#x27;:app&#x27;</span><br><br><span class="hljs-comment">//æˆ‘ä»¬é€šå¸¸ä¼šä½¿ç”¨é—­åŒ…çš„è¯­æ³•åœ¨æ ¹ build.gradle ä¸‹è¿›è¡Œç›¸å…³çš„é…ç½®ï¼Œå¦‚ä¸‹ï¼š</span><br>allprojects &#123;<br>    repositories &#123;<br>        google()<br>        mavenCentral()<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><strong>æ³¨æ„</strong>ï¼šæ ¹ Project ä¸å…¶å­ Project ç»„æˆäº†ä¸€ä¸ªæ ‘å½¢ç»“æ„ï¼Œä½†è¿™é¢—æ ‘çš„é«˜åº¦ä¹Ÿä»…ä»…è¢«é™å®šä¸ºäº†ä¸¤å±‚</p><h4 id="6ã€getSubprojects-æ–¹æ³•"><a href="#6ã€getSubprojects-æ–¹æ³•" class="headerlink" title="6ã€getSubprojects æ–¹æ³•"></a>6ã€getSubprojects æ–¹æ³•</h4><p>è·å–å½“å‰ Project ä¸‹çš„æ‰€æœ‰å­ Project å¯¹è±¡ï¼Œè¿”å›å€¼æ˜¯ä¸€ä¸ª Set é›†åˆ</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs groovy"><span class="hljs-comment">//å½“å‰åœ¨æ ¹å·¥ç¨‹çš„ build.gradle æ–‡ä»¶ä¸‹</span><br>println getSubprojects()<br><br><span class="hljs-comment">//æ‰“å°ç»“æœ</span><br>&gt; Configure <span class="hljs-attr">project :</span><br>[project <span class="hljs-string">&#x27;:app&#x27;</span>]<br></code></pre></td></tr></table></figure><p>åŒæ ·æˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨å…¶é—­åŒ…çš„å½¢å¼</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs groovy">subprojects &#123;<br>    println it<br>&#125;<br><br><span class="hljs-comment">//æ‰“å°ç»“æœ</span><br>&gt; Configure <span class="hljs-attr">project :</span><br>project <span class="hljs-string">&#x27;:app&#x27;</span><br></code></pre></td></tr></table></figure><h4 id="7ã€apply-ç³»åˆ—æ–¹æ³•"><a href="#7ã€apply-ç³»åˆ—æ–¹æ³•" class="headerlink" title="7ã€apply ç³»åˆ—æ–¹æ³•"></a>7ã€apply ç³»åˆ—æ–¹æ³•</h4><p>å¼•ç”¨æ’ä»¶</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs groovy"><span class="hljs-comment">//å¼•ç”¨ç¬¬ä¸‰æ–¹æ’ä»¶</span><br>apply <span class="hljs-attr">plugin:</span> <span class="hljs-string">&#x27;com.android.application&#x27;</span><br><br><span class="hljs-comment">//å¼•ç”¨è„šæœ¬æ–‡ä»¶æ’ä»¶</span><br>apply <span class="hljs-attr">from:</span> <span class="hljs-string">&#x27;config.gradle&#x27;</span><br></code></pre></td></tr></table></figure><h4 id="8ã€configurations-é—­åŒ…"><a href="#8ã€configurations-é—­åŒ…" class="headerlink" title="8ã€configurations é—­åŒ…"></a>8ã€configurations é—­åŒ…</h4><p>ç¼–å†™ Project ä¸€äº›ç›¸å…³çš„é…ç½®ï¼Œå¦‚å…¨å±€ç§»é™¤æŸä¸ªä¾èµ–</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs groovy">configurations &#123;<br>    all*.exclude <span class="hljs-attr">group:</span> <span class="hljs-string">&#x27;ç»„å&#x27;</span>, <span class="hljs-attr">module:</span> <span class="hljs-string">&#x27;æ¨¡å—å&#x27;</span><br>&#125;<br></code></pre></td></tr></table></figure><h4 id="9ã€project-ç³»åˆ—æ–¹æ³•"><a href="#9ã€project-ç³»åˆ—æ–¹æ³•" class="headerlink" title="9ã€project ç³»åˆ—æ–¹æ³•"></a>9ã€project ç³»åˆ—æ–¹æ³•</h4><p>æŒ‡å®šå·¥ç¨‹å®ä¾‹ï¼Œç„¶ååœ¨é—­åŒ…ä¸­å¯¹å…¶è¿›è¡Œç›¸å…³çš„é…ç½®</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs groovy">project(<span class="hljs-string">&quot;app&quot;</span>) &#123;<br>    apply <span class="hljs-attr">plugin:</span> <span class="hljs-string">&#x27;com.android.application&#x27;</span><br>&#125;<br></code></pre></td></tr></table></figure><h3 id="2ï¼‰ã€æ‰©å±•å±æ€§"><a href="#2ï¼‰ã€æ‰©å±•å±æ€§" class="headerlink" title="2ï¼‰ã€æ‰©å±•å±æ€§"></a>2ï¼‰ã€æ‰©å±•å±æ€§</h3><p>æ‰©å±•å±æ€§ä½œç”¨ï¼šæ–¹ä¾¿æˆ‘ä»¬å…¨å±€çš„ä¸€ä¸ªä½¿ç”¨ã€‚ç±»ä¼¼ Java ä¸­ï¼Œåœ¨å·¥å…·ç±»é‡Œé¢å®šä¹‰é™æ€æ–¹æ³•</p><h4 id="1ã€æ‰©å±•å±æ€§å®šä¹‰"><a href="#1ã€æ‰©å±•å±æ€§å®šä¹‰" class="headerlink" title="1ã€æ‰©å±•å±æ€§å®šä¹‰"></a>1ã€æ‰©å±•å±æ€§å®šä¹‰</h4><p>æˆ‘ä»¬å¯ä»¥é€šè¿‡ä»¥ä¸‹ä¸¤ç§æ–¹å¼æ¥å®šä¹‰æ‰©å±•å±æ€§ï¼š</p><p>1ã€é€šè¿‡ <strong>ext</strong> å…³é”®å­—å®šä¹‰æ‰©å±•å±æ€§</p><p>2ã€åœ¨ <strong>gradle.properties</strong> ä¸‹å®šä¹‰æ‰©å±•å±æ€§</p><h5 id="1ã€é€šè¿‡-ext-å…³é”®å­—å®šä¹‰æ‰©å±•å±æ€§"><a href="#1ã€é€šè¿‡-ext-å…³é”®å­—å®šä¹‰æ‰©å±•å±æ€§" class="headerlink" title="1ã€é€šè¿‡ ext å…³é”®å­—å®šä¹‰æ‰©å±•å±æ€§"></a>1ã€é€šè¿‡ ext å…³é”®å­—å®šä¹‰æ‰©å±•å±æ€§</h5><p>é€šè¿‡ ext å®šä¹‰æ‰©å±•å±æ€§çš„è¯­æ³•æœ‰ä¸¤ç§ï¼š</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs groovy"><span class="hljs-comment">//å½“å‰åœ¨æ ¹ build.gradle ä¸‹</span><br><span class="hljs-comment">//æ–¹å¼1ï¼šext.å±æ€§å</span><br>ext.test = <span class="hljs-string">&#x27;erdai666&#x27;</span><br><br><span class="hljs-comment">//æ–¹å¼2ï¼šext åé¢æ¥ä¸Šä¸€ä¸ªé—­åŒ…</span><br>ext&#123;<br>  test1 = <span class="hljs-string">&#x27;erdai777&#x27;</span><br>&#125;<br></code></pre></td></tr></table></figure><h5 id="2ã€åœ¨-gradle-properties-ä¸‹å®šä¹‰æ‰©å±•å±æ€§"><a href="#2ã€åœ¨-gradle-properties-ä¸‹å®šä¹‰æ‰©å±•å±æ€§" class="headerlink" title="2ã€åœ¨ gradle.properties ä¸‹å®šä¹‰æ‰©å±•å±æ€§"></a>2ã€åœ¨ gradle.properties ä¸‹å®šä¹‰æ‰©å±•å±æ€§</h5><p>é€šè¿‡ gradle.properties å®šä¹‰æ‰©å±•å±æ€§ï¼Œç›´æ¥ä½¿ç”¨ <strong>key&#x3D;value</strong> çš„å½¢å¼å³å¯ï¼š</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs groovy">test2=erdai888<br></code></pre></td></tr></table></figure><h4 id="2ã€æ‰©å±•å±æ€§è°ƒç”¨"><a href="#2ã€æ‰©å±•å±æ€§è°ƒç”¨" class="headerlink" title="2ã€æ‰©å±•å±æ€§è°ƒç”¨"></a>2ã€æ‰©å±•å±æ€§è°ƒç”¨</h4><p>1ã€ext å®šä¹‰çš„æ‰©å±•å±æ€§è°ƒç”¨çš„æ—¶å€™å¯ä»¥å»æ‰ ext å‰ç¼€ç›´æ¥è°ƒç”¨</p><p>2ã€ext å®šä¹‰çš„æ‰©å±•å±æ€§ä¹Ÿå¯ä»¥é€šè¿‡ <strong>å½“å‰å®šä¹‰æ‰©å±•å±æ€§çš„ Project å¯¹è±¡.ext.å±æ€§å</strong> è¿›è¡Œè°ƒç”¨</p><p>3ã€gradle.properties å®šä¹‰çš„æ‰©å±•å±æ€§ç›´æ¥é€šè¿‡å±æ€§åè°ƒç”¨å³å¯</p><p>ä¸‹é¢æˆ‘ä»¬åœ¨ app çš„ build.gradle ä¸‹è¿›è¡Œæ¼”ç¤ºï¼š</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs groovy"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * ä¸‹é¢è¿™ç§å†™æ³•ä¹‹æ‰€ä»¥èƒ½è¿™ä¹ˆå†™</span><br><span class="hljs-comment"> * 1ã€ext å®šä¹‰çš„æ‰©å±•å±æ€§è°ƒç”¨çš„æ—¶å€™å¯ä»¥å»æ‰ ext å‰ç¼€ç›´æ¥è°ƒç”¨</span><br><span class="hljs-comment"> * 2ã€å­ Project èƒ½æ‹¿åˆ°æ ¹ Project ä¸­çš„å±æ€§å’Œæ–¹æ³•</span><br><span class="hljs-comment"> */</span><br>println test<br>println test1<br>println test2<br><br><span class="hljs-comment">//2ã€ext å®šä¹‰çš„æ‰©å±•å±æ€§ä¹Ÿå¯ä»¥é€šè¿‡ å½“å‰å®šä¹‰æ‰©å±•å±æ€§çš„ Project å¯¹è±¡.ext.å±æ€§å è°ƒç”¨</span><br>println rootProject.ext.test<br>println rootProject.ext.test1<br>println test2<br><br><span class="hljs-comment">//ä¸Šè¿°ä¸¤ç§æ–¹å¼æ‰“å°ç»“æœå‡ä¸º</span><br>&gt; Configure <span class="hljs-attr">project :</span>app<br>erdai666<br>erdai777<br>erdai888<br></code></pre></td></tr></table></figure><p><strong>æ³¨æ„ï¼š</strong> å­ Project å’Œæ ¹ Project å­˜åœ¨ç»§æ‰¿å…³ç³»ï¼Œå› æ­¤æ ¹ Project ä¸­å®šä¹‰çš„å±æ€§å’Œæ–¹æ³•å­ Project èƒ½è·å–åˆ°</p><h4 id="3ã€æ‰©å±•å±æ€§åº”ç”¨"><a href="#3ã€æ‰©å±•å±æ€§åº”ç”¨" class="headerlink" title="3ã€æ‰©å±•å±æ€§åº”ç”¨"></a>3ã€æ‰©å±•å±æ€§åº”ç”¨</h4><p>é€šå¸¸æˆ‘ä»¬ä¼šä½¿ç”¨æ‰©å±•å±æ€§æ¥ä¼˜åŒ– build.gradle è„šæœ¬æ–‡ä»¶ï¼Œä¾‹å¦‚æˆ‘ä»¬ä»¥ä¼˜åŒ– app ä¸‹çš„ build.gradle ä¸ºä¾‹ï¼š</p><p>é¦–å…ˆçœ‹ä¸€çœ¼ä¼˜åŒ–ä¹‹å‰ app çš„ build.gradle é•¿å•¥æ ·ï¼š</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs groovy">apply <span class="hljs-attr">plugin:</span> <span class="hljs-string">&#x27;com.android.application&#x27;</span><br><br>android &#123;<br>    compileSdkVersion <span class="hljs-number">30</span><br><br>    defaultConfig &#123;<br>        applicationId <span class="hljs-string">&quot;com.dream.gradledemo&quot;</span><br>        minSdkVersion <span class="hljs-number">19</span><br>        targetSdkVersion <span class="hljs-number">30</span><br>        versionCode <span class="hljs-number">1</span><br>        versionName <span class="hljs-string">&quot;1.0&quot;</span><br><br>        testInstrumentationRunner <span class="hljs-string">&quot;androidx.test.runner.AndroidJUnitRunner&quot;</span><br>    &#125;<br><br>    buildTypes &#123;<br>        release &#123;<br>            minifyEnabled <span class="hljs-literal">false</span><br>            proguardFiles getDefaultProguardFile(<span class="hljs-string">&#x27;proguard-android-optimize.txt&#x27;</span>), <span class="hljs-string">&#x27;proguard-rules.pro&#x27;</span><br>        &#125;<br>    &#125;<br>&#125;<br><br>dependencies &#123;<br>    implementation <span class="hljs-string">&#x27;androidx.appcompat:appcompat:1.3.0&#x27;</span><br>    implementation <span class="hljs-string">&#x27;com.google.android.material:material:1.4.0&#x27;</span><br>    implementation <span class="hljs-string">&#x27;androidx.constraintlayout:constraintlayout:2.0.4&#x27;</span><br>    testImplementation <span class="hljs-string">&#x27;junit:junit:4.13.2&#x27;</span><br>    androidTestImplementation <span class="hljs-string">&#x27;androidx.test.ext:junit:1.1.3&#x27;</span><br>    androidTestImplementation <span class="hljs-string">&#x27;androidx.test.espresso:espresso-core:3.4.0&#x27;</span><br>&#125;<br></code></pre></td></tr></table></figure><p>ä¸‹é¢æˆ‘ä»¬å°±æ¥è¿›è¡Œæ”¹é€ </p><p><strong>æ­¥éª¤1ï¼š</strong> åœ¨æ ¹ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªè„šæœ¬æ–‡ä»¶ config.gradle ï¼Œç”¨æ¥å­˜æ”¾æ‰©å±•å±æ€§</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs groovy">ext&#123;<br><br>    androidConfig = [<br>            <span class="hljs-attr">compileSdkVersion :</span> <span class="hljs-number">30</span>,<br>            <span class="hljs-attr">applicationId :</span> <span class="hljs-string">&#x27;com.dream.gradledemo&#x27;</span>,<br>            <span class="hljs-attr">minSdkVersion :</span> <span class="hljs-number">19</span>,<br>            <span class="hljs-attr">targetSdkVersion :</span> <span class="hljs-number">30</span>,<br>            <span class="hljs-attr">versionCode :</span> <span class="hljs-number">1</span>,<br>            <span class="hljs-attr">versionName :</span> <span class="hljs-string">&#x27;1.0&#x27;</span><br>    ]<br><br><br>    implementationLib = [<br>            <span class="hljs-attr">appcompat :</span> <span class="hljs-string">&#x27;androidx.appcompat:appcompat:1.3.0&#x27;</span>,<br>            <span class="hljs-attr">material  :</span> <span class="hljs-string">&#x27;com.google.android.material:material:1.4.0&#x27;</span>,<br>            <span class="hljs-attr">constraintlayout :</span> <span class="hljs-string">&#x27;androidx.constraintlayout:constraintlayout:2.0.4&#x27;</span><br>    ]<br><br>    testImplementationLib = [<br>            <span class="hljs-attr">junit :</span> <span class="hljs-string">&#x27;junit:junit:4.13.2&#x27;</span><br>    ]<br><br><br>    androidTestImplementationLib = [<br>            <span class="hljs-attr">junit :</span> <span class="hljs-string">&#x27;androidx.test.ext:junit:1.1.3&#x27;</span>,<br>            <span class="hljs-string">&#x27;espresso-core&#x27;</span> : <span class="hljs-string">&#x27;androidx.test.espresso:espresso-core:3.4.0&#x27;</span><br>    ]<br>&#125;<br></code></pre></td></tr></table></figure><p><strong>æ­¥éª¤2ï¼š</strong> åœ¨æ ¹ build.gradle å¯¹ config.gradle è¿›è¡Œå¼•ç”¨</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs groovy">apply <span class="hljs-attr">from:</span> <span class="hljs-string">&#x27;config.gradle&#x27;</span><br></code></pre></td></tr></table></figure><p><strong>æ³¨æ„ï¼š</strong> åœ¨æ ¹ build.gradle è¿›è¡Œå¼•ç”¨çš„å¥½å¤„å°±æ˜¯æ‰€æœ‰çš„å­ build.gradle éƒ½èƒ½å¤Ÿè·å–åˆ°è¿™äº›æ‰©å±•å±æ€§</p><p><strong>æ­¥éª¤3:</strong>  åœ¨ app çš„ build.gradle é‡Œé¢è¿›è¡Œæ‰©å±•å±æ€§çš„è°ƒç”¨</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs groovy">apply <span class="hljs-attr">plugin:</span> <span class="hljs-string">&#x27;com.android.application&#x27;</span><br><br>android &#123;<br>    compileSdkVersion androidConfig.compileSdkVersion<br><br>    defaultConfig &#123;<br>        applicationId androidConfig.applicationId<br>        minSdkVersion androidConfig.minSdkVersion<br>        targetSdkVersion androidConfig.targetSdkVersion<br>        versionCode androidConfig.versionCode<br>        versionName androidConfig.versionName<br><br>        testInstrumentationRunner <span class="hljs-string">&quot;androidx.test.runner.AndroidJUnitRunner&quot;</span><br>    &#125;<br><br>    buildTypes &#123;<br>        release &#123;<br>            minifyEnabled <span class="hljs-literal">false</span><br>            proguardFiles getDefaultProguardFile(<span class="hljs-string">&#x27;proguard-android-optimize.txt&#x27;</span>), <span class="hljs-string">&#x27;proguard-rules.pro&#x27;</span><br>        &#125;<br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">def</span> implementationLibMap = implementationLib<br><span class="hljs-keyword">def</span> testImplementationLibMap = testImplementationLib<br><span class="hljs-keyword">def</span> androidTestImplementationLibMap = androidTestImplementationLib<br><br>dependencies &#123;<br>    implementationLibMap.each&#123;k,v -&gt;<br>        implementation v<br>    &#125;<br><br>    testImplementationLibMap.each&#123;k,v -&gt;<br>        testImplementation v<br>    &#125;<br><br>    androidTestImplementationLibMap.each&#123;k,v -&gt;<br>        androidTestImplementation v<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="3ï¼‰ã€æ–‡ä»¶æ“ä½œ-API"><a href="#3ï¼‰ã€æ–‡ä»¶æ“ä½œ-API" class="headerlink" title="3ï¼‰ã€æ–‡ä»¶æ“ä½œ API"></a>3ï¼‰ã€æ–‡ä»¶æ“ä½œ API</h3><h4 id="1ã€file-x2F-files-ç³»åˆ—æ–‡ä»¶å®šä½"><a href="#1ã€file-x2F-files-ç³»åˆ—æ–‡ä»¶å®šä½" class="headerlink" title="1ã€file&#x2F;files ç³»åˆ—æ–‡ä»¶å®šä½"></a>1ã€file&#x2F;files ç³»åˆ—æ–‡ä»¶å®šä½</h4><p>Project å¯¹è±¡æä¾›çš„ file&#x2F;files ç³»åˆ—æ–¹æ³•ä¸»è¦ç”¨æ¥å®šä½ä¸€ä¸ªæˆ–è€…å¤šä¸ªæ–‡ä»¶ï¼Œå€¼çš„æ³¨æ„çš„æ˜¯ï¼š<strong>å®ƒä»¬æ¥æ”¶çš„å‚æ•°æ˜¯ä¸€ä¸ªç›¸å¯¹è·¯å¾„ï¼Œä»å½“å‰ project å·¥ç¨‹å¼€å§‹æŸ¥æ‰¾</strong>ï¼Œè€Œæˆ‘ä»¬é€šè¿‡ new File çš„æ–¹å¼éœ€è¦ä¼ å…¥ä¸€ä¸ªç»å¯¹è·¯å¾„ï¼Œä¸‹é¢é€šè¿‡ä»£ç æ¼”ç¤ºæ„Ÿå—ä¸€ä¸‹ä»–ä»¬çš„åŒºåˆ«ï¼š</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs groovy"><span class="hljs-comment">//============================== 1ã€file æ–¹æ³•åº”ç”¨============================</span><br><span class="hljs-comment">//é€šè¿‡ file æ–¹æ³•ä¼ å…¥ä¸€ä¸ªç›¸å¯¹è·¯å¾„ï¼Œè¿”å›å€¼æ˜¯ä¸€ä¸ª file å¯¹è±¡</span><br>println file(<span class="hljs-string">&#x27;../config.gradle&#x27;</span>).text<br><br><span class="hljs-comment">//é€šè¿‡ new File æ–¹å¼ä¼ å…¥ä¸€ä¸ªç»å¯¹è·¯å¾„</span><br><span class="hljs-keyword">def</span> file = <span class="hljs-keyword">new</span> File(<span class="hljs-string">&#x27;/Users/zhouying/learning/GradleDemo/config.gradle&#x27;</span>)<br>println file.text<br><br><span class="hljs-comment">//ä¸Šè¿°ä¸¤è€…æ‰“å°ç»“æœç›¸åŒï¼Œå¦‚ä¸‹æˆªå›¾</span><br><br><span class="hljs-comment">//============================== 2ã€files æ–¹æ³•åº”ç”¨============================</span><br><span class="hljs-comment">//é€šè¿‡ files æ–¹æ³•ä¼ å…¥å¤šä¸ªç›¸å¯¹è·¯å¾„ï¼Œè¿”å›å€¼æ˜¯ä¸€ä¸ª ConfigurableFileCollection å³æ–‡ä»¶é›†åˆ</span><br>files(<span class="hljs-string">&#x27;../config.gradle&#x27;</span>,<span class="hljs-string">&#x27;../build.gradle&#x27;</span>).each &#123;<br>    println it.name<br>&#125;<br><br><span class="hljs-comment">//æ‰“å°ç»“æœ</span><br>&gt; Configure <span class="hljs-attr">project :</span>app<br>config.gradle<br>build.gradle<br></code></pre></td></tr></table></figure><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/152c811c766440cd857b72a8b8c1542c~tplv-k3u1fbpfcp-zoom-1.image" alt="image-20210717121715148"  /><h4 id="2ã€copy-æ–‡ä»¶æ‹·è´"><a href="#2ã€copy-æ–‡ä»¶æ‹·è´" class="headerlink" title="2ã€copy æ–‡ä»¶æ‹·è´"></a>2ã€copy æ–‡ä»¶æ‹·è´</h4><blockquote><p>1ã€Project å¯¹è±¡æä¾›äº† copy æ–¹æ³•ï¼Œå®ƒä½¿å¾—æˆ‘ä»¬æ‹·è´ä¸€ä¸ªæ–‡ä»¶æˆ–æ–‡ä»¶å¤¹å˜å¾—ååˆ†ç®€å•</p><p>2ã€copy æ–¹æ³•èƒ½å¤Ÿæ¥æ”¶ä¸€ä¸ªé—­åŒ…ï¼Œé—­åŒ…çš„å‚æ•° CopySpec ï¼ŒCopySpec æä¾›äº†å¾ˆå¤šæ–‡ä»¶æ“ä½œçš„ APIï¼Œå…·ä½“å¯ä»¥æŸ¥çœ‹æ–‡æ¡£ <a href="https://docs.gradle.org/current/javadoc/org/gradle/api/file/CopySpec.html">ä¼ é€é—¨</a></p></blockquote><p>ä¸‹é¢ä¼šä½¿ç”¨åˆ° CopySpec çš„ from å’Œ into æ–¹æ³•</p><p><strong>æ³¨æ„ï¼š</strong> from å’Œ into æ¥æ”¶çš„å‚æ•°æ˜¯ Object ç±»å‹çš„ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥ä¼ å…¥ä¸€ä¸ªè·¯å¾„æˆ–æ–‡ä»¶</p><p>1ã€æ–‡ä»¶æ‹·è´</p><p>ä¾‹å¦‚æˆ‘ä»¬å®ç°ï¼š<strong>å°†æ ¹ç›®å½•ä¸‹çš„ config.gradle æ–‡ä»¶æ‹·è´æ‹·è´åˆ° app ç›®å½•ä¸‹ã€‚</strong> å¦‚ä¸‹ï¼š</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs groovy"><span class="hljs-comment">//1ã€ä¼ å…¥è·¯å¾„</span><br>copy &#123;<br>    from getRootDir().path + <span class="hljs-string">&quot;/config.gradle&quot;</span><br>    into getProjectDir().path<br>&#125;<br><br><span class="hljs-comment">//2ã€ä¼ å…¥æ–‡ä»¶</span><br>copy &#123;<br>    from file(<span class="hljs-string">&#x27;../config.gradle&#x27;</span>)<br>    into getProjectDir()<br>&#125;<br><br><span class="hljs-comment">//æœ€ç»ˆç»“æœæ˜¯è¿™ä¸¤ç§æ–¹å¼éƒ½èƒ½æ‹·è´æˆåŠŸ</span><br></code></pre></td></tr></table></figure><p>2ã€æ–‡ä»¶å¤¹æ‹·è´</p><p>ä¾‹å¦‚æˆ‘ä»¬å®ç°ï¼š<strong>å°†æ ¹ç›®å½•ä¸‹çš„ gradle æ–‡ä»¶å¤¹ä¸‹çš„æ‰€æœ‰æ–‡ä»¶å’Œæ–‡ä»¶å¤¹æ‹·è´åˆ° app ç›®å½•ä¸‹çš„ gradle æ–‡ä»¶å¤¹</strong></p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs groovy">copy &#123;<br>    from file(<span class="hljs-string">&#x27;../gradle/&#x27;</span>)<br>    into getProjectDir().path + <span class="hljs-string">&quot;/gradle/&quot;</span><br>&#125;<br><br><span class="hljs-comment">//æœ€ç»ˆç»“æœæ‹·è´æˆåŠŸ</span><br></code></pre></td></tr></table></figure><p>æ­¤æ—¶å¦‚æœ app ç›®å½•ä¸‹æ²¡æœ‰ gradle æ–‡ä»¶å¤¹ï¼Œé‚£ä¹ˆ copy æ–¹æ³•ä¼šç»™æˆ‘ä»¬è‡ªåŠ¨åˆ›å»ºï¼Œéå¸¸çš„æ–¹ä¾¿</p><h4 id="3ã€fileTree-æ–‡ä»¶æ ‘æ˜ å°„"><a href="#3ã€fileTree-æ–‡ä»¶æ ‘æ˜ å°„" class="headerlink" title="3ã€fileTree æ–‡ä»¶æ ‘æ˜ å°„"></a>3ã€fileTree æ–‡ä»¶æ ‘æ˜ å°„</h4><p>Project å¯¹è±¡æä¾›äº† fileTree æ–¹æ³•ï¼Œæ–¹ä¾¿æˆ‘ä»¬å°†ä¸€ä¸ªç›®å½•è½¬æ¢ä¸ºæ–‡ä»¶æ ‘ï¼Œç„¶åå¯¹æ–‡ä»¶æ ‘è¿›è¡Œç›¸å…³çš„é€»è¾‘å¤„ç†ï¼Œå®ƒæ¥æ”¶çš„å‚æ•°å’Œ file&#x2F;files ç±»ä¼¼ï¼Œä¹Ÿæ˜¯ä¸€ä¸ªç›¸å¯¹è·¯å¾„</p><p>ä¾‹å¦‚æˆ‘ä»¬å®ç°ï¼š<strong>éå†æ ¹ç›®å½•ä¸‹çš„ gradle æ–‡ä»¶å¤¹ï¼Œå¹¶æ‰“å°æ–‡ä»¶åŠæ–‡ä»¶å¤¹çš„åç§°</strong></p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs groovy">fileTree(<span class="hljs-string">&#x27;../gradle/&#x27;</span>)&#123; FileTree fileTree -&gt;<br>    fileTree.visit &#123; FileTreeElement fileTreeElement -&gt;<br>        println fileTreeElement.name<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">//æ‰“å°ç»“æœ</span><br>&gt; Configure <span class="hljs-attr">project :</span>app<br>wrapper<br>gradle-wrapper.jar<br>gradle-wrapper.properties<br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬é€šå¸¸ä¼šåœ¨ app çš„ build.gradle ä¸‹çœ‹åˆ°è¿™ä¹ˆä¸€ä¸ªé…ç½®è¯­å¥ï¼š</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs groovy">implementation fileTree(<span class="hljs-attr">include:</span> [<span class="hljs-string">&#x27;*.jar&#x27;</span>], <span class="hljs-attr">dir:</span> <span class="hljs-string">&#x27;libs&#x27;</span>)<br></code></pre></td></tr></table></figure><p>ä»–å®é™…ä¸Šæ˜¯è°ƒç”¨äº† fileTree æ¥æ”¶ Map å‚æ•°çš„é‡è½½æ–¹æ³•ï¼š</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs groovy">ConfigurableFileTree fileTree(Map&lt;String, ?&gt; var1);<br></code></pre></td></tr></table></figure><p>è¿™å¥é…ç½®è¯­å¥çš„æ„æ€å°±æ˜¯ï¼š<strong>å¼•å…¥å½“å‰ project ç›®å½•ä¸‹çš„ libs æ–‡ä»¶å¤¹ä¸‹çš„æ‰€æœ‰ jar åŒ…</strong></p><h3 id="4ï¼‰ã€buildscript-è§£è¯»"><a href="#4ï¼‰ã€buildscript-è§£è¯»" class="headerlink" title="4ï¼‰ã€buildscript è§£è¯»"></a>4ï¼‰ã€buildscript è§£è¯»</h3><p>æˆ‘ä»¬é€šå¸¸åœ¨æ–°å»ºä¸€ä¸ª Android é¡¹ç›®çš„æ—¶å€™å¯ä»¥çœ‹åˆ°æ ¹ build.gradle æœ‰è¿™ä¹ˆä¸€æ®µé…ç½®ï¼š</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs groovy">buildscript &#123;<br>    <span class="hljs-comment">//æ’ä»¶ä»“åº“åœ°å€</span><br>    repositories &#123;<br>        google()<br>        mavenCentral()<br>    &#125;<br>  <br>    <span class="hljs-comment">//æ’ä»¶ä¾èµ–</span><br>    dependencies &#123;<br>        classpath <span class="hljs-string">&quot;com.android.tools.build:gradle:4.2.1&quot;</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>å®ƒçš„ä½œç”¨æ˜¯ï¼š<strong>å¼•å…¥ Gradle æ„å»ºè¿‡ç¨‹ä¸­çš„ä¸€äº›æ’ä»¶</strong></p><p>å®é™…ä¸Šä¸Šé¢è¿™æ®µä»£ç çš„å®Œæ•´å†™æ³•å¦‚ä¸‹ï¼š</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs groovy">buildscript &#123; ScriptHandler scriptHandler -&gt;<br>    scriptHandler.repositories &#123; RepositoryHandler repositoryHandler -&gt;<br>        repositoryHandler.google()<br>        repositoryHandler.mavenCentral()<br>    &#125;<br>  <br>    scriptHandler.dependencies &#123; DependencyHandler dependencyHandler -&gt;<br>        dependencyHandler.classpath <span class="hljs-string">&quot;com.android.tools.build:gradle:4.2.1&quot;</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ä½ æ˜¯å¦ä¼šæœ‰è¿™ä¹ˆä¸€ä¸ªç–‘é—®ï¼šä¸ºå•¥è¿™äº›å‚æ•°éƒ½èƒ½å¤Ÿå»æ‰ï¼Œç®€åŒ–æˆä¸Šé¢é‚£æ ·ï¼ŸğŸ¤”ï¸</p><p>è¦æ˜ç™½ä¸Šé¢è¿™ä¸ªé—®é¢˜ï¼Œé¦–å…ˆæˆ‘ä»¬å¾—å¯¹é—­åŒ…æœ‰ä¸€å®šçš„äº†è§£ï¼š</p><p>1ã€é¦–å…ˆé—­åŒ…ä¸­æœ‰ owenr this delegate ä¸‰ä¸ªå¯¹è±¡ï¼Œè¿™ä¸‰ä¸ªå¯¹è±¡æ‹¥æœ‰çš„å±æ€§å’Œæ–¹æ³•æˆ‘ä»¬éƒ½å¯ä»¥è°ƒç”¨ï¼Œå¹¶ä¸”æ— éœ€å†™å‡ºæ¥</p><p>2ã€è¿™ä¸‰ä¸ªå¯¹è±¡è°ƒç”¨çš„å…ˆåé¡ºåºå–å†³äºé—­åŒ…çš„å§”æ‰˜ç­–ç•¥ï¼Œä¸€èˆ¬æˆ‘ä»¬ä¼šå¯¹ delegate è¿›è¡Œæ“ä½œå¹¶ä¿®æ”¹å®ƒçš„å§”æ‰˜ç­–ç•¥</p><p>å®é™…ä¸Šï¼ŒGradle å¯¹ä¸Šé¢çš„è¿™äº›é—­åŒ…çš„ delegate ä¿®æ”¹ä¸ºäº†ä¼ å…¥é—­åŒ…çš„å‚æ•°ï¼Œå¹¶æŠŠå§”æ‰˜ç­–ç•¥è®¾ç½®ä¸ºäº† DELEGATE_FIRST ï¼Œå› æ­¤æˆ‘ä»¬è°ƒç”¨çš„æ—¶å€™æ‰èƒ½æŠŠè¿™äº›å‚æ•°ç»™å»æ‰ï¼Œæ„Ÿå…´è¶£çš„å¯ä»¥ç‚¹å‡» buildscript è¿›å»çœ‹ä¸‹æºç ï¼Œè¿™é‡Œå°±ä¸å¯¹æºç è¿›è¡Œåˆ†æäº†</p><h3 id="5ï¼‰ã€exec-å¤–éƒ¨å‘½ä»¤æ‰§è¡Œ"><a href="#5ï¼‰ã€exec-å¤–éƒ¨å‘½ä»¤æ‰§è¡Œ" class="headerlink" title="5ï¼‰ã€exec å¤–éƒ¨å‘½ä»¤æ‰§è¡Œ"></a>5ï¼‰ã€exec å¤–éƒ¨å‘½ä»¤æ‰§è¡Œ</h3><p>Project å¯¹è±¡æä¾›äº† exec æ–¹æ³•ï¼Œæ–¹ä¾¿æˆ‘ä»¬æ‰§è¡Œå¤–éƒ¨çš„å‘½ä»¤</p><p>æˆ‘ä»¬å¯ä»¥åœ¨ linux ä¸‹é€šè¿‡å¦‚ä¸‹å‘½ä»¤å»ç§»åŠ¨ä¸€ä¸ªæ–‡ä»¶å¤¹ï¼š</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs groovy">mv -f æºæ–‡ä»¶è·¯å¾„ ç›®æ ‡æ–‡ä»¶è·¯å¾„<br></code></pre></td></tr></table></figure><p>ç°åœ¨æˆ‘ä»¬åœ¨ Gradle ä¸‹å»è¿›è¡Œè¿™ä¸€æ“ä½œ</p><p>ä¾‹å¦‚æˆ‘ä»¬å®ç°ï¼š<strong>ä½¿ç”¨å¤–éƒ¨å‘½ä»¤ï¼Œå°†æˆ‘ä»¬å­˜æ”¾çš„ apk ç›®å½•ç§»åŠ¨åˆ°é¡¹ç›®çš„æ ¹ç›®å½•</strong> ï¼Œå¦‚ä¸‹ï¼š</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs groovy">task taskMove() &#123;<br>    doLast &#123;<br>        <span class="hljs-comment">// åœ¨ gradle çš„æ‰§è¡Œé˜¶æ®µå»æ‰§è¡Œ</span><br>        <span class="hljs-keyword">def</span> sourcePath = buildDir.path + <span class="hljs-string">&quot;/outputs/apk&quot;</span><br>        <span class="hljs-keyword">def</span> destinationPath = getRootDir().path<br>        <span class="hljs-keyword">def</span> command = <span class="hljs-string">&quot;mv -f $sourcePath $destinationPath&quot;</span><br>        exec &#123;<br>            <span class="hljs-keyword">try</span> &#123;<br>                executable <span class="hljs-string">&quot;bash&quot;</span><br>                args <span class="hljs-string">&quot;-c&quot;</span>, command<br>                println <span class="hljs-string">&quot;The command execute is success&quot;</span><br>            &#125; <span class="hljs-keyword">catch</span> (GradleException e) &#123;<br>                e.printStackTrace()<br>                println <span class="hljs-string">&quot;The command execute is failed&quot;</span><br>            &#125;<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="ä¸‰ã€Task-ä»‹ç»"><a href="#ä¸‰ã€Task-ä»‹ç»" class="headerlink" title="ä¸‰ã€Task ä»‹ç»"></a>ä¸‰ã€Task ä»‹ç»</h2><p>Task ä¸­æ–‡ç¿»è¯‘å³ä»»åŠ¡ï¼Œå®ƒæ˜¯ Gradle ä¸­çš„ä¸€ä¸ªæ¥å£ï¼Œä»£è¡¨äº†è¦æ‰§è¡Œçš„ä»»åŠ¡ï¼Œä¸åŒçš„æ’ä»¶å¯ä»¥æ·»åŠ ä¸åŒçš„ Taskï¼Œæ¯ä¸€ä¸ª Task éƒ½è¦å’Œ Projectå…³è”ã€‚ä¼—æ‰€å‘¨çŸ¥ï¼Œçº¿ç¨‹æ˜¯ cpu æ‰§è¡Œçš„æœ€å°å•å…ƒã€‚åŒç†ï¼ŒTask æ˜¯ Gradle æ‰§è¡Œçš„æœ€å°å•å…ƒï¼ŒGradle å°†ä¸€ä¸ªä¸ª Task ä¸²è”èµ·æ¥ï¼Œå®Œæˆä¸€ä¸ªå…·ä½“çš„æ„å»ºä»»åŠ¡</p><h3 id="1ï¼‰ã€doFirstã€doLast-ä»‹ç»"><a href="#1ï¼‰ã€doFirstã€doLast-ä»‹ç»" class="headerlink" title="1ï¼‰ã€doFirstã€doLast ä»‹ç»"></a>1ï¼‰ã€doFirstã€doLast ä»‹ç»</h3><p>é¦–å…ˆæˆ‘ä»¬è¦ææ‡‚ Action è¿™ä¸ªæ¦‚å¿µï¼ŒAction æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªæ‰§è¡ŒåŠ¨ä½œï¼Œå®ƒåªæœ‰åœ¨æˆ‘ä»¬æ‰§è¡Œå½“å‰ Task æ—¶æ‰ä¼šè¢«æ‰§è¡Œï¼ŒGradle æ‰§è¡Œé˜¶æ®µæœ¬è´¨ä¸Šå°±æ˜¯åœ¨æ‰§è¡Œæ¯ä¸ª Task ä¸­çš„ä¸€ç³»åˆ— Action</p><p>doFirstï¼ŒdoLast æ˜¯ Task ç»™æˆ‘ä»¬æä¾›çš„ä¸¤ä¸ª Action</p><p><strong>doFirst</strong> è¡¨ç¤ºï¼šTask æ‰§è¡Œæœ€å¼€å§‹æ—¶è¢«è°ƒç”¨çš„ Action</p><p><strong>doLast</strong> è¡¨ç¤ºï¼š task æ‰§è¡Œå®Œæ—¶è¢«è°ƒç”¨çš„ Action</p><p>å€¼çš„æ³¨æ„çš„æ˜¯ï¼š<strong>doFirst å’Œ doLast å¯è¢«å¤šæ¬¡æ·»åŠ æ‰§è¡Œ</strong> ï¼Œå¦‚ä¸‹ï¼š</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs groovy">task erdai&#123;<br>    println <span class="hljs-string">&#x27;task start...&#x27;</span><br><br>    doFirst &#123;<br>        println <span class="hljs-string">&#x27;doFirst1&#x27;</span><br>    &#125;<br><br>    doLast &#123;<br>        println <span class="hljs-string">&#x27;doLast1&#x27;</span><br>    &#125;<br><br>    doLast &#123;<br>        println <span class="hljs-string">&#x27;doLast2&#x27;</span><br>    &#125;<br><br>    println <span class="hljs-string">&#x27;task end...&#x27;</span><br>&#125;<br><br><span class="hljs-comment">//æ‰§è¡Œå½“å‰ task</span><br>./gradlew erdai<br><br><span class="hljs-comment">//æ‰“å°ç»“æœå¦‚ä¸‹</span><br>&gt; Configure <span class="hljs-attr">project :</span>app<br>task start...<br>task end...<br><br>&gt; <span class="hljs-attr">Task :</span><span class="hljs-attr">app:</span>erdai<br>doFirst1<br>doLast1<br>doLast2<br></code></pre></td></tr></table></figure><p>ä»ä¸Šè¿°æ‰“å°ç»“æœæˆ‘ä»¬å¯ä»¥å‘ç°</p><p>1ã€<code>println &#39;task start...&#39;</code>ï¼Œ<code> println &#39;task end...&#39;</code>è¿™ä¸¤å¥çš„ä»£ç åœ¨ Gradle é…ç½®é˜¶æ®µå°±è¢«æ‰§è¡Œäº†</p><p>2ã€doFirstï¼ŒdoLast ä¸­çš„ä»£ç æ˜¯åœ¨ Gradle æ‰§è¡Œé˜¶æ®µï¼Œæ‰§è¡Œ erdai è¿™ä¸ª task æ—¶è¢«æ‰§è¡Œçš„</p><p>å› æ­¤ä¹ŸéªŒè¯äº†ä¸€å¼€å§‹æˆ‘è¯´çš„é‚£ä¸ªç»“è®ºï¼š <strong>Gradle é…ç½®é˜¶æ®µï¼Œé™¤ Task çš„ Action ä¸­ç¼–å†™çš„ä»£ç éƒ½ä¼šè¢«æ‰§è¡Œ</strong></p><h3 id="2ï¼‰ã€Task-å±æ€§ä»‹ç»"><a href="#2ï¼‰ã€Task-å±æ€§ä»‹ç»" class="headerlink" title="2ï¼‰ã€Task å±æ€§ä»‹ç»"></a>2ï¼‰ã€Task å±æ€§ä»‹ç»</h3><table><thead><tr><th>å±æ€§</th><th>æè¿°</th><th>é»˜è®¤å€¼</th></tr></thead><tbody><tr><td>name</td><td>task åå­—</td><td>æ— ï¼Œå¿…é¡»æŒ‡å®š</td></tr><tr><td>type</td><td>Task çš„çˆ¶ç±»</td><td>DefaultTask</td></tr><tr><td>action</td><td>å½“ Task æ‰§è¡Œçš„æ—¶å€™ï¼Œéœ€è¦æ‰§è¡Œçš„é—­åŒ…æˆ– Action</td><td>null</td></tr><tr><td>overwrite</td><td>æ›¿æ¢ä¸€ä¸ªå·²å­˜åœ¨çš„ Task</td><td>false</td></tr><tr><td>dependsOn</td><td>è¯¥ Task æ‰€ä¾èµ–çš„ Task é›†åˆ</td><td>[]</td></tr><tr><td>group</td><td>è¯¥ task æ‰€å±åˆ†ç»„</td><td>null</td></tr><tr><td>description</td><td>è¯¥ Task çš„æè¿°ä¿¡æ¯</td><td>null</td></tr><tr><td>constructorArgs</td><td>ä¼ é€’åˆ° Task Class æ„é€ å™¨ä¸­çš„å‚æ•°</td><td>null</td></tr></tbody></table><h3 id="3ï¼‰ã€Task-ç±»å‹ä»‹ç»"><a href="#3ï¼‰ã€Task-ç±»å‹ä»‹ç»" class="headerlink" title="3ï¼‰ã€Task ç±»å‹ä»‹ç»"></a>3ï¼‰ã€Task ç±»å‹ä»‹ç»</h3><p>ä¸€èˆ¬æˆ‘ä»¬åˆ›å»ºçš„ Task é»˜è®¤æ˜¯ç»§æ‰¿ DefaultTaskï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ type å±æ€§è®©ä»–ç»§æ‰¿å…¶ä»–çš„ç±»ï¼Œä¹Ÿå¯ä»¥é€šè¿‡ extends å…³é”®å­—ç›´æ¥æŒ‡å®šï¼ŒGradle è‡ªå¸¦çš„æœ‰  Copyã€Delete ç­‰ç­‰ï¼Œå¦‚ä¸‹ï¼š</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs groovy"><span class="hljs-comment">// 1ã€ç»§æ‰¿ Delete è¿™ä¸ªç±»ï¼Œåˆ é™¤æ ¹ç›®å½•ä¸‹çš„ build æ–‡ä»¶</span><br>task deleteTask(<span class="hljs-attr">type:</span> Delete) &#123;<br>    delete rootProject.buildDir<br>&#125;<br><br><span class="hljs-comment">//é€šè¿‡ extends å…³é”®å­—æŒ‡å®š</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">DeleteTask</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Delete</span>&#123;<br><br>&#125;<br>DeleteTask deleteTask = tasks.create(<span class="hljs-string">&quot;deleteTask&quot;</span>,DeleteTask)<br>deleteTask.delete(rootProject.buildDir)<br><br><br><span class="hljs-comment">// 2ã€ç»§æ‰¿ Copy è¿™ä¸ªç±»</span><br>task copyTask(<span class="hljs-attr">type:</span> Copy) &#123;<br>    <span class="hljs-comment">//...</span><br>&#125;<br><br><span class="hljs-comment">//é€šè¿‡ extends å…³é”®å­—æŒ‡å®š</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">CopyTask</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Copy</span>&#123;<br>    <span class="hljs-comment">//...</span><br>&#125;<br></code></pre></td></tr></table></figure><h3 id="4ï¼‰ã€TaskContainer-ä»‹ç»"><a href="#4ï¼‰ã€TaskContainer-ä»‹ç»" class="headerlink" title="4ï¼‰ã€TaskContainer ä»‹ç»"></a>4ï¼‰ã€TaskContainer ä»‹ç»</h3><p>TaskContainer ä½ å¯ä»¥ç†è§£ä¸ºä¸€ä¸ª Task å®¹å™¨ï¼ŒProject å¯¹è±¡å°±æ˜¯é€šè¿‡ TaskContainer æ¥ç®¡ç† Taskï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥é€šè¿‡ TaskContainerï¼Œå¯¹ Task è¿›è¡Œç›¸å…³çš„æ“ä½œï¼Œä¸€äº›å¸¸ç”¨çš„ API å¦‚ä¸‹ï¼š</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs groovy"><span class="hljs-comment">//æŸ¥æ‰¾task</span><br>findByPath(<span class="hljs-attr">path:</span> String): Task <br>getByPath(<span class="hljs-attr">path:</span> String): Task<br>getByName(<span class="hljs-attr">name:</span> String): Task<br><br><span class="hljs-comment">//åˆ›å»ºtask</span><br>create(<span class="hljs-attr">name:</span> String): Task<br>create(<span class="hljs-attr">name:</span> String, <span class="hljs-attr">configure:</span> Closure): Task <br>create(<span class="hljs-attr">name:</span> String, <span class="hljs-attr">type:</span> Class): Task<br>create(<span class="hljs-attr">options:</span> Map&lt;String, ?&gt;): Task<br>create(<span class="hljs-attr">options:</span> Map&lt;String, ?&gt;, configure: Closure): Task<br><br><span class="hljs-comment">//å½“ task è¢«åŠ å…¥åˆ° TaskContainer æ—¶çš„ç›‘å¬</span><br>whenTaskAdded(<span class="hljs-attr">action:</span> Closure)<br></code></pre></td></tr></table></figure><h3 id="5ï¼‰ã€Task-å®šä¹‰åŠé…ç½®"><a href="#5ï¼‰ã€Task-å®šä¹‰åŠé…ç½®" class="headerlink" title="5ï¼‰ã€Task å®šä¹‰åŠé…ç½®"></a>5ï¼‰ã€Task å®šä¹‰åŠé…ç½®</h3><p>å› ä¸º Task å’Œ Project æ˜¯ç›¸äº’å…³è”çš„ï¼ŒProject ä¸­æä¾›äº†ä¸€ç³»åˆ—åˆ›å»º Task çš„æ–¹æ³•ï¼Œä¸‹é¢ä»‹ç»ä¸€äº›å¸¸ç”¨çš„ï¼š</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><code class="hljs groovy"><span class="hljs-comment">//1ã€åˆ›å»ºä¸€ä¸ªåä¸º task1 çš„ Task</span><br>task task1<br><br><span class="hljs-comment">//2ã€åˆ›å»ºä¸€ä¸ªåä¸º task2 çš„ Taskï¼Œå¹¶é€šè¿‡é—­åŒ…è¿›è¡Œç›¸åº”çš„é…ç½®</span><br>task task2&#123;<br>    <span class="hljs-comment">//æŒ‡å®š task çš„åˆ†ç»„</span><br>    group <span class="hljs-string">&#x27;erdai666&#x27;</span><br>  <br>    doFirst&#123;<br>    <br>    &#125;<br>&#125;<br><br><span class="hljs-comment">//3ã€åˆ›å»ºä¸€ä¸ªåä¸º task3 çš„ Taskï¼Œè¯¥ Task ç»§æ‰¿è‡ª Copy è¿™ä¸ª Taskï¼Œä¾èµ– task2</span><br>task task3(<span class="hljs-attr">type:</span> Copy)&#123;<br>    dependsOn <span class="hljs-string">&quot;task2&quot;</span><br>    doLast&#123;<br>    <br>    &#125;<br>&#125;<br><br><span class="hljs-comment">//4ã€åˆ›å»ºä¸€ä¸ªåä¸º task4 çš„ Task å¹¶æŒ‡å®šäº†åˆ†ç»„å’Œæè¿°</span><br>task task4(<span class="hljs-attr">group:</span> <span class="hljs-string">&quot;erdai666&quot;</span>, <span class="hljs-attr">description:</span> <span class="hljs-string">&quot;task4&quot;</span>) &#123;<br>    doFirst &#123;<br>        <br>    &#125;<br>    <br>    doLast &#123;<br>        <br>    &#125;<br>&#125;<br><br><span class="hljs-comment">//5ã€é€šè¿‡ Project å¯¹è±¡çš„ TaskContainer åˆ›å»ºåä¸º task5 çš„ Task</span><br>tasks.create(<span class="hljs-string">&quot;task5&quot;</span>)&#123;<br><br>&#125;<br><br><span class="hljs-comment">//6ã€é€šè¿‡ Project å¯¹è±¡çš„ TaskContainer åˆ›å»ºåä¸º task6 çš„ Task</span><br><span class="hljs-comment">//ç›¸å¯¹äº 5 ï¼Œåªæ˜¯è°ƒç”¨äº†ä¸åŒçš„é‡è½½æ–¹æ³•è€Œå·²</span><br>tasks.create(<span class="hljs-attr">name:</span> <span class="hljs-string">&quot;task6&quot;</span>)&#123;<br><br>&#125;<br></code></pre></td></tr></table></figure><h3 id="6ï¼‰ã€Task-æ‰§è¡Œå®æˆ˜"><a href="#6ï¼‰ã€Task-æ‰§è¡Œå®æˆ˜" class="headerlink" title="6ï¼‰ã€Task æ‰§è¡Œå®æˆ˜"></a>6ï¼‰ã€Task æ‰§è¡Œå®æˆ˜</h3><p>é€šå¸¸æˆ‘ä»¬ä¼šä½¿ç”¨ doFirst ä¸ doLast åœ¨ Task æ‰§è¡ŒæœŸé—´è¿›è¡Œç›¸å…³æ“ä½œï¼Œä¸‹é¢æˆ‘ä»¬å°±æ¥å®ç° <strong>build ä»»åŠ¡æ‰§è¡ŒæœŸé—´è€—æ—¶</strong>ï¼š</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs groovy"><span class="hljs-comment">// Task æ‰§è¡Œå®æˆ˜ï¼šè®¡ç®— build æ‰§è¡ŒæœŸé—´çš„è€—æ—¶</span><br><span class="hljs-keyword">def</span> startBuildTime, endBuildTime<br><span class="hljs-comment">// 1ã€åœ¨ Gradle é…ç½®é˜¶æ®µå®Œæˆä¹‹åè¿›è¡Œæ“ä½œï¼Œ</span><br><span class="hljs-comment">// ä»¥æ­¤ä¿è¯è¦æ‰§è¡Œçš„ task é…ç½®å®Œæ¯•</span><br><span class="hljs-variable language_">this</span>.afterEvaluate &#123; Project project -&gt;<br>    <span class="hljs-comment">// 2ã€æ‰¾åˆ°å½“å‰ project ä¸‹ç¬¬ä¸€ä¸ªæ‰§è¡Œçš„ taskï¼Œå³ preBuild task</span><br>    <span class="hljs-keyword">def</span> preBuildTask = project.tasks.getByName(<span class="hljs-string">&quot;preBuild&quot;</span>)<br>    preBuildTask.doFirst &#123;<br>        <span class="hljs-comment">// 3ã€è·å–ç¬¬ä¸€ä¸ª task å¼€å§‹æ‰§è¡Œæ—¶åˆ»çš„æ—¶é—´æˆ³</span><br>        startBuildTime = System.currentTimeMillis()<br>    &#125;<br>    <span class="hljs-comment">// 4ã€æ‰¾åˆ°å½“å‰ project ä¸‹æœ€åä¸€ä¸ªæ‰§è¡Œçš„ taskï¼Œå³ build task</span><br>    <span class="hljs-keyword">def</span> buildTask = project.tasks.getByName(<span class="hljs-string">&quot;build&quot;</span>)<br>    buildTask.doLast &#123;<br>        <span class="hljs-comment">// 5ã€è·å–æœ€åä¸€ä¸ª task æ‰§è¡Œå®Œæˆå‰ä¸€ç¬é—´çš„æ—¶é—´æˆ³</span><br>        endBuildTime = System.currentTimeMillis()<br>        <span class="hljs-comment">// 6ã€è¾“å‡º build æ‰§è¡ŒæœŸé—´çš„è€—æ—¶</span><br>        println <span class="hljs-string">&quot;Current project execute time is $&#123;endBuildTime - startBuildTime&#125;&quot;</span><br>    &#125;<br>&#125;<br><br><span class="hljs-comment">//æ‰§è¡Œ build ä»»åŠ¡</span><br>./gradlew build<br><br><span class="hljs-comment">//æ‰“å°ç»“æœ</span><br>Current project execute time is <span class="hljs-number">21052</span><br></code></pre></td></tr></table></figure><h3 id="7ï¼‰ã€æŒ‡å®š-Task-æ‰§è¡Œé¡ºåº"><a href="#7ï¼‰ã€æŒ‡å®š-Task-æ‰§è¡Œé¡ºåº" class="headerlink" title="7ï¼‰ã€æŒ‡å®š Task æ‰§è¡Œé¡ºåº"></a>7ï¼‰ã€æŒ‡å®š Task æ‰§è¡Œé¡ºåº</h3><p>åœ¨ Gradle ä¸­ï¼Œæœ‰ä¸‰ç§æ–¹å¼å¯ä»¥æŒ‡å®š Task æ‰§è¡Œé¡ºåºï¼š</p><p>1ã€dependsOn å¼ºä¾èµ–æ–¹å¼</p><p>2ã€é€šè¿‡ Task è¾“å…¥è¾“å‡º</p><p>3ã€é€šè¿‡ API æŒ‡å®šæ‰§è¡Œé¡ºåº</p><h4 id="1ã€dependsOn-å¼ºä¾èµ–æ–¹å¼"><a href="#1ã€dependsOn-å¼ºä¾èµ–æ–¹å¼" class="headerlink" title="1ã€dependsOn å¼ºä¾èµ–æ–¹å¼"></a>1ã€dependsOn å¼ºä¾èµ–æ–¹å¼</h4><p>dependsOn å¼ºä¾èµ–æ–¹å¼å¯ç»†åˆ†ä¸º<strong>é™æ€ä¾èµ–</strong>å’Œ<strong>åŠ¨æ€ä¾èµ–</strong></p><ul><li>é™æ€ä¾èµ–ï¼šåœ¨åˆ›å»º Task çš„æ—¶å€™ï¼Œç›´æ¥é€šè¿‡ dependsOn æŒ‡å®šéœ€è¦ä¾èµ–çš„ Task</li><li>åŠ¨æ€ä¾èµ–ï¼šåœ¨åˆ›å»º Task çš„æ—¶å€™ï¼Œä¸çŸ¥é“éœ€è¦ä¾èµ–å“ªäº› Taskï¼Œéœ€é€šè¿‡ dependsOn åŠ¨æ€ä¾èµ–ç¬¦åˆæ¡ä»¶çš„ Task</li></ul><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs groovy"><span class="hljs-comment">//=================================é™æ€ä¾èµ–=============================</span><br>task taskA&#123;<br>    doLast &#123;<br>        println <span class="hljs-string">&#x27;taskA&#x27;</span><br>    &#125;<br>&#125;<br><br>task taskB&#123;<br>    doLast &#123;<br>        println <span class="hljs-string">&#x27;taskB&#x27;</span><br>    &#125;<br>&#125;<br><br>task taskC(<span class="hljs-attr">dependsOn:</span> taskA)&#123;<span class="hljs-comment">//å¤šä¾èµ–æ–¹å¼ dependsOn:[taskA,taskB]</span><br>    doLast &#123;<br>        println <span class="hljs-string">&#x27;taskC&#x27;</span><br>    &#125;<br>&#125;<br><br><span class="hljs-comment">//æ‰§è¡Œ taskC</span><br>./gradlew taskC<br><br><span class="hljs-comment">//æ‰“å°ç»“æœ</span><br>&gt; <span class="hljs-attr">Task :</span><span class="hljs-attr">app:</span>taskA<br>taskA<br><br>&gt; <span class="hljs-attr">Task :</span><span class="hljs-attr">app:</span>taskC<br>taskC<br></code></pre></td></tr></table></figure><p>ä¸Šè¿°ä»£ç ï¼Œå½“æˆ‘ä»¬æ‰§è¡Œ taskC çš„æ—¶å€™ï¼Œå› ä¸ºä¾èµ–äº† taskAï¼Œå› æ­¤ taskA ä¼šå…ˆæ‰§è¡Œï¼Œåœ¨æ‰§è¡Œ taskC</p><p><strong>æ³¨æ„</strong>ï¼šå½“ä¸€ä¸ª Task ä¾èµ–å¤šä¸ª Task çš„æ—¶å€™ï¼Œè¢«ä¾èµ–çš„ Task ä¹‹é—´å¦‚æœæ²¡æœ‰ä¾èµ–å…³ç³»ï¼Œé‚£ä¹ˆå®ƒä»¬çš„æ‰§è¡Œé¡ºåºæ˜¯éšæœºçš„ï¼Œå¹¶æ— å½±å“ï¼Œå¦‚ä¸‹ï¼š</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs groovy">task taskC(<span class="hljs-attr">dependsOn:</span>[taskA,taskB])&#123;<br>    doLast &#123;<br>        println <span class="hljs-string">&#x27;taskC&#x27;</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>taskA å’Œ taskB çš„æ‰§è¡Œé¡ºåºæ˜¯éšæœºçš„</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><code class="hljs groovy"><span class="hljs-comment">//=================================åŠ¨æ€ä¾èµ–=============================</span><br><span class="hljs-comment">// Task åŠ¨æ€ä¾èµ–æ–¹å¼</span><br>task lib1 &#123;<br>    doLast&#123;<br>        println <span class="hljs-string">&#x27;lib1&#x27;</span><br>    &#125;<br>&#125;<br>task lib2 &#123;<br>    doLast&#123;<br>        println <span class="hljs-string">&#x27;lib2&#x27;</span><br>    &#125;<br>&#125;<br>task lib3 &#123;<br>    doLast&#123;<br>        println <span class="hljs-string">&#x27;lib3&#x27;</span><br>    &#125;<br>&#125;<br><br><span class="hljs-comment">// åŠ¨æ€æŒ‡å®štaskXä¾èµ–æ‰€æœ‰ä»¥libå¼€å¤´çš„task</span><br>task taskDynamic&#123;<br>    <span class="hljs-comment">// åŠ¨æ€æŒ‡å®šä¾èµ–</span><br>    dependsOn tasks.findAll&#123; Task task -&gt;<br>        <span class="hljs-keyword">return</span> task.name.startsWith(<span class="hljs-string">&#x27;lib&#x27;</span>)<br>    &#125;<br><br>    doLast &#123;<br>        println <span class="hljs-string">&#x27;taskDynamic&#x27;</span><br>    &#125;<br>&#125;<br><br><span class="hljs-comment">//æ‰§è¡Œ taskDynamic</span><br>./gradlew taskDynamic<br><br><span class="hljs-comment">//æ‰“å°ç»“æœ</span><br>&gt; <span class="hljs-attr">Task :</span><span class="hljs-attr">app:</span>lib1<br>lib1<br><br>&gt; <span class="hljs-attr">Task :</span><span class="hljs-attr">app:</span>lib2<br>lib2<br><br>&gt; <span class="hljs-attr">Task :</span><span class="hljs-attr">app:</span>lib3<br>lib3<br><br>&gt; <span class="hljs-attr">Task :</span><span class="hljs-attr">app:</span>taskDynamic<br>taskDynamic<br></code></pre></td></tr></table></figure><h4 id="2ã€é€šè¿‡-Task-è¾“å…¥è¾“å‡ºæŒ‡å®šæ‰§è¡Œé¡ºåº"><a href="#2ã€é€šè¿‡-Task-è¾“å…¥è¾“å‡ºæŒ‡å®šæ‰§è¡Œé¡ºåº" class="headerlink" title="2ã€é€šè¿‡ Task è¾“å…¥è¾“å‡ºæŒ‡å®šæ‰§è¡Œé¡ºåº"></a>2ã€é€šè¿‡ Task è¾“å…¥è¾“å‡ºæŒ‡å®šæ‰§è¡Œé¡ºåº</h4><p>å½“ä¸€ä¸ªå‚æ•°ï¼Œä½œä¸º TaskA çš„è¾“å…¥å‚æ•°ï¼ŒåŒæ—¶åˆä½œä¸º TaskB çš„è¾“å‡ºå‚æ•°ï¼Œé‚£ä¹ˆ TaskA æ‰§è¡Œçš„æ—¶å€™å…ˆè¦æ‰§è¡Œ TaskBã€‚å³è¾“å‡ºçš„ Task å…ˆäºè¾“å…¥çš„ Task æ‰§è¡Œ</p><p>ä½†æ˜¯æˆ‘åœ¨å®é™…æµ‹è¯•è¿‡ç¨‹ä¸­å‘ç°ï¼š<strong>è¾“å…¥çš„ Task ä¼šå…ˆæ‰§è¡Œï¼Œç„¶ååœ¨æ‰§è¡Œè¾“å‡ºçš„ Task</strong>ï¼Œå¦‚ä¸‹ï¼š</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><code class="hljs groovy">ext &#123;<br>    testFile = file(<span class="hljs-string">&quot;$&#123;projectDir.path&#125;/test.txt&quot;</span>)<br>    <span class="hljs-keyword">if</span>(testFile != <span class="hljs-literal">null</span> || !testFile.exists())&#123;<br>        testFile.createNewFile()<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">//è¾“å‡º Task</span><br>task outputTask &#123;<br>    outputs.file testFile<br>    doLast &#123;<br>        outputs.getFiles().singleFile.withWriter &#123; writer -&gt;<br>            writer.append(<span class="hljs-string">&quot;erdai666&quot;</span>)<br>        &#125;<br>        println <span class="hljs-string">&quot;outputTask æ‰§è¡Œç»“æŸ&quot;</span><br>    &#125;<br>&#125;<br><br><span class="hljs-comment">//è¾“å…¥ Task</span><br>task inputTask &#123;<br>    inputs.file testFile<br>    doLast &#123;<br>        println <span class="hljs-string">&quot;è¯»å–æ–‡ä»¶å†…å®¹ï¼š$&#123;inputs.files.singleFile.text&#125;&quot;</span><br>        println <span class="hljs-string">&quot;inputTask æ‰§è¡Œç»“æŸ&quot;</span><br>    &#125;<br>&#125;<br><br><span class="hljs-comment">//æµ‹è¯• Task</span><br>task testTask(<span class="hljs-attr">dependsOn:</span> [outputTask, inputTask]) &#123;<br>    doLast &#123;<br>        println <span class="hljs-string">&quot;testTask1 æ‰§è¡Œç»“æŸ&quot;</span><br>    &#125;<br>&#125;<br><br><span class="hljs-comment">//æ‰§è¡Œ testTask</span><br>./gradlew testTask<br><br><span class="hljs-comment">//ç†è®ºä¸Šä¼šå…ˆæ‰§è¡Œ outputTaskï¼Œåœ¨æ‰§è¡Œ inputTaskï¼Œæœ€åæ‰§è¡Œ testTask</span><br><span class="hljs-comment">//ä½†å®é™…æ‰“å°ç»“æœ</span><br>&gt; <span class="hljs-attr">Task :</span><span class="hljs-attr">app:</span>inputTask<br>è¯»å–æ–‡ä»¶å†…å®¹ï¼š<br>inputTask æ‰§è¡Œç»“æŸ<br><br>&gt; <span class="hljs-attr">Task :</span><span class="hljs-attr">app:</span>outputTask<br>outputTask æ‰§è¡Œç»“æŸ<br><br>&gt; <span class="hljs-attr">Task :</span><span class="hljs-attr">app:</span>testTask<br>testTask1 æ‰§è¡Œç»“æŸ<br></code></pre></td></tr></table></figure><p>æœ€ç»ˆæˆ‘å¯¹ inputTask æŒ‡å®šäº†å…·ä½“ä¾èµ–æ‰è¾¾åˆ°äº†é¢„æœŸæ•ˆæœï¼š</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs groovy">task inputTask(<span class="hljs-attr">dependsOn:</span> outputTask) &#123;<br>    inputs.file testFile<br>    doLast &#123;<br>        println <span class="hljs-string">&quot;è¯»å–æ–‡ä»¶å†…å®¹ï¼š$&#123;inputs.files.singleFile.text&#125;&quot;</span><br>        println <span class="hljs-string">&quot;inputTask æ‰§è¡Œç»“æŸ&quot;</span><br>    &#125;<br>&#125;<br><br><span class="hljs-comment">//ä¿®æ”¹ä¹‹åçš„æ‰“å°ç»“æœ</span><br>&gt; <span class="hljs-attr">Task :</span><span class="hljs-attr">app:</span>outputTask<br>outputTask æ‰§è¡Œç»“æŸ<br><br>&gt; <span class="hljs-attr">Task :</span><span class="hljs-attr">app:</span>inputTask<br>è¯»å–æ–‡ä»¶å†…å®¹ï¼šerdai666<br>inputTask æ‰§è¡Œç»“æŸ<br><br>&gt; <span class="hljs-attr">Task :</span><span class="hljs-attr">app:</span>testTask<br>testTask1 æ‰§è¡Œç»“æŸ<br></code></pre></td></tr></table></figure><h4 id="3ã€é€šè¿‡-API-æŒ‡å®šæ‰§è¡Œé¡ºåº"><a href="#3ã€é€šè¿‡-API-æŒ‡å®šæ‰§è¡Œé¡ºåº" class="headerlink" title="3ã€é€šè¿‡ API æŒ‡å®šæ‰§è¡Œé¡ºåº"></a>3ã€é€šè¿‡ API æŒ‡å®šæ‰§è¡Œé¡ºåº</h4><p>å¯ä»¥æŒ‡å®š Task æ‰§è¡Œé¡ºåºçš„ API æœ‰ï¼š</p><p><strong>mustRunAfter</strong>ï¼šæŒ‡å®šå¿…é¡»åœ¨å“ªä¸ª Task æ‰§è¡Œå®Œæˆä¹‹åæ‰§è¡Œ</p><p><strong>shouldRunAfter</strong>ï¼šè·Ÿ mustRunAfter ç±»ä¼¼ï¼ŒåŒºåˆ«åœ¨äºä¸å¼ºåˆ¶ï¼Œä¸å¸¸ç”¨</p><p><strong>finalizeBy</strong>ï¼šåœ¨å½“å‰ Task æ‰§è¡Œå®Œæˆä¹‹åï¼ŒæŒ‡å®šæ‰§è¡Œçš„ Task</p><p>ä¸‹é¢æˆ‘ä»¬é€šè¿‡ä»£ç æ¥æ¼”ç¤ºä¸€ä¸‹ï¼š</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><code class="hljs groovy"><span class="hljs-comment">//======================================= mustRunAfter ===========================</span><br>task taskX&#123;<br>    doLast &#123;<br>        println <span class="hljs-string">&#x27;taskX&#x27;</span><br>    &#125;<br>&#125;<br><br>task taskY&#123;<br>    mustRunAfter taskX<br>    doLast &#123;<br>        println <span class="hljs-string">&#x27;taskY&#x27;</span><br>    &#125;<br>&#125;<br><br>task taskXY(<span class="hljs-attr">dependsOn:</span> [taskX,taskY])&#123;<br>    doLast &#123;<br>        println <span class="hljs-string">&#x27;taskXY&#x27;</span><br>    &#125;<br>&#125;<br><br><span class="hljs-comment">//æ‰§è¡Œ taskXY</span><br>./gradlew taskXY<br><br><span class="hljs-comment">//æ‰“å°ç»“æœ</span><br>&gt; <span class="hljs-attr">Task :</span><span class="hljs-attr">app:</span>taskX<br>taskX<br><br>&gt; <span class="hljs-attr">Task :</span><span class="hljs-attr">app:</span>taskY<br>taskY<br><br>&gt; <span class="hljs-attr">Task :</span><span class="hljs-attr">app:</span>taskXY<br>taskXY<br><br><span class="hljs-comment">//======================================= finalizeBy ===========================</span><br>task taskI&#123;<br>    doLast &#123;<br>        println <span class="hljs-string">&#x27;taskI&#x27;</span><br>    &#125;<br>&#125;<br><br>task taskJ&#123;<br>    finalizedBy taskI<br>    doLast &#123;<br>        println <span class="hljs-string">&#x27;taskJ&#x27;</span><br>    &#125;<br>&#125;<br><br><br>task taskIJ(<span class="hljs-attr">dependsOn:</span> [taskI,taskJ])&#123;<br>    doLast &#123;<br>        println <span class="hljs-string">&#x27;taskIJ&#x27;</span><br>    &#125;<br>&#125;<br><br><span class="hljs-comment">//æ‰§è¡Œ taskIJ</span><br>./gradlew taskIJ<br><br><span class="hljs-comment">//æ‰“å°ç»“æœ</span><br>&gt; <span class="hljs-attr">Task :</span><span class="hljs-attr">app:</span>taskJ<br>taskJ<br><br>&gt; <span class="hljs-attr">Task :</span><span class="hljs-attr">app:</span>taskI<br>taskI<br><br>&gt; <span class="hljs-attr">Task :</span><span class="hljs-attr">app:</span>taskIJ<br>taskIJ<br></code></pre></td></tr></table></figure><h2 id="å››ã€è‡ªå®šä¹‰-Task-æŒ‚æ¥åˆ°-Android-åº”ç”¨æ„å»ºæµç¨‹"><a href="#å››ã€è‡ªå®šä¹‰-Task-æŒ‚æ¥åˆ°-Android-åº”ç”¨æ„å»ºæµç¨‹" class="headerlink" title="å››ã€è‡ªå®šä¹‰ Task æŒ‚æ¥åˆ° Android åº”ç”¨æ„å»ºæµç¨‹"></a>å››ã€è‡ªå®šä¹‰ Task æŒ‚æ¥åˆ° Android åº”ç”¨æ„å»ºæµç¨‹</h2><h3 id="1ï¼‰ã€Task-ä¾èµ–å…³ç³»æ’ä»¶ä»‹ç»"><a href="#1ï¼‰ã€Task-ä¾èµ–å…³ç³»æ’ä»¶ä»‹ç»" class="headerlink" title="1ï¼‰ã€Task ä¾èµ–å…³ç³»æ’ä»¶ä»‹ç»"></a>1ï¼‰ã€Task ä¾èµ–å…³ç³»æ’ä»¶ä»‹ç»</h3><p>æˆ‘ä»¬å¯ä»¥å¼•å…¥å¦‚ä¸‹æ’ä»¶æ¥æŸ¥çœ‹ Task çš„ä¸€ä¸ªä¾èµ–å…³ç³»ï¼š</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs groovy"><span class="hljs-comment">//1ã€åœ¨æ ¹ build.gradle æ·»åŠ å¦‚ä¸‹ä»£ç </span><br>buildscript &#123;<br>    repositories &#123;<br>      <span class="hljs-comment">//...</span><br>        maven&#123;<br>           url <span class="hljs-string">&quot;https://plugins.gradle.org/m2/&quot;</span><br>        &#125;<br>    &#125;<br>    dependencies &#123;<br>      <span class="hljs-comment">//..</span><br>        classpath <span class="hljs-string">&quot;gradle.plugin.com.dorongold.plugins:task-tree:1.5&quot;</span><br>    &#125;<br>&#125;<br><br><br><span class="hljs-comment">// 2ã€åœ¨ app çš„ build.gradle ä¸­åº”ç”¨æ’ä»¶</span><br>apply <span class="hljs-attr">plugin:</span> com.dorongold.gradle.tasktree.TaskTreePlugin<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 3ã€åœ¨å‘½ä»¤è¡Œä¸­æ‰§è¡Œï¼š./gradlew &lt;ä»»åŠ¡å&gt; taskTree --no-repeat å‘½ä»¤å³å¯æŸ¥çœ‹</span><br><span class="hljs-comment"> * è¿™é‡Œä»¥æ‰§è¡Œ build è¿™ä¸ª task ä¸ºä¾‹</span><br><span class="hljs-comment"> */</span><br>./gradlew build taskTree --no-repeat<br></code></pre></td></tr></table></figure><p>ç»è¿‡ä¸Šé¢ 3 æ­¥ï¼Œæˆ‘ä»¬çœ‹ä¸‹ä¾èµ–å…³ç³»å›¾ï¼Œä»…æˆªå–éƒ¨åˆ†ï¼š</p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/86c516a5a77b459da8395072715338d8~tplv-k3u1fbpfcp-zoom-1.image" alt="image-20210718114010544" style="zoom:50%;" /><h3 id="2ï¼‰ã€è‡ªå®šä¹‰-Task-æŒ‚æ¥åˆ°-Android-æ„å»ºæµç¨‹"><a href="#2ï¼‰ã€è‡ªå®šä¹‰-Task-æŒ‚æ¥åˆ°-Android-æ„å»ºæµç¨‹" class="headerlink" title="2ï¼‰ã€è‡ªå®šä¹‰ Task æŒ‚æ¥åˆ° Android æ„å»ºæµç¨‹"></a>2ï¼‰ã€è‡ªå®šä¹‰ Task æŒ‚æ¥åˆ° Android æ„å»ºæµç¨‹</h3><p>æˆ‘ä»¬çŸ¥é“ï¼ŒGradle åœ¨æ‰§è¡Œé˜¶æ®µå°±æ˜¯æ‰§è¡Œ Task åŠå…¶ä¾èµ–çš„ Taskï¼Œå°±æ¯”å¦‚ä¸Šé¢æˆªå›¾çš„ build Task çš„å…³ç³»ä¾èµ–å›¾ï¼Œå®ƒä¼šæŒ‰ç…§è¿™ä¸ªä¾èµ–å›¾æœ‰æ¡ä¸ç´Šçš„å»æ‰§è¡Œã€‚</p><p>é‚£ä¹ˆå¦‚æœæˆ‘æƒ³æŠŠè‡ªå·±è‡ªå®šä¹‰çš„ Task æŒ‚æ¥åˆ°è¿™ä¸ªæ„å»ºæµç¨‹ï¼Œè¯¥æ€ä¹ˆåšå‘¢ï¼Ÿ</p><h5 id="1ã€é€šè¿‡-dependsOn-æŒ‡å®š"><a href="#1ã€é€šè¿‡-dependsOn-æŒ‡å®š" class="headerlink" title="1ã€é€šè¿‡ dependsOn æŒ‡å®š"></a>1ã€é€šè¿‡ dependsOn æŒ‡å®š</h5><p><strong>æ³¨æ„ï¼š</strong> å•ç‹¬ä½¿ç”¨ dependsOn ï¼Œå¿…é¡»è®©æ„å»ºæµç¨‹ä¸­çš„ Task ä¾èµ–æˆ‘ä»¬è‡ªå®šä¹‰çš„ Taskï¼Œå¦åˆ™æˆ‘ä»¬çš„ Task ä¸ä¼šç”Ÿæ•ˆ</p><p>å¦‚ä¸‹ä»£ç æ¼”ç¤ºä¸€ä¸‹ï¼š</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs groovy">task myCustomTask&#123;<br>    doLast &#123;<br>        println <span class="hljs-string">&#x27;This is myCustomTask&#x27;</span><br>    &#125;<br>&#125;<br><br>afterEvaluate &#123;<br>    <span class="hljs-comment">//1ã€æ‰¾åˆ°éœ€è¦çš„æ„å»ºæµç¨‹ Task</span><br>    <span class="hljs-keyword">def</span> mergeDebugResources = tasks.findByName(<span class="hljs-string">&quot;mergeDebugResources&quot;</span>)<br>    <span class="hljs-comment">//2ã€é€šè¿‡ dependsOn æŒ‡å®š</span><br>    mergeDebugResources.dependsOn(myCustomTask)<br>  <br>    <span class="hljs-comment">//å¦‚æœæ¢æˆä¸‹é¢è¿™ç§å†™æ³•åˆ™è‡ªå®šä¹‰ Task ä¸ä¼šç”Ÿæ•ˆ</span><br>    <span class="hljs-comment">//myCustomTask.dependsOn(mergeDebugResources)</span><br>&#125;<br></code></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥æˆ‘ä»¬éªŒè¯ä¸€ä¸‹</p><p>é¦–å…ˆçœ‹ä¸€çœ¼ Task ä¾èµ–å…³ç³»å›¾ï¼š</p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/abf5fd86aaed4ecd818e9df7b0aa8ba1~tplv-k3u1fbpfcp-zoom-1.image" alt="image-20210718130023237" style="zoom:50%;" /><p>æˆ‘ä»¬è‡ªå®šä¹‰çš„ Task æŒ‚æ¥åˆ°äº† mergeDebugResources ä¸Š</p><p>æ‰§è¡Œä¸‹ build è¿™ä¸ª Taskï¼Œå¯ä»¥å‘ç°æˆ‘ä»¬çš„ Task è¢«æ‰§è¡Œäº†ï¼š</p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/4d4a4b36ece04058ba2430def0685a72~tplv-k3u1fbpfcp-zoom-1.image" alt="image-20210718130303391" style="zoom:50%;" /><h5 id="2ã€é€šè¿‡-finalizedBy-æŒ‡å®š"><a href="#2ã€é€šè¿‡-finalizedBy-æŒ‡å®š" class="headerlink" title="2ã€é€šè¿‡ finalizedBy æŒ‡å®š"></a>2ã€é€šè¿‡ finalizedBy æŒ‡å®š</h5><p>åœ¨æŸä¸ª Task æ‰§è¡Œå®Œæˆåï¼ŒæŒ‡å®šéœ€è¦æ‰§è¡Œçš„ Task</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs groovy">task myCustomTask&#123;<br>    doLast &#123;<br>        println <span class="hljs-string">&#x27;This is myCustomTask&#x27;</span><br>    &#125;<br>&#125;<br><br>afterEvaluate &#123;<br>    <span class="hljs-keyword">def</span> mergeDebugResources = tasks.findByName(<span class="hljs-string">&quot;mergeDebugResources&quot;</span>)<br>    <span class="hljs-comment">//å°† myCustomTask æŒ‚æ¥åœ¨ mergeDebugResources åé¢æ‰§è¡Œ</span><br>    mergeDebugResources.finalizedBy(myCustomTask)<br>&#125;<br></code></pre></td></tr></table></figure><h5 id="3ã€é€šè¿‡-mustRunAfter-é…åˆ-dependsOn-æŒ‡å®š"><a href="#3ã€é€šè¿‡-mustRunAfter-é…åˆ-dependsOn-æŒ‡å®š" class="headerlink" title="3ã€é€šè¿‡ mustRunAfter é…åˆ dependsOn æŒ‡å®š"></a>3ã€é€šè¿‡ mustRunAfter é…åˆ dependsOn æŒ‡å®š</h5><p>åœ¨ä¸¤ä¸ª Task ä¹‹é—´ï¼Œæ’å…¥è‡ªå®šä¹‰çš„ Task </p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs groovy">task myCustomTask&#123;<br>    doLast &#123;<br>        println <span class="hljs-string">&#x27;This is myCustomTask&#x27;</span><br>    &#125;<br>&#125;<br><br>afterEvaluate &#123;<br>    <span class="hljs-comment">//åœ¨ mergeDebugResources å’Œ processDebugResources ä¹‹é—´æ’å…¥ myCustomTask</span><br>    <span class="hljs-keyword">def</span> processDebugResources = tasks.findByName(<span class="hljs-string">&quot;processDebugResources&quot;</span>)<br>    <span class="hljs-keyword">def</span> mergeDebugResources = tasks.findByName(<span class="hljs-string">&quot;mergeDebugResources&quot;</span>)<br>    myCustomTask.mustRunAfter(mergeDebugResources)<br>    processDebugResources.dependsOn(myCustomTask)<br>&#125;<br></code></pre></td></tr></table></figure><p>ä¸Šè¿° Task ä¾èµ–å˜åŒ–è¿‡ç¨‹ï¼š</p><p>processDebugResources -&gt; mergeDebugResources &#x3D;&#x3D;&#x3D;&gt; processDebugResources -&gt; myCustomTask -&gt; mergeDebugResources</p><h2 id="äº”ã€Gradle-ç›¸å…³å‘½ä»¤ä»‹ç»"><a href="#äº”ã€Gradle-ç›¸å…³å‘½ä»¤ä»‹ç»" class="headerlink" title="äº”ã€Gradle ç›¸å…³å‘½ä»¤ä»‹ç»"></a>äº”ã€Gradle ç›¸å…³å‘½ä»¤ä»‹ç»</h2><h3 id="1ï¼‰ã€æŸ¥çœ‹é¡¹ç›®æ‰€æœ‰çš„-Project-å¯¹è±¡"><a href="#1ï¼‰ã€æŸ¥çœ‹é¡¹ç›®æ‰€æœ‰çš„-Project-å¯¹è±¡" class="headerlink" title="1ï¼‰ã€æŸ¥çœ‹é¡¹ç›®æ‰€æœ‰çš„ Project å¯¹è±¡"></a>1ï¼‰ã€æŸ¥çœ‹é¡¹ç›®æ‰€æœ‰çš„ Project å¯¹è±¡</h3><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs groovy">./gradlew project<br></code></pre></td></tr></table></figure><h3 id="2ï¼‰ã€æŸ¥çœ‹-module-ä¸‹æ‰€æœ‰çš„-task"><a href="#2ï¼‰ã€æŸ¥çœ‹-module-ä¸‹æ‰€æœ‰çš„-task" class="headerlink" title="2ï¼‰ã€æŸ¥çœ‹ module ä¸‹æ‰€æœ‰çš„ task"></a>2ï¼‰ã€æŸ¥çœ‹ module ä¸‹æ‰€æœ‰çš„ task</h3><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs groovy">./gradlew <span class="hljs-attr">$moduleName:</span>tasks<br><br><span class="hljs-comment">//æ¼”ç¤º</span><br><span class="hljs-comment">//æŸ¥çœ‹ app ä¸‹çš„æ‰€æœ‰ Task</span><br>./gradlew <span class="hljs-attr">app:</span>tasks<br><br><span class="hljs-comment">//æŸ¥çœ‹æ ¹ Project çš„æ‰€æœ‰ Task</span><br>./gradlew tasks<br></code></pre></td></tr></table></figure><h3 id="3ï¼‰ã€æ‰§è¡Œä¸€ä¸ª-Task"><a href="#3ï¼‰ã€æ‰§è¡Œä¸€ä¸ª-Task" class="headerlink" title="3ï¼‰ã€æ‰§è¡Œä¸€ä¸ª Task"></a>3ï¼‰ã€æ‰§è¡Œä¸€ä¸ª Task</h3><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs groovy">./gradlew $taskName<br><br><span class="hljs-comment">//æ‰§è¡Œ build Task</span><br>./gradlew build<br></code></pre></td></tr></table></figure><h3 id="4ï¼‰ã€æŸ¥çœ‹-module-ä¸‹çš„ç¬¬ä¸‰æ–¹åº“ä¾èµ–å…³ç³»"><a href="#4ï¼‰ã€æŸ¥çœ‹-module-ä¸‹çš„ç¬¬ä¸‰æ–¹åº“ä¾èµ–å…³ç³»" class="headerlink" title="4ï¼‰ã€æŸ¥çœ‹ module ä¸‹çš„ç¬¬ä¸‰æ–¹åº“ä¾èµ–å…³ç³»"></a>4ï¼‰ã€æŸ¥çœ‹ module ä¸‹çš„ç¬¬ä¸‰æ–¹åº“ä¾èµ–å…³ç³»</h3><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs groovy">./gradlew <span class="hljs-attr">$moduleName:</span>dependencies<br><br><span class="hljs-comment">//æŸ¥çœ‹ app ä¸‹çš„ç¬¬ä¸‰æ–¹åº“ä¾èµ–å…³ç³»</span><br>./gradlew <span class="hljs-attr">app:</span>dependencies<br></code></pre></td></tr></table></figure><h2 id="å…­ã€æ€»ç»“"><a href="#å…­ã€æ€»ç»“" class="headerlink" title="å…­ã€æ€»ç»“"></a>å…­ã€æ€»ç»“</h2><p>æœ¬ç¯‡æ–‡ç« è®²çš„ä¸€äº›é‡ç‚¹å†…å®¹ï¼š</p><p>1ã€Gradle ä¸‰ä¸ªé˜¶æ®µåŠç”Ÿå‘½å‘¨æœŸ Hook ç‚¹</p><p>2ã€Project å¯¹è±¡å¸¸ç”¨ API ä»‹ç»ï¼Œæ‰©å±•å±æ€§çš„åº”ç”¨ä¸å®æˆ˜</p><p>3ã€Task å¸¸ç”¨é…ç½®ä»‹ç»ï¼Œå…¶ä¸­é€šè¿‡ Task è¾“å…¥è¾“å‡ºæŒ‡å®šæ‰§è¡Œé¡ºåºé‡åˆ°äº†å‘ï¼šä¼šå…ˆæ‰§è¡Œè¾“å…¥çš„ Taskã€‚æœ€ç»ˆè¿˜æ˜¯é€šè¿‡ä½¿ç”¨ dependsOn æŒ‡å®šå…·ä½“ä¾èµ–æ‰è¾¾åˆ°é¢„æœŸæ•ˆæœ</p><p>4ã€è‡ªå®šä¹‰ Task æŒ‚æ¥åˆ° Android åº”ç”¨æ„å»ºæµç¨‹çš„ä¸‰ç§æ–¹å¼ï¼š</p><blockquote><p>1ã€å•ç‹¬ä½¿ç”¨ dependsOn ï¼ˆæ³¨æ„å¿…é¡»ä½¿ç”¨æ„å»ºæµç¨‹ä¸­çš„ Task ä¾èµ–æˆ‘ä»¬è‡ªå®šä¹‰çš„ Taskï¼‰</p><p>2ã€ä½¿ç”¨ finalizedBy</p><p>3ã€mustRunAfter é…åˆ dependsOn</p></blockquote><p>5ã€Gradle ä¸€äº›å¸¸ç”¨çš„å‘½ä»¤ä»‹ç»</p><p>å¥½äº†ï¼Œæœ¬ç¯‡æ–‡ç« åˆ°è¿™é‡Œå°±ç»“æŸäº†ï¼Œå¸Œæœ›èƒ½ç»™ä½ å¸¦æ¥å¸®åŠ© ğŸ¤ </p><p><strong>æ„Ÿè°¢ä½ é˜…è¯»è¿™ç¯‡æ–‡ç« </strong></p><h3 id="ä¸‹ç¯‡é¢„å‘Š"><a href="#ä¸‹ç¯‡é¢„å‘Š" class="headerlink" title="ä¸‹ç¯‡é¢„å‘Š"></a>ä¸‹ç¯‡é¢„å‘Š</h3><p>ä¸‹ç¯‡æ–‡ç« æˆ‘ä¼šè®²å¦‚ä½•è‡ªå®šä¹‰ç¬¬ä¸‰æ–¹æ’ä»¶ï¼Œæ•¬è¯·æœŸå¾…å§ğŸ˜„</p><h3 id="å‚è€ƒå’Œæ¨è"><a href="#å‚è€ƒå’Œæ¨è" class="headerlink" title="å‚è€ƒå’Œæ¨è"></a>å‚è€ƒå’Œæ¨è</h3><p><a href="https://juejin.cn/post/6950643579643494431#heading-14">è¡¥é½AndroidæŠ€èƒ½æ ‘ - ç©è½¬Gradle</a></p><p><a href="https://juejin.cn/post/6937208620337610766/#heading-31">Gradleå­¦ä¹ ç³»åˆ—ï¼ˆäºŒï¼‰ï¼šGradleæ ¸å¿ƒæ¢ç´¢</a></p><p><a href="https://juejin.cn/post/6844904122492125198#heading-26">æ·±åº¦æ¢ç´¢ Gradle è‡ªåŠ¨åŒ–æ„å»ºæŠ€æœ¯ï¼ˆä¸‰ã€Gradle æ ¸å¿ƒè§£å¯†ï¼‰</a></p><p><a href="https://juejin.cn/post/6982379643311489032#heading-15">ä»Gradleç”Ÿå‘½å‘¨æœŸåˆ°è‡ªå®šä¹‰TaskæŒ‚æ¥åˆ°Buildæ„å»ºæµç¨‹å…¨è§£</a></p><p><a href="https://juejin.cn/post/6947675376835362846#heading-1">7ä¸ªä½ åº”è¯¥çŸ¥é“çš„Gradleå®ç”¨æŠ€å·§</a></p><blockquote><p><strong>ä½ çš„ç‚¹èµï¼Œè¯„è®ºï¼Œæ˜¯å¯¹æˆ‘å·¨å¤§çš„é¼“åŠ±ï¼</strong></p><p>æ¬¢è¿å…³æ³¨æˆ‘çš„<strong>å…¬ä¼—å·ï¼š</strong>  <a href="http://m6z.cn/6jwi7b"><strong>sweetying</strong></a> ï¼Œæ–‡ç« æ›´æ–°å¯ç¬¬ä¸€æ—¶é—´æ”¶åˆ°</p><p>å¦‚æœ<strong>æœ‰é—®é¢˜</strong>ï¼Œå…¬ä¼—å·å†…æœ‰åŠ æˆ‘å¾®ä¿¡çš„å…¥å£ï¼Œåœ¨æŠ€æœ¯å­¦ä¹ ã€ä¸ªäººæˆé•¿çš„é“è·¯ä¸Šï¼Œæˆ‘ä»¬ä¸€èµ·å‰è¿›ï¼</p></blockquote>]]></content>
    
    
    <categories>
      
      <category>Android</category>
      
      <category>Gradle</category>
      
    </categories>
    
    
    <tags>
      
      <tag>åŸåˆ›</tag>
      
      <tag>Android</tag>
      
      <tag>Gradle</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Gradle ç³»åˆ— ï¼ˆä¸€ï¼‰ã€Gradleç›¸å…³æ¦‚å¿µç†è§£ï¼ŒGroovyåŸºç¡€</title>
    <link href="/2022/10/11/Gradle%20%E7%B3%BB%E5%88%97%20%EF%BC%88%E4%B8%80%EF%BC%89%E3%80%81Gradle%E7%9B%B8%E5%85%B3%E6%A6%82%E5%BF%B5%E7%90%86%E8%A7%A3%EF%BC%8CGroovy%E5%9F%BA%E7%A1%80/"/>
    <url>/2022/10/11/Gradle%20%E7%B3%BB%E5%88%97%20%EF%BC%88%E4%B8%80%EF%BC%89%E3%80%81Gradle%E7%9B%B8%E5%85%B3%E6%A6%82%E5%BF%B5%E7%90%86%E8%A7%A3%EF%BC%8CGroovy%E5%9F%BA%E7%A1%80/</url>
    
    <content type="html"><![CDATA[<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/4f912f1dfdee430ab27ecd69901ee77b~tplv-k3u1fbpfcp-watermark.image"></p><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>å¼•ç”¨ Gradle å®˜æ–¹ä¸€æ®µå¯¹Gradleçš„ä»‹ç»ï¼šGradle is an open-source build automation tool focused on flexibility and performance. Gradle build scripts are written using a Groovy or Kotlin DSL.ç¿»è¯‘è¿‡æ¥å°±æ˜¯ï¼š<strong>Gradle æ˜¯ä¸€ä¸ªå¼€æºçš„è‡ªåŠ¨åŒ–æ„å»ºå·¥å…·ï¼Œä¸“æ³¨äºçµæ´»æ€§å’Œæ€§èƒ½ã€‚Gradle æ„å»ºè„šæœ¬æ˜¯ä½¿ç”¨ Groovy æˆ– Kotlin DSL ç¼–å†™çš„ã€‚</strong> ä¹‹å‰å®˜ç½‘çš„ä»‹ç»æ˜¯è¯´ Gradle æ˜¯åŸºäº Groovy çš„ DSLï¼Œä¸ºå•¥ç°åœ¨åˆå¤šäº†ä¸ª Kotlin  å‘¢ï¼Ÿå› ä¸º Gradle ä»5.0å¼€å§‹ï¼Œå¼€å§‹æ”¯æŒäº† Kotlin DSLï¼Œç°åœ¨å·²ç»å‘å±•åˆ°äº†6.8.3ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ Groovy æˆ–è€… Kotlin æ¥ç¼–å†™ Gradleè„šæœ¬ã€‚Kotlin ç°ä½œä¸º Android ç¬¬ä¸€å¼€å‘è¯­è¨€ï¼Œé‡è¦æ€§ä¸è¨€è€Œå–»ï¼Œä½œä¸ºä¸€ä¸ª Androidå¼€å‘è€…ï¼ŒKotlin æ˜¯å¿…å­¦çš„ï¼Œåç»­æˆ‘ä¹Ÿä¼šå‡ºä¸ª Kotlin ç³»åˆ—æ–‡ç« ã€‚ä»Šå¤©æˆ‘ä»¬çš„é‡ç‚¹æ˜¯ä»‹ç»ä¸€äº› Gradle çš„ç›¸å…³æ¦‚å¿µï¼Œä»¥åŠå¯¹ Groovy è¯­è¨€çš„å­¦ä¹ </p><h2 id="ä¸€ã€é—®é¢˜"><a href="#ä¸€ã€é—®é¢˜" class="headerlink" title="ä¸€ã€é—®é¢˜"></a>ä¸€ã€é—®é¢˜</h2><p>æˆ‘å­¦ä¹ çŸ¥è¯†å–œæ¬¢ä»¥é—®é¢˜ä¸ºå¯¼å‘ï¼Œè¿™æ ·å¯ä»¥è®©æˆ‘æ˜ç¡®å­¦ä¹ çš„ç›®çš„ï¼Œæé«˜å­¦ä¹ æ•ˆç‡ï¼Œä¸‹é¢ä¹Ÿæ˜¯æˆ‘åœ¨å­¦ä¹  Gradle çš„è¿‡ç¨‹ä¸­ï¼Œç”±æµ…å…¥æ·±æ‰€äº§ç”Ÿçš„ä¸€äº›ç–‘é—®ï¼Œæˆ‘ä»¬éƒ½çŸ¥é“ï¼ŒAndroid åº”ç”¨æ˜¯ç”¨ Gradle æ„å»ºçš„ï¼Œåœ¨åˆšå¼€å‘ Android çš„æ—¶å€™æˆ‘ä¼šæƒ³ï¼š</p><p>1ã€ä»€ä¹ˆæ˜¯è‡ªåŠ¨åŒ–æ„å»ºå·¥å…·ï¼Ÿ</p><p>2ã€Gradle æ˜¯ä»€ä¹ˆï¼Ÿ</p><p>3ã€ä»€ä¹ˆæ˜¯ DSLï¼Ÿ</p><p>4ã€ä»€ä¹ˆæ˜¯ Groovyï¼Ÿ</p><p>5ã€Gradle å’Œ Groovy æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</p><p>6ã€é™æ€ç¼–ç¨‹è¯­è¨€å’ŒåŠ¨æ€ç¼–ç¨‹è¯­è¨€æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</p><p>å¸¦ç€è¿™äº›ç–‘é—®ï¼Œæˆ‘ä»¬ç»§ç»­å­¦ä¹ </p><h3 id="1ã€è‡ªåŠ¨åŒ–æ„å»ºå·¥å…·"><a href="#1ã€è‡ªåŠ¨åŒ–æ„å»ºå·¥å…·" class="headerlink" title="1ã€è‡ªåŠ¨åŒ–æ„å»ºå·¥å…·"></a>1ã€è‡ªåŠ¨åŒ–æ„å»ºå·¥å…·</h3><p>åœ¨ Android ä¸Šçš„ä½“ç°ï¼Œç®€å•çš„è¯´å°±æ˜¯è‡ªåŠ¨åŒ–çš„ç¼–è¯‘ã€æ‰“åŒ…ç¨‹åº</p><p>åœ¨ä¸Šå¤§å­¦å­¦ä¹  Java é‚£ä¼šï¼Œè€å¸ˆä¸ºäº†è®©æˆ‘ä»¬æ·±åˆ»çš„ä½“éªŒæ’¸ç çš„é­…åŠ›ï¼Œéƒ½æ˜¯é€šè¿‡æ–‡æœ¬ç›´æ¥æ•²ä»£ç çš„ï¼Œæ•²å®Œä¹‹åæŠŠæ‰©å±•åæ”¹æˆ<code>.java</code>åç¼€ï¼Œç„¶åé€šè¿‡<code>javac</code>å‘½ä»¤ç¼–è¯‘ï¼Œç¼–è¯‘é€šè¿‡åï¼Œåœ¨æ‰§è¡Œ<code>java</code>å‘½ä»¤å»è¿è¡Œï¼Œé‚£ä¹ˆè¿™ç§æ–‡ä»¶ä¸€å¤šï¼Œæˆ‘ä»¬æ¯æ¬¡éƒ½å¾—æ‰‹åŠ¨å»æ“ä½œï¼Œæ•ˆç‡ä¼šå¤§å¤§çš„é™ä½ï¼Œè¿™ä¸ªæ—¶å€™å°±å‡ºç°äº†è‡ªåŠ¨åŒ–ç¼–è¯‘å·¥å…·ï¼Œæˆ‘ä»¬åªéœ€è¦åœ¨ç¼–è¯‘å·¥å…·ä¸­ï¼Œç‚¹å‡»ç¼–è¯‘æŒ‰é’®ï¼Œç¼–è¯‘å®Œæˆåï¼Œæ— éœ€å…¶ä»–æ‰‹åŠ¨æ“ä½œï¼Œç¨‹åºå°±å¯ä»¥ç›´æ¥è¿è¡Œäº†ï¼Œè‡ªåŠ¨åŒ–ç¼–è¯‘å·¥å…·å°±æ˜¯æœ€æ—©çš„è‡ªåŠ¨åŒ–æ„å»ºå·¥å…·ã€‚é‚£ä¹ˆéšç€ä¸šåŠ¡åŠŸèƒ½çš„ä¸æ–­æ‰©å±•ï¼Œæˆ‘ä»¬çš„äº§å“éœ€è¦åŠ å…¥å¤šåª’ä½“èµ„æºï¼Œéœ€è¦æ‰“ä¸åŒçš„æ¸ é“åŒ…å‘å¸ƒåˆ°ä¸åŒçš„æ¸ é“ï¼Œé‚£å°±å¿…é¡»ä¾é è‡ªåŠ¨åŒ–æ„å»ºå·¥å…·ï¼Œè¦èƒ½æ”¯æŒå¹³å°ã€éœ€æ±‚ç­‰æ–¹é¢çš„å·®å¼‚ã€èƒ½æ·»åŠ è‡ªå®šä¹‰ä»»åŠ¡ã€ä¸“é—¨çš„ç”¨æ¥æ‰“åŒ…ç”Ÿæˆæœ€ç»ˆäº§å“çš„ä¸€ä¸ªç¨‹åºã€å·¥å…·ï¼Œè¿™ä¸ªå°±æ˜¯è‡ªåŠ¨åŒ–æ„å»ºå·¥å…·ã€‚è‡ªåŠ¨åŒ–æ„å»ºå·¥å…·æœ¬è´¨ä¸Šè¿˜æ˜¯ä¸€æ®µä»£ç ç¨‹åºã€‚è¿™å°±æ˜¯è‡ªåŠ¨åŒ–æ„å»ºå·¥å…·çš„ä¸€ä¸ªå‘å±•å†ç¨‹ï¼Œè‡ªåŠ¨åŒ–æ„å»ºå·¥å…·åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ä¸æ–­çš„å‘å±•å’Œä¼˜åŒ–</p><h3 id="2ã€Gradle-æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#2ã€Gradle-æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="2ã€Gradle æ˜¯ä»€ä¹ˆï¼Ÿ"></a>2ã€Gradle æ˜¯ä»€ä¹ˆï¼Ÿ</h3><p>ç†è§£äº†è‡ªåŠ¨åŒ–æ„å»ºå·¥å…·ï¼Œé‚£ä¹ˆç†è§£ Gradle å°±æ¯”è¾ƒç®€å•äº†ï¼Œè¿˜æ˜¯å¼•ç”¨å®˜æ–¹çš„é‚£ä¸€æ®µè¯ï¼š</p><p><strong>Gradle æ˜¯ä¸€ä¸ªå¼€æºçš„è‡ªåŠ¨åŒ–æ„å»ºå·¥å…·ï¼Œä¸“æ³¨äºçµæ´»æ€§å’Œæ€§èƒ½ã€‚Gradle æ„å»ºè„šæœ¬æ˜¯ä½¿ç”¨ Groovy æˆ– Kotlin DSL ç¼–å†™çš„ã€‚</strong></p><p>Gradle æ˜¯ Android çš„é»˜è®¤æ„å»ºå·¥å…·ï¼ŒAndroid é¡¹ç›®è¿™ä¹ˆå¤šä¸œè¥¿ï¼Œæ—¢æœ‰æˆ‘ä»¬è‡ªå·±å†™çš„ javaã€kotlinã€C++ã€Dart ä»£ç ï¼Œä¹Ÿæœ‰ç³»ç»Ÿè‡ªå·±çš„ javaã€Cï¼ŒC++ ä»£ç ï¼Œè¿˜æœ‰å¼•å…¥çš„ç¬¬ä¸‰æ–¹ä»£ç ï¼Œè¿˜æœ‰å¤šåª’ä½“èµ„æºï¼Œè¿™ä¹ˆå¤šä»£ç ã€èµ„æºæ‰“åŒ…æˆ APK æ–‡ä»¶è‚¯å®šè¦æœ‰ä¸€ä¸ªè§„èŒƒï¼Œå¹²è¿™ä¸ªæ´»çš„å°±æ˜¯æˆ‘ä»¬ç†Ÿæ‚‰çš„ gradle äº†ï¼Œæ€»è€Œè¨€ä¹‹ï¼ŒGradleå°±æ˜¯ä¸€ä¸ªå¸®æˆ‘ä»¬æ‰“åŒ… APK çš„å·¥å…·</p><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/249405f870924185987c118985a4cc69~tplv-k3u1fbpfcp-zoom-1.image" alt="gradle"></p><h3 id="3ã€ä»€ä¹ˆæ˜¯DSLï¼Ÿ"><a href="#3ã€ä»€ä¹ˆæ˜¯DSLï¼Ÿ" class="headerlink" title="3ã€ä»€ä¹ˆæ˜¯DSLï¼Ÿ"></a>3ã€ä»€ä¹ˆæ˜¯DSLï¼Ÿ</h3><p>DSLè‹±æ–‡å…¨ç§°ï¼š<strong>domain specific language</strong>ï¼Œä¸­æ–‡ç¿»è¯‘å³é¢†åŸŸç‰¹å®šè¯­è¨€ï¼Œä¾‹å¦‚ï¼šHTMLï¼ŒXMLç­‰ DSL è¯­è¨€</p><p><strong>ç‰¹ç‚¹</strong></p><ul><li>è§£å†³ç‰¹å®šé¢†åŸŸçš„ä¸“æœ‰é—®é¢˜</li><li>å®ƒä¸ç³»ç»Ÿç¼–ç¨‹è¯­è¨€èµ°çš„æ˜¯ä¸¤ä¸ªæç«¯ï¼Œç³»ç»Ÿç¼–ç¨‹è¯­è¨€æ˜¯å¸Œæœ›è§£å†³æ‰€æœ‰çš„é—®é¢˜ï¼Œæ¯”å¦‚ Java è¯­è¨€å¸Œæœ›èƒ½åš Android å¼€å‘ï¼Œåˆå¸Œæœ›èƒ½åšåå°å¼€å‘ï¼Œå®ƒå…·æœ‰æ¨ªå‘æ‰©å±•çš„ç‰¹æ€§ã€‚è€Œ DSL å…·æœ‰çºµå‘æ·±å…¥è§£å†³ç‰¹å®šé¢†åŸŸä¸“æœ‰é—®é¢˜çš„ç‰¹æ€§ã€‚</li></ul><p>æ€»çš„æ¥è¯´ï¼ŒDSL çš„<strong>æ ¸å¿ƒæ€æƒ³</strong>å°±æ˜¯ï¼šâ€œæ±‚ä¸“ä¸æ±‚å…¨ï¼Œè§£å†³ç‰¹å®šé¢†åŸŸçš„é—®é¢˜â€ã€‚</p><h3 id="4ã€ä»€ä¹ˆæ˜¯-Groovyï¼Ÿ"><a href="#4ã€ä»€ä¹ˆæ˜¯-Groovyï¼Ÿ" class="headerlink" title="4ã€ä»€ä¹ˆæ˜¯ Groovyï¼Ÿ"></a>4ã€ä»€ä¹ˆæ˜¯ Groovyï¼Ÿ</h3><p><strong>Groovy æ˜¯åŸºäº JVM çš„è„šæœ¬è¯­è¨€ï¼Œå®ƒæ˜¯åŸºäºJavaæ‰©å±•çš„åŠ¨æ€è¯­è¨€</strong></p><p>åŸºäº JVM çš„è¯­è¨€æœ‰å¾ˆå¤šç§ï¼Œå¦‚ï¼šGroovyï¼ŒKotlinï¼ŒJavaï¼ŒScalaç­‰ç­‰ï¼Œä»–ä»¬éƒ½æ‹¥æœ‰ä¸€ä¸ªå…±åŒçš„ç‰¹æ€§ï¼šæœ€ç»ˆéƒ½ä¼šç¼–è¯‘ç”Ÿæˆ Java å­—èŠ‚ç æ–‡ä»¶å¹¶åœ¨ JVM ä¸Šè¿è¡Œã€‚</p><p>å› ä¸º Groovy å°±æ˜¯å¯¹ Java çš„æ‰©å±•ï¼Œæ‰€ä»¥ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨å­¦ä¹  Java çš„æ–¹å¼å»å­¦ä¹  Groovy ã€‚ å­¦ä¹ æˆæœ¬ç›¸å¯¹æ¥è¯´è¿˜æ˜¯æ¯”è¾ƒä½çš„ï¼Œå³ä½¿å¼€å‘è¿‡ç¨‹ä¸­å¿˜è®° Groovy è¯­æ³•ï¼Œä¹Ÿå¯ä»¥ç”¨ Java è¯­æ³•ç»§ç»­ç¼–ç </p><h3 id="5ã€Gradle-å’Œ-Groovy-æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"><a href="#5ã€Gradle-å’Œ-Groovy-æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ" class="headerlink" title="5ã€Gradle å’Œ Groovy æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"></a>5ã€Gradle å’Œ Groovy æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</h3><p>Gradle æ˜¯åŸºäº Groovy çš„ä¸€ç§è‡ªåŠ¨åŒ–æ„å»ºå·¥å…·ï¼Œæ˜¯è¿è¡Œåœ¨JVMä¸Šçš„ä¸€ä¸ªç¨‹åºï¼ŒGroovyæ˜¯åŸºäºJVMçš„ä¸€ç§è¯­è¨€ï¼ŒGradle å’Œ Groovy çš„å…³ç³»å°±åƒ Android å’Œ Java çš„å…³ç³»ä¸€æ ·</p><h3 id="6ã€é™æ€ç¼–ç¨‹è¯­è¨€å’ŒåŠ¨æ€ç¼–ç¨‹è¯­è¨€æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"><a href="#6ã€é™æ€ç¼–ç¨‹è¯­è¨€å’ŒåŠ¨æ€ç¼–ç¨‹è¯­è¨€æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ" class="headerlink" title="6ã€é™æ€ç¼–ç¨‹è¯­è¨€å’ŒåŠ¨æ€ç¼–ç¨‹è¯­è¨€æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"></a>6ã€é™æ€ç¼–ç¨‹è¯­è¨€å’ŒåŠ¨æ€ç¼–ç¨‹è¯­è¨€æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</h3><p>é™æ€ç¼–ç¨‹è¯­è¨€æ˜¯åœ¨ç¼–è¯‘æœŸå°±è¦ç¡®å®šå˜é‡çš„æ•°æ®ç±»å‹ï¼Œè€ŒåŠ¨æ€ç¼–ç¨‹è¯­è¨€åˆ™æ˜¯åœ¨è¿è¡ŒæœŸç¡®å®šå˜é‡çš„æ•°æ®ç±»å‹ã€‚å°±åƒé™æ€ä»£ç†å’ŒåŠ¨æ€ä»£ç†ä¸€æ ·ï¼Œä¸€ä¸ªå¼ºè°ƒçš„æ˜¯ç¼–è¯‘æœŸï¼Œä¸€ä¸ªå¼ºè°ƒçš„æ˜¯è¿è¡ŒæœŸï¼Œå¸¸è§çš„é™æ€ç¼–ç¨‹è¯­è¨€æœ‰Javaï¼ŒKotlinç­‰ç­‰ï¼ŒåŠ¨æ€ç¼–ç¨‹è¯­è¨€æœ‰Groovyï¼ŒPythonç­‰è¯­è¨€ã€‚</p><h2 id="äºŒã€Groovy-å¼€å‘ç¯å¢ƒæ­å»ºä¸å·¥ç¨‹åˆ›å»º"><a href="#äºŒã€Groovy-å¼€å‘ç¯å¢ƒæ­å»ºä¸å·¥ç¨‹åˆ›å»º" class="headerlink" title="äºŒã€Groovy å¼€å‘ç¯å¢ƒæ­å»ºä¸å·¥ç¨‹åˆ›å»º"></a>äºŒã€Groovy å¼€å‘ç¯å¢ƒæ­å»ºä¸å·¥ç¨‹åˆ›å»º</h2><h3 id="1ã€åˆ°å®˜ç½‘ä¸‹è½½JDKå®‰è£…-å¹¶é…ç½®å¥½-JDK-ç¯å¢ƒ"><a href="#1ã€åˆ°å®˜ç½‘ä¸‹è½½JDKå®‰è£…-å¹¶é…ç½®å¥½-JDK-ç¯å¢ƒ" class="headerlink" title="1ã€åˆ°å®˜ç½‘ä¸‹è½½JDKå®‰è£…,å¹¶é…ç½®å¥½ JDK ç¯å¢ƒ"></a>1ã€åˆ°å®˜ç½‘ä¸‹è½½JDKå®‰è£…,å¹¶é…ç½®å¥½ JDK ç¯å¢ƒ</h3><ul><li><a href="https://www.oracle.com/hk/java/technologies/javase-downloads.html">JDKä¸‹è½½</a></li><li><a href="https://juejin.cn/post/6844903895504797710">JDKç¯å¢ƒå˜é‡æ­å»º</a></li></ul><h3 id="2ã€åˆ°å®˜ç½‘ä¸‹è½½å¥½-Groovy-SDKï¼Œå¹¶è§£å‹åˆ°åˆé€‚çš„ä½ç½®"><a href="#2ã€åˆ°å®˜ç½‘ä¸‹è½½å¥½-Groovy-SDKï¼Œå¹¶è§£å‹åˆ°åˆé€‚çš„ä½ç½®" class="headerlink" title="2ã€åˆ°å®˜ç½‘ä¸‹è½½å¥½ Groovy SDKï¼Œå¹¶è§£å‹åˆ°åˆé€‚çš„ä½ç½®"></a>2ã€åˆ°å®˜ç½‘ä¸‹è½½å¥½ Groovy SDKï¼Œå¹¶è§£å‹åˆ°åˆé€‚çš„ä½ç½®</h3><ul><li><a href="https://groovy.apache.org/download.html">Groovy SDK ä¸‹è½½é“¾æ¥</a></li></ul><h3 id="3ã€é…ç½®-Groovy-ç¯å¢ƒå˜é‡"><a href="#3ã€é…ç½®-Groovy-ç¯å¢ƒå˜é‡" class="headerlink" title="3ã€é…ç½® Groovy ç¯å¢ƒå˜é‡"></a>3ã€é…ç½® Groovy ç¯å¢ƒå˜é‡</h3><ul><li><a href="https://www.jianshu.com/p/b5f4b33c7c24">Groovy ç¯å¢ƒå˜é‡</a></li></ul><h3 id="4ã€åˆ°å®˜ç½‘ä¸‹è½½-IntelliJ-IDEA-å¼€å‘å·¥å…·å¹¶å®‰è£…"><a href="#4ã€åˆ°å®˜ç½‘ä¸‹è½½-IntelliJ-IDEA-å¼€å‘å·¥å…·å¹¶å®‰è£…" class="headerlink" title="4ã€åˆ°å®˜ç½‘ä¸‹è½½ IntelliJ IDEA å¼€å‘å·¥å…·å¹¶å®‰è£…"></a>4ã€åˆ°å®˜ç½‘ä¸‹è½½ IntelliJ IDEA å¼€å‘å·¥å…·å¹¶å®‰è£…</h3><ul><li><a href="https://www.jetbrains.com/idea/">IntelliJ IDEA å¼€å‘å·¥å…·ä¸‹è½½</a></li></ul><h3 id="5ã€åˆ›å»º-Groovy-å·¥ç¨‹å³å¯"><a href="#5ã€åˆ›å»º-Groovy-å·¥ç¨‹å³å¯" class="headerlink" title="5ã€åˆ›å»º Groovy å·¥ç¨‹å³å¯"></a>5ã€åˆ›å»º Groovy å·¥ç¨‹å³å¯</h3><p>å®Œæˆäº†ä¸Šè¿°4ä¸ªæ­¥éª¤ï¼Œæˆ‘ä»¬å¼€å§‹åˆ›å»ºä¸€ä¸ª Groovy å·¥ç¨‹ï¼š</p><p><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/5212e2c5be0b40d1948d0e4d0c4dd58a~tplv-k3u1fbpfcp-watermark.image" alt="image-20210314155550728 (1).png"></p><p>æŒ‰ç…§ä¸Šè¿°å›¾ç‰‡ä¸­æ­¥éª¤å³å¯å®Œæˆä¸€ä¸ª Groovy å·¥ç¨‹åˆ›å»ºï¼Œä¸‹é¢å°±å¯ä»¥ä½¿ç”¨ IntelliJ IDEA è¿™ä¸ªå·¥å…·æ¥å­¦ä¹  Groovy äº†ï¼Œæˆ‘ä¸‹é¢æ‰€æœ‰ä»£ç éƒ½æ˜¯åœ¨ IntelliJ IDEA ä¸Šè·‘çš„</p><p><strong>å°æŠ€å·§ï¼š</strong> ä½œä¸º Android å¼€å‘è€…ï¼Œæˆ‘ä»¬ä¸€èˆ¬éƒ½æ˜¯ä½¿ç”¨ AndroidStudio è¿›è¡Œå¼€å‘çš„ï¼Œä½†æ˜¯ AndroidStudio å¯¹äº Groovy æ”¯æŒä¸æ˜¯å¾ˆå‹å¥½ï¼Œå„ç§æ²¡æœ‰æç¤ºï¼Œæ¶‰åŠåˆ°é—­åŒ…ï¼Œä½ ä¹Ÿä¸çŸ¥é“é—­åŒ…çš„å‚æ•°æ˜¯å•¥ï¼Ÿå› æ­¤è¿™ä¸ªæ—¶å€™ï¼Œä½ å°±å¯ä»¥ä½¿ç”¨ IntelliJ IDEA å…ˆå¼„å¥½ï¼Œåœ¨å¤åˆ¶è¿‡å»ï¼ŒIntelliJ IDEA å¯¹Groovy çš„æ”¯æŒè¿˜æ˜¯å¾ˆå‹å¥½çš„</p><h2 id="ä¸‰ã€Groovy-åŸºç¡€è¯­æ³•"><a href="#ä¸‰ã€Groovy-åŸºç¡€è¯­æ³•" class="headerlink" title="ä¸‰ã€Groovy åŸºç¡€è¯­æ³•"></a>ä¸‰ã€Groovy åŸºç¡€è¯­æ³•</h2><p>å†æ¬¡å¼ºè°ƒ Groovy æ˜¯åŸºäº java æ‰©å±•çš„åŠ¨æ€è¯­è¨€ï¼Œç›´æ¥å†™ java ä»£ç æ˜¯æ²¡é—®é¢˜çš„ï¼Œæ—¢ç„¶å¦‚æ­¤ï¼ŒGroovy çš„ä¼˜åŠ¿åœ¨å“ªé‡Œå‘¢ï¼Ÿ</p><p>åœ¨äº Groovy æä¾›äº†æ›´åŠ çµæ´»ç®€å•çš„è¯­æ³•ï¼Œå¤§é‡çš„è¯­æ³•ç³–ä»¥åŠé—­åŒ…ç‰¹æ€§å¯ä»¥è®©ä½ ç”¨æ›´å°‘çš„ä»£ç æ¥å®ç°å’Œ Java åŒæ ·çš„åŠŸèƒ½ã€‚æ¯”å¦‚è§£æxmlæ–‡ä»¶ï¼ŒGroovy å°±éå¸¸æ–¹ä¾¿ï¼Œåªéœ€è¦å‡ è¡Œä»£ç å°±èƒ½æå®šï¼Œè€Œå¦‚æœç”¨ Java åˆ™éœ€è¦å‡ åè¡Œä»£ç ã€‚</p><h3 id="1ã€æ”¯æŒåŠ¨æ€ç±»å‹ï¼Œä½¿ç”¨-def-å…³é”®å­—æ¥å®šä¹‰ä¸€ä¸ªå˜é‡"><a href="#1ã€æ”¯æŒåŠ¨æ€ç±»å‹ï¼Œä½¿ç”¨-def-å…³é”®å­—æ¥å®šä¹‰ä¸€ä¸ªå˜é‡" class="headerlink" title="1ã€æ”¯æŒåŠ¨æ€ç±»å‹ï¼Œä½¿ç”¨ def å…³é”®å­—æ¥å®šä¹‰ä¸€ä¸ªå˜é‡"></a>1ã€æ”¯æŒåŠ¨æ€ç±»å‹ï¼Œä½¿ç”¨ def å…³é”®å­—æ¥å®šä¹‰ä¸€ä¸ªå˜é‡</h3><p>åœ¨ Groovy ä¸­å¯ä»¥ä½¿ç”¨ def å…³é”®å­—å®šä¹‰ä¸€ä¸ªå˜é‡ï¼Œå½“ç„¶ Java é‡Œé¢å®šä¹‰æ•°æ®ç±»å‹çš„æ–¹å¼ï¼Œåœ¨ Groovy ä¸­éƒ½èƒ½ç”¨</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs groovy"><span class="hljs-comment">//Java ä¸­ï¼Œæˆ‘ä»¬ä¸€èˆ¬ä¼šè¿™ä¹ˆå®šä¹‰</span><br><span class="hljs-type">int</span> age = <span class="hljs-number">16</span><br>String name = <span class="hljs-string">&quot;erdai&quot;</span><br><br><span class="hljs-comment">//Groovy ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥è¿™æ ·å®šä¹‰ï¼Œåœ¨å˜é‡èµ‹å€¼åï¼ŒGroovy ç¼–è¯‘å™¨ä¼šæ¨æ–­å‡ºå˜é‡çš„å®é™…ç±»å‹</span><br><span class="hljs-keyword">def</span> age = <span class="hljs-number">16</span><br><span class="hljs-keyword">def</span> name = <span class="hljs-string">&#x27;erdai&#x27;</span><br></code></pre></td></tr></table></figure><h3 id="2ã€ä¸ç”¨å†™-å·"><a href="#2ã€ä¸ç”¨å†™-å·" class="headerlink" title="2ã€ä¸ç”¨å†™ ; å·"></a>2ã€ä¸ç”¨å†™ ; å·</h3><p>ç°åœ¨æ¯”è¾ƒæ–°çš„è¯­è¨€éƒ½ä¸ç”¨å†™ï¼Œå¦‚ Kotlin</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs groovy"><span class="hljs-keyword">def</span> age = <span class="hljs-number">16</span><br><span class="hljs-keyword">def</span> name = <span class="hljs-string">&#x27;erdai&#x27;</span><br></code></pre></td></tr></table></figure><h3 id="3ã€æ²¡æœ‰åŸºæœ¬æ•°æ®ç±»å‹äº†ï¼Œå…¨æ˜¯å¼•ç”¨ç±»å‹"><a href="#3ã€æ²¡æœ‰åŸºæœ¬æ•°æ®ç±»å‹äº†ï¼Œå…¨æ˜¯å¼•ç”¨ç±»å‹" class="headerlink" title="3ã€æ²¡æœ‰åŸºæœ¬æ•°æ®ç±»å‹äº†ï¼Œå…¨æ˜¯å¼•ç”¨ç±»å‹"></a>3ã€æ²¡æœ‰åŸºæœ¬æ•°æ®ç±»å‹äº†ï¼Œå…¨æ˜¯å¼•ç”¨ç±»å‹</h3><p>ä¸Šé¢è¯´åˆ°ï¼Œå®šä¹‰ä¸€ä¸ªå˜é‡ä½¿ç”¨ def å…³é”®å­—ï¼Œä½†æ˜¯ Groovy æ˜¯åŸºäº Java æ‰©å±•çš„ï¼Œå› æ­¤æˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨ Java é‡Œé¢çš„ç±»å‹ï¼Œå¦‚ Java ä¸­8å¤§åŸºæœ¬ç±»å‹ï¼šbyte , short , int , long , float , double ï¼Œcharï¼Œboolean</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs gas">//å®šä¹‰8å¤§åŸºæœ¬ç±»å‹<br>byte mByte = 1<br>short mShort = 2<br>int mInt = 3<br>long mLong = 4<br>float mFloat = 5<br>double mDouble = 6<br>char mChar = &#x27;a&#x27;<br>boolean mBoolean = true<br>//å¯¹ç±»å‹è¿›è¡Œæ‰“å°<br>println(mByte.class)<br>println(mShort.class)<br>println(mInt.class)<br>println(mLong.class)<br>println(mFloat.class)<br>println(mDouble.class)<br>println(mChar.class)<br>println(mBoolean.class)<br><br>//æ‰“å°ç»“æœå¦‚ä¸‹:<br>class java.lang.Byte<br>class java.lang.Short<br>class java.lang.Integer<br>class java.lang.Long<br>class java.lang.Float<br>class java.lang.Double<br>class java.lang.Character<br>class java.lang.Boolean<br></code></pre></td></tr></table></figure><p>å› æ­¤æˆ‘ä»¬å¯ä»¥å¾—å‡ºç»“è®ºï¼š<strong>Groovyä¸­æ²¡æœ‰åŸºæœ¬æ•°æ®ç±»å‹ï¼Œå…¨æ˜¯å¼•ç”¨ç±»å‹ï¼Œå³ä½¿å®šä¹‰äº†åŸºç¡€ç±»å‹ï¼Œä¹Ÿä¼šè¢«è½¬æ¢æˆå¯¹åº”çš„åŒ…è£…ç±»</strong></p><h3 id="4ã€æ–¹æ³•å˜åŒ–"><a href="#4ã€æ–¹æ³•å˜åŒ–" class="headerlink" title="4ã€æ–¹æ³•å˜åŒ–"></a>4ã€æ–¹æ³•å˜åŒ–</h3><p>1ã€ä½¿ç”¨ def å…³é”®å­—å®šä¹‰ä¸€ä¸ªæ–¹æ³•ï¼Œæ–¹æ³•ä¸éœ€è¦æŒ‡å®šè¿”å›å€¼ç±»å‹ï¼Œå‚æ•°ç±»å‹ï¼Œæ–¹æ³•ä½“å†…çš„æœ€åä¸€è¡Œä¼šè‡ªåŠ¨ä½œä¸ºè¿”å›å€¼ï¼Œè€Œä¸éœ€è¦returnå…³é”®å­—</p><p>2ã€æ–¹æ³•è°ƒç”¨å¯ä»¥ä¸å†™ () ï¼Œæœ€å¥½è¿˜æ˜¯åŠ ä¸Š () çš„å¥½ï¼Œä¸ç„¶å¯è¯»æ€§ä¸å¥½</p><p>3ã€å®šä¹‰æ–¹æ³•æ—¶ï¼Œå¦‚æœå‚æ•°æ²¡æœ‰è¿”å›å€¼ç±»å‹ï¼Œæˆ‘ä»¬å¯ä»¥çœç•¥ defï¼Œä½¿ç”¨ void å³å¯</p><p>4ã€å®é™…ä¸Šä¸ç®¡æœ‰æ²¡æœ‰è¿”å›å€¼ï¼ŒGroovy ä¸­è¿”å›çš„éƒ½æ˜¯ Object ç±»å‹</p><p>5ã€ç±»çš„æ„é€ æ–¹æ³•ï¼Œé¿å…æ·»åŠ  def å…³é”®å­—</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs groovy"><span class="hljs-keyword">def</span> sum(a,b)&#123;<br>    a + b<br>&#125;<br><span class="hljs-keyword">def</span> sum = sum(<span class="hljs-number">1</span>,<span class="hljs-number">2</span>) <span class="hljs-comment">//è¿˜å¯ä»¥å†™æˆè¿™æ ·ï¼Œä½†æ˜¯å¯è¯»æ€§ä¸å¥½ def sum = sum 1,2 </span><br>println(sum)<br><br><span class="hljs-comment">//æ‰“å°ç»“æœ</span><br><span class="hljs-number">3</span><br><br><span class="hljs-comment">//å¦‚æœæ–¹æ³•æ²¡æœ‰è¿”å›å€¼ï¼Œæˆ‘ä»¬å¯ä»¥è¿™æ ·å†™ï¼š</span><br><span class="hljs-type">void</span> doSomething(param1, param2) &#123;<br>  <br>&#125;<br><br><span class="hljs-comment">//ç±»çš„æ„é€ æ–¹æ³•ï¼Œé¿å…æ·»åŠ  def å…³é”®å­—</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyClass</span> &#123;<br>    MyClass() &#123;<br>      <br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="5ã€å­—ç¬¦ä¸²å˜åŒ–"><a href="#5ã€å­—ç¬¦ä¸²å˜åŒ–" class="headerlink" title="5ã€å­—ç¬¦ä¸²å˜åŒ–"></a>5ã€å­—ç¬¦ä¸²å˜åŒ–</h3><p>åœ¨ Groovy ä¸­æœ‰ä¸‰ç§å¸¸ç”¨çš„å­—ç¬¦ä¸²å®šä¹‰æ–¹å¼ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><p>è¿™é‡Œå…ˆè§£é‡Šä¸€ä¸‹å¯æ‰©å±•å­—ç¬¦ä¸²çš„å«ä¹‰ï¼Œå¯æ‰©å±•å­—ç¬¦ä¸²å°±æ˜¯<strong>å­—ç¬¦ä¸²é‡Œé¢å¯ä»¥å¼•ç”¨å˜é‡ï¼Œè¡¨è¾¾å¼ç­‰ç­‰</strong></p><p>1 ã€å•å¼•å· â€˜â€™ å®šä¹‰çš„å­—ç¬¦ä¸²ä¸ºä¸å¯æ‰©å±•å­—ç¬¦ä¸²</p><p>2 ã€åŒå¼•å· â€œâ€ å®šä¹‰çš„å­—ç¬¦ä¸²ä¸ºå¯æ‰©å±•å­—ç¬¦ä¸²ï¼Œå¯æ‰©å±•å­—ç¬¦ä¸²é‡Œé¢å¯ä»¥ä½¿ç”¨ ${} å¼•ç”¨å˜é‡å€¼ï¼Œå½“ {} é‡Œé¢åªæœ‰ä¸€ä¸ªå˜é‡ï¼Œéè¡¨è¾¾å¼æ—¶ï¼Œ{}ä¹Ÿå¯ä»¥å»æ‰</p><p>3 ã€ä¸‰å¼•å· â€˜â€™â€™ â€˜â€™â€™ å®šä¹‰çš„å­—ç¬¦ä¸²ä¸ºè¾“å‡ºå¸¦æ ¼å¼çš„ä¸å¯æ‰©å±•å­—ç¬¦ä¸²</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs groovy"><span class="hljs-keyword">def</span> age = <span class="hljs-number">16</span><br><span class="hljs-keyword">def</span> name = <span class="hljs-string">&#x27;erdai&#x27;</span><br><span class="hljs-comment">//å®šä¹‰ä¸€ä¸ªä¸å¯æ‰©å±•å­—ç¬¦ä¸²ï¼Œå’Œæˆ‘é—¨åœ¨Javaä¸­ä½¿ç”¨å·®ä¸å¤š</span><br><span class="hljs-keyword">def</span> str1 = <span class="hljs-string">&#x27;hello &#x27;</span> + name<br><span class="hljs-comment">//å®šä¹‰å¯æ‰©å±•å­—ç¬¦ä¸²ï¼Œå­—ç¬¦ä¸²é‡Œé¢å¯ä»¥å¼•ç”¨å˜é‡å€¼ï¼Œå½“ &#123;&#125; é‡Œé¢åªæœ‰ä¸€ä¸ªå˜é‡æ—¶ï¼Œ&#123;&#125;ä¹Ÿå¯ä»¥å»æ‰</span><br><span class="hljs-keyword">def</span> str2 = <span class="hljs-string">&quot;hello $name $&#123;name + age&#125;&quot;</span><br><span class="hljs-comment">//å®šä¹‰å¸¦è¾“å‡ºæ ¼å¼çš„ä¸å¯æ‰©å±•å­—ç¬¦ä¸² ä½¿ç”¨ \ å­—ç¬¦æ¥åˆ†è¡Œ</span><br><span class="hljs-keyword">def</span> str3 = <span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">\</span><br><span class="hljs-string">hello</span><br><span class="hljs-string">name</span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-comment">//æ‰“å°ç±»å‹å’Œå€¼ ä¸‹é¢ä»£ç æˆ‘çœç•¥äº† println æ–¹æ³•çš„ï¼ˆï¼‰ï¼Œä¸Šé¢æœ‰è®²åˆ°è¿™ç§è¯­æ³•ä¹Ÿæ˜¯å…è®¸çš„</span><br>println <span class="hljs-string">&#x27;str1ç±»å‹: &#x27;</span> + str1.<span class="hljs-keyword">class</span><br><span class="hljs-title class_">println</span> <span class="hljs-string">&#x27;str1è¾“å‡ºå€¼: &#x27;</span> + str1<br>println <span class="hljs-string">&#x27;str2ç±»å‹: &#x27;</span> + str2.<span class="hljs-keyword">class</span><br><span class="hljs-title class_">println</span> <span class="hljs-string">&#x27;str2è¾“å‡ºå€¼: &#x27;</span> + str2<br>println <span class="hljs-string">&#x27;str3ç±»å‹: &#x27;</span> + str3.<span class="hljs-keyword">class</span><br><span class="hljs-title class_">println</span> <span class="hljs-string">&#x27;str3è¾“å‡ºå€¼: &#x27;</span> + str3<br><br><span class="hljs-comment">//æ‰“å°ç»“æœ</span><br>str1ç±»å‹: <span class="hljs-keyword">class</span> <span class="hljs-title class_">java</span>.lang.String<br>str1è¾“å‡ºå€¼: hello erdai<br>str2ç±»å‹: <span class="hljs-keyword">class</span> <span class="hljs-title class_">org</span>.codehaus.groovy.runtime.GStringImpl<br>str2è¾“å‡ºå€¼: hello erdai erdai16<br>str3ç±»å‹: <span class="hljs-keyword">class</span> <span class="hljs-title class_">java</span>.lang.String<br>str3è¾“å‡ºå€¼: <br>hello<br>name<br></code></pre></td></tr></table></figure><p>ä»ä¸Šé¢ä»£ç æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œstr2 æ˜¯ GStringImpl ç±»å‹çš„ï¼Œè€Œ str1 å’Œ str3 æ˜¯ String ç±»å‹çš„ï¼Œé‚£ä¹ˆè¿™é‡Œæˆ‘å°±ä¼šæœ‰ä¸ªç–‘é—®ï¼Œè¿™ä¸¤ç§ç±»å‹åœ¨ç›¸äº’èµ‹å€¼çš„æƒ…å†µä¸‹æ˜¯å¦éœ€è¦å¼ºè½¬å‘¢ï¼Ÿæˆ‘ä»¬åšä¸ªå®éªŒåœ¨æµ‹è¯•ä¸‹ï¼š</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs groovy"><span class="hljs-comment">//å®šä¹‰ä¸€ä¸ª String ç±»å‹çš„å˜é‡æ¥æ”¶ GStringImpl ç±»å‹çš„å˜é‡ï¼Œå¹¶æ²¡æœ‰å¼ºè½¬</span><br>String str4 = str2<br>println <span class="hljs-string">&#x27;str4ç±»å‹: &#x27;</span> + str4.<span class="hljs-keyword">class</span><br><span class="hljs-title class_">println</span> <span class="hljs-string">&#x27;str4è¾“å‡ºå€¼: &#x27;</span> + str4<br><br><span class="hljs-comment">//æ‰“å°ç±»å‹å’Œå€¼</span><br>str4ç±»å‹: <span class="hljs-keyword">class</span> <span class="hljs-title class_">java</span>.lang.String<br>str4è¾“å‡ºå€¼: hello erdai erdai16<br></code></pre></td></tr></table></figure><p>å› æ­¤æˆ‘ä»¬å¯ä»¥å¾—å‡ºç»“è®ºï¼š<strong>ç¼–ç çš„è¿‡ç¨‹ä¸­ï¼Œä¸éœ€è¦ç‰¹åˆ«å…³æ³¨ String å’Œ GString çš„åŒºåˆ«ï¼Œç¼–è¯‘å™¨ä¼šå¸®åŠ©æˆ‘ä»¬è‡ªåŠ¨è½¬æ¢ç±»å‹</strong>ã€‚</p><h3 id="6-ä¸ç”¨å†™-get-å’Œ-set-æ–¹æ³•"><a href="#6-ä¸ç”¨å†™-get-å’Œ-set-æ–¹æ³•" class="headerlink" title="6. ä¸ç”¨å†™ get å’Œ set æ–¹æ³•"></a>6. ä¸ç”¨å†™ get å’Œ set æ–¹æ³•</h3><p>1ã€åœ¨æˆ‘ä»¬åˆ›å»ºå±æ€§çš„æ—¶å€™ï¼ŒGroovyä¼šå¸®æˆ‘ä»¬è‡ªåŠ¨åˆ›å»º get å’Œ set æ–¹æ³•</p><p>2ã€å½“æˆ‘ä»¬åªå®šä¹‰äº†ä¸€ä¸ªå±æ€§çš„ get æ–¹æ³•ï¼Œè€Œæ²¡æœ‰å®šä¹‰è¿™ä¸ªå±æ€§ï¼Œé»˜è®¤è¿™ä¸ªå±æ€§åªè¯»</p><p>3ã€æˆ‘ä»¬åœ¨ä½¿â½¤å¯¹è±¡ object.field æ¥è·å–å€¼æˆ–è€…ä½¿ç”¨ object.field &#x3D; value æ¥èµ‹å€¼çš„æ—¶å€™ï¼Œå®é™…ä¸Šä¼šè‡ªåŠ¨è½¬è€Œè°ƒâ½¤ object.getField() å’Œ object.setField(value) æ–¹æ³•ï¼Œå¦‚æœæˆ‘ä»¬ä¸æƒ³è°ƒç”¨è¿™ä¸ªç‰¹æ®Šçš„ get æ–¹æ³•æ—¶åˆ™å¯ä»¥ä½¿ç”¨ .@ ç›´æ¥åŸŸè®¿é—®æ“ä½œç¬¦è®¿é—®å±æ€§æœ¬èº«</p><p>æˆ‘ä»¬æ¥æ¨¡æ‹Ÿ1ï¼Œ2ï¼Œ3è¿™ä¸‰ç§æƒ…å†µ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//æƒ…å†µ1ï¼šåœ¨æˆ‘ä»¬åˆ›å»ºå±æ€§çš„æ—¶å€™ï¼ŒGroovyä¼šå¸®æˆ‘ä»¬è‡ªåŠ¨åˆ›å»º get å’Œ set æ–¹æ³•</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">People</span>&#123;<br>    def name<br>    def age<br>&#125;<br><br><span class="hljs-type">def</span> <span class="hljs-variable">people</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">People</span>()<br>people.name = <span class="hljs-string">&#x27;erdai&#x27;</span><br>people.age = <span class="hljs-number">19</span><br>println <span class="hljs-string">&quot;å§“å: $people.name å¹´é¾„: $people.age&quot;</span><br><span class="hljs-comment">//æ‰“å°ç»“æœ</span><br>å§“å: erdai å¹´é¾„: <span class="hljs-number">19</span><br>  <br><span class="hljs-comment">//æƒ…å†µ2 å½“æˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªå±æ€§çš„ get æ–¹æ³•ï¼Œè€Œæ²¡æœ‰å®šä¹‰è¿™ä¸ªå±æ€§ï¼Œé»˜è®¤è¿™ä¸ªå±æ€§åªè¯»</span><br><span class="hljs-comment">//æˆ‘ä»¬ä¿®æ”¹ä¸€ä¸‹Peopleç±»</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">People</span>&#123;<br>    def name<br>    def <span class="hljs-title function_">getAge</span><span class="hljs-params">()</span>&#123;<br>        <span class="hljs-number">12</span><br>    &#125;<br>&#125;<br><br><span class="hljs-type">def</span> <span class="hljs-variable">people</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">People</span>()<br>people.name = <span class="hljs-string">&#x27;erdai&#x27;</span><br>people.age = <span class="hljs-number">19</span><br>println <span class="hljs-string">&quot;å§“å: $people.name å¹´é¾„: $people.age&quot;</span><br><span class="hljs-comment">//è¿è¡Œä¸€ä¸‹ä»£ç  æ‰“å°ç»“æœæŠ¥é”™äº†ï¼Œå¦‚ä¸‹ï¼š</span><br>Caught: groovy.lang.ReadOnlyPropertyException: Cannot set readonly property: age <span class="hljs-keyword">for</span> class: variable.People<br><span class="hljs-comment">//å¤§æ¦‚é”™è¯¯æ„æ€å°±æ˜¯æˆ‘ä»¬ä¸èƒ½ä¿®æ”¹ä¸€ä¸ªåªè¯»çš„å±æ€§</span><br>  <br><span class="hljs-comment">//æƒ…å†µ3: å¦‚æœæˆ‘ä»¬ä¸æƒ³è°ƒç”¨è¿™ä¸ªç‰¹æ®Šçš„ get æ–¹æ³•æ—¶åˆ™å¯ä»¥ä½¿ç”¨ .@ ç›´æ¥åŸŸè®¿é—®æ“ä½œç¬¦è®¿é—®å±æ€§æœ¬èº«</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">People</span>&#123;<br>    def name<br>    def age<br>    <br>    def <span class="hljs-title function_">getName</span><span class="hljs-params">()</span>&#123;<br>        <span class="hljs-string">&quot;My name is $name&quot;</span><br>    &#125;<br>&#125;<br><span class="hljs-comment">//è¿™é‡Œä½¿ç”¨äº†å‘½åçš„å‚æ•°åˆå§‹åŒ–å’Œé»˜è®¤çš„æ„é€ å™¨åˆ›å»ºpeopleå¯¹è±¡ï¼Œåé¢ä¼šè®²åˆ°</span><br><span class="hljs-type">def</span> <span class="hljs-variable">people</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">People</span>(name: <span class="hljs-string">&#x27;erdai666&#x27;</span>)<br>people.age = <span class="hljs-number">19</span><br><span class="hljs-type">def</span> <span class="hljs-variable">myName</span> <span class="hljs-operator">=</span> people.<span class="hljs-meta">@name</span><br><br><span class="hljs-comment">//æ‰“å°å€¼</span><br>println myName<br>println <span class="hljs-string">&quot;å§“å: $people.name å¹´é¾„: $people.age&quot;</span><br>  <br><span class="hljs-comment">//æ‰“å°ç»“æœ</span><br>erdai666<br>å§“å: My name is erdai666 å¹´é¾„: <span class="hljs-number">19</span><br><span class="hljs-comment">//çœ‹åˆ°åŒºåˆ«äº†å—ï¼Ÿä½¿ç”¨ people.name åˆ™ä¼šå»è°ƒç”¨è¿™ä¸ªå±æ€§çš„getæ–¹æ³•ï¼Œè€Œ people.@name åˆ™ä¼šè®¿é—®è¿™ä¸ªå±æ€§æœ¬èº«</span><br></code></pre></td></tr></table></figure><h3 id="7ã€Class-æ˜¯ä¸€ç­‰å…¬æ°‘ï¼Œæ‰€æœ‰çš„-Class-ç±»å‹å¯ä»¥çœç•¥-Class"><a href="#7ã€Class-æ˜¯ä¸€ç­‰å…¬æ°‘ï¼Œæ‰€æœ‰çš„-Class-ç±»å‹å¯ä»¥çœç•¥-Class" class="headerlink" title="7ã€Class æ˜¯ä¸€ç­‰å…¬æ°‘ï¼Œæ‰€æœ‰çš„ Class ç±»å‹å¯ä»¥çœç•¥ .Class"></a>7ã€Class æ˜¯ä¸€ç­‰å…¬æ°‘ï¼Œæ‰€æœ‰çš„ Class ç±»å‹å¯ä»¥çœç•¥ .Class</h3><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs groovy"><span class="hljs-comment">//å®šä¹‰ä¸€ä¸ªTestç±»</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Test</span>&#123; <br><br>&#125;<br><br><span class="hljs-comment">//å®šä¹‰ä¸€ä¸ªæµ‹è¯•classçš„æ–¹æ³•ï¼Œä»å‰é¢çš„è¯­æ³•æˆ‘ä»¬çŸ¥é“ï¼Œæ–¹æ³•çš„å‚æ•°ç±»å‹æ˜¯å¯ä»¥çœç•¥çš„</span><br><span class="hljs-keyword">def</span> testClass(myClass)&#123;<br>    <br>&#125;<br><br><span class="hljs-comment">//æµ‹è¯•</span><br>testClass(Test.<span class="hljs-keyword">class</span>)<br>testClass(Test)<br></code></pre></td></tr></table></figure><h3 id="8ã€-x3D-x3D-å’Œ-equals"><a href="#8ã€-x3D-x3D-å’Œ-equals" class="headerlink" title="8ã€&#x3D;&#x3D; å’Œ equals"></a>8ã€&#x3D;&#x3D; å’Œ equals</h3><p>åœ¨ Groovy ä¸­ï¼Œ&#x3D;&#x3D; å°±ç›¸å½“äº Java çš„ equalsï¼Œå¦‚æœéœ€è¦æ¯”è¾ƒä¸¤ä¸ªå¯¹è±¡æ˜¯å¦æ˜¯åŒä¸€ä¸ªï¼Œéœ€è¦ä½¿ç”¨ .is()</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs groovy"><span class="hljs-keyword">class</span> <span class="hljs-title class_">People</span>&#123;<br>    <span class="hljs-keyword">def</span> name<br>    <span class="hljs-keyword">def</span> age<br>&#125;<br><br><span class="hljs-keyword">def</span> people1 = <span class="hljs-keyword">new</span> People(<span class="hljs-attr">name:</span> <span class="hljs-string">&#x27;erdai666&#x27;</span>)<br><span class="hljs-keyword">def</span> people2 = <span class="hljs-keyword">new</span> People(<span class="hljs-attr">name:</span> <span class="hljs-string">&#x27;erdai666&#x27;</span>)<br><br>println(<span class="hljs-string">&quot;people1.name == people2.name is: &quot;</span> + (people1.name == people2.name))<br>println(<span class="hljs-string">&quot;people1 is people2 is: &quot;</span> + people1.is(people2))<br><br><span class="hljs-comment">//æ‰“å°ç»“æœ</span><br>people1.name == people2.name <span class="hljs-attr">is:</span> <span class="hljs-literal">true</span><br>people1 is people2 <span class="hljs-attr">is:</span> <span class="hljs-literal">false</span><br></code></pre></td></tr></table></figure><h3 id="9ã€ä½¿ç”¨-assert-æ¥è®¾ç½®æ–­è¨€ï¼Œå½“æ–­è¨€çš„æ¡ä»¶ä¸º-false-æ—¶ï¼Œç¨‹åºå°†ä¼šæŠ›å‡ºå¼‚å¸¸"><a href="#9ã€ä½¿ç”¨-assert-æ¥è®¾ç½®æ–­è¨€ï¼Œå½“æ–­è¨€çš„æ¡ä»¶ä¸º-false-æ—¶ï¼Œç¨‹åºå°†ä¼šæŠ›å‡ºå¼‚å¸¸" class="headerlink" title="9ã€ä½¿ç”¨ assert æ¥è®¾ç½®æ–­è¨€ï¼Œå½“æ–­è¨€çš„æ¡ä»¶ä¸º false æ—¶ï¼Œç¨‹åºå°†ä¼šæŠ›å‡ºå¼‚å¸¸"></a>9ã€ä½¿ç”¨ assert æ¥è®¾ç½®æ–­è¨€ï¼Œå½“æ–­è¨€çš„æ¡ä»¶ä¸º false æ—¶ï¼Œç¨‹åºå°†ä¼šæŠ›å‡ºå¼‚å¸¸</h3><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs groovy"><span class="hljs-keyword">assert</span>  <span class="hljs-number">2</span> ** <span class="hljs-number">4</span> == <span class="hljs-number">15</span><br><span class="hljs-comment">//è¿è¡Œç¨‹åºï¼ŒæŠ¥é”™äº†ï¼Œç»“æœå¦‚ä¸‹ï¼š</span><br><span class="hljs-attr">Caught:</span> Assertion <span class="hljs-attr">failed:</span> <br><span class="hljs-keyword">assert</span>  <span class="hljs-number">2</span> ** <span class="hljs-number">4</span> == <span class="hljs-number">15</span><br>          |    |<br>          <span class="hljs-number">16</span>   <span class="hljs-literal">false</span><br></code></pre></td></tr></table></figure><h3 id="10ã€æ”¯æŒ-æ¬¡æ–¹è¿ç®—ç¬¦"><a href="#10ã€æ”¯æŒ-æ¬¡æ–¹è¿ç®—ç¬¦" class="headerlink" title="10ã€æ”¯æŒ ** æ¬¡æ–¹è¿ç®—ç¬¦"></a>10ã€æ”¯æŒ ** æ¬¡æ–¹è¿ç®—ç¬¦</h3><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs groovy"><span class="hljs-keyword">assert</span>  <span class="hljs-number">2</span> ** <span class="hljs-number">4</span> == <span class="hljs-number">16</span><br></code></pre></td></tr></table></figure><h3 id="11ã€ç®€æ´çš„ä¸‰å…ƒè¡¨è¾¾å¼"><a href="#11ã€ç®€æ´çš„ä¸‰å…ƒè¡¨è¾¾å¼" class="headerlink" title="11ã€ç®€æ´çš„ä¸‰å…ƒè¡¨è¾¾å¼"></a>11ã€ç®€æ´çš„ä¸‰å…ƒè¡¨è¾¾å¼</h3><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs groovy"><span class="hljs-comment">//åœ¨javaä¸­ï¼Œæˆ‘ä»¬ä¼šè¿™ä¹ˆå†™</span><br>String str = obj != <span class="hljs-literal">null</span> ? obj : <span class="hljs-string">&quot;&quot;</span><br><br><span class="hljs-comment">//åœ¨Groovyä¸­ï¼Œæˆ‘ä»¬å¯ä»¥è¿™æ ·å†™ï¼Œ?: æ“ä½œç¬¦è¡¨ç¤ºå¦‚æœå·¦è¾¹ç»“æœä¸ä¸ºç©ºåˆ™å–å·¦è¾¹çš„å€¼ï¼Œå¦åˆ™å–å³è¾¹çš„å€¼</span><br>String str = obj ?: <span class="hljs-string">&quot;&quot;</span><br></code></pre></td></tr></table></figure><h3 id="12ã€ç®€æ´çš„éç©ºåˆ¤æ–­"><a href="#12ã€ç®€æ´çš„éç©ºåˆ¤æ–­" class="headerlink" title="12ã€ç®€æ´çš„éç©ºåˆ¤æ–­"></a>12ã€ç®€æ´çš„éç©ºåˆ¤æ–­</h3><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs groovy"><span class="hljs-comment">//åœ¨javaä¸­ï¼Œæˆ‘ä»¬å¯èƒ½ä¼šè¿™ä¹ˆå†™</span><br><span class="hljs-keyword">if</span>(obj != <span class="hljs-literal">null</span>)&#123;<br>    <span class="hljs-keyword">if</span>(obj.group != <span class="hljs-literal">null</span>)&#123;<br>        <span class="hljs-keyword">if</span>(obj.group.artifact != <span class="hljs-literal">null</span>)&#123;<br>            <span class="hljs-comment">//do something</span><br>        &#125;<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">//åœ¨Groovyä¸­ï¼Œæˆ‘ä»¬å¯ä»¥è¿™æ ·å†™ ?. æ“ä½œç¬¦è¡¨ç¤ºå¦‚æœå½“å‰è°ƒç”¨å¯¹è±¡ä¸ºç©ºå°±ä¸æ‰§è¡Œäº†</span><br>obj?.group?.artifact<br><br></code></pre></td></tr></table></figure><h3 id="13ã€å¼ºå¤§çš„-Switch"><a href="#13ã€å¼ºå¤§çš„-Switch" class="headerlink" title="13ã€å¼ºå¤§çš„ Switch"></a>13ã€å¼ºå¤§çš„ Switch</h3><p>åœ¨ Groovy ä¸­ï¼Œswitch æ–¹æ³•å˜å¾—æ›´åŠ çµæ´»ï¼Œå¼ºå¤§ï¼Œå¯ä»¥åŒæ—¶æ”¯æŒæ›´å¤šçš„å‚æ•°ç±»å‹ï¼Œæ¯”åœ¨ Java ä¸­å¢å¼ºäº†å¾ˆå¤š</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs groovy"><span class="hljs-keyword">def</span> result = <span class="hljs-string">&#x27;erdai666&#x27;</span><br><span class="hljs-keyword">switch</span> (result)&#123;<br>    <span class="hljs-keyword">case</span> [<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-string">&#x27;erdai666&#x27;</span>]:<br>        println <span class="hljs-string">&quot;åŒ¹é…åˆ°äº†result&quot;</span><br>        <span class="hljs-keyword">break</span><br>    <span class="hljs-symbol">default:</span><br>        println <span class="hljs-string">&#x27;default&#x27;</span><br>        <span class="hljs-keyword">break</span><br>&#125;<br><span class="hljs-comment">//æ‰“å°ç»“æœ</span><br>åŒ¹é…åˆ°äº†result<br></code></pre></td></tr></table></figure><h3 id="14ã€åˆ¤æ–­æ˜¯å¦ä¸º-null-å’Œ-éè¿ç®—ç¬¦"><a href="#14ã€åˆ¤æ–­æ˜¯å¦ä¸º-null-å’Œ-éè¿ç®—ç¬¦" class="headerlink" title="14ã€åˆ¤æ–­æ˜¯å¦ä¸º null å’Œ éè¿ç®—ç¬¦"></a>14ã€åˆ¤æ–­æ˜¯å¦ä¸º null å’Œ éè¿ç®—ç¬¦</h3><p>åœ¨ Groovy ä¸­ï¼Œæ‰€æœ‰ç±»å‹éƒ½èƒ½è½¬æˆå¸ƒå°”å€¼ï¼Œæ¯”å¦‚ null å°±ç›¸å½“äº0æˆ–è€…ç›¸å½“äº<code>false</code>ï¼Œå…¶ä»–åˆ™ç›¸å½“äº<code>true</code></p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs groovy"><span class="hljs-comment">//åœ¨ Java ä¸­ï¼Œæˆ‘ä»¬ä¼šè¿™ä¹ˆç”¨</span><br><span class="hljs-keyword">if</span> (name != <span class="hljs-literal">null</span> &amp;&amp; name.length &gt; <span class="hljs-number">0</span>) &#123;<br>  <br>&#125;<br><br><span class="hljs-comment">//åœ¨ Groovy ä¸­ï¼Œå¯ä»¥è¿™ä¹ˆç”¨ï¼Œå¦‚æœnameä¸º null æˆ– 0 åˆ™è¿”å› falseï¼Œå¦åˆ™è¿”å›true</span><br><span class="hljs-keyword">if</span>(name)&#123;<br>  <br>&#125;<br><br><span class="hljs-comment">//éè¿ç®—ç¬¦ erdai è¿™ä¸ªå­—ç¬¦ä¸²ä¸ºé null ï¼Œå› æ­¤ä¸ºtrueï¼Œè€Œ !erdai åˆ™ä¸ºfalse</span><br><span class="hljs-keyword">assert</span> (!<span class="hljs-string">&#x27;erdai&#x27;</span>) = <span class="hljs-literal">false</span><br></code></pre></td></tr></table></figure><h3 id="15ã€å¯ä»¥ä½¿ç”¨-Number-ç±»å»æ›¿ä»£-floatã€double-ç­‰ç±»å‹ï¼Œçœå»è€ƒè™‘ç²¾åº¦çš„éº»çƒ¦"><a href="#15ã€å¯ä»¥ä½¿ç”¨-Number-ç±»å»æ›¿ä»£-floatã€double-ç­‰ç±»å‹ï¼Œçœå»è€ƒè™‘ç²¾åº¦çš„éº»çƒ¦" class="headerlink" title="15ã€å¯ä»¥ä½¿ç”¨ Number ç±»å»æ›¿ä»£ floatã€double ç­‰ç±»å‹ï¼Œçœå»è€ƒè™‘ç²¾åº¦çš„éº»çƒ¦"></a>15ã€å¯ä»¥ä½¿ç”¨ Number ç±»å»æ›¿ä»£ floatã€double ç­‰ç±»å‹ï¼Œçœå»è€ƒè™‘ç²¾åº¦çš„éº»çƒ¦</h3><h3 id="16ã€é»˜è®¤æ˜¯-public-æƒé™"><a href="#16ã€é»˜è®¤æ˜¯-public-æƒé™" class="headerlink" title="16ã€é»˜è®¤æ˜¯ public æƒé™"></a>16ã€é»˜è®¤æ˜¯ public æƒé™</h3><p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒGroovy çš„ class å’Œ æ–¹æ³•éƒ½æ˜¯ public æƒé™ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥çœç•¥ public å…³é”®å­—ï¼Œé™¤éæˆ‘ä»¬æƒ³ä½¿ç”¨ private ä¿®é¥°ç¬¦</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs groovy"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Server</span> &#123; <br>   String toString() &#123; <span class="hljs-string">&quot;a server&quot;</span> &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="17ã€ä½¿ç”¨å‘½åçš„å‚æ•°åˆå§‹åŒ–å’Œé»˜è®¤çš„æ„é€ å™¨"><a href="#17ã€ä½¿ç”¨å‘½åçš„å‚æ•°åˆå§‹åŒ–å’Œé»˜è®¤çš„æ„é€ å™¨" class="headerlink" title="17ã€ä½¿ç”¨å‘½åçš„å‚æ•°åˆå§‹åŒ–å’Œé»˜è®¤çš„æ„é€ å™¨"></a>17ã€ä½¿ç”¨å‘½åçš„å‚æ•°åˆå§‹åŒ–å’Œé»˜è®¤çš„æ„é€ å™¨</h3><p>Groovyä¸­ï¼Œæˆ‘ä»¬åœ¨åˆ›å»ºä¸€ä¸ªå¯¹è±¡å®ä¾‹çš„æ—¶å€™ï¼Œå¯ä»¥ç›´æ¥åœ¨æ„é€ æ–¹æ³•ä¸­é€šè¿‡ key value çš„å½¢å¼ç»™å±æ€§èµ‹å€¼ï¼Œè€Œä¸éœ€è¦å»å†™æ„é€ æ–¹æ³•ï¼Œè¯´çš„æœ‰ç‚¹æŠ½è±¡ï¼Œä¸Šä»£ç æ„Ÿå—ä¸€ä¸‹ï¼š</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs groovy"><span class="hljs-comment">//å®šä¹‰ä¸€ä¸ªpeople</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">People</span>&#123;<br>    <span class="hljs-keyword">def</span> name<br>    <span class="hljs-keyword">def</span> age<br>&#125;<br><br><span class="hljs-comment">//æˆ‘ä»¬å¯ä»¥é€šè¿‡ä»¥ä¸‹å‡ ç§æ–¹å¼å»å®ä¾‹åŒ–ä¸€ä¸ªå¯¹è±¡ï¼Œæ³¨æ„æˆ‘ä»¬Peopleç±»é‡Œé¢æ²¡æœ‰å†™ä»»ä½•ä¸€ä¸ªæ„é€ æ–¹æ³•å“¦</span><br><span class="hljs-keyword">def</span> people1 = <span class="hljs-keyword">new</span> People()<br><span class="hljs-keyword">def</span> people1 = <span class="hljs-keyword">new</span> People(<span class="hljs-attr">age:</span> <span class="hljs-number">15</span>)<br><span class="hljs-keyword">def</span> people2 = <span class="hljs-keyword">new</span> People(<span class="hljs-attr">name:</span> <span class="hljs-string">&#x27;erdai&#x27;</span>)<br><span class="hljs-keyword">def</span> people3 = <span class="hljs-keyword">new</span> People(<span class="hljs-attr">age:</span> <span class="hljs-number">15</span>,<span class="hljs-attr">name:</span> <span class="hljs-string">&#x27;erdai&#x27;</span>)<br></code></pre></td></tr></table></figure><h3 id="18ã€ä½¿ç”¨-with-å‡½æ•°æ“ä½œåŒä¸€ä¸ªå¯¹è±¡çš„å¤šä¸ªå±æ€§å’Œæ–¹æ³•"><a href="#18ã€ä½¿ç”¨-with-å‡½æ•°æ“ä½œåŒä¸€ä¸ªå¯¹è±¡çš„å¤šä¸ªå±æ€§å’Œæ–¹æ³•" class="headerlink" title="18ã€ä½¿ç”¨ with å‡½æ•°æ“ä½œåŒä¸€ä¸ªå¯¹è±¡çš„å¤šä¸ªå±æ€§å’Œæ–¹æ³•"></a>18ã€ä½¿ç”¨ with å‡½æ•°æ“ä½œåŒä¸€ä¸ªå¯¹è±¡çš„å¤šä¸ªå±æ€§å’Œæ–¹æ³•</h3><p>with å‡½æ•°æ¥æ”¶ä¸€ä¸ªé—­åŒ…ï¼Œé—­åŒ…ä¸‹é¢ä¼šè®²ï¼Œé—­åŒ…çš„å‚æ•°å°±æ˜¯å½“å‰è°ƒç”¨çš„å¯¹è±¡</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs groovy"><span class="hljs-keyword">class</span> <span class="hljs-title class_">People</span>&#123;<br>    <span class="hljs-keyword">def</span> name<br>    <span class="hljs-keyword">def</span> age<br>    <br>    <span class="hljs-type">void</span> running()&#123;<br>        println <span class="hljs-string">&#x27;è·‘æ­¥&#x27;</span><br>    &#125;<br>&#125;<br><span class="hljs-comment">//å®šä¹‰ä¸€ä¸ª people å¯¹è±¡</span><br><span class="hljs-keyword">def</span> people = <span class="hljs-keyword">new</span> People()<br><span class="hljs-comment">//è°ƒç”¨ with å‡½æ•° é—­åŒ…å‚æ•°å³ä¸ºpeopeo å¦‚æœé—­åŒ…ä¸å†™å‚æ•°ï¼Œé»˜è®¤ä¼šæœ‰ä¸€ä¸ª it å‚æ•°</span><br>people.with&#123;<br>    name = <span class="hljs-string">&quot;erdai&quot;</span><br>    age = <span class="hljs-number">19</span><br>    println <span class="hljs-string">&quot;$name $age&quot;</span><br>    running()<br>&#125;<br><span class="hljs-comment">//æ‰“å°ç»“æœ</span><br>erdai <span class="hljs-number">19</span><br>è·‘æ­¥<br></code></pre></td></tr></table></figure><h3 id="19ã€å¼‚å¸¸æ•è·"><a href="#19ã€å¼‚å¸¸æ•è·" class="headerlink" title="19ã€å¼‚å¸¸æ•è·"></a>19ã€å¼‚å¸¸æ•è·</h3><p>å¦‚æœä½ å®åœ¨ä¸æƒ³å…³å¿ƒ try å—é‡ŒæŠ›å‡ºä½•ç§å¼‚å¸¸ï¼Œä½ å¯ä»¥ç®€å•çš„æ•è·æ‰€æœ‰å¼‚å¸¸ï¼Œå¹¶ä¸”å¯ä»¥çœç•¥å¼‚å¸¸ç±»å‹ï¼š</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs groovy"><span class="hljs-comment">//åœ¨ java ä¸­æˆ‘ä»¬ä¼šè¿™æ ·å†™</span><br><span class="hljs-keyword">try</span> &#123;<br>    <span class="hljs-comment">// ...</span><br>&#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>    <span class="hljs-comment">// do something</span><br>&#125;<br><br><span class="hljs-comment">//åœ¨ Groovy ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥è¿™æ ·å†™</span><br><span class="hljs-keyword">try</span> &#123;<br>    <span class="hljs-comment">// ...</span><br>&#125; <span class="hljs-keyword">catch</span> (any) &#123;<br>    <span class="hljs-comment">// do something</span><br>&#125;<br><br></code></pre></td></tr></table></figure><p>ä¸Šé¢ Groovy çš„å†™æ³•å…¶å®å°±æ˜¯çœç•¥äº†å‚æ•°ç±»å‹ï¼Œå®é™…ä¸Š any çš„å‚æ•°ç±»å‹ä¹Ÿæ˜¯ Exceptionï¼Œ å¹¶ä¸åŒ…æ‹¬ Throwable ï¼Œå¦‚æœä½ æƒ³æ•è·æ‰€æœ‰çš„å¼‚å¸¸ï¼Œä½ å¯ä»¥æ˜ç¡®æ•è·å¼‚å¸¸çš„å‚æ•°ç±»å‹</p><h2 id="å››ã€Groovy-é—­åŒ…"><a href="#å››ã€Groovy-é—­åŒ…" class="headerlink" title="å››ã€Groovy é—­åŒ…"></a>å››ã€Groovy é—­åŒ…</h2><p>åœ¨ Groovy ä¸­ï¼Œé—­åŒ…éå¸¸çš„é‡è¦ï¼Œå› æ­¤å•ç‹¬ç”¨ä¸€ä¸ªæ¨¡å—æ¥è®²</p><h3 id="1ã€é—­åŒ…å®šä¹‰"><a href="#1ã€é—­åŒ…å®šä¹‰" class="headerlink" title="1ã€é—­åŒ…å®šä¹‰"></a>1ã€é—­åŒ…å®šä¹‰</h3><p>å¼•ç”¨ Groovy å®˜æ–¹å¯¹é—­åŒ…çš„å®šä¹‰ï¼šA closure in Groovy is an open, anonymous, block of code that can take arguments, return a value and be assigned to a variable. ç¿»è¯‘è¿‡æ¥å°±æ˜¯ï¼š<strong>Groovy ä¸­çš„é—­åŒ…æ˜¯ä¸€ä¸ªå¼€æ”¾çš„ã€åŒ¿åçš„ä»£ç å—ï¼Œå®ƒå¯ä»¥æ¥å—å‚æ•°ã€è¿”å›å€¼å¹¶å°†å€¼èµ‹ç»™å˜é‡ã€‚</strong> é€šä¿—çš„è®²ï¼Œé—­åŒ…å¯ä»¥ä½œä¸ºæ–¹æ³•çš„å‚æ•°å’Œè¿”å›å€¼ï¼Œä¹Ÿå¯ä»¥ä½œä¸ºä¸€ä¸ªå˜é‡è€Œå­˜åœ¨ï¼Œé—­åŒ…æœ¬è´¨ä¸Šå°±æ˜¯ä¸€æ®µä»£ç å—ï¼Œä¸‹é¢æˆ‘ä»¬å°±ç”±æµ…å…¥æ·±çš„æ¥å­¦ä¹ é—­åŒ…</p><h3 id="2ã€é—­åŒ…å£°æ˜"><a href="#2ã€é—­åŒ…å£°æ˜" class="headerlink" title="2ã€é—­åŒ…å£°æ˜"></a>2ã€é—­åŒ…å£°æ˜</h3><p>1ã€é—­åŒ…åŸºæœ¬çš„è¯­æ³•ç»“æ„ï¼šå¤–é¢ä¸€å¯¹å¤§æ‹¬å·ï¼Œæ¥ç€æ˜¯ç”³æ˜å‚æ•°ï¼Œå‚æ•°ç±»å‹å¯çœç•¥ï¼Œåœ¨æ˜¯ä¸€ä¸ª -&gt; ç®­å¤´å·ï¼Œæœ€åå°±æ˜¯é—­åŒ…ä½“é‡Œé¢çš„å†…å®¹</p><p>2ã€é—­åŒ…ä¹Ÿå¯ä»¥ä¸å®šä¹‰å‚æ•°ï¼Œå¦‚æœé—­åŒ…æ²¡å®šä¹‰å‚æ•°çš„è¯ï¼Œåˆ™éšå«æœ‰ä¸€ä¸ªå‚æ•°ï¼Œè¿™ä¸ªå‚æ•°åå­—å« it</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs groovy"><span class="hljs-comment">//1</span><br>&#123; params -&gt;<br>   <span class="hljs-comment">//do something</span><br>&#125;<br><br><span class="hljs-comment">//2</span><br>&#123; <br>   <span class="hljs-comment">//do something</span><br>&#125;<br></code></pre></td></tr></table></figure><h3 id="3ã€é—­åŒ…è°ƒç”¨"><a href="#3ã€é—­åŒ…è°ƒç”¨" class="headerlink" title="3ã€é—­åŒ…è°ƒç”¨"></a>3ã€é—­åŒ…è°ƒç”¨</h3><p>1ã€é—­åŒ…å¯ä»¥é€šè¿‡ .call æ–¹æ³•æ¥è°ƒç”¨</p><p>2ã€é—­åŒ…å¯ä»¥ç›´æ¥ç”¨æ‹¬å·+å‚æ•°æ¥è°ƒç”¨</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs groovy"><span class="hljs-comment">//å®šä¹‰ä¸€ä¸ªé—­åŒ…èµ‹å€¼ç»™ closure å˜é‡</span><br><span class="hljs-keyword">def</span> closure = &#123; params1,params2 -&gt;<br>    params1 + params2<br>&#125;<br><br><span class="hljs-comment">//é—­åŒ…è°ƒç”¨æ–¹å¼1: é—­åŒ…å¯ä»¥é€šè¿‡ .call æ–¹æ³•æ¥è°ƒç”¨</span><br><span class="hljs-keyword">def</span> result1 = closure(<span class="hljs-string">&#x27;erdai &#x27;</span>,<span class="hljs-string">&#x27;666&#x27;</span>)<br><span class="hljs-comment">//é—­åŒ…è°ƒç”¨æ–¹å¼2: é—­åŒ…å¯ä»¥ç›´æ¥ç”¨æ‹¬å·+å‚æ•°æ¥è°ƒç”¨</span><br><span class="hljs-keyword">def</span> result2 = closure.call(<span class="hljs-string">&#x27;erdai &#x27;</span>,<span class="hljs-string">&#x27;777&#x27;</span>)<br><span class="hljs-comment">//æ‰“å°å€¼</span><br>println result1<br>println result2<br><span class="hljs-comment">//æ‰“å°ç»“æœ</span><br>erdai <span class="hljs-number">666</span><br>erdai <span class="hljs-number">777</span><br><br><span class="hljs-comment">//å®šä¹‰ä¸€ä¸ªæ— å‚é—­åŒ…</span><br><span class="hljs-keyword">def</span> closure1 = &#123;<br>    println(<span class="hljs-string">&#x27;æ— å®šä¹‰å‚æ•°é—­åŒ…&#x27;</span>)<br>&#125;<br>closure1() <span class="hljs-comment">//æˆ–è€…è°ƒç”¨ closure1.call()</span><br><span class="hljs-comment">//æ‰“å°ç»“æœ</span><br>æ— å®šä¹‰å‚æ•°é—­åŒ…<br></code></pre></td></tr></table></figure><h3 id="4ã€é—­åŒ…è¿›é˜¶"><a href="#4ã€é—­åŒ…è¿›é˜¶" class="headerlink" title="4ã€é—­åŒ…è¿›é˜¶"></a>4ã€é—­åŒ…è¿›é˜¶</h3><h4 id="1ï¼‰ã€é—­åŒ…ä¸­çš„å…³é”®å˜é‡"><a href="#1ï¼‰ã€é—­åŒ…ä¸­çš„å…³é”®å˜é‡" class="headerlink" title="1ï¼‰ã€é—­åŒ…ä¸­çš„å…³é”®å˜é‡"></a>1ï¼‰ã€é—­åŒ…ä¸­çš„å…³é”®å˜é‡</h4><p>æ¯ä¸ªé—­åŒ…ä¸­éƒ½å«æœ‰ <strong>thisã€owner å’Œ delegate</strong> è¿™ä¸‰ä¸ªå†…ç½®å¯¹è±¡ï¼Œé‚£ä¹ˆè¿™ä¸‰ä¸ªä¸‰ä¸ªå†…ç½®å¯¹è±¡æœ‰å•¥åŒºåˆ«å‘¢ï¼Ÿæˆ‘ä»¬ç”¨ä»£ç å»éªŒè¯ä¸€ä¸‹</p><p><strong>æ³¨æ„</strong>ï¼š</p><p><strong>1ã€getThisObject() æ–¹æ³• å’Œ thisObject å±æ€§ç­‰åŒäº this</strong></p><p><strong>2ã€getOwner() æ–¹æ³• ç­‰åŒäº owner</strong></p><p><strong>3ã€getDelegate() æ–¹æ³• ç­‰åŒäº delegate</strong></p><p>è¿™äº›å»çœ‹é—­åŒ…çš„æºç ä½ å°±ä¼šæœ‰æ·±åˆ»çš„ä½“ä¼š</p><p>1ã€æˆ‘ä»¬åœ¨ GroovyGrammar.groovy è¿™ä¸ªè„šæœ¬ç±»ä¸­å®šä¹‰ä¸€ä¸ªé—­åŒ…æ‰“å°è¿™ä¸‰è€…çš„å€¼çœ‹ä¸€ä¸‹ï¼š</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs groovy"><span class="hljs-comment">//å®šä¹‰ä¸€ä¸ªé—­åŒ…</span><br><span class="hljs-keyword">def</span> outerClosure = &#123;<br>    println <span class="hljs-string">&quot;this: &quot;</span> + <span class="hljs-variable language_">this</span><br>    println <span class="hljs-string">&quot;owner: &quot;</span> + owner<br>    println <span class="hljs-string">&quot;delegate: &quot;</span> + delegate<br>&#125;<br><span class="hljs-comment">//è°ƒç”¨é—­åŒ…</span><br>outerClosure.call()<br><span class="hljs-comment">//æ‰“å°ç»“æœ</span><br><span class="hljs-attr">this:</span> variable.GroovyGrammar@<span class="hljs-number">39</span>dcf4b0<br><span class="hljs-attr">owner:</span> variable.GroovyGrammar@<span class="hljs-number">39</span>dcf4b0<br><span class="hljs-attr">delegate:</span> variable.GroovyGrammar@<span class="hljs-number">39</span>dcf4b0<br><span class="hljs-comment">//è¯æ˜å½“å‰ä¸‰è€…éƒ½æŒ‡å‘äº†GroovyGrammarè¿™ä¸ªè„šæœ¬ç±»å¯¹è±¡</span><br></code></pre></td></tr></table></figure><p>2ã€æˆ‘ä»¬åœ¨è¿™ä¸ª GroovyGrammar.groovy è¿™ä¸ªè„šæœ¬ç±»ä¸­å®šä¹‰ä¸€ä¸ªç±»ï¼Œç±»ä¸­å®šä¹‰ä¸€ä¸ªé—­åŒ…ï¼Œæ‰“å°çœ‹ä¸‹ç»“æœï¼š</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs groovy"><span class="hljs-comment">//å®šä¹‰ä¸€ä¸ª OuterClass ç±»</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">OuterClass</span> &#123;<br>    <span class="hljs-comment">//å®šä¹‰ä¸€ä¸ªé—­åŒ…</span><br>    <span class="hljs-keyword">def</span> outerClosure = &#123;<br>        println <span class="hljs-string">&quot;this: &quot;</span> + <span class="hljs-variable language_">this</span><br>        println <span class="hljs-string">&quot;owner: &quot;</span> + owner<br>        println <span class="hljs-string">&quot;delegate: &quot;</span> + delegate<br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">def</span> outerClass = <span class="hljs-keyword">new</span> OuterClass()<br>outerClass.outerClosure.call()<br><br><span class="hljs-comment">//æ‰“å°ç»“æœå¦‚ä¸‹ï¼š</span><br><span class="hljs-attr">this:</span> variable.OuterClass@<span class="hljs-number">1992</span>eaf4<br><span class="hljs-attr">owner:</span> variable.OuterClass@<span class="hljs-number">1992</span>eaf4<br><span class="hljs-attr">delegate:</span> variable.OuterClass@<span class="hljs-number">1992</span>eaf4<br><span class="hljs-comment">//ç»“æœè¯æ˜è¿™ä¸‰è€…éƒ½æŒ‡å‘äº†å½“å‰ OuterClass ç±»å¯¹è±¡</span><br></code></pre></td></tr></table></figure><p>3ã€æˆ‘ä»¬åœ¨ GroovyGrammar.groovy è¿™ä¸ªè„šæœ¬ç±»ä¸­ï¼Œå®šä¹‰ä¸€ä¸ªé—­åŒ…ï¼Œé—­åŒ…ä¸­åœ¨å®šä¹‰ä¸€ä¸ªé—­åŒ…ï¼Œæ‰“å°çœ‹ä¸‹ç»“æœï¼š</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs groovy"><span class="hljs-keyword">def</span> outerClosure = &#123;<br>    <span class="hljs-keyword">def</span> innerClosure = &#123;<br>        println <span class="hljs-string">&quot;this: &quot;</span> + <span class="hljs-variable language_">this</span><br>        println <span class="hljs-string">&quot;owner: &quot;</span> + owner<br>        println <span class="hljs-string">&quot;delegate: &quot;</span> + delegate<br>    &#125;<br>    innerClosure.call()<br>  <br>&#125;<br>println outerClosure<br>outerClosure.call()<br><br><span class="hljs-comment">//æ‰“å°ç»“æœå¦‚ä¸‹</span><br>variable.GroovyGrammar$_run_closure4@<span class="hljs-number">64</span>beebb7<br><span class="hljs-attr">this:</span> variable.GroovyGrammar@<span class="hljs-number">5</span>b58ed3c<br><span class="hljs-attr">owner:</span> variable.GroovyGrammar$_run_closure4@<span class="hljs-number">64</span>beebb7<br><span class="hljs-attr">delegate:</span> variable.GroovyGrammar$_run_closure4@<span class="hljs-number">64</span>beebb7<br><span class="hljs-comment">//ç»“æœè¯æ˜ this æŒ‡å‘äº†å½“å‰GroovyGrammarè¿™ä¸ªè„šæœ¬ç±»å¯¹è±¡ owner å’Œ delegate éƒ½æŒ‡å‘äº† outerClosure é—­åŒ…å¯¹è±¡</span><br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬æ¢³ç†ä¸€ä¸‹ä¸Šé¢çš„ä¸‰ç§æƒ…å†µ: </p><p>1ã€é—­åŒ…å®šä¹‰åœ¨GroovyGrammar.groovy è¿™ä¸ªè„šæœ¬ç±»ä¸­ this owner delegate å°±æŒ‡å‘è¿™ä¸ªè„šæœ¬ç±»å¯¹è±¡</p><p>2ã€æˆ‘åœ¨è¿™ä¸ªè„šæœ¬ç±»ä¸­åˆ›å»ºäº†ä¸€ä¸ª OuterClass ç±»ï¼Œå¹¶åœ¨ä»–é‡Œé¢å®šä¹‰äº†ä¸€ä¸ªé—­åŒ…ï¼Œé‚£ä¹ˆæ­¤æ—¶ this owner delegate å°±æŒ‡å‘äº† OuterClass è¿™ä¸ªç±»å¯¹è±¡</p><p>3ã€æˆ‘åœ¨ GroovyGrammar.groovy è¿™ä¸ªè„šæœ¬ç±»ä¸­å®šä¹‰äº†ä¸€ä¸ªé—­åŒ…ï¼Œé—­åŒ…ä¸­åˆå®šä¹‰äº†ä¸€ä¸ªé—­åŒ…ï¼Œthis æŒ‡å‘äº†å½“å‰GroovyGrammarè¿™ä¸ªè„šæœ¬ç±»å¯¹è±¡ï¼Œ owner å’Œ delegate éƒ½æŒ‡å‘äº† outerClosure é—­åŒ…å¯¹è±¡</p><p>å› æ­¤æˆ‘ä»¬å¯ä»¥å¾—åˆ°ç»“è®ºï¼š</p><p><strong>1ã€this æ°¸è¿œæŒ‡å‘å®šä¹‰è¯¥é—­åŒ…æœ€è¿‘çš„ç±»å¯¹è±¡ï¼Œå°±è¿‘åŸåˆ™ï¼Œå®šä¹‰é—­åŒ…æ—¶ï¼Œå“ªä¸ªç±»ç¦»çš„æœ€è¿‘å°±æŒ‡å‘å“ªä¸ªï¼Œæˆ‘è¿™é‡Œçš„ç¦»å¾—è¿‘æ˜¯æŒ‡å®šä¹‰é—­åŒ…çš„è¿™ä¸ªç±»ï¼ŒåŒ…å«å†…éƒ¨ç±»</strong></p><p><strong>2ã€owner æ°¸è¿œæŒ‡å‘å®šä¹‰è¯¥é—­åŒ…çš„ç±»å¯¹è±¡æˆ–è€…é—­åŒ…å¯¹è±¡ï¼Œé¡¾åæ€ä¹‰ï¼Œé—­åŒ…åªèƒ½å®šä¹‰åœ¨ç±»ä¸­æˆ–è€…é—­åŒ…ä¸­</strong></p><p><strong>3ã€delegate å’Œ owner æ˜¯ä¸€æ ·çš„ï¼Œæˆ‘ä»¬åœ¨é—­åŒ…çš„æºç ä¸­å¯ä»¥çœ‹åˆ°ï¼Œowner ä¼šæŠŠè‡ªå·±çš„å€¼èµ‹ç»™ delegateï¼Œä½†åŒæ—¶ delegate ä¹Ÿå¯ä»¥èµ‹å…¶ä»–å€¼</strong></p><p><strong>æ³¨æ„ï¼šåœ¨æˆ‘ä»¬ä½¿ç”¨ this , owner , å’Œ delegate çš„æ—¶å€™ï¼Œ this å’Œ owner é»˜è®¤æ˜¯åªè¯»çš„ï¼Œæˆ‘ä»¬å¤–éƒ¨ä¿®æ”¹ä¸äº†å®ƒï¼Œè¿™ç‚¹åœ¨æºç ä¸­ä¹Ÿæœ‰ä½“ç°ï¼Œä½†æ˜¯å¯ä»¥å¯¹ delegate è¿›è¡Œæ“ä½œ</strong></p><h4 id="2ï¼‰ã€é—­åŒ…å§”æ‰˜ç­–ç•¥"><a href="#2ï¼‰ã€é—­åŒ…å§”æ‰˜ç­–ç•¥" class="headerlink" title="2ï¼‰ã€é—­åŒ…å§”æ‰˜ç­–ç•¥"></a>2ï¼‰ã€é—­åŒ…å§”æ‰˜ç­–ç•¥</h4><p>ä¸‹é¢æˆ‘ä»¬å°±æ¥å¯¹ä¿®æ”¹é—­åŒ…çš„ delegate è¿›è¡Œå®æ“ï¼š</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs groovy"><span class="hljs-comment">//åˆ›å»ºä¸€ä¸ªé¦™è•‰ç±»</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Banana</span>&#123;<br>    <span class="hljs-keyword">def</span> name<br>&#125;<br><br><span class="hljs-comment">//åˆ›å»ºä¸€ä¸ªæ©˜å­ç±»</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Orange</span>&#123;<br>    <span class="hljs-keyword">def</span> name<br>&#125;<br><br><span class="hljs-comment">//å®šä¹‰ä¸€ä¸ªé¦™è•‰å¯¹è±¡</span><br><span class="hljs-keyword">def</span> banana = <span class="hljs-keyword">new</span> Orange(<span class="hljs-attr">name:</span> <span class="hljs-string">&#x27;é¦™è•‰&#x27;</span>)<br><span class="hljs-comment">//å®šä¹‰ä¸€ä¸ªæ©˜å­å¯¹è±¡</span><br><span class="hljs-keyword">def</span> orange = <span class="hljs-keyword">new</span> Orange(<span class="hljs-attr">name:</span> <span class="hljs-string">&#x27;æ©˜å­&#x27;</span>)<br><span class="hljs-comment">//å®šä¹‰ä¸€ä¸ªé—­åŒ…å¯¹è±¡</span><br><span class="hljs-keyword">def</span> closure = &#123;<br>    <span class="hljs-comment">//æ‰“å°å€¼</span><br>    println delegate.name<br>&#125;<br><span class="hljs-comment">//è°ƒç”¨é—­åŒ…</span><br>closure.call()<br><br><span class="hljs-comment">//è¿è¡Œä¸€ä¸‹ï¼Œå‘ç°ç»“æœæŠ¥é”™äº†ï¼Œå¦‚ä¸‹</span><br><span class="hljs-attr">Caught:</span> groovy.lang.<span class="hljs-attr">MissingPropertyException:</span> No such <span class="hljs-attr">property:</span> name <span class="hljs-keyword">for</span> <span class="hljs-attr">class:</span> variable.GroovyGrammar<br><span class="hljs-comment">//å¤§è‡´æ„æ€å°±æ˜¯GroovyGrammarè¿™ä¸ªè„šæœ¬ç±»å¯¹è±¡æ²¡æœ‰è¿™ä¸ª name å¯¹è±¡</span><br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬æ¥åˆ†æä¸‹æŠ¥é”™çš„åŸå› åŸå› ï¼Œåˆ†æä¹‹å‰æˆ‘ä»¬è¦æ˜ç™½ä¸€ä¸ªçŸ¥è¯†ç‚¹ï¼š</p><p><strong>é—­åŒ…çš„é»˜è®¤å§”æ‰˜ç­–ç•¥æ˜¯ OWNER_FIRSTï¼Œä¹Ÿå°±æ˜¯é—­åŒ…ä¼šå…ˆä» owner ä¸Šå¯»æ‰¾å±æ€§æˆ–æ–¹æ³•ï¼Œæ‰¾ä¸åˆ°åˆ™åœ¨ delegate ä¸Šå¯»æ‰¾</strong></p><p>1ã€closure è¿™ä¸ªé—­åŒ…æ˜¯ç”Ÿæ˜åœ¨ GroovyGrammar è¿™ä¸ªè„šæœ¬ç±»å½“ä¸­</p><p>2ã€æ ¹æ®æˆ‘ä»¬ä¹‹å‰å­¦çš„çŸ¥è¯†ï¼Œåœ¨ä¸æ”¹å˜ delegate çš„æƒ…å†µä¸‹ delegate å’Œ owner æ˜¯ä¸€æ ·çš„ï¼Œéƒ½ä¼šæŒ‡å‘ GroovyGrammar è¿™ä¸ªè„šæœ¬ç±»å¯¹è±¡</p><p>3ã€GroovyGrammar è¿™ä¸ªè„šæœ¬ç±»å¯¹è±¡ï¼Œæ ¹æ®é—­åŒ…é»˜è®¤å§”æ‰˜ç­–ç•¥ï¼Œæ‰¾ä¸åˆ° name è¿™ä¸ªå±æ€§</p><p>å› æ­¤æŠ¥é”™äº†ï¼ŒçŸ¥é“äº†æŠ¥é”™åŸå› ï¼Œé‚£æˆ‘ä»¬å°±ä¿®æ”¹ä¸€ä¸‹é—­åŒ…çš„ delegate , è¿˜æ˜¯ä¸Šé¢é‚£æ®µä»£ç ï¼Œæ·»åŠ å¦‚ä¸‹è¿™å¥ä»£ç ï¼š</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs groovy"><span class="hljs-comment">//ä¿®æ”¹é—­åŒ…çš„delegate</span><br>closure.delegate = orange<br><span class="hljs-comment">//æˆ‘ä»¬åœ¨è¿è¡Œä¸€ä¸‹ï¼Œæ‰“å°ç»“æœ:</span><br>æ©˜å­<br></code></pre></td></tr></table></figure><p>æ­¤æ—¶é—­åŒ…çš„ delegate æŒ‡å‘äº† orange ï¼Œå› æ­¤ä¼šæ‰“å° orange è¿™ä¸ªå¯¹è±¡çš„ name ï¼Œé‚£ä¹ˆæˆ‘ä»¬æŠŠ closure çš„ delegate æ”¹ä¸º bananaï¼Œè‚¯å®šå°±ä¼šæ‰“å°é¦™è•‰äº†</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs groovy"><span class="hljs-comment">//ä¿®æ”¹é—­åŒ…çš„delegate</span><br>closure.delegate = banana<br><span class="hljs-comment">//æˆ‘ä»¬åœ¨è¿è¡Œä¸€ä¸‹ï¼Œæ‰“å°ç»“æœ:</span><br>é¦™è•‰<br></code></pre></td></tr></table></figure><h4 id="3ï¼‰ã€æ·±å…¥é—­åŒ…å§”æ‰˜ç­–ç•¥"><a href="#3ï¼‰ã€æ·±å…¥é—­åŒ…å§”æ‰˜ç­–ç•¥" class="headerlink" title="3ï¼‰ã€æ·±å…¥é—­åŒ…å§”æ‰˜ç­–ç•¥"></a>3ï¼‰ã€æ·±å…¥é—­åŒ…å§”æ‰˜ç­–ç•¥</h4><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs groovy"><span class="hljs-comment">//å®šä¹‰ä¸€ä¸ª ClosureDepth ç±»</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">ClosureDepth</span>&#123;<br>    <span class="hljs-comment">//å®šä¹‰ä¸€ä¸ªå˜é‡ str1 èµ‹å€¼ä¸º erdai666</span><br>    <span class="hljs-keyword">def</span> str1 = <span class="hljs-string">&#x27;erdai666&#x27;</span><br>    <span class="hljs-comment">//å®šä¹‰ä¸€ä¸ªé—­åŒ…</span><br>    <span class="hljs-keyword">def</span> outerClosure = &#123;<br>      <span class="hljs-comment">//å®šä¹‰ä¸€ä¸ªå˜é‡ str2 èµ‹å€¼ä¸º erdai777</span><br>        <span class="hljs-keyword">def</span> str2 = <span class="hljs-string">&#x27;erdai777&#x27;</span><br>      <span class="hljs-comment">//æ‰“å°str1 åˆ†æ1</span><br>        println str1<br><br>      <span class="hljs-comment">//é—­åŒ…ä¸­åœ¨å®šä¹‰ä¸€ä¸ªé—­åŒ…</span><br>        <span class="hljs-keyword">def</span> innerClosure = &#123;<br>            <span class="hljs-comment">//åˆ†æ2</span><br>            println str1<br>            println str2<br>        &#125;<br>        <span class="hljs-comment">//è°ƒç”¨å†…éƒ¨è¿™ä¸ªé—­åŒ…</span><br>        innerClosure.call()<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">//åˆ›å»º ClosureDepth å¯¹è±¡</span><br><span class="hljs-keyword">def</span> closureDepth = <span class="hljs-keyword">new</span> ClosureDepth()<br><span class="hljs-comment">//è°ƒç”¨å¤–éƒ¨é—­åŒ…</span><br>closureDepth.outerClosure.call()<br><span class="hljs-comment">//è¿è¡Œç¨‹åºï¼Œæ‰“å°ç»“æœå¦‚ä¸‹</span><br>erdai666<br>erdai666<br>erdai777<br></code></pre></td></tr></table></figure><p>ä¸Šé¢ä»£ç æ³¨é‡Šå†™çš„å¾ˆæ¸…æ¥šï¼Œç°åœ¨æˆ‘ä»¬æ¥é‡ç‚¹åˆ†æä¸‹åˆ†æ1å’Œåˆ†æ2å¤„çš„æ‰“å°å€¼ï¼š</p><p>åˆ†æ1ï¼š</p><p>åˆ†æ1å¤„æ‰“å°äº† str1 , å®ƒå¤„äº outerClosure è¿™ä¸ªé—­åŒ…ä¸­ï¼Œæ­¤æ—¶ outerClosure è¿™ä¸ªé—­åŒ…çš„ owner , delegate éƒ½æŒ‡å‘äº† ClosureDepth è¿™ä¸ªç±»å¯¹è±¡ï¼Œå› æ­¤ ClosureDepth è¿™ä¸ªç±»å¯¹è±¡çš„å±æ€§å’Œæ–¹æ³•æˆ‘ä»¬å°±éƒ½èƒ½è°ƒç”¨åˆ°ï¼Œå› æ­¤åˆ†æ1å¤„ä¼šæ‰“å° erdai666</p><p>åˆ†æ2ï¼š</p><p>åˆ†æ2å¤„æ‰“å°äº† str1å’Œ str2ï¼Œå®ƒå¤„äº innerClosure è¿™ä¸ªé—­åŒ…ä¸­ï¼Œæ­¤æ—¶ innerClosure è¿™ä¸ªé—­åŒ…çš„ owner å’Œ delegate ä¼šæŒ‡å‘ outerClosure è¿™ä¸ªé—­åŒ…å¯¹è±¡ï¼Œæˆ‘ä»¬ä¼šå‘ç° outerClosure æœ‰ str2 è¿™ä¸ªå±æ€§ï¼Œä½†æ˜¯å¹¶æ²¡æœ‰ str1 è¿™ä¸ªå±æ€§ï¼Œå› æ­¤ outerClosure è¿™ä¸ªé—­åŒ…ä¼šå‘å®ƒçš„ owner å»å¯»æ‰¾ï¼Œå› æ­¤ä¼šæ‰¾åˆ° ClosureDepth è¿™ä¸ªç±»å¯¹è±¡çš„ str1 å±æ€§ï¼Œå› æ­¤æ‰“å°çš„ str1 æ˜¯ClosureDepth è¿™ä¸ªç±»å¯¹è±¡ä¸­çš„å±æ€§ï¼Œæ‰“å°çš„ str2 æ˜¯outerClosure è¿™ä¸ªé—­åŒ…ä¸­çš„å±æ€§ï¼Œæ‰€ä»¥åˆ†æ2å¤„çš„æ‰“å°ç»“æœåˆ†åˆ«æ˜¯ erdai666 erdai777</p><p>ä¸Šé¢çš„ä¾‹å­ä¸­æ²¡æœ‰æ˜¾å¼çš„ç»™ delegate è®¾ç½®ä¸€ä¸ªæ¥æ”¶è€…ï¼Œä½†æ˜¯æ— è®ºå“ªå±‚é—­åŒ…éƒ½èƒ½æˆåŠŸè®¿é—®åˆ° str1ã€str2 å€¼ï¼Œè¿™æ˜¯å› ä¸ºé»˜è®¤çš„è§£æå§”æ‰˜ç­–ç•¥åœ¨å‘æŒ¥ä½œç”¨ï¼ŒGroovy é—­åŒ…çš„å§”æ‰˜ç­–ç•¥æœ‰å¦‚ä¸‹å‡ ç§ï¼š</p><ol><li><strong>OWNER_FIRST</strong>ï¼šé»˜è®¤ç­–ç•¥ï¼Œé¦–å…ˆä» owner ä¸Šå¯»æ‰¾å±æ€§æˆ–æ–¹æ³•ï¼Œæ‰¾ä¸åˆ°åˆ™åœ¨ delegate ä¸Šå¯»æ‰¾</li><li><strong>DELEGATE_FIRST</strong>ï¼šå’Œä¸Šé¢ç›¸åï¼Œé¦–å…ˆä» delegate ä¸Šå¯»æ‰¾å±æ€§æˆ–è€…æ–¹æ³•ï¼Œæ‰¾ä¸åˆ°åˆ™åœ¨ owner ä¸Šå¯»æ‰¾</li><li><strong>OWNER_ONLY</strong>ï¼šåªåœ¨ owner ä¸Šå¯»æ‰¾ï¼Œdelegate è¢«å¿½ç•¥</li><li><strong>DELEGATE_ONLY</strong>ï¼šå’Œä¸Šé¢ç›¸åï¼Œåªåœ¨ delegate ä¸Šå¯»æ‰¾ï¼Œowner è¢«å¿½ç•¥</li><li><strong>TO_SELF</strong>ï¼šé«˜çº§é€‰é¡¹ï¼Œè®©å¼€å‘è€…è‡ªå®šä¹‰ç­–ç•¥ï¼Œå¿…é¡»è¦è‡ªå®šä¹‰å®ç°ä¸€ä¸ª Closure ç±»ï¼Œä¸€èˆ¬æˆ‘ä»¬è¿™ç§ç©å®¶ç”¨ä¸åˆ°</li></ol><p>ä¸‹é¢æˆ‘ä»¬å°±æ¥ä¿®æ”¹ä¸€ä¸‹é—­åŒ…çš„å§”æ‰˜ç­–ç•¥ï¼ŒåŠ æ·±ç†è§£ï¼š</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs groovy"><span class="hljs-keyword">class</span> <span class="hljs-title class_">People1</span>&#123;<br>    <span class="hljs-keyword">def</span> name = <span class="hljs-string">&#x27;æˆ‘æ˜¯People1&#x27;</span><br><br>    <span class="hljs-keyword">def</span> action()&#123;<br>        println <span class="hljs-string">&#x27;åƒé¥­&#x27;</span><br>    &#125;<br><br>    <span class="hljs-keyword">def</span> closure = &#123;<br>        println name<br>        action()<br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">People2</span>&#123;<br>    <span class="hljs-keyword">def</span> name = <span class="hljs-string">&#x27;æˆ‘æ˜¯People2&#x27;</span><br><br>    <span class="hljs-keyword">def</span> action()&#123;<br>        println <span class="hljs-string">&#x27;ç¡è§‰&#x27;</span><br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">def</span> people1 = <span class="hljs-keyword">new</span> People1()<br><span class="hljs-keyword">def</span> people2 = <span class="hljs-keyword">new</span> People2()<br>people1.closure.delegate = people2<br>people1.closure.call()<br><span class="hljs-comment">//è¿è¡Œä¸‹ç¨‹åºï¼Œæ‰“å°ç»“æœå¦‚ä¸‹ï¼š</span><br>æˆ‘æ˜¯People1<br>åƒé¥­<br></code></pre></td></tr></table></figure><p>what? è¿™æ˜¯å•¥æƒ…å†µï¼Œæˆ‘ä¸æ˜¯ä¿®æ”¹äº† delegate ä¸º people2 äº†ï¼Œæ€ä¹ˆæ‰“å°ç»“æœè¿˜æ˜¯ people1 çš„ï¼Ÿé‚£æ˜¯å› ä¸ºæˆ‘ä»¬å¿½ç•¥äº†ä¸€ä¸ªç‚¹ï¼Œæ²¡æœ‰ä¿®æ”¹é—­åŒ…å§”æ‰˜ç­–ç•¥ï¼Œä»–é»˜è®¤æ˜¯ OWNER_FIRST ï¼Œå› æ­¤æˆ‘ä»¬ä¿®æ”¹ä¸€ä¸‹å°±å¥½äº†ï¼Œè¿˜æ˜¯ä¸Šé¢è¿™æ®µä»£ç ï¼Œæ·»åŠ ä¸€å¥ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs groovy">people1.closure.resolveStrategy = Closure.DELEGATE_FIRST<br><span class="hljs-comment">//è¿è¡Œä¸‹ç¨‹åºï¼Œæ‰“å°ç»“æœå¦‚ä¸‹ï¼š</span><br>æˆ‘æ˜¯People2<br>ç¡è§‰<br></code></pre></td></tr></table></figure><p>åˆ°è¿™é‡Œï¼Œç›¸ä¿¡ä½ å¯¹é—­åŒ…äº†è§£çš„å·®ä¸å¤šäº†ï¼Œä¸‹é¢æˆ‘ä»¬åœ¨çœ‹ä¸‹é—­åŒ…çš„æºç å°±å®Œç¾äº†</p><h4 id="4ï¼‰ã€é—­åŒ…-Closure-ç±»æºç "><a href="#4ï¼‰ã€é—­åŒ…-Closure-ç±»æºç " class="headerlink" title="4ï¼‰ã€é—­åŒ… Closure ç±»æºç "></a>4ï¼‰ã€é—­åŒ… Closure ç±»æºç </h4><p>ä»…è´´å‡ºå…³é”®æºç </p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><code class="hljs groovy"><span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Closure</span>&lt;V&gt; <span class="hljs-keyword">extends</span> <span class="hljs-title class_">GroovyObjectSupport</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Cloneable</span>, Runnable, GroovyCallable&lt;V&gt;, Serializable &#123;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * ç†Ÿæ‚‰çš„ä¸€å †é—­åŒ…å§”æ‰˜ä»£ç†ç­–ç•¥</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> OWNER_FIRST = <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> DELEGATE_FIRST = <span class="hljs-number">1</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> OWNER_ONLY = <span class="hljs-number">2</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> DELEGATE_ONLY = <span class="hljs-number">3</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> TO_SELF = <span class="hljs-number">4</span>;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * é—­åŒ…å¯¹åº”çš„ä¸‰ä¸ªå§”æ‰˜å¯¹è±¡ thisObject å¯¹åº”çš„å°±æ˜¯ this å±æ€§ï¼Œéƒ½æ˜¯ç”¨ private ä¿®é¥°çš„ï¼Œå¤–ç•Œè®¿é—®ä¸åˆ°</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">private</span> Object delegate;<br>    <span class="hljs-keyword">private</span> Object owner;<br>    <span class="hljs-keyword">private</span> Object thisObject;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * é—­åŒ…å§”æ‰˜ç­–ç•¥</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> resolveStrategy;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * åœ¨é—­åŒ…çš„æ„é€ æ–¹æ³•ä¸­ï¼š</span><br><span class="hljs-comment">     * 1ã€å°† resolveStrategy èµ‹å€¼ä¸º0ï¼Œä¹Ÿæ˜¯å°±é»˜è®¤å§”æ‰˜ç­–ç•¥OWNER_FIRST</span><br><span class="hljs-comment">     * 2ã€thisObject ï¼Œowner ï¼Œdelegateéƒ½ä¼šè¢«èµ‹å€¼ï¼Œdelegate èµ‹çš„æ˜¯ ownerçš„å€¼</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> Closure(Object owner, Object thisObject) &#123;<br>        <span class="hljs-variable language_">this</span>.resolveStrategy = <span class="hljs-number">0</span>;<br>        <span class="hljs-variable language_">this</span>.owner = owner;<br>        <span class="hljs-variable language_">this</span>.delegate = owner;<br>        <span class="hljs-variable language_">this</span>.thisObject = thisObject;<br>        CachedClosureClass cachedClass = (CachedClosureClass)ReflectionCache.getCachedClass(<span class="hljs-variable language_">this</span>.getClass());<br>        <span class="hljs-variable language_">this</span>.parameterTypes = cachedClass.getParameterTypes();<br>        <span class="hljs-variable language_">this</span>.maximumNumberOfParameters = cachedClass.getMaximumNumberOfParameters();<br>    &#125;<br>  <br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * thisObject åªæä¾›äº† get æ–¹æ³•ï¼Œä¸” thisObject æ˜¯ç”¨ private ä¿®é¥°çš„ï¼Œå› æ­¤ thisObject å³ this åªè¯»</span><br><span class="hljs-comment">     */</span><br>  <span class="hljs-keyword">public</span> Object getThisObject() &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.thisObject;<br>    &#125;<br>  <br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * owner åªæä¾›äº† get æ–¹æ³•ï¼Œä¸” owner æ˜¯ç”¨ private ä¿®é¥°çš„ï¼Œå› æ­¤ owner åªè¯»</span><br><span class="hljs-comment">     */</span><br>  <span class="hljs-keyword">public</span> Object getOwner() &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.owner;<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * delegate æä¾›äº† get å’Œ set æ–¹æ³•ï¼Œå› æ­¤ delegate å¯è¯»å†™</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> Object getDelegate() &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.delegate;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">void</span> setDelegate(Object delegate) &#123;<br>        <span class="hljs-variable language_">this</span>.delegate = delegate;<br>    &#125;<br>  <br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * ç†Ÿæ‚‰çš„å§”æ‰˜ç­–ç•¥è®¾ç½®</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">void</span> setResolveStrategy(<span class="hljs-type">int</span> resolveStrategy) &#123;<br>        <span class="hljs-variable language_">this</span>.resolveStrategy = resolveStrategy;<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> getResolveStrategy() &#123;<br>        <span class="hljs-keyword">return</span> resolveStrategy;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>åˆ°è¿™é‡Œé—­åŒ…ç›¸å…³çš„çŸ¥è¯†ç‚¹å°±éƒ½è®²å®Œäº†ï¼Œä½†æ˜¯ï¼Œä½†æ˜¯ï¼Œä½†æ˜¯ï¼Œé‡è¦çš„äº‹æƒ…è¯´ä¸‰éï¼š<strong>æˆ‘ä»¬ä½¿ç”¨é—­åŒ…çš„æ—¶å€™ï¼Œå¦‚ä½•å»ç¡®å®šé—­åŒ…çš„å‚æ•°å‘¢ï¼Ÿ</strong>ï¼Œè¿™ä¸ªçœŸçš„å¾ˆè›‹ç–¼ï¼Œä½œä¸º Android å¼€å‘è€…ï¼Œåœ¨ä½¿ç”¨ AndroidStudio è¿›è¡Œ Gradle è„šæœ¬ç¼–å†™çš„æ—¶å€™ï¼ŒçœŸçš„æ˜¯éå¸¸ä¸å‹å¥½ï¼Œä¸Šé¢æˆ‘è®²äº†å¯ä»¥ä½¿ç”¨ä¸€ä¸ªå°æŠ€å·§å»è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œä½†æ˜¯è¿™ç§æƒ…å†µæ˜¯åœ¨ä½ çŸ¥é“è¦ä½¿ç”¨ä¸€ä¸ª Api çš„æƒ…å†µä¸‹ï¼Œæ¯”å¦‚ä½ çŸ¥é“ Map çš„ each æ–¹æ³•å¯ä»¥éå†ï¼Œä½†æ˜¯ä½ ä¸çŸ¥é“å‚æ•°ï¼Œè¿™ä¸ªæ—¶å€™å°±å¯ä»¥å»ä½¿ç”¨ã€‚é‚£å¦‚æœä½ è¿ Api éƒ½ä¸çŸ¥é“ï¼Œé‚£å°±æ›´åŠ ä¸çŸ¥é“é—­åŒ…çš„å‚æ•°äº†ï¼Œå› æ­¤è¦è§£å†³è¿™ç§æƒ…å†µï¼Œæˆ‘ä»¬å°±å¿…é¡»å»æŸ¥é˜… Groovy å®˜æ–¹æ–‡æ¡£ï¼š</p><p><a href="http://link.zhihu.com/?target=http://www.groovy-lang.org/api.html">http://www.groovy-lang.org/api.html</a></p><p><a href="http://link.zhihu.com/?target=http://docs.groovy-lang.org/latest/html/groovy-jdk/index-all.html">http://docs.groovy-lang.org/latest/html/groovy-jdk/index-all.html</a></p><h2 id="äº”ã€Groovyæ•°æ®ç»“æ„"><a href="#äº”ã€Groovyæ•°æ®ç»“æ„" class="headerlink" title="äº”ã€Groovyæ•°æ®ç»“æ„"></a>äº”ã€Groovyæ•°æ®ç»“æ„</h2><p>é€šè¿‡è¿™ä¸ªæ¨¡å—çš„å­¦ä¹ ï¼Œæˆ‘ä¼šç»“åˆå…·ä½“çš„ä¾‹å­æ¥è¯´æ˜å¦‚ä½•æŸ¥é˜…æ–‡æ¡£æ¥ç¡®å®šé—­åŒ…ä¸­çš„å‚æ•°ï¼Œåœ¨è®² Map çš„æ—¶å€™æˆ‘ä¼šè®²åˆ°</p><p>Groovy å¸¸ç”¨çš„æ•°æ®ç»“æ„æœ‰å¦‚ä¸‹ å››ç§ï¼š</p><ul><li>1ï¼‰ã€æ•°ç»„</li><li>2ï¼‰ã€List</li><li>3ï¼‰ã€Map</li><li>4ï¼‰ã€Range</li></ul><h3 id="1ã€æ•°ç»„"><a href="#1ã€æ•°ç»„" class="headerlink" title="1ã€æ•°ç»„"></a>1ã€æ•°ç»„</h3><p>åœ¨ Groovy ä¸­ä½¿ç”¨ [ ] è¡¨ç¤ºçš„æ˜¯ä¸€ä¸ª List é›†åˆï¼Œå¦‚æœè¦å®šä¹‰ Array æ•°ç»„ï¼Œæˆ‘ä»¬å°±å¿…é¡»å¼ºåˆ¶æŒ‡å®šä¸ºä¸€ä¸ªæ•°ç»„çš„ç±»å‹</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs groovy"><span class="hljs-comment">//åœ¨ Java ä¸­ï¼Œæˆ‘ä»¬ä¸€èˆ¬ä¼šè¿™æ ·å»å®šä¹‰ä¸€ä¸ªæ•°ç»„</span><br>String[] javaArray = [<span class="hljs-string">&quot;Java&quot;</span>, <span class="hljs-string">&quot;Groovy&quot;</span>, <span class="hljs-string">&quot;Android&quot;</span>]<br><br><span class="hljs-comment">//åœ¨ Groovy ä¸­ï¼Œæˆ‘ä»¬ä¸€èˆ¬ä¼šä½¿ç”¨ as å…³é”®å­—å®šä¹‰æ•°ç»„</span><br><span class="hljs-keyword">def</span> groovyArray = [<span class="hljs-string">&quot;Java&quot;</span>, <span class="hljs-string">&quot;Groovy&quot;</span>, <span class="hljs-string">&quot;Android&quot;</span>] <span class="hljs-keyword">as</span> String[]<br></code></pre></td></tr></table></figure><h3 id="2ã€List"><a href="#2ã€List" class="headerlink" title="2ã€List"></a>2ã€List</h3><h4 id="1ï¼‰ã€åˆ—è¡¨é›†åˆå®šä¹‰"><a href="#1ï¼‰ã€åˆ—è¡¨é›†åˆå®šä¹‰" class="headerlink" title="1ï¼‰ã€åˆ—è¡¨é›†åˆå®šä¹‰"></a>1ï¼‰ã€åˆ—è¡¨é›†åˆå®šä¹‰</h4><p>1ã€List å³åˆ—è¡¨é›†åˆï¼Œå¯¹åº” Java ä¸­çš„ List æ¥å£ï¼Œä¸€èˆ¬ç”¨ ArrayList ä½œä¸ºçœŸæ­£çš„å®ç°ç±»</p><p>2ã€å®šä¹‰ä¸€ä¸ªåˆ—è¡¨é›†åˆçš„æ–¹å¼æœ‰ç‚¹åƒ Java ä¸­å®šä¹‰æ•°ç»„ä¸€æ ·</p><p>3ã€é›†åˆå…ƒç´ å¯ä»¥æ¥æ”¶ä»»æ„çš„æ•°æ®ç±»å‹</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs groovy"><span class="hljs-comment">//åœ¨ Groovy ä¸­å®šä¹‰çš„é›†åˆé»˜è®¤å°±æ˜¯å¯¹åº”äº Java ä¸­ ArrayList é›†åˆ</span><br><span class="hljs-keyword">def</span> list1 = [<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>]<br><span class="hljs-comment">//æ‰“å° list ç±»å‹</span><br>print list1.<span class="hljs-keyword">class</span><br><span class="hljs-comment">//æ‰“å°ç»“æœ</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">java</span>.util.ArrayList<br><br><span class="hljs-comment">//é›†åˆå…ƒç´ å¯ä»¥æ¥æ”¶ä»»æ„çš„æ•°æ®ç±»å‹</span><br><span class="hljs-keyword">def</span> list2 = [<span class="hljs-string">&#x27;erdai666&#x27;</span>, <span class="hljs-number">1</span>, <span class="hljs-literal">true</span>]<br></code></pre></td></tr></table></figure><p>é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œå¦‚æœæˆ‘æƒ³å®šä¹‰ä¸€ä¸ª LinkedList é›†åˆï¼Œè¦æ€ä¹ˆåšå‘¢ï¼Ÿæœ‰ä¸¤ç§æ–¹å¼ï¼š</p><p>1ã€é€šè¿‡ Java çš„å¼ºç±»å‹æ–¹å¼å»å®šä¹‰</p><p>2ã€é€šè¿‡ as å…³é”®å­—æ¥æŒ‡å®š</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs groovy"><span class="hljs-comment">//æ–¹å¼1ï¼šé€šè¿‡ Java çš„å¼ºç±»å‹æ–¹å¼å»å®šä¹‰</span><br>LinkedList list3 = [<span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>]<br><br><span class="hljs-comment">//æ–¹å¼2ï¼šé€šè¿‡ as å…³é”®å­—æ¥æŒ‡å®š</span><br><span class="hljs-keyword">def</span> list4 = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>] <span class="hljs-keyword">as</span> LinkedList<br></code></pre></td></tr></table></figure><h4 id="2ï¼‰ã€åˆ—è¡¨é›†åˆå¢åˆ æ”¹æŸ¥"><a href="#2ï¼‰ã€åˆ—è¡¨é›†åˆå¢åˆ æ”¹æŸ¥" class="headerlink" title="2ï¼‰ã€åˆ—è¡¨é›†åˆå¢åˆ æ”¹æŸ¥"></a>2ï¼‰ã€åˆ—è¡¨é›†åˆå¢åˆ æ”¹æŸ¥</h4><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs groovy"><span class="hljs-keyword">def</span> list = [<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>]<br><span class="hljs-comment">//-------------------------- å¢åŠ å…ƒç´  ---------------------------------</span><br><span class="hljs-comment">//æœ‰ä»¥ä¸‹å‡ ç§æ–¹å¼</span><br>list.add(<span class="hljs-number">20</span>)<br>list.leftShift(<span class="hljs-number">20</span>)<br>list &lt;&lt; <span class="hljs-number">20</span><br><br><span class="hljs-comment">//-------------------------- åˆ é™¤å…ƒç´  ---------------------------------</span><br><span class="hljs-comment">//æ ¹æ®ä¸‹æ ‡ç§»é™¤å…ƒç´ </span><br>list.remove(<span class="hljs-number">0</span>)<br><br><span class="hljs-comment">//-------------------------- ä¿®æ”¹å…ƒç´  ---------------------------------</span><br><span class="hljs-comment">//æ ¹æ®ä¸‹æ ‡ä¿®æ”¹å…ƒç´ </span><br>list[<span class="hljs-number">0</span>] = <span class="hljs-number">100</span><br><br><span class="hljs-comment">//-------------------------- æŸ¥è¯¢å…ƒç´  ---------------------------------</span><br><span class="hljs-comment">//è°ƒç”¨é—­åŒ…çš„ find æ–¹æ³•ï¼Œæ–¹æ³•ä¸­æ¥æ”¶ä¸€ä¸ªé—­åŒ…ï¼Œé—­åŒ…çš„å‚æ•°å°±æ˜¯ list ä¸­çš„å…ƒç´ </span><br>list.find &#123;<br>    println it<br>&#125;<br></code></pre></td></tr></table></figure><p>åˆ—è¡¨é›†åˆ Api æŒºå¤šçš„ï¼Œå¯¹äºä¸€äº›å…¶ä»–Apiï¼Œä½¿ç”¨åˆ°çš„æ—¶å€™è‡ªè¡ŒæŸ¥é˜…æ–‡æ¡£å°±å¥½äº†ï¼Œæˆ‘ä¼šåœ¨ä¸‹é¢è®² Map çš„æ—¶å€™æ¼”ç¤ºæŸ¥é˜… Api æ–‡æ¡£ç¡®å®šé—­åŒ…çš„å‚æ•°</p><h3 id="3ã€Map"><a href="#3ã€Map" class="headerlink" title="3ã€Map"></a>3ã€Map</h3><h4 id="1ï¼‰ã€å®šä¹‰"><a href="#1ï¼‰ã€å®šä¹‰" class="headerlink" title="1ï¼‰ã€å®šä¹‰"></a>1ï¼‰ã€å®šä¹‰</h4><p>1ã€Map è¡¨ç¤ºé”®-å€¼è¡¨ï¼Œå…¶åº•å±‚å¯¹åº” Java ä¸­çš„ LinkedHashMap</p><p>2ã€Map å˜é‡ç”±[:]å®šä¹‰ï¼Œå†’å·å·¦è¾¹æ˜¯ keyï¼Œå³è¾¹æ˜¯ Valueã€‚key å¿…é¡»æ˜¯å­—ç¬¦ä¸²ï¼Œvalue å¯ä»¥æ˜¯ä»»ä½•å¯¹è±¡</p><p>3ã€Map çš„ key å¯ä»¥ç”¨ â€˜â€™ æˆ– â€œâ€ æˆ– â€˜â€™â€™ â€˜â€™â€™åŒ…èµ·æ¥ï¼Œä¹Ÿå¯ä»¥ä¸ç”¨å¼•å·åŒ…èµ·æ¥</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs groovy"><span class="hljs-keyword">def</span> map = [<span class="hljs-attr">a:</span> <span class="hljs-number">1</span>, <span class="hljs-string">&#x27;b&#x27;</span>: <span class="hljs-literal">true</span>, <span class="hljs-string">&quot;c&quot;</span> : <span class="hljs-string">&quot;Groovy&quot;</span>, <span class="hljs-string">&#x27;&#x27;&#x27;d&#x27;&#x27;&#x27;</span> : <span class="hljs-string">&#x27;&#x27;&#x27;ddd&#x27;&#x27;&#x27;</span>]<br></code></pre></td></tr></table></figure><h4 id="2ï¼‰ã€Map-å¸¸ç”¨æ“ä½œ"><a href="#2ï¼‰ã€Map-å¸¸ç”¨æ“ä½œ" class="headerlink" title="2ï¼‰ã€Map å¸¸ç”¨æ“ä½œ"></a>2ï¼‰ã€Map å¸¸ç”¨æ“ä½œ</h4><p>è¿™é‡Œåˆ—ä¸¾ä¸€äº› Map çš„å¸¸ç”¨æ“ä½œï¼Œä¸€äº›å…¶ä»–çš„ Api ä½¿ç”¨åˆ°çš„æ—¶å€™è‡ªè¡ŒæŸ¥é˜…æ–‡æ¡£å°±å¥½äº†</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs groovy"><span class="hljs-comment">//---------------------------- Map ä¸­å…ƒç´ è®¿é—®æ“ä½œ ----------------</span><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * æœ‰å¦‚ä¸‹ä¸‰ç§æ–¹å¼ï¼š</span><br><span class="hljs-comment"> * 1ã€map.key</span><br><span class="hljs-comment"> * 2ã€map[key]</span><br><span class="hljs-comment"> * 3ã€map.get(ket)</span><br><span class="hljs-comment"> */</span><br>println map.a<br>println map[<span class="hljs-string">&#x27;b&#x27;</span>]<br>println map.get(<span class="hljs-string">&#x27;c&#x27;</span>)<br><span class="hljs-comment">//æ‰“å°ç»“æœ</span><br><span class="hljs-number">1</span><br><span class="hljs-literal">true</span><br>Groovy<br><br><span class="hljs-comment">//---------------------------- Map ä¸­æ·»åŠ å’Œä¿®æ”¹å…ƒç´  -------------------</span><br><span class="hljs-comment">//å¦‚æœå½“å‰ key åœ¨ map ä¸­ä¸å­˜åœ¨ï¼Œåˆ™æ·»åŠ è¯¥å…ƒç´ ï¼Œå¦‚æœå­˜åœ¨åˆ™ä¿®æ”¹è¯¥å…ƒç´ </span><br>map.put(<span class="hljs-string">&#x27;key&#x27;</span>,<span class="hljs-string">&#x27;value&#x27;</span>)<br>map[<span class="hljs-string">&#x27;key&#x27;</span>] = <span class="hljs-string">&quot;value&quot;</span><br></code></pre></td></tr></table></figure><h4 id="3ï¼‰ã€Map-éå†ï¼Œæ¼”ç¤ºæŸ¥é˜…å®˜æ–¹æ–‡æ¡£"><a href="#3ï¼‰ã€Map-éå†ï¼Œæ¼”ç¤ºæŸ¥é˜…å®˜æ–¹æ–‡æ¡£" class="headerlink" title="3ï¼‰ã€Map éå†ï¼Œæ¼”ç¤ºæŸ¥é˜…å®˜æ–¹æ–‡æ¡£"></a>3ï¼‰ã€Map éå†ï¼Œæ¼”ç¤ºæŸ¥é˜…å®˜æ–¹æ–‡æ¡£</h4><p>ç°åœ¨æˆ‘è¦å»éå† map ä¸­çš„å…ƒç´ ï¼Œä½†æ˜¯æˆ‘ä¸çŸ¥é“å®ƒçš„ Api æ˜¯å•¥ï¼Œé‚£è¿™ä¸ªæ—¶å€™å°±è¦å»æŸ¥å®˜æ–¹ Api æ–‡æ¡£äº†ï¼š</p><p><a href="http://docs.groovy-lang.org/latest/html/groovy-jdk/java/util/Map.html">http://docs.groovy-lang.org/latest/html/groovy-jdk/java/util/Map.html</a></p><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/4464fad1d3cc40ab976f7be47d3817e4~tplv-k3u1fbpfcp-zoom-1.image" alt="each"></p><p>æˆ‘ä»¬æŸ¥åˆ° Map æœ‰ each å’Œ eachWithIndex è¿™ä¸¤ä¸ª Api å¯ä»¥å»æ‰§è¡Œéå†æ“ä½œï¼Œæ¥ç€ç‚¹è¿›å»çœ‹ä¸€çœ¼</p><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/e387d37247c04f09873546c4199e8297~tplv-k3u1fbpfcp-zoom-1.image" alt="image-20210312113131770"></p><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/6055f46014fc48b0a0f2193db6d9e92b~tplv-k3u1fbpfcp-zoom-1.image" alt="image-20210312113208713"></p><p>é€šè¿‡å®˜æ–¹æ–‡æ¡£æˆ‘ä»¬å¯ä»¥å‘ç°: <strong>each å’Œ eachWithIndex çš„é—­åŒ…å‚æ•°è¿˜æ˜¯ä¸ç¡®å®šçš„ï¼Œå¦‚æœæˆ‘ä»¬ä½¿ç”¨ each æ–¹æ³•ï¼Œå¦‚æœä¼ é€’ç»™é—­åŒ…æ˜¯ä¸€ä¸ªå‚æ•°ï¼Œé‚£ä¹ˆå®ƒå°±æŠŠ entry ä½œä¸ºå‚æ•°ï¼Œå¦‚æœæˆ‘ä»¬ä¼ é€’ç»™é—­åŒ…æ˜¯ä¸¤ä¸ªå‚æ•°ï¼Œé‚£ä¹ˆå®ƒå°±æŠŠ key å’Œ value ä½œä¸ºå‚æ•°ï¼ŒeachWithIndex æ¯” each å¤šäº†ä¸ª index ä¸‹æ ‡è€Œå·².</strong></p><p>é‚£ä¹ˆæˆ‘ä»¬ç°åœ¨å°±ä½¿ç”¨ä»¥ä¸‹è¿™ä¸¤ä¸ª Api ï¼š</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs groovy"><span class="hljs-comment">//ä¸‹é¢ä¸ºäº†æ‰“å°è¾“å‡ºçš„æ ¼å¼æ¸…æ™°ï¼Œåšäº†ä¸€äº›é¢å¤–çš„æ“ä½œ</span><br><span class="hljs-keyword">def</span> map = [<span class="hljs-attr">a:</span> <span class="hljs-number">1</span>, <span class="hljs-string">&#x27;b&#x27;</span>: <span class="hljs-literal">true</span>, <span class="hljs-string">&quot;c&quot;</span> : <span class="hljs-string">&quot;Groovy&quot;</span>, <span class="hljs-string">&#x27;&#x27;&#x27;d&#x27;&#x27;&#x27;</span> : <span class="hljs-string">&#x27;&#x27;&#x27;ddd&#x27;&#x27;&#x27;</span>]<br><br>map.each &#123;<br>    print <span class="hljs-string">&quot;$it.key $it.value \t&quot;</span><br>&#125;<br>println()<br><br>map.each &#123;key,value -&gt;<br>    print <span class="hljs-string">&quot;$key $value \t&quot;</span><br>&#125;<br>println()<br><br>map.eachWithIndex &#123;entry,index -&gt;<br>    print <span class="hljs-string">&quot;$entry.key $entry.value $index \t&quot;</span><br>&#125;<br>println()<br><br>map.eachWithIndex &#123; key,value,index -&gt;<br>    print <span class="hljs-string">&quot;$key $value $index \t&quot;</span><br>&#125;<br><span class="hljs-comment">//æ‰“å°ç»“æœ</span><br>a <span class="hljs-number">1</span> b <span class="hljs-literal">true</span> c Groovy d ddd <br>a <span class="hljs-number">1</span> b <span class="hljs-literal">true</span> c Groovy d ddd <br>a <span class="hljs-number">1</span> <span class="hljs-number">0</span> b <span class="hljs-literal">true</span> <span class="hljs-number">1</span> c Groovy <span class="hljs-number">2</span> d ddd <span class="hljs-number">3</span> <br>a <span class="hljs-number">1</span> <span class="hljs-number">0</span> b <span class="hljs-literal">true</span> <span class="hljs-number">1</span> c Groovy <span class="hljs-number">2</span> d ddd <span class="hljs-number">3</span> <br></code></pre></td></tr></table></figure><h3 id="4ã€Range"><a href="#4ã€Range" class="headerlink" title="4ã€Range"></a>4ã€Range</h3><p>Range è¡¨ç¤ºèŒƒå›´ï¼Œå®ƒå…¶å®æ˜¯ <strong>List çš„ä¸€ç§æ‹“å±•ã€‚å…¶ç”± begin å€¼ + ä¸¤ä¸ªç‚¹ + end å€¼è¡¨ç¤ºã€‚å¦‚æœä¸æƒ³åŒ…å«æœ€åä¸€ä¸ªå…ƒç´ ï¼Œåˆ™ begin å€¼ + ä¸¤ä¸ªç‚¹ + &lt; + end è¡¨ç¤ºã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡ aRange.from ä¸ aRange.to æ¥è·å¯¹åº”çš„è¾¹ç•Œå…ƒç´ </strong>ï¼Œå®é™…æ“ä½œæ„Ÿå—ä¸€ä¸‹ï¼š</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs groovy"><span class="hljs-comment">//å®šä¹‰ä¸€ä¸ªä¸¤ç«¯éƒ½æ˜¯é—­åŒºé—´çš„èŒƒå›´</span><br><span class="hljs-keyword">def</span> range = <span class="hljs-number">1.</span><span class="hljs-number">.10</span><br>range.each &#123;<br>    print it + <span class="hljs-string">&quot; &quot;</span><br>&#125;<br><span class="hljs-comment">//æ‰“å°å€¼</span><br><span class="hljs-number">1</span> <span class="hljs-number">2</span> <span class="hljs-number">3</span> <span class="hljs-number">4</span> <span class="hljs-number">5</span> <span class="hljs-number">6</span> <span class="hljs-number">7</span> <span class="hljs-number">8</span> <span class="hljs-number">9</span> <span class="hljs-number">10</span><br><br><span class="hljs-comment">//å¦‚æœä¸æƒ³åŒ…å«æœ€åä¸€ä¸ªå…ƒç´ </span><br><span class="hljs-keyword">def</span> range1 = <span class="hljs-number">1.</span>.&lt;<span class="hljs-number">10</span><br>range1.each &#123;<br>    print it + <span class="hljs-string">&quot; &quot;</span><br>&#125;<br><span class="hljs-comment">//æ‰“å°ç»“æœ</span><br><span class="hljs-number">1</span> <span class="hljs-number">2</span> <span class="hljs-number">3</span> <span class="hljs-number">4</span> <span class="hljs-number">5</span> <span class="hljs-number">6</span> <span class="hljs-number">7</span> <span class="hljs-number">8</span> <span class="hljs-number">9</span><br><br><span class="hljs-comment">//æ‰“å°å¤´å°¾è¾¹ç•Œå…ƒç´ </span><br>println <span class="hljs-string">&quot;$range1.from $range1.to&quot;</span><br><span class="hljs-comment">//æ‰“å°ç»“æœ</span><br><span class="hljs-number">1</span> <span class="hljs-number">9</span><br></code></pre></td></tr></table></figure><h2 id="å…­ã€Groovy-æ–‡ä»¶å¤„ç†"><a href="#å…­ã€Groovy-æ–‡ä»¶å¤„ç†" class="headerlink" title="å…­ã€Groovy æ–‡ä»¶å¤„ç†"></a>å…­ã€Groovy æ–‡ä»¶å¤„ç†</h2><h3 id="1ã€IO"><a href="#1ã€IO" class="headerlink" title="1ã€IO"></a>1ã€IO</h3><p>ä¸€äº› IO å¸¸ç”¨çš„ Api æ“ä½œï¼Œæˆ‘ä»¬ç›´æ¥ä¸Šä»£ç çœ‹æ•ˆæœï¼Œä»£ç ä¼šå†™ä¸Šæ¸…æ™°çš„æ³¨é‡Šï¼š</p><p>å‡†å¤‡å·¥ä½œï¼šæˆ‘åœ¨å½“å‰è„šæœ¬æ–‡ä»¶çš„åŒçº§ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ª testFile.txt æ–‡ä»¶ï¼Œé‡Œé¢éšä¾¿å…ˆå†™å…¥ä¸€äº›å­—ç¬¦ä¸²ï¼Œå¦‚ä¸‹å›¾ï¼š</p><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/e0faeb77e2cc4e6eb42d3810dadf6d82~tplv-k3u1fbpfcp-zoom-1.image" alt="image-20210312144116084"></p><p>ä¸‹é¢æˆ‘ä»¬å¼€å§‹æ¥æ“ä½œè¿™ä¸ªæ–‡ä»¶ï¼Œä¸ºäº†é—­åŒ…çš„å¯è¯»æ€§ï¼Œæˆ‘ä¼šåœ¨é—­åŒ…ä¸ŠåŠ ä¸Šç±»å‹å’Œå‚æ•°ï¼š</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><code class="hljs groovy"><span class="hljs-comment">//-------------------------------1ã€æ–‡ä»¶å®šä½ --------------------------------</span><br><span class="hljs-keyword">def</span> file = <span class="hljs-keyword">new</span> File(<span class="hljs-string">&#x27;testFile.txt&#x27;</span>)<br><br><span class="hljs-comment">//-----------------------2ã€ä½¿ç”¨ eachLine Api æ¯æ¬¡è¯»å–ä¸€è¡Œ, é—­åŒ…å‚æ•°æ˜¯æ¯ä¸€è¡Œçš„å­—ç¬¦ä¸²------------</span><br>file.eachLine &#123; String line -&gt;<br>    println line<br>&#125;<br><span class="hljs-comment">//æ‰“å°ç»“æœ</span><br>erdai666<br>erdai777<br>erdai888<br><br><span class="hljs-comment">//------------------------3ã€è·å–è¾“å…¥æµ,è¾“å‡ºæµè¯»æ–‡ä»¶å’Œå†™æ–‡ä»¶---------------------------------</span><br><span class="hljs-comment">//è·å–è¾“å…¥æµè¯»å–æ–‡ä»¶çš„æ¯ä¸€è¡Œ</span><br><span class="hljs-comment">//1</span><br>file.withInputStream &#123; InputStream inputStream -&gt;<br>    inputStream.eachLine &#123; String it -&gt;<br>        println it<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">//2</span><br>file.withReader &#123; BufferedReader it -&gt;<br>    it.readLines().each &#123; String it -&gt;<br>        println it<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">//æ‰“å°ç»“æœ</span><br>erdai666<br>erdai777<br>erdai888<br><br><span class="hljs-comment">//è·å–è¾“å‡ºæµå°†å­—ç¬¦ä¸²å†™å…¥æ–‡ä»¶ ä¸‹é¢è¿™ä¸¤ç§æ–¹å¼å†™å…¥çš„æ–‡ä»¶å†…å®¹ä¼šæŠŠä¹‹å‰çš„å†…å®¹ç»™è¦†ç›–</span><br><span class="hljs-comment">//1</span><br>file.withOutputStream &#123; OutputStream outputStream -&gt;<br>    outputStream.write(<span class="hljs-string">&quot;erdai999&quot;</span>.getBytes())<br>&#125;<br><br><span class="hljs-comment">//2</span><br>file.withWriter &#123; BufferedWriter it -&gt;<br>    it.write(<span class="hljs-string">&#x27;erdai999&#x27;</span>)<br>&#125;<br><br><span class="hljs-comment">//------------------------4ã€é€šè¿‡è¾“å…¥è¾“å‡ºæµå®ç°æ–‡ä»¶æ‹·è´åŠŸèƒ½---------------------------------</span><br><span class="hljs-comment">//1ã€é€šè¿‡ withOutputStream withInputStream å®ç°æ–‡ä»¶æ‹·è´</span><br><span class="hljs-keyword">def</span> targetFile = <span class="hljs-keyword">new</span> File(<span class="hljs-string">&#x27;testFile1.txt&#x27;</span>)<br>targetFile.withOutputStream &#123; OutputStream outputStream -&gt;<br>    file.withInputStream &#123; InputStream inputStream -&gt;<br>        outputStream &lt;&lt; inputStream<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">//2ã€é€šè¿‡ withReaderã€withWriter å®ç°æ–‡ä»¶æ‹·è´</span><br>targetFile.withWriter &#123;BufferedWriter bufferedWriter -&gt;<br>    file.withReader &#123;BufferedReader bufferedReader -&gt;<br>        bufferedReader.eachLine &#123;String line -&gt;<br>            bufferedWriter.write(line + <span class="hljs-string">&quot;\r\n&quot;</span>)<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="2ã€XML-æ–‡ä»¶æ“ä½œ"><a href="#2ã€XML-æ–‡ä»¶æ“ä½œ" class="headerlink" title="2ã€XML æ–‡ä»¶æ“ä½œ"></a>2ã€XML æ–‡ä»¶æ“ä½œ</h3><h4 id="1ï¼‰ã€è§£æ-XML-æ–‡ä»¶"><a href="#1ï¼‰ã€è§£æ-XML-æ–‡ä»¶" class="headerlink" title="1ï¼‰ã€è§£æ XML æ–‡ä»¶"></a>1ï¼‰ã€è§£æ XML æ–‡ä»¶</h4><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><code class="hljs groovy"><span class="hljs-comment">//å®šä¹‰ä¸€ä¸ªå¸¦æ ¼å¼çš„ xml å­—ç¬¦ä¸²</span><br><span class="hljs-keyword">def</span> xml = <span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">    &lt;response&gt;</span><br><span class="hljs-string">        &lt;value&gt;</span><br><span class="hljs-string">            &lt;books id=&quot;1&quot; classification=&quot;android&quot;&gt;</span><br><span class="hljs-string">                &lt;book available=&quot;14&quot; id=&quot;2&quot;&gt;</span><br><span class="hljs-string">                   &lt;title&gt;ç¬¬ä¸€è¡Œä»£ç &lt;/title&gt;</span><br><span class="hljs-string">                   &lt;author id=&quot;2&quot;&gt;éƒ­éœ–&lt;/author&gt;</span><br><span class="hljs-string">               &lt;/book&gt;</span><br><span class="hljs-string">               &lt;book available=&quot;13&quot; id=&quot;3&quot;&gt;</span><br><span class="hljs-string">                   &lt;title&gt;Androidå¼€å‘è‰ºæœ¯æ¢ç´¢&lt;/title&gt;</span><br><span class="hljs-string">                   &lt;author id=&quot;3&quot;&gt;ä»»ç‰åˆš&lt;/author&gt;</span><br><span class="hljs-string">               &lt;/book&gt;</span><br><span class="hljs-string">           &lt;/books&gt;</span><br><span class="hljs-string">       &lt;/value&gt;</span><br><span class="hljs-string">    &lt;/response&gt;</span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-comment">//åˆ›å»º XmlSlurper ç±»å¯¹è±¡ï¼Œè§£æ XML æ–‡ä»¶ä¸»è¦å€ŸåŠ© XmlSlurper è¿™ä¸ªç±»</span><br><span class="hljs-keyword">def</span> xmlSlurper = <span class="hljs-keyword">new</span> XmlSlurper()<br><span class="hljs-comment">//è§£æ mxl è¿”å› response æ ¹ç»“ç‚¹å¯¹è±¡</span><br><span class="hljs-keyword">def</span> response = xmlSlurper.parseText(xml)<br><span class="hljs-comment">//æ‰“å°ä¸€äº›ç»“æœ</span><br>println response.value.books[<span class="hljs-number">0</span>].book[<span class="hljs-number">0</span>].title.text()<br>println response.value.books[<span class="hljs-number">0</span>].book[<span class="hljs-number">0</span>].author.text()<br><span class="hljs-comment">//æ‰“å°ç»“æœ</span><br>ç¬¬ä¸€è¡Œä»£ç <br>éƒ­éœ–<br><br><span class="hljs-comment">//1ã€ä½¿ç”¨è¿­ä»£å™¨è§£æ</span><br>response.value.books.each&#123; books -&gt;<br>    books.book.each&#123; book -&gt;<br>        println book.title<br>        println book.author <br>    &#125;<br>&#125;<br><span class="hljs-comment">//æ‰“å°ç»“æœ</span><br>ç¬¬ä¸€è¡Œä»£ç <br>éƒ­éœ–<br>Androidå¼€å‘è‰ºæœ¯æ¢ç´¢<br>ä»»ç‰åˆš<br><br><span class="hljs-comment">//2ã€æ·±åº¦éå† XML æ•°æ®</span><br><span class="hljs-keyword">def</span> str1 = response.depthFirst().findAll &#123; book -&gt;<br>    <span class="hljs-keyword">return</span> book.author == <span class="hljs-string">&#x27;éƒ­éœ–&#x27;</span><br>&#125;<br>println str1<br><span class="hljs-comment">//æ‰“å°ç»“æœ</span><br>[ç¬¬ä¸€è¡Œä»£ç éƒ­éœ–]<br><br><span class="hljs-comment">//3ã€å¹¿åº¦éå† XML æ•°æ®</span><br><span class="hljs-keyword">def</span> str2 = response.value.books.children().findAll&#123; node -&gt;<br>    node.name() == <span class="hljs-string">&#x27;book&#x27;</span> &amp;&amp; node.<span class="hljs-meta">@id</span> == <span class="hljs-string">&#x27;2&#x27;</span><br>&#125;.collect &#123; node -&gt;<br>    <span class="hljs-string">&quot;$node.title $node.author&quot;</span><br>&#125;<br>println str2<br><span class="hljs-comment">//æ‰“å°ç»“æœ</span><br>[ç¬¬ä¸€è¡Œä»£ç  éƒ­éœ–]<br></code></pre></td></tr></table></figure><h4 id="2-ã€ç”Ÿæˆ-XML-æ–‡ä»¶"><a href="#2-ã€ç”Ÿæˆ-XML-æ–‡ä»¶" class="headerlink" title="2)ã€ç”Ÿæˆ XML æ–‡ä»¶"></a>2)ã€ç”Ÿæˆ XML æ–‡ä»¶</h4><p>ä¸Šé¢æˆ‘ä»¬ä½¿ç”¨ XmlSlurper è¿™ä¸ªç±»è§£æäº† XMLï¼Œç°åœ¨æˆ‘ä»¬å€ŸåŠ© MarkupBuilder æ¥ç”Ÿæˆ XML ,ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><code class="hljs groovy"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * &lt;response&gt;</span><br><span class="hljs-comment"> *      &lt;value&gt;</span><br><span class="hljs-comment"> *          &lt;books id=&quot;1&quot; classification=&quot;android&quot;&gt;</span><br><span class="hljs-comment"> *              &lt;book available=&quot;14&quot; id=&quot;2&quot;&gt;</span><br><span class="hljs-comment"> *                 &lt;title&gt;ç¬¬ä¸€è¡Œä»£ç &lt;/title&gt;</span><br><span class="hljs-comment"> *                 &lt;author id=&quot;2&quot;&gt;éƒ­éœ–&lt;/author&gt;</span><br><span class="hljs-comment"> *             &lt;/book&gt;</span><br><span class="hljs-comment"> *             &lt;book available=&quot;13&quot; id=&quot;3&quot;&gt;</span><br><span class="hljs-comment"> *                 &lt;title&gt;Androidå¼€å‘è‰ºæœ¯æ¢ç´¢&lt;/title&gt;</span><br><span class="hljs-comment"> *                 &lt;author id=&quot;3&quot;&gt;ä»»ç‰åˆš&lt;/author&gt;</span><br><span class="hljs-comment"> *             &lt;/book&gt;</span><br><span class="hljs-comment"> *         &lt;/books&gt;</span><br><span class="hljs-comment"> *     &lt;/value&gt;</span><br><span class="hljs-comment"> * &lt;/response&gt;</span><br><span class="hljs-comment"> */</span><br><span class="hljs-comment">//æ–¹å¼1ï¼šé€šè¿‡ä¸‹é¢è¿™ç§æ–¹å¼ å°±å¯ä»¥å®ç°ä¸Šé¢çš„æ•ˆæœï¼Œä½†æ˜¯è¿™ç§æ–¹å¼æœ‰ä¸ªå¼Šç«¯ï¼Œæ•°æ®éƒ½æ˜¯å†™æ­»çš„</span><br><span class="hljs-keyword">def</span> sw = <span class="hljs-keyword">new</span> StringWriter()<br><span class="hljs-keyword">def</span> xmlBuilder = <span class="hljs-keyword">new</span> MarkupBuilder(sw)<br>xmlBuilder.response&#123;<br>    value&#123;<br>        books(<span class="hljs-attr">id:</span> <span class="hljs-string">&#x27;1&#x27;</span>,<span class="hljs-attr">classification:</span> <span class="hljs-string">&#x27;android&#x27;</span>)&#123;<br>            book(<span class="hljs-attr">available:</span> <span class="hljs-string">&#x27;14&#x27;</span>,<span class="hljs-attr">id:</span> <span class="hljs-string">&#x27;2&#x27;</span>)&#123;<br>                title(<span class="hljs-string">&#x27;ç¬¬ä¸€è¡Œä»£ç &#x27;</span>)<br>                author(<span class="hljs-attr">id:</span> <span class="hljs-string">&#x27;2&#x27;</span> ,<span class="hljs-string">&#x27;éƒ­éœ–&#x27;</span>)<br>            &#125;<br>            book(<span class="hljs-attr">available:</span> <span class="hljs-string">&#x27;13&#x27;</span>,<span class="hljs-attr">id:</span> <span class="hljs-string">&#x27;3&#x27;</span>)&#123;<br>                title(<span class="hljs-string">&#x27;Androidå¼€å‘è‰ºæœ¯æ¢ç´¢&#x27;</span>)<br>                author(<span class="hljs-attr">id:</span> <span class="hljs-string">&#x27;3&#x27;</span> ,<span class="hljs-string">&#x27;ä»»ç‰åˆš&#x27;</span>)<br>            &#125;<br>        &#125;<br>    &#125;<br>&#125;<br>println sw<br><br><span class="hljs-comment">//æ–¹å¼2ï¼šå°† XML æ•°æ®å¯¹åº”åˆ›å»ºç›¸åº”çš„æ•°æ®æ¨¡å‹ï¼Œå°±åƒæˆ‘ä»¬è§£æ Json åˆ›å»ºç›¸åº”çš„æ•°æ®æ¨¡å‹æ˜¯ä¸€æ ·çš„</span><br><span class="hljs-comment">//åˆ›å»º XML å¯¹åº”æ•°æ®æ¨¡å‹</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Response</span> &#123;<br>    <br>    <span class="hljs-keyword">def</span> value = <span class="hljs-keyword">new</span> Value()<br><br>    <span class="hljs-keyword">class</span> <span class="hljs-title class_">Value</span> &#123;<br><br>        <span class="hljs-keyword">def</span> books = <span class="hljs-keyword">new</span> Books(<span class="hljs-attr">id:</span> <span class="hljs-string">&#x27;1&#x27;</span>, <span class="hljs-attr">classification:</span> <span class="hljs-string">&#x27;android&#x27;</span>)<br><br>        <span class="hljs-keyword">class</span> <span class="hljs-title class_">Books</span> &#123;<br>            <span class="hljs-keyword">def</span> id<br>            <span class="hljs-keyword">def</span> classification<br>            <span class="hljs-keyword">def</span> book = [<span class="hljs-keyword">new</span> Book(<span class="hljs-attr">available:</span> <span class="hljs-string">&#x27;14&#x27;</span>, <span class="hljs-attr">id:</span> <span class="hljs-string">&#x27;2&#x27;</span>, <span class="hljs-attr">title:</span> <span class="hljs-string">&#x27;ç¬¬ä¸€è¡Œä»£ç &#x27;</span>, <span class="hljs-attr">authorId:</span> <span class="hljs-number">2</span>, <span class="hljs-attr">author:</span> <span class="hljs-string">&#x27;éƒ­éœ–&#x27;</span>),<br>               <span class="hljs-keyword">new</span> Book(<span class="hljs-attr">available:</span> <span class="hljs-string">&#x27;13&#x27;</span>, <span class="hljs-attr">id:</span> <span class="hljs-string">&#x27;3&#x27;</span>, <span class="hljs-attr">title:</span> <span class="hljs-string">&#x27;Androidå¼€å‘è‰ºæœ¯æ¢ç´¢&#x27;</span>, <span class="hljs-attr">authorId:</span> <span class="hljs-number">3</span>, <span class="hljs-attr">author:</span> <span class="hljs-string">&#x27;ä»»ç‰åˆš&#x27;</span>)]<br><br>            <span class="hljs-keyword">class</span> <span class="hljs-title class_">Book</span> &#123;<br>                <span class="hljs-keyword">def</span> available<br>                <span class="hljs-keyword">def</span> id<br>                <span class="hljs-keyword">def</span> title<br>                <span class="hljs-keyword">def</span> authorId<br>                <span class="hljs-keyword">def</span> author<br>            &#125;<br>        &#125;<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">//åˆ›å»º response å¯¹è±¡</span><br><span class="hljs-keyword">def</span> response = <span class="hljs-keyword">new</span> Response()<br><span class="hljs-comment">//æ„å»º XML </span><br>xmlBuilder.response&#123;<br>    value&#123;<br>        books(<span class="hljs-attr">id:</span> response.value.books.id,<span class="hljs-attr">classification:</span> response.value.books.classification)&#123;<br>            response.value.books.book.each&#123;<br>                <span class="hljs-keyword">def</span> book1 = it<br>                book(<span class="hljs-attr">available:</span> it.available,<span class="hljs-attr">id:</span> it.id)&#123;<br>                    title(book1.title)<br>                    author(<span class="hljs-attr">authorId:</span> book1.authorId,book1.author)<br>                &#125;<br>            &#125;<br>        &#125;<br>    &#125;<br>&#125;<br>println sw<br></code></pre></td></tr></table></figure><h3 id="3ã€Json-è§£æ"><a href="#3ã€Json-è§£æ" class="headerlink" title="3ã€Json è§£æ"></a>3ã€Json è§£æ</h3><p>Jsonè§£æä¸»è¦æ˜¯é€šè¿‡ JsonSlurper è¿™ä¸ªç±»å®ç°çš„ï¼Œè¿™æ ·æˆ‘ä»¬åœ¨å†™æ’ä»¶çš„æ—¶å€™å°±ä¸éœ€è¦é¢å¤–å¼•å…¥ç¬¬ä¸‰æ–¹çš„ Json è§£æåº“äº†ï¼Œå…¶ç¤ºä¾‹ä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs groovy"><span class="hljs-comment">//å‘é€è¯·æ±‚è·å–æœåŠ¡å™¨å“åº”çš„æ•°æ®</span><br><span class="hljs-keyword">def</span> response = getNetWorkData(<span class="hljs-string">&quot;https://www.wanandroid.com/banner/json&quot;</span>)<br>println response.data[<span class="hljs-number">0</span>].desc<br>println response.data[<span class="hljs-number">0</span>].imagePath<br><br><span class="hljs-keyword">def</span> getNetWorkData(String url)&#123;<br>    <span class="hljs-keyword">def</span> connect = <span class="hljs-keyword">new</span> URL(url).openConnection()<br>    connect.setRequestMethod(<span class="hljs-string">&quot;GET&quot;</span>)<br>    <span class="hljs-comment">//è¿™ä¸ªä¼šé˜»å¡çº¿ç¨‹ åœ¨Androidä¸­ä¸èƒ½è¿™æ ·æ“ä½œ ä½†æ˜¯åœ¨æ¡Œé¢ç¨‹åºæ˜¯å¯ä»¥çš„</span><br>    connect.connect()<br>    <span class="hljs-keyword">def</span> response = connect.content.text<br><br>    <span class="hljs-comment">//jsonè½¬å®ä½“å¯¹è±¡</span><br>    <span class="hljs-keyword">def</span> jsonSlurper = <span class="hljs-keyword">new</span> JsonSlurper()<br>    jsonSlurper.parseText(response)<br>&#125;<br><span class="hljs-comment">//æ‰“å°ç»“æœ</span><br>æ‰”ç‰©çº¿<br><span class="hljs-attr">https:</span><span class="hljs-comment">//wanandroid.com/blogimgs/8a0131ac-05b7-4b6c-a8d0-f438678834ba.png</span><br></code></pre></td></tr></table></figure><h2 id="7ã€æ€»ç»“"><a href="#7ã€æ€»ç»“" class="headerlink" title="7ã€æ€»ç»“"></a>7ã€æ€»ç»“</h2><p>åœ¨æœ¬ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬ä¸»è¦ä»‹ç»äº†ä»¥ä¸‹å‡ ä¸ªéƒ¨åˆ†ï¼š</p><p>1ã€ä¸€äº›å…³äº Gradle ï¼ŒGroovy çš„é—®é¢˜</p><p>2ã€æ­å»º Groovy å¼€å‘ç¯å¢ƒï¼Œåˆ›å»ºä¸€ä¸ª Groovy å·¥ç¨‹</p><p>3ã€è®²è§£äº† Groovy çš„ä¸€äº›åŸºç¡€è¯­æ³•</p><p>4ã€å¯¹é—­åŒ…è¿›è¡Œäº†æ·±å…¥çš„è®²è§£</p><p>5ã€è®²è§£äº† Groovy ä¸­çš„æ•°æ®ç»“æ„å’Œå¸¸ç”¨ Api ä½¿ç”¨ï¼Œå¹¶ä»¥ Map ä¸¾ä¾‹ï¼ŒæŸ¥é˜…å®˜æ–¹æ–‡æ¡£å»ç¡®å®š Api çš„ä½¿ç”¨å’Œé—­åŒ…çš„å‚æ•°</p><p>6ã€è®²è§£äº† Groovy æ–‡ä»¶ç›¸å…³çš„å¤„ç†</p><p>å­¦ä¹ äº† Groovy ï¼Œå¯¹äºæˆ‘ä»¬åç»­è‡ªå®šä¹‰ Gradle æ’ä»¶è¿ˆå‡ºäº†å…³é”®çš„ä¸€æ­¥ã€‚å…¶æ¬¡å¦‚æœä½ å­¦ä¹ è¿‡ Kotlin ï¼Œä½ ä¼šå‘ç°ï¼Œå®ƒä»¬çš„è¯­æ³•éå¸¸çš„ç±»ä¼¼ï¼Œå› æ­¤å¯¹äºåç»­å­¦ä¹  Kotlin æˆ‘ä»¬ä¹Ÿå¯ä»¥å¿«é€Ÿå»ä¸Šæ‰‹ã€‚</p><h3 id="å‚è€ƒå’Œæ¨è"><a href="#å‚è€ƒå’Œæ¨è" class="headerlink" title="å‚è€ƒå’Œæ¨è"></a>å‚è€ƒå’Œæ¨è</h3><p><a href="https://juejin.cn/post/6844904128594853902#heading-87">æ·±åº¦æ¢ç´¢ Gradle è‡ªåŠ¨åŒ–æ„å»ºæŠ€æœ¯ï¼ˆäºŒã€Groovy ç­‘åŸºç¯‡</a></p><p><a href="https://juejin.cn/post/6888977881679495175#heading-0">Gradle çˆ¬å‘æŒ‡å— â€“ æ¦‚å¿µåˆè§£ã€Grovvy è¯­æ³•ã€å¸¸è§ API</a></p><p><a href="https://yanbober.blog.csdn.net/article/details/109560923">Groovy æœ¬è´¨åˆæ¢åŠé—­åŒ…ç‰¹æ€§åŸç†æ€»ç»“</a></p><p><a href="https://blog.csdn.net/singwhatiwanna/article/details/76084580">Gradleä»å…¥é—¨åˆ°å®æˆ˜ - GroovyåŸºç¡€</a></p><p><a href="https://coding.imooc.com/class/206.html#Anchor">æ…•è¯¾ç½‘ä¹‹Gradle3.0è‡ªåŠ¨åŒ–é¡¹ç›®æ„å»ºæŠ€æœ¯ç²¾è®²+å®æˆ˜</a></p><blockquote><p><strong>ä½ çš„ç‚¹èµï¼Œè¯„è®ºï¼Œæ˜¯å¯¹æˆ‘å·¨å¤§çš„é¼“åŠ±ï¼</strong></p><p>æ¬¢è¿å…³æ³¨æˆ‘çš„<strong>å…¬ä¼—å·ï¼š</strong>  <a href="http://m6z.cn/6jwi7b"><strong>sweetying</strong></a> ï¼Œæ–‡ç« æ›´æ–°å¯ç¬¬ä¸€æ—¶é—´æ”¶åˆ°</p><p>å¦‚æœ<strong>æœ‰é—®é¢˜</strong>ï¼Œå…¬ä¼—å·å†…æœ‰åŠ æˆ‘å¾®ä¿¡çš„å…¥å£ï¼Œåœ¨æŠ€æœ¯å­¦ä¹ ã€ä¸ªäººæˆé•¿çš„é“è·¯ä¸Šï¼Œæˆ‘ä»¬ä¸€èµ·å‰è¿›ï¼</p></blockquote>]]></content>
    
    
    <categories>
      
      <category>Android</category>
      
      <category>Gradle</category>
      
    </categories>
    
    
    <tags>
      
      <tag>åŸåˆ›</tag>
      
      <tag>Android</tag>
      
      <tag>Gradle</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Android APT ç³»åˆ— ï¼ˆå››ï¼‰ï¼šAPT å®æˆ˜åº”ç”¨</title>
    <link href="/2022/10/10/Android%20APT%20%E7%B3%BB%E5%88%97%20%EF%BC%88%E5%9B%9B%EF%BC%89%EF%BC%9AAPT%20%E5%AE%9E%E6%88%98%E5%BA%94%E7%94%A8/"/>
    <url>/2022/10/10/Android%20APT%20%E7%B3%BB%E5%88%97%20%EF%BC%88%E5%9B%9B%EF%BC%89%EF%BC%9AAPT%20%E5%AE%9E%E6%88%98%E5%BA%94%E7%94%A8/</url>
    
    <content type="html"><![CDATA[<p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/e512d8f772004386b721956bfccb2e71~tplv-k3u1fbpfcp-watermark.image"></p><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>å¾ˆé«˜å…´é‡è§ä½ ~</p><p>åœ¨æœ¬ç³»åˆ—çš„ä¸Šä¸€ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å¯¹ APT æŠ€æœ¯è¿›è¡Œäº†è®²è§£ï¼Œè¿˜æ²¡æœ‰çœ‹è¿‡ä¸Šä¸€ç¯‡æ–‡ç« çš„æœ‹å‹ï¼Œå»ºè®®å…ˆå»é˜…è¯» <a href="https://juejin.cn/post/6978500975770206239">Android APT ç³»åˆ— ï¼ˆä¸‰ï¼‰ï¼šAPT æŠ€æœ¯æ¢ç©¶</a>ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°±ä½¿ç”¨ APT æŠ€æœ¯æ¥è¿›è¡Œå®æˆ˜åº”ç”¨ã€‚</p><p><a href="https://github.com/sweetying520/AptDemo">Github Demo åœ°å€</a> , å¤§å®¶å¯ä»¥çœ‹ Demo è·Ÿéšæˆ‘çš„æ€è·¯ä¸€èµ·åˆ†æ</p><h2 id="å›é¡¾"><a href="#å›é¡¾" class="headerlink" title="å›é¡¾"></a>å›é¡¾</h2><p>åœ¨æœ¬ç³»åˆ—çš„å¼€ç¯‡ï¼Œæˆ‘è®²äº†åœ¨é¡¹ç›®å®è·µè¿‡ç¨‹ä¸­åšçš„ä¸€ä¸ªå¸ƒå±€ä¼˜åŒ–ï¼ŒAndroid ä¸­å°‘é‡çš„ç³»ç»Ÿæ§ä»¶æ˜¯é€šè¿‡ <code>new</code> çš„æ–¹å¼åˆ›å»ºå‡ºæ¥çš„ï¼Œè€Œå¤§éƒ¨åˆ†æ§ä»¶å¦‚ <code>androidx.appcompat.widget</code> ä¸‹çš„æ§ä»¶ï¼Œè‡ªå®šä¹‰æ§ä»¶ï¼Œç¬¬ä¸‰æ–¹æ§ä»¶ç­‰ç­‰ï¼Œéƒ½æ˜¯é€šè¿‡åå°„åˆ›å»ºçš„ã€‚å¤§é‡çš„åå°„åˆ›å»ºå¤šå¤šå°‘å°‘ä¼šå¸¦æ¥ä¸€äº›æ€§èƒ½é—®é¢˜ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦å»è§£å†³åå°„åˆ›å»ºçš„é—®é¢˜ï¼Œæˆ‘çš„è§£å†³æ€è·¯æ˜¯ï¼š</p><blockquote><p>1ã€é€šè¿‡ç¼–å†™ Android æ’ä»¶è·å– Xml å¸ƒå±€ä¸­çš„æ‰€æœ‰æ§ä»¶ </p><p>2ã€æ‹¿åˆ°æ§ä»¶åï¼Œé€šè¿‡ APT ç”Ÿæˆç”¨ <code>new</code> çš„æ–¹å¼åˆ›å»º View çš„ç±» </p><p>3ã€æœ€åé€šè¿‡åå°„è·å–å½“å‰ç±»å¹¶åœ¨åŸºç±»é‡Œé¢å®Œæˆæ›¿æ¢</p></blockquote><h2 id="ä¸€ã€å‡†å¤‡-Android-æ’ä»¶ç”Ÿæˆçš„æ–‡ä»¶"><a href="#ä¸€ã€å‡†å¤‡-Android-æ’ä»¶ç”Ÿæˆçš„æ–‡ä»¶" class="headerlink" title="ä¸€ã€å‡†å¤‡ Android æ’ä»¶ç”Ÿæˆçš„æ–‡ä»¶"></a>ä¸€ã€å‡†å¤‡ Android æ’ä»¶ç”Ÿæˆçš„æ–‡ä»¶</h2><p>å…¶ä¸­ 1 çš„å…·ä½“æµç¨‹æ˜¯ï¼šé€šè¿‡ Android æ’ä»¶è·å–æ‰€æœ‰ Xml å¸ƒå±€ä¸­çš„æ§ä»¶åç§°ï¼Œå¹¶å†™å…¥åˆ°ä¸€ä¸ª<code>.txt</code>æ–‡ä»¶ä¸­ï¼Œå›  Gradle ç³»åˆ—è¿˜æ²¡è®²ï¼Œè¿™é‡Œæˆ‘ä»¬å‡è®¾æ‰€æœ‰çš„æ§ä»¶åç§°å·²ç»å†™å…¥åˆ°<code>.txt</code>æ–‡ä»¶ï¼Œå¦‚ä¸‹ï¼š</p><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/d18efb79eeed4538b4ac115e272c36f5~tplv-k3u1fbpfcp-zoom-1.image" alt="image-20210629191446005"></p><p>ä¸Šè¿°æ–‡ä»¶æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼š</p><p>1ã€ä¸€äº›ä¸å¸¦ <code>.</code> çš„ç³»ç»Ÿæ§ä»¶ï¼Œå¦‚ TextViewï¼ŒImageView ã€‚ç³»ç»Ÿä¼šé»˜è®¤ç»™æˆ‘ä»¬é€šè¿‡ <code>new</code> çš„æ–¹å¼å»åˆ›å»ºï¼Œä¸”æ›¿æ¢ä¸ºäº†<code>androidx.appcompat.widget</code>åŒ…ä¸‹çš„æ§ä»¶ï¼Œä¾‹å¦‚ï¼šTextView -&gt; AppCompatTextView ï¼ŒImageView -&gt; AppCompatImageView </p><p>2ã€å¸¦ <code>.</code> çš„æ§ä»¶ã€‚å¯èƒ½ä¸º <code>androidx.appcompat.widget</code> ä¸‹çš„æ§ä»¶ï¼Œè‡ªå®šä¹‰æ§ä»¶ï¼Œç¬¬ä¸‰æ–¹æ§ä»¶ç­‰ç­‰ï¼Œè¿™äº›æ§ä»¶å¦‚æœæˆ‘ä»¬ä¸åšå¤„ç†ï¼Œç³»ç»Ÿä¼šé€šè¿‡åå°„å»åˆ›å»ºã€‚å› æ­¤æˆ‘ä»¬ä¸»è¦æ˜¯é’ˆå¯¹è¿™äº›æ§ä»¶å»åšå¤„ç†</p><p><strong>æ³¨æ„</strong>ï¼šæˆ‘è¿™é‡Œåœ¨æ ¹ç›®å½•ä¸‹åˆ›å»ºäº†ä¸€ä¸ª <code>all_view_name.txt</code> çš„æ–‡ä»¶ï¼Œç„¶åæ”¾å…¥äº†ä¸€äº› View çš„åç§°ï¼Œè¿™é‡Œåªæ˜¯æ–¹ä¾¿æˆ‘ä»¬æ¼”ç¤ºã€‚å®é™…ä¸Šç”¨ Android æ’ä»¶å»ç”Ÿæˆçš„æ–‡ä»¶æˆ‘ä»¬ä¸€èˆ¬ä¼šæŒ‡å®šæ”¾åœ¨ app çš„ <code>/build</code>ç›®å½•ä¸‹ï¼Œè¿™æ ·æˆ‘ä»¬åœ¨ clean çš„æ—¶å€™å°±èƒ½é¡ºå¸¦æŠŠå®ƒç»™å¹²æ‰</p><p>ç°åœ¨ 1 å®Œæˆäº†ï¼Œæ¥ä¸‹æ¥ 2 å’Œ 3 å°±å›åˆ°äº†æˆ‘ä»¬ç†Ÿæ‚‰çš„ APT æµç¨‹ï¼Œæˆ‘ä»¬éœ€è¦è¯»å–è¯¥æ–‡ä»¶ï¼Œé€šè¿‡ APT ç”Ÿæˆç›¸åº”çš„ç±»ï¼Œæœ€åä½¿ç”¨è¿™ä¸ªç±»çš„åŠŸèƒ½å°± OK äº†ï¼Œè¿˜ä¸ç†Ÿæ‚‰ APT çš„ï¼Œå…ˆå»å­¦ä¹ ä¸€æ³¢ <a href="https://juejin.cn/post/6978500975770206239">ä¼ é€é—¨</a> </p><p>è¿˜æ˜¯åŸºäºä¸Šç¯‡æ–‡ç« çš„å·¥ç¨‹è¿›è¡Œå®æ“ï¼Œä¸ºäº†æ–¹ä¾¿åç»­æµç¨‹çš„è®²è§£ï¼Œæˆ‘è¿˜æ˜¯è´´å‡ºä¸Šç¯‡æ–‡ç« çš„å·¥ç¨‹å›¾ï¼š</p><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/e9ab51732570425eaf4c8ddebe921875~tplv-k3u1fbpfcp-zoom-1.image" alt="image-20210627182425586"></p><h2 id="äºŒã€apt-annotation-æ³¨è§£ç¼–å†™"><a href="#äºŒã€apt-annotation-æ³¨è§£ç¼–å†™" class="headerlink" title="äºŒã€apt-annotation æ³¨è§£ç¼–å†™"></a>äºŒã€apt-annotation æ³¨è§£ç¼–å†™</h2><p>ç¼–å†™æ³¨è§£ï¼Œå¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Inherited</span><br><span class="hljs-meta">@Documented</span><br><span class="hljs-meta">@Retention(RetentionPolicy.CLASS)</span><br><span class="hljs-meta">@Target(ElementType.TYPE)</span><br><span class="hljs-keyword">public</span> <span class="hljs-meta">@interface</span> ViewCreator &#123;<br>    <br>&#125;<br></code></pre></td></tr></table></figure><h2 id="ä¸‰ã€è§„å®šç”Ÿæˆçš„ç±»æ¨¡ç‰ˆï¼Œä¸ºåç»­è‡ªåŠ¨ç”Ÿæˆä»£ç åšå‡†å¤‡"><a href="#ä¸‰ã€è§„å®šç”Ÿæˆçš„ç±»æ¨¡ç‰ˆï¼Œä¸ºåç»­è‡ªåŠ¨ç”Ÿæˆä»£ç åšå‡†å¤‡" class="headerlink" title="ä¸‰ã€è§„å®šç”Ÿæˆçš„ç±»æ¨¡ç‰ˆï¼Œä¸ºåç»­è‡ªåŠ¨ç”Ÿæˆä»£ç åšå‡†å¤‡"></a>ä¸‰ã€è§„å®šç”Ÿæˆçš„ç±»æ¨¡ç‰ˆï¼Œä¸ºåç»­è‡ªåŠ¨ç”Ÿæˆä»£ç åšå‡†å¤‡</h2><p>åœ¨å®é™…å·¥ä½œä¸­ï¼Œæˆ‘ä»¬ä¸€èˆ¬ä¼šè¿™ä¹ˆåšï¼š</p><p>1ã€å°†éœ€è¦ç”Ÿæˆçš„ç±»æ–‡ä»¶å®ç°æŸä¸ªå®šä¹‰å¥½çš„æ¥å£ï¼Œé€šè¿‡æ¥å£ä»£ç†æ¥ä½¿ç”¨</p><p>2ã€è§„å®šç”Ÿæˆçš„ Java ç±»æ¨¡ç‰ˆï¼Œæ ¹æ®æ¨¡ç‰ˆå»è¿›è¡Œç”Ÿæˆä»£ç é€»è¾‘çš„ç¼–å†™</p><h3 id="1ã€å°†éœ€è¦ç”Ÿæˆçš„ç±»æ–‡ä»¶å®ç°æŸä¸ªå®šä¹‰å¥½çš„æ¥å£ï¼Œé€šè¿‡æ¥å£ä»£ç†æ¥ä½¿ç”¨"><a href="#1ã€å°†éœ€è¦ç”Ÿæˆçš„ç±»æ–‡ä»¶å®ç°æŸä¸ªå®šä¹‰å¥½çš„æ¥å£ï¼Œé€šè¿‡æ¥å£ä»£ç†æ¥ä½¿ç”¨" class="headerlink" title="1ã€å°†éœ€è¦ç”Ÿæˆçš„ç±»æ–‡ä»¶å®ç°æŸä¸ªå®šä¹‰å¥½çš„æ¥å£ï¼Œé€šè¿‡æ¥å£ä»£ç†æ¥ä½¿ç”¨"></a>1ã€å°†éœ€è¦ç”Ÿæˆçš„ç±»æ–‡ä»¶å®ç°æŸä¸ªå®šä¹‰å¥½çš„æ¥å£ï¼Œé€šè¿‡æ¥å£ä»£ç†æ¥ä½¿ç”¨</h3><p>å…³äºæ¥å£ï¼Œæˆ‘ä»¬ä¸€èˆ¬ä¼šæ”¾åˆ° <code>apt-api</code> è¿™ä¸ª Module ä¸­</p><h3 id="2ã€è§„å®šç”Ÿæˆçš„-Java-ç±»æ¨¡ç‰ˆï¼Œæ ¹æ®æ¨¡ç‰ˆå»è¿›è¡Œç”Ÿæˆä»£ç é€»è¾‘çš„ç¼–å†™"><a href="#2ã€è§„å®šç”Ÿæˆçš„-Java-ç±»æ¨¡ç‰ˆï¼Œæ ¹æ®æ¨¡ç‰ˆå»è¿›è¡Œç”Ÿæˆä»£ç é€»è¾‘çš„ç¼–å†™" class="headerlink" title="2ã€è§„å®šç”Ÿæˆçš„ Java ç±»æ¨¡ç‰ˆï¼Œæ ¹æ®æ¨¡ç‰ˆå»è¿›è¡Œç”Ÿæˆä»£ç é€»è¾‘çš„ç¼–å†™"></a>2ã€è§„å®šç”Ÿæˆçš„ Java ç±»æ¨¡ç‰ˆï¼Œæ ¹æ®æ¨¡ç‰ˆå»è¿›è¡Œç”Ÿæˆä»£ç é€»è¾‘çš„ç¼–å†™</h3><p>å‡è®¾æˆ‘ä»¬éœ€è¦ç”Ÿæˆçš„ Java ç±»æ¨¡ç‰ˆå¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.dream.aptdemo;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyViewCreatorImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">IMyViewCreator</span> &#123;<br>  <span class="hljs-meta">@Override</span><br>  <span class="hljs-keyword">public</span> View <span class="hljs-title function_">createView</span><span class="hljs-params">(String name, Context context, AttributeSet attr)</span> &#123;<br>    <span class="hljs-type">View</span> <span class="hljs-variable">view</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br>    <span class="hljs-keyword">switch</span>(name) &#123;<br>      <span class="hljs-keyword">case</span> <span class="hljs-string">&quot;androidx.core.widget.NestedScrollView&quot;</span>:<br>      view = <span class="hljs-keyword">new</span> <span class="hljs-title class_">NestedScrollView</span>(context,attr);<br>      <span class="hljs-keyword">break</span>;<br>      <span class="hljs-keyword">case</span> <span class="hljs-string">&quot;androidx.constraintlayout.widget.ConstraintLayout&quot;</span>:<br>      view = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConstraintLayout</span>(context,attr);<br>      <span class="hljs-keyword">break</span>;<br>      <span class="hljs-keyword">case</span> <span class="hljs-string">&quot;androidx.appcompat.widget.ButtonBarLayout&quot;</span>:<br>      view = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ButtonBarLayout</span>(context,attr);<br>      <span class="hljs-keyword">break</span>;<br>        <span class="hljs-comment">//...</span><br>      <span class="hljs-keyword">default</span>:<br>      <span class="hljs-keyword">break</span>;<br>    &#125;<br>    <span class="hljs-keyword">return</span> view;<br>&#125;<br></code></pre></td></tr></table></figure><p>æ ¹æ®ä¸Šé¢è¿™äº›ä¿¡æ¯ï¼Œæˆ‘ä»¬å°±å¯ä»¥è¿›è¡Œè‡ªåŠ¨ç”Ÿæˆä»£ç é€»è¾‘çš„ç¼–å†™äº†</p><h2 id="å››ã€apt-processor-è‡ªåŠ¨ç”Ÿæˆä»£ç "><a href="#å››ã€apt-processor-è‡ªåŠ¨ç”Ÿæˆä»£ç " class="headerlink" title="å››ã€apt-processor è‡ªåŠ¨ç”Ÿæˆä»£ç "></a>å››ã€apt-processor è‡ªåŠ¨ç”Ÿæˆä»£ç </h2><p>è¿™é‡Œä½ å°±å¯¹ç€ä¸Šé¢ç»™å‡ºçš„ä»£ç æ¨¡ç‰ˆï¼Œé€šè¿‡ javapoet æ¡†æ¶ç¼–å†™ç›¸åº”çš„ä»£ç ç”Ÿæˆé€»è¾‘å³å¯ï¼Œå¯¹ <code>javapoet</code> ä¸ç†Ÿçš„èµ¶ç´§å»å­¦ä¹ ä¸€æ³¢ <a href="https://github.com/square/javapoet">ä¼ é€é—¨</a></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@AutoService(Processor.class)</span><br><span class="hljs-meta">@SupportedAnnotationTypes(&quot;com.dream.apt_annotation.ViewCreator&quot;)</span><br><span class="hljs-meta">@SupportedSourceVersion(SourceVersion.RELEASE_8)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyViewCreatorProcessor</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AbstractProcessor</span> &#123;<br><br>    <span class="hljs-comment">/**æ–‡ä»¶ç”Ÿæˆå™¨*/</span><br>    <span class="hljs-keyword">private</span> Filer mFiler;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">synchronized</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">init</span><span class="hljs-params">(ProcessingEnvironment processingEnv)</span> &#123;<br>        <span class="hljs-built_in">super</span>.init(processingEnv);<br>        mFiler = processingEnv.getFiler();<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">process</span><span class="hljs-params">(Set&lt;? extends TypeElement&gt; annotations, RoundEnvironment roundEnv)</span> &#123;<br>        <span class="hljs-comment">//ä»æ–‡ä»¶ä¸­è¯»å–æ§ä»¶åç§°ï¼Œå¹¶è½¬æ¢æˆå¯¹åº”çš„é›†åˆ</span><br>        Set&lt;String&gt; mViewNameSet = readViewNameFromFile();<br>        <span class="hljs-comment">//å¦‚æœè·å–çš„æ§ä»¶åç§°é›†åˆä¸ºç©ºï¼Œåˆ™ç»ˆæ­¢æµç¨‹</span><br>        <span class="hljs-keyword">if</span>(mViewNameSet == <span class="hljs-literal">null</span> || mViewNameSet.isEmpty())&#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>        &#125;<br>      <br>        <span class="hljs-comment">//è·å–ä½¿ç”¨äº†æ³¨è§£çš„å…ƒç´ </span><br>        Set&lt;? <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Element</span>&gt; elementsAnnotatedWith = roundEnv.getElementsAnnotatedWith(ViewCreator.class);<br>        <span class="hljs-keyword">for</span> (Element element : elementsAnnotatedWith) &#123;<br>            System.out.println(<span class="hljs-string">&quot;Hello &quot;</span> + element.getSimpleName() + <span class="hljs-string">&quot;, æ¬¢è¿ä½¿ç”¨ APT&quot;</span>);<br>            startGenerateCode(mViewNameSet);<br>            <span class="hljs-comment">//å¦‚æœæœ‰å¤šä¸ªåœ°æ–¹æ ‡æ³¨äº†æ³¨è§£ï¼Œæˆ‘ä»¬åªè¯»å–ç¬¬ä¸€æ¬¡çš„å°±è¡Œäº†</span><br>            <span class="hljs-keyword">break</span>;<br>        &#125;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * å¼€å§‹æ‰§è¡Œç”Ÿæˆä»£ç çš„é€»è¾‘</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> mViewNameSet æ§ä»¶åç§°é›†åˆ</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">startGenerateCode</span><span class="hljs-params">(Set&lt;String&gt; mViewNameSet)</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;å¼€å§‹ç”Ÿæˆ Java ç±»...&quot;</span>);<br>        System.out.println(<span class="hljs-string">&quot;a few moment later...&quot;</span>);<br>        <span class="hljs-comment">//=================================== æ„å»ºæ–¹æ³• start ======================================</span><br>        <span class="hljs-comment">//1ã€æ„å»ºæ–¹æ³•ï¼šæ–¹æ³•åï¼Œæ³¨è§£ï¼Œä¿®é¥°ç¬¦ï¼Œè¿”å›å€¼ï¼Œå‚æ•°</span><br><br>        <span class="hljs-type">ClassName</span> <span class="hljs-variable">viewType</span> <span class="hljs-operator">=</span> ClassName.get(<span class="hljs-string">&quot;android.view&quot;</span>,<span class="hljs-string">&quot;View&quot;</span>);<br>        MethodSpec.<span class="hljs-type">Builder</span> <span class="hljs-variable">methodBuilder</span> <span class="hljs-operator">=</span> MethodSpec<br>                <span class="hljs-comment">//æ–¹æ³•å</span><br>                .methodBuilder(<span class="hljs-string">&quot;createView&quot;</span>)<br>                <span class="hljs-comment">//æ³¨è§£</span><br>                .addAnnotation(Override.class)<br>                <span class="hljs-comment">//ä¿®é¥°ç¬¦</span><br>                .addModifiers(Modifier.PUBLIC)<br>                <span class="hljs-comment">//è¿”å›å€¼</span><br>                .returns(viewType)<br>                <span class="hljs-comment">//ç¬¬ä¸€ä¸ªå‚æ•°</span><br>                .addParameter(String.class,<span class="hljs-string">&quot;name&quot;</span>)<br>                <span class="hljs-comment">//ç¬¬äºŒä¸ªå‚æ•°</span><br>                .addParameter(ClassName.get(<span class="hljs-string">&quot;android.content&quot;</span>,<span class="hljs-string">&quot;Context&quot;</span>),<span class="hljs-string">&quot;context&quot;</span>)<br>                <span class="hljs-comment">//ç¬¬ä¸‰ä¸ªå‚æ•°</span><br>                .addParameter(ClassName.get(<span class="hljs-string">&quot;android.util&quot;</span>,<span class="hljs-string">&quot;AttributeSet&quot;</span>),<span class="hljs-string">&quot;attr&quot;</span>);<br><br>        <span class="hljs-comment">//2ã€æ„å»ºæ–¹æ³•ä½“</span><br>        methodBuilder.addStatement(<span class="hljs-string">&quot;$T view = null&quot;</span>,viewType);<br>        methodBuilder.beginControlFlow(<span class="hljs-string">&quot;switch(name)&quot;</span>);<br>        <span class="hljs-comment">//å¾ªç¯éå†æ§ä»¶åç§°é›†åˆ</span><br>        <span class="hljs-keyword">for</span> (String viewName : mViewNameSet) &#123;<br>            <span class="hljs-comment">//é’ˆå¯¹åŒ…å« . çš„æ§ä»¶åç§°è¿›è¡Œå¤„ç†</span><br>            <span class="hljs-keyword">if</span>(viewName.contains(<span class="hljs-string">&quot;.&quot;</span>))&#123;<br>                <span class="hljs-comment">//åˆ†ç¦»åŒ…åå’Œæ§ä»¶åï¼Œå¦‚ï¼šandroidx.constraintlayout.widget.ConstraintLayout</span><br>                <span class="hljs-comment">//packageNameï¼šandroidx.constraintlayout.widget</span><br>                <span class="hljs-comment">//simpleViewNameï¼šConstraintLayout</span><br>                <span class="hljs-type">String</span> <span class="hljs-variable">packageName</span> <span class="hljs-operator">=</span> viewName.substring(<span class="hljs-number">0</span>,viewName.lastIndexOf(<span class="hljs-string">&quot;.&quot;</span>));<br>                <span class="hljs-type">String</span> <span class="hljs-variable">simpleViewName</span> <span class="hljs-operator">=</span> viewName.substring(viewName.lastIndexOf(<span class="hljs-string">&quot;.&quot;</span>) + <span class="hljs-number">1</span>);<br>                <span class="hljs-type">ClassName</span> <span class="hljs-variable">returnType</span> <span class="hljs-operator">=</span> ClassName.get(packageName, simpleViewName);<br><br>                methodBuilder.addCode(<span class="hljs-string">&quot;case $S:\n&quot;</span>,viewName);<br>                methodBuilder.addStatement(<span class="hljs-string">&quot;\tview = new $T(context,attr)&quot;</span>, returnType);<br>                methodBuilder.addStatement(<span class="hljs-string">&quot;\tbreak&quot;</span>);<br>            &#125;<br>        &#125;<br>        methodBuilder.addCode(<span class="hljs-string">&quot;default:\n&quot;</span>);<br>        methodBuilder.addStatement(<span class="hljs-string">&quot;\tbreak&quot;</span>);<br>        methodBuilder.endControlFlow();<br>        methodBuilder.addStatement(<span class="hljs-string">&quot;return view&quot;</span>);<br><br>        <span class="hljs-type">MethodSpec</span> <span class="hljs-variable">createView</span> <span class="hljs-operator">=</span> methodBuilder.build();<br>        <span class="hljs-comment">//=================================== æ„å»ºæ–¹æ³• end ======================================</span><br><br>        <span class="hljs-comment">//=================================== æ„å»ºç±» start ======================================</span><br>        <span class="hljs-type">TypeSpec</span> <span class="hljs-variable">myViewCreatorImpl</span> <span class="hljs-operator">=</span> TypeSpec.classBuilder(<span class="hljs-string">&quot;MyViewCreatorImpl&quot;</span>)<br>                <span class="hljs-comment">//ç±»ä¿®é¥°ç¬¦</span><br>                .addModifiers(Modifier.PUBLIC)<br>                <span class="hljs-comment">//å®ç°æ¥å£</span><br>                .addSuperinterface(ClassName.get(<span class="hljs-string">&quot;com.dream.apt_api&quot;</span>, <span class="hljs-string">&quot;IMyViewCreator&quot;</span>))<br>                <span class="hljs-comment">//æ·»åŠ æ–¹æ³•</span><br>                .addMethod(createView)<br>                .build();<br>        <span class="hljs-comment">//=================================== æ„å»ºç±» end ========================================</span><br><br>        <span class="hljs-comment">//=================================== æŒ‡å®šåŒ…è·¯å¾„ï¼Œæ„å»ºæ–‡ä»¶ä½“ start =========================</span><br>        <span class="hljs-comment">//æŒ‡å®šç±»åŒ…è·¯å¾„</span><br>        <span class="hljs-type">JavaFile</span> <span class="hljs-variable">javaFile</span> <span class="hljs-operator">=</span> JavaFile.builder(<span class="hljs-string">&quot;com.dream.aptdemo&quot;</span>,myViewCreatorImpl).build();<br>        <span class="hljs-comment">//ç”Ÿæˆæ–‡ä»¶</span><br>        <span class="hljs-keyword">try</span> &#123;<br>            javaFile.writeTo(mFiler);<br>            System.out.println(<span class="hljs-string">&quot;ç”ŸæˆæˆåŠŸ...&quot;</span>);<br>        &#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;<br>            e.printStackTrace();<br>            System.out.println(<span class="hljs-string">&quot;ç”Ÿæˆå¤±è´¥...&quot;</span>);<br>        &#125;<br>        <span class="hljs-comment">//=================================== æŒ‡å®šåŒ…è·¯å¾„ï¼Œæ„å»ºæ–‡ä»¶ä½“ end ============================</span><br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * ä»æ–‡ä»¶ä¸­è¯»å–æ§ä»¶åç§°ï¼Œå¹¶è½¬æ¢æˆå¯¹åº”çš„é›†åˆ</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">private</span> Set&lt;String&gt; <span class="hljs-title function_">readViewNameFromFile</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-comment">//è·å–å­˜å‚¨æ§ä»¶åç§°çš„æ–‡ä»¶</span><br>            <span class="hljs-type">File</span> <span class="hljs-variable">file</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">File</span>(<span class="hljs-string">&quot;/Users/zhouying/AndroidStudioProjects/AptDemo/all_view_name.txt&quot;</span>);<br>            <span class="hljs-type">Properties</span> <span class="hljs-variable">config</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Properties</span>();<br>            config.load(<span class="hljs-keyword">new</span> <span class="hljs-title class_">FileInputStream</span>(file));<br>            <span class="hljs-comment">//è·å–æ§ä»¶åç§°é›†åˆ</span><br>            <span class="hljs-keyword">return</span> config.stringPropertyNames();<br>        &#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;<br>            e.printStackTrace();<br>        &#125;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ä¸Šè¿°ç”Ÿæˆä»£ç çš„é€»è¾‘å†™äº†è¯¦ç»†çš„æ³¨é‡Šï¼Œä¸»è¦å°±æ˜¯å¯¹ <code>javapoet</code> æ¡†æ¶çš„ä¸€ä¸ªåº”ç”¨</p><p>ä»£ç ç”Ÿæˆå¥½äº†ï¼Œæ¥ä¸‹æ¥å°±éœ€è¦æä¾›ç»™ä¸Šå±‚ä½¿ç”¨</p><h2 id="äº”ã€apt-api-ä¸šåŠ¡å°è£…ä¾›ä¸Šå±‚ä½¿ç”¨"><a href="#äº”ã€apt-api-ä¸šåŠ¡å°è£…ä¾›ä¸Šå±‚ä½¿ç”¨" class="headerlink" title="äº”ã€apt-api ä¸šåŠ¡å°è£…ä¾›ä¸Šå±‚ä½¿ç”¨"></a>äº”ã€apt-api ä¸šåŠ¡å°è£…ä¾›ä¸Šå±‚ä½¿ç”¨</h2><h3 id="1ã€å®šä¹‰ä¸€ä¸ªæ¥å£ï¼Œ-apt-api-å’Œ-apt-processor-éƒ½ä¼šä½¿ç”¨åˆ°"><a href="#1ã€å®šä¹‰ä¸€ä¸ªæ¥å£ï¼Œ-apt-api-å’Œ-apt-processor-éƒ½ä¼šä½¿ç”¨åˆ°" class="headerlink" title="1ã€å®šä¹‰ä¸€ä¸ªæ¥å£ï¼Œ apt-api å’Œ apt-processor éƒ½ä¼šä½¿ç”¨åˆ°"></a>1ã€å®šä¹‰ä¸€ä¸ªæ¥å£ï¼Œ <code>apt-api</code> å’Œ <code>apt-processor</code> éƒ½ä¼šä½¿ç”¨åˆ°</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//å®šä¹‰ä¸€ä¸ªæ¥å£</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">IMyViewCreator</span> &#123;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * é€šè¿‡ new çš„æ–¹å¼åˆ›å»º View</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> name æ§ä»¶åç§°</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> context ä¸Šä¸‹æ–‡</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> attributeSet å±æ€§</span><br><span class="hljs-comment">     */</span><br>    View <span class="hljs-title function_">createView</span><span class="hljs-params">(String name, Context context, AttributeSet attributeSet)</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="2ã€åå°„è·å–ç”Ÿæˆçš„ç±»ï¼Œæä¾›ç›¸åº”çš„ä»£ç†ç±»ä¾›ä¸Šå±‚è°ƒç”¨"><a href="#2ã€åå°„è·å–ç”Ÿæˆçš„ç±»ï¼Œæä¾›ç›¸åº”çš„ä»£ç†ç±»ä¾›ä¸Šå±‚è°ƒç”¨" class="headerlink" title="2ã€åå°„è·å–ç”Ÿæˆçš„ç±»ï¼Œæä¾›ç›¸åº”çš„ä»£ç†ç±»ä¾›ä¸Šå±‚è°ƒç”¨"></a>2ã€åå°„è·å–ç”Ÿæˆçš„ç±»ï¼Œæä¾›ç›¸åº”çš„ä»£ç†ç±»ä¾›ä¸Šå±‚è°ƒç”¨</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyViewCreatorDelegate</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">IMyViewCreator</span>&#123;<br>    <br>    <span class="hljs-keyword">private</span> IMyViewCreator mIMyViewCreator;<br>    <br>    <span class="hljs-comment">//================================== å•ä¾‹ start =====================================</span><br>    <span class="hljs-meta">@SuppressWarnings(&quot;all&quot;)</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-title function_">MyViewCreatorDelegate</span><span class="hljs-params">()</span>&#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-comment">// é€šè¿‡åå°„æ‹¿åˆ° Apt ç”Ÿæˆçš„ç±»</span><br>            <span class="hljs-type">Class</span> <span class="hljs-variable">aClass</span> <span class="hljs-operator">=</span> Class.forName(<span class="hljs-string">&quot;com.dream.aptdemo.MyViewCreatorImpl&quot;</span>);<br>            mIMyViewCreator = (IMyViewCreator) aClass.newInstance();<br>        &#125; <span class="hljs-keyword">catch</span> (Throwable t) &#123;<br>            t.printStackTrace();<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> MyViewCreatorDelegate <span class="hljs-title function_">getInstance</span><span class="hljs-params">()</span>&#123;<br>        <span class="hljs-keyword">return</span> Holder.MY_VIEW_CREATOR_DELEGATE;<br>    &#125;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Holder</span>&#123;<br>        <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">MyViewCreatorDelegate</span> <span class="hljs-variable">MY_VIEW_CREATOR_DELEGATE</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">MyViewCreatorDelegate</span>();<br>    &#125;<br>    <span class="hljs-comment">//================================== å•ä¾‹ end =======================================</span><br><br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * é€šè¿‡ç”Ÿæˆçš„ç±»åˆ›å»º View</span><br><span class="hljs-comment">     * </span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> name æ§ä»¶åç§°</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> context ä¸Šä¸‹æ–‡</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> attributeSet å±æ€§</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> View</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> View <span class="hljs-title function_">createView</span><span class="hljs-params">(String name, Context context, AttributeSet attributeSet)</span> &#123;<br>        <span class="hljs-keyword">if</span>(mIMyViewCreator != <span class="hljs-literal">null</span>)&#123;<br>            <span class="hljs-keyword">return</span> mIMyViewCreator.createView(name, context, attributeSet);<br>        &#125;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>åˆ°è¿™é‡Œæˆ‘ä»¬å¸ƒå±€ä¼˜åŒ–æµç¨‹å·®ä¸å¤šå°±è¦ç»“æŸäº†ï¼Œæ¥ä¸‹æ¥å°±æ˜¯ä¸Šå±‚è°ƒç”¨</p><h2 id="å…­ã€app-ä¸Šå±‚è°ƒç”¨"><a href="#å…­ã€app-ä¸Šå±‚è°ƒç”¨" class="headerlink" title="å…­ã€app ä¸Šå±‚è°ƒç”¨"></a>å…­ã€app ä¸Šå±‚è°ƒç”¨</h2><h3 id="1ã€åœ¨åˆ›å»ºçš„-MyApplication-ä¸Šæ·»åŠ æ³¨è§£"><a href="#1ã€åœ¨åˆ›å»ºçš„-MyApplication-ä¸Šæ·»åŠ æ³¨è§£" class="headerlink" title="1ã€åœ¨åˆ›å»ºçš„ MyApplication ä¸Šæ·»åŠ æ³¨è§£"></a>1ã€åœ¨åˆ›å»ºçš„ MyApplication ä¸Šæ·»åŠ æ³¨è§£</h3><p>å…³äºæ³¨è§£ä½ å¯ä»¥æ·»åŠ åœ¨å…¶ä»–åœ°æ–¹ï¼Œå› ä¸ºæˆ‘æ³¨è§£å¤„ç†å™¨é‡Œé¢åšäº†é€»è¾‘åˆ¤æ–­ï¼Œåªä¼šè¯»å–ç¬¬ä¸€æ¬¡çš„æ³¨è§£ã€‚ä¸ºäº†å¯¹åº”ï¼Œæˆ‘é€‰æ‹©æŠŠæ³¨è§£åŠ åˆ° MyApplication ä¸­ï¼Œå¦‚ä¸‹å›¾ï¼š</p><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/9465eb668782489b8915bce09f8c589d~tplv-k3u1fbpfcp-zoom-1.image" alt="image-20210629192519893"></p><h3 id="2ã€æœ€ååœ¨-MainActviity-ä¸­åŠ å…¥æ›¿æ¢-View-çš„é€»è¾‘"><a href="#2ã€æœ€ååœ¨-MainActviity-ä¸­åŠ å…¥æ›¿æ¢-View-çš„é€»è¾‘" class="headerlink" title="2ã€æœ€ååœ¨ MainActviity ä¸­åŠ å…¥æ›¿æ¢ View çš„é€»è¾‘"></a>2ã€æœ€ååœ¨ MainActviity ä¸­åŠ å…¥æ›¿æ¢ View çš„é€»è¾‘</h3><p>å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//...</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MainActivity</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AppCompatActivity</span> &#123;<br><br>    <span class="hljs-comment">//...</span><br>    <span class="hljs-meta">@Nullable</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> View <span class="hljs-title function_">onCreateView</span><span class="hljs-params">(<span class="hljs-meta">@NonNull</span> String name, <span class="hljs-meta">@NonNull</span> Context context, <span class="hljs-meta">@NonNull</span> AttributeSet attrs)</span> &#123;<br>        <span class="hljs-comment">//1ã€ä¼˜å…ˆä½¿ç”¨æˆ‘ä»¬ç”Ÿæˆçš„ç±»å»è¿›è¡Œ View çš„åˆ›å»º</span><br>        <span class="hljs-type">View</span> <span class="hljs-variable">view</span> <span class="hljs-operator">=</span> MyViewCreatorDelegate.getInstance().createView(name, context, attrs);<br>        <span class="hljs-keyword">if</span> (view != <span class="hljs-literal">null</span>) &#123;<br>            <span class="hljs-keyword">return</span> view;<br>        &#125;<br>        <span class="hljs-comment">//2ã€ä¸€äº›ç³»ç»Ÿçš„ View ,åˆ™èµ°ç³»ç»Ÿçš„ä¸€ä¸ªåˆ›å»ºæµç¨‹</span><br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">super</span>.onCreateView(name, context, attrs);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><strong>æ³¨æ„</strong>ï¼šä¸€èˆ¬æˆ‘ä»¬ä¼šæŠŠæ›¿æ¢ View çš„é€»è¾‘æ”¾åˆ°åŸºç±»é‡Œé¢</p><h2 id="ä¸ƒã€æ•ˆæœéªŒè¯"><a href="#ä¸ƒã€æ•ˆæœéªŒè¯" class="headerlink" title="ä¸ƒã€æ•ˆæœéªŒè¯"></a>ä¸ƒã€æ•ˆæœéªŒè¯</h2><p>è¿è¡Œé¡¹ç›®</p><p>1ã€å…ˆçœ‹ä¸‹æˆ‘ä»¬æ‰“å°çš„æ—¥å¿—ï¼Œå¦‚ä¸‹å›¾ï¼š</p><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/1a7e9154f8ad4ba1827f9839acd15bf7~tplv-k3u1fbpfcp-zoom-1.image" alt="image-20210629195411055"></p><p>2ã€åœ¨çœ‹ä¸€çœ¼æˆ‘ä»¬ç”Ÿæˆçš„ Java ç±»æ–‡ä»¶ï¼Œå¦‚ä¸‹å›¾ï¼š</p><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/47cefa64ab494d6aa18ad8cafb0d28d3~tplv-k3u1fbpfcp-zoom-1.image" alt="image-20210629194711378"></p><p>3ã€æœ€å debug é¡¹ç›®è·Ÿä¸‹æµç¨‹ï¼Œå‘ç°å’Œæˆ‘ä»¬é¢„æœŸçš„ä¸€è‡´ï¼Œå¦‚ä¸‹å›¾ï¼š</p><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/123032d1ca3844f4959839bf46d66a80~tplv-k3u1fbpfcp-zoom-1.image" alt="image-20210629194101025"></p><p>è‡³æ­¤ï¼Œéœ€æ±‚å®Œç»“</p><h2 id="å…«ã€æ€»ç»“"><a href="#å…«ã€æ€»ç»“" class="headerlink" title="å…«ã€æ€»ç»“"></a>å…«ã€æ€»ç»“</h2><p>æœ¬ç¯‡æ–‡ç« è®²çš„ä¸€äº›é‡ç‚¹å†…å®¹ï¼š</p><p>1ã€é€šè¿‡ APT è¯»å–æ–‡ä»¶è·å–æ‰€æœ‰çš„æ§ä»¶åç§°å¹¶ç”Ÿæˆ Java ç±»</p><p>2ã€é€šè¿‡æ¥å£ä»£ç†ï¼Œåˆç†çš„ä¸šåŠ¡å°è£…æä¾›ç»™ä¸Šå±‚è°ƒç”¨</p><p>3ã€åœ¨ä¸Šå±‚ Application é‡Œé¢è¿›è¡Œæ³¨è§£ï¼Œåœ¨ Activity ä¸­è¿›è¡Œ View æ§ä»¶çš„æ›¿æ¢</p><p>4ã€å®é™…å®Œæˆåçš„ä¸€ä¸ªæ•ˆæœéªŒè¯</p><p>å¥½äº†ï¼Œæœ¬ç³»åˆ—æ–‡ç« åˆ°è¿™é‡Œå°±ç»“æŸäº†ï¼Œå¸Œæœ›èƒ½ç»™ä½ å¸¦æ¥å¸®åŠ© ğŸ¤ </p><p><strong>æ„Ÿè°¢ä½ é˜…è¯»è¿™ç¯‡æ–‡ç« </strong></p><blockquote><p><strong>ä½ çš„ç‚¹èµï¼Œè¯„è®ºï¼Œæ˜¯å¯¹æˆ‘å·¨å¤§çš„é¼“åŠ±ï¼</strong></p><p>æ¬¢è¿å…³æ³¨æˆ‘çš„<strong>å…¬ä¼—å·ï¼š</strong>  <a href="http://m6z.cn/6jwi7b"><strong>sweetying</strong></a> ï¼Œæ–‡ç« æ›´æ–°å¯ç¬¬ä¸€æ—¶é—´æ”¶åˆ°</p><p>å¦‚æœ<strong>æœ‰é—®é¢˜</strong>ï¼Œå…¬ä¼—å·å†…æœ‰åŠ æˆ‘å¾®ä¿¡çš„å…¥å£ï¼Œåœ¨æŠ€æœ¯å­¦ä¹ ã€ä¸ªäººæˆé•¿çš„é“è·¯ä¸Šï¼Œæˆ‘ä»¬ä¸€èµ·å‰è¿›ï¼</p></blockquote>]]></content>
    
    
    <categories>
      
      <category>Android</category>
      
      <category>APT</category>
      
    </categories>
    
    
    <tags>
      
      <tag>åŸåˆ›</tag>
      
      <tag>Android</tag>
      
      <tag>Android APT</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Android APT ç³»åˆ— ï¼ˆä¸‰ï¼‰ï¼šAPT æŠ€æœ¯æ¢ç©¶</title>
    <link href="/2022/10/10/Android%20APT%20%E7%B3%BB%E5%88%97%20%EF%BC%88%E4%B8%89%EF%BC%89%EF%BC%9AAPT%20%E6%8A%80%E6%9C%AF%E6%8E%A2%E7%A9%B6/"/>
    <url>/2022/10/10/Android%20APT%20%E7%B3%BB%E5%88%97%20%EF%BC%88%E4%B8%89%EF%BC%89%EF%BC%9AAPT%20%E6%8A%80%E6%9C%AF%E6%8E%A2%E7%A9%B6/</url>
    
    <content type="html"><![CDATA[<p><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/f39b6dc6311a4c8f92962499db88737c~tplv-k3u1fbpfcp-watermark.image"></p><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>å¾ˆé«˜å…´é‡è§ä½ ~</p><p>åœ¨æœ¬ç³»åˆ—çš„ä¸Šä¸€ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å¯¹æ³¨è§£è¿›è¡Œäº†è®²è§£ï¼Œè¿˜æ²¡æœ‰çœ‹è¿‡ä¸Šä¸€ç¯‡æ–‡ç« çš„æœ‹å‹ï¼Œå»ºè®®å…ˆå»é˜…è¯» <a href="https://juejin.cn/post/6978293956450713630">Android APT ç³»åˆ— ï¼ˆäºŒï¼‰ï¼šAPT ç­‘åŸºä¹‹æ³¨è§£</a>ã€‚è‡³æ­¤ï¼Œå…³äº Apt åŸºç¡€éƒ¨åˆ†æˆ‘ä»¬éƒ½è®²å®Œäº†ï¼Œæ¥ä¸‹æ¥å°±æ­£å¼è¿›å…¥ APT æŠ€æœ¯çš„å­¦ä¹ </p><p><a href="https://github.com/sweetying520/AptDemo">Github Demo åœ°å€</a> , å¤§å®¶å¯ä»¥çœ‹ Demo è·Ÿéšæˆ‘çš„æ€è·¯ä¸€èµ·åˆ†æ</p><h2 id="ä¸€ã€APT-ä»‹ç»"><a href="#ä¸€ã€APT-ä»‹ç»" class="headerlink" title="ä¸€ã€APT ä»‹ç»"></a>ä¸€ã€APT ä»‹ç»</h2><h3 id="1ï¼‰ã€ä»€ä¹ˆæ˜¯-APT"><a href="#1ï¼‰ã€ä»€ä¹ˆæ˜¯-APT" class="headerlink" title="1ï¼‰ã€ä»€ä¹ˆæ˜¯ APT ?"></a>1ï¼‰ã€ä»€ä¹ˆæ˜¯ APT ?</h3><p>APT å…¨ç§° <code>Annotation Processing Tool</code>ï¼Œç¿»è¯‘è¿‡æ¥å³æ³¨è§£å¤„ç†å™¨ã€‚å¼•ç”¨å®˜æ–¹ä¸€æ®µå¯¹ APT çš„ä»‹ç»ï¼š<strong>APT æ˜¯ä¸€ç§å¤„ç†æ³¨é‡Šçš„å·¥å…·, å®ƒå¯¹æºä»£ç æ–‡ä»¶è¿›è¡Œæ£€æµ‹æ‰¾å‡ºå…¶ä¸­çš„æ³¨è§£ï¼Œå¹¶ä½¿ç”¨æ³¨è§£è¿›è¡Œé¢å¤–çš„å¤„ç†ã€‚</strong></p><h3 id="2ï¼‰ã€APT-æœ‰ä»€ä¹ˆç”¨ï¼Ÿ"><a href="#2ï¼‰ã€APT-æœ‰ä»€ä¹ˆç”¨ï¼Ÿ" class="headerlink" title="2ï¼‰ã€APT æœ‰ä»€ä¹ˆç”¨ï¼Ÿ"></a>2ï¼‰ã€APT æœ‰ä»€ä¹ˆç”¨ï¼Ÿ</h3><p>APT èƒ½åœ¨ç¼–è¯‘æœŸæ ¹æ®ç¼–è¯‘é˜¶æ®µæ³¨è§£ï¼Œç»™æˆ‘ä»¬è‡ªåŠ¨ç”Ÿæˆä»£ç ï¼Œç®€åŒ–ä½¿ç”¨ã€‚å¾ˆå¤šæµè¡Œæ¡†æ¶éƒ½ä½¿ç”¨åˆ°äº† APT æŠ€æœ¯ï¼Œå¦‚ ButterKnifeï¼ŒRetrofitï¼ŒArouterï¼ŒEventBus ç­‰ç­‰</p><h2 id="äºŒã€APT-å·¥ç¨‹"><a href="#äºŒã€APT-å·¥ç¨‹" class="headerlink" title="äºŒã€APT å·¥ç¨‹"></a>äºŒã€APT å·¥ç¨‹</h2><h3 id="1ï¼‰ã€APT-å·¥ç¨‹åˆ›å»º"><a href="#1ï¼‰ã€APT-å·¥ç¨‹åˆ›å»º" class="headerlink" title="1ï¼‰ã€APT å·¥ç¨‹åˆ›å»º"></a>1ï¼‰ã€APT å·¥ç¨‹åˆ›å»º</h3><p>ä¸€èˆ¬æƒ…å†µä¸‹ï¼ŒAPT å¤§è‡´çš„çš„ä¸€ä¸ªå®ç°è¿‡ç¨‹ï¼š</p><p>1ã€åˆ›å»ºä¸€ä¸ª <code>Java Module</code> ï¼Œç”¨æ¥ç¼–å†™æ³¨è§£</p><p>2ã€åˆ›å»ºä¸€ä¸ª <code>Java Module</code> ï¼Œç”¨æ¥è¯»å–æ³¨è§£ä¿¡æ¯ï¼Œå¹¶æ ¹æ®æŒ‡å®šè§„åˆ™ï¼Œç”Ÿæˆç›¸åº”çš„ç±»æ–‡ä»¶</p><p>3ã€åˆ›å»ºä¸€ä¸ª <code>Android Module</code> ï¼Œé€šè¿‡åå°„è·å–ç”Ÿæˆçš„ç±»ï¼Œè¿›è¡Œåˆç†çš„å°è£…ï¼Œæä¾›ç»™ä¸Šå±‚è°ƒç”¨</p><p>å¦‚ä¸‹å›¾ï¼š</p><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/4415046ff7434044bc7959dd77d21358~tplv-k3u1fbpfcp-zoom-1.image" alt="image-20210627182425586"></p><p>è¿™æ˜¯æˆ‘çš„ APT å·¥ç¨‹ï¼Œå…³äº Module åç§°å¯ä»¥ä»»æ„å–ï¼ŒæŒ‰ç…§æˆ‘ä¸Šé¢è¯´çš„è§„åˆ™å»è¿›è¡Œå°±å¥½äº†</p><h3 id="2ï¼‰ã€Module-ä¾èµ–"><a href="#2ï¼‰ã€Module-ä¾èµ–" class="headerlink" title="2ï¼‰ã€Module ä¾èµ–"></a>2ï¼‰ã€Module ä¾èµ–</h3><p>å·¥ç¨‹åˆ›å»ºå¥½åï¼Œæˆ‘ä»¬å°±éœ€è¦ç†æ¸…æ¥šå„ä¸ª Module ä¹‹é—´çš„ä¸€ä¸ªä¾èµ–å…³ç³»ï¼š</p><p>1ã€å› ä¸º <code>apt-processor</code> è¦è¯»å– <code>apt-annotation</code> çš„æ³¨è§£ï¼Œæ‰€ä»¥ <code>apt-processor</code> éœ€è¦ä¾èµ– <code>apt-annotation</code> </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//apt-processor çš„ build.gradle æ–‡ä»¶</span><br>dependencies &#123;<br>    implementation <span class="hljs-title function_">project</span><span class="hljs-params">(path: <span class="hljs-string">&#x27;:apt-annotation&#x27;</span>)</span><br>&#125;<br></code></pre></td></tr></table></figure><p>2ã€app ä½œä¸ºè°ƒç”¨å±‚ï¼Œä»¥ä¸Š 3 ä¸ª Module éƒ½éœ€è¦è¿›è¡Œä¾èµ–</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//app çš„ build.gradle æ–‡ä»¶</span><br>dependencies &#123;<br>    <span class="hljs-comment">//...</span><br>    implementation <span class="hljs-title function_">project</span><span class="hljs-params">(path: <span class="hljs-string">&#x27;:apt-api&#x27;</span>)</span><br>    implementation <span class="hljs-title function_">project</span><span class="hljs-params">(path: <span class="hljs-string">&#x27;:apt-annotation&#x27;</span>)</span><br>    annotationProcessor <span class="hljs-title function_">project</span><span class="hljs-params">(path: <span class="hljs-string">&#x27;:apt-processor&#x27;</span>)</span><br>&#125;<br></code></pre></td></tr></table></figure><p>APT å·¥ç¨‹é…ç½®å¥½ä¹‹åï¼Œæˆ‘ä»¬å°±å¯ä»¥å¯¹å„ä¸ª Module è¿›è¡Œä¸€ä¸ªå…·ä½“ä»£ç çš„ç¼–å†™äº†</p><h2 id="ä¸‰ã€apt-annotation-æ³¨è§£ç¼–å†™"><a href="#ä¸‰ã€apt-annotation-æ³¨è§£ç¼–å†™" class="headerlink" title="ä¸‰ã€apt-annotation æ³¨è§£ç¼–å†™"></a>ä¸‰ã€apt-annotation æ³¨è§£ç¼–å†™</h2><p>è¿™ä¸ª Module çš„å¤„ç†ç›¸å¯¹æ¥è¯´å¾ˆç®€å•ï¼Œå°±æ˜¯ç¼–å†™ç›¸åº”çš„è‡ªå®šä¹‰æ³¨è§£å°±å¥½äº†ï¼Œæˆ‘ç¼–å†™çš„å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Inherited</span><br><span class="hljs-meta">@Documented</span><br><span class="hljs-meta">@Retention(RetentionPolicy.SOURCE)</span><br><span class="hljs-meta">@Target(&#123;ElementType.TYPE,ElementType.METHOD&#125;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-meta">@interface</span> AptAnnotation &#123;<br>    String <span class="hljs-title function_">desc</span><span class="hljs-params">()</span> <span class="hljs-keyword">default</span> <span class="hljs-string">&quot;&quot;</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="å››ã€apt-processor-è‡ªåŠ¨ç”Ÿæˆä»£ç "><a href="#å››ã€apt-processor-è‡ªåŠ¨ç”Ÿæˆä»£ç " class="headerlink" title="å››ã€apt-processor è‡ªåŠ¨ç”Ÿæˆä»£ç "></a>å››ã€apt-processor è‡ªåŠ¨ç”Ÿæˆä»£ç </h2><p>è¿™ä¸ª Module ç›¸å¯¹æ¥è¯´æ¯”è¾ƒå¤æ‚ï¼Œæˆ‘ä»¬æŠŠå®ƒåˆ†ä¸ºä»¥ä¸‹ 3 ä¸ªæ­¥éª¤ï¼š</p><p>1ã€æ³¨è§£å¤„ç†å™¨å£°æ˜</p><p>2ã€æ³¨è§£å¤„ç†å™¨æ³¨å†Œ</p><p>3ã€æ³¨è§£å¤„ç†å™¨ç”Ÿæˆç±»æ–‡ä»¶</p><h3 id="1ï¼‰ã€æ³¨è§£å¤„ç†å™¨å£°æ˜"><a href="#1ï¼‰ã€æ³¨è§£å¤„ç†å™¨å£°æ˜" class="headerlink" title="1ï¼‰ã€æ³¨è§£å¤„ç†å™¨å£°æ˜"></a>1ï¼‰ã€æ³¨è§£å¤„ç†å™¨å£°æ˜</h3><h4 id="1ã€æ–°å»ºä¸€ä¸ªç±»ï¼Œç±»åæŒ‰ç…§è‡ªå·±çš„å–œå¥½å–ï¼Œç»§æ‰¿-javax-annotation-processing-è¿™ä¸ªåŒ…ä¸‹çš„-AbstractProcessor-ç±»å¹¶å®ç°å…¶æŠ½è±¡æ–¹æ³•"><a href="#1ã€æ–°å»ºä¸€ä¸ªç±»ï¼Œç±»åæŒ‰ç…§è‡ªå·±çš„å–œå¥½å–ï¼Œç»§æ‰¿-javax-annotation-processing-è¿™ä¸ªåŒ…ä¸‹çš„-AbstractProcessor-ç±»å¹¶å®ç°å…¶æŠ½è±¡æ–¹æ³•" class="headerlink" title="1ã€æ–°å»ºä¸€ä¸ªç±»ï¼Œç±»åæŒ‰ç…§è‡ªå·±çš„å–œå¥½å–ï¼Œç»§æ‰¿ javax.annotation.processing è¿™ä¸ªåŒ…ä¸‹çš„ AbstractProcessor ç±»å¹¶å®ç°å…¶æŠ½è±¡æ–¹æ³•"></a>1ã€æ–°å»ºä¸€ä¸ªç±»ï¼Œç±»åæŒ‰ç…§è‡ªå·±çš„å–œå¥½å–ï¼Œç»§æ‰¿ <code>javax.annotation.processing</code> è¿™ä¸ªåŒ…ä¸‹çš„ AbstractProcessor ç±»å¹¶å®ç°å…¶æŠ½è±¡æ–¹æ³•</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AptAnnotationProcessor</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AbstractProcessor</span> &#123;<br>  <br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * ç¼–å†™ç”Ÿæˆ Java ç±»çš„ç›¸å…³é€»è¾‘</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> set              æ”¯æŒå¤„ç†çš„æ³¨è§£é›†åˆ</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> roundEnvironment é€šè¿‡è¯¥å¯¹è±¡æŸ¥æ‰¾æŒ‡å®šæ³¨è§£ä¸‹çš„èŠ‚ç‚¹ä¿¡æ¯</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> true: è¡¨ç¤ºæ³¨è§£å·²å¤„ç†ï¼Œåç»­æ³¨è§£å¤„ç†å™¨æ— éœ€å†å¤„ç†å®ƒä»¬ï¼›false: è¡¨ç¤ºæ³¨è§£æœªå¤„ç†ï¼Œå¯èƒ½è¦æ±‚åç»­æ³¨è§£å¤„ç†å™¨å¤„ç†</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">process</span><span class="hljs-params">(Set&lt;? extends TypeElement&gt; set, RoundEnvironment roundEnvironment)</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>é‡ç‚¹çœ‹ä¸‹ç¬¬ä¸€ä¸ªå‚æ•°ä¸­çš„ TypeElement ï¼Œè¿™ä¸ªå°±æ¶‰åŠåˆ° Element çš„çŸ¥è¯†ï¼Œæˆ‘ä»¬ç®€å•çš„ä»‹ç»ä¸€ä¸‹ï¼š</p><p><strong>Element ä»‹ç»</strong></p><p>å®é™…ä¸Šï¼ŒJava æºæ–‡ä»¶æ˜¯ä¸€ç§ç»“æ„ä½“è¯­è¨€ï¼Œæºä»£ç çš„æ¯ä¸€ä¸ªéƒ¨åˆ†éƒ½å¯¹åº”äº†ä¸€ä¸ªç‰¹å®šç±»å‹çš„ Element ï¼Œä¾‹å¦‚åŒ…ï¼Œç±»ï¼Œå­—æ®µï¼Œæ–¹æ³•ç­‰ç­‰ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.dream;         <span class="hljs-comment">// PackageElementï¼šåŒ…å…ƒç´ </span><br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Main</span>&lt;T&gt; &#123;     <span class="hljs-comment">// TypeElementï¼šç±»å…ƒç´ ; å…¶ä¸­ &lt;T&gt; å±äº TypeParameterElement æ³›å‹å…ƒç´ </span><br><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> x;         <span class="hljs-comment">// VariableElementï¼šå˜é‡ã€æšä¸¾ã€æ–¹æ³•å‚æ•°å…ƒç´ </span><br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Main</span><span class="hljs-params">()</span> &#123;        <span class="hljs-comment">// ExecuteableElementï¼šæ„é€ å‡½æ•°ã€æ–¹æ³•å…ƒç´ </span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>Java çš„ Element æ˜¯ä¸€ä¸ªæ¥å£ï¼Œæºç å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">Element</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">javax</span>.lang.model.AnnotatedConstruct &#123;<br>    <span class="hljs-comment">// è·å–å…ƒç´ çš„ç±»å‹ï¼Œå®é™…çš„å¯¹è±¡ç±»å‹</span><br>    TypeMirror <span class="hljs-title function_">asType</span><span class="hljs-params">()</span>;<br>    <span class="hljs-comment">// è·å–Elementçš„ç±»å‹ï¼Œåˆ¤æ–­æ˜¯å“ªç§Element</span><br>    ElementKind <span class="hljs-title function_">getKind</span><span class="hljs-params">()</span>;<br>    <span class="hljs-comment">// è·å–ä¿®é¥°ç¬¦ï¼Œå¦‚public static finalç­‰å…³é”®å­—</span><br>    Set&lt;Modifier&gt; <span class="hljs-title function_">getModifiers</span><span class="hljs-params">()</span>;<br>    <span class="hljs-comment">// è·å–ç±»å</span><br>    Name <span class="hljs-title function_">getSimpleName</span><span class="hljs-params">()</span>;<br>    <span class="hljs-comment">// è¿”å›åŒ…å«è¯¥èŠ‚ç‚¹çš„çˆ¶èŠ‚ç‚¹ï¼Œä¸getEnclosedElements()æ–¹æ³•ç›¸å</span><br>    Element <span class="hljs-title function_">getEnclosingElement</span><span class="hljs-params">()</span>;<br>    <span class="hljs-comment">// è¿”å›è¯¥èŠ‚ç‚¹ä¸‹ç›´æ¥åŒ…å«çš„å­èŠ‚ç‚¹ï¼Œä¾‹å¦‚åŒ…èŠ‚ç‚¹ä¸‹åŒ…å«çš„ç±»èŠ‚ç‚¹</span><br>    List&lt;? <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Element</span>&gt; getEnclosedElements();<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-type">boolean</span> <span class="hljs-title function_">equals</span><span class="hljs-params">(Object obj)</span>;<br>  <br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-type">int</span> <span class="hljs-title function_">hashCode</span><span class="hljs-params">()</span>;<br>  <br>    <span class="hljs-meta">@Override</span><br>    List&lt;? <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AnnotationMirror</span>&gt; getAnnotationMirrors();<br>  <br>    <span class="hljs-comment">//è·å–æ³¨è§£</span><br>    <span class="hljs-meta">@Override</span><br>    &lt;A <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Annotation</span>&gt; A <span class="hljs-title function_">getAnnotation</span><span class="hljs-params">(Class&lt;A&gt; annotationType)</span>;<br>  <br>    &lt;R, P&gt; R <span class="hljs-title function_">accept</span><span class="hljs-params">(ElementVisitor&lt;R, P&gt; v, P p)</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬å¯ä»¥é€šè¿‡ Element è·å–å¦‚ä¸Šä¸€äº›ä¿¡æ¯ï¼ˆå†™äº†æ³¨é‡Šçš„éƒ½æ˜¯ä¸€äº›å¸¸ç”¨çš„ï¼‰</p><p>ç”± Element è¡ç”Ÿå‡ºæ¥çš„æ‰©å±•ç±»å…±æœ‰ 5 ç§ï¼š</p><p>1ã€PackageElement è¡¨ç¤ºä¸€ä¸ªåŒ…ç¨‹åºå…ƒç´ </p><p>2ã€TypeElement è¡¨ç¤ºä¸€ä¸ªç±»æˆ–è€…æ¥å£ç¨‹åºå…ƒç´ </p><p>3ã€TypeParameterElement è¡¨ç¤ºä¸€ä¸ªæ³›å‹å…ƒç´ </p><p>4ã€VariableElement è¡¨ç¤ºä¸€ä¸ªå­—æ®µã€enum å¸¸é‡ã€æ–¹æ³•æˆ–è€…æ„é€ æ–¹æ³•çš„å‚æ•°ã€å±€éƒ¨å˜é‡æˆ–å¼‚å¸¸å‚æ•°</p><p>5ã€ExecuteableElement è¡¨ç¤ºæŸä¸ªç±»æˆ–è€…æ¥å£çš„æ–¹æ³•ã€æ„é€ æ–¹æ³•æˆ–åˆå§‹åŒ–ç¨‹åºï¼ˆé™æ€æˆ–è€…å®ä¾‹ï¼‰</p><p>å¯ä»¥å‘ç°ï¼ŒElement æœ‰æ—¶ä¼šä»£è¡¨å¤šç§å…ƒç´ ï¼Œä¾‹å¦‚ TypeElement ä»£è¡¨ç±»æˆ–æ¥å£ï¼Œæ­¤æ—¶æˆ‘ä»¬å¯ä»¥é€šè¿‡ element.getKind() æ¥åŒºåˆ†ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java">Set&lt;? <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Element</span>&gt; elements = roundEnvironment.getElementsAnnotatedWith(AptAnnotation.class);<br><span class="hljs-keyword">for</span> (Element element : elements) &#123;<br>    <span class="hljs-keyword">if</span> (element.getKind() == ElementKind.CLASS) &#123;<br>        <span class="hljs-comment">// å¦‚æœå…ƒç´ æ˜¯ç±»</span><br><br>    &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (element.getKind() == ElementKind.INTERFACE) &#123;<br>        <span class="hljs-comment">// å¦‚æœå…ƒç´ æ˜¯æ¥å£</span><br><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ElementKind æ˜¯ä¸€ä¸ªæšä¸¾ç±»ï¼Œå®ƒçš„å–å€¼æœ‰å¾ˆå¤šï¼Œå¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java">PACKAGE<span class="hljs-comment">//è¡¨ç¤ºåŒ…</span><br>ENUM <span class="hljs-comment">//è¡¨ç¤ºæšä¸¾</span><br>CLASS <span class="hljs-comment">//è¡¨ç¤ºç±»</span><br>ANNOTATION_TYPE<span class="hljs-comment">//è¡¨ç¤ºæ³¨è§£</span><br>INTERFACE <span class="hljs-comment">//è¡¨ç¤ºæ¥å£</span><br>ENUM_CONSTANT <span class="hljs-comment">//è¡¨ç¤ºæšä¸¾å¸¸é‡</span><br>FIELD <span class="hljs-comment">//è¡¨ç¤ºå­—æ®µ</span><br>PARAMETER <span class="hljs-comment">//è¡¨ç¤ºå‚æ•°</span><br>LOCAL_VARIABLE <span class="hljs-comment">//è¡¨ç¤ºæœ¬åœ°å˜é‡</span><br>EXCEPTION_PARAMETER <span class="hljs-comment">//è¡¨ç¤ºå¼‚å¸¸å‚æ•°</span><br>METHOD <span class="hljs-comment">//è¡¨ç¤ºæ–¹æ³•</span><br>CONSTRUCTOR <span class="hljs-comment">//è¡¨ç¤ºæ„é€ å‡½æ•°</span><br>OTHER <span class="hljs-comment">//è¡¨ç¤ºå…¶ä»–</span><br></code></pre></td></tr></table></figure><p>å…³äº Element å°±ä»‹ç»åˆ°è¿™ï¼Œæˆ‘ä»¬æ¥ç€å¾€ä¸‹çœ‹</p><h4 id="2ã€é‡å†™æ–¹æ³•è§£è¯»"><a href="#2ã€é‡å†™æ–¹æ³•è§£è¯»" class="headerlink" title="2ã€é‡å†™æ–¹æ³•è§£è¯»"></a>2ã€é‡å†™æ–¹æ³•è§£è¯»</h4><p>é™¤äº†å¿…é¡»å®ç°çš„è¿™ä¸ªæŠ½è±¡æ–¹æ³•ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥é‡å†™å…¶ä»– 4 ä¸ªå¸¸ç”¨çš„æ–¹æ³•ï¼Œå¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AptAnnotationProcessor</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AbstractProcessor</span> &#123;<br>    <span class="hljs-comment">//...</span><br>  <br>    <span class="hljs-comment">/** </span><br><span class="hljs-comment">     * èŠ‚ç‚¹å·¥å…·ç±»ï¼ˆç±»ã€å‡½æ•°ã€å±æ€§éƒ½æ˜¯èŠ‚ç‚¹ï¼‰</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">private</span> Elements mElementUtils;<br><br>    <span class="hljs-comment">/** </span><br><span class="hljs-comment">     * ç±»ä¿¡æ¯å·¥å…·ç±»</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">private</span> Types mTypeUtils;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * æ–‡ä»¶ç”Ÿæˆå™¨</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">private</span> Filer mFiler;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * æ—¥å¿—ä¿¡æ¯æ‰“å°å™¨</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">private</span> Messager mMessager;<br>  <br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * åšä¸€äº›åˆå§‹åŒ–çš„å·¥ä½œ</span><br><span class="hljs-comment">     * </span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> processingEnvironment è¿™ä¸ªå‚æ•°æä¾›äº†è‹¥å¹²å·¥å…·ç±»ï¼Œä¾›ç¼–å†™ç”Ÿæˆ Java ç±»æ—¶æ‰€ä½¿ç”¨</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">synchronized</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">init</span><span class="hljs-params">(ProcessingEnvironment processingEnv)</span> &#123;<br>        <span class="hljs-built_in">super</span>.init(processingEnv);<br>        mElementUtils = processingEnv.getElementUtils();<br>        mTypeUtils = processingEnv.getTypeUtils();<br>        mFiler = processingEnv.getFiler();<br>        mMessager = processingEnv.getMessager();<br>    &#125;<br>  <br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * æ¥æ”¶å¤–æ¥ä¼ å…¥çš„å‚æ•°ï¼Œæœ€å¸¸ç”¨çš„å½¢å¼å°±æ˜¯åœ¨ build.gradle è„šæœ¬æ–‡ä»¶é‡Œçš„ javaCompileOptions çš„é…ç½®</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> å±æ€§çš„ Key é›†åˆ</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> Set&lt;String&gt; <span class="hljs-title function_">getSupportedOptions</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">super</span>.getSupportedOptions();<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * å½“å‰æ³¨è§£å¤„ç†å™¨æ”¯æŒçš„æ³¨è§£é›†åˆï¼Œå¦‚æœæ”¯æŒï¼Œå°±ä¼šè°ƒç”¨ process æ–¹æ³•</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> æ”¯æŒçš„æ³¨è§£é›†åˆ</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> Set&lt;String&gt; <span class="hljs-title function_">getSupportedAnnotationTypes</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">super</span>.getSupportedAnnotationTypes();<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * ç¼–è¯‘å½“å‰æ³¨è§£å¤„ç†å™¨çš„ JDK ç‰ˆæœ¬</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> JDK ç‰ˆæœ¬</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> SourceVersion <span class="hljs-title function_">getSupportedSourceVersion</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">super</span>.getSupportedSourceVersion();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><strong>æ³¨æ„</strong>ï¼š<code>getSupportedAnnotationTypes()</code>ã€<code>getSupportedSourceVersion()</code>å’Œ<code>getSupportedOptions()</code> è¿™ä¸‰ä¸ªæ–¹æ³•ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥é‡‡ç”¨æ³¨è§£çš„æ–¹å¼è¿›è¡Œæä¾›ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@SupportedOptions(&quot;MODULE_NAME&quot;)</span><br><span class="hljs-meta">@SupportedAnnotationTypes(&quot;com.dream.apt_annotation.AptAnnotation&quot;)</span><br><span class="hljs-meta">@SupportedSourceVersion(SourceVersion.RELEASE_8)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AptAnnotationProcessor</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AbstractProcessor</span> &#123;<br>    <span class="hljs-comment">//...</span><br>&#125;<br></code></pre></td></tr></table></figure><h3 id="2ï¼‰ã€æ³¨è§£å¤„ç†å™¨æ³¨å†Œ"><a href="#2ï¼‰ã€æ³¨è§£å¤„ç†å™¨æ³¨å†Œ" class="headerlink" title="2ï¼‰ã€æ³¨è§£å¤„ç†å™¨æ³¨å†Œ"></a>2ï¼‰ã€æ³¨è§£å¤„ç†å™¨æ³¨å†Œ</h3><p>æ³¨è§£å¤„ç†å™¨å£°æ˜å¥½äº†ï¼Œä¸‹ä¸€æ­¥æˆ‘ä»¬å°±è¦æ³¨å†Œå®ƒï¼Œå…¶ä¸­æ³¨å†Œæœ‰ä¸¤ç§æ–¹å¼ï¼š</p><p>1ã€æ‰‹åŠ¨æ³¨å†Œ</p><p>2ã€è‡ªåŠ¨æ³¨å†Œ</p><p>æ‰‹åŠ¨æ³¨å†Œæ¯”è¾ƒç¹çå›ºå®šä¸”å®¹æ˜“å‡ºé”™ï¼Œä¸æ¨èä½¿ç”¨ï¼Œè¿™é‡Œå°±ä¸è®²äº†ã€‚æˆ‘ä»¬ä¸»è¦çœ‹ä¸‹è‡ªåŠ¨æ³¨å†Œ</p><h4 id="è‡ªåŠ¨æ³¨å†Œ"><a href="#è‡ªåŠ¨æ³¨å†Œ" class="headerlink" title="è‡ªåŠ¨æ³¨å†Œ"></a>è‡ªåŠ¨æ³¨å†Œ</h4><p>1ã€é¦–å…ˆæˆ‘ä»¬è¦åœ¨ <code>apt-processor</code>è¿™ä¸ª Module ä¸‹çš„ build.gradle æ–‡ä»¶å¯¼å…¥å¦‚ä¸‹ä¾èµ–ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java">implementation <span class="hljs-string">&#x27;com.google.auto.service:auto-service:1.0-rc6&#x27;</span><br>annotationProcessor <span class="hljs-string">&#x27;com.google.auto.service:auto-service:1.0-rc6&#x27;</span><br></code></pre></td></tr></table></figure><p><strong>æ³¨æ„</strong>ï¼šè¿™ä¸¤å¥å¿…é¡»éƒ½è¦åŠ ï¼Œå¦åˆ™æ³¨å†Œä¸æˆåŠŸï¼Œæˆ‘ä¹‹å‰è¸©å‘äº†</p><p>2ã€åœ¨æ³¨è§£å¤„ç†å™¨ä¸ŠåŠ ä¸Š <code>@AutoService(Processor.class)</code> å³å¯å®Œæˆæ³¨å†Œ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@AutoService(Processor.class)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AptAnnotationProcessor</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AbstractProcessor</span> &#123;<br>    <span class="hljs-comment">//...</span><br>&#125;<br></code></pre></td></tr></table></figure><h3 id="3ï¼‰ã€æ³¨è§£å¤„ç†å™¨ç”Ÿæˆç±»æ–‡ä»¶"><a href="#3ï¼‰ã€æ³¨è§£å¤„ç†å™¨ç”Ÿæˆç±»æ–‡ä»¶" class="headerlink" title="3ï¼‰ã€æ³¨è§£å¤„ç†å™¨ç”Ÿæˆç±»æ–‡ä»¶"></a>3ï¼‰ã€æ³¨è§£å¤„ç†å™¨ç”Ÿæˆç±»æ–‡ä»¶</h3><p>æ³¨å†Œå®Œæˆä¹‹åï¼Œæˆ‘ä»¬å°±å¯ä»¥æ­£å¼ç¼–å†™ç”Ÿæˆ Java ç±»æ–‡ä»¶çš„ä»£ç äº†ï¼Œå…¶ä¸­ç”Ÿæˆä¹Ÿæœ‰ä¸¤ç§æ–¹å¼ï¼š</p><p>1ã€å¸¸è§„çš„å†™æ–‡ä»¶æ–¹å¼</p><p>2ã€é€šè¿‡ javapoet æ¡†æ¶æ¥ç¼–å†™</p><p>1 çš„æ–¹å¼æ¯”è¾ƒæ­»æ¿ï¼Œéœ€è¦æŠŠæ¯ä¸€ä¸ªå­—æ¯éƒ½å†™ä¸Šï¼Œä¸æ¨èä½¿ç”¨ï¼Œè¿™é‡Œå°±ä¸è®²äº†ã€‚æˆ‘ä»¬ä¸»è¦çœ‹ä¸‹é€šè¿‡ javapoet è¿™ä¸ªæ¡†æ¶ç”Ÿæˆ Java ç±»æ–‡ä»¶</p><h4 id="javapoet-æ–¹å¼"><a href="#javapoet-æ–¹å¼" class="headerlink" title="javapoet æ–¹å¼"></a>javapoet æ–¹å¼</h4><p>è¿™ç§æ–¹å¼æ›´åŠ ç¬¦åˆé¢å‘å¯¹è±¡ç¼–ç çš„ä¸€ä¸ªé£æ ¼ï¼Œå¯¹ javapoet è¿˜ä¸ç†Ÿçš„æœ‹å‹ï¼Œå¯ä»¥å» github ä¸Šå­¦ä¹ ä¸€æ³¢ <a href="https://github.com/square/javapoet">ä¼ é€é—¨</a>ï¼Œè¿™é‡Œæˆ‘ä»¬ä»‹ç»ä¸€ä¸‹å®ƒå¸¸ç”¨çš„ä¸€äº›ç±»ï¼š</p><blockquote><p>TypeSpecï¼šç”¨äºç”Ÿæˆç±»ã€æ¥å£ã€æšä¸¾å¯¹è±¡çš„ç±»</p><p>MethodSpecï¼šç”¨äºç”Ÿæˆæ–¹æ³•å¯¹è±¡çš„ç±»</p><p>ParameterSpecï¼šç”¨äºç”Ÿæˆå‚æ•°å¯¹è±¡çš„ç±»</p><p>AnnotationSpecï¼šç”¨äºç”Ÿæˆæ³¨è§£å¯¹è±¡çš„ç±»</p><p>FieldSpecï¼šç”¨äºé…ç½®ç”Ÿæˆæˆå‘˜å˜é‡çš„ç±»</p><p>ClassNameï¼šé€šè¿‡åŒ…åå’Œç±»åç”Ÿæˆçš„å¯¹è±¡ï¼Œåœ¨JavaPoetä¸­ç›¸å½“äºä¸ºå…¶æŒ‡å®š Class</p><p>ParameterizedTypeNameï¼šé€šè¿‡ MainClass å’Œ IncludeClass ç”ŸæˆåŒ…å«æ³›å‹çš„ Class</p><p>JavaFileï¼šæ§åˆ¶ç”Ÿæˆçš„ Java æ–‡ä»¶çš„è¾“å‡ºçš„ç±»</p></blockquote><h5 id="1ã€å¯¼å…¥-javapoet-æ¡†æ¶ä¾èµ–"><a href="#1ã€å¯¼å…¥-javapoet-æ¡†æ¶ä¾èµ–" class="headerlink" title="1ã€å¯¼å…¥ javapoet æ¡†æ¶ä¾èµ–"></a>1ã€å¯¼å…¥ javapoet æ¡†æ¶ä¾èµ–</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">implementation <span class="hljs-string">&#x27;com.squareup:javapoet:1.13.0&#x27;</span><br></code></pre></td></tr></table></figure><h5 id="2ã€æŒ‰ç…§æŒ‡å®šä»£ç æ¨¡ç‰ˆç”Ÿæˆ-Java-ç±»æ–‡ä»¶"><a href="#2ã€æŒ‰ç…§æŒ‡å®šä»£ç æ¨¡ç‰ˆç”Ÿæˆ-Java-ç±»æ–‡ä»¶" class="headerlink" title="2ã€æŒ‰ç…§æŒ‡å®šä»£ç æ¨¡ç‰ˆç”Ÿæˆ Java ç±»æ–‡ä»¶"></a>2ã€æŒ‰ç…§æŒ‡å®šä»£ç æ¨¡ç‰ˆç”Ÿæˆ Java ç±»æ–‡ä»¶</h5><p>ä¾‹å¦‚ï¼Œæˆ‘åœ¨ app çš„ build.gradle ä¸‹è¿›è¡Œäº†å¦‚ä¸‹é…ç½®ï¼š</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs groovy">android &#123;<br>    <span class="hljs-comment">//...</span><br>    defaultConfig &#123;<br>        <span class="hljs-comment">//...</span><br>        javaCompileOptions &#123;<br>            annotationProcessorOptions &#123;<br>                arguments = [<span class="hljs-attr">MODULE_NAME:</span> project.getName()]<br>            &#125;<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>åœ¨ MainActivity ä¸‹é¢è¿›è¡Œäº†å¦‚ä¸‹æ³¨è§£ï¼š</p><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/0fcccf3c6fe64a88bb00488bb1cb9308~tplv-k3u1fbpfcp-zoom-1.image" alt="image-20210627212604288"></p><p>æˆ‘å¸Œæœ›ç”Ÿæˆçš„ä»£ç å¦‚ä¸‹ï¼š</p><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/cd59cb4022624f7c9c171fa22441dd99~tplv-k3u1fbpfcp-zoom-1.image" alt="image-20210627220320906"></p><p>ç°åœ¨æˆ‘ä»¬æ¥å®æ“ä¸€ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@AutoService(Processor.class)</span><br><span class="hljs-meta">@SupportedOptions(&quot;MODULE_NAME&quot;)</span><br><span class="hljs-meta">@SupportedAnnotationTypes(&quot;com.dream.apt_annotation.AptAnnotation&quot;)</span><br><span class="hljs-meta">@SupportedSourceVersion(SourceVersion.RELEASE_8)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AptAnnotationProcessor</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AbstractProcessor</span> &#123;<br><br>    <span class="hljs-comment">//æ–‡ä»¶ç”Ÿæˆå™¨</span><br>    Filer filer;<br>    <span class="hljs-comment">//æ¨¡å—å</span><br>    <span class="hljs-keyword">private</span> String mModuleName;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">synchronized</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">init</span><span class="hljs-params">(ProcessingEnvironment processingEnvironment)</span> &#123;<br>        <span class="hljs-built_in">super</span>.init(processingEnvironment);<br>      <span class="hljs-comment">//åˆå§‹åŒ–æ–‡ä»¶ç”Ÿæˆå™¨</span><br>        filer = processingEnvironment.getFiler();<br>      <span class="hljs-comment">//é€šè¿‡ key è·å– build.gradle ä¸­å¯¹åº”çš„ value</span><br>        mModuleName = processingEnv.getOptions().get(<span class="hljs-string">&quot;MODULE_NAME&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">process</span><span class="hljs-params">(Set&lt;? extends TypeElement&gt; set, RoundEnvironment roundEnvironment)</span> &#123;<br>        <span class="hljs-keyword">if</span> (set == <span class="hljs-literal">null</span> || set.isEmpty()) &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>        &#125;<br><br>      <span class="hljs-comment">//è·å–å½“å‰æ³¨è§£ä¸‹çš„èŠ‚ç‚¹ä¿¡æ¯</span><br>        Set&lt;? <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Element</span>&gt; rootElements = roundEnvironment.getElementsAnnotatedWith(AptAnnotation.class);<br><br>        <span class="hljs-comment">// æ„å»º test å‡½æ•°</span><br>        MethodSpec.<span class="hljs-type">Builder</span> <span class="hljs-variable">builder</span> <span class="hljs-operator">=</span> MethodSpec.methodBuilder(<span class="hljs-string">&quot;test&quot;</span>)<br>                .addModifiers(Modifier.PUBLIC) <span class="hljs-comment">// æŒ‡å®šæ–¹æ³•ä¿®é¥°ç¬¦</span><br>                .returns(<span class="hljs-keyword">void</span>.class) <span class="hljs-comment">// æŒ‡å®šè¿”å›ç±»å‹</span><br>                .addParameter(String.class, <span class="hljs-string">&quot;param&quot;</span>); <span class="hljs-comment">// æ·»åŠ å‚æ•°</span><br>        builder.addStatement(<span class="hljs-string">&quot;$T.out.println($S)&quot;</span>, System.class, <span class="hljs-string">&quot;æ¨¡å—: &quot;</span> + mModuleName);<br><br>        <span class="hljs-keyword">if</span> (rootElements != <span class="hljs-literal">null</span> &amp;&amp; !rootElements.isEmpty()) &#123;<br>            <span class="hljs-keyword">for</span> (Element element : rootElements) &#123;<br>              <span class="hljs-comment">//å½“å‰èŠ‚ç‚¹åç§°</span><br>                <span class="hljs-type">String</span> <span class="hljs-variable">elementName</span> <span class="hljs-operator">=</span> element.getSimpleName().toString();<br>              <span class="hljs-comment">//å½“å‰èŠ‚ç‚¹ä¸‹æ³¨è§£çš„å±æ€§</span><br>                <span class="hljs-type">String</span> <span class="hljs-variable">desc</span> <span class="hljs-operator">=</span> element.getAnnotation(AptAnnotation.class).desc();<br>                <span class="hljs-comment">// æ„å»ºæ–¹æ³•ä½“</span><br>                builder.addStatement(<span class="hljs-string">&quot;$T.out.println($S)&quot;</span>, System.class, <br>                                     <span class="hljs-string">&quot;èŠ‚ç‚¹: &quot;</span> + elementName + <span class="hljs-string">&quot;  &quot;</span> + <span class="hljs-string">&quot;æè¿°: &quot;</span> + desc);<br>            &#125;<br>        &#125;<br>        <span class="hljs-type">MethodSpec</span> <span class="hljs-variable">main</span> <span class="hljs-operator">=</span>builder.build();<br><br>        <span class="hljs-comment">// æ„å»º HelloWorld ç±»</span><br>        <span class="hljs-type">TypeSpec</span> <span class="hljs-variable">helloWorld</span> <span class="hljs-operator">=</span> TypeSpec.classBuilder(<span class="hljs-string">&quot;HelloWorld&quot;</span>)<br>                .addModifiers(Modifier.PUBLIC) <span class="hljs-comment">// æŒ‡å®šç±»ä¿®é¥°ç¬¦</span><br>                .addMethod(main) <span class="hljs-comment">// æ·»åŠ æ–¹æ³•</span><br>                .build();<br><br>        <span class="hljs-comment">// æŒ‡å®šåŒ…è·¯å¾„ï¼Œæ„å»ºæ–‡ä»¶ä½“</span><br>        <span class="hljs-type">JavaFile</span> <span class="hljs-variable">javaFile</span> <span class="hljs-operator">=</span> JavaFile.builder(<span class="hljs-string">&quot;com.dream.aptdemo&quot;</span>, helloWorld).build();<br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-comment">// åˆ›å»ºæ–‡ä»¶</span><br>            javaFile.writeTo(filer);<br>        &#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;<br>            e.printStackTrace();<br>        &#125;<br><br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ç»è¿‡ä¸Šé¢è¿™äº›æ­¥éª¤ï¼Œæˆ‘ä»¬è¿è¡Œ App å°±èƒ½ç”Ÿæˆä¸Šé¢æˆªå›¾çš„ä»£ç äº†ï¼Œç°åœ¨è¿˜å·®æœ€åä¸€æ­¥ï¼Œå¯¹ç”Ÿæˆçš„ä»£ç è¿›è¡Œä½¿ç”¨</p><p><strong>æ³¨æ„</strong>ï¼šä¸åŒç‰ˆæœ¬çš„ Gradle ç”Ÿæˆçš„ç±»æ–‡ä»¶ä½ç½®å¯èƒ½ä¸ä¸€æ ·ï¼Œæˆ‘çš„ Gradle ç‰ˆæœ¬æ˜¯ 6.7.1ï¼Œç”Ÿæˆçš„ç±»æ–‡ä»¶åœ¨å¦‚ä¸‹ä½ç½®ï¼š</p><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/3d51e6dd32ab4042a4d5905122b6ef43~tplv-k3u1fbpfcp-zoom-1.image" alt="image-20210627221836736"></p><p>ä¸€äº›ä½ç‰ˆæœ¬çš„ Gradle ç”Ÿæˆçš„ç±»æ–‡ä»¶åœ¨ <code>/build/generated/source</code> è¿™ä¸ªç›®å½•ä¸‹</p><h2 id="äº”ã€apt-api-è°ƒç”¨ç”Ÿæˆä»£ç å®Œæˆä¸šåŠ¡åŠŸèƒ½"><a href="#äº”ã€apt-api-è°ƒç”¨ç”Ÿæˆä»£ç å®Œæˆä¸šåŠ¡åŠŸèƒ½" class="headerlink" title="äº”ã€apt-api è°ƒç”¨ç”Ÿæˆä»£ç å®Œæˆä¸šåŠ¡åŠŸèƒ½"></a>äº”ã€apt-api è°ƒç”¨ç”Ÿæˆä»£ç å®Œæˆä¸šåŠ¡åŠŸèƒ½</h2><p>è¿™ä¸ª Module çš„æ“ä½œç›¸å¯¹æ¥è¯´ä¹Ÿæ¯”è¾ƒç®€å•ï¼Œå°±æ˜¯é€šè¿‡åå°„è·å–åˆ°ç”Ÿæˆçš„ç±»ï¼Œè¿›è¡Œç›¸åº”çš„å°è£…ä½¿ç”¨å³å¯ï¼Œæˆ‘çš„ç¼–å†™å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyAptApi</span> &#123;<br><br>    <span class="hljs-meta">@SuppressWarnings(&quot;all&quot;)</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">init</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-type">Class</span> <span class="hljs-variable">c</span> <span class="hljs-operator">=</span> Class.forName(<span class="hljs-string">&quot;com.dream.aptdemo.HelloWorld&quot;</span>);<br>            <span class="hljs-type">Constructor</span> <span class="hljs-variable">declaredConstructor</span> <span class="hljs-operator">=</span> c.getDeclaredConstructor();<br>            <span class="hljs-type">Object</span> <span class="hljs-variable">o</span> <span class="hljs-operator">=</span> declaredConstructor.newInstance();<br>            <span class="hljs-type">Method</span> <span class="hljs-variable">test</span> <span class="hljs-operator">=</span> c.getDeclaredMethod(<span class="hljs-string">&quot;test&quot;</span>, String.class);<br>            test.invoke(o, <span class="hljs-string">&quot;&quot;</span>);<br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            e.printStackTrace();<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æ¥ç€æˆ‘ä»¬åœ¨ MainActivity çš„ oncreate æ–¹æ³•é‡Œé¢è¿›è¡Œè°ƒç”¨ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@AptAnnotation(desc = &quot;æˆ‘æ˜¯ MainActivity ä¸Šé¢çš„æ³¨è§£&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MainActivity</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AppCompatActivity</span> &#123;<br>  <br>    <span class="hljs-meta">@AptAnnotation(desc = &quot;æˆ‘æ˜¯ onCreate ä¸Šé¢çš„æ³¨è§£&quot;)</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onCreate</span><span class="hljs-params">(Bundle savedInstanceState)</span> &#123;<br>        <span class="hljs-built_in">super</span>.onCreate(savedInstanceState);<br>        setContentView(R.layout.activity_main);<br>        MyAptApi.init();<br>    &#125;<br>&#125;<br><span class="hljs-comment">//æ‰“å°ç»“æœ</span><br>æ¨¡å—: app<br>èŠ‚ç‚¹: MainActivity  æè¿°: æˆ‘æ˜¯ MainActivity ä¸Šé¢çš„æ³¨è§£<br>èŠ‚ç‚¹: onCreate  æè¿°: æˆ‘æ˜¯ onCreate ä¸Šé¢çš„æ³¨è§£<br></code></pre></td></tr></table></figure><h2 id="å…­ã€æ€»ç»“"><a href="#å…­ã€æ€»ç»“" class="headerlink" title="å…­ã€æ€»ç»“"></a>å…­ã€æ€»ç»“</h2><p>æœ¬ç¯‡æ–‡ç« è®²çš„ä¸€äº›é‡ç‚¹å†…å®¹ï¼š</p><p>1ã€APT å·¥ç¨‹æ‰€éœ€åˆ›å»ºçš„ä¸åŒç§ç±»çš„ Module åŠ Module ä¹‹é—´çš„ä¾èµ–å…³ç³»</p><p>2ã€Java æºæ–‡ä»¶å®é™…ä¸Šæ˜¯ä¸€ç§ç»“æ„ä½“è¯­è¨€ï¼Œæºä»£ç çš„æ¯ä¸€ä¸ªéƒ¨åˆ†éƒ½å¯¹åº”äº†ä¸€ä¸ªç‰¹å®šç±»å‹çš„ Element</p><p>3ã€é‡‡ç”¨ auto-service å¯¹æ³¨è§£å¤„ç†å™¨è¿›è¡Œè‡ªåŠ¨æ³¨å†Œ</p><p>4ã€é‡‡ç”¨ javapoet æ¡†æ¶ç¼–å†™æ‰€éœ€ç”Ÿæˆçš„ Java ç±»æ–‡ä»¶</p><p>5ã€é€šè¿‡åå°„åŠé€‚å½“çš„å°è£…ï¼Œå°†ç”Ÿæˆçš„ç±»çš„åŠŸèƒ½æä¾›ç»™ä¸Šå±‚è°ƒç”¨</p><p>å¥½äº†ï¼Œæœ¬ç¯‡æ–‡ç« åˆ°è¿™é‡Œå°±ç»“æŸäº†ï¼Œå¸Œæœ›èƒ½ç»™ä½ å¸¦æ¥å¸®åŠ© ğŸ¤ </p><p><strong>æ„Ÿè°¢ä½ é˜…è¯»è¿™ç¯‡æ–‡ç« </strong></p><h3 id="ä¸‹ç¯‡é¢„å‘Š"><a href="#ä¸‹ç¯‡é¢„å‘Š" class="headerlink" title="ä¸‹ç¯‡é¢„å‘Š"></a>ä¸‹ç¯‡é¢„å‘Š</h3><p>ä¸‹ç¯‡æ–‡ç« æˆ‘ä¼šè®²æˆ‘æ˜¯å¦‚ä½•åº”ç”¨ APT æŠ€æœ¯å®ç°åå°„åˆ›å»º View çš„ä¸€ä¸ªæ›¿æ¢ï¼Œæ•¬è¯·æœŸå¾…å§ğŸ˜„</p><h3 id="å‚è€ƒå’Œæ¨è"><a href="#å‚è€ƒå’Œæ¨è" class="headerlink" title="å‚è€ƒå’Œæ¨è"></a>å‚è€ƒå’Œæ¨è</h3><p><a href="https://juejin.cn/post/6963873016220663844#comment">Androidæ³¨è§£å¤„ç†å™¨APTæŠ€æœ¯æ¢ç©¶</a></p><blockquote><p><strong>ä½ çš„ç‚¹èµï¼Œè¯„è®ºï¼Œæ˜¯å¯¹æˆ‘å·¨å¤§çš„é¼“åŠ±ï¼</strong></p><p>æ¬¢è¿å…³æ³¨æˆ‘çš„<strong>å…¬ä¼—å·ï¼š</strong>  <a href="http://m6z.cn/6jwi7b"><strong>sweetying</strong></a> ï¼Œæ–‡ç« æ›´æ–°å¯ç¬¬ä¸€æ—¶é—´æ”¶åˆ°</p><p>å¦‚æœ<strong>æœ‰é—®é¢˜</strong>ï¼Œå…¬ä¼—å·å†…æœ‰åŠ æˆ‘å¾®ä¿¡çš„å…¥å£ï¼Œåœ¨æŠ€æœ¯å­¦ä¹ ã€ä¸ªäººæˆé•¿çš„é“è·¯ä¸Šï¼Œæˆ‘ä»¬ä¸€èµ·å‰è¿›ï¼</p></blockquote>]]></content>
    
    
    <categories>
      
      <category>Android</category>
      
      <category>APT</category>
      
    </categories>
    
    
    <tags>
      
      <tag>åŸåˆ›</tag>
      
      <tag>Android</tag>
      
      <tag>Android APT</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Android APT ç³»åˆ— ï¼ˆäºŒï¼‰ï¼šAPT ç­‘åŸºä¹‹æ³¨è§£</title>
    <link href="/2022/10/10/Android%20APT%20%E7%B3%BB%E5%88%97%20%EF%BC%88%E4%BA%8C%EF%BC%89%EF%BC%9AAPT%20%E7%AD%91%E5%9F%BA%E4%B9%8B%E6%B3%A8%E8%A7%A3/"/>
    <url>/2022/10/10/Android%20APT%20%E7%B3%BB%E5%88%97%20%EF%BC%88%E4%BA%8C%EF%BC%89%EF%BC%9AAPT%20%E7%AD%91%E5%9F%BA%E4%B9%8B%E6%B3%A8%E8%A7%A3/</url>
    
    <content type="html"><![CDATA[<p><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/aee69ebabed54908974c6173800ee1ff~tplv-k3u1fbpfcp-watermark.image"></p><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>å¾ˆé«˜å…´é‡è§ä½ ~</p><p>åœ¨æœ¬ç³»åˆ—çš„ä¸Šä¸€ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å¯¹åå°„ä¸€äº›å¸¸ç”¨çš„çŸ¥è¯†è¿›è¡Œäº†è®²è§£ï¼Œè¿˜æ²¡æœ‰çœ‹è¿‡ä¸Šä¸€ç¯‡æ–‡ç« çš„æœ‹å‹ï¼Œå»ºè®®å…ˆå»é˜…è¯» <a href="https://juejin.cn/post/6977679823132950536">Android APT ç³»åˆ— ï¼ˆä¸€ï¼‰ï¼šAPT ç­‘åŸºä¹‹åå°„</a>ã€‚æ¥ä¸‹æ¥æˆ‘ä»¬çœ‹ä¸‹ Java æ³¨è§£</p><p><a href="https://github.com/sweetying520/AptDemo">Github Demo åœ°å€</a> , å¤§å®¶å¯ä»¥çœ‹ Demo è·Ÿéšæˆ‘çš„æ€è·¯ä¸€èµ·åˆ†æ</p><h2 id="ä¸€ã€æ³¨è§£ä»‹ç»"><a href="#ä¸€ã€æ³¨è§£ä»‹ç»" class="headerlink" title="ä¸€ã€æ³¨è§£ä»‹ç»"></a>ä¸€ã€æ³¨è§£ä»‹ç»</h2><h3 id="1ï¼‰ã€ä»€ä¹ˆæ˜¯æ³¨è§£ï¼Ÿ"><a href="#1ï¼‰ã€ä»€ä¹ˆæ˜¯æ³¨è§£ï¼Ÿ" class="headerlink" title="1ï¼‰ã€ä»€ä¹ˆæ˜¯æ³¨è§£ï¼Ÿ"></a>1ï¼‰ã€ä»€ä¹ˆæ˜¯æ³¨è§£ï¼Ÿ</h3><p>è¦è§£é‡Šæ³¨è§£æˆ‘ä»¬é¦–å…ˆè¦æ˜ç™½ä»€ä¹ˆæ˜¯å…ƒæ•°æ®ï¼š<strong>å…ƒæ•°æ®å°±æ˜¯ä¸ºå…¶ä»–æ•°æ®æä¾›ä¿¡æ¯çš„æ•°æ®</strong></p><p>é‚£ä¹ˆè¿˜æ˜¯å¼•å…¥å®˜æ–¹ä¸€æ®µå¯¹æ³¨è§£çš„è§£é‡Šï¼š<strong>æ³¨è§£ç”¨äºä¸ºä»£ç æä¾›å…ƒæ•°æ®ã€‚ä½œä¸ºå…ƒæ•°æ®ï¼Œæ³¨è§£ä¸ç›´æ¥å½±å“ä½ çš„ä»£ç æ‰§è¡Œï¼Œä½†ä¹Ÿæœ‰ä¸€äº›ç±»å‹çš„æ³¨è§£å®é™…ä¸Šå¯ä»¥ç”¨äºè¿™ä¸€ç›®çš„ã€‚Java æ³¨è§£æ˜¯ä» JDK 1.5 å¼€å§‹æ·»åŠ åˆ° Java çš„ã€‚</strong></p><p>ç®€å•çš„ç†è§£ï¼š<strong>æ³¨è§£å°±æ˜¯é™„åŠ åˆ°ä»£ç ä¸Šçš„ä¸€ç§é¢å¤–è¡¥å……ä¿¡æ¯</strong></p><h3 id="2ï¼‰ã€æ³¨è§£æœ‰å“ªäº›ä½œç”¨ï¼Ÿ"><a href="#2ï¼‰ã€æ³¨è§£æœ‰å“ªäº›ä½œç”¨ï¼Ÿ" class="headerlink" title="2ï¼‰ã€æ³¨è§£æœ‰å“ªäº›ä½œç”¨ï¼Ÿ"></a>2ï¼‰ã€æ³¨è§£æœ‰å“ªäº›ä½œç”¨ï¼Ÿ</h3><p><strong>æºç é˜¶æ®µæ³¨è§£</strong>ï¼š ç¼–è¯‘å™¨å¯åˆ©ç”¨è¯¥é˜¶æ®µæ³¨è§£æ£€æµ‹é”™è¯¯ï¼Œæç¤ºè­¦å‘Šä¿¡æ¯ï¼Œæ‰“å°æ—¥å¿—ç­‰</p><p><strong>ç¼–è¯‘é˜¶æ®µæ³¨è§£</strong>ï¼šåˆ©ç”¨æ³¨è§£ä¿¡æ¯è‡ªåŠ¨ç”Ÿæˆä»£ç ã€æ–‡æ¡£æˆ–è€…åšå…¶å®ƒç›¸åº”çš„è‡ªåŠ¨å¤„ç†</p><p><strong>è¿è¡Œé˜¶æ®µæ³¨è§£</strong>ï¼š å¯é€šè¿‡åå°„è·å–æ³¨è§£ä¿¡æ¯ï¼Œåšç›¸åº”æ“ä½œ</p><h3 id="3ï¼‰ã€å¦‚ä½•è‡ªå®šä¹‰å®šä¹‰ä¸€ä¸ªæ³¨è§£ï¼Ÿ"><a href="#3ï¼‰ã€å¦‚ä½•è‡ªå®šä¹‰å®šä¹‰ä¸€ä¸ªæ³¨è§£ï¼Ÿ" class="headerlink" title="3ï¼‰ã€å¦‚ä½•è‡ªå®šä¹‰å®šä¹‰ä¸€ä¸ªæ³¨è§£ï¼Ÿ"></a>3ï¼‰ã€å¦‚ä½•è‡ªå®šä¹‰å®šä¹‰ä¸€ä¸ªæ³¨è§£ï¼Ÿ</h3><p>ä½¿ç”¨ <code>@interface</code> + æ³¨è§£åç§°è¿™ç§è¯­æ³•ç»“æ„å°±èƒ½å®šä¹‰ä¸€ä¸ªæ³¨è§£ï¼Œå¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@interface</span> TestAnnotation&#123;<br>  <br>&#125;<br></code></pre></td></tr></table></figure><p>é€šå¸¸æˆ‘ä»¬ä¼šä½¿ç”¨ä¸€äº›å…ƒæ³¨è§£æ¥ä¿®é¥°è‡ªå®šä¹‰æ³¨è§£</p><h2 id="äºŒã€å…ƒæ³¨è§£"><a href="#äºŒã€å…ƒæ³¨è§£" class="headerlink" title="äºŒã€å…ƒæ³¨è§£"></a>äºŒã€å…ƒæ³¨è§£</h2><p>äº†è§£äº†ä¹‹å‰çš„å…ƒæ•°æ®ï¼Œ<strong>å…ƒæ³¨è§£å°±æ˜¯ä¸ºæ³¨è§£æä¾›æ³¨è§£çš„æ³¨è§£</strong> ğŸ˜‚ï¼Œè¿™å¥è¯å¯èƒ½æœ‰ç‚¹ç»•ï¼Œåæ­£ä½ æ¸…æ¥šå…ƒæ³¨è§£æ˜¯ç»™æ³¨è§£ç”¨çš„å°±è¡Œäº†</p><p>JDK ç»™æˆ‘ä»¬æä¾›çš„å…ƒæ³¨è§£æœ‰å¦‚ä¸‹å‡ ä¸ªï¼š</p><p>1ã€@Target</p><p>2ã€@Retention</p><p>3ã€@Inherited</p><p>4ã€@Documented</p><p>5ã€@Repeatable</p><h3 id="1ï¼‰ã€-Target"><a href="#1ï¼‰ã€-Target" class="headerlink" title="1ï¼‰ã€@Target"></a>1ï¼‰ã€@Target</h3><p>@Target è¡¨ç¤ºè¿™ä¸ªæ³¨è§£èƒ½æ”¾åœ¨ä»€ä¹ˆä½ç½®ä¸Šï¼Œå…·ä½“é€‰æ‹©çš„ä½ç½®åˆ—è¡¨å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java">ElementType.ANNOTATION_TYPE <span class="hljs-comment">//èƒ½ä¿®é¥°æ³¨è§£</span><br>ElementType.CONSTRUCTOR <span class="hljs-comment">//èƒ½ä¿®é¥°æ„é€ å™¨</span><br>ElementType.FIELD <span class="hljs-comment">//èƒ½ä¿®é¥°æˆå‘˜å˜é‡</span><br>ElementType.LOCAL_VARIABLE <span class="hljs-comment">//èƒ½ä¿®é¥°å±€éƒ¨å˜é‡</span><br>ElementType.METHOD <span class="hljs-comment">//èƒ½ä¿®é¥°æ–¹æ³•</span><br>ElementType.PACKAGE <span class="hljs-comment">//èƒ½ä¿®é¥°åŒ…å </span><br>ElementType.PARAMETER <span class="hljs-comment">//èƒ½ä¿®é¥°å‚æ•°</span><br>ElementType.TYPE <span class="hljs-comment">//èƒ½ä¿®é¥°ç±»ã€æ¥å£æˆ–æšä¸¾ç±»å‹</span><br>ElementType.TYPE_PARAMETER <span class="hljs-comment">//èƒ½ä¿®é¥°æ³›å‹ï¼Œå¦‚æ³›å‹æ–¹æ³•ã€æ³›å‹ç±»ã€æ³›å‹æ¥å£ ï¼ˆjdk1.8åŠ å…¥ï¼‰</span><br>ElementType.TYPE_USE <span class="hljs-comment">//èƒ½ä¿®é¥°ç±»å‹ å¯ç”¨äºä»»æ„ç±»å‹é™¤äº† class ï¼ˆjdk1.8åŠ å…¥ï¼‰</span><br>  <br><span class="hljs-meta">@Target(ElementType.TYPE)</span><br><span class="hljs-meta">@interface</span> TestAnnotation&#123;<br>    <br>&#125;<br></code></pre></td></tr></table></figure><p><strong>æ³¨æ„</strong>ï¼šé»˜è®¤æƒ…å†µä¸‹æ— é™åˆ¶</p><h3 id="2ï¼‰ã€-Retention"><a href="#2ï¼‰ã€-Retention" class="headerlink" title="2ï¼‰ã€@Retention"></a>2ï¼‰ã€@Retention</h3><p>@Retention è¡¨ç¤ºæ³¨è§£çš„çš„ç”Ÿå‘½å‘¨æœŸï¼Œå¯é€‰çš„å€¼æœ‰ 3 ä¸ªï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java">RetentionPolicy.SOURCE <span class="hljs-comment">//è¡¨ç¤ºæ³¨è§£åªåœ¨æºç ä¸­å­˜åœ¨ï¼Œç¼–è¯‘æˆ class ä¹‹åï¼Œå°±æ²¡äº†</span><br>  <br>RetentionPolicy.CLASS <span class="hljs-comment">//è¡¨ç¤ºæ³¨è§£åœ¨ java æºæ–‡ä»¶ç¼–ç¨‹æˆ .class æ–‡ä»¶åï¼Œä¾ç„¶å­˜åœ¨ï¼Œä½†æ˜¯è¿è¡Œèµ·æ¥åå°±æ²¡äº†</span><br>  <br>RetentionPolicy.RUNTIME <span class="hljs-comment">//è¡¨ç¤ºæ³¨è§£åœ¨è¿è¡Œèµ·æ¥åä¾ç„¶å­˜åœ¨ï¼Œç¨‹åºå¯ä»¥é€šè¿‡åå°„è·å–è¿™äº›ä¿¡æ¯</span><br>  <br><span class="hljs-meta">@Retention(RetentionPolicy.RUNTIME)</span><br><span class="hljs-meta">@interface</span> TestAnnotation&#123;<br><br>&#125;<br></code></pre></td></tr></table></figure><p><strong>æ³¨æ„</strong>ï¼šé»˜è®¤æƒ…å†µä¸‹ä¸º <code>RetentionPolicy.CLASS</code></p><h3 id="3ï¼‰ã€-Inherited"><a href="#3ï¼‰ã€-Inherited" class="headerlink" title="3ï¼‰ã€@Inherited"></a>3ï¼‰ã€@Inherited</h3><p>@Inherited è¡¨ç¤ºè¯¥æ³¨è§£å¯è¢«ç»§æ‰¿ï¼Œå³å½“ä¸€ä¸ªå­ç±»ç»§æ‰¿ä¸€ä¸ªçˆ¶ç±»ï¼Œè¯¥çˆ¶ç±»æ·»åŠ çš„æ³¨è§£æœ‰è¢« @Inherited ä¿®é¥°ï¼Œé‚£ä¹ˆå­ç±»å°±å¯ä»¥è·å–åˆ°è¯¥æ³¨è§£ï¼Œå¦åˆ™è·å–ä¸åˆ°</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Inherited</span><br><span class="hljs-meta">@interface</span> TestAnnotation&#123;<br><br>&#125;<br></code></pre></td></tr></table></figure><p><strong>æ³¨æ„</strong>ï¼šé»˜è®¤æƒ…å†µä¸‹ä¸ºä¸å¯ç»§æ‰¿</p><h3 id="4ï¼‰ã€-Documented"><a href="#4ï¼‰ã€-Documented" class="headerlink" title="4ï¼‰ã€@Documented"></a>4ï¼‰ã€@Documented</h3><p>@Documented  è¡¨ç¤ºè¯¥æ³¨è§£åœ¨é€šè¿‡ <code>javadoc</code> å‘½ä»¤ç”Ÿæˆ Api æ–‡æ¡£åï¼Œä¼šå‡ºç°è¯¥æ³¨è§£çš„æ³¨é‡Šè¯´æ˜</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Documented</span><br><span class="hljs-meta">@interface</span> TestAnnotation&#123;<br><br>&#125;<br></code></pre></td></tr></table></figure><p><strong>æ³¨æ„</strong>ï¼šé»˜è®¤æƒ…å†µä¸‹ä¸ºä¸å‡ºç°</p><h3 id="5ï¼‰ã€-Repeatable"><a href="#5ï¼‰ã€-Repeatable" class="headerlink" title="5ï¼‰ã€@Repeatable"></a>5ï¼‰ã€@Repeatable</h3><p>@Repeatable æ˜¯ JDK 1.8 æ–°å¢çš„å…ƒæ³¨è§£ï¼Œå®ƒè¡¨ç¤ºæ³¨è§£åœ¨åŒä¸€ä¸ªä½ç½®èƒ½å‡ºç°å¤šæ¬¡ï¼Œè¿™ä¸ªæ³¨è§£æœ‰ç‚¹æŠ½è±¡ï¼Œæˆ‘ä»¬é€šè¿‡ä¸€ä¸ªå®é™…ä¾‹å­ç†è§£ä¸€ä¸‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//æ¸¸æˆç©å®¶æ³¨è§£</span><br><span class="hljs-meta">@Inherited</span><br><span class="hljs-meta">@Documented</span><br><span class="hljs-meta">@Retention(RetentionPolicy.RUNTIME)</span><br><span class="hljs-meta">@Target(ElementType.TYPE)</span><br><span class="hljs-meta">@interface</span> GamePlayer&#123;<br>    Game[] value();<br>&#125;<br><br><span class="hljs-comment">//æ¸¸æˆæ³¨è§£</span><br><span class="hljs-meta">@Inherited</span><br><span class="hljs-meta">@Documented</span><br><span class="hljs-meta">@Retention(RetentionPolicy.RUNTIME)</span><br><span class="hljs-meta">@Target(ElementType.TYPE)</span><br><span class="hljs-meta">@Repeatable(GamePlayer.class)</span><br><span class="hljs-meta">@interface</span> Game&#123;<br>    String <span class="hljs-title function_">gameName</span><span class="hljs-params">()</span>;<br>&#125;<br><br><span class="hljs-meta">@Game(gameName = &quot;CF&quot;)</span><br><span class="hljs-meta">@Game(gameName = &quot;LOL&quot;)</span><br><span class="hljs-meta">@Game(gameName = &quot;DNF&quot;)</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">GameTest</span>&#123;<br><br>&#125;<br></code></pre></td></tr></table></figure><p><strong>æ³¨æ„</strong>ï¼šé»˜è®¤æƒ…å†µä¸‹ä¸å¯é‡å¤</p><p><strong>ç»éªŒ</strong>ï¼šé€šå¸¸æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä¼šä½¿ç”¨å¤šä¸ªå…ƒæ³¨è§£ç»„åˆæ¥ä¿®é¥°è‡ªå®šä¹‰æ³¨è§£</p><h2 id="ä¸‰ã€æ³¨è§£å±æ€§"><a href="#ä¸‰ã€æ³¨è§£å±æ€§" class="headerlink" title="ä¸‰ã€æ³¨è§£å±æ€§"></a>ä¸‰ã€æ³¨è§£å±æ€§</h2><h3 id="1ï¼‰ã€æ³¨è§£å±æ€§ç±»å‹"><a href="#1ï¼‰ã€æ³¨è§£å±æ€§ç±»å‹" class="headerlink" title="1ï¼‰ã€æ³¨è§£å±æ€§ç±»å‹"></a>1ï¼‰ã€æ³¨è§£å±æ€§ç±»å‹</h3><p>æ³¨è§£å±æ€§ç±»å‹å¯ä»¥ä¸ºä»¥ä¸‹çš„ä¸€äº›ç±»å‹ï¼š</p><p>1ã€åŸºæœ¬æ•°æ®ç±»å‹</p><p>2ã€String</p><p>3ã€æšä¸¾ç±»å‹</p><p>4ã€æ³¨è§£ç±»å‹</p><p>5ã€Class ç±»å‹</p><p>6ã€ä»¥ä¸Šç±»å‹çš„ä¸€ç»´æ•°ç»„ç±»å‹</p><h3 id="2ï¼‰ã€å®šä¹‰æ³¨è§£å±æ€§"><a href="#2ï¼‰ã€å®šä¹‰æ³¨è§£å±æ€§" class="headerlink" title="2ï¼‰ã€å®šä¹‰æ³¨è§£å±æ€§"></a>2ï¼‰ã€å®šä¹‰æ³¨è§£å±æ€§</h3><p>é¦–å…ˆæˆ‘ä»¬å®šä¹‰ä¸€äº›æ³¨è§£å±æ€§ï¼Œå¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Inherited</span><br><span class="hljs-meta">@Documented</span><br><span class="hljs-meta">@Retention(RetentionPolicy.RUNTIME)</span><br><span class="hljs-meta">@Target(ElementType.TYPE)</span><br><span class="hljs-meta">@interface</span> TestAnnotation&#123;<br>    <span class="hljs-comment">//è¿™å°±æ˜¯æ³¨è§£å±æ€§çš„è¯­æ³•ç»“æ„</span><br>    <span class="hljs-comment">//å®šä¹‰ä¸€ä¸ªå±æ€§å¹¶ç»™äº†é»˜è®¤å€¼</span><br>    String <span class="hljs-title function_">name</span><span class="hljs-params">()</span> <span class="hljs-keyword">default</span> <span class="hljs-string">&quot;erdai&quot;</span>;<br>  <br>    <span class="hljs-comment">//å®šä¹‰ä¸€ä¸ªå±æ€§æœªç»™é»˜è®¤å€¼</span><br>    <span class="hljs-type">int</span> <span class="hljs-title function_">age</span><span class="hljs-params">()</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>å¯èƒ½ä½ ä¼šæœ‰äº›ç–‘é—®ï¼šè¿™éš¾é“ä¸æ˜¯åœ¨å®šä¹‰æ–¹æ³•å—ï¼Ÿè¿˜å¯ä»¥ç»™é»˜è®¤å€¼ï¼Ÿ</p><p>è¿™äº›ç–‘é—®å…ˆç•™ç€ï¼Œæˆ‘ä»¬ç»§ç»­åˆ†æ</p><p>è‡ªå®šä¹‰æ³¨è§£é»˜è®¤éƒ½ä¼šç»§æ‰¿ Annotation ï¼ŒAnnotation æ˜¯ä¸€ä¸ªæ¥å£ï¼Œæºç å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">Annotation</span> &#123;<br>   <br>    <span class="hljs-type">boolean</span> <span class="hljs-title function_">equals</span><span class="hljs-params">(Object obj)</span>;<br><br>    <span class="hljs-type">int</span> <span class="hljs-title function_">hashCode</span><span class="hljs-params">()</span>;<br>  <br>    String <span class="hljs-title function_">toString</span><span class="hljs-params">()</span>;<br>    <br>    Class&lt;? <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Annotation</span>&gt; annotationType();<br>&#125;<br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬çŸ¥é“ï¼Œåœ¨æ¥å£ä¸­å¯ä»¥å®šä¹‰å±æ€§å’Œæ–¹æ³•ï¼Œé‚£ä¹ˆä½œä¸ºè‡ªå®šä¹‰æ³¨è§£ï¼Œæ˜¯å¦ä¹Ÿå¯ä»¥å®šä¹‰å‘¢ï¼Ÿ</p><p>å¯ä»¥ï¼Œæ¥å£ä¸­çš„å±æ€§é»˜è®¤éƒ½æ˜¯ç”¨<code>public static final</code> ä¿®é¥°çš„ï¼Œé»˜è®¤æ˜¯ä¸€ä¸ªå¸¸é‡ï¼Œå¯¹äºè‡ªå®šä¹‰æ³¨è§£æ¥è¯´ï¼Œè¿™ç‚¹æ²¡æœ‰ä»»ä½•åŒºåˆ«ã€‚è€Œæ¥å£ä¸­çš„æ–¹æ³•å…¶å®å°±ç›¸å½“äºè‡ªå®šä¹‰æ³¨è§£çš„å±æ€§ï¼Œåªä¸è¿‡è‡ªå®šä¹‰æ³¨è§£è¿˜å¯ä»¥ç»™é»˜è®¤å€¼ã€‚å› æ­¤æˆ‘ä»¬åœ¨å­¦ä¹ è‡ªå®šä¹‰æ³¨è§£å±æ€§æ—¶ï¼Œæˆ‘ä»¬åº”è¯¥æŠŠå®ƒå½“ä½œä¸€ä¸ªæ–°çŸ¥è¯†ï¼ŒåŠ ä¸Šæˆ‘åˆšæ‰å¯¹æ¥å£çš„åˆ†æå¯¹æ¯”ï¼Œä½ ä¸Šé¢çš„é‚£äº›ç–‘é—®ä¾¿å¯ä»¥è¿åˆƒè€Œè§£äº†</p><h3 id="3ï¼‰ã€æ³¨è§£å±æ€§ä½¿ç”¨"><a href="#3ï¼‰ã€æ³¨è§£å±æ€§ä½¿ç”¨" class="headerlink" title="3ï¼‰ã€æ³¨è§£å±æ€§ä½¿ç”¨"></a>3ï¼‰ã€æ³¨è§£å±æ€§ä½¿ç”¨</h3><p>1ã€åœ¨ä½¿ç”¨æ³¨è§£çš„åé¢æ¥ä¸Šä¸€å¯¹æ‹¬å·ï¼Œæ‹¬å·é‡Œé¢ä½¿ç”¨ <code>å±æ€§å = value</code> çš„æ ¼å¼ï¼Œå¤šä¸ªå±æ€§ä¹‹é—´ä¸­é—´ç”¨ <code>,</code>éš”å¼€</p><p>2ã€æœªç»™é»˜è®¤å€¼çš„å±æ€§å¿…é¡»è¿›è¡Œèµ‹å€¼ï¼Œå¦åˆ™ç¼–è¯‘å™¨ä¼šæŠ¥çº¢</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//å•ä¸ªå±æ€§</span><br><span class="hljs-meta">@TestAnnotation(age = 18)</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Test</span>&#123;<br>    <br>&#125;<br><br><span class="hljs-comment">//å¤šä¸ªå±æ€§</span><br><span class="hljs-meta">@TestAnnotation(age = 18,name = &quot;erdai666&quot;)</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Test</span>&#123;<br><br>&#125;<br></code></pre></td></tr></table></figure><h3 id="4ï¼‰ã€æ³¨è§£å±æ€§è·å–"><a href="#4ï¼‰ã€æ³¨è§£å±æ€§è·å–" class="headerlink" title="4ï¼‰ã€æ³¨è§£å±æ€§è·å–"></a>4ï¼‰ã€æ³¨è§£å±æ€§è·å–</h3><p>æ³¨è§£å±æ€§çš„è·å–å¯ä»¥å‚è€ƒæˆ‘çš„ä¸Šä¸€ç¯‡æ–‡ç«  <a href="https://juejin.cn/post/6977679823132950536">ä¼ é€é—¨</a> ï¼Œä¸Šç¯‡æ–‡ç« æˆ‘ä»¬è®²çš„æ˜¯é€šè¿‡ç±»å¯¹è±¡è·å–æ³¨è§£ï¼Œå’±ä»¬è¡¥å……ç‚¹ä¸Šç¯‡æ–‡ç« æ²¡è®²åˆ°çš„</p><p>1ã€æˆ‘ä»¬åœ¨è·å–å±æ€§çš„æ—¶å€™ï¼Œå¯ä»¥å…ˆåˆ¤æ–­ä¸€ä¸‹æ˜¯å¦å­˜åœ¨è¯¥æ³¨è§£ï¼Œå¢å¼ºä»£ç çš„å¥å£®æ€§ï¼Œå¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@TestAnnotation(age = 18,name = &quot;erdai666&quot;)</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Test</span>&#123;<br><br>&#125;<br><br>Class&lt;Test&gt; testClass = Test.class;<br><span class="hljs-comment">//è·å–å½“å‰æ³¨è§£æ˜¯å¦å­˜åœ¨</span><br><span class="hljs-type">boolean</span> <span class="hljs-variable">annotationPresent</span> <span class="hljs-operator">=</span> testClass.isAnnotationPresent(TestAnnotation.class);<br><span class="hljs-comment">//å¦‚æœå­˜åœ¨åˆ™è¿›å…¥æ¡ä»¶ä½“</span><br><span class="hljs-keyword">if</span>(annotationPresent)&#123;<br>    <span class="hljs-type">TestAnnotation</span> <span class="hljs-variable">declaredAnnotation</span> <span class="hljs-operator">=</span> testClass.getDeclaredAnnotation(TestAnnotation.class);<br>    System.out.println(declaredAnnotation.name());<br>    System.out.println(declaredAnnotation.age());<br>&#125;<br></code></pre></td></tr></table></figure><p>2ã€è·å–ç±»å±æ€§çš„æ³¨è§£å±æ€§</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Inherited</span><br><span class="hljs-meta">@Documented</span><br><span class="hljs-meta">@Retention(RetentionPolicy.RUNTIME)</span><br><span class="hljs-meta">@Target(ElementType.FIELD)</span><br><span class="hljs-meta">@interface</span> TestField&#123;<br>    String <span class="hljs-title function_">filed</span><span class="hljs-params">()</span>;<br>&#125;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Test</span>&#123;<br>    <span class="hljs-meta">@TestField(filed = &quot;æˆ‘æ˜¯å±æ€§&quot;)</span><br>    <span class="hljs-keyword">public</span> String test;<br>&#125;<br><br><span class="hljs-comment">//é€šè¿‡åå°„è·å–å±æ€§æ³¨è§£</span><br>Class&lt;Test&gt; testClass1 = Test.class;<br><span class="hljs-keyword">try</span> &#123;<br>    <span class="hljs-type">Field</span> <span class="hljs-variable">field</span> <span class="hljs-operator">=</span> testClass1.getDeclaredField(<span class="hljs-string">&quot;test&quot;</span>);<br>    <span class="hljs-keyword">if</span>(field.isAnnotationPresent(TestField.class))&#123;<br>        <span class="hljs-type">TestField</span> <span class="hljs-variable">fieldAnnotation</span> <span class="hljs-operator">=</span> field.getDeclaredAnnotation(TestField.class);<br>        System.out.println(fieldAnnotation.filed());<br>    &#125;<br>&#125; <span class="hljs-keyword">catch</span> (NoSuchFieldException e) &#123;<br>    e.printStackTrace();<br>&#125;<br><span class="hljs-comment">//æ‰“å°ç»“æœ</span><br>æˆ‘æ˜¯å±æ€§<br></code></pre></td></tr></table></figure><p>3ã€è·å–ç±»æ–¹æ³•çš„æ³¨è§£å±æ€§</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Inherited</span><br><span class="hljs-meta">@Documented</span><br><span class="hljs-meta">@Retention(RetentionPolicy.RUNTIME)</span><br><span class="hljs-meta">@Target(ElementType.METHOD)</span><br><span class="hljs-meta">@interface</span> TestMethod&#123;<br>    String <span class="hljs-title function_">method</span><span class="hljs-params">()</span>;<br>&#125;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Test</span>&#123;<br>    <span class="hljs-meta">@TestMethod(method = &quot;æˆ‘æ˜¯æ–¹æ³•&quot;)</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">test</span><span class="hljs-params">()</span>&#123;<br><br>    &#125;<br>&#125;<br><span class="hljs-comment">//é€šè¿‡åå°„è·å–æ–¹æ³•æ³¨è§£</span><br>Class&lt;Test&gt; testClass2 = Test.class;<br><span class="hljs-keyword">try</span> &#123;<br>    <span class="hljs-type">Method</span> <span class="hljs-variable">method</span> <span class="hljs-operator">=</span> testClass2.getDeclaredMethod(<span class="hljs-string">&quot;test&quot;</span>);<br>    <span class="hljs-keyword">if</span>(method.isAnnotationPresent(TestMethod.class))&#123;<br>        <span class="hljs-type">TestMethod</span> <span class="hljs-variable">methodAnnotation</span> <span class="hljs-operator">=</span> method.getDeclaredAnnotation(TestMethod.class);<br>        System.out.println(methodAnnotation.method());<br>    &#125;<br>&#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>    e.printStackTrace();<br>&#125;<br><span class="hljs-comment">//æ‰“å°ç»“æœ</span><br>æˆ‘æ˜¯æ–¹æ³•<br></code></pre></td></tr></table></figure><h2 id="å››ã€JDK-æä¾›çš„å†…ç½®æ³¨è§£"><a href="#å››ã€JDK-æä¾›çš„å†…ç½®æ³¨è§£" class="headerlink" title="å››ã€JDK æä¾›çš„å†…ç½®æ³¨è§£"></a>å››ã€JDK æä¾›çš„å†…ç½®æ³¨è§£</h2><p>JDK ç»™æˆ‘ä»¬æä¾›äº†å¾ˆå¤šå†…ç½®çš„æ³¨è§£ï¼Œå…¶ä¸­å¸¸ç”¨çš„æœ‰ï¼š</p><p>)1ã€@Override</p><p>2ã€@Deprecated</p><p>3ã€@SuppressWarnings</p><p>4ã€@FunctionalInterface</p><h3 id="1ï¼‰ã€-Override"><a href="#1ï¼‰ã€-Override" class="headerlink" title="1ï¼‰ã€@Override"></a>1ï¼‰ã€@Override</h3><p>@Override ç”¨åœ¨æ–¹æ³•ä¸Šï¼Œè¡¨ç¤ºè¿™ä¸ªæ–¹æ³•é‡å†™äº†çˆ¶ç±»çš„æ–¹æ³•ï¼Œä¾‹å¦‚ <code>toString</code> æ–¹æ³• </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">public</span> String <span class="hljs-title function_">toString</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">super</span>.toString();<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="2ï¼‰ã€-Deprecated"><a href="#2ï¼‰ã€-Deprecated" class="headerlink" title="2ï¼‰ã€@Deprecated"></a>2ï¼‰ã€@Deprecated</h3><p>@Deprecated è¡¨ç¤ºè¿™ä¸ªæ–¹æ³•è¢«å¼ƒç”¨ï¼Œä¸å»ºè®®å¼€å‘è€…ä½¿ç”¨</p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/33397c95cde24591afca8a257d3901cd~tplv-k3u1fbpfcp-zoom-1.image" alt="image-20210626113644915" style="zoom:50%;" /><p>å¯ä»¥çœ‹åˆ°ç”¨ @Deprecated æ³¨è§£çš„æ–¹æ³•è°ƒç”¨çš„æ—¶å€™ä¼šè¢«åˆ’æ‰</p><h3 id="3ï¼‰ã€-SuppressWarnings"><a href="#3ï¼‰ã€-SuppressWarnings" class="headerlink" title="3ï¼‰ã€@SuppressWarnings"></a>3ï¼‰ã€@SuppressWarnings</h3><p>@SuppressWarnings ç”¨äºå¿½ç•¥è­¦å‘Šä¿¡æ¯ï¼Œå¸¸è§çš„å–å€¼å¦‚ä¸‹ï¼š</p><ul><li>deprecationï¼šä½¿ç”¨äº†ä¸èµæˆä½¿ç”¨çš„ç±»æˆ–æ–¹æ³•æ—¶çš„è­¦å‘Šï¼ˆä½¿ç”¨ @Deprecated ä½¿å¾—ç¼–è¯‘å™¨äº§ç”Ÿçš„è­¦å‘Šï¼‰</li><li>uncheckedï¼šæ‰§è¡Œäº†æœªæ£€æŸ¥çš„è½¬æ¢æ—¶çš„è­¦å‘Šï¼Œä¾‹å¦‚å½“ä½¿ç”¨é›†åˆæ—¶æ²¡æœ‰ç”¨æ³›å‹ (Generics) æ¥æŒ‡å®šé›†åˆä¿å­˜çš„ç±»å‹; å…³é—­ç¼–è¯‘å™¨è­¦å‘Š</li><li>fallthroughï¼šå½“ Switch ç¨‹åºå—ç›´æ¥é€šå¾€ä¸‹ä¸€ç§æƒ…å†µè€Œæ²¡æœ‰ Break æ—¶çš„è­¦å‘Š</li><li>pathï¼šåœ¨ç±»è·¯å¾„ã€æºæ–‡ä»¶è·¯å¾„ç­‰ä¸­æœ‰ä¸å­˜åœ¨çš„è·¯å¾„æ—¶çš„è­¦å‘Š</li><li>serialï¼šå½“åœ¨å¯åºåˆ—åŒ–çš„ç±»ä¸Šç¼ºå°‘ serialVersionUID å®šä¹‰æ—¶çš„è­¦å‘Š</li><li>finallyï¼šä»»ä½• finally å­å¥ä¸èƒ½æ­£å¸¸å®Œæˆæ—¶çš„è­¦å‘Š</li><li>rawtypes æ³›å‹ç±»å‹æœªæŒ‡æ˜</li><li>unused å¼•ç”¨å®šä¹‰äº†ï¼Œä½†æ˜¯æ²¡æœ‰è¢«ä½¿ç”¨</li><li>allï¼šå…³äºä»¥ä¸Šæ‰€æœ‰æƒ…å†µçš„è­¦å‘Š</li></ul><p>ä»¥æ³›å‹ä¸¾ä¸ªä¾‹å­ï¼š</p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/33a67f867a124bc184d4625d8a236b03~tplv-k3u1fbpfcp-zoom-1.image" alt="image-20210626114048630" style="zoom:50%;" /><p>å½“æˆ‘ä»¬åˆ›å»º List æœªæŒ‡å®šæ³›å‹æ—¶ï¼Œç¼–è¯‘å™¨å°±ä¼šæŠ¥é»„æç¤ºæˆ‘ä»¬æœªæŒ‡æ˜æ³›å‹ï¼Œè¿™ä¸ªæ—¶å€™å°±å¯ä»¥ä½¿ç”¨è¿™ä¸ªæ³¨è§£äº†ï¼š</p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/3e5e7263b5a84905b6da544fde609e2d~tplv-k3u1fbpfcp-zoom-1.image" alt="image-20210626114241155" style="zoom:50%;" /><h3 id="4ï¼‰ã€-FunctionalInterface"><a href="#4ï¼‰ã€-FunctionalInterface" class="headerlink" title="4ï¼‰ã€@FunctionalInterface"></a>4ï¼‰ã€@FunctionalInterface</h3><p>@FunctionalInterface æ˜¯ JDK 1.8 æ–°å¢çš„æ³¨è§£ï¼Œç”¨äºçº¦å®šå‡½æ•°å¼æ¥å£ï¼Œ<strong>å‡½æ•°å¼æ¥å£å°±æ˜¯æ¥å£ä¸­åªæœ‰ä¸€ä¸ªæŠ½è±¡æ–¹æ³•</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@FunctionalInterface</span><br><span class="hljs-keyword">interface</span> <span class="hljs-title class_">testInterface</span>&#123;<br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">testMethod</span><span class="hljs-params">()</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>è€Œå½“ä½ æœ‰ä¸¤ä¸ªæŠ½è±¡æ–¹æ³•æ—¶ï¼Œæ³¨è§£ä¼šæŠ¥çº¢æç¤ºä½ ï¼š</p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/a0ab4a93e5dc4080a0bb5f6b52672cca~tplv-k3u1fbpfcp-zoom-1.image" alt="image-20210626114855416" style="zoom:50%;" /><h2 id="äº”ã€æ³¨è§£å®é™…åº”ç”¨åœºæ™¯"><a href="#äº”ã€æ³¨è§£å®é™…åº”ç”¨åœºæ™¯" class="headerlink" title="äº”ã€æ³¨è§£å®é™…åº”ç”¨åœºæ™¯"></a>äº”ã€æ³¨è§£å®é™…åº”ç”¨åœºæ™¯</h2><h3 id="1ï¼‰ã€ä½¿ç”¨è‡ªå®šä¹‰æ³¨è§£ä»£æ›¿æšä¸¾ç±»å‹"><a href="#1ï¼‰ã€ä½¿ç”¨è‡ªå®šä¹‰æ³¨è§£ä»£æ›¿æšä¸¾ç±»å‹" class="headerlink" title="1ï¼‰ã€ä½¿ç”¨è‡ªå®šä¹‰æ³¨è§£ä»£æ›¿æšä¸¾ç±»å‹"></a>1ï¼‰ã€ä½¿ç”¨è‡ªå®šä¹‰æ³¨è§£ä»£æ›¿æšä¸¾ç±»å‹</h3><p>ä¸»è¦é’ˆå¯¹æºç é˜¶æ®µæ³¨è§£</p><p>è¿™ä¸ªåœ¨æˆ‘ä»¬å®é™…å·¥ä½œä¸­ä¹ŸæŒºå¸¸ç”¨çš„ï¼Œä½¿ç”¨æšä¸¾ç±»å‹å¼€é”€å¤§ï¼Œæˆ‘ä»¬ä¸€èˆ¬éƒ½ä¼šä½¿ç”¨è‡ªå®šä¹‰æ³¨è§£è¿›è¡Œæ›¿ä»£ï¼Œå¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//1ã€ä½¿ç”¨æšä¸¾</span><br><span class="hljs-keyword">enum</span> <span class="hljs-title class_">EnumFontType</span>&#123;<br>    ROBOTO_REGULAR,ROBOTO_MEDIUM,ROBOTO_BOLD<br>&#125;<br><span class="hljs-comment">//å®é™…è°ƒç”¨</span><br><span class="hljs-type">EnumFontType</span> <span class="hljs-variable">type1</span> <span class="hljs-operator">=</span> EnumFontType.ROBOTO_BOLD;<br><br><span class="hljs-comment">//================================ å®Œç¾çš„åˆ†å‰²çº¿ ==================================</span><br><span class="hljs-comment">//2ã€ä½¿ç”¨è‡ªå®šä¹‰æ³¨è§£</span><br><span class="hljs-meta">@Target(&#123;ElementType.FIELD, ElementType.PARAMETER, ElementType.LOCAL_VARIABLE&#125;)</span><br><span class="hljs-meta">@Retention(RetentionPolicy.SOURCE)</span><br><span class="hljs-meta">@IntDef(&#123;AnnotationFontType.ROBOTO_REGULAR,AnnotationFontType.ROBOTO_MEDIUM,AnnotationFontType.ROBOTO_BOLD&#125;)</span><br><span class="hljs-meta">@interface</span> AnnotationFontType&#123;<br>    <span class="hljs-type">int</span> <span class="hljs-variable">ROBOTO_REGULAR</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;<br>    <span class="hljs-type">int</span> <span class="hljs-variable">ROBOTO_MEDIUM</span> <span class="hljs-operator">=</span> <span class="hljs-number">2</span>;<br>    <span class="hljs-type">int</span> <span class="hljs-variable">ROBOTO_BOLD</span> <span class="hljs-operator">=</span> <span class="hljs-number">3</span>;<br>&#125;<br><span class="hljs-comment">//å®é™…è°ƒç”¨</span><br><span class="hljs-meta">@AnnotationFontType</span> <span class="hljs-type">int</span> <span class="hljs-variable">type2</span> <span class="hljs-operator">=</span> AnnotationFontType.ROBOTO_MEDIUM;<br></code></pre></td></tr></table></figure><h3 id="2ï¼‰ã€æ³¨è§£å¤„ç†å™¨-APT"><a href="#2ï¼‰ã€æ³¨è§£å¤„ç†å™¨-APT" class="headerlink" title="2ï¼‰ã€æ³¨è§£å¤„ç†å™¨ (APT)"></a>2ï¼‰ã€æ³¨è§£å¤„ç†å™¨ (APT)</h3><p>ä¸»è¦é’ˆå¯¹ç¼–è¯‘é˜¶æ®µæ³¨è§£</p><p>å®é™…æˆ‘ä»¬æ—¥å¸¸å¼€å‘ä¸­ï¼Œç»å¸¸ä¼šé‡åˆ°å®ƒï¼Œå› ä¸ºæˆ‘ä»¬å¸¸ç”¨çš„ä¸€äº›å¼€æºåº“å¦‚ ButterKnifeï¼ŒRetrofitï¼ŒArouterï¼ŒEventBus ç­‰ç­‰éƒ½ä½¿ç”¨åˆ°äº† APT æŠ€æœ¯ã€‚ä¹Ÿæ­£æ˜¯å› ä¸ºè¿™äº›è‘—åçš„å¼€æºåº“ï¼Œæ‰ä½¿å¾— APT æŠ€æœ¯è¶Šæ¥è¶Šç«ï¼Œåœ¨æœ¬ç³»åˆ—çš„ä¸‹ä¸€ç¯‡ä¸­ï¼Œæˆ‘ä¹Ÿä¼šè®²åˆ°ã€‚</p><h3 id="3ï¼‰ã€è¿è¡Œæ—¶æ³¨è§£å¤„ç†"><a href="#3ï¼‰ã€è¿è¡Œæ—¶æ³¨è§£å¤„ç†" class="headerlink" title="3ï¼‰ã€è¿è¡Œæ—¶æ³¨è§£å¤„ç†"></a>3ï¼‰ã€è¿è¡Œæ—¶æ³¨è§£å¤„ç†</h3><p>ä¸»è¦é’ˆå¯¹è¿è¡Œé˜¶æ®µæ³¨è§£</p><p>ä¸¾ä¸ªå®é™…çš„ä¾‹å­ï¼šä¾‹å¦‚æˆ‘ä»¬å¼€è½¦å»è‡ªåŠ©åŠ æ²¹æœºåŠ æ²¹ï¼Œè®¾å®šçš„ Money æ˜¯ 200ï¼Œå¦‚æœå°‘äº 200 åˆ™æç¤º <code>åŠ æ²¹ä¸­...</code>ï¼Œå¦åˆ™æç¤º <code>æ²¹å·²åŠ æ»¡</code>ï¼Œå¦‚æœå‡ºç°å¼‚å¸¸æƒ…å†µï¼Œæç¤º <code>åŠ æ²¹å¤±è´¥</code></p><p>ç°åœ¨æˆ‘ä»¬é€šè¿‡æ³¨è§£æ¥å®ç°ä¸€ä¸‹å®ƒï¼Œå¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Inherited</span><br><span class="hljs-meta">@Documented</span><br><span class="hljs-meta">@Retention(RetentionPolicy.RUNTIME)</span><br><span class="hljs-meta">@Target(ElementType.METHOD)</span><br><span class="hljs-meta">@interface</span> OilAnnotation&#123;<br>    <span class="hljs-type">double</span> <span class="hljs-title function_">maxOilMoney</span><span class="hljs-params">()</span> <span class="hljs-keyword">default</span> <span class="hljs-number">0</span>;<br>&#125;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">GasStation</span>&#123;<br><br>    <span class="hljs-meta">@OilAnnotation(maxOilMoney = 200)</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">addOil</span><span class="hljs-params">(<span class="hljs-type">double</span> money)</span>&#123;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">tips</span> <span class="hljs-operator">=</span> processOilAnnotation(money);<br>        System.out.println(tips);<br>    &#125;<br><br>    <span class="hljs-meta">@SuppressWarnings(&quot;all&quot;)</span><br>    <span class="hljs-keyword">private</span> String <span class="hljs-title function_">processOilAnnotation</span><span class="hljs-params">(<span class="hljs-type">double</span> money)</span>&#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            Class&lt;GasStation&gt; aClass = GasStation.class;<br>            <span class="hljs-comment">//è·å–å½“å‰æ–¹æ³•çš„æ³¨è§£</span><br>            <span class="hljs-type">Method</span> <span class="hljs-variable">addOilMethod</span> <span class="hljs-operator">=</span> aClass.getDeclaredMethod(<span class="hljs-string">&quot;addOil&quot;</span>, <span class="hljs-type">double</span>.class);<br>            <span class="hljs-comment">//è·å–æ–¹æ³•æ³¨è§£æ˜¯å¦å­˜åœ¨</span><br>            <span class="hljs-type">boolean</span> <span class="hljs-variable">annotationPresent</span> <span class="hljs-operator">=</span> addOilMethod.isAnnotationPresent(OilAnnotation.class);<br>            <span class="hljs-keyword">if</span>(annotationPresent)&#123;<br>                <span class="hljs-type">OilAnnotation</span> <span class="hljs-variable">oilAnnotation</span> <span class="hljs-operator">=</span> addOilMethod.getDeclaredAnnotation(OilAnnotation.class);<br>                <span class="hljs-keyword">if</span>(money &gt;= oilAnnotation.maxOilMoney())&#123;<br>                    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;æ²¹å·²åŠ æ»¡&quot;</span>;<br>                &#125;<span class="hljs-keyword">else</span> &#123;<br>                    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;åŠ æ²¹ä¸­...&quot;</span>;<br>                &#125;<br>            &#125;<br>        &#125; <span class="hljs-keyword">catch</span> (NoSuchMethodException e) &#123;<br>            e.printStackTrace();<br>        &#125;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;åŠ æ²¹å¤±è´¥&quot;</span>;<br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">new</span> <span class="hljs-title class_">GasStation</span>().addOil(<span class="hljs-number">100</span>);<br><span class="hljs-comment">//æ‰“å°ç»“æœ</span><br>åŠ æ²¹ä¸­...<br>  <br><span class="hljs-keyword">new</span> <span class="hljs-title class_">GasStation</span>().addOil(<span class="hljs-number">200</span>);<br><span class="hljs-comment">//æ‰“å°ç»“æœ</span><br>æ²¹å·²åŠ æ»¡<br></code></pre></td></tr></table></figure><h2 id="å…­ã€æ€»ç»“"><a href="#å…­ã€æ€»ç»“" class="headerlink" title="å…­ã€æ€»ç»“"></a>å…­ã€æ€»ç»“</h2><p>æœ¬ç¯‡æ–‡ç« è®²çš„ä¸€äº›é‡ç‚¹å†…å®¹ï¼š</p><p>1ã€è‡ªå®šä¹‰æ³¨è§£æ—¶ï¼Œå…ƒæ³¨è§£çš„ç»„åˆä½¿ç”¨</p><p>2ã€æ³¨è§£å±æ€§çš„å®šä¹‰ï¼Œä½¿ç”¨å’Œè·å–</p><p>3ã€ä¸€äº›å¸¸ç”¨çš„ JDK å†…ç½®æ³¨è§£</p><p>4ã€æ³¨è§£çš„å®é™…åº”ç”¨åŠè¿è¡Œé˜¶æ®µæ³¨è§£çš„ä¸€ä¸ªå®è·µ</p><p>å¥½äº†ï¼Œæœ¬ç¯‡æ–‡ç« åˆ°è¿™é‡Œå°±ç»“æŸäº†ï¼Œå¸Œæœ›èƒ½ç»™ä½ å¸¦æ¥å¸®åŠ© ğŸ¤ </p><p><strong>æ„Ÿè°¢ä½ é˜…è¯»è¿™ç¯‡æ–‡ç« </strong></p><h3 id="ä¸‹ç¯‡é¢„å‘Š"><a href="#ä¸‹ç¯‡é¢„å‘Š" class="headerlink" title="ä¸‹ç¯‡é¢„å‘Š"></a>ä¸‹ç¯‡é¢„å‘Š</h3><p>ä¸‹ç¯‡æ–‡ç« æˆ‘ä»¬å°±æ­£å¼å¼€å§‹ APT æŠ€æœ¯çš„è®²è§£äº†ï¼Œæ•¬è¯·æœŸå¾…å§ğŸ˜„</p><h3 id="å‚è€ƒå’Œæ¨è"><a href="#å‚è€ƒå’Œæ¨è" class="headerlink" title="å‚è€ƒå’Œæ¨è"></a>å‚è€ƒå’Œæ¨è</h3><p><a href="https://juejin.cn/post/6844903833299058702">Java æ³¨è§£å®Œå…¨è§£æ</a></p><p><a href="https://www.jianshu.com/p/5871e1186840">ã€ŒJava è·¯çº¿ã€| æ³¨è§£ï¼ˆå« Kotlinï¼‰</a></p><blockquote><p><strong>ä½ çš„ç‚¹èµï¼Œè¯„è®ºï¼Œæ˜¯å¯¹æˆ‘å·¨å¤§çš„é¼“åŠ±ï¼</strong></p><p>æ¬¢è¿å…³æ³¨æˆ‘çš„<strong>å…¬ä¼—å·ï¼š</strong>  <a href="http://m6z.cn/6jwi7b"><strong>sweetying</strong></a> ï¼Œæ–‡ç« æ›´æ–°å¯ç¬¬ä¸€æ—¶é—´æ”¶åˆ°</p><p>å¦‚æœ<strong>æœ‰é—®é¢˜</strong>ï¼Œå…¬ä¼—å·å†…æœ‰åŠ æˆ‘å¾®ä¿¡çš„å…¥å£ï¼Œåœ¨æŠ€æœ¯å­¦ä¹ ã€ä¸ªäººæˆé•¿çš„é“è·¯ä¸Šï¼Œæˆ‘ä»¬ä¸€èµ·å‰è¿›ï¼</p></blockquote>]]></content>
    
    
    <categories>
      
      <category>Android</category>
      
      <category>APT</category>
      
    </categories>
    
    
    <tags>
      
      <tag>åŸåˆ›</tag>
      
      <tag>Android</tag>
      
      <tag>Android APT</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Android APT ç³»åˆ— ï¼ˆä¸€ï¼‰ï¼šAPT ç­‘åŸºä¹‹åå°„</title>
    <link href="/2022/10/10/Android%20APT%20%E7%B3%BB%E5%88%97%20%EF%BC%88%E4%B8%80%EF%BC%89%EF%BC%9AAPT%20%E7%AD%91%E5%9F%BA%E4%B9%8B%E5%8F%8D%E5%B0%84/"/>
    <url>/2022/10/10/Android%20APT%20%E7%B3%BB%E5%88%97%20%EF%BC%88%E4%B8%80%EF%BC%89%EF%BC%9AAPT%20%E7%AD%91%E5%9F%BA%E4%B9%8B%E5%8F%8D%E5%B0%84/</url>
    
    <content type="html"><![CDATA[<p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/2efcab2ef7b4420e950e01c716a6d82f~tplv-k3u1fbpfcp-watermark.image"></p><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>å¾ˆé«˜å…´é‡è§ä½ ~</p><p>è¿™åˆæ˜¯ä¸€ä¸ªæ–°çš„ç³»åˆ—ï¼Œçµæ„Ÿæ¥æºäºæœ€è¿‘åšçš„ä¸€æ¬¡å¸ƒå±€ä¼˜åŒ–ï¼Œæˆ‘ä»¬çŸ¥é“ï¼šAndroid ä¸­å°‘é‡çš„ç³»ç»Ÿæ§ä»¶æ˜¯é€šè¿‡ <code>new</code> çš„æ–¹å¼åˆ›å»ºå‡ºæ¥çš„ï¼Œè€Œå¤§éƒ¨åˆ†æ§ä»¶å¦‚ <code>androidx.appcompat.widget</code> ä¸‹çš„æ§ä»¶ï¼Œè‡ªå®šä¹‰æ§ä»¶ï¼Œç¬¬ä¸‰æ–¹æ§ä»¶ç­‰ç­‰ï¼Œéƒ½æ˜¯é€šè¿‡åå°„åˆ›å»ºçš„ã€‚å¤§é‡çš„åå°„åˆ›å»ºå¤šå¤šå°‘å°‘ä¼šå¸¦æ¥ä¸€äº›æ€§èƒ½é—®é¢˜ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦å»è§£å†³åå°„åˆ›å»ºçš„é—®é¢˜ï¼Œæˆ‘çš„è§£å†³æ€è·¯æ˜¯ï¼š</p><blockquote><p>1ã€é€šè¿‡ç¼–å†™ Android æ’ä»¶è·å– Xml å¸ƒå±€ä¸­çš„æ‰€æœ‰æ§ä»¶ </p><p>2ã€æ‹¿åˆ°æ§ä»¶åï¼Œé€šè¿‡ APT ç”Ÿæˆç”¨ <code>new</code> çš„æ–¹å¼åˆ›å»º View çš„ç±» </p><p>3ã€æœ€åé€šè¿‡åå°„è·å–å½“å‰ç±»å¹¶åœ¨åŸºç±»é‡Œé¢å®Œæˆæ›¿æ¢</p></blockquote><p>ä¸€ä¸ªå°å°çš„å¸ƒå±€ä¼˜åŒ–ï¼Œæ¶‰åŠçš„ä¸œè¥¿è¿˜æŒºå¤šçš„ï¼ŒAndroid æ’ä»¶æˆ‘ä»¬åç»­åœ¨è®²ï¼Œè¯è¯´ Gradle ç³»åˆ—ç›®å‰åªæ›´äº†ä¸€ç¯‡ğŸ˜‚ï¼Œåˆ«æ€¥ï¼Œåé¢éƒ½ä¼šæœ‰çš„ã€‚æˆ‘ä»¬è¿™ä¸ªç³»åˆ—ä¸»è¦æ˜¯è®² APTï¼Œè€Œè®² APT ï¼Œæˆ‘ä»¬å¿…é¡»å…ˆäº†è§£ä¸¤ä¸ªé‡ç‚¹çŸ¥è¯†ï¼š<strong>æ³¨è§£å’Œåå°„</strong></p><p>ä»Šå¤©å°±é‡ç‚¹æ¥ä»‹ç»ä¸‹åå°„</p><p><a href="https://github.com/sweetying520/AptDemo">Github Demo åœ°å€</a> , å¤§å®¶å¯ä»¥çœ‹ Demo è·Ÿéšæˆ‘çš„æ€è·¯ä¸€èµ·åˆ†æ</p><h2 id="ä¸€ã€ä»€ä¹ˆæ˜¯åå°„ï¼Ÿ"><a href="#ä¸€ã€ä»€ä¹ˆæ˜¯åå°„ï¼Ÿ" class="headerlink" title="ä¸€ã€ä»€ä¹ˆæ˜¯åå°„ï¼Ÿ"></a>ä¸€ã€ä»€ä¹ˆæ˜¯åå°„ï¼Ÿ</h2><p>ç®€å•æ¥è®²ï¼Œåå°„å°±æ˜¯ï¼š<strong>å·²çŸ¥ä¸€ä¸ªç±»ï¼Œå¯ä»¥è·å–è¿™ä¸ªç±»çš„æ‰€æœ‰ä¿¡æ¯</strong></p><p>ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæ ¹æ®é¢å‘å¯¹è±¡å°è£…åŸåˆ™ï¼ŒJava å®ä½“ç±»çš„å±æ€§éƒ½æ˜¯ç§æœ‰çš„ï¼Œæˆ‘ä»¬ä¸èƒ½è·å–ç±»ä¸­çš„å±æ€§ã€‚ä½†æˆ‘ä»¬å¯ä»¥æ ¹æ®åå°„ï¼Œè·å–ç§æœ‰å˜é‡ã€æ–¹æ³•ã€æ„é€ æ–¹æ³•ï¼Œæ³¨è§£ï¼Œæ³›å‹ç­‰ç­‰ï¼Œéå¸¸çš„å¼ºå¤§</p><p><strong>æ³¨æ„</strong>ï¼šGoogle åœ¨ Android 9.0 åŠä¹‹åå¯¹åå°„åšäº†é™åˆ¶ï¼Œè¢«ä½¿ç”¨ <code>@hide</code> æ ‡è®°çš„å±æ€§å’Œæ–¹æ³•é€šè¿‡åå°„æ‹¿ä¸åˆ°</p><h2 id="äºŒã€åå°„ä½¿ç”¨"><a href="#äºŒã€åå°„ä½¿ç”¨" class="headerlink" title="äºŒã€åå°„ä½¿ç”¨"></a>äºŒã€åå°„ä½¿ç”¨</h2><p>ä¸‹é¢ç»™å‡ºä¸€æ®µå·²çŸ¥çš„ä»£ç ï¼Œæˆ‘ä»¬é€šè¿‡å®è·µæ¥å¯¹åå°„è¿›è¡Œè®²è§£ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//åŒ…è·¯å¾„</span><br><span class="hljs-keyword">package</span> com.dream.aptdemo;<br><br><span class="hljs-comment">//è‡ªå®šä¹‰æ³¨è§£1</span><br><span class="hljs-meta">@Target(ElementType.TYPE)</span><br><span class="hljs-meta">@Retention(RetentionPolicy.RUNTIME)</span><br><span class="hljs-meta">@interface</span> CustomAnnotation1&#123;<br>  <br>&#125;<br><br><span class="hljs-comment">//è‡ªå®šä¹‰æ³¨è§£2</span><br><span class="hljs-meta">@Target(ElementType.TYPE)</span><br><span class="hljs-meta">@Retention(RetentionPolicy.RUNTIME)</span><br><span class="hljs-meta">@interface</span> CustomAnnotation2&#123;<br>  <br>&#125;<br><br><span class="hljs-comment">//è‡ªå®šä¹‰æ³¨è§£3</span><br><span class="hljs-meta">@Target(ElementType.TYPE)</span><br><span class="hljs-meta">@Inherited</span><br><span class="hljs-meta">@Retention(RetentionPolicy.RUNTIME)</span><br><span class="hljs-meta">@interface</span> CustomAnnotation3&#123;<br><br>&#125;<br><br><span class="hljs-comment">//æ¥å£</span><br><span class="hljs-keyword">interface</span> <span class="hljs-title class_">ICar</span> &#123;<br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">combine</span><span class="hljs-params">()</span>;<br>&#125;<br><br><span class="hljs-comment">//è½¦</span><br><span class="hljs-meta">@CustomAnnotation3</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Car</span>&lt;K,V&gt; &#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-type">String</span> <span class="hljs-variable">carDesign</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;è®¾è®¡ç¨¿&quot;</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-type">String</span> <span class="hljs-variable">engine</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;å‘åŠ¨æœº&quot;</span>;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span><span class="hljs-params">(<span class="hljs-type">long</span> kilometer)</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;Car run &quot;</span> + kilometer + <span class="hljs-string">&quot; km&quot;</span>);<br>    &#125;<br>&#125;<br><span class="hljs-comment">//==============================ä¸Šé¢è¿™äº›éƒ½æ˜¯ä¸ºä¸‹é¢è¿™å°å¥”é©°æœåŠ¡çš„ğŸ˜‚===========================</span><br><span class="hljs-comment">//å¥”é©°</span><br><span class="hljs-meta">@CustomAnnotation1</span><br><span class="hljs-meta">@CustomAnnotation2</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Benz</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Car</span>&lt;String,Integer&gt; <span class="hljs-keyword">implements</span> <span class="hljs-title class_">ICar</span> &#123;<br>  <br>    <span class="hljs-keyword">private</span> <span class="hljs-type">String</span> <span class="hljs-variable">carName</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;å¥”é©°&quot;</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-type">String</span> <span class="hljs-variable">carColor</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;ç™½è‰²&quot;</span>;<br>  <br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Benz</span><span class="hljs-params">()</span> &#123;<br>    &#125;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-title function_">Benz</span><span class="hljs-params">(String carName)</span> &#123;<br>        <span class="hljs-built_in">this</span>.carName = carName;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Benz</span><span class="hljs-params">(String carName, String carColor)</span> &#123;<br>        <span class="hljs-built_in">this</span>.carName = carName;<br>        <span class="hljs-built_in">this</span>.carColor = carColor;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">combine</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;ç»„è£…ä¸€å°å¥”é©°&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">privateMethod</span><span class="hljs-params">(String params)</span>&#123;<br>        System.out.println(<span class="hljs-string">&quot;æˆ‘æ˜¯ç§æœ‰æ–¹æ³•: &quot;</span> + params);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ä¸‹é¢æ‰€è®²åˆ°çš„éƒ½æ˜¯å…³äºåå°„ä¸€äº›å¸¸ç”¨çš„ Api</p><h2 id="ä¸‰ã€ç±»"><a href="#ä¸‰ã€ç±»" class="headerlink" title="ä¸‰ã€ç±»"></a>ä¸‰ã€ç±»</h2><p>æˆ‘ä»¬å¯ä»¥é€šè¿‡ 3 ç§æ–¹å¼å»è·å–ç±»å¯¹è±¡ï¼š</p><h3 id="1ï¼‰ã€Benz-class-ï¼šç±»è·å–"><a href="#1ï¼‰ã€Benz-class-ï¼šç±»è·å–" class="headerlink" title="1ï¼‰ã€Benz.class ï¼šç±»è·å–"></a>1ï¼‰ã€<code>Benz.class</code> ï¼šç±»è·å–</h3><h3 id="2ï¼‰ã€benz-getClass-ï¼šå¯¹è±¡è·å–"><a href="#2ï¼‰ã€benz-getClass-ï¼šå¯¹è±¡è·å–" class="headerlink" title="2ï¼‰ã€benz.getClass ï¼šå¯¹è±¡è·å–"></a>2ï¼‰ã€<code>benz.getClass</code> ï¼šå¯¹è±¡è·å–</h3><h3 id="3ï¼‰ã€Class-forName-ï¼šé™æ€è·å–"><a href="#3ï¼‰ã€Class-forName-ï¼šé™æ€è·å–" class="headerlink" title="3ï¼‰ã€Class.forName ï¼šé™æ€è·å–"></a>3ï¼‰ã€<code>Class.forName</code> ï¼šé™æ€è·å–</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">Benz</span> <span class="hljs-variable">benz</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Benz</span>();<br><span class="hljs-type">Class</span> <span class="hljs-variable">benzClass</span> <span class="hljs-operator">=</span> Benz.class;<br><span class="hljs-type">Class</span> <span class="hljs-variable">benzClass1</span> <span class="hljs-operator">=</span> benz.getClass();<br><span class="hljs-type">Class</span> <span class="hljs-variable">benzClass2</span> <span class="hljs-operator">=</span> Class.forName(<span class="hljs-string">&quot;com.dream.aptdemo.Benz&quot;</span>);<br></code></pre></td></tr></table></figure><p><strong>æ³¨æ„</strong>ï¼š</p><p>1ã€åœ¨ä¸€ä¸ª JVM ä¸­ï¼Œä¸€ç§ç±»ï¼Œåªä¼šæœ‰ä¸€ä¸ªç±»å¯¹è±¡å­˜åœ¨ã€‚æ‰€ä»¥ä»¥ä¸Šä¸‰ç§æ–¹å¼å–å‡ºæ¥çš„ç±»å¯¹è±¡ï¼Œéƒ½æ˜¯ä¸€æ ·çš„ã€‚</p><p>2ã€æ— è®ºå“ªç§é€”å¾„è·å–ç±»å¯¹è±¡ï¼Œéƒ½ä¼šå¯¼è‡´é™æ€å±æ€§è¢«åˆå§‹åŒ–ï¼Œè€Œä¸”åªä¼šæ‰§è¡Œä¸€æ¬¡ã€‚ï¼ˆé™¤äº†ç›´æ¥ä½¿ç”¨ <code>Benz.class</code> ç±»è·å–è¿™ç§æ–¹å¼ï¼Œè¿™ç§æ–¹å¼ä¸ä¼šå¯¼è‡´é™æ€å±æ€§è¢«åˆå§‹åŒ–ï¼‰</p><p><strong>ä¸‹é¢çš„æµç¨‹ä¼šç»å¸¸ä½¿ç”¨åˆ° benz å®ä¾‹å’Œ benzClass ç±»å¯¹è±¡</strong></p><h3 id="4ï¼‰ã€è·å–ç±»å"><a href="#4ï¼‰ã€è·å–ç±»å" class="headerlink" title="4ï¼‰ã€è·å–ç±»å"></a>4ï¼‰ã€è·å–ç±»å</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">String</span> <span class="hljs-variable">className</span> <span class="hljs-operator">=</span> benzClass.getSimpleName();<br>System.out.println(className);<br><br><span class="hljs-comment">//æ‰“å°ç»“æœ</span><br>Benz<br></code></pre></td></tr></table></figure><h3 id="5ï¼‰ã€è·å–ç±»è·¯å¾„"><a href="#5ï¼‰ã€è·å–ç±»è·¯å¾„" class="headerlink" title="5ï¼‰ã€è·å–ç±»è·¯å¾„"></a>5ï¼‰ã€è·å–ç±»è·¯å¾„</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">String</span> <span class="hljs-variable">classPath1</span> <span class="hljs-operator">=</span> benzClass.getName();<br><span class="hljs-type">String</span> <span class="hljs-variable">classPath2</span> <span class="hljs-operator">=</span> benzClass.getCanonicalName();<br>System.out.println(classPath1);<br>System.out.println(classPath2);<br><span class="hljs-comment">//æ‰“å°ç»“æœ</span><br>com.dream.aptdemo.Benz<br>com.dream.aptdemo.Benz<br></code></pre></td></tr></table></figure><p>è¿™é‡Œå¯èƒ½å¤§å®¶ä¼šæœ‰ä¸ªç–‘é—®ï¼š<code>benzClass.getName()</code> å’Œ <code>benzClass.getCanonicalName()</code> æœ‰å•¥åŒºåˆ«å—ï¼Ÿ</p><p>ä»ä¸Šé¢æ‰“å°ç»“æœæ¥çœ‹ï¼Œæ²¡å•¥åŒºåˆ«ï¼Œä½†æ˜¯å¦‚æœæˆ‘ä»¬åœ¨ Benz è¿™ä¸ªé‡Œé¢åŠ ä¸ªå†…éƒ¨ç±»ï¼Œç„¶åè·å–å†…éƒ¨ç±»çš„è·¯å¾„ï¼Œä½ å°±ä¼šçœ‹åˆ°åŒºåˆ«äº†ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//...</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Benz</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Car</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">ICar</span> &#123;<br>    <span class="hljs-comment">//...</span><br>    <span class="hljs-keyword">class</span> <span class="hljs-title class_">InnerClass</span>&#123;<br>        <br>    &#125;<br>&#125;<br><br>Class&lt;Benz.InnerClass&gt; innerClass = Benz.InnerClass.class;<br>System.out.println(innerClass.getName());<br>System.out.println(innerClass.getCanonicalName());<br><span class="hljs-comment">//æ‰“å°ç»“æœ</span><br>com.dream.aptdemo.Benz$InnerClass<br>com.dream.aptdemo.Benz.InnerClass<br></code></pre></td></tr></table></figure><p>çœ‹åˆ°åŒºåˆ«äº†å§ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥å¾—åˆ°ç»“è®ºï¼š<strong>åœ¨æ­£å¸¸æƒ…å†µä¸‹ï¼Œ<code>getCanonicalName</code>å’Œ <code>getName</code> è·å–åˆ°çš„éƒ½æ˜¯åŒ…å«è·¯å¾„çš„ç±»åã€‚ä½†å†…éƒ¨ç±»æœ‰ç‚¹ç‰¹æ®Šï¼ŒgetName è·å–çš„æ˜¯è·¯å¾„.ç±»å$å†…éƒ¨ç±»</strong></p><h3 id="6ï¼‰ã€è·å–çˆ¶ç±»å"><a href="#6ï¼‰ã€è·å–çˆ¶ç±»å" class="headerlink" title="6ï¼‰ã€è·å–çˆ¶ç±»å"></a>6ï¼‰ã€è·å–çˆ¶ç±»å</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">String</span> <span class="hljs-variable">fatherClassName</span> <span class="hljs-operator">=</span> benzClass.getSuperclass().getSimpleName();<br>System.out.println(fatherClassName);<br><span class="hljs-comment">//æ‰“å°ç»“æœ</span><br>Car<br></code></pre></td></tr></table></figure><h3 id="7ï¼‰ã€è·å–æ¥å£"><a href="#7ï¼‰ã€è·å–æ¥å£" class="headerlink" title="7ï¼‰ã€è·å–æ¥å£"></a>7ï¼‰ã€è·å–æ¥å£</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java">Class[] interfaces = benzClass.getInterfaces();<br><span class="hljs-keyword">for</span> (Class anInterface : interfaces) &#123;<br>    System.out.println(anInterface.getName());<br>&#125;<br><span class="hljs-comment">//æ‰“å°ç»“æœ</span><br>com.dream.aptdemo.ICar<br></code></pre></td></tr></table></figure><h3 id="8ï¼‰ã€åˆ›å»ºå®ä¾‹å¯¹è±¡"><a href="#8ï¼‰ã€åˆ›å»ºå®ä¾‹å¯¹è±¡" class="headerlink" title="8ï¼‰ã€åˆ›å»ºå®ä¾‹å¯¹è±¡"></a>8ï¼‰ã€åˆ›å»ºå®ä¾‹å¯¹è±¡</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//è·å–æ„é€ æ–¹æ³•</span><br><span class="hljs-type">Constructor</span> <span class="hljs-variable">constructor</span> <span class="hljs-operator">=</span> benzClass.getDeclaredConstructor();<br><span class="hljs-comment">//åˆ›å»ºå®ä¾‹</span><br><span class="hljs-type">Benz</span> <span class="hljs-variable">myBenz</span> <span class="hljs-operator">=</span> (Benz) constructor.newInstance();<br><span class="hljs-comment">//ä¿®æ”¹å±æ€§</span><br>myBenz.carColor = <span class="hljs-string">&quot;é»‘è‰²&quot;</span>;<br>myBenz.combine();<br>System.out.println(myBenz.carColor);<br><span class="hljs-comment">//æ‰“å°ç»“æœ</span><br>ç»„è£…ä¸€å°å¥”é©°<br>é»‘è‰²<br></code></pre></td></tr></table></figure><p><strong>æ³¨æ„</strong>ï¼šä¸‹é¢è¦è®²çš„å…³äºå¸¦ <code>Declare</code> çš„å±æ€§å’Œæ–¹æ³•å’Œä¸å¸¦<code>Declare</code> åŒºåˆ«ï¼š</p><p><strong>1ã€å¸¦  <code>Declare</code> çš„å±æ€§å’Œæ–¹æ³•è·å–çš„æ˜¯æœ¬ç±»æ‰€æœ‰çš„å±æ€§å’Œæ–¹æ³•ï¼Œä¸åŒ…å«ç»§æ‰¿å¾—æ¥çš„</strong></p><p><strong>2ã€ä¸å¸¦  <code>Declare</code> çš„å±æ€§å’Œæ–¹æ³•è·å–çš„æ˜¯æ‰€æœ‰ <code>public</code> ä¿®é¥°çš„å±æ€§å’Œæ–¹æ³•ï¼ŒåŒ…å«ç»§æ‰¿å¾—æ¥çš„</strong></p><p><strong>3ã€è®¿é—® <code>private</code> ä¿®é¥°çš„å±æ€§å’Œæ–¹æ³•ï¼Œéœ€è°ƒç”¨ <code>setAccessible</code> è®¾ç½®ä¸º true ï¼Œè¡¨ç¤ºå…è®¸æˆ‘ä»¬è®¿é—®ç§æœ‰å˜é‡</strong></p><h2 id="å››ã€å±æ€§"><a href="#å››ã€å±æ€§" class="headerlink" title="å››ã€å±æ€§"></a>å››ã€å±æ€§</h2><h3 id="1ï¼‰ã€è·å–å•ä¸ªå±æ€§"><a href="#1ï¼‰ã€è·å–å•ä¸ªå±æ€§" class="headerlink" title="1ï¼‰ã€è·å–å•ä¸ªå±æ€§"></a>1ï¼‰ã€è·å–å•ä¸ªå±æ€§</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">Field</span> <span class="hljs-variable">carName</span> <span class="hljs-operator">=</span> benzClass.getDeclaredField(<span class="hljs-string">&quot;carName&quot;</span>);<br></code></pre></td></tr></table></figure><h3 id="2ï¼‰ã€è·å–å¤šä¸ªå±æ€§"><a href="#2ï¼‰ã€è·å–å¤šä¸ªå±æ€§" class="headerlink" title="2ï¼‰ã€è·å–å¤šä¸ªå±æ€§"></a>2ï¼‰ã€è·å–å¤šä¸ªå±æ€§</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//è·å–æœ¬ç±»å…¨éƒ¨å±æ€§</span><br>Field[] declaredFields = benzClass.getDeclaredFields();<br><span class="hljs-keyword">for</span> (Field declaredField : declaredFields) &#123;<br>    System.out.println(<span class="hljs-string">&quot;å±æ€§: &quot;</span> + declaredField.getName());<br>&#125;<br><span class="hljs-comment">//æ‰“å°ç»“æœ</span><br>å±æ€§: carName<br>å±æ€§: carColor<br><br><span class="hljs-comment">//è·å–æœ¬ç±»åŠçˆ¶ç±»å…¨éƒ¨ public ä¿®é¥°çš„å±æ€§</span><br>Field[] fields = benzClass.getFields();<br><span class="hljs-keyword">for</span> (Field field : fields) &#123;<br>    System.out.println(<span class="hljs-string">&quot;å±æ€§: &quot;</span> + field.getName());<br>&#125;<br><span class="hljs-comment">//æ‰“å°ç»“æœ</span><br>å±æ€§: carColor<br>å±æ€§: engine<br></code></pre></td></tr></table></figure><h3 id="3ï¼‰ã€è®¾ç½®å…è®¸è®¿é—®ç§æœ‰å˜é‡"><a href="#3ï¼‰ã€è®¾ç½®å…è®¸è®¿é—®ç§æœ‰å˜é‡" class="headerlink" title="3ï¼‰ã€è®¾ç½®å…è®¸è®¿é—®ç§æœ‰å˜é‡"></a>3ï¼‰ã€è®¾ç½®å…è®¸è®¿é—®ç§æœ‰å˜é‡</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">carName.setAccessible(<span class="hljs-literal">true</span>);<br></code></pre></td></tr></table></figure><p>4ï¼‰ã€è·å–å±æ€§å</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java">System.out.println(carName.getName());<br><span class="hljs-comment">//æ‰“å°ç»“æœ</span><br>carName<br></code></pre></td></tr></table></figure><p>5ï¼‰ã€è·å–å˜é‡ç±»å‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java">System.out.println(carName.getType().getName());<br><span class="hljs-comment">//æ‰“å°ç»“æœ</span><br>java.lang.String<br></code></pre></td></tr></table></figure><p>6ï¼‰ã€è·å–å¯¹è±¡ä¸­è¯¥å±æ€§çš„å€¼</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java">System.out.println(carName.get(benz));<br><span class="hljs-comment">//æ‰“å°ç»“æœ</span><br>å¥”é©°<br></code></pre></td></tr></table></figure><p>7ï¼‰ã€ç»™å±æ€§è®¾ç½®å€¼</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java">carName.set(benz,<span class="hljs-string">&quot;sweetying&quot;</span>);<br>System.out.println(carName.get(benz));<br><span class="hljs-comment">//æ‰“å°ç»“æœ</span><br>sweetying<br></code></pre></td></tr></table></figure><h2 id="äº”ã€æ–¹æ³•"><a href="#äº”ã€æ–¹æ³•" class="headerlink" title="äº”ã€æ–¹æ³•"></a>äº”ã€æ–¹æ³•</h2><h3 id="1ï¼‰ã€è·å–å•ä¸ªæ–¹æ³•"><a href="#1ï¼‰ã€è·å–å•ä¸ªæ–¹æ³•" class="headerlink" title="1ï¼‰ã€è·å–å•ä¸ªæ–¹æ³•"></a>1ï¼‰ã€è·å–å•ä¸ªæ–¹æ³•</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//è·å– public æ–¹æ³•</span><br><span class="hljs-type">Method</span> <span class="hljs-variable">publicMethod</span> <span class="hljs-operator">=</span> benzClass.getMethod(<span class="hljs-string">&quot;combine&quot;</span>);<br><br><span class="hljs-comment">//è·å– private æ–¹æ³•</span><br><span class="hljs-type">Method</span> <span class="hljs-variable">privateMethod</span> <span class="hljs-operator">=</span> benzClass.getDeclaredMethod(<span class="hljs-string">&quot;privateMethod&quot;</span>,String.class);<br></code></pre></td></tr></table></figure><h3 id="2ï¼‰ã€è·å–å¤šä¸ªæ–¹æ³•"><a href="#2ï¼‰ã€è·å–å¤šä¸ªæ–¹æ³•" class="headerlink" title="2ï¼‰ã€è·å–å¤šä¸ªæ–¹æ³•"></a>2ï¼‰ã€è·å–å¤šä¸ªæ–¹æ³•</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//è·å–æœ¬ç±»å…¨éƒ¨æ–¹æ³•</span><br>Method[] declaredMethods = benzClass.getDeclaredMethods();<br><span class="hljs-keyword">for</span> (Method declaredMethod : declaredMethods) &#123;<br>    System.out.println(<span class="hljs-string">&quot;æ–¹æ³•å: &quot;</span> + declaredMethod.getName());<br>&#125;<br><span class="hljs-comment">//æ‰“å°ç»“æœ</span><br>æ–¹æ³•å: privateMethod<br>æ–¹æ³•å: combine<br><br><br><span class="hljs-comment">//è·å–æœ¬ç±»åŠçˆ¶ç±»å…¨éƒ¨ public ä¿®é¥°çš„æ–¹æ³•</span><br>Method[] methods = benzClass.getMethods();<br><span class="hljs-keyword">for</span> (Method method : methods) &#123;<br>    System.out.println(<span class="hljs-string">&quot;æ–¹æ³•å: &quot;</span> + method.getName());<br>&#125;<br><span class="hljs-comment">//æ‰“å°ç»“æœ å› ä¸ºæ‰€æœ‰ç±»é»˜è®¤ç»§æ‰¿ Object , æ‰€ä»¥æ‰“å°äº† Object çš„ä¸€äº›æ–¹æ³•</span><br>æ–¹æ³•å: combine<br>æ–¹æ³•å: run<br>æ–¹æ³•å: wait<br>æ–¹æ³•å: wait<br>æ–¹æ³•å: wait<br>æ–¹æ³•å: equals<br>æ–¹æ³•å: toString<br>æ–¹æ³•å: hashCode<br>æ–¹æ³•å: getClass<br>æ–¹æ³•å: notify<br>æ–¹æ³•å: notifyAll<br></code></pre></td></tr></table></figure><h3 id="3ï¼‰ã€æ–¹æ³•è°ƒç”¨"><a href="#3ï¼‰ã€æ–¹æ³•è°ƒç”¨" class="headerlink" title="3ï¼‰ã€æ–¹æ³•è°ƒç”¨"></a>3ï¼‰ã€æ–¹æ³•è°ƒç”¨</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">Method</span> <span class="hljs-variable">privateMethod</span> <span class="hljs-operator">=</span> benzClass.getDeclaredMethod(<span class="hljs-string">&quot;privateMethod&quot;</span>,String.class);<br>privateMethod.setAccessible(<span class="hljs-literal">true</span>);<br>privateMethod.invoke(benz,<span class="hljs-string">&quot;æ¥æ”¶ä¼ å…¥çš„å‚æ•°&quot;</span>);<br><span class="hljs-comment">//æ‰“å°ç»“æœ</span><br>æˆ‘æ˜¯ç§æœ‰æ–¹æ³•: æ¥æ”¶ä¼ å…¥çš„å‚æ•°<br></code></pre></td></tr></table></figure><h2 id="å…­ã€æ„é€ æ–¹æ³•"><a href="#å…­ã€æ„é€ æ–¹æ³•" class="headerlink" title="å…­ã€æ„é€ æ–¹æ³•"></a>å…­ã€æ„é€ æ–¹æ³•</h2><h3 id="1ï¼‰ã€è·å–å•ä¸ªæ„é€ æ–¹æ³•"><a href="#1ï¼‰ã€è·å–å•ä¸ªæ„é€ æ–¹æ³•" class="headerlink" title="1ï¼‰ã€è·å–å•ä¸ªæ„é€ æ–¹æ³•"></a>1ï¼‰ã€è·å–å•ä¸ªæ„é€ æ–¹æ³•</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//è·å–æœ¬ç±»å•ä¸ªæ„é€ æ–¹æ³•</span><br><span class="hljs-type">Constructor</span> <span class="hljs-variable">declaredConstructor</span> <span class="hljs-operator">=</span> benzClass.getDeclaredConstructor(String.class);<br><br><span class="hljs-comment">//è·å–æœ¬ç±»å•ä¸ª public ä¿®é¥°çš„æ„é€ æ–¹æ³•</span><br><span class="hljs-type">Constructor</span> <span class="hljs-variable">singleConstructor</span> <span class="hljs-operator">=</span> benzClass.getConstructor(String.class,String.class);<br></code></pre></td></tr></table></figure><h3 id="2ï¼‰ã€è·å–å¤šä¸ªæ„é€ æ–¹æ³•"><a href="#2ï¼‰ã€è·å–å¤šä¸ªæ„é€ æ–¹æ³•" class="headerlink" title="2ï¼‰ã€è·å–å¤šä¸ªæ„é€ æ–¹æ³•"></a>2ï¼‰ã€è·å–å¤šä¸ªæ„é€ æ–¹æ³•</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//è·å–æœ¬ç±»å…¨éƒ¨æ„é€ æ–¹æ³•</span><br>Constructor[] declaredConstructors = benzClass.getDeclaredConstructors();<br><span class="hljs-keyword">for</span> (Constructor declaredConstructor1 : declaredConstructors) &#123;<br>    System.out.println(<span class="hljs-string">&quot;æ„é€ æ–¹æ³•: &quot;</span> + declaredConstructor1);<br>&#125;<br><span class="hljs-comment">//æ‰“å°ç»“æœ</span><br>æ„é€ æ–¹æ³•: <span class="hljs-keyword">public</span> com.dream.aptdemo.Benz()<br>æ„é€ æ–¹æ³•: <span class="hljs-keyword">public</span> com.dream.aptdemo.Benz(java.lang.String,java.lang.String)<br>æ„é€ æ–¹æ³•: <span class="hljs-keyword">private</span> com.dream.aptdemo.Benz(java.lang.String)<br><br><br><span class="hljs-comment">//è·å–å…¨éƒ¨ public æ„é€ æ–¹æ³•, ä¸åŒ…å«çˆ¶ç±»çš„æ„é€ æ–¹æ³•</span><br>Constructor[] constructors = benzClass.getConstructors();<br><span class="hljs-keyword">for</span> (Constructor constructor1 : constructors) &#123;<br>    System.out.println(<span class="hljs-string">&quot;æ„é€ æ–¹æ³•: &quot;</span> + constructor1);<br>&#125;<br><span class="hljs-comment">//æ‰“å°ç»“æœ</span><br>æ„é€ æ–¹æ³•: <span class="hljs-keyword">public</span> com.dream.aptdemo.Benz()<br>æ„é€ æ–¹æ³•: <span class="hljs-keyword">public</span> com.dream.aptdemo.Benz(java.lang.String,java.lang.String)<br></code></pre></td></tr></table></figure><h3 id="3ï¼‰ã€æ„é€ æ–¹æ³•å®ä¾‹åŒ–å¯¹è±¡"><a href="#3ï¼‰ã€æ„é€ æ–¹æ³•å®ä¾‹åŒ–å¯¹è±¡" class="headerlink" title="3ï¼‰ã€æ„é€ æ–¹æ³•å®ä¾‹åŒ–å¯¹è±¡"></a>3ï¼‰ã€æ„é€ æ–¹æ³•å®ä¾‹åŒ–å¯¹è±¡</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//ä»¥ä¸Šé¢ declaredConstructor ä¸ºä¾‹</span><br>declaredConstructor.setAccessible(<span class="hljs-literal">true</span>);<br><span class="hljs-type">Benz</span> <span class="hljs-variable">declareBenz</span> <span class="hljs-operator">=</span> (Benz) declaredConstructor.newInstance(<span class="hljs-string">&quot;&quot;</span>);<br>System.out.println(declareBenz.carColor);<br><span class="hljs-comment">//æ‰“å°ç»“æœ</span><br>ç™½è‰²<br><br><span class="hljs-comment">//ä»¥ä¸Šé¢ singleConstructor ä¸ºä¾‹</span><br><span class="hljs-type">Benz</span> <span class="hljs-variable">singleBenz</span> <span class="hljs-operator">=</span> (Benz) singleConstructor.newInstance(<span class="hljs-string">&quot;å¥”é©° S &quot;</span>,<span class="hljs-string">&quot;é¦™æ§Ÿé‡‘&quot;</span>);<br>System.out.println(singleBenz.carColor);<br><span class="hljs-comment">//æ‰“å°ç»“æœ</span><br>é¦™æ§Ÿé‡‘<br></code></pre></td></tr></table></figure><h2 id="ä¸ƒã€æ³›å‹"><a href="#ä¸ƒã€æ³›å‹" class="headerlink" title="ä¸ƒã€æ³›å‹"></a>ä¸ƒã€æ³›å‹</h2><h3 id="1ï¼‰ã€è·å–çˆ¶ç±»çš„æ³›å‹"><a href="#1ï¼‰ã€è·å–çˆ¶ç±»çš„æ³›å‹" class="headerlink" title="1ï¼‰ã€è·å–çˆ¶ç±»çš„æ³›å‹"></a>1ï¼‰ã€è·å–çˆ¶ç±»çš„æ³›å‹</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">Type</span> <span class="hljs-variable">genericType</span> <span class="hljs-operator">=</span> benzClass.getGenericSuperclass();<br><span class="hljs-keyword">if</span> (genericType <span class="hljs-keyword">instanceof</span> ParameterizedType) &#123;<br>   Type[] actualType = ((ParameterizedType) genericType).getActualTypeArguments();<br>   <span class="hljs-keyword">for</span> (Type type : actualType) &#123;<br>       System.out.println(type.getTypeName());<br>   &#125;<br>&#125;<br><span class="hljs-comment">//æ‰“å°ç»“æœ</span><br>java.lang.String<br>java.lang.Integer<br></code></pre></td></tr></table></figure><h2 id="å…«ã€æ³¨è§£"><a href="#å…«ã€æ³¨è§£" class="headerlink" title="å…«ã€æ³¨è§£"></a>å…«ã€æ³¨è§£</h2><h3 id="1ï¼‰ã€è·å–å•ä¸ªæ³¨è§£"><a href="#1ï¼‰ã€è·å–å•ä¸ªæ³¨è§£" class="headerlink" title="1ï¼‰ã€è·å–å•ä¸ªæ³¨è§£"></a>1ï¼‰ã€è·å–å•ä¸ªæ³¨è§£</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//è·å–å•ä¸ªæœ¬ç±»æˆ–çˆ¶ç±»æ³¨è§£</span><br><span class="hljs-type">Annotation</span> <span class="hljs-variable">annotation1</span> <span class="hljs-operator">=</span> benzClass.getAnnotation(CustomAnnotation1.class);<br>System.out.println(annotation1.annotationType().getSimpleName());<br><span class="hljs-type">Annotation</span> <span class="hljs-variable">annotation3</span> <span class="hljs-operator">=</span> benzClass.getAnnotation(CustomAnnotation3.class);<br>System.out.println(annotation3.annotationType().getSimpleName());<br><span class="hljs-comment">//æ‰“å°ç»“æœ</span><br>CustomAnnotation1<br>CustomAnnotation3<br><br><span class="hljs-comment">//è·å–å•ä¸ªæœ¬ç±»æ³¨è§£</span><br><span class="hljs-type">Annotation</span> <span class="hljs-variable">declaredAnnotation1</span> <span class="hljs-operator">=</span> benzClass.getDeclaredAnnotation(CustomAnnotation2.class);<br>System.out.println(declaredAnnotation1.annotationType().getSimpleName());<br><span class="hljs-comment">//æ‰“å°ç»“æœ</span><br>CustomAnnotation2<br></code></pre></td></tr></table></figure><h3 id="2ï¼‰ã€è·å–å…¨éƒ¨æ³¨è§£"><a href="#2ï¼‰ã€è·å–å…¨éƒ¨æ³¨è§£" class="headerlink" title="2ï¼‰ã€è·å–å…¨éƒ¨æ³¨è§£"></a>2ï¼‰ã€è·å–å…¨éƒ¨æ³¨è§£</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//è·å–æœ¬ç±»å’Œçˆ¶ç±»çš„æ³¨è§£(çˆ¶ç±»çš„æ³¨è§£éœ€ç”¨ @Inherited è¡¨ç¤ºå¯è¢«ç»§æ‰¿)</span><br>Annotation[] annotations = benzClass.getAnnotations();<br><span class="hljs-keyword">for</span> (Annotation annotation : annotations) &#123;<br>    System.out.println(<span class="hljs-string">&quot;æ³¨è§£åç§°: &quot;</span> + annotation.annotationType().getSimpleName());<br>&#125;<br><span class="hljs-comment">//æ‰“å°ç»“æœ</span><br>æ³¨è§£åç§°: CustomAnnotation3<br>æ³¨è§£åç§°: CustomAnnotation1<br>æ³¨è§£åç§°: CustomAnnotation2<br><br><span class="hljs-comment">//è·å–æœ¬ç±»çš„æ³¨è§£</span><br>Annotation[] declaredAnnotations = benzClass.getDeclaredAnnotations();<br><span class="hljs-keyword">for</span> (Annotation declaredAnnotation : declaredAnnotations) &#123;<br>    System.out.println(<span class="hljs-string">&quot;æ³¨è§£åç§°: &quot;</span> + declaredAnnotation.annotationType().getSimpleName());<br>&#125;<br><span class="hljs-comment">//æ‰“å°ç»“æœ</span><br>æ³¨è§£åç§°: CustomAnnotation1<br>æ³¨è§£åç§°: CustomAnnotation2<br></code></pre></td></tr></table></figure><p>é€šè¿‡ä¸Šé¢çš„è®²è§£ï¼Œæˆ‘ä»¬æŠŠåå°„å¤§éƒ¨åˆ†çŸ¥è¯†ç‚¹éƒ½è®²å®Œäº†ï¼Œå¯ä»¥è¯´åå°„æ˜¯éå¸¸çš„å¼ºå¤§ï¼Œä½†æ˜¯å­¦ä¹ äº†ä¹‹åï¼Œä½ å¯èƒ½ä¼šä¸çŸ¥é“è¯¥å¦‚ä½•ä½¿ç”¨ï¼Œåè€Œè§‰å¾—è¿˜ä¸å¦‚ç›´æ¥è°ƒç”¨æ–¹æ³•æ¥çš„ç›´æ¥å’Œæ–¹ä¾¿ï¼Œä¸‹é¢æˆ‘ä»¬é€šè¿‡å®è·µæ¥æ„Ÿå—ä¸€ä¸‹ã€‚</p><h2 id="ä¹ã€åå°„å®è·µ"><a href="#ä¹ã€åå°„å®è·µ" class="headerlink" title="ä¹ã€åå°„å®è·µ"></a>ä¹ã€åå°„å®è·µ</h2><p>éœ€æ±‚å¤§æ¦‚å°±æ˜¯ï¼šé€šè¿‡åå°é…ç½®ä¸‹å‘ï¼Œå®Œæˆ App ä¸šåŠ¡åŠŸèƒ½çš„åˆ‡æ¢ã€‚å› ä¸ºåªæ˜¯æ¨¡æ‹Ÿï¼Œæˆ‘ä»¬è¿™é‡Œå°±ä»¥é€šè¿‡è¯»å–æœ¬åœ°é…ç½®æ–‡ä»¶å®Œæˆ App ä¸šåŠ¡åŠŸèƒ½çš„åˆ‡æ¢ï¼š</p><p>1ï¼‰ã€é¦–å…ˆå‡†å¤‡ä¸¤ä¸ªä¸šåŠ¡ç±»ï¼Œå‡è®¾ä»–ä»¬çš„åŠŸèƒ½éƒ½å¾ˆå¤æ‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//åŒ…å</span><br><span class="hljs-keyword">package</span> com.dream.aptdemo;<br><br><span class="hljs-comment">//ä¸šåŠ¡1</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Business1</span> &#123;<br> <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">doBusiness1Function</span><span class="hljs-params">()</span>&#123;<br>        System.out.println(<span class="hljs-string">&quot;å¤æ‚ä¸šåŠ¡åŠŸèƒ½1&quot;</span>);<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">//ä¸šåŠ¡2</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Business2</span> &#123;<br> <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">doBusiness2Function</span><span class="hljs-params">()</span>&#123;<br>        System.out.println(<span class="hljs-string">&quot;å¤æ‚ä¸šåŠ¡åŠŸèƒ½2&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>2ï¼‰ã€éåå°„æ–¹å¼</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Client</span> &#123;<br>  <br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">test</span><span class="hljs-params">()</span> &#123;<br>      <span class="hljs-comment">//ä¸šåŠ¡åŠŸèƒ½1</span><br>        <span class="hljs-keyword">new</span> <span class="hljs-title class_">Business1</span>().doBusiness1Function();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>å‡è®¾è¿™ä¸ªæ—¶å€™éœ€è¦ä»ç¬¬ä¸€ä¸ªä¸šåŠ¡åŠŸèƒ½åˆ‡æ¢åˆ°ç¬¬äºŒä¸ªä¸šåŠ¡åŠŸèƒ½ï¼Œä½¿ç”¨éåå°„æ–¹å¼ï¼Œå¿…é¡»ä¿®æ”¹ä»£ç ï¼Œå¹¶ä¸”é‡æ–°ç¼–è¯‘è¿è¡Œï¼Œæ‰å¯ä»¥è¾¾åˆ°æ•ˆæœã€‚é‚£ä¹ˆæˆ‘ä»¬å¯ä»¥é€šè¿‡åå°„å»é€šè¿‡è¯»å–é…ç½®ä»è€Œå®ŒæˆåŠŸèƒ½çš„åˆ‡æ¢ï¼Œè¿™æ ·æˆ‘ä»¬å°±ä¸éœ€è¦ä¿®æ”¹ä»£ç ä¸”ä»£ç å˜å¾—æ›´åŠ é€šç”¨</p><p>3ï¼‰ã€åå°„æ–¹å¼</p><p>1ã€é¦–å…ˆå‡†å¤‡ä¸€ä¸ªé…ç½®æ–‡ä»¶ï¼Œå¦‚ä¸‹å›¾ï¼š</p><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/4de69825228a40dbb491fc9b3f456922~tplv-k3u1fbpfcp-zoom-1.image" alt="image-20210625180301557"></p><p>2ã€è¯»å–é…ç½®æ–‡ä»¶ï¼Œåå°„åˆ›å»ºå®ä¾‹å¹¶è°ƒç”¨æ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Client</span> &#123;<br>  <br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">test</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>      <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-comment">//è·å–æ–‡ä»¶</span><br>            <span class="hljs-type">File</span> <span class="hljs-variable">springConfigFile</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">File</span>(<span class="hljs-string">&quot;/Users/zhouying/AndroidStudioProjects/AptDemo/config.txt&quot;</span>);<br>            <span class="hljs-comment">//è¯»å–é…ç½®</span><br>            Properties config= <span class="hljs-keyword">new</span> <span class="hljs-title class_">Properties</span>();<br>            config.load(<span class="hljs-keyword">new</span> <span class="hljs-title class_">FileInputStream</span>(springConfigFile));<br>            <span class="hljs-comment">//è·å–ç±»è·¯å¾„</span><br>            <span class="hljs-type">String</span> <span class="hljs-variable">classPath</span> <span class="hljs-operator">=</span> (String) config.get(<span class="hljs-string">&quot;class&quot;</span>);<br>            <span class="hljs-comment">//è·å–æ–¹æ³•å</span><br>            <span class="hljs-type">String</span> <span class="hljs-variable">methodName</span> <span class="hljs-operator">=</span> (String) config.get(<span class="hljs-string">&quot;method&quot;</span>);<br><br>            <span class="hljs-comment">//åå°„åˆ›å»ºå®ä¾‹å¹¶è°ƒç”¨æ–¹æ³•</span><br>            <span class="hljs-type">Class</span> <span class="hljs-variable">aClass</span> <span class="hljs-operator">=</span> Class.forName(classPath);<br>            <span class="hljs-type">Constructor</span> <span class="hljs-variable">declaredConstructor</span> <span class="hljs-operator">=</span> aClass.getDeclaredConstructor();<br>            <span class="hljs-type">Object</span> <span class="hljs-variable">o</span> <span class="hljs-operator">=</span> declaredConstructor.newInstance();<br>            <span class="hljs-type">Method</span> <span class="hljs-variable">declaredMethod</span> <span class="hljs-operator">=</span> aClass.getDeclaredMethod(methodName);<br>            declaredMethod.invoke(o);<br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            e.printStackTrace();<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>3ã€å®Œæˆä¸Šé¢ä¸¤æ­¥åï¼Œåç»­æˆ‘ä»¬å°±åªéœ€è¦ä¿®æ”¹é…ç½®æ–‡ä»¶å°±èƒ½å®Œæˆ App ä¸šåŠ¡åŠŸèƒ½çš„åˆ‡æ¢äº†</p><h2 id="åã€æ€»ç»“"><a href="#åã€æ€»ç»“" class="headerlink" title="åã€æ€»ç»“"></a>åã€æ€»ç»“</h2><p>æœ¬ç¯‡æ–‡ç« è®²çš„ä¸€äº›é‡ç‚¹å†…å®¹ï¼š</p><p>1ã€åå°„å¸¸ç”¨ Api çš„ä½¿ç”¨ï¼Œæ³¨æ„åœ¨è®¿é—®ç§æœ‰å±æ€§å’Œæ–¹æ³•æ—¶ï¼Œè°ƒç”¨ <code>setAccessible</code> è®¾ç½®ä¸º true ï¼Œè¡¨ç¤ºå…è®¸æˆ‘ä»¬è®¿é—®ç§æœ‰å˜é‡</p><p>2ã€å®è·µé€šè¿‡åå°„å®Œæˆ App ä¸šåŠ¡åŠŸèƒ½çš„åˆ‡æ¢</p><p>å¥½äº†ï¼Œæœ¬ç¯‡æ–‡ç« åˆ°è¿™é‡Œå°±ç»“æŸäº†ï¼Œå¸Œæœ›èƒ½ç»™ä½ å¸¦æ¥å¸®åŠ© ğŸ¤ </p><p><strong>æ„Ÿè°¢ä½ é˜…è¯»è¿™ç¯‡æ–‡ç« </strong></p><h3 id="ä¸‹ç¯‡é¢„å‘Š"><a href="#ä¸‹ç¯‡é¢„å‘Š" class="headerlink" title="ä¸‹ç¯‡é¢„å‘Š"></a>ä¸‹ç¯‡é¢„å‘Š</h3><p>ä¸‹ç¯‡æ–‡ç« æˆ‘ä¼šè®²æ³¨è§£ï¼Œæ•¬è¯·æœŸå¾…å§</p><h3 id="å‚è€ƒå’Œæ¨è"><a href="#å‚è€ƒå’Œæ¨è" class="headerlink" title="å‚è€ƒå’Œæ¨è"></a>å‚è€ƒå’Œæ¨è</h3><p><a href="https://blog.csdn.net/qq_41464123/article/details/109248009?utm_source=app">Javaåå°„æœ‰å¤šå¼ºï¼Ÿ ä»–æ‹¥æœ‰è¿™äº”å¤§ç¥å¥‡åŠŸèƒ½ï¼</a></p><p><a href="https://how2j.cn/k/reflection/reflection-class/108.html">HOW2J åå°„éƒ¨åˆ†</a></p><blockquote><p><strong>ä½ çš„ç‚¹èµï¼Œè¯„è®ºï¼Œæ˜¯å¯¹æˆ‘å·¨å¤§çš„é¼“åŠ±ï¼</strong></p><p>æ¬¢è¿å…³æ³¨æˆ‘çš„<strong>å…¬ä¼—å·ï¼š</strong>  <a href="http://m6z.cn/6jwi7b"><strong>sweetying</strong></a> ï¼Œæ–‡ç« æ›´æ–°å¯ç¬¬ä¸€æ—¶é—´æ”¶åˆ°</p><p>å¦‚æœ<strong>æœ‰é—®é¢˜</strong>ï¼Œå…¬ä¼—å·å†…æœ‰åŠ æˆ‘å¾®ä¿¡çš„å…¥å£ï¼Œåœ¨æŠ€æœ¯å­¦ä¹ ã€ä¸ªäººæˆé•¿çš„é“è·¯ä¸Šï¼Œæˆ‘ä»¬ä¸€èµ·å‰è¿›ï¼</p></blockquote>]]></content>
    
    
    <categories>
      
      <category>Android</category>
      
      <category>APT</category>
      
    </categories>
    
    
    <tags>
      
      <tag>åŸåˆ›</tag>
      
      <tag>Android</tag>
      
      <tag>Android APT</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Flutter ç³»åˆ—ï¼ˆå…«ï¼‰ï¼šFlutter ä¸ Android çš„ä½ æ¥æˆ‘å¾€</title>
    <link href="/2022/10/10/Flutter%20%E7%B3%BB%E5%88%97%EF%BC%88%E5%85%AB%EF%BC%89%EF%BC%9AFlutter%20%E4%B8%8E%20Android%20%E7%9A%84%E4%BD%A0%E6%9D%A5%E6%88%91%E5%BE%80/"/>
    <url>/2022/10/10/Flutter%20%E7%B3%BB%E5%88%97%EF%BC%88%E5%85%AB%EF%BC%89%EF%BC%9AFlutter%20%E4%B8%8E%20Android%20%E7%9A%84%E4%BD%A0%E6%9D%A5%E6%88%91%E5%BE%80/</url>
    
    <content type="html"><![CDATA[<p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/ef7d5226198d42a09559419a34f9c406~tplv-k3u1fbpfcp-watermark.image"></p><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>å¾ˆé«˜å…´é‡è§ä½ ~</p><p>åœ¨æœ¬ç³»åˆ—çš„ä¸Šä¸€ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬ä»‹ç»äº† Flutter ä¸­çš„è·¯ç”±ï¼š</p><blockquote><p>1ã€åŸºæœ¬è·¯ç”±</p><p>2ã€å‘½åè·¯ç”±</p><p>3ã€è¿”å›ä¸Šä¸€çº§</p><p>4ã€æ›¿æ¢è·¯ç”±</p><p>5ã€è¿”å›åˆ°æ ¹è·¯ç”±</p></blockquote><p>ä»¥åŠé›†æˆ http åº“è¿›è¡Œ https è¯·æ±‚å®æˆ˜ã€‚</p><p>è¿˜æ²¡æœ‰çœ‹è¿‡ä¸Šä¸€ç¯‡æ–‡ç« çš„æœ‹å‹ï¼Œå»ºè®®å…ˆå»é˜…è¯» <a href="https://juejin.cn/post/7142650961868095524#heading-11">Flutter ç³»åˆ—ï¼ˆä¸ƒï¼‰ï¼šFlutter è·¯ç”±å’Œ HTTPS è¯·æ±‚å®æˆ˜</a>ã€‚æ¥ä¸‹æ¥æˆ‘ä»¬å¯¹ Flutter ä¸ Android åŸç”Ÿçš„äº¤äº’ä¸é€šä¿¡è¿›è¡Œä»‹ç»</p><p>æˆ‘åš Android åŸç”Ÿå¼€å‘æ—¶ï¼Œé€šå¸¸ä¼šä»¥ç»„ä»¶åŒ–çš„æ–¹å¼å»è¿›è¡Œï¼Œæ ¹æ®ä¸šåŠ¡åˆ’åˆ†ä¸åŒçš„ç»„ä»¶ï¼Œæ¯ä¸ªç»„ä»¶éƒ½æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„å·¥ç¨‹ï¼Œå¯ä»¥è¿›è¡Œç‹¬ç«‹çš„è¿è¡Œå’Œè°ƒè¯•ï¼Œå½“éœ€è¦å‘ç‰ˆæ—¶ï¼Œæˆ‘ä»¬ä¼šå°†æ¯ä¸ªç»„ä»¶æ‰“æˆ aar åŒ…å¹¶ä¸Šä¼ åˆ° Maven ç§æœä»“åº“ï¼Œç„¶åæ•´åˆåˆ° App å£³å·¥ç¨‹ä¸­ï¼Œæœ€ç»ˆè¿›è¡Œæ‰“åŒ…ä¸Šçº¿ã€‚åœ¨è¿™ä¸ªå¼€å‘è¿‡ç¨‹ä¸­ï¼Œç»„ä»¶ä¹‹é—´æ˜¯éœ€è¦è¿›è¡Œé€šä¿¡çš„ï¼Œå¦‚æœéœ€è¦é€šä¿¡çš„ç»„ä»¶éƒ½æ˜¯ Android åŸç”Ÿå¼€å‘çš„ï¼Œé‚£ä¹ˆå¯ä»¥é€‰æ‹©ä¸€ä¸ªè·¯ç”±æ¡†æ¶è¿›è¡Œé€šä¿¡ï¼Œä¾‹å¦‚ï¼šArouterã€‚</p><p>ä½†æ˜¯æˆ‘ä»¬æœ‰äº›ä¸šåŠ¡ç»„ä»¶æ˜¯ä½¿ç”¨ Flutter å¼€å‘çš„ï¼Œå› æ­¤è¿™é‡Œå°±æ¶‰åŠåˆ° Flutter ä¸ Android åŸç”Ÿçš„é€šä¿¡ï¼Œé‚£ä¹ˆå®ƒä»¬æ˜¯å¦‚ä½•è¿›è¡Œé€šä¿¡çš„å‘¢ï¼Ÿä¸”å¬æˆ‘ç»†ç»†é“æ¥</p><h2 id="ä¸€ã€Android-å£³å·¥ç¨‹é›†æˆ-Flutter-ç»„ä»¶"><a href="#ä¸€ã€Android-å£³å·¥ç¨‹é›†æˆ-Flutter-ç»„ä»¶" class="headerlink" title="ä¸€ã€Android å£³å·¥ç¨‹é›†æˆ Flutter ç»„ä»¶"></a>ä¸€ã€Android å£³å·¥ç¨‹é›†æˆ Flutter ç»„ä»¶</h2><p>1ã€æ‰“å¼€ AndroidStudio ï¼Œåˆ›å»ºä¸€ä¸ª Android å·¥ç¨‹ AndroidAndFlutterInteractiveï¼š</p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/bf366145424946f193676017f1a2bc42~tplv-k3u1fbpfcp-zoom-1.image" alt="image-20220918215022577" width="50%" /><p>2ã€æ¥ç€åœ¨åˆ›å»ºä¸€ä¸ª Flutter å·¥ç¨‹ fluttermoduleï¼š</p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/63073b782a5e4716a0a0a8659673cc28~tplv-k3u1fbpfcp-zoom-1.image" alt="image-20220918215214876" width="50%" /><p>main.dart æ–‡ä»¶åˆå§‹ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;package:flutter/material.dart&#x27;</span>;<br><br><span class="hljs-keyword">void</span> main() =&gt; runApp(<span class="hljs-keyword">const</span> MyApp());<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyApp</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">StatelessWidget</span> </span>&#123;<br>  <span class="hljs-keyword">const</span> MyApp(&#123;Key? key&#125;) : <span class="hljs-keyword">super</span>(key: key);<br><br>  <span class="hljs-comment">// This widget is the root of your application.</span><br>  <span class="hljs-meta">@override</span><br>  Widget build(BuildContext context) &#123;<br>    <span class="hljs-keyword">return</span> MaterialApp(<br>      title: <span class="hljs-string">&#x27;Flutter Demo&#x27;</span>,<br>      theme: ThemeData(<br>        primarySwatch: Colors.blue,<br>      ),<br>      home: <span class="hljs-keyword">const</span> MyHomePage(title: <span class="hljs-string">&#x27;Flutter Demo Home Page&#x27;</span>),<br>    );<br>  &#125;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyHomePage</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">StatefulWidget</span> </span>&#123;<br>  <span class="hljs-keyword">const</span> MyHomePage(&#123;Key? key, <span class="hljs-keyword">required</span> <span class="hljs-keyword">this</span>.title&#125;) : <span class="hljs-keyword">super</span>(key: key);<br><br>  <span class="hljs-keyword">final</span> <span class="hljs-built_in">String</span> title;<br><br>  <span class="hljs-meta">@override</span><br>  State&lt;MyHomePage&gt; createState() =&gt; _MyHomePageState();<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">_MyHomePageState</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">State</span>&lt;<span class="hljs-title">MyHomePage</span>&gt; </span>&#123;<br>  <span class="hljs-built_in">int</span> _counter = <span class="hljs-number">0</span>;<br><br>  <span class="hljs-keyword">void</span> _incrementCounter() &#123;<br>    setState(() &#123;<br>      _counter++;<br>    &#125;);<br>  &#125;<br><br>  <span class="hljs-meta">@override</span><br>  Widget build(BuildContext context) &#123;<br>    <span class="hljs-keyword">return</span> Scaffold(<br>      appBar: AppBar(<br>        title: Text(widget.title),<br>      ),<br>      body: Center(<br>        child: Column(<br>          mainAxisAlignment: MainAxisAlignment.center,<br>          children: &lt;Widget&gt;[<br>            <span class="hljs-keyword">const</span> Text(<br>              <span class="hljs-string">&#x27;You have clicked the button this many times:&#x27;</span>,<br>            ),<br>            Text(<br>              <span class="hljs-string">&#x27;<span class="hljs-subst">$_counter</span>&#x27;</span>,<br>              style: Theme.of(context).textTheme.headline4,<br>            ),<br>          ],<br>        ),<br>      ),<br>      floatingActionButton: FloatingActionButton(<br>        onPressed: _incrementCounter,<br>        tooltip: <span class="hljs-string">&#x27;Increment&#x27;</span>,<br>        child: <span class="hljs-keyword">const</span> Icon(Icons.add),<br>      ),<br>    );<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>3ã€åœ¨ Flutter å·¥ç¨‹ä¸­æ‰§è¡Œ <code>flutter build aar</code> å‘½ä»¤æˆ–è€…ç›´æ¥ä½¿ç”¨ AndroidStudio ä¸Šçš„å¯è§†åŒ–æ“ä½œï¼š</p><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/d61a34bea63840d3a74083913adccf2a~tplv-k3u1fbpfcp-watermark.image?" alt="202209221609588.png" width="70%" /><p>æ‰§è¡Œå®Œåä¼šæœ‰å¦‚ä¸‹æç¤ºï¼š</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs dart">Consuming the Module<br>  <span class="hljs-number">1.</span> Open &lt;host&gt;/app/build.gradle<br>  <span class="hljs-number">2.</span> Ensure you have the repositories configured, otherwise add them:<br><br>      <span class="hljs-built_in">String</span> storageUrl = System.env.FLUTTER_STORAGE_BASE_URL ?: <span class="hljs-string">&quot;https://storage.googleapis.com&quot;</span><br>      repositories &#123;<br>        maven &#123;<br>            url <span class="hljs-string">&#x27;/Users/zhouying/codeandnotes/Flutter/fluttermodule/build/host/outputs/repo&#x27;</span><br>        &#125;<br>        maven &#123;<br>            url <span class="hljs-string">&quot;<span class="hljs-subst">$storageUrl</span>/download.flutter.io&quot;</span><br>        &#125;<br>      &#125;<br><br>  <span class="hljs-number">3.</span> Make the host app depend <span class="hljs-keyword">on</span> the Flutter module:<br><br>    dependencies &#123;<br>      debugImplementation <span class="hljs-string">&#x27;com.example.fluttermodule:flutter_debug:1.0&#x27;</span><br>      profileImplementation <span class="hljs-string">&#x27;com.example.fluttermodule:flutter_profile:1.0&#x27;</span><br>      releaseImplementation <span class="hljs-string">&#x27;com.example.fluttermodule:flutter_release:1.0&#x27;</span><br>    &#125;<br><br><br>  <span class="hljs-number">4.</span> Add the `profile` build type:<br><br>    android &#123;<br>      buildTypes &#123;<br>        profile &#123;<br>          initWith debug<br>        &#125;<br>      &#125;<br>    &#125;<br></code></pre></td></tr></table></figure><p>å¤§è‡´æ„æ€å°±æ˜¯åœ¨æˆ‘ä»¬åˆ›å»ºçš„ Android å·¥ç¨‹ä¸­é…ç½®ç”Ÿæˆçš„ Flutter aar çš„ä»“åº“åœ°å€ï¼Œç„¶åå¼•ç”¨è¿™ä¸ª aarï¼Œå¤§å®¶æŒ‰ç…§ä¸Šè¿°æ­¥éª¤é…ç½®å³å¯</p><p><strong>æ³¨æ„</strong>ï¼šä¸Šè¿°æ¼”ç¤ºç”Ÿæˆçš„ Flutter aar åªæ˜¯å­˜åœ¨æœ¬åœ°ï¼Œå®é™…å¼€å‘ä¸­ï¼Œæˆ‘ä»¬ä¼šè‡ªå·±ç¼–å†™è„šæœ¬ç”Ÿæˆ aar å¹¶ä¸Šä¼ åˆ° Maven ç§æœä»“åº“</p><p>é…ç½®å®Œæˆåï¼ŒåŒæ­¥ä¸€ä¸‹é¡¹ç›®ï¼Œå¦‚æœæ²¡å•¥æŠ¥é”™ï¼Œæˆ‘ä»¬å°±ç®—æ˜¯æˆåŠŸé›†æˆäº† Flutter ç»„ä»¶</p><h2 id="äºŒã€Android-è°ƒèµ·-Flutter-é¡µé¢ï¼ˆFlutterActivityï¼‰"><a href="#äºŒã€Android-è°ƒèµ·-Flutter-é¡µé¢ï¼ˆFlutterActivityï¼‰" class="headerlink" title="äºŒã€Android è°ƒèµ· Flutter é¡µé¢ï¼ˆFlutterActivityï¼‰"></a>äºŒã€Android è°ƒèµ· Flutter é¡µé¢ï¼ˆFlutterActivityï¼‰</h2><p>æ¥ä¸‹æ¥æˆ‘ä»¬ç»§ç»­å¯¹ Android å·¥ç¨‹è¿›è¡Œé…ç½®ï¼Œè®© Flutter é¡µé¢æ˜¾ç¤ºå‡ºæ¥</p><p>1ã€åœ¨ Android å·¥ç¨‹çš„ AndroidManifest.xml æ–‡ä»¶ä¸­æ·»åŠ  FlutterActivity</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs dart">&lt;!--æ³¨å†ŒFlutterActivity--&gt;<br>&lt;activity<br>    android:name=<span class="hljs-string">&quot;io.flutter.embedding.android.FlutterActivity&quot;</span><br>    android:configChanges=<span class="hljs-string">&quot;orientation|keyboardHidden|screenSize&quot;</span><br>    android:hardwareAccelerated=<span class="hljs-string">&quot;true&quot;</span><br>    android:windowSoftInputMode=<span class="hljs-string">&quot;adjustResize&quot;</span> /&gt;<br></code></pre></td></tr></table></figure><p>2ã€ç¼–å†™ä¸€ä¸ª button è·³è½¬åˆ° Flutter é¡µé¢</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-comment">//1ã€activity_main.xml</span><br>&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;utf-8&quot;</span>?&gt;<br>&lt;LinearLayout xmlns:android=<span class="hljs-string">&quot;http://schemas.android.com/apk/res/android&quot;</span><br>    xmlns:tools=<span class="hljs-string">&quot;http://schemas.android.com/tools&quot;</span><br>    android:layout_width=<span class="hljs-string">&quot;match_parent&quot;</span><br>    android:layout_height=<span class="hljs-string">&quot;match_parent&quot;</span><br>    android:orientation=<span class="hljs-string">&quot;vertical&quot;</span><br>    tools:context=<span class="hljs-string">&quot;.MainActivity&quot;</span>&gt;<br><br>    &lt;Button<br>        android:layout_width=<span class="hljs-string">&quot;match_parent&quot;</span><br>        android:layout_height=<span class="hljs-string">&quot;wrap_content&quot;</span><br>        android:layout_marginHorizontal=<span class="hljs-string">&quot;20dp&quot;</span><br>        android:textAllCaps=<span class="hljs-string">&quot;false&quot;</span><br>        android:onClick=<span class="hljs-string">&quot;toFlutterActivity&quot;</span><br>        android:text=<span class="hljs-string">&quot;è·³è½¬ FlutterActivity&quot;</span><br>        tools:ignore=<span class="hljs-string">&quot;HardcodedText,UsingOnClickInXml&quot;</span> /&gt;<br><br>&lt;/LinearLayout&gt;<br><br><span class="hljs-comment">//2ã€MainActivity</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MainActivity</span> : <span class="hljs-title">AppCompatActivity</span>() </span>&#123;<br>    <br>    <span class="hljs-meta">@SuppressLint</span>(<span class="hljs-string">&quot;SetTextI18n&quot;</span>)<br>    override fun onCreate(savedInstanceState: Bundle?) &#123;<br>        <span class="hljs-keyword">super</span>.onCreate(savedInstanceState)<br>        setContentView(R.layout.activity_main)<br>    &#125;<br><br>    <span class="hljs-comment">//è·³è½¬åˆ° FlutterActivity</span><br>    fun toFlutterActivity(view: View) &#123;<br>        val intent = FlutterActivity.createDefaultIntent(<span class="hljs-keyword">this</span>)<br>        startActivity(intent)<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>3ã€æ•ˆæœå±•ç¤ºï¼š</p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/120d15e966e24a588e0a212d36ffbd7d~tplv-k3u1fbpfcp-watermark.image?" alt="ezgif.com-gif-maker.gif" width="30%" /><p>ä¸Šè¿°æ•ˆæœå›¾è™½ç„¶è·³è¿‡å»äº†ï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ç‚¹å‡» button æ—¶ä¸€ä¸ªæ˜æ˜¾çš„åœé¡¿æ„Ÿï¼Œç”¨æˆ·ä½“éªŒä¸å¥½ï¼Œæ¥ä¸‹æ¥ä»‹ç»ä¸€ç§é¢„åˆå§‹åŒ– Flutter çš„æ–¹å¼</p><h3 id="2-1ã€Android-é¢„åˆå§‹åŒ–-Flutter-é¡µé¢è·³è½¬"><a href="#2-1ã€Android-é¢„åˆå§‹åŒ–-Flutter-é¡µé¢è·³è½¬" class="headerlink" title="2.1ã€Android é¢„åˆå§‹åŒ– Flutter é¡µé¢è·³è½¬"></a>2.1ã€Android é¢„åˆå§‹åŒ– Flutter é¡µé¢è·³è½¬</h3><p>æ ¸å¿ƒæ€æƒ³å°±æ˜¯ç¼“å­˜ FlutterEngineï¼Œç„¶åä»ç¼“å­˜ä¸­å–å‡º FlutterEngine è¿›è¡Œè·³è½¬</p><p>1ã€ä¿®æ”¹ MainActivity ï¼š</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MainActivity</span> : <span class="hljs-title">AppCompatActivity</span>() </span>&#123;<br><br>    companion object&#123;<br>        <span class="hljs-comment">//ç¼“å­˜ FlutterEngine çš„ key</span><br>        <span class="hljs-keyword">const</span> val FLUTTER_ENGINE_ID = <span class="hljs-string">&quot;default&quot;</span><br>    &#125;<br>    <span class="hljs-comment">//FlutterEngine</span><br>    private lateinit <span class="hljs-keyword">var</span> flutterEngine: FlutterEngine<br><br>    <span class="hljs-meta">@SuppressLint</span>(<span class="hljs-string">&quot;SetTextI18n&quot;</span>)<br>    override fun onCreate(savedInstanceState: Bundle?) &#123;<br>        <span class="hljs-keyword">super</span>.onCreate(savedInstanceState)<br>        setContentView(R.layout.activity_main)<br>        <span class="hljs-comment">//åˆå§‹åŒ– FlutterEngine</span><br>        flutterEngine = initFlutterEngine(FLUTTER_ENGINE_ID)<br>    &#125;<br><br>    <span class="hljs-comment">//è·³è½¬åˆ° FlutterActivity</span><br>    fun toFlutterActivity(view: View) &#123;<br>        val intent = FlutterActivity.withCachedEngine(FLUTTER_ENGINE_ID).build(<span class="hljs-keyword">this</span>)<br>        startActivity(intent)<br>    &#125;<br><br>    <span class="hljs-comment"><span class="language-markdown">/<span class="hljs-strong">**</span></span></span><br><span class="hljs-strong"><span class="language-markdown"><span class="hljs-comment">     <span class="hljs-emphasis">* åˆå§‹åŒ– FlutterEngine</span></span></span></span><br><span class="hljs-emphasis"><span class="hljs-strong"><span class="language-markdown"><span class="hljs-comment">     *</span> ä¸€èˆ¬åœ¨è·³è½¬å‰è°ƒç”¨ï¼Œä»ç¼“å­˜ä¸­å–å‡º FlutterEngineï¼Œè¿™æ ·å¯ä»¥åŠ å¿«æˆ‘ä»¬é¡µé¢çš„ä¸€ä¸ªè·³è½¬</span></span></span><br><span class="hljs-strong"><span class="language-markdown"><span class="hljs-comment">     <span class="hljs-emphasis">*/</span></span></span></span><br>    private fun initFlutterEngine(engineId: <span class="hljs-built_in">String</span>): FlutterEngine &#123;<br>        <span class="hljs-comment">//åˆ›å»º FlutterEngine</span><br>        val flutterEngine = FlutterEngine(<span class="hljs-keyword">this</span>)<br>        <span class="hljs-comment">//æŒ‡å®šè¦è·³è½¬çš„ Flutter é¡µé¢</span><br>        flutterEngine.navigationChannel.setInitialRoute(<span class="hljs-string">&quot;main&quot;</span>)<br>        flutterEngine.dartExecutor.executeDartEntrypoint(DartExecutor.DartEntrypoint.createDefault())<br>        <span class="hljs-comment">//ç¼“å­˜ FlutterEngine</span><br>        val flutterEngineCache = FlutterEngineCache.getInstance()<br>        flutterEngineCache.put(engineId,flutterEngine)<br>        <span class="hljs-keyword">return</span> flutterEngine<br>    &#125;<br><br>    override fun onDestroy() &#123;<br>        <span class="hljs-keyword">super</span>.onDestroy()<br>        <span class="hljs-comment"><span class="language-markdown"><span class="hljs-strong"><span class="hljs-emphasis">/*</span><span class="hljs-emphasis">*</span></span></span></span><br><span class="hljs-emphasis"><span class="hljs-strong"><span class="language-markdown"><span class="hljs-comment">         *</span> æ³¨æ„è¿™é‡Œä¸€å®šè¦é”€æ¯ï¼Œå¦åˆ™ä¼šå¯¼è‡´å†…å­˜æ³„æ¼</span></span></span><br><span class="hljs-strong"><span class="language-markdown"><span class="hljs-comment">         <span class="hljs-emphasis">* å› ä¸º FlutterEngine æ¯”æ˜¾ç¤ºå®ƒçš„ FlutterActivity ç”Ÿå‘½å‘¨æœŸè¦é•¿</span></span></span></span><br><span class="hljs-emphasis"><span class="hljs-strong"><span class="language-markdown"><span class="hljs-comment">         *</span> å½“æˆ‘ä»¬é€€å‡º FlutterActivity æ—¶ï¼ŒFlutterEngine å¯èƒ½è¿˜ä¼šç»§ç»­æ‰§è¡Œä»£ç </span></span></span><br><span class="hljs-strong"><span class="language-markdown"><span class="hljs-comment">         <span class="hljs-emphasis">* æ‰€ä»¥æˆ‘ä»¬åº”è¯¥åœ¨ FlutterActivity é€€å‡ºæ—¶è°ƒç”¨ flutterEngine.destroy åœæ­¢æ‰§è¡Œå¹¶é‡Šæ”¾èµ„æº</span></span></span></span><br><span class="hljs-emphasis"><span class="hljs-strong"><span class="language-markdown"><span class="hljs-comment">         *</span>/</span></span></span><br>        flutterEngine.destroy()<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>2ã€Flutter ç«¯ä¹Ÿè¦åšç›¸åº”çš„ä¿®æ”¹ï¼š</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-keyword">void</span> main() =&gt; runApp(getRouter(<span class="hljs-built_in">window</span>.defaultRouteName));<br><br><span class="hljs-comment">///<span class="language-markdown">æ¥æ”¶ Android è·³è½¬è¿‡æ¥çš„å¯åŠ¨è·¯ç”±å‚æ•°ï¼Œå¦‚æœåŒ¹é…ä¸Šäº†èµ°æ­£å¸¸æµç¨‹</span></span><br><span class="hljs-comment">///<span class="language-markdown">å¦‚æœæ²¡åŒ¹é…ä¸Šï¼Œåˆ™æç¤º page not found</span></span><br>Widget getRouter(<span class="hljs-built_in">String</span> routeName) &#123;<br>  <span class="hljs-keyword">switch</span>(routeName)&#123;<br>    <span class="hljs-keyword">case</span> <span class="hljs-string">&quot;main&quot;</span>:<br>      <span class="hljs-keyword">return</span> <span class="hljs-keyword">const</span> MyApp();<br>    <span class="hljs-keyword">default</span>:<br>      <span class="hljs-keyword">return</span> MaterialApp(<br>        home: Scaffold(<br>          appBar: AppBar(<br>            title: <span class="hljs-keyword">const</span> Text(<span class="hljs-string">&quot;Flutter Demo Home Page&quot;</span>),<br>          ),<br>          body: <span class="hljs-keyword">const</span> Center(<br>            child: Text(<br>              <span class="hljs-string">&quot;page not found&quot;</span>,<br>              style: TextStyle(<br>                fontSize: <span class="hljs-number">24</span>,<br>                color: Colors.red<br>              ),<br>            ),<br>          ),<br>        ),<br>      );<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>3ã€å½“æˆ‘ä»¬ä¿®æ”¹ Flutter å·¥ç¨‹çš„ä»£ç åï¼Œé‡æ–°è¿è¡Œ Android é¡¹ç›®å¹¶ä¸ä¼šç”Ÿæ•ˆï¼Œæˆ‘ä»¬éœ€è¦ï¼š</p><blockquote><p>1ã€åœ¨ Flutter å·¥ç¨‹é‡æ–°æ‰§è¡Œ <code>flutter build aar</code> å‘½ä»¤</p><p>2ã€å¾… Flutter å‘½ä»¤æ‰§è¡Œå®Œæˆï¼Œclean Android å·¥ç¨‹</p></blockquote><p>æ­¤æ—¶æˆ‘ä»¬è¿è¡Œ Android é¡¹ç›®ï¼Œå°±å¯ä»¥çœ‹åˆ°æ•ˆæœäº†ï¼š</p><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/e34d61c673024ce2bdc36f6c13602b0f~tplv-k3u1fbpfcp-watermark.image?" alt="ezgif.com-gif-maker (1).gif" width="30%" /><p>å¯ä»¥çœ‹åˆ°ï¼Œé¡µé¢è·³è½¬å˜å¾—éå¸¸ä¸æ»‘</p><p>ç°åœ¨åªæ˜¯ç®€å•çš„è·³è½¬ï¼Œé‚£ä¹ˆå¦‚æœæˆ‘æƒ³åœ¨è·³è½¬æ—¶ç»™ Flutter é¡µé¢ä¼ å€¼è¦æ€ä¹ˆåšå‘¢ï¼Ÿ</p><h3 id="2-2ã€Android-ç»™-Flutter-é¡µé¢ä¼ å€¼"><a href="#2-2ã€Android-ç»™-Flutter-é¡µé¢ä¼ å€¼" class="headerlink" title="2.2ã€Android ç»™ Flutter é¡µé¢ä¼ å€¼"></a>2.2ã€Android ç»™ Flutter é¡µé¢ä¼ å€¼</h3><p>åˆ†æ 2.1 è¿™ä¸ªä¾‹å­ï¼Œæˆ‘ä»¬åœ¨ Android å·¥ç¨‹ä¸­è®¾ç½®äº†å¯åŠ¨è·¯ç”±ï¼š</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dart">flutterEngine.navigationChannel.setInitialRoute(<span class="hljs-string">&quot;main&quot;</span>)<br></code></pre></td></tr></table></figure><p>ç„¶ååœ¨ Flutter ä¸­é€šè¿‡ <code>window.defaultRouteName</code> è·å–äº†è·¯ç”±</p><p>é‚£ä¹ˆæˆ‘æ˜¯å¦å¯ä»¥åœ¨å¯åŠ¨è·¯ç”±ä¸­å¤šæ·»åŠ ä¸€äº›æ•°æ®ï¼Œç„¶å Flutter è·å–åè¿›è¡Œè§£æå‘¢ï¼Ÿä¾‹å¦‚ï¼š</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-comment">//1ã€æˆ‘åœ¨ Android ä¸­è¿™æ ·è®¾ç½®</span><br>flutterEngine.navigationChannel.setInitialRoute(<span class="hljs-string">&quot;main?&#123;\&quot;name\&quot;:\&quot;erdai\&quot;,\&quot;age\&quot;:18&#125;&quot;</span>)<br><br><span class="hljs-comment">//2ã€Flutter ä¸­è·å–è·¯ç”±å¹¶è¿›è¡Œè§£æ</span><br><span class="hljs-built_in">String</span> url = <span class="hljs-built_in">window</span>.defaultRouteName;<br><span class="hljs-comment">//è·å–è·¯ç”±åç§°</span><br><span class="hljs-built_in">String</span> routeName = url.substring(<span class="hljs-number">0</span>,url.indexOf(<span class="hljs-string">&quot;?&quot;</span>));<br><span class="hljs-comment">//è·å–å‚æ•°ï¼Œå°†å‚æ•°è§£æå¹¶è½¬æ¢æˆä¸€ä¸ª Map å¯¹è±¡</span><br><span class="hljs-built_in">String</span> paramsString = url.substring(url.indexOf(<span class="hljs-string">&quot;?&quot;</span>) + <span class="hljs-number">1</span>);<br><span class="hljs-built_in">Map</span>&lt;<span class="hljs-built_in">String</span>,<span class="hljs-built_in">dynamic</span>&gt; paramsMap = json.decode(paramsString);<br><br></code></pre></td></tr></table></figure><p>å®é™…ä¸Šå°±æ˜¯è¿™ä¹ˆå¹²çš„ï¼Œæˆ‘ä»¬ä¿®æ”¹ Flutter ç«¯çš„ä»£ç ï¼š</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-keyword">void</span> main()&#123;<br>  <span class="hljs-comment">//è·å– Android ä¼ è¿‡æ¥çš„è·¯ç”±</span><br>  <span class="hljs-built_in">String</span> url = <span class="hljs-built_in">window</span>.defaultRouteName;<br>  <span class="hljs-comment">//è§£æå¹¶è·å–è·¯ç”±åç§°</span><br>  <span class="hljs-built_in">String</span> routeName = url.substring(<span class="hljs-number">0</span>,url.indexOf(<span class="hljs-string">&quot;?&quot;</span>));<br>  <span class="hljs-comment">//è§£æå¹¶å°†å‚æ•°è½¬æ¢æˆä¸€ä¸ª Map å¯¹è±¡</span><br>  <span class="hljs-built_in">String</span> paramsString = url.substring(url.indexOf(<span class="hljs-string">&quot;?&quot;</span>) + <span class="hljs-number">1</span>);<br>  <span class="hljs-built_in">Map</span>&lt;<span class="hljs-built_in">String</span>,<span class="hljs-built_in">dynamic</span>&gt; paramsMap = json.decode(paramsString);<br>  <span class="hljs-comment">//æ‰“å°å‚æ•°</span><br>  <span class="hljs-built_in">print</span>(paramsMap);<br>  runApp(getRouter(routeName));<br>&#125;<br><span class="hljs-comment">//...</span><br></code></pre></td></tr></table></figure><p>å½“æˆ‘ä»¬å‘å¸ƒ aarï¼Œclean Android å·¥ç¨‹å¹¶é‡æ–°è¿è¡Œä¼šè¿›è¡Œå‚æ•°çš„æ‰“å°ï¼š</p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/6a1404b92feb4ad1b7c00c89964a619c~tplv-k3u1fbpfcp-watermark.image?" alt="202209221611327.png" width="70%" /><h2 id="ä¸‰ã€Android-åµŒå…¥-Flutter-é¡µé¢ï¼ˆFlutterFragmentï¼‰"><a href="#ä¸‰ã€Android-åµŒå…¥-Flutter-é¡µé¢ï¼ˆFlutterFragmentï¼‰" class="headerlink" title="ä¸‰ã€Android åµŒå…¥ Flutter é¡µé¢ï¼ˆFlutterFragmentï¼‰"></a>ä¸‰ã€Android åµŒå…¥ Flutter é¡µé¢ï¼ˆFlutterFragmentï¼‰</h2><p>ç±»æ¯” Android å¯åŠ¨ FlutterActivityï¼Œä¸»è¦æ˜¯é€šè¿‡ä¸¤ç§æ–¹å¼æ„å»º intent å¯¹è±¡ï¼š</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-comment">//æ–¹å¼ä¸€</span><br><span class="hljs-keyword">var</span> intent: Intent = FlutterActivity.createDefaultIntent(<span class="hljs-keyword">this</span>)<br>  <br><span class="hljs-comment">//æ–¹å¼äºŒ</span><br><span class="hljs-keyword">var</span> intent = FlutterActivity<br>  .withCachedEngine(FLUTTER_ENGINE_ID)<br>  .build(<span class="hljs-keyword">this</span>)<br></code></pre></td></tr></table></figure><p>æ„å»º FlutterFragment ç±»ä¼¼ï¼š</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-comment">//æ–¹å¼ä¸€</span><br><span class="hljs-keyword">var</span> flutterFragment: FlutterFragment = FlutterFragment.createDefault()<br>  <br><span class="hljs-comment">//æ–¹å¼äºŒ</span><br><span class="hljs-keyword">var</span> flutterFragment: FlutterFragment = FlutterFragment<br>     .withCachedEngine(FLUTTER_ENGINE_ID)<br>     .build()<br></code></pre></td></tr></table></figure><p>ä¿®æ”¹ Android ä»£ç  ï¼š</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-comment">//1ã€æˆ‘ä»¬æ–°å»ºä¸€ä¸ª SecondActivity</span><br><span class="hljs-comment">//activity_second.xmlå†…å®¹ï¼šFrameLayout ç”¨äºæ‰¿è½½ FlutterFragment</span><br>&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;utf-8&quot;</span>?&gt;<br>&lt;FrameLayout <br>    xmlns:android=<span class="hljs-string">&quot;http://schemas.android.com/apk/res/android&quot;</span><br>    xmlns:tools=<span class="hljs-string">&quot;http://schemas.android.com/tools&quot;</span><br>    android:id=<span class="hljs-string">&quot;@+id/flFragmentContainer&quot;</span><br>    android:layout_width=<span class="hljs-string">&quot;match_parent&quot;</span><br>    android:layout_height=<span class="hljs-string">&quot;match_parent&quot;</span><br>    tools:context=<span class="hljs-string">&quot;.SecondActivity&quot;</span>/&gt;<br>      <br><span class="hljs-comment">//2ã€ä¿®æ”¹ SecondActivity</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SecondActivity</span> : <span class="hljs-title">AppCompatActivity</span>() </span>&#123;<br>    companion object&#123;<br>        <span class="hljs-comment">//ç¼“å­˜ FlutterEngine çš„ key</span><br>        <span class="hljs-keyword">const</span> val FLUTTER_ENGINE_ID = <span class="hljs-string">&quot;default&quot;</span><br>    &#125;<br>    <span class="hljs-comment">//FlutterEngine</span><br>    private lateinit <span class="hljs-keyword">var</span> flutterEngine: FlutterEngine<br>    <span class="hljs-comment">//FlutterFragment</span><br>    private lateinit <span class="hljs-keyword">var</span> flutterFragment: FlutterFragment<br><br>    <span class="hljs-meta">@SuppressLint</span>(<span class="hljs-string">&quot;SetTextI18n&quot;</span>)<br>    override fun onCreate(savedInstanceState: Bundle?) &#123;<br>        <span class="hljs-keyword">super</span>.onCreate(savedInstanceState)<br>        setContentView(R.layout.activity_second)<br>        <span class="hljs-comment">//åˆå§‹åŒ– FlutterEngine</span><br>        flutterEngine = initFlutterEngine(FLUTTER_ENGINE_ID)<br><br>        <span class="hljs-comment">//åˆå§‹åŒ– FlutterFragment</span><br>        flutterFragment = FlutterFragment<br>            .withCachedEngine(FLUTTER_ENGINE_ID)<br>            .build()<br><br>        <span class="hljs-comment">//å°† FlutterFragment åµŒå…¥åˆ° SecondActivity ä¸­</span><br>        supportFragmentManager.beginTransaction().replace(R.id.flFragmentContainer,flutterFragment).commit()<br>    &#125;<br><br>    <span class="hljs-comment"><span class="language-markdown">/<span class="hljs-strong">**</span></span></span><br><span class="hljs-strong"><span class="language-markdown"><span class="hljs-comment">     <span class="hljs-emphasis">* åˆå§‹åŒ– FlutterEngine</span></span></span></span><br><span class="hljs-emphasis"><span class="hljs-strong"><span class="language-markdown"><span class="hljs-comment">     *</span> ä¸Šè¿°ä»£ç ä¸€èˆ¬åœ¨è·³è½¬å‰è°ƒç”¨ï¼Œè¿™æ ·å¯ä»¥åŠ å¿«æˆ‘ä»¬é¡µé¢çš„ä¸€ä¸ªè·³è½¬</span></span></span><br><span class="hljs-strong"><span class="language-markdown"><span class="hljs-comment">     <span class="hljs-emphasis">*/</span></span></span></span><br>    private fun initFlutterEngine(engineId: <span class="hljs-built_in">String</span>): FlutterEngine &#123;<br>        <span class="hljs-comment">//åˆ›å»º FlutterEngine</span><br>        val flutterEngine = FlutterEngine(<span class="hljs-keyword">this</span>)<br>        <span class="hljs-comment">//æŒ‡å®šè¦è·³è½¬çš„ Flutter é¡µé¢å¹¶æºå¸¦å‚æ•°</span><br>        flutterEngine.navigationChannel.setInitialRoute(<span class="hljs-string">&quot;main?&#123;\&quot;name\&quot;:\&quot;erdai\&quot;,\&quot;age\&quot;:18&#125;&quot;</span>)<br>        flutterEngine.dartExecutor.executeDartEntrypoint(DartExecutor.DartEntrypoint.createDefault())<br>        <span class="hljs-comment">//ç¼“å­˜ FlutterEngine</span><br>        val flutterEngineCache = FlutterEngineCache.getInstance()<br>        flutterEngineCache.put(engineId,flutterEngine)<br>        <span class="hljs-keyword">return</span> flutterEngine<br>    &#125;<br><br>    <span class="hljs-comment">//é‡å†™ä¸€äº›æ–¹æ³•ï¼Œç„¶åå°†å…¶è½¬å‘åˆ°äº† FlutterFragment ä¸­</span><br>    override fun onPostResume() &#123;<br>        <span class="hljs-keyword">super</span>.onPostResume()<br>        flutterFragment.onPostResume()<br>    &#125;<br><br>    override fun onNewIntent(intent: Intent) &#123;<br>        <span class="hljs-keyword">super</span>.onNewIntent(intent)<br>        flutterFragment.onNewIntent(intent)<br>    &#125;<br><br>    override fun onBackPressed() &#123;<br>        <span class="hljs-keyword">super</span>.onBackPressed()<br>        flutterFragment.onBackPressed()<br>    &#125;<br><br>    override fun onRequestPermissionsResult(<br>        requestCode: Int,<br>        permissions: Array&lt;out <span class="hljs-built_in">String</span>&gt;,<br>        grantResults: IntArray<br>    ) &#123;<br>        <span class="hljs-keyword">super</span>.onRequestPermissionsResult(requestCode, permissions, grantResults)<br>        flutterFragment.onRequestPermissionsResult(requestCode,permissions,grantResults)<br>    &#125;<br><br>    override fun onUserLeaveHint() &#123;<br>        <span class="hljs-keyword">super</span>.onUserLeaveHint()<br>        flutterFragment.onUserLeaveHint()<br>    &#125;<br><br>    override fun onTrimMemory(level: Int) &#123;<br>        <span class="hljs-keyword">super</span>.onTrimMemory(level)<br>        flutterFragment.onTrimMemory(level)<br>    &#125;<br><br>    override fun onDestroy() &#123;<br>        <span class="hljs-keyword">super</span>.onDestroy()<br>        <span class="hljs-comment">//åœæ­¢ä»£ç æ‰§è¡Œå¹¶é‡Šæ”¾èµ„æº</span><br>        flutterEngine.destroy()<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">//3ã€åœ¨ AndroidManifest æ–‡ä»¶ä¸­è®¾ç½® SecondActivity ä¸»é¢˜</span><br>&lt;activity<br>   android:name=<span class="hljs-string">&quot;.SecondActivity&quot;</span><br>   android:exported=<span class="hljs-string">&quot;false&quot;</span><br>   android:theme=<span class="hljs-string">&quot;@style/Theme.MaterialComponents.DayNight.NoActionBar&quot;</span>/&gt;<br><br><span class="hljs-comment">//4ã€ä¿®æ”¹ MainActivity è·³è½¬æŒ‰é’®è·³è½¬åˆ° SecondActivity</span><br>fun toSecondActivity(view: View) &#123;<br>    startActivity(Intent(<span class="hljs-keyword">this</span>,SecondActivity::<span class="hljs-keyword">class</span>.java))<br>&#125;<br></code></pre></td></tr></table></figure><p>ä¸Šè¿° SecondActivity ä¸­æˆ‘ä»¬é‡å†™äº†å¾ˆå¤šæ–¹æ³•ï¼Œç„¶åå°†å…¶è½¬å‘åˆ°äº† FlutterFragment ä¸­ï¼Œä¸»è¦ç›®çš„æ˜¯ä¸ºäº†å®ç° Flutter ä¸­æ‰€æœ‰é¢„æœŸçš„è¡Œä¸º</p><p>æ¥ä¸‹æ¥çœ‹ä¸‹æ•ˆæœï¼š</p><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/22fcb0303f744a7984f2f2feff10f47a~tplv-k3u1fbpfcp-watermark.image?" alt="ezgif.com-gif-maker2.gif" width="30%" /><h2 id="å››ã€Android-ä¸-Flutter-é€šä¿¡"><a href="#å››ã€Android-ä¸-Flutter-é€šä¿¡" class="headerlink" title="å››ã€Android ä¸ Flutter é€šä¿¡"></a>å››ã€Android ä¸ Flutter é€šä¿¡</h2><p>Flutter æä¾›äº†ä¸€å¥— PlatformChannel æœºåˆ¶ç”¨äº Flutter å’Œ Android çš„é€šä¿¡ï¼Œä¸»è¦åˆ†ä¸ºä¸‰ç§ç±»å‹ï¼š</p><p>1ã€<strong>MethodChannel</strong>ï¼šä¸»è¦ç”¨äºä¼ é€’æ–¹æ³•è°ƒç”¨ï¼ŒFlutter å’Œ Nativeï¼ˆAndroidï¼‰ä¹‹é—´è¿›è¡Œæ–¹æ³•è°ƒç”¨æ—¶å¯ä»¥ä½¿ç”¨ï¼Œæ˜¯ä¸€ç§åŒå‘çš„é€šä¿¡æ–¹å¼</p><p>2ã€<strong>EventChannel</strong>ï¼šä¸»è¦ç”¨äºç”¨æˆ·æ•°æ®æµçš„é€šä¿¡ï¼Œå¦‚ï¼šæ‰‹æœºç”µé‡å˜åŒ–ï¼Œç½‘ç»œè¿æ¥å˜åŒ–ç­‰ã€‚è¿™ç§æ–¹å¼åªèƒ½  Nativeï¼ˆAndroidï¼‰å‘ Flutter å‘é€æ•°æ®ï¼Œæ˜¯ä¸€ç§å•å‘çš„é€šä¿¡æ–¹å¼</p><p>3ã€<strong>BaseicMessageChannel</strong>ï¼šä¸»è¦ç”¨äºä¼ é€’å„ç§ç±»å‹æ•°æ®ï¼Œå®ƒæ”¯æŒçš„ç±»å‹æœ‰å¾ˆå¤šï¼Œå¦‚ï¼šStringï¼ŒåŠç»“æ„åŒ–ä¿¡æ¯ç­‰ï¼Œæ˜¯ä¸€ç§åŒå‘çš„é€šä¿¡æ–¹å¼</p><h3 id="4-1ã€MethodChannel"><a href="#4-1ã€MethodChannel" class="headerlink" title="4.1ã€MethodChannel"></a>4.1ã€MethodChannel</h3><p>ä¸Šé¢æˆ‘ä»¬ä»‹ç»äº† Android ç»™ Flutter é¡µé¢ä¼ å€¼ï¼Œä¸»è¦æ˜¯é€šè¿‡è¿™è¡Œä»£ç ï¼š</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dart">flutterEngine.navigationChannel.setInitialRoute(<span class="hljs-string">&quot;main?&#123;\&quot;name\&quot;:\&quot;erdai\&quot;,\&quot;age\&quot;:18&#125;&quot;</span>)<br></code></pre></td></tr></table></figure><p>ç‚¹å‡»æŸ¥çœ‹ navigationChannel çš„æºç ï¼š</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-comment">//NavigationChannel æºç </span><br>public <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">NavigationChannel</span> </span>&#123;<br>  private <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-built_in">String</span> TAG = <span class="hljs-string">&quot;NavigationChannel&quot;</span>;<br><br>  <span class="hljs-meta">@NonNull</span> public <span class="hljs-keyword">final</span> MethodChannel channel;<br><br>  public NavigationChannel(<span class="hljs-meta">@NonNull</span> DartExecutor dartExecutor) &#123;<br>    <span class="hljs-keyword">this</span>.channel = <span class="hljs-keyword">new</span> MethodChannel(dartExecutor, <span class="hljs-string">&quot;flutter/navigation&quot;</span>, JSONMethodCodec.INSTANCE);<br>    channel.setMethodCallHandler(defaultHandler);<br>  &#125;<br>  <span class="hljs-comment">//...</span><br>&#125;<br></code></pre></td></tr></table></figure><p>å‘ç°å®ƒå®é™…å°±æ˜¯å¯¹ MethodChannel åšäº†ä¸€å±‚å°è£…ï¼Œåº•å±‚æ˜¯é€šè¿‡ MethodChannel æ¥è¿›è¡Œé€šä¿¡</p><p>è¿™ç§æ–¹å¼åœ¨å¼€å‘ä¸­ç”¨çš„æ¯”è¾ƒå¤šï¼Œä½¿ç”¨ä¹Ÿæ¯”è¾ƒç®€å•ï¼Œæˆ‘ä»¬ç›´æ¥é€šè¿‡ä¾‹å­è¯´æ˜</p><p>ä¸‹é¢å®ç°è¿™ä¹ˆä¸€ä¸ªéœ€æ±‚ï¼š<strong>é¦–å…ˆä» MainActivity è·³è½¬åˆ° SecondActivityï¼Œç„¶å SecondActivity æ¯éš”ä¸€ç§’ç»™ Flutter é¡µé¢å‘é€ä¸€ä¸ªæ•°å­—ï¼ŒFlutter æ¥æ”¶åˆ°æ•°å­—å¹¶æ˜¾ç¤ºåˆ°ä¸­é—´çš„ Text ä¸­ï¼Œå½“æ¥æ”¶åˆ°æ•°å­—ç­‰äº 5 ï¼Œé€šçŸ¥ SecondActivty finish</strong></p><p>å…ˆçœ‹ä¸€çœ¼å®ç°çš„æ•ˆæœï¼š</p><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/c5303863bc054b7aac3216a3ce715d50~tplv-k3u1fbpfcp-watermark.image?" alt="ezgif.com-gif-maker (3).gif" width="30%" /><p>1ã€é¦–å…ˆæ¥çœ‹ Android ç«¯ä»£ç å®ç°ï¼ŒSecondActivity æ–°å¢çš„éƒ¨åˆ†ï¼š</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SecondActivity</span> : <span class="hljs-title">AppCompatActivity</span>() </span>&#123;<br>   <br>    <span class="hljs-comment">//...</span><br>    <span class="hljs-comment">//MethodChannel</span><br>    private lateinit <span class="hljs-keyword">var</span> methodChannel: MethodChannel<br>    <span class="hljs-comment">//å‘é€ç»™ Flutter çš„æ•°å­—</span><br>    private <span class="hljs-keyword">var</span> count = <span class="hljs-number">0</span><br><br>    <span class="hljs-meta">@SuppressLint</span>(<span class="hljs-string">&quot;SetTextI18n&quot;</span>)<br>    override fun onCreate(savedInstanceState: Bundle?) &#123;<br>        <span class="hljs-keyword">super</span>.onCreate(savedInstanceState)<br>        setContentView(R.layout.activity_second)<br>        <span class="hljs-comment">//...</span><br><span class="hljs-comment">//MethodChannelåˆå§‹åŒ–ï¼Œæ³¨æ„åé¢çš„å­—ç¬¦ä¸²å¿…é¡»ä¿æŒ Android å’Œ Flutter ä¸€è‡´</span><br>        methodChannel = MethodChannel(flutterEngine.dartExecutor,<span class="hljs-string">&quot;com.dream.interactive&quot;</span>)<br>       <span class="hljs-comment">//è®¾ç½® Flutter ä¼ ç»™æˆ‘ä»¬çš„æ–¹æ³•å›è°ƒ</span><br>        methodChannel.setMethodCallHandler &#123; call, result -&gt;<br>            <span class="hljs-keyword">if</span>(call.method == <span class="hljs-string">&quot;sendFinish&quot;</span>)&#123;<br>                finish()<br>            &#125;<br>        &#125;<br>      <span class="hljs-comment">//å¼€å¯å®šæ—¶å™¨ï¼Œæ¯éš”ä¸€ç§’ç»™ Flutter å‘é€ä¸€ä¸ªæ•°å­—</span><br>        startTimer()<br>    &#125;<br><br>    private fun startTimer() &#123;<br>        Timer().schedule(timerTask &#123;<br>            runOnUiThread &#123;<br>                val map = mapOf(<span class="hljs-string">&quot;count&quot;</span> to count++)<br>                methodChannel.invokeMethod(<span class="hljs-string">&quot;timer&quot;</span>, map)<br>            &#125;<br>        &#125;, <span class="hljs-number">0</span>, <span class="hljs-number">1000</span>)<br>    &#125;<br><br>    <span class="hljs-comment">//...</span><br>&#125;<br></code></pre></td></tr></table></figure><p>2ã€Flutter ç«¯ä»£ç å®ç°ï¼Œæ–°å¢éƒ¨åˆ†ï¼š</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">_MyHomePageState</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">State</span>&lt;<span class="hljs-title">MyHomePage</span>&gt; </span>&#123;<br>  <span class="hljs-comment">//è®°å½•ä¼ é€’è¿‡æ¥çš„æ•°å­—</span><br>  <span class="hljs-built_in">int</span> _counter = <span class="hljs-number">0</span>;<br>  <span class="hljs-comment">//åˆå§‹åŒ– MethodChannelï¼Œå­—ç¬¦ä¸²å¿…é¡»ä¿æŒ Android å’Œ Flutter ä¸€è‡´</span><br>  <span class="hljs-keyword">final</span> _channel = <span class="hljs-keyword">const</span> MethodChannel(<span class="hljs-string">&quot;com.dream.interactive&quot;</span>);<br>  <span class="hljs-comment">//...</span><br><br>  <span class="hljs-meta">@override</span><br>  <span class="hljs-keyword">void</span> initState() &#123;<br>    <span class="hljs-keyword">super</span>.initState();<br>    <span class="hljs-comment">//è®¾ç½®æ¥æ”¶ Android ä¼ é€’è¿‡æ¥çš„æ–¹æ³•å›è°ƒ</span><br>    _channel.setMethodCallHandler((call) <span class="hljs-keyword">async</span> &#123;<br>      <span class="hljs-built_in">String</span> method = call.method;<br>      <span class="hljs-keyword">switch</span>(method)&#123;<br>        <span class="hljs-comment">//å¦‚æœåŒ¹é…åˆ°äº† timer æ–¹æ³•</span><br>        <span class="hljs-keyword">case</span> <span class="hljs-string">&quot;timer&quot;</span>:<br>          <span class="hljs-comment">//æ¥æ”¶ä¼ é€’è¿‡æ¥çš„æ•°å­—å¹¶åˆ·æ–° UI</span><br>          setState(() &#123;<br>            _counter = call.arguments[<span class="hljs-string">&quot;count&quot;</span>];<br>          &#125;);<br>          <span class="hljs-comment">//å½“æ•°å­—ç­‰äº 5ï¼Œé€šçŸ¥ Android finish SecondActivity</span><br>          <span class="hljs-keyword">if</span>(_counter == <span class="hljs-number">5</span>)&#123;<br>            _channel.invokeMethod(<span class="hljs-string">&quot;sendFinish&quot;</span>);<br>            <span class="hljs-keyword">break</span>;<br>          &#125;<br>          <span class="hljs-keyword">break</span>;<br>        <span class="hljs-keyword">default</span>:<br>          <span class="hljs-keyword">break</span>;<br>      &#125;<br>    &#125;);<br>  &#125;<br>  <span class="hljs-comment">//...</span><br>&#125;<br></code></pre></td></tr></table></figure><h3 id="4-2ã€EventChannel"><a href="#4-2ã€EventChannel" class="headerlink" title="4.2ã€EventChannel"></a>4.2ã€EventChannel</h3><p><strong>æˆ‘ä»¬ä½¿ç”¨ EventChannel æ¨¡æ‹Ÿ Android å‘é€ä¸€ä¸ªå……ç”µä¿¡æ¯ç»™ Flutter ï¼ŒFlutter æ¥æ”¶ååœ¨ä¸­é—´çš„ Text å±•ç¤ºå‡ºæ¥</strong></p><p>1ã€ Android ç«¯ä»£ç å®ç°ï¼ŒSecondActivity æ–°å¢çš„éƒ¨åˆ†ï¼š</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SecondActivity</span> : <span class="hljs-title">AppCompatActivity</span>() </span>&#123;<br>   <br>    <span class="hljs-comment"><span class="language-markdown">/<span class="hljs-strong">**</span></span></span><br><span class="hljs-strong"><span class="language-markdown"><span class="hljs-comment">     <span class="hljs-emphasis">* EventChannel äº‹ä»¶æ¥æ”¶å™¨ï¼Œå®ƒæ˜¯ä¸€ä¸ªæ¥å£ï¼Œæˆ‘ä»¬ä¸»è¦é€šè¿‡å®ƒç»™ Flutter ä¼ é€’ event äº‹ä»¶</span></span></span></span><br><span class="hljs-emphasis"><span class="hljs-strong"><span class="language-markdown"><span class="hljs-comment">     *</span>/</span></span></span><br>    private lateinit <span class="hljs-keyword">var</span> eventSink: EventChannel.EventSink<br>    <span class="hljs-comment">//ç”µé‡ä¿¡æ¯</span><br>    private <span class="hljs-keyword">var</span> electricity = <span class="hljs-number">0</span><br><br>    <span class="hljs-meta">@SuppressLint</span>(<span class="hljs-string">&quot;SetTextI18n&quot;</span>)<br>    override fun onCreate(savedInstanceState: Bundle?) &#123;<br>        <span class="hljs-keyword">super</span>.onCreate(savedInstanceState)<br>        setContentView(R.layout.activity_second)<br>          <br>        <span class="hljs-comment">//åˆå§‹åŒ– EventChannelï¼Œæ³¨æ„åé¢çš„å­—ç¬¦ä¸²å¿…é¡»ä¿æŒ Android å’Œ Flutter ä¸€è‡´</span><br>        val eventChannel =  EventChannel(flutterEngine.dartExecutor,<span class="hljs-string">&quot;com.dream.eventchannel&quot;</span>)<br>        <span class="hljs-comment">//è®¾ç½®æ¥æ”¶ Flutter ä¼ é€’è¿‡æ¥çš„æ•°æ®æµå›è°ƒ</span><br>        eventChannel.setStreamHandler(object : EventChannel.StreamHandler &#123;<br>            <span class="hljs-comment">//å½“ Flutter ä¸ Android å»ºç«‹è¿æ¥åä¼šå›è°ƒæ­¤æ–¹æ³•</span><br>            override fun onListen(arguments: Any?, events: EventChannel.EventSink) &#123;<br>              <span class="hljs-comment">//æ‰“å° Flutter ä¼ è¿‡æ¥çš„å‚æ•°ï¼Œå»ºç«‹è¿æ¥æ—¶è¿”å›çš„å€¼ï¼Œä»…æ­¤ä¸€æ¬¡</span><br>                Log.d(<span class="hljs-string">&quot;erdai&quot;</span>, <span class="hljs-string">&quot;onListen: <span class="hljs-subst">$arguments</span>&quot;</span>)<br>                <span class="hljs-comment">//å¯¹ eventSink èµ‹å€¼</span><br>                eventSink = events<br>                <span class="hljs-comment">//å¼€å¯å®šæ—¶å™¨ï¼Œæ¯éš”ä¸€ç§’ç”µé‡å¢åŠ  20%</span><br>                startTimer()<br>            &#125;<br><br>            <span class="hljs-comment">//å½“ Flutter ä¸ Android æ–­å¼€è¿æ¥åä¼šå›è°ƒæ­¤æ–¹æ³•</span><br>            override fun onCancel(arguments: Any?) &#123;<br>                Log.d(<span class="hljs-string">&quot;erdai&quot;</span>, <span class="hljs-string">&quot;onCancel: æ–­å¼€è¿æ¥&quot;</span>)<br>            &#125;<br>        &#125;)<br>    &#125;<br><br>    <span class="hljs-comment">//å¼€å¯å®šæ—¶å™¨ï¼Œæ¯éš”ä¸€ç§’ç”µé‡å¢åŠ  20%</span><br>    private fun startTimer() &#123;<br>        Timer().schedule(timerTask &#123;<br>            runOnUiThread &#123;<br>              <span class="hljs-comment">//æ¯éš”ä¸€ç§’ç”µé‡ +20</span><br>                electricity += <span class="hljs-number">20</span><br>                <span class="hljs-comment">//å‘é€äº‹ä»¶ç»™ Flutter</span><br>                eventSink.success(<span class="hljs-string">&quot;ç”µé‡ï¼š<span class="hljs-subst">$electricity</span>%&quot;</span>)<br>                <span class="hljs-keyword">if</span>(electricity == <span class="hljs-number">100</span>)&#123;<br>                   <span class="hljs-comment">//å½“ç”µé‡ä¸º 100 ï¼Œå‘é€å®Œæˆäº‹ä»¶ç»™ Flutter</span><br>                   eventSink.endOfStream()<br>                &#125;<br>            &#125;<br>        &#125;, <span class="hljs-number">0</span>, <span class="hljs-number">1000</span>)<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>2ã€Flutter ç«¯ä»£ç å®ç°ï¼Œæ–°å¢éƒ¨åˆ†ï¼š</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">_MyHomePageState</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">State</span>&lt;<span class="hljs-title">MyHomePage</span>&gt; </span>&#123;<br>  <span class="hljs-comment">//ç”µé‡ä¿¡æ¯</span><br>  <span class="hljs-built_in">dynamic</span> electricity;<br>  <span class="hljs-comment">//EventChannel æ³¨æ„åé¢çš„å­—ç¬¦ä¸²å¿…é¡»ä¿æŒ Android å’Œ Flutter ä¸€è‡´</span><br>  <span class="hljs-keyword">final</span> _eventChannel = <span class="hljs-keyword">const</span> EventChannel(<span class="hljs-string">&quot;com.dream.eventchannel&quot;</span>);<br>  <span class="hljs-comment">//è®¢é˜…æµä¿¡æ¯</span><br>  StreamSubscription? _streamSubscription;<br>  <br><br>  <span class="hljs-meta">@override</span><br>  <span class="hljs-keyword">void</span> initState() &#123;<br>    <span class="hljs-keyword">super</span>.initState();<br>    <span class="hljs-comment">//åˆå§‹åŒ– StreamSubscription</span><br>    _streamSubscription = _eventChannel<br>        .receiveBroadcastStream([<span class="hljs-string">&quot;Helloï¼Œå»ºç«‹è¿æ¥å§&quot;</span>])<br>        .listen(_onData,onError: _onError,onDone: _onDone);<br>  &#125;<br><br>  <span class="hljs-comment">//æ¥æ”¶ Andorid å‘é€è¿‡æ¥çš„æ­£å¸¸äº‹ä»¶</span><br>  <span class="hljs-keyword">void</span> _onData(event)&#123;<br>    <span class="hljs-comment">//æ‰“å°</span><br>    <span class="hljs-built_in">print</span>(event);<br>    <span class="hljs-comment">//å¯¹ electricity èµ‹å€¼ï¼Œåˆ·æ–° UI</span><br>    setState(() &#123;<br>      electricity = event;<br>    &#125;);<br>  &#125;<br><br>  <span class="hljs-comment">//æ¥æ”¶ Andorid å‘é€è¿‡æ¥çš„ error äº‹ä»¶</span><br>  <span class="hljs-keyword">void</span> _onError(error)&#123;<br>    <span class="hljs-comment">//æ‰“å°</span><br>    <span class="hljs-built_in">print</span>(error);<br>  &#125;<br><br>  <span class="hljs-comment">//æ¥æ”¶ Android å‘é€è¿‡æ¥çš„å®Œæˆäº‹ä»¶</span><br>  <span class="hljs-keyword">void</span> _onDone()&#123;<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;_onDone&#x27;</span>);<br>  &#125;<br><br>  <span class="hljs-comment">//é‡Šæ”¾èµ„æº</span><br>  <span class="hljs-meta">@override</span><br>  <span class="hljs-keyword">void</span> dispose() &#123;<br>    <span class="hljs-keyword">if</span>(_streamSubscription != <span class="hljs-keyword">null</span>)&#123;<br>      _streamSubscription?.cancel();<br>      _streamSubscription = <span class="hljs-keyword">null</span>;<br>    &#125;<br>  &#125;<br><br>  <span class="hljs-meta">@override</span><br>  Widget build(BuildContext context) &#123;<br>    <span class="hljs-keyword">return</span> Scaffold(<br>      <span class="hljs-comment">//...</span><br>      body: Center(<br>        child: Column(<br>          mainAxisAlignment: MainAxisAlignment.center,<br>          children: &lt;Widget&gt;[<br>            <span class="hljs-comment">//...</span><br>            Text(<br>              <span class="hljs-string">&#x27;<span class="hljs-subst">$electricity</span>&#x27;</span>,<br>              style: Theme.of(context).textTheme.headline4,<br>            ),<br>          ],<br>        ),<br>      ),<br>      <span class="hljs-comment">//..</span><br>    );<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥æˆ‘ä»¬çœ‹ä¸‹æ•ˆæœå’Œ Log æ—¥å¿—ï¼š</p><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/5ea43f0988ec478a873e01c11d347917~tplv-k3u1fbpfcp-watermark.image?" alt="ezgif.com-gif-maker (4).gif" width="30%" /><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/2d49e854843e46c7bd7ad58a846b21f5~tplv-k3u1fbpfcp-watermark.image?" alt="202209221613607.png" width="70%" /><h3 id="4-3ã€BaseicMessageChannel"><a href="#4-3ã€BaseicMessageChannel" class="headerlink" title="4.3ã€BaseicMessageChannel"></a>4.3ã€BaseicMessageChannel</h3><p><strong>æˆ‘ä»¬ä½¿ç”¨ BaseicMessageChannel å®ç°ä¸€æ®µ Andorid å’Œ Flutter çš„å¯¹è¯ï¼ŒFlutter æ”¶åˆ° Android çš„æ¶ˆæ¯ï¼Œåœ¨ä¸­é—´çš„ Text å±•ç¤ºå‡ºæ¥ï¼ŒAndroid æ”¶åˆ° Flutter çš„æ¶ˆæ¯ï¼Œä½¿ç”¨ Toast å±•ç¤ºå‡ºæ¥</strong> </p><p>1ã€ Android ç«¯ä»£ç å®ç°ï¼ŒSecondActivity æ–°å¢çš„éƒ¨åˆ†ï¼š</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SecondActivity</span> : <span class="hljs-title">AppCompatActivity</span>() </span>&#123;<br>    <span class="hljs-comment">//...</span><br>    <span class="hljs-comment">//BasicMessageChannel</span><br>    private lateinit <span class="hljs-keyword">var</span> messageChannel: BasicMessageChannel&lt;<span class="hljs-built_in">String</span>&gt;<br>  <br>    <span class="hljs-meta">@SuppressLint</span>(<span class="hljs-string">&quot;SetTextI18n&quot;</span>)<br>    override fun onCreate(savedInstanceState: Bundle?) &#123;<br>        <span class="hljs-keyword">super</span>.onCreate(savedInstanceState)<br>        setContentView(R.layout.activity_second)<br>      <span class="hljs-comment">//...</span><br><br><span class="hljs-comment">//åˆå§‹åŒ– BasicMessageChannelï¼Œæ³¨æ„åé¢çš„å­—ç¬¦ä¸²å¿…é¡»ä¿æŒ Android å’Œ Flutter ä¸€è‡´</span><br>        messageChannel = <br>          BasicMessageChannel(flutterEngine.dartExecutor,<span class="hljs-string">&quot;com.dream.messagechannel&quot;</span>,StringCodec.INSTANCE)<br>        <span class="hljs-comment">//è®¾ç½®æ¥æ”¶ Flutter ä¼ é€’è¿‡æ¥çš„æ¶ˆæ¯å›è°ƒ</span><br>        messageChannel.setMessageHandler &#123; replay: <span class="hljs-built_in">String?</span>, reply: BasicMessageChannel.Reply&lt;<span class="hljs-built_in">String</span>&gt; -&gt;<br>            <span class="hljs-comment">//æ‰“å° Flutter å‘è¿‡æ¥çš„æ¶ˆæ¯</span><br>            Log.d(<span class="hljs-string">&quot;erdai&quot;</span>, <span class="hljs-string">&quot;onCreate: <span class="hljs-subst">$replay</span>&quot;</span>)<br>            <span class="hljs-comment">//ä½¿ç”¨ Toast å±•ç¤ºå‡ºæ¥</span><br>            Toast.makeText(<span class="hljs-keyword">this</span>,replay,Toast.LENGTH_SHORT).<span class="hljs-keyword">show</span>()<br>            <span class="hljs-comment">//å›ä¼ æ¶ˆæ¯ç»™ Flutter</span><br>            reply.reply(<span class="hljs-string">&quot;æ¢§æ¡å±±&quot;</span>)<br>        &#125;<br>      <br>      <span class="hljs-comment">//å‘é€æ¶ˆæ¯ç»™ Flutter</span><br>        messageChannel.send(<span class="hljs-string">&quot;å‘¨æœ«å»çˆ¬å±±å—?&quot;</span>) &#123; replay: <span class="hljs-built_in">String?</span> -&gt;<br>            <span class="hljs-comment">//æ¥æ”¶ Flutter å›ä¼ çš„æ¶ˆæ¯</span><br>            <span class="hljs-comment">//æ‰“å° Flutter å›ä¼ çš„æ¶ˆæ¯</span><br>            Log.d(<span class="hljs-string">&quot;erdai&quot;</span>, <span class="hljs-string">&quot;onCreate: <span class="hljs-subst">$replay</span>&quot;</span>)<br>            <span class="hljs-comment">//ä½¿ç”¨ Toast å±•ç¤ºå‡ºæ¥</span><br>            Toast.makeText(<span class="hljs-keyword">this</span>,replay,Toast.LENGTH_SHORT).<span class="hljs-keyword">show</span>()<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-comment">//...</span><br>&#125;<br></code></pre></td></tr></table></figure><p>2ã€Flutter ç«¯ä»£ç å®ç°ï¼Œæ–°å¢éƒ¨åˆ†ï¼š</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">_MyHomePageState</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">State</span>&lt;<span class="hljs-title">MyHomePage</span>&gt; </span>&#123;<br> <br>  <span class="hljs-comment">//è®°å½• Android ä¼ è¿‡æ¥çš„å€¼</span><br>  <span class="hljs-built_in">dynamic</span> _content;<br>  <span class="hljs-comment">//BasicMessageChannelï¼Œæ³¨æ„åé¢çš„å­—ç¬¦ä¸²å¿…é¡»ä¿æŒ Android å’Œ Flutter ä¸€è‡´</span><br>  <span class="hljs-keyword">final</span> _messageChannel = <span class="hljs-keyword">const</span> BasicMessageChannel(<span class="hljs-string">&quot;com.dream.messagechannel&quot;</span>, StringCodec());<br><br>  <span class="hljs-meta">@override</span><br>  <span class="hljs-keyword">void</span> initState() &#123;<br>    <span class="hljs-keyword">super</span>.initState();<br>    <span class="hljs-comment">//è®¾ç½®æ¥æ”¶ Android ä¼ é€’è¿‡æ¥çš„æ¶ˆæ¯å›è°ƒ</span><br>    _messageChannel.setMessageHandler((message) =&gt;Future&lt;<span class="hljs-built_in">String</span>&gt;(()&#123;<br>      <span class="hljs-comment">//æ‰“å° Android å‘é€è¿‡æ¥çš„æ¶ˆæ¯</span><br>      <span class="hljs-built_in">print</span>(message);<br>      <span class="hljs-comment">//ç»™ _content èµ‹å€¼ï¼Œåˆ·æ–° UI</span><br>      setState(() &#123;<br>        _content = message;<br>      &#125;);<br>      <span class="hljs-comment">//å›ä¼ å€¼ç»™ Android</span><br>      <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;å¥½å•Š&quot;</span>;<br>    &#125;));<br>    <br>    <span class="hljs-comment">//...</span><br>  &#125;<br>  <br>  <span class="hljs-comment">//ç‚¹å‡» FloatingActionButton çš„å“åº”æ–¹æ³•</span><br>  <span class="hljs-keyword">void</span> _incrementCounter() <span class="hljs-keyword">async</span>&#123;<br>    <span class="hljs-comment">//ç»™ Android å‘é€æ¶ˆæ¯ï¼Œå¹¶æ¥æ”¶ Android å›ä¼ çš„æ¶ˆæ¯</span><br>    <span class="hljs-keyword">var</span> result = <span class="hljs-keyword">await</span> _messageChannel.send(<span class="hljs-string">&quot;å»çˆ¬å“ªåº§å±±?&quot;</span>);<br>    <span class="hljs-comment">//æ‰“å° Android å›ä¼ çš„æ¶ˆæ¯</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;<span class="hljs-subst">$result</span>&quot;</span>);<br>    <span class="hljs-comment">//ç»™ _content èµ‹å€¼ï¼Œåˆ·æ–° UI</span><br>    setState(() &#123;<br>      _content = result;<br>    &#125;);<br>  &#125;<br><br>  <span class="hljs-meta">@override</span><br>  Widget build(BuildContext context) &#123;<br>    <span class="hljs-keyword">return</span> Scaffold(<br>      appBar: AppBar(<br>        title: Text(widget.title),<br>      ),<br>      body: Center(<br>        child: Column(<br>          mainAxisAlignment: MainAxisAlignment.center,<br>          children: &lt;Widget&gt;[<br>            <span class="hljs-comment">//...</span><br>            Text(<br>              <span class="hljs-string">&#x27;<span class="hljs-subst">$_content</span>&#x27;</span>,<br>              style: Theme.of(context).textTheme.headline4,<br>            ),<br>          ],<br>        ),<br>      ),<br>      floatingActionButton: FloatingActionButton(<br>        onPressed: _incrementCounter,<br>        tooltip: <span class="hljs-string">&#x27;Increment&#x27;</span>,<br>        child: <span class="hljs-keyword">const</span> Icon(Icons.add),<br>      ), <br>    );<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>çœ‹ä¸‹æ•ˆæœå’Œ Log æ—¥å¿—ï¼š</p><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/7da4428000554b0eac543f1530a0c3c2~tplv-k3u1fbpfcp-watermark.image?" alt="ezgif.com-gif-maker (5).gif" width="30%" /><p><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/d749ee7774ba41518b615972d6ac7004~tplv-k3u1fbpfcp-watermark.image" alt="202209221614000.png"></p><h3 id="4-4ã€é€šä¿¡åŸç†"><a href="#4-4ã€é€šä¿¡åŸç†" class="headerlink" title="4.4ã€é€šä¿¡åŸç†"></a>4.4ã€é€šä¿¡åŸç†</h3><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/b581ad4490034520b24e1940f3311118~tplv-k3u1fbpfcp-watermark.image?" alt="202209221615654.png" width="100%" /><p>ä»å›¾ä¸­æˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼š</p><p>1ã€Android å’Œ Flutter éƒ½æ˜¯ä»¥ ByteBuffer ä¸ºè½½ä½“ï¼Œç„¶åé€šè¿‡ BinaryMessenger æ¥å‘é€å’Œæ¥æ”¶æ•°æ®</p><p>2ã€Android å’Œ Flutter éƒ½æ˜¯åŸºäº PlatformChannel æœºåˆ¶æ¥è¿›è¡Œé€šä¿¡çš„</p><p>ä¹‹æ‰€ä»¥æˆ‘ä»¬èƒ½å¤Ÿå¦‚æ­¤ç®€å•çš„è¿›è¡Œé€šä¿¡ï¼Œå®åˆ™æ˜¯ç³»ç»Ÿç»™æˆ‘ä»¬åšäº†å¤§é‡çš„å°è£…ï¼šçº¿ç¨‹çš„åˆ‡æ¢ï¼Œæ•°æ®æ‹·è´ç­‰å¤æ‚æ“ä½œ</p><p>å¦å¤–éœ€è¦æ³¨æ„çš„æ˜¯ï¼š<strong>åœ¨ Android ä¾§ï¼ŒBinaryMessenger æ˜¯ä¸€ä¸ªæ¥å£ï¼Œåœ¨ FlutterView ä¸­å®ç°äº†è¯¥æ¥å£ï¼Œåœ¨ BinaryMessenger çš„æ–¹æ³•ä¸­é€šè¿‡ JNI æ¥ä¸ç³»ç»Ÿåº•å±‚æ²Ÿé€šã€‚åœ¨ Flutter ä¾§ï¼ŒBinaryMessenger æ˜¯ä¸€ä¸ªç±»ï¼Œè¯¥ç±»çš„ä½œç”¨å°±æ˜¯ä¸ç±» window æ²Ÿé€šï¼Œè€Œç±» window æ‰çœŸæ­£ä¸ç³»ç»Ÿåº•å±‚æ²Ÿé€š</strong></p><h2 id="äº”ã€æ€»ç»“"><a href="#äº”ã€æ€»ç»“" class="headerlink" title="äº”ã€æ€»ç»“"></a>äº”ã€æ€»ç»“</h2><p>æœ¬ç¯‡æ–‡ç« æˆ‘ä»¬ä»‹ç»äº†ï¼š</p><p>1ã€Android é›†æˆ Flutter </p><blockquote><p>ä¸»è¦å°±æ˜¯å°† Flutter ç«¯çš„ä»£ç æ‰“æˆ aar ï¼Œç„¶å Android å¼•ç”¨è¿™ä¸ª aar</p></blockquote><p>2ã€Android è°ƒèµ· Flutter é¡µé¢ï¼ˆFlutterActivityï¼ŒFlutterFragmentï¼‰ï¼Œå¹¶ç»™ Flutter é¡µé¢ä¼ å€¼</p><blockquote><p>ä¼ å€¼åº•å±‚ä½¿ç”¨çš„ MethodChannel</p></blockquote><p>3ã€Android ä¸ Flutter é€šä¿¡ï¼Œä¸»è¦ä½¿ç”¨åˆ°äº† Flutter çš„ PlatformChannel æœºåˆ¶ï¼Œå…¶å®ç°ä¸»è¦æœ‰ä¸‰ç§ç±»å‹ï¼š</p><blockquote><p>1ã€MethodChannelï¼šç”¨äº Flutter å’Œ Android ä¹‹é—´çš„æ–¹æ³•é€šä¿¡ï¼ŒåŒå‘çš„</p><p>2ã€EventChannelï¼šç”¨äº Flutter å’Œ Android ä¹‹é—´çš„æ•°æ®æµé€šä¿¡ï¼Œå•å‘çš„ï¼šAndroid -&gt; Flutter</p><p>3ã€BaseicMessageChannelï¼šç”¨äº Flutter å’Œ Android ä¹‹é—´çš„æ•°æ®é€šä¿¡ï¼ŒåŒå‘çš„</p></blockquote><p>4ã€ç®€å•çš„ä»‹ç»äº† Android ä¸ Flutter é€šä¿¡çš„åŸç†</p><p>å¥½äº†ï¼Œæœ¬ç¯‡æ–‡ç« åˆ°è¿™é‡Œå°±ç»“æŸäº†ï¼Œå¸Œæœ›èƒ½ç»™ä½ å¸¦æ¥å¸®åŠ© ğŸ¤</p><p><strong>æ„Ÿè°¢ä½ é˜…è¯»è¿™ç¯‡æ–‡ç« </strong></p><h3 id="ä¸‹ç¯‡é¢„å‘Š"><a href="#ä¸‹ç¯‡é¢„å‘Š" class="headerlink" title="ä¸‹ç¯‡é¢„å‘Š"></a>ä¸‹ç¯‡é¢„å‘Š</h3><p>ä¸‹ç¯‡æ–‡ç« æˆ‘ä¼šè®²å¼€å‘ Flutter é¡¹ç›®çš„ä¸€ä¸ªæŠ€æœ¯é€‰å‹ï¼Œå°½è¯·æœŸå¾…å§ğŸº</p><h3 id="å‚è€ƒå’Œæ¨è"><a href="#å‚è€ƒå’Œæ¨è" class="headerlink" title="å‚è€ƒå’Œæ¨è"></a>å‚è€ƒå’Œæ¨è</h3><p><a href="https://juejin.cn/post/7054743801520193543">Android é›†æˆ Flutter | ä¸äº¤äº’</a></p><p><a href="https://juejin.cn/post/6844903873358856200#heading-7">ä¸€ç¯‡çœ‹æ‡‚Androidä¸Flutterä¹‹é—´çš„é€šä¿¡</a></p><blockquote><p><strong>ä½ çš„ç‚¹èµï¼Œè¯„è®ºï¼Œæ˜¯å¯¹æˆ‘å·¨å¤§çš„é¼“åŠ±ï¼</strong></p><p>æ¬¢è¿å…³æ³¨æˆ‘çš„<strong>å…¬ä¼—å·ï¼š</strong>  <a href="http://m6z.cn/6jwi7b"><strong>sweetying</strong></a> ï¼Œæ–‡ç« æ›´æ–°å¯ç¬¬ä¸€æ—¶é—´æ”¶åˆ°</p><p>å¦‚æœ<strong>æœ‰é—®é¢˜</strong>ï¼Œå…¬ä¼—å·å†…æœ‰åŠ æˆ‘å¾®ä¿¡çš„å…¥å£ï¼Œåœ¨æŠ€æœ¯å­¦ä¹ ã€ä¸ªäººæˆé•¿çš„é“è·¯ä¸Šï¼Œæˆ‘ä»¬ä¸€èµ·å‰è¿›ï¼</p></blockquote>]]></content>
    
    
    <categories>
      
      <category>Flutter</category>
      
    </categories>
    
    
    <tags>
      
      <tag>åŸåˆ›</tag>
      
      <tag>Flutter</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Flutter ç³»åˆ—ï¼ˆä¸ƒï¼‰ï¼šFlutter è·¯ç”±å’Œ HTTPS è¯·æ±‚å®æˆ˜</title>
    <link href="/2022/10/10/Flutter%20%E7%B3%BB%E5%88%97%EF%BC%88%E4%B8%83%EF%BC%89%EF%BC%9AFlutter%20%E8%B7%AF%E7%94%B1%E5%92%8C%20HTTPS%20%E8%AF%B7%E6%B1%82%E5%AE%9E%E6%88%98/"/>
    <url>/2022/10/10/Flutter%20%E7%B3%BB%E5%88%97%EF%BC%88%E4%B8%83%EF%BC%89%EF%BC%9AFlutter%20%E8%B7%AF%E7%94%B1%E5%92%8C%20HTTPS%20%E8%AF%B7%E6%B1%82%E5%AE%9E%E6%88%98/</url>
    
    <content type="html"><![CDATA[<p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/62ffd4977786447e8174026b2f58ccd3~tplv-k3u1fbpfcp-watermark.image"></p><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>å¾ˆé«˜å…´é‡è§ä½ ~</p><p>åœ¨æœ¬ç³»åˆ—çš„ä¸Šä¸€ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬ä»‹ç»äº† Flutter ä¸­å¸¸ç”¨çš„è¡¨å• Widgetï¼šTextFieldï¼ŒCheckBoxï¼ŒRadioï¼ŒSwitchï¼ŒCheckboxListTileï¼ŒRadioListTileï¼ŒSwitchListTileï¼ŒSliderï¼Œæœ€åé€šè¿‡è¿™äº› Widget å®ç°äº†ä¸€ä¸ªç»¼åˆæ¡ˆä¾‹ã€‚è¿˜æ²¡æœ‰çœ‹è¿‡ä¸Šä¸€ç¯‡æ–‡ç« çš„æœ‹å‹ï¼Œå»ºè®®å…ˆå»é˜…è¯» <a href="https://juejin.cn/post/7137457377959706654">Flutter ç³»åˆ—ï¼ˆå…­ï¼‰ï¼šFlutter å¸¸ç”¨è¡¨å• Widget</a>ã€‚æ¥ä¸‹æ¥æˆ‘ä»¬å¯¹ Flutter è·¯ç”±å’Œ HTTPS è¯·æ±‚å®æˆ˜è¿›è¡Œä»‹ç»</p><h2 id="ä¸€ã€Flutter-è·¯ç”±"><a href="#ä¸€ã€Flutter-è·¯ç”±" class="headerlink" title="ä¸€ã€Flutter è·¯ç”±"></a>ä¸€ã€Flutter è·¯ç”±</h2><p>1ï¼‰ã€Flutter ä¸­çš„è·¯ç”±ç®€å•ç†è§£å°±æ˜¯é¡µé¢è·³è½¬ã€‚Flutter é€šè¿‡ Navigator ç»„ä»¶ç®¡ç†è·¯ç”±å¯¼èˆªï¼Œå¹¶æä¾›äº†ç®¡ç†å †æ ˆçš„æ–¹æ³•ã€‚å¦‚ï¼šNavigator.pushï¼ŒNavigator.pop</p><p>2ï¼‰ã€Flutter ç»™æˆ‘ä»¬æä¾›äº†ä¸¤ç§é…ç½®è·¯ç”±è·³è½¬çš„æ–¹å¼ï¼š</p><blockquote><p>1ã€åŸºæœ¬è·¯ç”±</p><p>2ã€å‘½åè·¯ç”±</p></blockquote><h3 id="1-1ã€åŸºæœ¬è·¯ç”±"><a href="#1-1ã€åŸºæœ¬è·¯ç”±" class="headerlink" title="1.1ã€åŸºæœ¬è·¯ç”±"></a>1.1ã€åŸºæœ¬è·¯ç”±</h3><h4 id="1-1-1ã€åŸºæœ¬è·¯ç”±ä½¿ç”¨"><a href="#1-1-1ã€åŸºæœ¬è·¯ç”±ä½¿ç”¨" class="headerlink" title="1.1.1ã€åŸºæœ¬è·¯ç”±ä½¿ç”¨"></a>1.1.1ã€åŸºæœ¬è·¯ç”±ä½¿ç”¨</h4><p>å‡è®¾æˆ‘ä»¬æœ‰ä¸¤ä¸ªé¡µé¢ï¼šHomePage.dartï¼ŒSearchPage.dartï¼Œå…ˆçœ‹ä¸€çœ¼å®ƒä»¬åˆå§‹çš„ä¸€ä¸ªä»£ç ï¼š</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-comment">//1ã€HomePage.dart</span><br><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;package:flutter/material.dart&#x27;</span>;<br><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;package:flutterapplication/route/Routes.dart&#x27;</span>;<br><br><span class="hljs-keyword">void</span> main() &#123;<br>  runApp(MaterialApp(<br>      home: HomePage()<br>  ));<br>&#125;<br><br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">HomePage</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">StatelessWidget</span> </span>&#123;<br>  <span class="hljs-meta">@override</span><br>  Widget build(BuildContext context) &#123;<br>    <span class="hljs-keyword">return</span> Scaffold(<br>      appBar: AppBar(<br>        title: Text(<span class="hljs-string">&quot;HomePage&quot;</span>), <span class="hljs-comment">//è®¾ç½®æ ‡é¢˜æ æ ‡é¢˜</span><br>      ),<br>      body: Center(<br>        child: RaisedButton(<br>          child: Text(<span class="hljs-string">&quot;è·³è½¬åˆ° SearchPage&quot;</span>),<br>          <span class="hljs-comment">//æŒ‰é’®ç‚¹å‡»äº‹ä»¶</span><br>          onPressed: () &#123;<br>            <br>          &#125;,<br>        ),<br>      ), <br>    );<br>  &#125;<br>&#125;<br><br><br><span class="hljs-comment">//2ã€SearchPage.dart</span><br><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;package:flutter/material.dart&#x27;</span>;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SearchPage</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">StatelessWidget</span></span>&#123;<br><br>  <span class="hljs-keyword">final</span> arguments;<br><br>  <span class="hljs-comment">//å¯é€‰å‚æ•° arguments</span><br>  SearchPage(&#123;<span class="hljs-keyword">this</span>.arguments&#125;);<br><br>  <span class="hljs-meta">@override</span><br>  Widget build(BuildContext context) &#123;<br>    <span class="hljs-keyword">return</span> Scaffold(<br>        appBar: AppBar(<br>            title: <span class="hljs-keyword">const</span> Text(<span class="hljs-string">&#x27;SearchPage&#x27;</span>)<br>        ),<br>        body: Center(<br>          child: Text(<span class="hljs-string">&quot;æœç´¢é¡µé¢å†…å®¹åŒºåŸŸï¼š<span class="hljs-subst">$arguments</span>&quot;</span>),<br>        )<br>    );<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ä¸Šè¿°ä»£ç å¾ˆç®€å•ï¼Œç°åœ¨æˆ‘ä»¬æƒ³ä» HomePage è·³è½¬åˆ° SearchPageï¼Œéœ€è¦ä»¥ä¸‹ä¸¤æ­¥ï¼š</p><p>1ã€åœ¨ HomePage.dart ä¸­å¼•å…¥ SearchPage.dart </p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-comment">//1ã€ç»å¯¹è·¯å¾„</span><br><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;package:flutterapplication/pages/SearchPage.dart&#x27;</span>;<br><span class="hljs-comment">//2ã€ç›¸å¯¹è·¯å¾„</span><br><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;../SearchPage.dart&#x27;</span>;<br></code></pre></td></tr></table></figure><p><strong>Tips</strong>ï¼šæ—¥å¸¸å¼€å‘ä¸­å»ºè®®ç»Ÿä¸€ä½¿ç”¨ç»å¯¹è·¯å¾„</p><p>2ã€åœ¨ HomePage çš„ç‚¹å‡»äº‹ä»¶ä¸­é€šè¿‡å¦‚ä¸‹æ–¹æ³•è·³è½¬</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-comment">//æ–¹å¼ä¸€</span><br>Navigator.push(context, MaterialPageRoute(builder: (context)&#123;<br>  <span class="hljs-keyword">return</span> SearchPage();<br>&#125;));<br><br><span class="hljs-comment">//æ–¹å¼äºŒ</span><br>Navigator.of(context).push(<br>  MaterialPageRoute(builder: (context)&#123;<br>    <span class="hljs-keyword">return</span> SearchPage();<br>  &#125;)<br>);<br><br><span class="hljs-comment">//ä¸Šè¿°ä¸¤ç§æ–¹å¼æ˜¯ç­‰ä»·çš„ï¼Œå®é™…ä¸Šæ–¹å¼ä¸€æ˜¯å¯¹æ–¹å¼äºŒçš„å°è£…</span><br></code></pre></td></tr></table></figure><p>ç»è¿‡ä¸Šé¢ä¸¤æ­¥æˆ‘ä»¬å°±å¯ä»¥è·³è½¬åˆ° SearchPage é¡µé¢äº†</p><p>æ­¤æ—¶è¿˜åªæ˜¯ç®€å•çš„è·³è½¬ï¼Œå¦‚æœæˆ‘æƒ³å‘ SearchPage ä¼ å€¼å‘¢ï¼Ÿ</p><h4 id="1-1-2ã€åŸºæœ¬è·¯ç”±ä¼ å€¼"><a href="#1-1-2ã€åŸºæœ¬è·¯ç”±ä¼ å€¼" class="headerlink" title="1.1.2ã€åŸºæœ¬è·¯ç”±ä¼ å€¼"></a>1.1.2ã€åŸºæœ¬è·¯ç”±ä¼ å€¼</h4><p>å®åˆ™å°±æ˜¯åœ¨ SearchPage çš„æ„é€ æ–¹æ³•ä¸­å¢åŠ å®å‚</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs dart">Navigator.of(context).push(<br>  MaterialPageRoute(builder: (context)&#123;<br>    <span class="hljs-keyword">return</span> SearchPage(arguments: <span class="hljs-string">&quot;erdai666&quot;</span>);<br>  &#125;)<br>);<br></code></pre></td></tr></table></figure><p>è¿™ç§åŸºæœ¬è·¯ç”±çš„ä½¿ç”¨æœ‰ä¸€ä¸ªç¼ºç‚¹ï¼š<strong>ä¸èƒ½è¿›è¡Œè·¯ç”±çš„ç»Ÿä¸€ç®¡ç†</strong>ã€‚å¦‚æœæˆ‘ä»¬æƒ³æŠŠè·¯ç”±ç»Ÿä¸€ç®¡ç†ï¼Œå°±éœ€è¦ä½¿ç”¨åˆ°å‘½åè·¯ç”±</p><h3 id="1-2ã€å‘½åè·¯ç”±"><a href="#1-2ã€å‘½åè·¯ç”±" class="headerlink" title="1.2ã€å‘½åè·¯ç”±"></a>1.2ã€å‘½åè·¯ç”±</h3><h4 id="1-2-1ã€å‘½åè·¯ç”±ä½¿ç”¨"><a href="#1-2-1ã€å‘½åè·¯ç”±ä½¿ç”¨" class="headerlink" title="1.2.1ã€å‘½åè·¯ç”±ä½¿ç”¨"></a>1.2.1ã€å‘½åè·¯ç”±ä½¿ç”¨</h4><p>å‘½åè·¯ç”±å°±æ˜¯ç»™æ¯ä¸ªé¡µé¢è®¾ç½®ä¸€ä¸ªå­—ç¬¦ä¸²åˆ«åï¼Œé€šå¸¸æ˜¯ä»¥ &#x2F; å¼€å¤´ï¼Œå¦‚ï¼šâ€&#x2F;searchPageâ€ã€‚è¿˜æ˜¯ä»¥ 1.1.1 çš„ä¾‹å­è¿›è¡Œä¸¾ä¾‹ï¼š</p><p>1ã€æ­¤æ—¶æˆ‘ä»¬å¯ä»¥æ–°å»ºä¸€ä¸ª .dart æ–‡ä»¶è¿›è¡Œè·¯ç”±çš„ç»Ÿä¸€ç®¡ç†ï¼Œæˆ‘è¿™é‡Œå« Routes.dart ï¼š</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-built_in">String</span> homePage = <span class="hljs-string">&quot;/&quot;</span>;<br><span class="hljs-built_in">String</span> searchPage = <span class="hljs-string">&quot;/searchPage&quot;</span>;<br><br><span class="hljs-keyword">final</span> routes = &#123;<br>  homePage: (context) =&gt; HomePage(),<br>  searchPage: (context) =&gt; SearchPage()<br>&#125;;<br><br><span class="hljs-comment">//ä¸‹é¢è¿™æ®µä»£ç æ˜¯å°†ä¸€ä¸ªåŒ¿åæ–¹æ³•èµ‹å€¼ç»™ä¸€ä¸ªå˜é‡</span><br><span class="hljs-comment">//åŒ¿åæ–¹æ³•åšçš„äº‹æƒ…ï¼šå¤„ç†è·¯ç”±ä¼ å‚ï¼Œç”Ÿæˆ MaterialPageRoute è·¯ç”±å¯¹è±¡</span><br><span class="hljs-keyword">var</span> onGenerateRoute = (settings) &#123;<br>  <span class="hljs-built_in">Function?</span> pageContentBuilder = routes[settings.name];<br>  <span class="hljs-keyword">if</span> (pageContentBuilder != <span class="hljs-keyword">null</span>) &#123;<br>    <span class="hljs-keyword">if</span> (settings.arguments != <span class="hljs-keyword">null</span>) &#123;<br>      <span class="hljs-keyword">var</span> route = MaterialPageRoute(<br>          builder: (context) =&gt;<br>              pageContentBuilder(context, arguments: settings.arguments));<br>      <span class="hljs-keyword">return</span> route;<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>      <span class="hljs-keyword">var</span> route =<br>      MaterialPageRoute(builder: (context) =&gt; pageContentBuilder(context));<br>      <span class="hljs-keyword">return</span> route;<br>    &#125;<br>  &#125;<br>&#125;;<br></code></pre></td></tr></table></figure><p><strong>Tips</strong>ï¼šé€šå¸¸æˆ‘ä»¬ä¼šä»¥ â€˜&#x2F;â€˜ è¡¨ç¤º App å¯åŠ¨é¡µçš„è·¯ç”±</p><p>2ã€åœ¨ HomePage.dart ä¸­æ–°å¢å¦‚ä¸‹é…ç½®ï¼š</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-comment">//å¯¼åŒ…</span><br><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;package:flutterapplication/route/Routes.dart&#x27;</span>;<br><br><span class="hljs-keyword">void</span> main() &#123;<br>  runApp(MaterialApp(<br>      <span class="hljs-comment">//app å¯åŠ¨è·¯ç”±é¡µé¢</span><br>      initialRoute: homePage,<br>      <span class="hljs-comment">//è·¯ç”±ç”Ÿæˆ</span><br>      onGenerateRoute: onGenerateRoute,<br>      <span class="hljs-comment">//...</span><br>  ));<br>&#125;<br></code></pre></td></tr></table></figure><p>3ã€åœ¨ HomePage çš„ç‚¹å‡»äº‹ä»¶ä¸­é€šè¿‡å¦‚ä¸‹æ–¹æ³•è·³è½¬</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-comment">//æ–¹å¼ä¸€</span><br>Navigator.pushNamed(context, searchPage);<br><br><span class="hljs-comment">//æ–¹å¼äºŒ</span><br>Navigator.of(context).pushNamed(searchPage);<br><br><span class="hljs-comment">//ä¸Šè¿°ä¸¤ç§æ–¹å¼æ˜¯ç­‰ä»·çš„ï¼Œå®é™…ä¸Šæ–¹å¼ä¸€æ˜¯å¯¹æ–¹å¼äºŒçš„å°è£…</span><br></code></pre></td></tr></table></figure><p>è¿™é‡Œæˆ‘ä»¬å¯ä»¥å‘ç°ä¸€ä¸ªè§„å¾‹ï¼š<strong>Navigator æä¾›äº†ä¸¤ç§ Api è°ƒç”¨æ–¹å¼ï¼š<code>Navigator.api...</code> å’Œ <code>Navigator.of(context).api...</code>ï¼Œå‰è€…æ˜¯åè€…çš„ä¸€ä¸ªå°è£…</strong>ï¼Œåé¢æˆ‘ä»¬éƒ½ä»¥å‰è€…ä¸¾ä¾‹</p><h4 id="1-2-2ã€å‘½åè·¯ç”±ä¼ å€¼"><a href="#1-2-2ã€å‘½åè·¯ç”±ä¼ å€¼" class="headerlink" title="1.2.2ã€å‘½åè·¯ç”±ä¼ å€¼"></a>1.2.2ã€å‘½åè·¯ç”±ä¼ å€¼</h4><p>å®åˆ™å°±æ˜¯ç»™ SearchPage çš„æ„é€ æ–¹æ³•ä¼ å…¥å®å‚ï¼š</p><p>1ã€ä¿®æ”¹  Routes.dart ä¸­çš„è·¯ç”±è·³æŠ“</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-comment">//...</span><br><span class="hljs-keyword">final</span> routes = &#123;<br>  <span class="hljs-comment">//æ”¹åŠ¨ç‚¹ï¼šæ–°å¢ arguments å‘½åå‚æ•°ä¼ ç»™ SearchPage</span><br>  searchPage: (context,&#123;arguments&#125;) =&gt; SearchPage(arguments: arguments)<br>&#125;;<br></code></pre></td></tr></table></figure><p>2ã€ä¿®æ”¹ HomePage çš„ç‚¹å‡»äº‹ä»¶è·³è½¬æ–¹æ³•</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dart">Navigator.pushNamed(context, searchPage,arguments: <span class="hljs-string">&quot;erdai666&quot;</span>);<br></code></pre></td></tr></table></figure><p>æ•ˆæœå±•ç¤ºï¼š</p><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/5b1faa83a0564f1484c55168cdd74ae6~tplv-k3u1fbpfcp-watermark.image?" alt="ezgif.com-gif-maker.gif" width="30%" /><h3 id="1-3ã€è¿”å›ä¸Šä¸€çº§"><a href="#1-3ã€è¿”å›ä¸Šä¸€çº§" class="headerlink" title="1.3ã€è¿”å›ä¸Šä¸€çº§"></a>1.3ã€è¿”å›ä¸Šä¸€çº§</h3><p>ä¸Šè¿°æ•ˆæœå›¾ä¸­ï¼ŒSearchPage å·¦ä¸Šè§’ç™½è‰²çš„è¿”å›æŒ‰é’®æ˜¯ç³»ç»Ÿç»™æˆ‘ä»¬å®ç°çš„ï¼Œå¦‚æœæˆ‘ä»¬éœ€è¦è‡ªå·±å®ç°è¿”å›ä¸Šä¸€çº§çš„æ•ˆæœï¼Œä½¿ç”¨å¦‚ä¸‹ Api å³å¯ï¼š</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dart">Navigator.pop(context);<br></code></pre></td></tr></table></figure><p>ä¸‹é¢æˆ‘ä»¬ç»™ SearchPage ä¸­é—´çš„å†…å®¹åŒºåŸŸæ·»åŠ ç‚¹å‡»äº‹ä»¶ï¼Œè®©å®ƒè¿”å›ä¸Šä¸€çº§ï¼Œä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;package:flutter/material.dart&#x27;</span>;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SearchPage</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">StatelessWidget</span></span>&#123;<br><br>  <span class="hljs-keyword">final</span> arguments;<br><br>  SearchPage(&#123;<span class="hljs-keyword">this</span>.arguments&#125;);<br><br>  <span class="hljs-meta">@override</span><br>  Widget build(BuildContext context) &#123;<br>    <span class="hljs-keyword">return</span> Scaffold(<br>        appBar: AppBar(<br>            title: <span class="hljs-keyword">const</span> Text(<span class="hljs-string">&#x27;SearchPage&#x27;</span>)<br>        ),<br>        body: Center(<br>          <span class="hljs-comment">//æ–°å¢éƒ¨åˆ†çš„ä»£ç </span><br>          child: InkWell(<br>            child: Text(<span class="hljs-string">&quot;æœç´¢é¡µé¢å†…å®¹åŒºåŸŸï¼š<span class="hljs-subst">$arguments</span>&quot;</span>),<br>            onTap: ()&#123;<br>              Navigator.pop(context);<br>            &#125;,<br>          ),<br>        )<br>    );<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ä¸Šè¿°ä»£ç æˆ‘ä»¬ä½¿ç”¨åˆ°äº† InkWell Widgetï¼Œå®ƒçš„ä½œç”¨æ˜¯ç»™æ²¡æœ‰ç‚¹å‡»äº‹ä»¶çš„ Widget æ·»åŠ ç‚¹å‡»äº‹ä»¶ï¼Œçœ‹æ•ˆæœï¼š</p><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/e7b86175f8c846238ea6a1b18c0b8d3b~tplv-k3u1fbpfcp-watermark.image?" alt="ezgif.com-gif-maker (1).gif" width="30%" /><h3 id="1-4ã€æ›¿æ¢è·¯ç”±"><a href="#1-4ã€æ›¿æ¢è·¯ç”±" class="headerlink" title="1.4ã€æ›¿æ¢è·¯ç”±"></a>1.4ã€æ›¿æ¢è·¯ç”±</h3><p>1ï¼‰ã€å’Œ Android ä¸­å…ˆå¯åŠ¨ä¸€ä¸ª Activity ç„¶å finish ä¸Šä¸ª Activity ç±»ä¼¼ã€‚æ›¿æ¢è·¯ç”±å°±æ˜¯å¯åŠ¨ä¸€ä¸ªæ–°é¡µé¢ï¼Œç„¶åå°†æ–°é¡µé¢æ›¿æ¢ä¸Šä¸€ä¸ªé¡µé¢</p><p>2ï¼‰ã€æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <code>Navigator.pushReplacementNamed</code> è¿›è¡Œè·¯ç”±çš„æ›¿æ¢</p><p>æ¥ä¸‹æ¥æˆ‘ä»¬ç¼–å†™ä¸€ä¸ª LoginPage.dart çš„ç™»é™†é¡µï¼Œç„¶åä½¿ç”¨ LoginPage æ›¿æ¢ SearchPageï¼Œæ­¥éª¤å¦‚ä¸‹ï¼š</p><p>1ã€LoginPage ç¼–å†™</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;package:flutter/material.dart&#x27;</span>;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">LoginPage</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">StatelessWidget</span></span>&#123;<br><br>  <span class="hljs-meta">@override</span><br>  Widget build(BuildContext context) &#123;<br>    <span class="hljs-keyword">return</span> Scaffold(<br>        appBar: AppBar(<br>            title: <span class="hljs-keyword">const</span> Text(<span class="hljs-string">&#x27;LoginPage&#x27;</span>)<br>        ),<br>        body: <span class="hljs-keyword">const</span> Center(<br>          child: Text(<span class="hljs-string">&quot;å»æ³¨å†Œ&quot;</span>),<br>        )<br>    );<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>2ã€åœ¨ Routes.dart ä¸­æ–°å¢è·¯ç”±ä¿¡æ¯</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;package:flutterapplication/pages/LoginPage.dart&#x27;</span>;<br><br><span class="hljs-comment">//...</span><br><span class="hljs-built_in">String</span> loginPage = <span class="hljs-string">&quot;/loginPage&quot;</span>;<br><br><span class="hljs-keyword">final</span> routes = &#123;<br>  <span class="hljs-comment">//...</span><br>  loginPage: (context) =&gt; LoginPage()<br>&#125;;<br></code></pre></td></tr></table></figure><p>3ã€ä¿®æ”¹ SearchPage çš„ç‚¹å‡»äº‹ä»¶è·³è½¬æ–¹æ³•</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-comment">//...</span><br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SearchPage</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">StatelessWidget</span></span>&#123;<br><br>  <span class="hljs-keyword">final</span> arguments;<br><br>  SearchPage(&#123;<span class="hljs-keyword">this</span>.arguments&#125;);<br><br>  <span class="hljs-meta">@override</span><br>  Widget build(BuildContext context) &#123;<br>    <span class="hljs-keyword">return</span> Scaffold(<br>        appBar: AppBar(<br>            title: <span class="hljs-keyword">const</span> Text(<span class="hljs-string">&#x27;SearchPage&#x27;</span>)<br>        ),<br>        body: Center(<br>          child: InkWell(<br>            child: Text(<span class="hljs-string">&quot;æœç´¢é¡µé¢å†…å®¹åŒºåŸŸï¼š<span class="hljs-subst">$arguments</span>&quot;</span>),<br>            onTap: ()&#123;<br>              <span class="hljs-comment">//è·¯ç”±æ›¿æ¢</span><br>              Navigator.pushReplacementNamed(context,loginPage);<br>            &#125;,<br>          ),<br>        )<br>    );<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>4ã€æ•ˆæœå±•ç¤º</p><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/da99b98353d949b08570cb1c0b3443ea~tplv-k3u1fbpfcp-watermark.image?" alt="ezgif.com-gif-maker (2).gif" width="30%" /><p>æ•ˆæœå›¾ä¸­æˆ‘ä»¬ç‚¹å‡» LoginPage çš„è¿”å›æŒ‰é’®è¿”å›åˆ°äº† HomePage ï¼Œè¯æ˜ SearchPage è¢«æ›¿æ¢</p><h3 id="1-5ã€è¿”å›åˆ°æ ¹è·¯ç”±"><a href="#1-5ã€è¿”å›åˆ°æ ¹è·¯ç”±" class="headerlink" title="1.5ã€è¿”å›åˆ°æ ¹è·¯ç”±"></a>1.5ã€è¿”å›åˆ°æ ¹è·¯ç”±</h3><p>1ï¼‰ã€å’Œ Android ä¸­å¯åŠ¨ä¸€ä¸ª Activityï¼Œç„¶åå°†è¿™ä¸ª Activity ä¹‹ä¸Šçš„æ‰€æœ‰ Activity å¼¹å‡ºæ ˆç±»ä¼¼ã€‚è¿”å›æ ¹è·¯ç”±å°±æ˜¯å°†å½“å‰é¡µé¢ä¹‹ä¸Šçš„é¡µé¢å…¨éƒ¨ç§»é™¤æ‰</p><p>2ï¼‰ã€æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <code>Navigator.pushAndRemoveUtil</code> è¿”å›æ ¹è·¯ç”±</p><p>æ¥ä¸‹æ¥æˆ‘ä»¬ç¼–å†™ä¸€ä¸ª RegisterPage.dart çš„æ³¨å†Œé¡µï¼Œç„¶å Hompage -&gt; SearchPage -&gt; LoginPage -&gt; RegisterPage éƒ½ä½¿ç”¨ <code>Navigator.pushNamed</code> æ–¹å¼è·³è½¬ï¼ŒRegisterPage -&gt; Hompage ä½¿ç”¨ <code>Navigator.pushAndRemoveUtil</code> æ–¹å¼è·³è½¬ï¼Œæ­¥éª¤å¦‚ä¸‹ï¼š</p><p>1ã€LoginPage ç¼–å†™</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;package:flutter/material.dart&#x27;</span>;<br><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;package:flutterapplication/HomePage.dart&#x27;</span>;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Registerpage</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">StatelessWidget</span></span>&#123;<br><br>  <span class="hljs-meta">@override</span><br>  Widget build(BuildContext context) &#123;<br>    <span class="hljs-keyword">return</span> Scaffold(<br>        appBar: AppBar(<br>            title: <span class="hljs-keyword">const</span> Text(<span class="hljs-string">&#x27;RegisterPage&#x27;</span>)<br>        ),<br>        body:  Center(<br>          child: InkWell(<br>            child: <span class="hljs-keyword">const</span> Text(<span class="hljs-string">&quot;æ³¨å†ŒæˆåŠŸï¼Œå» HomePage&quot;</span>),<br>            onTap: ()&#123;<br>              <span class="hljs-comment">//é€šè¿‡è¿”å›æ ¹è·¯ç”±è·³è½¬åˆ° HomePage </span><br>              Navigator.pushAndRemoveUntil(<br>                  context,<br>                  MaterialPageRoute(builder: (context)&#123;<br>                    <span class="hljs-keyword">return</span> HomePage();<br>                  &#125;),<br>                  (route) =&gt; <span class="hljs-keyword">false</span>);<br>            &#125;,<br>          ),<br>        )<br>    );<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>2ã€åœ¨ Routes.dart ä¸­æ–°å¢è·¯ç”±ä¿¡æ¯</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;package:flutterapplication/pages/RegisterPage.dart&#x27;</span>;<br><br><span class="hljs-comment">//...</span><br><span class="hljs-built_in">String</span> registerPage = <span class="hljs-string">&quot;/registerPage&quot;</span>;<br><br><span class="hljs-keyword">final</span> routes = &#123;<br>  <span class="hljs-comment">//...</span><br>  registerPage: (context) =&gt; RegisterPage()<br>&#125;;<br></code></pre></td></tr></table></figure><p>3ã€ä¿®æ”¹ Hompageï¼ŒSearchPageï¼ŒLoginPage çš„è·³è½¬æ–¹å¼ä¸º <code>Navigator.pushNamed</code></p><p>4ã€æ•ˆæœå±•ç¤º</p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/e2c6bf6ff3eb4510bbd21d66cd4af71f~tplv-k3u1fbpfcp-watermark.image?" alt="ezgif.com-gif-maker (3).gif" width="30%" /><p>å¯ä»¥çœ‹åˆ°ï¼Œå½“æˆ‘ä»¬ä» RegisterPage åˆ° HomePageï¼Œç„¶ååœ¨è¿”å›ï¼Œç›´æ¥é€€åˆ°äº†æ¡Œé¢ï¼Œè¯æ˜å…¶å®ƒé¡µé¢éƒ½è¢«ç§»é™¤äº†</p><h2 id="äºŒã€HTTPS-è¯·æ±‚å®æˆ˜"><a href="#äºŒã€HTTPS-è¯·æ±‚å®æˆ˜" class="headerlink" title="äºŒã€HTTPS è¯·æ±‚å®æˆ˜"></a>äºŒã€HTTPS è¯·æ±‚å®æˆ˜</h2><p>Flutter ä¸­å‘èµ·ç½‘ç»œè¯·æ±‚è¿˜æ˜¯æ¯”è¾ƒç®€å•çš„ï¼Œæˆ‘ä»¬å¼•å…¥ä¸€ä¸ªç¬¬ä¸‰æ–¹åº“ï¼š</p><blockquote><p> http </p><p> é“¾æ¥ï¼š<a href="https://pub.dev/packages/http">https://pub.dev/packages/http</a></p></blockquote><p>è¿™é‡Œéœ€è¦å¤§å®¶æŒæ¡ Dart å¼‚æ­¥ç¼–ç¨‹åŸºç¡€ï¼Œè¿˜ä¸æ˜ç™½çš„çœ‹æˆ‘<a href="https://juejin.cn/post/7130647339294785549#heading-80">Flutter ç³»åˆ—ï¼ˆäºŒï¼‰ï¼šDart è¯­æ³•ç­‘åŸº</a>è¿™ç¯‡æ–‡ç« </p><p>åœ¨é¡¹ç›®çš„ pubspec.yaml é…ç½®æ–‡ä»¶æ·»åŠ å¦‚ä¸‹ä¾èµ–ï¼š</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs dart">dependencies:<br>  http: ^<span class="hljs-number">0.13</span><span class="hljs-number">.5</span><br></code></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥å°±å¯ä»¥ä½¿ç”¨äº†ï¼Œç®€å•çš„ä»‹ç»ä¸‹ getï¼Œpost è¯·æ±‚ï¼Œè¿™é‡Œç‰¹åˆ«æ„Ÿè°¢ <a href="https://www.wanandroid.com/">WanAndroid</a> æä¾›çš„ Api</p><h3 id="2-1ã€get-è¯·æ±‚"><a href="#2-1ã€get-è¯·æ±‚" class="headerlink" title="2.1ã€get è¯·æ±‚"></a>2.1ã€get è¯·æ±‚</h3><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-comment">//å¯¼å…¥ http å¹¶è®¾ç½®åˆ«å</span><br><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;package:http/http.dart&#x27;</span> <span class="hljs-keyword">as</span> http;<br><br><span class="hljs-comment">//ä½¿ç”¨ async æ ‡è®°ä¸ºå¼‚æ­¥</span><br><span class="hljs-keyword">void</span> _getData() <span class="hljs-keyword">async</span>&#123;<br>  <span class="hljs-comment">//æ„å»ºè¯·æ±‚ uri</span><br>  <span class="hljs-keyword">var</span> uri = <span class="hljs-built_in">Uri</span>.https(<span class="hljs-string">&quot;www.wanandroid.com&quot;</span>, <span class="hljs-string">&quot;/friend/json&quot;</span>);<br>  <span class="hljs-comment">//ä½¿ç”¨ http å‘èµ· get è¯·æ±‚ï¼Œç­‰å¾…è¿”å›ç»“æœè¿›è¡Œåç»­ä»£ç æ‰§è¡Œ</span><br>  <span class="hljs-keyword">var</span> result = <span class="hljs-keyword">await</span> http.<span class="hljs-keyword">get</span>(uri);<br>  <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;====&gt; <span class="hljs-subst">$&#123;result.statusCode&#125;</span>&quot;</span>);<br>&#125;<br><br><span class="hljs-keyword">void</span> main()&#123;<br>  _getData();<br>&#125;<br><br><span class="hljs-comment">//æ‰“å°ç»“æœ</span><br>====&gt; <span class="hljs-number">200</span><br></code></pre></td></tr></table></figure><h3 id="2-2ã€post-è¯·æ±‚"><a href="#2-2ã€post-è¯·æ±‚" class="headerlink" title="2.2ã€post è¯·æ±‚"></a>2.2ã€post è¯·æ±‚</h3><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-comment">//json è½¬æ¢</span><br><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;dart:convert&#x27;</span>;<br><span class="hljs-comment">//å¯¼å…¥ http å¹¶è®¾ç½®åˆ«å</span><br><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;package:http/http.dart&#x27;</span> <span class="hljs-keyword">as</span> http;<br><br><br><span class="hljs-comment">//ä½¿ç”¨ async æ ‡è®°ä¸ºå¼‚æ­¥</span><br><span class="hljs-keyword">void</span> _postData() <span class="hljs-keyword">async</span>&#123;<br>  <span class="hljs-comment">//æ„å»ºè¯·æ±‚ uri</span><br>  <span class="hljs-keyword">var</span> uri = <span class="hljs-built_in">Uri</span>.https(<span class="hljs-string">&quot;www.wanandroid.com&quot;</span>, <span class="hljs-string">&quot;/user/login&quot;</span>);<br>  <span class="hljs-comment">//ä½¿ç”¨ http å‘èµ· post è¯·æ±‚ï¼Œç­‰å¾…è¿”å›ç»“æœè¿›è¡Œåç»­ä»£ç æ‰§è¡Œ</span><br>  <span class="hljs-keyword">var</span> result = <span class="hljs-keyword">await</span> http.post(uri,body: &#123;<span class="hljs-string">&quot;username&quot;</span>:<span class="hljs-string">&quot;è´¦å·&quot;</span>,<span class="hljs-string">&quot;password&quot;</span>:<span class="hljs-string">&quot;å¯†ç &quot;</span>&#125;);<br>  <span class="hljs-keyword">if</span> (result.statusCode == <span class="hljs-number">200</span>) &#123;<br>    <span class="hljs-comment">//å°† json è§£ææˆ map</span><br>    <span class="hljs-keyword">var</span> resultMap = json.decode(result.body) <span class="hljs-keyword">as</span> <span class="hljs-built_in">Map</span>&lt;<span class="hljs-built_in">String</span>,<span class="hljs-built_in">dynamic</span>&gt;;<br>    <span class="hljs-comment">//æ‰“å° map é‡Œé¢çš„å±æ€§</span><br>    <span class="hljs-built_in">print</span>(resultMap[<span class="hljs-string">&quot;data&quot;</span>][<span class="hljs-string">&quot;nickname&quot;</span>]);<br>  &#125;<br>&#125;<br><br><br><span class="hljs-keyword">void</span> main()&#123;<br>  _postData();<br>&#125;<br><br><span class="hljs-comment">//æ‰“å°ç»“æœ</span><br>sweetying<br></code></pre></td></tr></table></figure><h3 id="2-3ã€è¯·æ±‚æ¡ˆä¾‹å®æˆ˜"><a href="#2-3ã€è¯·æ±‚æ¡ˆä¾‹å®æˆ˜" class="headerlink" title="2.3ã€è¯·æ±‚æ¡ˆä¾‹å®æˆ˜"></a>2.3ã€è¯·æ±‚æ¡ˆä¾‹å®æˆ˜</h3><p>é¦–å…ˆçœ‹ä¸€çœ¼æˆ‘ä»¬è¦å®ç°çš„æ•ˆæœï¼š</p><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/45f74a89d3914ba7bfb01a74833891ec~tplv-k3u1fbpfcp-watermark.image?" alt="ezgif.com-gif-maker (4).gif" width="30%" /><p>å®é™…ä¸Šå°±æ˜¯å°†æˆ‘ä»¬è¯·æ±‚çš„ç½‘ç»œæ•°æ®ä½¿ç”¨ ListView å±•ç¤ºå‡ºæ¥ï¼Œæ¯”è¾ƒç®€å•ï¼Œå¤§å®¶ä¸»è¦æŒæ¡æ€è·¯ï¼Œç›´æ¥ä¸Šä»£ç ï¼š</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-comment">//å¯¼åŒ…</span><br><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;dart:convert&#x27;</span>;<br><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;package:flutter/material.dart&#x27;</span>;<br><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;package:http/http.dart&#x27;</span> <span class="hljs-keyword">as</span> http;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">HttpPracticePage</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">StatefulWidget</span> </span>&#123;<br>  <span class="hljs-meta">@override</span><br>  _HttpPracticePageState createState() =&gt; _HttpPracticePageState();<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">_HttpPracticePageState</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">State</span>&lt;<span class="hljs-title">HttpPracticePage</span>&gt; </span>&#123;<br>  <span class="hljs-keyword">var</span> list = [];<br><br>  <span class="hljs-meta">@override</span><br>  <span class="hljs-keyword">void</span> initState() &#123;<br>    <span class="hljs-keyword">super</span>.initState();<br>    <span class="hljs-comment">//åŠ è½½ç½‘ç»œæ•°æ®</span><br>    _getData();<br>  &#125;<br><br>  <span class="hljs-meta">@override</span><br>  Widget build(BuildContext context) &#123;<br>    <span class="hljs-keyword">return</span> MaterialApp(<br>      home: Scaffold(<br>          appBar: AppBar(<br>            title: Text(<span class="hljs-string">&#x27;Http å®è·µé¡µé¢&#x27;</span>),<br>          ),<br>          <span class="hljs-comment">//å¦‚æœ list ä¸ºç©ºï¼Œå±•ç¤ºä¸ºç©ºç™½é¡µé¢ï¼Œä¸ä¸ºç©ºæ¸²æŸ“ ListView</span><br>          body: list.isNotEmpty<br>              ? ListView.builder(<br>              itemCount: list.length,<br>              itemBuilder: (context, index) &#123;<br>                  <span class="hljs-keyword">return</span> ListTile(<br>                      title: Text(<span class="hljs-string">&quot;<span class="hljs-subst">$&#123;list[index][<span class="hljs-string">&quot;name&quot;</span>]&#125;</span>&quot;</span>),<br>                      subtitle: Text(<span class="hljs-string">&quot;<span class="hljs-subst">$&#123;list[index][<span class="hljs-string">&quot;link&quot;</span>]&#125;</span>&quot;</span>));<br>                &#125;)<br>              : Text(<span class="hljs-string">&quot;&quot;</span>)),<br>    );<br>  &#125;<br><br>  <span class="hljs-comment">//ä½¿ç”¨ async æ ‡è®°ä¸ºå¼‚æ­¥</span><br>  <span class="hljs-keyword">void</span> _getData() <span class="hljs-keyword">async</span> &#123;<br>    <span class="hljs-comment">//æ„å»ºè¯·æ±‚ uri</span><br>    <span class="hljs-keyword">var</span> uri = <span class="hljs-built_in">Uri</span>.https(<span class="hljs-string">&quot;www.wanandroid.com&quot;</span>, <span class="hljs-string">&quot;/friend/json&quot;</span>);<br>    <span class="hljs-comment">//ä½¿ç”¨ http å‘èµ· get è¯·æ±‚ï¼Œç­‰å¾…è¿”å›ç»“æœè¿›è¡Œåç»­ä»£ç æ‰§è¡Œ</span><br>    <span class="hljs-keyword">var</span> result = <span class="hljs-keyword">await</span> http.<span class="hljs-keyword">get</span>(uri);<br>    <span class="hljs-keyword">if</span> (result.statusCode == <span class="hljs-number">200</span>) &#123;<br>      <span class="hljs-comment">//å°† json è§£ææˆ map</span><br>      <span class="hljs-keyword">var</span> map = json.decode(result.body) <span class="hljs-keyword">as</span> <span class="hljs-built_in">Map</span>&lt;<span class="hljs-built_in">String</span>, <span class="hljs-built_in">dynamic</span>&gt;;<br>      <span class="hljs-comment">//é€šçŸ¥ UI è¿›è¡Œåˆ·æ–°</span><br>      setState(() &#123;<br>        list = map[<span class="hljs-string">&quot;data&quot;</span>];<br>      &#125;);<br>    &#125;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="ä¸‰ã€æ€»ç»“"><a href="#ä¸‰ã€æ€»ç»“" class="headerlink" title="ä¸‰ã€æ€»ç»“"></a>ä¸‰ã€æ€»ç»“</h2><p>æœ¬ç¯‡æ–‡ç« æˆ‘ä»¬ä»‹ç»äº†ï¼š</p><p>1ã€Flutter ä¸­çš„è·¯ç”±ä½¿ç”¨ï¼Œå¤§å®¶å¯ä»¥æ ¹æ®ä¸åŒçš„ä¸šåŠ¡åœºæ™¯ä½¿ç”¨ä¸åŒçš„ Api</p><p>2ã€æ¨èä½¿ç”¨è·¯ç”±ç»Ÿä¸€ç®¡ç†ä»¥åŠå¯¼åŒ…çš„æ—¶å€™ä½¿ç”¨ç»å¯¹è·¯å¾„</p><p>3ã€ç®€å•çš„ä»‹ç»äº†ä½¿ç”¨ç¬¬ä¸‰æ–¹åº“ http è¿›è¡Œ getï¼Œpost è¯·æ±‚ï¼Œæœ€åè¿›è¡Œäº†ä¸€ä¸ªè¯·æ±‚æ¡ˆä¾‹çš„å®æˆ˜</p><p>å¥½äº†ï¼Œæœ¬ç¯‡æ–‡ç« åˆ°è¿™é‡Œå°±ç»“æŸäº†ï¼Œå¸Œæœ›èƒ½ç»™ä½ å¸¦æ¥å¸®åŠ© ğŸ¤</p><p><strong>æ„Ÿè°¢ä½ é˜…è¯»è¿™ç¯‡æ–‡ç« </strong></p><h3 id="ä¸‹ç¯‡é¢„å‘Š"><a href="#ä¸‹ç¯‡é¢„å‘Š" class="headerlink" title="ä¸‹ç¯‡é¢„å‘Š"></a>ä¸‹ç¯‡é¢„å‘Š</h3><p>ä¸‹ç¯‡æ–‡ç« æˆ‘ä¼šè®² Flutter ä¸ Android çš„é€šä¿¡ï¼Œå°½è¯·æœŸå¾…å§ğŸº</p><h3 id="å‚è€ƒå’Œæ¨è"><a href="#å‚è€ƒå’Œæ¨è" class="headerlink" title="å‚è€ƒå’Œæ¨è"></a>å‚è€ƒå’Œæ¨è</h3><p><a href="https://www.bilibili.com/video/BV1S4411E7LY?p=19&vd_source=d0b24cb21c438ff4a9ac2e589eacb3d9">Flutter æ•™ç¨‹</a>ï¼šé€šä¿—æ˜“æ‡‚çš„ Flutter å…¥é—¨æ•™ç¨‹</p><blockquote><p><strong>ä½ çš„ç‚¹èµï¼Œè¯„è®ºï¼Œæ˜¯å¯¹æˆ‘å·¨å¤§çš„é¼“åŠ±ï¼</strong></p><p>æ¬¢è¿å…³æ³¨æˆ‘çš„<strong>å…¬ä¼—å·ï¼š</strong>  <a href="http://m6z.cn/6jwi7b"><strong>sweetying</strong></a> ï¼Œæ–‡ç« æ›´æ–°å¯ç¬¬ä¸€æ—¶é—´æ”¶åˆ°</p><p>å¦‚æœ<strong>æœ‰é—®é¢˜</strong>ï¼Œå…¬ä¼—å·å†…æœ‰åŠ æˆ‘å¾®ä¿¡çš„å…¥å£ï¼Œåœ¨æŠ€æœ¯å­¦ä¹ ã€ä¸ªäººæˆé•¿çš„é“è·¯ä¸Šï¼Œæˆ‘ä»¬ä¸€èµ·å‰è¿›ï¼</p></blockquote>]]></content>
    
    
    <categories>
      
      <category>Flutter</category>
      
    </categories>
    
    
    <tags>
      
      <tag>åŸåˆ›</tag>
      
      <tag>Flutter</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Flutter ç³»åˆ—ï¼ˆå…­ï¼‰ï¼šFlutter å¸¸ç”¨è¡¨å• Widget</title>
    <link href="/2022/10/10/Flutter%20%E7%B3%BB%E5%88%97%EF%BC%88%E5%85%AD%EF%BC%89%EF%BC%9AFlutter%20%E5%B8%B8%E7%94%A8%E8%A1%A8%E5%8D%95%20Widget/"/>
    <url>/2022/10/10/Flutter%20%E7%B3%BB%E5%88%97%EF%BC%88%E5%85%AD%EF%BC%89%EF%BC%9AFlutter%20%E5%B8%B8%E7%94%A8%E8%A1%A8%E5%8D%95%20Widget/</url>
    
    <content type="html"><![CDATA[<p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/313ea59d82f249428468c5c9186f69d0~tplv-k3u1fbpfcp-watermark.image"></p><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>å¾ˆé«˜å…´é‡è§ä½ ~</p><p>åœ¨æœ¬ç³»åˆ—çš„ä¸Šä¸€ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬ä»‹ç»äº† Flutter ä¸­å¸¸ç”¨çš„æŒ‰é’® Widgetï¼ŒFlutter 1.x å’Œ Flutter 2.x æŒ‰é’®çš„å˜åŒ–ï¼Œæœ€åé€šè¿‡ Flutter 1.x ç›¸å…³ Button + BottomNavigationBar + FloatingActionButton å®ç°äº†ä¸€ä¸ªç»¼åˆæ¡ˆä¾‹ã€‚è¿˜æ²¡æœ‰çœ‹è¿‡ä¸Šä¸€ç¯‡æ–‡ç« çš„æœ‹å‹ï¼Œå»ºè®®å…ˆå»é˜…è¯» <a href="https://juejin.cn/post/7137082885571346463">Flutter ç³»åˆ—ï¼ˆäº”ï¼‰ï¼šFlutter å¸¸ç”¨æŒ‰é’® Widget</a>ã€‚æ¥ä¸‹æ¥æˆ‘ä»¬å¯¹ Flutter è¡¨å• Widget è¿›è¡Œå­¦ä¹ </p><p>Flutter ä¸­å¸¸è§çš„è¡¨å•æœ‰ï¼šTextFieldï¼ŒCheckBoxï¼ŒRadioï¼ŒSwitchï¼ŒCheckboxListTileï¼ŒRadioListTileï¼ŒSwitchListTileï¼ŒSlider ç­‰ï¼Œä¸‹é¢å°±ä»‹ç»ä¸€ä¸‹è¿™äº›å¸¸ç”¨çš„ Widget</p><h2 id="ä¸€ã€Flutter-å¸¸ç”¨è¡¨å•-Widget-ä»‹ç»"><a href="#ä¸€ã€Flutter-å¸¸ç”¨è¡¨å•-Widget-ä»‹ç»" class="headerlink" title="ä¸€ã€Flutter å¸¸ç”¨è¡¨å• Widget ä»‹ç»"></a>ä¸€ã€Flutter å¸¸ç”¨è¡¨å• Widget ä»‹ç»</h2><h3 id="1-1ã€TextFiled-æ–‡æœ¬æ¡†"><a href="#1-1ã€TextFiled-æ–‡æœ¬æ¡†" class="headerlink" title="1.1ã€TextFiled æ–‡æœ¬æ¡†"></a>1.1ã€TextFiled æ–‡æœ¬æ¡†</h3><p>TextFiled æ˜¯ Flutter ç»™æˆ‘ä»¬æä¾›çš„æ–‡æœ¬æ¡† Widgetï¼Œå…¶å¸¸ç”¨çš„å±æ€§æœ‰ï¼š</p><table><thead><tr><th>å±æ€§åç§°</th><th>å±æ€§ç±»å‹</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>maxLines</td><td>int</td><td>è®¾ç½®æ­¤å‚æ•°å¯ä»¥æŠŠæ–‡æœ¬æ¡†æ”¹ä¸ºå¤šè¡Œæ–‡æœ¬æ¡†</td></tr><tr><td>onChanged</td><td>ValueChanged<String></td><td>æ–‡æœ¬æ¡†æ”¹å˜æ—¶è§¦å‘çš„äº‹ä»¶</td></tr><tr><td>decoratioin</td><td>InputDecoration</td><td>è£…é¥°ï¼ŒInputDecoration å¸¸ç”¨å±æ€§ï¼š<br>hintTextï¼šé»˜è®¤æç¤ºæ–‡æ¡ˆ<br>borderï¼šæ–‡æœ¬æ¡†è¾¹æ¡†ï¼Œé…åˆ OutlineInputBorder ä½¿ç”¨<br>labelTextï¼šlabel çš„åç§°<br>labelStyleï¼šé…ç½® label çš„æ ·å¼</td></tr><tr><td>obscureText</td><td>bool</td><td>æ˜¯å¦æŠŠæ–‡æœ¬æ¡†æ”¹ä¸ºå¯†ç æ¡†</td></tr><tr><td>controller</td><td>TextEditingController</td><td>é…ç½®æ–‡æœ¬æ¡†é»˜è®¤æ˜¾ç¤ºçš„å†…å®¹</td></tr></tbody></table><p>è¿è¡Œä¸‹é¢ä»£ç ï¼š</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;package:flutter/material.dart&#x27;</span>;<br><br><span class="hljs-keyword">void</span> main() &#123;<br>  runApp(MaterialApp(<br>    home: Scaffold(<br>      appBar: AppBar(<br>        title: Text(<span class="hljs-string">&quot;Flutter Form Practice&quot;</span>), <span class="hljs-comment">//è®¾ç½®æ ‡é¢˜æ æ ‡é¢˜</span><br>      ),<br>      body: MyBodyPage(), <span class="hljs-comment">//è‡ªå®šä¹‰ body Wdiget</span><br>    )<br>  ));<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyBodyPage</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">StatelessWidget</span></span>&#123;<br><br>  <span class="hljs-meta">@override</span><br>  Widget build(BuildContext context) &#123;<br>    <span class="hljs-keyword">return</span> Padding(<br>      padding: EdgeInsets.all(<span class="hljs-number">20</span>),<br>      child: Column(<br>        children: [<br>          TextField( <span class="hljs-comment">//è´¦å·è¾“å…¥æ¡†</span><br>            maxLines: <span class="hljs-number">1</span>, <span class="hljs-comment">//æœ€å¤§æ˜¾ç¤ºä¸€è¡Œ</span><br>            decoration: InputDecoration(<br>                hintText: <span class="hljs-string">&quot;please input account&quot;</span>, <span class="hljs-comment">//é»˜è®¤æç¤ºæ–‡æ¡ˆ</span><br>                label: Text(<span class="hljs-string">&quot;Account&quot;</span>) <span class="hljs-comment">//æ–‡æœ¬æ¡†æ ‡ç­¾æç¤º</span><br>            ),<br>          ),<br>          SizedBox(height: <span class="hljs-number">20</span>),<br>          TextField(<span class="hljs-comment">//å¯†ç è¾“å…¥æ¡†</span><br>            maxLines: <span class="hljs-number">1</span>, <span class="hljs-comment">//æœ€å¤§æ˜¾ç¤ºä¸€è¡Œ</span><br>            obscureText: <span class="hljs-keyword">true</span>, <span class="hljs-comment">//è®¾ç½®æ–‡æœ¬è¾“å…¥ä¸ºå¯†æ–‡</span><br>            decoration: InputDecoration(<br>                hintText: <span class="hljs-string">&quot;please input password&quot;</span>, <span class="hljs-comment">//é»˜è®¤æç¤ºæ–‡æ¡ˆ</span><br>                label: Text(<span class="hljs-string">&quot;Password&quot;</span>) <span class="hljs-comment">//æ–‡æœ¬æ¡†æ ‡ç­¾æç¤º</span><br>            ),<br>          )<br>        ],<br>      ),<br>    );<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æ•ˆæœï¼š</p><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/02d56e52ecc84c8baebd9e8b1f3cc86c~tplv-k3u1fbpfcp-watermark.image?" alt="textfield.png" width="50%" /><h3 id="1-2ã€Checkboxï¼ŒCheckboxListTile-å¤é€‰æ¡†"><a href="#1-2ã€Checkboxï¼ŒCheckboxListTile-å¤é€‰æ¡†" class="headerlink" title="1.2ã€Checkboxï¼ŒCheckboxListTile å¤é€‰æ¡†"></a>1.2ã€Checkboxï¼ŒCheckboxListTile å¤é€‰æ¡†</h3><p>Checkbox æ˜¯ Flutter ç»™æˆ‘ä»¬æä¾›çš„å¤é€‰æ¡† Widgetï¼Œå¸¸ç”¨å±æ€§æœ‰ï¼š</p><table><thead><tr><th>å±æ€§åç§°</th><th>å±æ€§ç±»å‹</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>value</td><td>bool</td><td>å¿…å¡«é¡¹ï¼Œtrueï¼šé€‰ä¸­ï¼Œfalseï¼šæœªé€‰ä¸­</td></tr><tr><td>onChanged</td><td>ValueChanged<bool></td><td>å¿…å¡«é¡¹ï¼Œæ”¹å˜æ—¶è§¦å‘çš„äº‹ä»¶</td></tr><tr><td>activeColor</td><td>Color</td><td>é€‰ä¸­çš„èƒŒæ™¯é¢œè‰²</td></tr><tr><td>checkColor</td><td>Color</td><td>é€‰ä¸­å¤é€‰æ¡†é‡Œé¢ç¬¦å·çš„é¢œè‰²</td></tr></tbody></table><p>CheckboxListTile æ˜¯ Flutter ç»™æˆ‘ä»¬æä¾›çš„å¤é€‰æ¡†åˆ—è¡¨ Itemï¼Œå¸¸ç”¨å±æ€§æœ‰ï¼š</p><table><thead><tr><th>å±æ€§åç§°</th><th>å±æ€§ç±»å‹</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>value</td><td>bool</td><td>å¿…å¡«é¡¹ï¼Œtrueï¼šé€‰ä¸­ï¼Œfalseï¼šæœªé€‰ä¸­</td></tr><tr><td>onChanged</td><td>ValueChanged<bool></td><td>å¿…å¡«é¡¹ï¼Œæ”¹å˜æ—¶è§¦å‘çš„äº‹ä»¶</td></tr><tr><td>activeColor</td><td>Color</td><td>é€‰ä¸­çš„èƒŒæ™¯é¢œè‰²ï¼Œå¦‚æœ selected ä¸º true ï¼Œåˆ™ titleï¼Œsubtitleï¼Œsecondary ä¹Ÿä¼šå˜</td></tr><tr><td>checkColor</td><td>Color</td><td>é€‰ä¸­å¤é€‰æ¡†é‡Œé¢ç¬¦å·çš„é¢œè‰²</td></tr><tr><td>title</td><td>Widget</td><td>æ ‡é¢˜</td></tr><tr><td>subtitle</td><td>Widget</td><td>äºŒçº§æ ‡é¢˜</td></tr><tr><td>secondary</td><td>Widget</td><td>é…ç½®æ˜¾ç¤ºçš„å›¾æ ‡æˆ–å›¾ç‰‡</td></tr><tr><td>selected</td><td>bool</td><td>é€‰ä¸­æ—¶å…¶å®ƒå­ Widget é¢œè‰²æ˜¯å¦è·Ÿç€æ”¹å˜</td></tr></tbody></table><p>åœ¨è¿™ä¹‹å‰ï¼Œæˆ‘ä»¬è‡ªå®šä¹‰ Wdiget éƒ½æ˜¯ç»§æ‰¿ StatelessWidgetï¼Œä½†è¡¨å•ç›¸å…³çš„ Widget éƒ½æ˜¯æœ‰çŠ¶æ€çš„ï¼Œå› æ­¤éœ€è¦ç»§æ‰¿ StatefulWidget æ¥åŠ¨æ€å±•ç¤ºå®ƒçš„ä¸€ä¸ªçŠ¶æ€ï¼Œç»§æ‰¿ StatefulWidget çš„ä¸€ä¸ªæ ‡å‡†æ¨¡ç‰ˆå¦‚ä¸‹ï¼š</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyBodyPage</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">StatefulWidget</span></span>&#123;<br>  <span class="hljs-meta">@override</span><br>  State&lt;StatefulWidget&gt; createState() =&gt; _MyBodyPageState();<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">_MyBodyPageState</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">State</span>&lt;<span class="hljs-title">MyBodyPage</span>&gt;</span>&#123;<br>  <span class="hljs-meta">@override</span><br>  Widget build(BuildContext context) &#123;<br>    <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> implement build</span><br>    <span class="hljs-keyword">throw</span> UnimplementedError();<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥æˆ‘ä»¬ä½¿ç”¨ Checkboxï¼ŒCheckboxListTile æ¥å®è·µä¸€ä¸‹ï¼š</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;package:flutter/material.dart&#x27;</span>;<br><br><span class="hljs-keyword">void</span> main() &#123;<br>  runApp(MaterialApp(<br>    home: Scaffold(<br>      appBar: AppBar(<br>        title: Text(<span class="hljs-string">&quot;Flutter Form Practice&quot;</span>), <span class="hljs-comment">//è®¾ç½®æ ‡é¢˜æ æ ‡é¢˜</span><br>      ),<br>      body: MyBodyPage(), <span class="hljs-comment">//è‡ªå®šä¹‰ body Wdiget</span><br>    )<br>  ));<br>&#125;<br><br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyBodyPage</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">StatefulWidget</span></span>&#123;<br>  <span class="hljs-meta">@override</span><br>  State&lt;StatefulWidget&gt; createState() =&gt; _MyBodyPageState();<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">_MyBodyPageState</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">State</span>&lt;<span class="hljs-title">MyBodyPage</span>&gt; </span>&#123;<br><br>  <span class="hljs-comment">//è®°å½•ç¬¬ä¸€ä¸ªå¤é€‰æ¡†çš„é€‰ä¸­çŠ¶æ€</span><br>  <span class="hljs-keyword">var</span> flag1 = <span class="hljs-keyword">false</span>;<br>  <span class="hljs-comment">//è®°å½•ç¬¬äºŒä¸ªå¤é€‰æ¡†çš„é€‰ä¸­çŠ¶æ€</span><br>  <span class="hljs-keyword">var</span> flag2 = <span class="hljs-keyword">false</span>;<br>  <span class="hljs-comment">//è®°å½•ç¬¬ä¸‰ä¸ªå¤é€‰æ¡†çš„é€‰ä¸­çŠ¶æ€</span><br>  <span class="hljs-keyword">var</span> flag3 = <span class="hljs-keyword">false</span>;<br><br>  <span class="hljs-meta">@override</span><br>  Widget build(BuildContext context) &#123;<br>    <span class="hljs-keyword">return</span> Column(<br>      mainAxisAlignment: MainAxisAlignment.center,<br>      children: [<br>        Checkbox( <span class="hljs-comment">//ç¬¬ä¸€ä¸ªå¤é€‰æ¡†</span><br>          value: flag1,<br>          onChanged: (value)&#123;<br>            setState(() &#123;<br>              flag1 = value??<span class="hljs-keyword">false</span>; <span class="hljs-comment">//æ›´æ–°å¤é€‰æ¡†çš„çŠ¶æ€</span><br>            &#125;);<br>          &#125;,<br>        ),<br>        Row(<br>          mainAxisAlignment: MainAxisAlignment.center,<br>          children: [<br>            Text(flag1 == <span class="hljs-keyword">true</span> ? <span class="hljs-string">&quot;é€‰ä¸­&quot;</span> : <span class="hljs-string">&quot;æœªé€‰ä¸­&quot;</span>)<br>          ],<br>        ),<br>        Divider(color: Colors.black),<br>        CheckboxListTile(value: flag2, onChanged: (value)&#123; <span class="hljs-comment">//ç¬¬äºŒä¸ªå¤é€‰æ¡†åˆ—è¡¨ item</span><br>          setState(() &#123;<br>            flag2 = value??<span class="hljs-keyword">false</span>; <span class="hljs-comment">//æ›´æ–°å¤é€‰æ¡†çš„çŠ¶æ€</span><br>          &#125;);<br>        &#125;,<br>          activeColor: Colors.green, <span class="hljs-comment">//é€‰ä¸­çš„èƒŒæ™¯é¢œè‰²ï¼Œå¦‚æœ selected ä¸º true ï¼Œåˆ™ titleï¼Œsubtitleï¼Œsecondary ä¹Ÿä¼šå˜</span><br>          checkColor: Colors.black, <span class="hljs-comment">//é€‰ä¸­å¤é€‰æ¡†é‡Œé¢ç¬¦å·çš„é¢œè‰²</span><br>          title: Text(<span class="hljs-string">&#x27;æ ‡é¢˜&#x27;</span>), <span class="hljs-comment">//å±•ç¤ºæ ‡é¢˜</span><br>          subtitle: Text(<span class="hljs-string">&quot;æè¿°&quot;</span>), <span class="hljs-comment">//å±•ç¤ºå‰¯æ ‡é¢˜</span><br>          selected: flag2, <span class="hljs-comment">//é€‰ä¸­æ—¶å…¶å®ƒå­ Widget é¢œè‰²è·Ÿç€æ”¹å˜</span><br>        ),<br><br>        Divider(color: Colors.black),<br><br>        CheckboxListTile(value: flag3, onChanged: (value)&#123; <span class="hljs-comment">//ç¬¬ä¸‰ä¸ªå¤é€‰æ¡†åˆ—è¡¨ item</span><br>          setState(() &#123;<br>            flag3 = value??<span class="hljs-keyword">false</span>; <span class="hljs-comment">//æ›´æ–°å¤é€‰æ¡†çš„çŠ¶æ€</span><br>          &#125;);<br>        &#125;,<br>          title: Text(<span class="hljs-string">&#x27;æ ‡é¢˜&#x27;</span>), <span class="hljs-comment">//å±•ç¤ºæ ‡é¢˜</span><br>          subtitle: Text(<span class="hljs-string">&quot;æè¿°&quot;</span>), <span class="hljs-comment">//å±•ç¤ºå‰¯æ ‡é¢˜</span><br>          secondary: Icon(Icons.home), <span class="hljs-comment">//å±•ç¤ºå›¾æ ‡</span><br>          selected: <span class="hljs-keyword">false</span>, <span class="hljs-comment">//é€‰ä¸­æ—¶å…¶å®ƒå­ Widget é¢œè‰²ä¸è·Ÿç€æ”¹å˜</span><br>        )<br>      ],<br>    );<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æ•ˆæœï¼š</p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/152787ffc53245e6952bdb94f269da08~tplv-k3u1fbpfcp-watermark.image?" alt="checkbox.gif" width="30%" /><h3 id="1-3ã€Radioï¼ŒRadioListTile-å•é€‰æ¡†"><a href="#1-3ã€Radioï¼ŒRadioListTile-å•é€‰æ¡†" class="headerlink" title="1.3ã€Radioï¼ŒRadioListTile å•é€‰æ¡†"></a>1.3ã€Radioï¼ŒRadioListTile å•é€‰æ¡†</h3><p>Radioï¼ŒRadioListTile æ˜¯ Flutter ç»™æˆ‘ä»¬æä¾›çš„å•é€‰æ¡†å’Œå•é€‰æ¡†åˆ—è¡¨ Itemï¼Œå®ƒçš„å¸¸ç”¨å±æ€§å’Œ Checkboxï¼ŒCheckboxListTile éå¸¸ç±»ä¼¼ï¼ŒåŒºåˆ«å°±æ˜¯ï¼šRadioï¼ŒRadioListTile å¿…é¡»æä¾›ä¸€ä¸ª groupValue å±æ€§ç”¨äºè®°å½•å•é€‰æ¡†çš„åˆ†ç»„ï¼Œç›´æ¥ä¸Šä»£ç æ„Ÿå—ä¸‹ï¼š</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;package:flutter/material.dart&#x27;</span>;<br><br><span class="hljs-keyword">void</span> main() &#123;<br>  runApp(MaterialApp(<br>    home: Scaffold(<br>      appBar: AppBar(<br>        title: Text(<span class="hljs-string">&quot;Flutter Form Practice&quot;</span>), <span class="hljs-comment">//è®¾ç½®æ ‡é¢˜æ æ ‡é¢˜</span><br>      ),<br>      body: MyBodyPage(), <span class="hljs-comment">//è‡ªå®šä¹‰ body Wdiget</span><br>    )<br>  ));<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyBodyPage</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">StatefulWidget</span> </span>&#123;<br>  <span class="hljs-meta">@override</span><br>  State&lt;StatefulWidget&gt; createState() =&gt; _MyBodyPageState();<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">_MyBodyPageState</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">State</span>&lt;<span class="hljs-title">MyBodyPage</span>&gt; </span>&#123;<br>  <span class="hljs-comment">//æ€§åˆ«</span><br>  <span class="hljs-built_in">int</span> sex = <span class="hljs-number">1</span>;<br>  <span class="hljs-comment">//ç¬¬äºŒä¸ªå¤é€‰æ¡†çŠ¶æ€æ ‡è®°</span><br>  <span class="hljs-built_in">bool</span> flag = <span class="hljs-keyword">true</span>;<br><br>  <span class="hljs-meta">@override</span><br>  Widget build(BuildContext context) &#123;<br>    <span class="hljs-keyword">return</span> Column(<br>      mainAxisAlignment: MainAxisAlignment.center,<br>      children: [<br>        <span class="hljs-comment">//ç¬¬ä¸€ç»„å•é€‰æ¡†</span><br>        Row(<br>          mainAxisAlignment: MainAxisAlignment.center,<br>          children: [<br>            Text(<span class="hljs-string">&quot;ç”·&quot;</span>),<br>            Radio(<br>                value: <span class="hljs-number">1</span>,<br>                onChanged: (value) &#123;<br>                  setState(() &#123;<br>                    sex = value <span class="hljs-keyword">as</span> <span class="hljs-built_in">int</span>; <span class="hljs-comment">//æ›´æ–°çŠ¶æ€</span><br>                  &#125;);<br>                &#125;,<br>                groupValue: sex), <span class="hljs-comment">//groupValue ä¸º sex</span><br>            SizedBox(width: <span class="hljs-number">20</span>),<br>            Text(<span class="hljs-string">&quot;å¥³&quot;</span>),<br>            Radio(<br>                value: <span class="hljs-number">2</span>,<br>                onChanged: (value) &#123;<br>                  setState(() &#123;<br>                    sex = value <span class="hljs-keyword">as</span> <span class="hljs-built_in">int</span>; <span class="hljs-comment">//æ›´æ–°çŠ¶æ€</span><br>                  &#125;);<br>                &#125;,<br>                groupValue: sex) <span class="hljs-comment">//groupValue ä¸º sex</span><br>          ],<br>        ),<br>        SizedBox(height: <span class="hljs-number">20</span>),<br>        Divider(),<br>         <span class="hljs-comment">//ç¬¬äºŒç»„å•é€‰æ¡†</span><br>        RadioListTile(<br>          value: <span class="hljs-keyword">true</span>,<br>          onChanged: (value) &#123;<br>            setState(() &#123;<br>              flag = value <span class="hljs-keyword">as</span> <span class="hljs-built_in">bool</span>; <span class="hljs-comment">//æ›´æ–°çŠ¶æ€</span><br>            &#125;);<br>          &#125;,<br>          groupValue: flag, <span class="hljs-comment">//groupValue ä¸º flag</span><br>          title: Text(<span class="hljs-string">&quot;ä¸€çº§æ ‡é¢˜&quot;</span>), <span class="hljs-comment">//æ ‡é¢˜</span><br>          subtitle: Text(<span class="hljs-string">&quot;äºŒçº§æ ‡é¢˜&quot;</span>), <span class="hljs-comment">//å‰¯æ ‡é¢˜</span><br>          secondary: Icon(Icons.home), <span class="hljs-comment">//æ˜¾ç¤ºå›¾æ ‡</span><br>        ),<br>        RadioListTile(<br>          value: <span class="hljs-keyword">false</span>,<br>          onChanged: (value) &#123;<br>            setState(() &#123;<br>              flag = value <span class="hljs-keyword">as</span> <span class="hljs-built_in">bool</span>; <span class="hljs-comment">//æ›´æ–°çŠ¶æ€</span><br>            &#125;);<br>          &#125;,<br>          groupValue: flag, <span class="hljs-comment">//groupValue ä¸º flag</span><br>          title: Text(<span class="hljs-string">&quot;ä¸€çº§æ ‡é¢˜&quot;</span>), <span class="hljs-comment">//æ ‡é¢˜</span><br>          subtitle: Text(<span class="hljs-string">&quot;äºŒçº§æ ‡é¢˜&quot;</span>), <span class="hljs-comment">//å‰¯æ ‡é¢˜</span><br>          secondary: Image.network( <span class="hljs-comment">//æ˜¾ç¤ºå›¾ç‰‡</span><br>              <span class="hljs-string">&quot;https://img.lianzhixiu.com/uploads/210106/37-21010609363aS.jpg&quot;</span>),<br>        )<br>      ],<br>    );<br>  &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><p>æ•ˆæœï¼š</p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/3d902dab159d44c4b737255539be94e4~tplv-k3u1fbpfcp-watermark.image?" alt="radiobutton.gif" width="30%" /><h3 id="1-4ã€Switchï¼ŒSwitchListTile-å¼€å…³"><a href="#1-4ã€Switchï¼ŒSwitchListTile-å¼€å…³" class="headerlink" title="1.4ã€Switchï¼ŒSwitchListTile å¼€å…³"></a>1.4ã€Switchï¼ŒSwitchListTile å¼€å…³</h3><p>Switchï¼ŒSwitchListTile æ˜¯ Flutter ç»™æˆ‘ä»¬æä¾›çš„å¼€å…³å’Œå¼€å…³åˆ—è¡¨ Itemï¼Œå¸¸ç”¨å±æ€§å’Œä¸Šé¢ä¸¤ä¸ªç±»ä¼¼ï¼Œæˆ‘ä»¬å¿«é€Ÿè¿‡ä¸€ä¸‹ï¼š</p><p>ä»£ç å®è·µï¼š</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;package:flutter/material.dart&#x27;</span>;<br><br><span class="hljs-keyword">void</span> main() &#123;<br>  runApp(MaterialApp(<br>    home: Scaffold(<br>      appBar: AppBar(<br>        title: Text(<span class="hljs-string">&quot;Flutter Form Practice&quot;</span>), <span class="hljs-comment">//è®¾ç½®æ ‡é¢˜æ æ ‡é¢˜</span><br>      ),<br>      body: MyBodyPage(), <span class="hljs-comment">//è‡ªå®šä¹‰ body Wdiget</span><br>    )<br>  ));<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyBodyPage</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">StatefulWidget</span> </span>&#123;<br>  <span class="hljs-meta">@override</span><br>  State&lt;StatefulWidget&gt; createState() =&gt; _MyBodyPageState();<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">_MyBodyPageState</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">State</span>&lt;<span class="hljs-title">MyBodyPage</span>&gt; </span>&#123;<br>  <span class="hljs-comment">//å¼€å…³çš„çŠ¶æ€æ ‡è®°</span><br>  <span class="hljs-built_in">bool</span> flag = <span class="hljs-keyword">true</span>;<br><br>  <span class="hljs-meta">@override</span><br>  Widget build(BuildContext context) &#123;<br>    <span class="hljs-keyword">return</span> Column(<br>      children: [<br>        Switch( <span class="hljs-comment">//Switch</span><br>            value: flag,<br>            onChanged: (value) &#123;<br>              setState(() &#123;<br>                flag = value; <span class="hljs-comment">//æ›´æ–°çŠ¶æ€</span><br>              &#125;);<br>            &#125;),<br>        SizedBox(height: <span class="hljs-number">20</span>),<br>        SwitchListTile( <span class="hljs-comment">//SwitchListTile</span><br>            value: flag,<br>            onChanged: (value) &#123;<br>              setState(() &#123;<br>                flag = value; <span class="hljs-comment">//æ›´æ–°çŠ¶æ€</span><br>              &#125;);<br>            &#125;,<br>            title: Text(<span class="hljs-string">&quot;æ ‡é¢˜&quot;</span>), <span class="hljs-comment">//æ ‡é¢˜</span><br>            subtitle: Text(<span class="hljs-string">&quot;å‰¯æ ‡é¢˜&quot;</span>), <span class="hljs-comment">//å‰¯æ ‡é¢˜</span><br>            secondary: Image.network( <span class="hljs-comment">//æ˜¾ç¤ºå›¾ç‰‡</span><br>              <span class="hljs-string">&quot;https://img.lianzhixiu.com/uploads/210106/37-21010609363aS.jpg&quot;</span><br>            ) <br>        )<br>      ],<br>    );<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æ•ˆæœï¼š</p><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/45fad04d96ec4c12a3b9f7ee67e04580~tplv-k3u1fbpfcp-watermark.image?" alt="switch.gif" width="30%" /><h3 id="1-5ã€Slider-è¿›åº¦æ¡"><a href="#1-5ã€Slider-è¿›åº¦æ¡" class="headerlink" title="1.5ã€Slider è¿›åº¦æ¡"></a>1.5ã€Slider è¿›åº¦æ¡</h3><p>Slider æ˜¯ Flutter ç»™æˆ‘ä»¬æä¾›çš„è¿›åº¦æ¡ Widgetã€‚å…¶å¸¸ç”¨å±æ€§æœ‰ï¼š</p><table><thead><tr><th>å±æ€§åç§°</th><th>å±æ€§ç±»å‹</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>value</td><td>double</td><td>å¿…å¡«é¡¹ï¼Œå½“å‰ Slider æ»‘å—ä½ç½®çš„å€¼ï¼Œæ³¨æ„ä¸å¯ä»¥è¶…å‡º min å’Œ max çš„èŒƒå›´ï¼Œå¦åˆ™ä¼šæŠ¥é”™</td></tr><tr><td>onChanged</td><td>ValueChanged<double></td><td>å¿…å¡«é¡¹ï¼Œæ­£åœ¨æ»‘åŠ¨æˆ–è€…ç‚¹å‡»ï¼Œæœªæ¾æ‰‹</td></tr><tr><td>onChangeStart</td><td>ValueChanged<double></td><td>åˆšå¼€å§‹ç‚¹å‡»</td></tr><tr><td>onChangeEnd</td><td>ValueChanged<double></td><td>æ»‘åŠ¨æˆ–è€…ç‚¹å‡»ç»“æŸï¼Œå·²æ¾æ‰‹</td></tr><tr><td>min</td><td>double</td><td>æœ€å°å€¼ï¼Œé»˜è®¤ä¸º 0.0</td></tr><tr><td>max</td><td>double</td><td>æœ€å¤§å€¼ï¼Œé»˜è®¤ä¸º 1.0</td></tr><tr><td>activeColor</td><td>Color</td><td>æ»‘å—é¢œè‰²</td></tr><tr><td>inactiveColor</td><td>Color</td><td>è½¨é“é¢œè‰²</td></tr><tr><td>label</td><td>String</td><td>æ°”æ³¡æ–‡æœ¬</td></tr><tr><td>divisions</td><td>int</td><td>åˆ»åº¦ï¼Œå¦‚æ²¡æœ‰åˆ»åº¦ï¼Œlabel åˆ™ä¸ä¼šå±•ç¤º</td></tr></tbody></table><p>ä»£ç å®è·µï¼š</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;package:flutter/material.dart&#x27;</span>;<br><br><span class="hljs-keyword">void</span> main() &#123;<br>  runApp(MaterialApp(<br>    home: Scaffold(<br>      appBar: AppBar(<br>        title: Text(<span class="hljs-string">&quot;Flutter Form Practice&quot;</span>), <span class="hljs-comment">//è®¾ç½®æ ‡é¢˜æ æ ‡é¢˜</span><br>      ),<br>      body: MyBodyPage(), <span class="hljs-comment">//è‡ªå®šä¹‰ body Wdiget</span><br>    )<br>  ));<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyBodyPage</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">StatefulWidget</span></span>&#123;<br><br>  <span class="hljs-meta">@override</span><br>  State&lt;StatefulWidget&gt; createState() =&gt; _MyBodyPageState();<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">_MyBodyPageState</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">State</span>&lt;<span class="hljs-title">MyBodyPage</span>&gt;</span>&#123;<br>  <span class="hljs-comment">//æ»‘å—çš„å€¼</span><br>  <span class="hljs-built_in">double</span> sliderValue = <span class="hljs-number">0</span>;<br><br>  <span class="hljs-comment">// æ›´æ–°çŠ¶æ€</span><br>  <span class="hljs-keyword">void</span> updateSlider(value)&#123;<br>    sliderValue = value;<br>    setState(() &#123;<br><br>    &#125;);<br>  &#125;<br><br>  <span class="hljs-meta">@override</span><br>  Widget build(BuildContext context) &#123;<br>    <span class="hljs-keyword">return</span> Padding(<br>      padding: EdgeInsets.all(<span class="hljs-number">20</span>),<br>      child: Column(<br>        children: [<br>          _slider() <br>        ],<br>      ),<br>    );<br>  &#125;<br><br>  <span class="hljs-comment">//æ„å»ºæ»‘å— Widget</span><br>  Slider _slider()&#123;<br>    <span class="hljs-keyword">return</span> Slider(<br>      value: sliderValue,<br>      max: <span class="hljs-number">100</span>, <span class="hljs-comment">//æœ€å¤§å€¼ä¸º 100</span><br>      activeColor: Colors.red, <span class="hljs-comment">//æ»‘å—é¢œè‰²ä¸ºçº¢è‰²</span><br>      inactiveColor: Colors.green, <span class="hljs-comment">//è½¨é“é¢œè‰²ä¸ºç»¿è‰²</span><br>      label: <span class="hljs-string">&quot;è¿›åº¦ï¼š<span class="hljs-subst">$sliderValue</span>&quot;</span>, <span class="hljs-comment">//æ°”æ³¡æ–‡æœ¬</span><br>      divisions: <span class="hljs-number">10</span>, <span class="hljs-comment">//åˆ»åº¦</span><br>      onChanged: (value)&#123; <span class="hljs-comment">//æ­£åœ¨æ»‘åŠ¨æˆ–è€…ç‚¹å‡»ï¼Œæœªæ¾æ‰‹</span><br>        updateSlider(value);<br>      &#125;,<br>      onChangeStart: (value)&#123; <span class="hljs-comment">//åˆšå¼€å§‹ç‚¹å‡»</span><br>        updateSlider(value);<br>      &#125;,<br>      onChangeEnd: (value)&#123; <span class="hljs-comment">//æ»‘åŠ¨æˆ–è€…ç‚¹å‡»ç»“æŸï¼Œå·²æ¾æ‰‹</span><br>        updateSlider(value);<br>      &#125;,<br>    );<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æ•ˆæœï¼š</p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/1783f4399eb14b8eaafb5a5a69778c0d~tplv-k3u1fbpfcp-watermark.image?" alt="slider.gif" width="30%" /><p>æˆ‘ä»¬è¿˜å¯ä»¥ä½¿ç”¨ SliderTheme åµŒå¥— Slider å®ç°å„ç§è‡ªå®šä¹‰æ ·å¼ï¼Œè¿™é‡Œå°±ä¸åšæ¼”ç¤ºäº†ï¼ŒSliderTheme å¸¸ç”¨å±æ€§æœ‰ï¼š</p><table><thead><tr><th>å±æ€§åç§°</th><th>å±æ€§ç±»å‹</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>data</td><td>SliderThemeData</td><td>å¿…å¡«é¡¹ï¼Œé€šè¿‡ SliderThemeData å®ç°å„ç§è‡ªå®šä¹‰æ ·å¼</td></tr><tr><td>child</td><td>Widget</td><td>å¿…å¡«é¡¹ï¼Œå­ Widget</td></tr></tbody></table><p>SliderThemeData å±æ€§ä»‹ç»ï¼š<a href="https://api.flutter.dev/flutter/material/SliderThemeData-class.html">https://api.flutter.dev/flutter/material/SliderThemeData-class.html</a></p><h2 id="äºŒã€è¡¨å•-Widget-ä¹‹ç»¼åˆæ¡ˆä¾‹"><a href="#äºŒã€è¡¨å•-Widget-ä¹‹ç»¼åˆæ¡ˆä¾‹" class="headerlink" title="äºŒã€è¡¨å• Widget ä¹‹ç»¼åˆæ¡ˆä¾‹"></a>äºŒã€è¡¨å• Widget ä¹‹ç»¼åˆæ¡ˆä¾‹</h2><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°±ä½¿ç”¨è¡¨å• Widget åšä¸€ä¸ªç”¨æˆ·ä¿¡æ¯ç™»è®°ç³»ç»Ÿï¼Œæ•ˆæœå¦‚ä¸‹ï¼š</p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/b87c5a8f38ca46c1a1c9931f6a9d6cda~tplv-k3u1fbpfcp-watermark.image?" alt="form_combine.gif" width="30%" /><p>æŒ‰ç…§æƒ¯ä¾‹ï¼Œæˆ‘ä»¬å…ˆåˆ†æè¿™ä¸ªé¡µé¢ï¼š</p><p>1ã€å¯ä»¥çœ‹åˆ°è¿™æ˜¯ä¸€ä¸ªä»ä¸Šå¾€ä¸‹çš„å‚ç›´å¸ƒå±€ï¼Œæœ‰ä¸ªå†…è¾¹è·ï¼Œå­ Widget æ˜¯è‡ªé€‚åº”çš„ï¼Œè¿™é‡Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ ListView å¹¶è®¾ç½®ä¸€ä¸ª padding å®ç°</p><p>2ã€ç„¶åä»ä¸Šå¾€ä¸‹ä¾æ¬¡æ˜¯ï¼Œè¾“å…¥å§“åï¼šæ–‡æœ¬æ¡†ï¼ˆTextFieldï¼‰ï¼Œæ€§åˆ«é€‰æ‹©ï¼šå•é€‰æ¡†ï¼ˆRadioï¼‰ï¼Œå…´è¶£çˆ±å¥½ï¼šå¤é€‰æ¡†ï¼ˆCheckboxï¼‰ï¼Œé¢œå€¼æ‰“åˆ†ï¼šæ»‘å—ï¼ˆSliderï¼‰ï¼Œæ°¸ä¸å®•æœºï¼šå¼€å…³ï¼ˆSwitchListTileï¼‰ï¼Œè·å–ç”¨æˆ·ä¿¡æ¯ï¼ˆRaisedButtonï¼‰ï¼Œç”¨æˆ·ä¿¡æ¯å±•ç¤ºï¼ˆTextï¼‰</p><p>3ã€è¿™äº› Widget éƒ½æ˜¯æœ‰çŠ¶æ€çš„ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦ç»§æ‰¿ StatefulWidgetï¼Œå¹¶ä½¿ç”¨ setState æ–¹æ³•å»æ›´æ–°çŠ¶æ€</p><p>æˆ‘ä»¬ç”»ä¸€å¼ å›¾æ¥ç†ä¸€ä¸‹ Widget ä¹‹é—´çš„æ ‘å½¢ç»“æ„ï¼š</p><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/ca88da02d2e84137ac6b3fd017ab63c1~tplv-k3u1fbpfcp-watermark.image?" alt="è¡¨å• Widget ä¹‹ç»¼åˆæ¡ˆä¾‹.png" width="50%" /><p>æœ€åæˆ‘ä»¬è¿›è¡Œä»£ç å®ç°ï¼Œé‡Œé¢å†™äº†è¯¦ç»†çš„æ³¨é‡Šï¼š</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;package:flutter/material.dart&#x27;</span>;<br><br><span class="hljs-keyword">void</span> main() &#123;<br>  runApp(MaterialApp(<br>      home: Scaffold(<br>        appBar: AppBar(<br>          title: Text(<span class="hljs-string">&quot;ç”¨æˆ·ä¿¡æ¯ç™»è®°ç³»ç»Ÿ&quot;</span>), <span class="hljs-comment">//è®¾ç½®æ ‡é¢˜æ æ ‡é¢˜</span><br>        ),<br>        body: MyBodyPage(), <span class="hljs-comment">//è‡ªå®šä¹‰ body Wdiget</span><br>      )<br>  ));<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyBodyPage</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">StatefulWidget</span> </span>&#123;<br>  <span class="hljs-meta">@override</span><br>  State&lt;StatefulWidget&gt; createState() =&gt; _MyBodyPageState();<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">_MyBodyPageState</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">State</span>&lt;<span class="hljs-title">MyBodyPage</span>&gt; </span>&#123;<br><br>  <span class="hljs-comment">//ç”¨æˆ·å§“å</span><br>  <span class="hljs-built_in">String</span> userName = <span class="hljs-string">&quot;&quot;</span>;<br>  <span class="hljs-comment">//æ€§åˆ«</span><br>  <span class="hljs-built_in">int</span> sex = <span class="hljs-number">1</span>;<br>  <span class="hljs-comment">//æ˜¯å¦å¼€å¯æ°¸ä¸å®•æœº</span><br>  <span class="hljs-built_in">bool</span> flag = <span class="hljs-keyword">false</span>;<br>  <span class="hljs-comment">//é¢œå€¼æ‰“åˆ†</span><br>  <span class="hljs-built_in">double</span> sliderValue = <span class="hljs-number">0</span>;<br>  <span class="hljs-comment">//å…´è¶£çˆ±å¥½</span><br>  <span class="hljs-built_in">List</span> hobbies = [<br>    &#123;<span class="hljs-string">&quot;checked&quot;</span>: <span class="hljs-keyword">false</span>, <span class="hljs-string">&quot;title&quot;</span>: <span class="hljs-string">&quot;æ‰“ç¯®çƒ&quot;</span>&#125;,<br>    &#123;<span class="hljs-string">&quot;checked&quot;</span>: <span class="hljs-keyword">false</span>, <span class="hljs-string">&quot;title&quot;</span>: <span class="hljs-string">&quot;çˆ¬å±±&quot;</span>&#125;,<br>    &#123;<span class="hljs-string">&quot;checked&quot;</span>: <span class="hljs-keyword">false</span>, <span class="hljs-string">&quot;title&quot;</span>: <span class="hljs-string">&quot;å†™ä»£ç &quot;</span>&#125;,<br>  ];<br>  <span class="hljs-comment">//ä¸ªäººä¿¡æ¯</span><br>  <span class="hljs-built_in">String</span> info = <span class="hljs-string">&quot;&quot;</span>;<br><br>  <span class="hljs-meta">@override</span><br>  Widget build(BuildContext context) &#123;<br>    <span class="hljs-keyword">return</span> ListView(<br>      padding: EdgeInsets.all(<span class="hljs-number">20</span>),<br>      children: [<br>        TextField( <span class="hljs-comment">//æ–‡æœ¬æ¡†ï¼šç”¨æˆ·å§“å</span><br>          decoration: InputDecoration(<br>              hintText: <span class="hljs-string">&quot;è¯·è¾“å…¥ç”¨æˆ·å§“å&quot;</span>, <span class="hljs-comment">//é»˜è®¤æç¤ºæ–‡æ¡ˆ</span><br>              label: Text(<span class="hljs-string">&quot;å§“å&quot;</span>) <span class="hljs-comment">//æ ‡ç­¾</span><br>          ),<br>          onChanged: (str)&#123;<br>            setState(() &#123;<br>              userName = str; <span class="hljs-comment">//æ›´æ–°ç”¨æˆ·å§“åçŠ¶æ€</span><br>            &#125;);<br>          &#125;,<br>        ),<br>        SizedBox(height: <span class="hljs-number">10</span>),<br>        Text(<span class="hljs-string">&quot;æ€§åˆ«ï¼š&quot;</span>),<br>        Row( <span class="hljs-comment">//æ€§åˆ«é€‰æ‹©</span><br>          children: [<br>            Text(<span class="hljs-string">&quot;ç”·&quot;</span>),<br>            Radio(value: <span class="hljs-number">1</span>, groupValue: sex, onChanged: _sexChanged),<br>            Text(<span class="hljs-string">&quot;å¥³&quot;</span>),<br>            Radio(value: <span class="hljs-number">2</span>, groupValue: sex, onChanged:_sexChanged)<br>          ],<br>        ),<br>        Text(<span class="hljs-string">&quot;å…´è¶£çˆ±å¥½ï¼š&quot;</span>),<br>        Row( <span class="hljs-comment">//å…´è¶£çˆ±å¥½</span><br>          children: _getHobbies(),<br>        ),<br>        _slider(),<br>        Row( <span class="hljs-comment">//é¢œå€¼æ‰“åˆ†</span><br>          mainAxisAlignment: MainAxisAlignment.center,<br>          children: [<br>            Text(<span class="hljs-string">&quot;é¢œå€¼ï¼š<span class="hljs-subst">$sliderValue</span>åˆ†&quot;</span>),<br>          ],<br>        ),<br>        SwitchListTile( <span class="hljs-comment">//å¼€å…³æ°¸ä¸å®•æœº</span><br>            value: flag,<br>            title: Text(<span class="hljs-string">&quot;æ°¸ä¸å®•æœº&quot;</span>),<br>            onChanged: (value)&#123;<br>              setState(() &#123;<br>                flag = value;<br>              &#125;);<br>            &#125;<br>        ),<br>        RaisedButton( <span class="hljs-comment">//è·å–ç”¨æˆ·ä¿¡æ¯</span><br>          child: Text(<span class="hljs-string">&quot;è·å–ç”¨æˆ·ä¿¡æ¯&quot;</span>),<br>          onPressed: ()&#123;<br>            setState(() &#123;<br>              info = getInfo(); <span class="hljs-comment">//æ›´æ–°ç”¨æˆ·çŠ¶æ€ä¿¡æ¯</span><br>            &#125;);<br>          &#125;,<br>          color: Colors.blue,<br>          textColor: Colors.white,<br>        ),<br><br>        Text(info) <span class="hljs-comment">//ç”¨æˆ·ä¿¡æ¯å±•ç¤º</span><br>      ],<br>    );<br>  &#125;<br><br>  <span class="hljs-comment">//è·å–ç”¨æˆ·å±•ç¤ºçš„ä¿¡æ¯</span><br>  <span class="hljs-built_in">String</span> getInfo() &#123;<br>    <span class="hljs-built_in">String</span> hobbiesStr = <span class="hljs-string">&quot;&quot;</span>;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> element <span class="hljs-keyword">in</span> hobbies) &#123;<br>      <span class="hljs-keyword">if</span>(element[<span class="hljs-string">&quot;checked&quot;</span>])&#123;<br>        hobbiesStr += element[<span class="hljs-string">&quot;title&quot;</span>] + <span class="hljs-string">&quot;ï¼Œ&quot;</span>;<br>      &#125;<br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;<span class="hljs-subst">$userName</span>ï¼Œæ€§åˆ«<span class="hljs-subst">$&#123;sex == <span class="hljs-number">1</span> ? <span class="hljs-string">&quot;ç”·&quot;</span> : <span class="hljs-string">&quot;å¥³&quot;</span>&#125;</span>ï¼Œå–œæ¬¢<span class="hljs-subst">$hobbiesStr</span><span class="hljs-subst">$&#123;flag ? <span class="hljs-string">&quot;æ°¸ä¸å®•æœºï¼Œ&quot;</span> : <span class="hljs-string">&quot;&quot;</span>&#125;</span>é¢œå€¼<span class="hljs-subst">$sliderValue</span>åˆ†&quot;</span>;<br>  &#125;<br><br>  <span class="hljs-comment">//æ›´æ–°æ€§åˆ«çŠ¶æ€</span><br>  <span class="hljs-keyword">void</span> _sexChanged(value)&#123;<br>    setState(() &#123;<br>      sex = value <span class="hljs-keyword">as</span> <span class="hljs-built_in">int</span>;<br>    &#125;);<br>  &#125;<br><br>  <span class="hljs-comment">//æ›´æ–°æ»‘å—çŠ¶æ€</span><br>  <span class="hljs-keyword">void</span> updateSlider(value)&#123;<br>    sliderValue = value;<br>    setState(() &#123;<br><br>    &#125;);<br>  &#125;<br><br>  <span class="hljs-comment">//è·å–å…´è¶£çˆ±å¥½ Widget List</span><br>  <span class="hljs-built_in">List</span>&lt;Widget&gt; _getHobbies() &#123;<br>    <span class="hljs-built_in">List</span>&lt;Widget&gt; temp = [];<br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> element <span class="hljs-keyword">in</span> hobbies) &#123;<br>      <span class="hljs-comment">//æ·»åŠ  Text</span><br>      temp.add(Text(element[<span class="hljs-string">&quot;title&quot;</span>]));<br>      <span class="hljs-comment">//æ·»åŠ  Checkbox</span><br>      temp.add(Checkbox(<br>          value: element[<span class="hljs-string">&quot;checked&quot;</span>],<br>          onChanged: (value) &#123;<br>            setState(() &#123;<br>              element[<span class="hljs-string">&quot;checked&quot;</span>] = value;<br>            &#125;);<br>          &#125;));<br>    &#125;<br>    <span class="hljs-keyword">return</span> temp;<br>  &#125;<br><br>  <span class="hljs-comment">//è·å–æ»‘å— Widget</span><br>  Slider _slider()&#123;<br>    <span class="hljs-keyword">return</span> Slider(<br>      value: sliderValue,<br>      max: <span class="hljs-number">100</span>, <span class="hljs-comment">//æœ€å¤§å€¼ä¸º 100</span><br>      label: <span class="hljs-string">&quot;é¢œå€¼ï¼š<span class="hljs-subst">$sliderValue</span>åˆ†&quot;</span>, <span class="hljs-comment">//æ°”æ³¡æ–‡æœ¬</span><br>      divisions: <span class="hljs-number">10</span>, <span class="hljs-comment">//åˆ»åº¦</span><br>      onChanged: (value)&#123; <span class="hljs-comment">//æ­£åœ¨æ»‘åŠ¨æˆ–è€…ç‚¹å‡»ï¼Œæœªæ¾æ‰‹</span><br>        updateSlider(value);<br>      &#125;,<br>      onChangeStart: (value)&#123; <span class="hljs-comment">//åˆšå¼€å§‹ç‚¹å‡»</span><br>        updateSlider(value);<br>      &#125;,<br>      onChangeEnd: (value)&#123; <span class="hljs-comment">//æ»‘åŠ¨æˆ–è€…ç‚¹å‡»ç»“æŸï¼Œå·²æ¾æ‰‹</span><br>        updateSlider(value);<br>      &#125;,<br>    );<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="ä¸‰ã€æ€»ç»“"><a href="#ä¸‰ã€æ€»ç»“" class="headerlink" title="ä¸‰ã€æ€»ç»“"></a>ä¸‰ã€æ€»ç»“</h2><p>æœ¬ç¯‡æ–‡ç« æˆ‘ä»¬ä»‹ç»äº†ï¼š</p><p>1ã€Flutter ä¸­å¸¸ç”¨çš„è¡¨å• Widget ï¼šTextFieldï¼ŒCheckBoxï¼ŒRadioï¼ŒSwitchï¼ŒCheckboxListTileï¼ŒRadioListTileï¼ŒSwitchListTileï¼ŒSlider çš„å¸¸ç”¨å±æ€§å’Œä½¿ç”¨ï¼Œä»¥åŠå®ƒä»¬çš„æ˜¾ç¤ºæ•ˆæœ</p><p>2ã€é€šè¿‡è¡¨å• Widget ç»„åˆå®ç°äº†ä¸€ä¸ªç”¨æˆ·ä¿¡æ¯ç™»è®°ç³»ç»Ÿ</p><p>å¥½äº†ï¼Œæœ¬ç¯‡æ–‡ç« åˆ°è¿™é‡Œå°±ç»“æŸäº†ï¼Œå¸Œæœ›èƒ½ç»™ä½ å¸¦æ¥å¸®åŠ© ğŸ¤</p><p><strong>æ„Ÿè°¢ä½ é˜…è¯»è¿™ç¯‡æ–‡ç« </strong></p><h3 id="ä¸‹ç¯‡é¢„å‘Š"><a href="#ä¸‹ç¯‡é¢„å‘Š" class="headerlink" title="ä¸‹ç¯‡é¢„å‘Š"></a>ä¸‹ç¯‡é¢„å‘Š</h3><p>åç»­ä¸ä¼šèŠ±å¤§ç¯‡å¹…å»ä»‹ç» Widgetï¼Œæˆ‘ä¼šç©¿æ’åœ¨å…¶å®ƒçŸ¥è¯†ç‚¹ä¸­ç®€å•ä»‹ç»ä¸‹ï¼ŒFlutter ä¸­æœ‰ 400 å¤šä¸ª Widgetï¼Œä¸å¯èƒ½æ¯ä¸ªéƒ½å»å­¦ï¼Œæˆ‘çš„å»ºè®®ï¼šæŒæ¡å¸¸ç”¨çš„ï¼Œå…¶å®ƒç”¨åˆ°æ—¶åœ¨å»å®˜ç½‘æŸ¥è¯¢ã€‚</p><p>ä¸‹ç¯‡æ–‡ç« æˆ‘ä¼šè®² Flutter ä¸­çš„è·¯ç”±ä»¥åŠå®é™…å¼€å‘ä¸­è¯·æ±‚ Http æ¥å£æ¸²æŸ“é¡µé¢ï¼Œå°½è¯·æœŸå¾…å§ğŸº</p><h3 id="å‚è€ƒå’Œæ¨è"><a href="#å‚è€ƒå’Œæ¨è" class="headerlink" title="å‚è€ƒå’Œæ¨è"></a>å‚è€ƒå’Œæ¨è</h3><p><a href="https://www.bilibili.com/video/BV1S4411E7LY?p=19&vd_source=d0b24cb21c438ff4a9ac2e589eacb3d9">Flutter æ•™ç¨‹</a>ï¼šé€šä¿—æ˜“æ‡‚çš„ Flutter å…¥é—¨æ•™ç¨‹</p><blockquote><p><strong>ä½ çš„ç‚¹èµï¼Œè¯„è®ºï¼Œæ˜¯å¯¹æˆ‘å·¨å¤§çš„é¼“åŠ±ï¼</strong></p><p>æ¬¢è¿å…³æ³¨æˆ‘çš„<strong>å…¬ä¼—å·ï¼š</strong>  <a href="http://m6z.cn/6jwi7b"><strong>sweetying</strong></a> ï¼Œæ–‡ç« æ›´æ–°å¯ç¬¬ä¸€æ—¶é—´æ”¶åˆ°</p><p>å¦‚æœ<strong>æœ‰é—®é¢˜</strong>ï¼Œå…¬ä¼—å·å†…æœ‰åŠ æˆ‘å¾®ä¿¡çš„å…¥å£ï¼Œåœ¨æŠ€æœ¯å­¦ä¹ ã€ä¸ªäººæˆé•¿çš„é“è·¯ä¸Šï¼Œæˆ‘ä»¬ä¸€èµ·å‰è¿›ï¼</p></blockquote>]]></content>
    
    
    <categories>
      
      <category>Flutter</category>
      
    </categories>
    
    
    <tags>
      
      <tag>åŸåˆ›</tag>
      
      <tag>Flutter</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Flutter ç³»åˆ—ï¼ˆäº”ï¼‰ï¼šFlutter å¸¸ç”¨æŒ‰é’® Widget</title>
    <link href="/2022/10/10/Flutter%20%E7%B3%BB%E5%88%97%EF%BC%88%E4%BA%94%EF%BC%89%EF%BC%9AFlutter%20%E5%B8%B8%E7%94%A8%E6%8C%89%E9%92%AE%20Widget/"/>
    <url>/2022/10/10/Flutter%20%E7%B3%BB%E5%88%97%EF%BC%88%E4%BA%94%EF%BC%89%EF%BC%9AFlutter%20%E5%B8%B8%E7%94%A8%E6%8C%89%E9%92%AE%20Widget/</url>
    
    <content type="html"><![CDATA[<p><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/a784cd0ae6b1439a8c9e3d0ac0b92ea8~tplv-k3u1fbpfcp-watermark.image"></p><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>å¾ˆé«˜å…´é‡è§ä½ ~</p><p>åœ¨æœ¬ç³»åˆ—çš„ä¸Šä¸€ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡ï¼šæ•ˆæœå±•ç¤º -&gt; Widget ä»‹ç» -&gt; ä»£ç å®ç°çš„æ–¹å¼å¯¹ Imageï¼ŒListViewï¼ŒGridViewï¼ŒStack è¿›è¡Œäº†ä»‹ç»ï¼Œå¹¶ç©¿æ’è®²è§£äº†ä¸€äº›å…¶å®ƒ Widget ï¼Œæœ€åé€šè¿‡ä¸€ä¸ªç»¼åˆæ¡ˆä¾‹å¯¹å­¦ä¹ çš„ Widget è¿›è¡Œäº†ç»„åˆä½¿ç”¨ã€‚è¿˜æ²¡æœ‰çœ‹è¿‡ä¸Šä¸€ç¯‡æ–‡ç« çš„æœ‹å‹ï¼Œå»ºè®®å…ˆå»é˜…è¯» <a href="https://juejin.cn/post/7135827895993237541">Flutter ç³»åˆ—ï¼ˆå››ï¼‰ï¼šFlutter å¸¸ç”¨ Widget äºŒ</a>ã€‚æ¥ä¸‹æ¥æˆ‘ä»¬å¯¹ Flutter æŒ‰é’® Widget è¿›è¡Œå­¦ä¹ </p><p>Flutter ä¸­çš„æŒ‰é’® Widget æœ‰å¾ˆå¤šï¼Œå¸¸è§çš„æŒ‰é’® Widget æœ‰ï¼šRaisedButtonï¼ŒFlatButtonï¼ŒIconButtonï¼ŒOutlineButtonï¼ŒButtonBarï¼ŒFloatingActionButton ç­‰ï¼Œä¸‹é¢å°±ä»‹ç»ä¸€ä¸‹è¿™äº›å¸¸ç”¨çš„ Widget</p><h2 id="ä¸€ã€Flutter-å¸¸ç”¨æŒ‰é’®-Widget-ä»‹ç»"><a href="#ä¸€ã€Flutter-å¸¸ç”¨æŒ‰é’®-Widget-ä»‹ç»" class="headerlink" title="ä¸€ã€Flutter å¸¸ç”¨æŒ‰é’® Widget ä»‹ç»"></a>ä¸€ã€Flutter å¸¸ç”¨æŒ‰é’® Widget ä»‹ç»</h2><h3 id="1-1ã€Flutter-æŒ‰é’®-Widget-é€šç”¨å±æ€§"><a href="#1-1ã€Flutter-æŒ‰é’®-Widget-é€šç”¨å±æ€§" class="headerlink" title="1.1ã€Flutter æŒ‰é’® Widget é€šç”¨å±æ€§"></a>1.1ã€Flutter æŒ‰é’® Widget é€šç”¨å±æ€§</h3><p>é¦–å…ˆä»‹ç»ä¸€ä¸‹ï¼ŒæŒ‰é’® Widget éƒ½æœ‰çš„ä¸€äº›å±æ€§ï¼š</p><table><thead><tr><th>å±æ€§åç§°</th><th>å±æ€§ç±»å‹</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>onPressed</td><td>VoidCallback</td><td>æ­¤é¡¹ä¸ºå¿…å¡«å‚æ•°ï¼ŒæŒ‰ä¸‹æŒ‰é’®æ—¶è§¦å‘çš„å›è°ƒï¼Œæ¥æ”¶ä¸€ä¸ªæ–¹æ³•ä½œä¸ºå‚æ•°ï¼Œä¼  null è¡¨ç¤ºæŒ‰é’®ç¦ç”¨ï¼Œä¼šæ˜¾ç¤ºç¦ç”¨ç›¸å…³æ ·å¼</td></tr><tr><td>child</td><td>Widget</td><td>å­æ§ä»¶ï¼Œä¸€èˆ¬æˆ‘ä»¬ä¼šä½¿ç”¨æ–‡æœ¬ Widget æ¥å¡«å……</td></tr><tr><td>textColor</td><td>Color</td><td>æ–‡æœ¬é¢œè‰²</td></tr><tr><td>color</td><td>Color</td><td>æŒ‰é’®èƒŒæ™¯é¢œè‰²</td></tr><tr><td>disabledColor</td><td>Color</td><td>æŒ‰é’®ç¦ç”¨æ—¶çš„èƒŒæ™¯é¢œè‰²</td></tr><tr><td>disabledTextColor</td><td>Color</td><td>æŒ‰é’®ç¦ç”¨æ—¶çš„æ–‡æœ¬é¢œè‰²</td></tr><tr><td>splashColor</td><td>Color</td><td>ç‚¹å‡»æŒ‰é’®æ—¶çš„æ°´æ³¢çº¹é¢œè‰²</td></tr><tr><td>highlightColor</td><td>Color</td><td>é•¿æŒ‰æŒ‰é’®åæŒ‰é’®çš„èƒŒæ™¯é¢œè‰²</td></tr><tr><td>elevation</td><td>double</td><td>æŒ‰é’®é˜´å½±çš„èŒƒå›´ï¼Œå€¼è¶Šå¤§é˜´å½±èŒƒå›´è¶Šå¤§</td></tr><tr><td>padding</td><td>EdgeInsetsGeometry</td><td>å…§è¾¹è·</td></tr><tr><td>shape</td><td>ShapeBorder</td><td>è®¾ç½®æŒ‰é’®çš„å½¢çŠ¶ï¼ŒShapeBorder å®ç°ç±»æœ‰ï¼š<br>RoundedRectangleBorderï¼šåœ†è§’å½¢çŠ¶<br>CircleBorderï¼šåœ†å½¢å½¢çŠ¶</td></tr></tbody></table><p>ä»‹ç»å®Œäº†æŒ‰é’® Widget çš„é€šç”¨å±æ€§ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬çœ‹ä¸‹æ¯ä¸ªæŒ‰é’®åˆå§‹å½¢æ€çš„ä¸€ä¸ªæ•ˆæœï¼Œåœ¨ç»“åˆè¿™äº›æŒ‰é’®åšä¸€ä¸ªç»¼åˆæ¡ˆä¾‹</p><h3 id="1-2ã€RaisedButton"><a href="#1-2ã€RaisedButton" class="headerlink" title="1.2ã€RaisedButton"></a>1.2ã€RaisedButton</h3><p>RaisedButton è§åçŸ¥æ„ï¼šå‡¸èµ·çš„æŒ‰é’®ï¼Œå…¶å®å°±æ˜¯ Flutter ç»™æˆ‘ä»¬æä¾›çš„ Material Design é£æ ¼çš„æŒ‰é’®ï¼š</p><p>è¿è¡Œå¦‚ä¸‹ä»£ç ï¼š</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;package:flutter/material.dart&#x27;</span>;<br><br><span class="hljs-keyword">void</span> main() &#123;<br>  runApp(MaterialApp(<br>    home: Scaffold(<br>        appBar: AppBar(<br>          title: Text(<span class="hljs-string">&quot;Flutter Button Widget&quot;</span>), <span class="hljs-comment">//è®¾ç½®æ ‡é¢˜æ æ ‡é¢˜</span><br>        ),<br>        body: MyBodyPage() <span class="hljs-comment">//è‡ªå®šä¹‰ Widget</span><br>    ),<br>  ));<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyBodyPage</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">StatelessWidget</span> </span>&#123;<br>  <span class="hljs-meta">@override</span><br>  Widget build(BuildContext context) &#123;<br>    <span class="hljs-comment">//ä½¿ç”¨ ListView è®©æŒ‰é’®è‡ªé€‚åº”å±å¹•å®½åº¦</span><br>    <span class="hljs-keyword">return</span> ListView(<br>      <span class="hljs-comment">//å†…é—´è· 20</span><br>      padding: EdgeInsets.all(<span class="hljs-number">20</span>),<br>      children: [<br>        <span class="hljs-comment">//RaisedButton å‡¸èµ·æŒ‰é’®</span><br>        RaisedButton(<br>          onPressed:()&#123;&#125;,<br>          child: Text(<span class="hljs-string">&quot;RaisedButton&quot;</span>),<br>        )<br>      ],<br>    );<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æ•ˆæœå±•ç¤ºï¼š</p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/426f79d2652f4d379394b8cc28902bd9~tplv-k3u1fbpfcp-zoom-1.image" alt="image-20220828103722122" width="50%" /><p>é»˜è®¤æƒ…å†µä¸‹æ˜¯ä¸€ä¸ªç°è‰²èƒŒæ™¯çš„å‡¸èµ·æŒ‰é’®</p><h3 id="1-3ã€FlatButton"><a href="#1-3ã€FlatButton" class="headerlink" title="1.3ã€FlatButton"></a>1.3ã€FlatButton</h3><p>FlatButton è§åçŸ¥æ„ï¼šæ‰å¹³çš„æŒ‰é’®ï¼Œå’Œ RaiseButton åˆšå¥½ç›¸åï¼Œæ²¡æœ‰å‡¸èµ·çš„æ•ˆæœã€‚å°†ä¸Šè¿° RaiseButton æ¢æˆ FlatButton æ•ˆæœå¦‚ä¸‹ï¼š</p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/326cfc9abf8c421e842ba8c5cfc7131d~tplv-k3u1fbpfcp-zoom-1.image" alt="image-20220828110640212" width="50%" /><p>å¯ä»¥çœ‹åˆ°ï¼Œå®ƒæ²¡æœ‰èƒŒæ™¯ï¼Œå°±åƒä¸€ä¸ªæ–‡æœ¬ Widget ä¸€æ ·</p><h3 id="1-4ã€OutlineButton"><a href="#1-4ã€OutlineButton" class="headerlink" title="1.4ã€OutlineButton"></a>1.4ã€OutlineButton</h3><p>OutlineButton è§åçŸ¥æ„ï¼šå¸¦çº¿æ¡†çš„æŒ‰é’®ï¼Œå®ƒå°±åƒæ˜¯ FlatButton åŠ äº†ä¸€ä¸ªè¾¹æ¡†ã€‚å°†ä¸Šè¿° RaiseButton æ¢æˆ OutlineButton æ•ˆæœå¦‚ä¸‹ï¼š</p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/dee2a6a1417a4396b12500861737a30e~tplv-k3u1fbpfcp-watermark.image?" alt="outlinebutton.png" width="50%" /><h3 id="1-5ã€IconButton"><a href="#1-5ã€IconButton" class="headerlink" title="1.5ã€IconButton"></a>1.5ã€IconButton</h3><p>IconButton è§åçŸ¥æ„ï¼šå¸¦ Icon çš„æŒ‰é’®ã€‚å°†ä¸Šè¿° RaiseButton æ¢æˆ IconButton å¹¶åšå±æ€§çš„è°ƒæ•´ï¼š</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs dart">IconButton(<br>   icon: Icon(Icons.home),<br>   onPressed:()&#123;&#125;,<br>)<br></code></pre></td></tr></table></figure><p>æ•ˆæœå¦‚ä¸‹ï¼š</p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/fcf789f83b5248c3910ed88306c43099~tplv-k3u1fbpfcp-zoom-1.image" alt="image-20220828111723913" width="50%" /><h3 id="1-6ã€ButtonBar"><a href="#1-6ã€ButtonBar" class="headerlink" title="1.6ã€ButtonBar"></a>1.6ã€ButtonBar</h3><p>ButtonBar æ˜¯ä¸€ä¸ªæŒ‰é’®ç»„ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨å®ƒçš„ children å±æ€§ä¸­æ”¾å…¥å¤šä¸ªæŒ‰é’®ï¼Œå¦‚ä¸‹ä»£ç ï¼š</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;package:flutter/material.dart&#x27;</span>;<br><br><span class="hljs-keyword">void</span> main() &#123;<br>  runApp(MaterialApp(<br>    home: Scaffold(<br>        appBar: AppBar(<br>          title: Text(<span class="hljs-string">&quot;Flutter Button Widget&quot;</span>), <span class="hljs-comment">//è®¾ç½®æ ‡é¢˜æ æ ‡é¢˜</span><br>        ),<br>        body: MyBodyPage() <span class="hljs-comment">//è‡ªå®šä¹‰ Widget</span><br>    ),<br>  ));<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyBodyPage</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">StatelessWidget</span> </span>&#123;<br>  <span class="hljs-meta">@override</span><br>  Widget build(BuildContext context) &#123;<br>    <span class="hljs-keyword">return</span> ButtonBar(<br>      <span class="hljs-comment">//æŒ‰é’®ç»„</span><br>      children: [<br>        RaisedButton( <span class="hljs-comment">//RaisedButton</span><br>          onPressed: () &#123;&#125;,<br>          child: Text(<span class="hljs-string">&quot;RaisedButton&quot;</span>),<br>        ),<br>        FlatButton( <span class="hljs-comment">//FlatButton</span><br>          onPressed: () &#123;&#125;,<br>          child: Text(<span class="hljs-string">&quot;FlatButton&quot;</span>),<br>        ),<br>        OutlineButton( <span class="hljs-comment">//OutlineButton</span><br>          onPressed: () &#123;&#125;,<br>          child: Text(<span class="hljs-string">&quot;OutlineButton&quot;</span>),<br>        ),<br>        IconButton( <span class="hljs-comment">//IconButton</span><br>          icon: Icon(Icons.home),<br>          onPressed: () &#123;&#125;,<br>        )<br>      ],<br>    );<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æ•ˆæœï¼š</p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/c49b50b9684249e18c84c942c80e6af5~tplv-k3u1fbpfcp-zoom-1.image" alt="image-20220828112553805" width="50%" /><h3 id="1-7ã€FloatingActionButton"><a href="#1-7ã€FloatingActionButton" class="headerlink" title="1.7ã€FloatingActionButton"></a>1.7ã€FloatingActionButton</h3><p>FloatingActionButton ç®€ç§° FABï¼Œå¯ä»¥å®ç°æµ®åŠ¨æŒ‰é’®ã€‚å®ƒå¸¸ç”¨çš„ä¸€äº›å±æ€§ï¼š</p><table><thead><tr><th>å±æ€§åç§°</th><th>å±æ€§ç±»å‹</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>onPressed</td><td>VoidCallback</td><td>æ­¤é¡¹ä¸ºå¿…å¡«å‚æ•°ï¼ŒæŒ‰ä¸‹æŒ‰é’®æ—¶è§¦å‘çš„å›è°ƒï¼Œæ¥æ”¶ä¸€ä¸ªæ–¹æ³•ä½œä¸ºå‚æ•°ï¼Œä¼  null è¡¨ç¤ºæŒ‰é’®ç¦ç”¨ï¼Œä¼šæ˜¾ç¤ºç¦ç”¨ç›¸å…³æ ·å¼</td></tr><tr><td>child</td><td>Widget</td><td>å­æ§ä»¶ï¼Œä¸€èˆ¬ä¸º Iconï¼Œä¸æ¨èä½¿ç”¨æ–‡å­—</td></tr><tr><td>backgroundColor</td><td>Color</td><td>èƒŒæ™¯é¢œè‰²</td></tr><tr><td>elevation</td><td>double</td><td>æœªç‚¹å‡»æ—¶å€™çš„é˜´å½±</td></tr><tr><td>highlightElevation</td><td>double</td><td>ç‚¹å‡»æ—¶çš„é˜´å½±å€¼ï¼Œé»˜è®¤ä¸ºï¼š12.0</td></tr><tr><td>shape</td><td>ShapeBorder</td><td>å®šä¹‰ FAB çš„å½¢çŠ¶</td></tr><tr><td>mini</td><td>bool</td><td>æ˜¯å¦æ˜¯ mini ç±»å‹ï¼Œé»˜è®¤ä¸ºï¼šfalse</td></tr></tbody></table><p>å¦‚ä¸‹ä»£ç ï¼š</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;package:flutter/material.dart&#x27;</span>;<br><br><span class="hljs-keyword">void</span> main() &#123;<br>  runApp(MaterialApp(<br>    home: Scaffold(<br>        appBar: AppBar(<br>          title: Text(<span class="hljs-string">&quot;Flutter Button Widget&quot;</span>), <span class="hljs-comment">//è®¾ç½®æ ‡é¢˜æ æ ‡é¢˜</span><br>        ),<br>        body: MyBodyPage() <span class="hljs-comment">//è‡ªå®šä¹‰ Widget</span><br>    ),<br>  ));<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyBodyPage</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">StatelessWidget</span> </span>&#123;<br>  <span class="hljs-meta">@override</span><br>  Widget build(BuildContext context) &#123;<br>    <span class="hljs-keyword">return</span> ListView(<br>      padding: EdgeInsets.all(<span class="hljs-number">20</span>),<br>      children: [<br>        FloatingActionButton( <span class="hljs-comment">//FloatingActionButton æŒ‰é’®</span><br>          onPressed: ()&#123;&#125;,<br>          child: Icon(Icons.search),<br>          backgroundColor: Colors.lightGreen,<br>          elevation: <span class="hljs-number">20</span>,<br>        )<br>      ],<br>    );<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æ•ˆæœï¼š</p><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/ac14d2bb83594441b8d07bf8e131beb7~tplv-k3u1fbpfcp-watermark.image?" alt="floatingactionbutton.png" width="50%" /><h2 id="äºŒã€Flutter-2-x-æŒ‰é’®-Widget-çš„å˜åŒ–"><a href="#äºŒã€Flutter-2-x-æŒ‰é’®-Widget-çš„å˜åŒ–" class="headerlink" title="äºŒã€Flutter 2.x æŒ‰é’® Widget çš„å˜åŒ–"></a>äºŒã€Flutter 2.x æŒ‰é’® Widget çš„å˜åŒ–</h2><p>å¦‚æœä½ æ˜¯ Flutter 2.x çš„ç‰ˆæœ¬ï¼Œä½ ä¼šå‘ç°ä¹‹å‰çš„ä¸€äº›æŒ‰é’® Widget è¢«åºŸå¼ƒäº†ï¼š</p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/2e65c7518c914c4d82361cd1228732d4~tplv-k3u1fbpfcp-zoom-1.image" alt="image-20220828114616994" style="zoom:70%;" width="50%"/><p>ä¸»è¦æ˜¯ä¸Šé¢è¿™ä¸‰ä¸ªæŒ‰é’®çš„å˜åŒ–ï¼Œå–è€Œä»£ä¹‹çš„æ˜¯ï¼š</p><table><thead><tr><th>Flutter 1.x ä¸­çš„æŒ‰é’® Widget</th><th>Flutter 2.x ä¸­çš„æŒ‰é’® Widget</th></tr></thead><tbody><tr><td>RaisedButton å‡¸èµ·æŒ‰é’®</td><td>ElevatedButton å‡¸èµ·æŒ‰é’®</td></tr><tr><td>FlatButton æ‰å¹³æŒ‰é’®</td><td>TextButton æ‰å¹³æŒ‰é’®</td></tr><tr><td>OutlinedButton çº¿æ¡†æŒ‰é’®</td><td>OutlinedButton çº¿æ¡†æŒ‰é’®</td></tr></tbody></table><p>å¦å¤–åœ¨ 1.x ä¸­è®¾ç½®çš„ä¸€ç³»åˆ—å±æ€§ï¼Œå¦‚ï¼šcolorï¼ŒtextColorï¼Œelevationï¼Œshapeç­‰åœ¨ 2.x ä¸­éƒ½è¢«å°è£…åˆ°äº† style å±æ€§ä¸­ï¼Œstyle å±æ€§æ¥æ”¶ä¸€ä¸ª ButtonStyle ç±»å‹çš„å¯¹è±¡ï¼Œä»‹ç»ä¸€ä¸‹ ButtonStyle ä¸­çš„å¸¸ç”¨å±æ€§ï¼š</p><table><thead><tr><th>å±æ€§åç§°</th><th>å±æ€§ç±»å‹</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>textStyle</td><td>MaterialStateProperty<TextStyle></td><td>æ–‡æœ¬çš„æ ·å¼ ä½†æ˜¯å¯¹äºé¢œè‰²æ˜¯ä¸èµ·ä½œç”¨çš„</td></tr><tr><td>backgroundColor</td><td>MaterialStateProperty<Color></td><td>æŒ‰é’®èƒŒæ™¯è‰²</td></tr><tr><td>foregroundColor</td><td>MaterialStateProperty<Color></td><td>æ–‡æœ¬åŠå›¾æ ‡é¢œè‰²</td></tr><tr><td>overlayColor</td><td>MaterialStateProperty<Color></td><td>é«˜äº®è‰²ï¼ŒæŒ‰é’®å¤„äº focusedï¼Œhovered or pressed æ—¶çš„é¢œè‰²</td></tr><tr><td>shadowColor</td><td>MaterialStateProperty<Color></td><td>é˜´å½±é¢œè‰²</td></tr><tr><td>elevation</td><td>MaterialStateProperty<double></td><td>æŒ‰é’®é˜´å½±çš„èŒƒå›´ï¼Œå€¼è¶Šå¤§é˜´å½±èŒƒå›´è¶Šå¤§</td></tr><tr><td>padding</td><td>MaterialStateProperty<EdgeInsetsGeometry></td><td>æŒ‰é’®å†…è¾¹è·</td></tr><tr><td>minimumSize</td><td>MaterialStateProperty<Size></td><td>æŒ‰é’®æœ€å°å€¼</td></tr><tr><td>fixedSize</td><td>MaterialStateProperty<Size></td><td>æŒ‰é’®å¤§å°</td></tr><tr><td>maximumSize</td><td>MaterialStateProperty<Size></td><td>æŒ‰é’®æœ€å¤§å€¼</td></tr><tr><td>side</td><td>MaterialStateProperty<BorderSide></td><td>è¾¹æ¡†</td></tr><tr><td>shape</td><td>MaterialStateProperty<OutlinedBorder></td><td>è®¾ç½®æŒ‰é’®çš„å½¢çŠ¶</td></tr><tr><td>alignment</td><td>AlignmentGeometry</td><td>æŒ‰é’®å­ Widget å¯¹é½æ–¹å¼</td></tr></tbody></table><p>å®è·µå¯¹æ¯”ï¼š</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;package:flutter/material.dart&#x27;</span>;<br><br><span class="hljs-keyword">void</span> main() &#123;<br>  runApp(MaterialApp(<br>    home: Scaffold(<br>        appBar: AppBar(<br>          title: Text(<span class="hljs-string">&quot;Flutter Button Widget&quot;</span>), <span class="hljs-comment">//è®¾ç½®æ ‡é¢˜æ æ ‡é¢˜</span><br>        ),<br>        body: MyBodyPage() <span class="hljs-comment">//è‡ªå®šä¹‰ Widget</span><br>    ),<br>  ));<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyBodyPage</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">StatelessWidget</span> </span>&#123;<br>  <span class="hljs-meta">@override</span><br>  Widget build(BuildContext context) &#123;<br>    <span class="hljs-keyword">return</span> ListView(<br>      padding: EdgeInsets.all(<span class="hljs-number">20</span>),<br>      children: [<br>        RaisedButton( <span class="hljs-comment">//RaisedButton</span><br>          onPressed: ()&#123;&#125;,<br>          child: Text(<span class="hljs-string">&quot;RaisedButton&quot;</span>),<br>          textColor: Colors.white, <span class="hljs-comment">//æ–‡æœ¬é¢œè‰²</span><br>          color: Colors.green, <span class="hljs-comment">//æŒ‰é’®èƒŒæ™¯é¢œè‰²</span><br>          splashColor: Colors.red, <span class="hljs-comment">//æ°´æ³¢çº¹é¢œè‰²</span><br>          elevation: <span class="hljs-number">20</span>, <span class="hljs-comment">//é˜´å½±çš„èŒƒå›´</span><br>          shape: RoundedRectangleBorder( <span class="hljs-comment">//è®¾ç½® 20 çš„åœ†è§’</span><br>            borderRadius: BorderRadius.circular(<span class="hljs-number">20</span>)<br>          )<br>        ),<br>        SizedBox(height: <span class="hljs-number">40</span>),<br>        ElevatedButton( <span class="hljs-comment">//ElevatedButton</span><br>            onPressed: ()&#123;&#125;,<br>            child: Text(<span class="hljs-string">&quot;ElevatedButton&quot;</span>),<br>            style: ButtonStyle(<br>              foregroundColor: MaterialStateProperty.all(Colors.white), <span class="hljs-comment">//æ–‡æœ¬é¢œè‰²</span><br>              backgroundColor: MaterialStateProperty.all(Colors.green), <span class="hljs-comment">//æŒ‰é’®èƒŒæ™¯é¢œè‰²</span><br>              overlayColor: MaterialStateProperty.all(Colors.red), <span class="hljs-comment">//æ°´æ³¢çº¹é¢œè‰²</span><br>              elevation: MaterialStateProperty.all(<span class="hljs-number">20</span>), <span class="hljs-comment">//é˜´å½±çš„èŒƒå›´</span><br>              shape: MaterialStateProperty.all(<span class="hljs-comment">//è®¾ç½® 20 çš„åœ†è§’</span><br>                  RoundedRectangleBorder(<br>                      borderRadius: BorderRadius.circular(<span class="hljs-number">20</span>)<br>                  )<br>              )<br>            ),<br>        )<br>      ],<br>    );<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æ•ˆæœï¼š</p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/2f82277a9e354bf18e7249a66b799c94~tplv-k3u1fbpfcp-zoom-1.image" alt="image-20220828134202212" width="50%" /><h2 id="ä¸‰ã€æŒ‰é’®-Widget-ç»„åˆä¹‹ç»¼åˆæ¡ˆä¾‹"><a href="#ä¸‰ã€æŒ‰é’®-Widget-ç»„åˆä¹‹ç»¼åˆæ¡ˆä¾‹" class="headerlink" title="ä¸‰ã€æŒ‰é’® Widget ç»„åˆä¹‹ç»¼åˆæ¡ˆä¾‹"></a>ä¸‰ã€æŒ‰é’® Widget ç»„åˆä¹‹ç»¼åˆæ¡ˆä¾‹</h2><p>åœ¨è®²ç»¼åˆæ¡ˆä¾‹ä¹‹å‰æˆ‘ä»¬å…ˆå­¦ä¹ ä¸‹ BottomNavigationBar ï¼Œä¸€ä¼šä¼šç”¨åˆ°</p><h3 id="3-1ã€BottomNavigationBar-ä»‹ç»"><a href="#3-1ã€BottomNavigationBar-ä»‹ç»" class="headerlink" title="3.1ã€BottomNavigationBar ä»‹ç»"></a>3.1ã€BottomNavigationBar ä»‹ç»</h3><p>BottomNavigationBar æ˜¯ Flutter ç»™æˆ‘ä»¬æä¾›çš„åº•éƒ¨å¯¼èˆªæ  Widgetï¼Œä¸€èˆ¬ç”¨åœ¨ Scaffold çš„ bottomNavigationBar å±æ€§ä¸­</p><p>BottomNavigationBar å¸¸ç”¨å±æ€§ä»‹ç»ï¼š</p><table><thead><tr><th>å±æ€§åç§°</th><th>å±æ€§ç±»å‹</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>items</td><td>List<BottomNavigationBarItem></td><td>å¿…é¡»å±æ€§ï¼Œæœ€å°‘è¦æœ‰ä¸¤ä¸ªå­ Widget</td></tr><tr><td>onTap</td><td>ValueChanged</td><td>Widget ç‚¹å‡»äº‹ä»¶</td></tr><tr><td>currentIndex</td><td>int</td><td>å½“å‰æ˜¾ç¤ºçš„æ˜¯å“ªä¸ª Widget</td></tr><tr><td>elevation</td><td>double</td><td>é˜´å½±èŒƒå›´</td></tr><tr><td>type</td><td>BottomNavigationBarType</td><td>BottomNavigationBarType.fixedï¼šå›ºå®š<br>BottomNavigationBarType.shiftingï¼šå¯æ»‘åŠ¨</td></tr><tr><td>fixedColor</td><td>Color</td><td>ç›¸å½“äº selectedItemColorï¼Œä½†æ˜¯ä¸èƒ½è·Ÿ selectedItemColor åŒæ—¶å­˜åœ¨</td></tr><tr><td>backgroundColor</td><td>Color</td><td>èƒŒæ™¯é¢œè‰²</td></tr><tr><td>iconSize</td><td>double</td><td>è®¾ç½®å›¾æ ‡å¤§å°</td></tr><tr><td>selectedItemColor</td><td>Color</td><td>è®¾ç½® Widget é€‰ä¸­çš„é¢œè‰²</td></tr><tr><td>unselectedItemColor</td><td>Color</td><td>è®¾ç½® Widget æœªé€‰ä¸­çš„é¢œè‰²</td></tr><tr><td>selectedFontSize</td><td>double</td><td>è®¾ç½® Widget é€‰ä¸­æ—¶æ–‡å­—çš„å¤§å°</td></tr><tr><td>unselectedFontSize</td><td>double</td><td>è®¾ç½® Widget æœªé€‰ä¸­æ—¶æ–‡å­—çš„å¤§å°</td></tr></tbody></table><p>è¿è¡Œä¸‹é¢ä»£ç ï¼š</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;package:flutter/material.dart&#x27;</span>;<br><br><span class="hljs-keyword">void</span> main() &#123;<br>  runApp(MaterialApp(<br>    home: Scaffold(<br>        appBar: AppBar(<br>          title: Text(<span class="hljs-string">&quot;Flutter Button Widget&quot;</span>), <span class="hljs-comment">//è®¾ç½®æ ‡é¢˜æ æ ‡é¢˜</span><br>        ),<br>        bottomNavigationBar: MyBottomNavigationBar(),<br>    ),<br>  ));<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyBottomNavigationBar</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">StatelessWidget</span> </span>&#123;<br>  <span class="hljs-meta">@override</span><br>  Widget build(BuildContext context) &#123;<br>    <span class="hljs-keyword">return</span> BottomNavigationBar(<br>        iconSize: <span class="hljs-number">35</span>, <span class="hljs-comment">//å›¾æ ‡å¤§å° 35</span><br>        fixedColor: Colors.green, <span class="hljs-comment">//å›¾ç‰‡é¢œè‰²ç»¿è‰²</span><br>        type: BottomNavigationBarType.fixed, <span class="hljs-comment">//item å›ºå®šæ˜¾ç¤º</span><br>        items: [ <span class="hljs-comment">//è®¾ç½®äº† 3 ä¸ª å­ item</span><br>          BottomNavigationBarItem(icon: Icon(Icons.home), label: <span class="hljs-string">&quot;é¦–é¡µ&quot;</span>),<br>          BottomNavigationBarItem(icon: Icon(Icons.category), label: <span class="hljs-string">&quot;åˆ†ç±»&quot;</span>),<br>          BottomNavigationBarItem(icon: Icon(Icons.settings), label: <span class="hljs-string">&quot;è®¾ç½®&quot;</span>)<br>        ]);<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æ•ˆæœï¼š</p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/492432dd8d8e497a838565e7b619a70b~tplv-k3u1fbpfcp-zoom-1.image" width="30%"/><h3 id="3-2ã€ç»¼åˆæ¡ˆä¾‹"><a href="#3-2ã€ç»¼åˆæ¡ˆä¾‹" class="headerlink" title="3.2ã€ç»¼åˆæ¡ˆä¾‹"></a>3.2ã€ç»¼åˆæ¡ˆä¾‹</h3><p>æ¥ä¸‹æ¥æˆ‘ä»¬å°±ä½¿ç”¨æŒ‰é’® Widget ç»„åˆæ¥å®ç°å¦‚ä¸‹æ•ˆæœï¼š</p><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/cf7e80059f054488a3cf02691ed3521f~tplv-k3u1fbpfcp-watermark.image?" alt="button_together.png" width="30%" /><p>ç®€å•çš„åˆ†æä¸‹è¿™ä¸ªé¡µé¢ï¼šæœ€å¤–å±‚æœ‰ä¸ªå†…é—´è·ï¼ˆPaddingï¼‰ï¼Œæ¥ä¸‹æ¥å°±æ˜¯ä¸€ä¸ªä»ä¸Šå¾€ä¸‹æ’åˆ—çš„å‚ç›´å¸ƒå±€ï¼ˆColumnï¼‰ï¼Œå‚ç›´å¸ƒå±€é‡Œé¢æœ‰ä¸€ç³»åˆ—ä½¿ç”¨ button å®ç°çš„æŒ‰é’®ï¼Œç®€å•èµ·è§ï¼Œæˆ‘ä»¬è¿™é‡Œä½¿ç”¨ Flutter 1.x ç³»åˆ—çš„ Button å»å®ç°ï¼Œæœ€ååº•éƒ¨æœ‰ä¸€ä¸ª BottomNavigationBarï¼ŒBottomNavigationBar ä¸­é—´æœ‰ä¸€ä¸ªå‡¸èµ·çš„ FloatingActionButtonï¼Œç±»ä¼¼å’¸é±¼ä¸­é—´å‘å¸ƒæŒ‰é’®çš„æ•ˆæœã€‚</p><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°±ç”¨ä»£ç å®ç°ä¸€ä¸‹ï¼š</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;package:flutter/material.dart&#x27;</span>;<br><br><span class="hljs-keyword">void</span> main() &#123;<br>  runApp(MaterialApp(<br>    home: Scaffold(<br>      appBar: AppBar(<br>        title: Text(<span class="hljs-string">&quot;Flutter Button Practice&quot;</span>), <span class="hljs-comment">//è®¾ç½®æ ‡é¢˜æ æ ‡é¢˜</span><br>      ),<br>      body: MyBodyPage(), <span class="hljs-comment">//è‡ªå®šä¹‰ body Wdiget</span><br>      bottomNavigationBar: MyBottomNavigationBar(), <span class="hljs-comment">//è‡ªå®šä¹‰ bottomNavigationBar Widget</span><br>      floatingActionButton: MyFloatingActionButton(), <span class="hljs-comment">//è‡ªå®šä¹‰ floatingActionButton Widget</span><br>      floatingActionButtonLocation: FloatingActionButtonLocation.centerDocked, <span class="hljs-comment">//floatingActionButton åœ¨åº•éƒ¨ä¸­å¿ƒåœé </span><br>    ),<br>  ));<br>&#125;<br><br><span class="hljs-comment">//è‡ªå®šä¹‰ BottomNavigationBar</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyBottomNavigationBar</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">StatelessWidget</span> </span>&#123;<br>  <span class="hljs-meta">@override</span><br>  Widget build(BuildContext context) &#123;<br>    <span class="hljs-keyword">return</span> BottomNavigationBar(<br>        iconSize: <span class="hljs-number">35</span>, <span class="hljs-comment">//å›¾æ ‡å¤§å° 35</span><br>        fixedColor: Colors.green, <span class="hljs-comment">//é€‰ä¸­é¢œè‰²ä¸ºç»¿è‰²</span><br>        type: BottomNavigationBarType.fixed, <span class="hljs-comment">//item å›ºå®šæ˜¾ç¤º</span><br>        items: [ <span class="hljs-comment">//è®¾ç½®äº† 3 ä¸ª å­ item</span><br>          BottomNavigationBarItem(icon: Icon(Icons.home), label: <span class="hljs-string">&quot;é¦–é¡µ&quot;</span>),<br>          BottomNavigationBarItem(icon: Icon(Icons.category), label: <span class="hljs-string">&quot;åˆ†ç±»&quot;</span>),<br>          BottomNavigationBarItem(icon: Icon(Icons.settings), label: <span class="hljs-string">&quot;è®¾ç½®&quot;</span>)<br>        ]);<br>  &#125;<br>&#125;<br><br><span class="hljs-comment">//è‡ªå®šä¹‰ FloatingActionButton</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyFloatingActionButton</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">StatelessWidget</span></span>&#123;<br>  <span class="hljs-meta">@override</span><br>  Widget build(BuildContext context) &#123;<br>    <span class="hljs-comment">//ä½¿ç”¨ Container åŒ…è£¹ FloatingActionButton åœ¨å¤–å±‚åŠ ä¸€ä¸ªç™½è‰²çš„è¾¹æ¡†</span><br>    <span class="hljs-keyword">return</span>  Container(<br>      width: <span class="hljs-number">80</span>,<br>      height: <span class="hljs-number">80</span>,<br>      padding: EdgeInsets.all(<span class="hljs-number">8</span>),<br>      decoration: BoxDecoration(<br>          color: Colors.white,<br>          borderRadius: BorderRadius.circular(<span class="hljs-number">40</span>)<br>      ),<br>      child: FloatingActionButton(<br>        backgroundColor: Colors.yellow,<br>        onPressed: ()&#123;&#125;,<br>        child: Icon(Icons.add),<br>      ),<br>    );<br>  &#125;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyBodyPage</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">StatelessWidget</span> </span>&#123;<br>  <span class="hljs-meta">@override</span><br>  Widget build(BuildContext context) &#123;<br>    <span class="hljs-keyword">return</span> Padding(<span class="hljs-comment">//Padding å®ç°å†…é—´è· 20</span><br>      padding: EdgeInsets.all(<span class="hljs-number">20</span>),<br>      child: Column(<br>        children: [<br>          Row( <span class="hljs-comment">//ç¬¬ä¸€æ’ï¼šæ™®é€šæŒ‰é’® + çº¢è‰²æŒ‰é’® + å¸¦é˜´å½±çš„æŒ‰é’®</span><br>            children: [<br>              RaisedButton(<br>                onPressed: ()&#123;&#125;,<br>                child: Text(<span class="hljs-string">&quot;æ™®é€šæŒ‰é’®&quot;</span>),<br>              ),<br>              SizedBox(width: <span class="hljs-number">20</span>),<br>              RaisedButton(<br>                onPressed: ()&#123;&#125;,<br>                child: Text(<span class="hljs-string">&quot;çº¢è‰²æŒ‰é’®&quot;</span>),<br>                color: Colors.red,<br>                textColor: Colors.white,<br>              ),<br>              SizedBox(width: <span class="hljs-number">20</span>),<br>              RaisedButton(<br>                onPressed: ()&#123;&#125;,<br>                child: Text(<span class="hljs-string">&quot;å¸¦é˜´å½±çš„æŒ‰é’®&quot;</span>),<br>                color: Colors.blue,<br>                textColor: Colors.white,<br>                elevation: <span class="hljs-number">20</span>,<br>              )<br>            ],<br>          ),<br>          SizedBox(height: <span class="hljs-number">20</span>),<br>          Container( <span class="hljs-comment">//ç¬¬äºŒæ’ï¼šè‡ªé€‚åº”æŒ‰é’®</span><br>            height: <span class="hljs-number">60</span>,<br>            width: <span class="hljs-built_in">double</span>.infinity,<br>            child: RaisedButton(<br>              onPressed: () &#123;&#125;,<br>              child: Text(<span class="hljs-string">&quot;è‡ªé€‚åº”æŒ‰é’®&quot;</span>),<br>              textColor: Colors.white,<br>              color: Colors.blue,<br>            ),<br>          ),<br>          SizedBox(height: <span class="hljs-number">20</span>),<br>          Row(children: [ <span class="hljs-comment">//ç¬¬ä¸‰æ’ï¼šicon æŒ‰é’® + æœ‰å®½é«˜çš„æŒ‰é’®</span><br>            RaisedButton.icon(<br>              onPressed: ()&#123;&#125;,<br>              icon: Icon(Icons.home),<br>              label: Text(<span class="hljs-string">&quot; Icon æŒ‰é’®&quot;</span>),<br>              color: Colors.yellow,<br>              textColor: Colors.green,<br>            ),<br>            SizedBox(width: <span class="hljs-number">20</span>),<br>            Container(<br>              height: <span class="hljs-number">60</span>,<br>              width: <span class="hljs-number">200</span>,<br>              child: RaisedButton(<br>                onPressed: () &#123;&#125;,<br>                child: Text(<span class="hljs-string">&quot;æœ‰å®½é«˜çš„æŒ‰é’®&quot;</span>),<br>                textColor: Colors.white,<br>                color: Colors.orange,<br>              ),<br>            )<br>          ]),<br>          SizedBox(height: <span class="hljs-number">20</span>),<br>          Container( <span class="hljs-comment">//ç¬¬å››æ’ï¼šè‡ªé€‚åº”å¸¦åœ†è§’çš„æŒ‰é’®</span><br>            height: <span class="hljs-number">60</span>,<br>            width: <span class="hljs-built_in">double</span>.infinity,<br>            child: RaisedButton(<br>              onPressed: () &#123;&#125;,<br>              child: Text(<span class="hljs-string">&quot;è‡ªé€‚åº”å¸¦åœ†è§’çš„æŒ‰é’®&quot;</span>),<br>              textColor: Colors.white,<br>              color: Colors.blue,<br>              shape: RoundedRectangleBorder(<br>                  borderRadius: BorderRadius.circular(<span class="hljs-number">100</span>)<br>              ),<br>            ),<br>          ),<br>          SizedBox(height: <span class="hljs-number">20</span>),<br>          Container( <span class="hljs-comment">//ç¬¬äº”æ’ï¼šåœ†å½¢æŒ‰é’®</span><br>            height: <span class="hljs-number">100</span>,<br>            width: <span class="hljs-number">150</span>,<br>            child: RaisedButton(<br>              onPressed: () &#123;&#125;,<br>              child: Text(<span class="hljs-string">&#x27;åœ†å½¢æŒ‰é’®&#x27;</span>),<br>              textColor: Colors.white,<br>              color: Colors.lightGreen,<br>              elevation: <span class="hljs-number">20</span>,<br>              splashColor: Colors.green,<br>              shape: CircleBorder(side: BorderSide(color: Colors.white)),<br>            ),<br>          ),<br>          SizedBox(height: <span class="hljs-number">20</span>),<br>          Container( <span class="hljs-comment">//ç¬¬å…­æ’ï¼šæ³¨å†ŒæŒ‰é’®</span><br>            width: <span class="hljs-built_in">double</span>.infinity,<br>            height: <span class="hljs-number">50</span>,<br>            margin: EdgeInsets.fromLTRB(<span class="hljs-number">20</span>, <span class="hljs-number">0</span>, <span class="hljs-number">20</span>, <span class="hljs-number">0</span>),<br>            child:  OutlineButton(<br>              child: Text(<span class="hljs-string">&quot;æ³¨å†Œ&quot;</span>),<br>              onPressed: ()&#123;&#125;,<br>              borderSide: BorderSide(<br>                  width: <span class="hljs-number">1</span>,<br>                  color: Colors.red<br>              ),<br>            ),<br>          ),<br>          SizedBox(height: <span class="hljs-number">20</span>),<br>          Container( <span class="hljs-comment">//ç¬¬ä¸ƒæ’ï¼šç™»é™†æŒ‰é’®</span><br>            width: <span class="hljs-built_in">double</span>.infinity,<br>            height: <span class="hljs-number">50</span>,<br>            margin: EdgeInsets.fromLTRB(<span class="hljs-number">20</span>, <span class="hljs-number">0</span>, <span class="hljs-number">20</span>, <span class="hljs-number">0</span>),<br>            child:  RaisedButton(<br>              child: Text(<span class="hljs-string">&quot;ç™»é™†&quot;</span>),<br>              onPressed: ()&#123;&#125;,<br>              color: Colors.blue,<br>              textColor: Colors.white,<br>            ),<br>          )<br>        ],<br>      ),<br>    );<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="å››ã€æ€»ç»“"><a href="#å››ã€æ€»ç»“" class="headerlink" title="å››ã€æ€»ç»“"></a>å››ã€æ€»ç»“</h2><p>æœ¬ç¯‡æˆ‘ä»¬è®²äº†ï¼š</p><p>1ã€Flutter ä¸­å¸¸ç”¨çš„æŒ‰é’® Widget ï¼šRaisedButtonï¼ŒFlatButtonï¼ŒIconButtonï¼ŒOutlineButtonï¼ŒButtonBarï¼ŒFloatingActionButton</p><p>2ã€ä»‹ç»äº† Flutter 1.x å’Œ Flutter 2.x æŒ‰é’®ç›¸å…³çš„å˜åŒ–åŠä½¿ç”¨</p><blockquote><p>Flutter 2.x ä¸­å¸¸ç”¨çš„å±æ€§éƒ½è¢«å°è£…åˆ°äº† style å±æ€§ä¸­</p></blockquote><p>3ã€ä»‹ç»äº† BottomNavigationBarï¼Œå¹¶é€šè¿‡ Flutter 1.x ç›¸å…³ Button + BottomNavigationBar + FloatingActionButton å®ç°äº†ä¸€ä¸ªç»¼åˆæ¡ˆä¾‹</p><p>å¥½äº†ï¼Œæœ¬ç¯‡æ–‡ç« åˆ°è¿™é‡Œå°±ç»“æŸäº†ï¼Œå¸Œæœ›èƒ½ç»™ä½ å¸¦æ¥å¸®åŠ© ğŸ¤</p><p><strong>æ„Ÿè°¢ä½ é˜…è¯»è¿™ç¯‡æ–‡ç« </strong></p><h3 id="ä¸‹ç¯‡é¢„å‘Š"><a href="#ä¸‹ç¯‡é¢„å‘Š" class="headerlink" title="ä¸‹ç¯‡é¢„å‘Š"></a>ä¸‹ç¯‡é¢„å‘Š</h3><p>ä¸‹ç¯‡æ–‡ç« æˆ‘ä¼šä»‹ç» Flutter è¡¨å•ç›¸å…³ Widget ï¼Œå°½è¯·æœŸå¾…å§ğŸ˜„</p><h3 id="å‚è€ƒå’Œæ¨è"><a href="#å‚è€ƒå’Œæ¨è" class="headerlink" title="å‚è€ƒå’Œæ¨è"></a>å‚è€ƒå’Œæ¨è</h3><p><a href="https://www.bilibili.com/video/BV1S4411E7LY?p=19&vd_source=d0b24cb21c438ff4a9ac2e589eacb3d9">Flutter æ•™ç¨‹</a>ï¼šé€šä¿—æ˜“æ‡‚çš„ Flutter å…¥é—¨æ•™ç¨‹</p><blockquote><p><strong>ä½ çš„ç‚¹èµï¼Œè¯„è®ºï¼Œæ˜¯å¯¹æˆ‘å·¨å¤§çš„é¼“åŠ±ï¼</strong></p><p>æ¬¢è¿å…³æ³¨æˆ‘çš„<strong>å…¬ä¼—å·ï¼š</strong>  <a href="http://m6z.cn/6jwi7b"><strong>sweetying</strong></a> ï¼Œæ–‡ç« æ›´æ–°å¯ç¬¬ä¸€æ—¶é—´æ”¶åˆ°</p><p>å¦‚æœ<strong>æœ‰é—®é¢˜</strong>ï¼Œå…¬ä¼—å·å†…æœ‰åŠ æˆ‘å¾®ä¿¡çš„å…¥å£ï¼Œåœ¨æŠ€æœ¯å­¦ä¹ ã€ä¸ªäººæˆé•¿çš„é“è·¯ä¸Šï¼Œæˆ‘ä»¬ä¸€èµ·å‰è¿›ï¼</p></blockquote>]]></content>
    
    
    <categories>
      
      <category>Flutter</category>
      
    </categories>
    
    
    <tags>
      
      <tag>åŸåˆ›</tag>
      
      <tag>Flutter</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Flutter ç³»åˆ—ï¼ˆå››ï¼‰ï¼šFlutter å¸¸ç”¨ Widget äºŒ</title>
    <link href="/2022/10/10/Flutter%20%E7%B3%BB%E5%88%97%EF%BC%88%E5%9B%9B%EF%BC%89%EF%BC%9AFlutter%20%E5%B8%B8%E7%94%A8%20Widget%20%E4%BA%8C/"/>
    <url>/2022/10/10/Flutter%20%E7%B3%BB%E5%88%97%EF%BC%88%E5%9B%9B%EF%BC%89%EF%BC%9AFlutter%20%E5%B8%B8%E7%94%A8%20Widget%20%E4%BA%8C/</url>
    
    <content type="html"><![CDATA[<p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/0a6163b15995449799850cef6fd5508c~tplv-k3u1fbpfcp-watermark.image"></p><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>å¾ˆé«˜å…´é‡è§ä½ ~</p><p>åœ¨æœ¬ç³»åˆ—çš„ä¸Šä¸€ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬ä»‹ç»äº† Flutter ç‰¹ç‚¹ä»¥åŠä¸€äº›å¸¸ç”¨çš„ Widgetï¼šMaterialAppï¼ŒScaffoldï¼ŒAppBarï¼ŒCenterï¼ŒContainerï¼ŒTextã€‚è¿˜æ²¡æœ‰çœ‹è¿‡ä¸Šä¸€ç¯‡æ–‡ç« çš„æœ‹å‹ï¼Œå»ºè®®å…ˆå»é˜…è¯» <a href="https://juejin.cn/post/7134343543975313445">Flutter ç³»åˆ—ï¼ˆä¸‰ï¼‰ï¼šFlutter ç‰¹ç‚¹åŠå¸¸ç”¨ Widget ä»‹ç»</a>ã€‚æ¥ä¸‹æ¥æˆ‘ä»¬ç»§ç»­å¯¹ Flutter Widget è¿›è¡Œå­¦ä¹ </p><p>ä¸‹é¢æˆ‘ä¼šé€šè¿‡ï¼šæ•ˆæœå±•ç¤º -&gt; Widget è®²è§£ -&gt; ä»£ç å®ç°çš„æ–¹å¼å¯¹ Widget è¿›è¡Œä»‹ç»ï¼Œæœ€ååœ¨é€šè¿‡ Widget ç»„åˆç¼–å†™ä¸€ä¸ªç»¼åˆçš„æ¡ˆä¾‹</p><h2 id="ä¸€ã€Flutter-Widget-ä¹‹-Image"><a href="#ä¸€ã€Flutter-Widget-ä¹‹-Image" class="headerlink" title="ä¸€ã€Flutter Widget ä¹‹ Image"></a>ä¸€ã€Flutter Widget ä¹‹ Image</h2><p>Image æ˜¯ Flutter ç»™æˆ‘ä»¬æä¾›æ˜¾ç¤ºå›¾ç‰‡çš„ Widget</p><p>å…ˆçœ‹ä¸€çœ¼ä½¿ç”¨ Image å®ç°çš„æ•ˆæœ</p><h3 id="1-1ã€Image-æ•ˆæœå±•ç¤º"><a href="#1-1ã€Image-æ•ˆæœå±•ç¤º" class="headerlink" title="1.1ã€Image æ•ˆæœå±•ç¤º"></a>1.1ã€Image æ•ˆæœå±•ç¤º</h3><p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/f9c9d4e9e7b94ef0bb5299fd62faa8ae~tplv-k3u1fbpfcp-watermark.image" alt="flutter_01 (2).png"></p><p>åˆ˜äº¦è²çš„åœ†å½¢å›¾ç‰‡ğŸ˜„ï¼Œç¾çˆ†äº†ã€‚è¨€å½’æ­£ä¼ ï¼Œå¤§å®¶å¯ä»¥å…ˆæƒ³ä¸€ä¸‹æ€ä¹ˆå»å®ç°ï¼Ÿ</p><h3 id="1-2ã€Image-ä»‹ç»"><a href="#1-2ã€Image-ä»‹ç»" class="headerlink" title="1.2ã€Image ä»‹ç»"></a>1.2ã€Image ä»‹ç»</h3><p>Image ç»„ä»¶æœ‰å¾ˆå¤šæ„é€ æ–¹æ³•ï¼Œè¿™é‡Œç»™å¤§å®¶è®²ä¸¤ä¸ªå¸¸ç”¨çš„ï¼š</p><p>1ã€Image.network ï¼šåŠ è½½è¿œç¨‹å›¾ç‰‡</p><p>2ã€Image.asset ï¼šåŠ è½½æœ¬åœ°å›¾ç‰‡</p><p>ä¸Šé¢è¿™ä¸¤ä¸ªå±äº Image çš„å‘½åæ„é€ æ–¹æ³•ï¼Œå¯¹å‘½åæ„é€ æ–¹æ³•è¿˜ä¸ç†Ÿæ‚‰çš„èµ¶ç´§å…ˆå»çœ‹ä¸€ä¸‹æˆ‘çš„å¦ä¸€ç¯‡æ–‡ç« <a href="https://juejin.cn/post/7130647339294785549#heading-0">ä¼ é€é—¨</a></p><h4 id="1-2-1ã€Image-network-åŠ è½½è¿œç¨‹å›¾ç‰‡"><a href="#1-2-1ã€Image-network-åŠ è½½è¿œç¨‹å›¾ç‰‡" class="headerlink" title="1.2.1ã€Image.network åŠ è½½è¿œç¨‹å›¾ç‰‡"></a>1.2.1ã€Image.network åŠ è½½è¿œç¨‹å›¾ç‰‡</h4><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;package:flutter/material.dart&#x27;</span>;<br><br><span class="hljs-keyword">void</span> main() &#123;<br>  runApp(MaterialApp(<br>    home: Scaffold(<br>      appBar: AppBar(<br>        title: Text(<span class="hljs-string">&quot;Flutter Image Widget&quot;</span>),<span class="hljs-comment">//è®¾ç½®æ ‡é¢˜æ æ ‡é¢˜</span><br>        elevation: <span class="hljs-number">30</span>,<span class="hljs-comment">//è®¾ç½®æ ‡é¢˜æ é˜´å½±</span><br>      ),<br>      body: MyBodyPage() <span class="hljs-comment">//è‡ªå®šä¹‰ Widget</span><br>    ),<br>  ));<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyBodyPage</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">StatelessWidget</span></span>&#123;<br>  <span class="hljs-meta">@override</span><br>  Widget build(BuildContext context) &#123;<br>    <span class="hljs-keyword">return</span> Image.network(<span class="hljs-string">&quot;https://img.lianzhixiu.com/uploads/210106/37-21010609363aS.jpg&quot;</span>);<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ä¸Šè¿°ä»£ç å¾ˆç®€å•ï¼Œå°±æ˜¯ä½¿ç”¨ Image.network ä¼ å…¥ä¸€å¼ å›¾ç‰‡ url ï¼Œè¿™æ ·å°±å¯ä»¥å°†è¿™å¼ ç½‘ç»œå›¾ç‰‡æ˜¾ç¤ºå‡ºæ¥äº†ï¼š</p><p><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/b4f8ebf9c4034f23b4a52a59984b046d~tplv-k3u1fbpfcp-watermark.image" alt="flutter_02.png"></p><h4 id="1-2-2ã€Image-asset-åŠ è½½æœ¬åœ°å›¾ç‰‡"><a href="#1-2-2ã€Image-asset-åŠ è½½æœ¬åœ°å›¾ç‰‡" class="headerlink" title="1.2.2ã€Image.asset åŠ è½½æœ¬åœ°å›¾ç‰‡"></a>1.2.2ã€Image.asset åŠ è½½æœ¬åœ°å›¾ç‰‡</h4><p>åŠ è½½æœ¬åœ°å›¾ç‰‡ç¨å¾®å¤æ‚ä¸€äº›</p><p>1ã€æ–°å»ºå›¾ç‰‡ç›®å½•ï¼Œå¼•å…¥å›¾ç‰‡èµ„æº</p><p><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/3315fbd5066448f7b8c87109f2e3db22~tplv-k3u1fbpfcp-watermark.image" alt="flutter_03 (2).png"></p><p>æˆ‘ä»¬æ–°å»ºäº† images æ–‡ä»¶å¤¹ï¼Œå¹¶åœ¨ images ä¸‹æ”¾å…¥äº†å›¾ç‰‡èµ„æºï¼Œåˆæ–°å»ºäº† 2.0x å’Œ 3.0x æ–‡ä»¶å¤¹åˆ†åˆ«å¯¹åº” 2 å€å›¾å’Œ 3 å€å›¾ï¼Œè¿™æ ·å°±èƒ½ä¿è¯ä¸åŒæ‰‹æœºåˆ†è¾¨ç‡çš„æ‰‹æœºåŠ è½½å¯¹åº”æ–‡ä»¶å¤¹ä¸‹çš„å›¾ç‰‡èµ„æº</p><p>2ã€æ‰“å¼€ pubspec.yaml é…ç½®æ–‡ä»¶å£°æ˜ä¸€ä¸‹æˆ‘ä»¬æ·»åŠ çš„å›¾ç‰‡</p><p><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/2466b29935204ef0960cb4fa29be8cb2~tplv-k3u1fbpfcp-watermark.image" alt="flutter_04 (1).png"></p><p>3ã€æœ€ååœ¨ä»£ç ä¸­ä½¿ç”¨å°±å¯ä»¥äº†</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;package:flutter/material.dart&#x27;</span>;<br><br><span class="hljs-keyword">void</span> main() &#123;<br>  runApp(MaterialApp(<br>    home: Scaffold(<br>      appBar: AppBar(<br>        title: Text(<span class="hljs-string">&quot;Flutter Image Widget&quot;</span>),<span class="hljs-comment">//è®¾ç½®æ ‡é¢˜æ æ ‡é¢˜</span><br>        elevation: <span class="hljs-number">30</span>,<span class="hljs-comment">//è®¾ç½®æ ‡é¢˜æ é˜´å½±</span><br>      ),<br>      body: MyBodyPage() <span class="hljs-comment">//è‡ªå®šä¹‰ Widget</span><br>    ),<br>  ));<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyBodyPage</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">StatelessWidget</span></span>&#123;<br>  <span class="hljs-meta">@override</span><br>  Widget build(BuildContext context) &#123;<br>    <span class="hljs-keyword">return</span> Image.asset(<span class="hljs-string">&quot;images/ic_launcher_round.png&quot;</span>);<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æ•ˆæœå¦‚ä¸‹ï¼š</p><p><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/f2105bb0b41846a88d69143a14eb4cda~tplv-k3u1fbpfcp-watermark.image" alt="flutter_05.png"></p><h4 id="1-2-3ã€Image-å¸¸ç”¨å±æ€§"><a href="#1-2-3ã€Image-å¸¸ç”¨å±æ€§" class="headerlink" title="1.2.3ã€Image å¸¸ç”¨å±æ€§"></a>1.2.3ã€Image å¸¸ç”¨å±æ€§</h4><table><thead><tr><th>åç§°</th><th>ç±»å‹</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>alignment</td><td>Alignment</td><td>å›¾ç‰‡çš„å¯¹é½æ–¹å¼</td></tr><tr><td>color å’Œ colorBlendMode</td><td></td><td>è®¾ç½®å›¾ç‰‡çš„èƒŒæ™¯é¢œè‰²ï¼Œé€šå¸¸å’Œ colorBlendMode é…åˆä¸€èµ·ä½¿ç”¨ï¼Œè¿™æ ·å¯ä»¥ä½¿å›¾ç‰‡é¢œè‰²å’ŒèƒŒæ™¯è‰²æ··åˆ</td></tr><tr><td>fit</td><td>BoxFit</td><td>fit å±æ€§ç”¨æ¥æ§åˆ¶å›¾ç‰‡çš„æ‹‰ä¼¸å’ŒæŒ¤å‹ï¼Œè¿™éƒ½æ˜¯æ ¹æ®çˆ¶å®¹å™¨æ¥çš„ï¼š<br/>BoxFit.fillï¼šå…¨å›¾æ˜¾ç¤ºï¼Œå›¾ç‰‡ä¼šè¢«æ‹‰ä¼¸ï¼Œå¹¶å……æ»¡çˆ¶å®¹å™¨<br/>BoxFit.containï¼šå…¨å›¾æ˜¾ç¤ºï¼Œæ˜¾ç¤ºåŸæ¯”ä¾‹ï¼Œå¯èƒ½ä¼šæœ‰ç©ºéš™<br/>BoxFit.coverï¼šæ˜¾ç¤ºå¯èƒ½æ‹‰ä¼¸ï¼Œå¯èƒ½è£åˆ‡ï¼Œå……æ»¡ï¼ˆå›¾ç‰‡è¦å……æ»¡æ•´ä¸ªå®¹å™¨ï¼Œè¿˜ä¸å˜å½¢ï¼‰<br/>BoxFit.fitWidthï¼šå®½åº¦å……æ»¡(æ¨ªå‘å……æ»¡)ï¼Œæ˜¾ç¤ºå¯èƒ½æ‹‰ä¼¸ï¼Œ å¯èƒ½è£åˆ‡<br/>BoxFit.fitHeightï¼šé«˜åº¦å……æ»¡(ç«–å‘å……æ»¡),æ˜¾ç¤ºå¯èƒ½æ‹‰ ä¼¸ï¼Œå¯èƒ½è£åˆ‡<br/>BoxFit.scaleDownï¼šæ•ˆæœå’Œ contain å·®ä¸å¤šï¼Œä½†æ˜¯æ­¤å±æ€§ä¸å…è®¸æ˜¾ç¤ºè¶…è¿‡åŸå›¾ç‰‡å¤§å°ï¼Œå¯å°ä¸å¯å¤§</td></tr><tr><td>width</td><td></td><td>å®½åº¦ï¼Œä¸€èˆ¬ç»“åˆ ClipOval Widget æ‰èƒ½çœ‹åˆ°æ•ˆæœ</td></tr><tr><td>height</td><td></td><td>é«˜åº¦ï¼Œä¸€èˆ¬ç»“åˆ ClipOval Widget æ‰èƒ½çœ‹åˆ°æ•ˆæœ</td></tr></tbody></table><p>æ›´å¤šå±æ€§å‚è€ƒï¼š<a href="https://api.flutter.dev/flutter/widgets/Image-class.html">https://api.flutter.dev/flutter/widgets/Image-class.html</a></p><p><strong>PS</strong>ï¼šClipOval æ˜¯ä¸€ä¸ªè£å‰ªå­ Widget ä¸ºæ¤­åœ†çš„ Widgetï¼Œå¸¸ç”¨äºåœ†å½¢ï¼Œåœ†è§’å›¾ç‰‡ç­‰</p><h3 id="1-3ã€æ•ˆæœå®ç°"><a href="#1-3ã€æ•ˆæœå®ç°" class="headerlink" title="1.3ã€æ•ˆæœå®ç°"></a>1.3ã€æ•ˆæœå®ç°</h3><p>å›é¡¾ 1.1 çš„æ•ˆæœï¼šå…¶å®å°±æ˜¯ä¸€ä¸ªå±…ä¸­å±•ç¤ºçš„åœ†å½¢å›¾ç‰‡</p><p>è¿™é‡Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ Center è¿›è¡Œå±…ä¸­ï¼Œç„¶åä½¿ç”¨ Image + ClipOval é…åˆç›¸å…³å±æ€§å®ç°åœ†å½¢å›¾ç‰‡ï¼š</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;package:flutter/material.dart&#x27;</span>;<br><br><span class="hljs-keyword">void</span> main() &#123;<br>  runApp(MaterialApp(<br>    home: Scaffold(<br>      appBar: AppBar(<br>        title: Text(<span class="hljs-string">&quot;Flutter Image Widget&quot;</span>),<span class="hljs-comment">//è®¾ç½®æ ‡é¢˜æ æ ‡é¢˜</span><br>        elevation: <span class="hljs-number">30</span>,<span class="hljs-comment">//è®¾ç½®æ ‡é¢˜æ é˜´å½±</span><br>      ),<br>      body: MyBodyPage() <span class="hljs-comment">//è‡ªå®šä¹‰ Widget</span><br>    ),<br>  ));<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyBodyPage</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">StatelessWidget</span></span>&#123;<br>  <span class="hljs-meta">@override</span><br>  Widget build(BuildContext context) &#123;<br>    <span class="hljs-keyword">return</span> Center(<br>      child: ClipOval(<br>        child: Image.network(<br>          <span class="hljs-string">&quot;https://img.lianzhixiu.com/uploads/210106/37-21010609363aS.jpg&quot;</span>,<br>          width: <span class="hljs-number">300</span>, <span class="hljs-comment">//è®¾ç½®å›¾ç‰‡çš„å®½åº¦ä¸º 300</span><br>          height: <span class="hljs-number">300</span>, <span class="hljs-comment">//è®¾ç½®å›¾ç‰‡çš„é«˜åº¦ä¸º 300</span><br>          fit: BoxFit.cover, <span class="hljs-comment">//è®¾ç½®å›¾ç‰‡ç­‰æ¯”æ”¾å¤§ï¼Œå……æ»¡çˆ¶å®¹å™¨</span><br>        ),<br>      ),<br>    );<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ä¸Šè¿°ä»£ç å°±å®ç°äº†æˆ‘ä»¬æƒ³è¦çš„æ•ˆæœ</p><h2 id="äºŒã€Flutter-Widget-ä¹‹-ListView"><a href="#äºŒã€Flutter-Widget-ä¹‹-ListView" class="headerlink" title="äºŒã€Flutter Widget ä¹‹ ListView"></a>äºŒã€Flutter Widget ä¹‹ ListView</h2><p>åˆ—è¡¨æ˜¯æˆ‘ä»¬é¡¹ç›®å¼€å‘ä¸­æœ€å¸¸ç”¨çš„ä¸€ç§å¸ƒå±€æ–¹å¼ï¼ŒFlutter ç»™æˆ‘ä»¬æä¾›äº† ListView æ¥å®šä¹‰åˆ—è¡¨ï¼Œå®ƒæ”¯æŒå‚ç›´å’Œæ°´å¹³æ–¹å‘å±•ç¤ºï¼Œé€šè¿‡ä¸€ä¸ªå±æ€§å°±å¯ä»¥æ§åˆ¶åˆ—è¡¨çš„æ˜¾ç¤ºæ–¹å‘</p><h3 id="2-1ã€æ•ˆæœå±•ç¤º"><a href="#2-1ã€æ•ˆæœå±•ç¤º" class="headerlink" title="2.1ã€æ•ˆæœå±•ç¤º"></a>2.1ã€æ•ˆæœå±•ç¤º</h3><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/71e5730aaec645d9b0652dc6e8c77b9c~tplv-k3u1fbpfcp-watermark.image" alt="flutter_06.png"></p><h3 id="2-2ã€ListView-ä»‹ç»"><a href="#2-2ã€ListView-ä»‹ç»" class="headerlink" title="2.2ã€ListView ä»‹ç»"></a>2.2ã€ListView ä»‹ç»</h3><h4 id="2-2-1ã€å¸¸ç”¨å±æ€§ä»‹ç»"><a href="#2-2-1ã€å¸¸ç”¨å±æ€§ä»‹ç»" class="headerlink" title="2.2.1ã€å¸¸ç”¨å±æ€§ä»‹ç»"></a>2.2.1ã€å¸¸ç”¨å±æ€§ä»‹ç»</h4><table><thead><tr><th>åç§°</th><th>ç±»å‹</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>scrollDirection</td><td>Axis</td><td>Axis.horizontal æ°´å¹³åˆ—è¡¨ <br/>Axis.vertical å‚ç›´åˆ—è¡¨</td></tr><tr><td>padding</td><td>EdgeInsetsGeometry</td><td>å…§è¾¹è·</td></tr><tr><td>resolve</td><td>bool</td><td>ç»„ä»¶åå‘æ’åº</td></tr><tr><td>children</td><td>List<Widget></td><td>åˆ—è¡¨å…ƒç´ </td></tr></tbody></table><p>æ›´å¤šå±æ€§å‚è€ƒï¼š<a href="https://api.flutter.dev/flutter/widgets/ListView-class.html">https://api.flutter.dev/flutter/widgets/ListView-class.html</a></p><p>ListView çš„ children èƒ½åµŒå¥—å„ç§ Widget å»å®ç°åˆ—è¡¨ UI æ•ˆæœ</p><h4 id="2-2-2ã€ListTile-ä»‹ç»"><a href="#2-2-2ã€ListTile-ä»‹ç»" class="headerlink" title="2.2.2ã€ListTile ä»‹ç»"></a>2.2.2ã€ListTile ä»‹ç»</h4><p>ListTile æ˜¯ä¸€ä¸ªåˆ—è¡¨ item Widget ï¼Œé€šå¸¸ç”¨äºå„ç§åˆ—è¡¨ä¸­ï¼Œå…¶å¸¸ç”¨çš„å±æ€§æœ‰ï¼š</p><table><thead><tr><th>åç§°</th><th>ç±»å‹</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>leading</td><td>Widget</td><td>å·¦ä¾§ç»„ä»¶</td></tr><tr><td>title</td><td>Widget</td><td>æ ‡é¢˜</td></tr><tr><td>subtitle</td><td>Widget</td><td>å‰¯æ ‡é¢˜</td></tr><tr><td>trailing</td><td>Widget</td><td>å³ä¾§ç»„ä»¶</td></tr><tr><td>onTap</td><td></td><td>ç‚¹å‡»äº‹ä»¶å›è°ƒ</td></tr><tr><td>onLongPress</td><td></td><td>é•¿æŒ‰äº‹ä»¶å›è°ƒ</td></tr></tbody></table><p>æ›´å¤šå±æ€§å‚è€ƒï¼š<a href="https://api.flutter.dev/flutter/material/ListTile-class.html">https://api.flutter.dev/flutter/material/ListTile-class.html</a></p><p>ä¸‹é¢æˆ‘ä»¬ä½¿ç”¨ ListView + ListTile å®ç°ä¸€ä¸ªæ•ˆæœï¼š</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;package:flutter/material.dart&#x27;</span>;<br><br><span class="hljs-keyword">void</span> main() &#123;<br><br>  runApp(MaterialApp(<br>    home: Scaffold(<br>      appBar: AppBar(<br>        title: Text(<span class="hljs-string">&quot;Flutter ListView Widget&quot;</span>),<span class="hljs-comment">//è®¾ç½®æ ‡é¢˜æ æ ‡é¢˜</span><br>        elevation: <span class="hljs-number">30</span>,<span class="hljs-comment">//è®¾ç½®æ ‡é¢˜æ é˜´å½±</span><br>      ),<br>      body: MyBodyPage() <span class="hljs-comment">//è‡ªå®šä¹‰ Widget</span><br>    ),<br>  ));<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyBodyPage</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">StatelessWidget</span></span>&#123;<br><br>  <span class="hljs-meta">@override</span><br>  Widget build(BuildContext context) &#123;<br>    <span class="hljs-keyword">return</span> ListView(<br>      children: [<br>        ListTile(<br>          leading: Icon(Icons.search),<br>          title: Text(<span class="hljs-string">&quot;æ ‡é¢˜1&quot;</span>),<br>          subtitle: Text(<span class="hljs-string">&quot;æè¿°1&quot;</span>),<br>          trailing: Icon(Icons.home),<br>        ),<br>        ListTile(<br>          leading: Icon(Icons.search),<br>          title: Text(<span class="hljs-string">&quot;æ ‡é¢˜2&quot;</span>),<br>          subtitle: Text(<span class="hljs-string">&quot;æè¿°2&quot;</span>),<br>          trailing: Icon(Icons.home)<br>        ),<br>        ListTile(<br>          leading: Icon(Icons.search),<br>          title: Text(<span class="hljs-string">&quot;æ ‡é¢˜3&quot;</span>),<br>          subtitle: Text(<span class="hljs-string">&quot;æè¿°3&quot;</span>),<br>          trailing: Icon(Icons.home)<br>        )<br>      ],<br>    );<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æ•ˆæœå›¾ï¼š</p><p><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/c02d016436184879a7d8871bdfb2e904~tplv-k3u1fbpfcp-watermark.image" alt="flutter_07.png"></p><h3 id="2-3ã€æ•ˆæœå®ç°"><a href="#2-3ã€æ•ˆæœå®ç°" class="headerlink" title="2.3ã€æ•ˆæœå®ç°"></a>2.3ã€æ•ˆæœå®ç°</h3><p>ä¸Šé¢ 2.1 å±•ç¤ºçš„æ•ˆæœå°±æ˜¯ï¼šListTile + æ¨ªçº¿ä½œä¸ºä¸€ä¸ª item è¿›è¡Œæ’åˆ—ï¼Œå¦‚ä½•å°†è¿™ä¸¤ä¸ª Widget åŒ…è£…ä¸ºä¸€ä¸ªæ•´ä½“ï¼Œæˆ‘ä»¬å°±è¦å­¦ä¹ ä¸‹ Column </p><p>1ã€Column ä»‹ç»</p><p>Column æ˜¯ Flutter ç»™æˆ‘ä»¬æä¾›çš„å‚ç›´å¸ƒå±€ Widgetï¼Œå…¶å¸¸ç”¨å±æ€§æœ‰ï¼š</p><table><thead><tr><th>åç§°</th><th>ç±»å‹</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>mainAxisAlignment</td><td>MainAxisAlignment</td><td>ä¸»è½´çš„æ’åºæ–¹å¼</td></tr><tr><td>crossAxisAlignment</td><td>CrossAxisAlignment</td><td>æ¬¡è½´çš„æ’åºæ–¹å¼</td></tr><tr><td>children</td><td>List<Widget></td><td>ç»„ä»¶å­å…ƒç´ </td></tr></tbody></table><p>æ›´å¤šå±æ€§å‚è€ƒï¼š<a href="https://api.flutter.dev/flutter/widgets/Column-class.html">https://api.flutter.dev/flutter/widgets/Column-class.html</a></p><p>åŒæ · Flutter ç»™æˆ‘ä»¬æä¾›äº†æ°´å¹³å¸ƒå±€ Widget Rowï¼Œå¸¸ç”¨å±æ€§å’Œ Column ä¸€æ ·</p><p>2ã€æ¨ªçº¿æˆ‘ä»¬ç›´æ¥ä½¿ç”¨ Divider</p><p>okï¼Œç°åœ¨å°±å¯ä»¥å»å®ç°æ•ˆæœå›¾äº†ï¼Œä¸Šé¢ 2.2 çš„ä¾‹å­ ListView é‡Œé¢çš„æ•°æ®éƒ½æ˜¯å†™æ­»çš„ï¼Œä¸çµæ´»ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬ä½¿ç”¨ ListView çš„å‘½åæ„é€ æ–¹æ³• ListView.Builder æ¥å®ç°åŠ¨æ€åŠ è½½ï¼š</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;package:flutter/material.dart&#x27;</span>;<br><br><span class="hljs-keyword">void</span> main() &#123;<br><br>  runApp(MaterialApp(<br>    home: Scaffold(<br>      appBar: AppBar(<br>        title: Text(<span class="hljs-string">&quot;Flutter ListView Widget&quot;</span>),<span class="hljs-comment">//è®¾ç½®æ ‡é¢˜æ æ ‡é¢˜</span><br>        elevation: <span class="hljs-number">30</span>,<span class="hljs-comment">//è®¾ç½®æ ‡é¢˜æ é˜´å½±</span><br>      ),<br>      body: MyBodyPage() <span class="hljs-comment">//è‡ªå®šä¹‰ Widget</span><br>    ),<br>  ));<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyBodyPage</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">StatelessWidget</span></span>&#123;<br><br>  <span class="hljs-comment">//mock æ•°æ®ï¼šç›¸å½“äº List&lt;Map&gt;</span><br>  <span class="hljs-keyword">var</span> mDataList = [<br>    &#123;<br>      <span class="hljs-string">&quot;title&quot;</span>:<span class="hljs-string">&quot;æ ‡é¢˜1&quot;</span>,<br>      <span class="hljs-string">&quot;desc&quot;</span>:<span class="hljs-string">&quot;æè¿°1&quot;</span>,<br>      <span class="hljs-string">&quot;image&quot;</span>:<span class="hljs-string">&quot;https://img.lianzhixiu.com/uploads/210106/37-21010609363aS.jpg&quot;</span><br>    &#125;,<br>    &#123;<br>      <span class="hljs-string">&quot;title&quot;</span>:<span class="hljs-string">&quot;æ ‡é¢˜2&quot;</span>,<br>      <span class="hljs-string">&quot;desc&quot;</span>:<span class="hljs-string">&quot;æè¿°2&quot;</span>,<br>      <span class="hljs-string">&quot;image&quot;</span>:<span class="hljs-string">&quot;https://img.lianzhixiu.com/uploads/210106/37-21010609363aS.jpg&quot;</span><br>    &#125;,<br>    &#123;<br>      <span class="hljs-string">&quot;title&quot;</span>:<span class="hljs-string">&quot;æ ‡é¢˜3&quot;</span>,<br>      <span class="hljs-string">&quot;desc&quot;</span>:<span class="hljs-string">&quot;æè¿°3&quot;</span>,<br>      <span class="hljs-string">&quot;image&quot;</span>:<span class="hljs-string">&quot;https://img.lianzhixiu.com/uploads/210106/37-21010609363aS.jpg&quot;</span><br>    &#125;,<br>    &#123;<br>      <span class="hljs-string">&quot;title&quot;</span>:<span class="hljs-string">&quot;æ ‡é¢˜4&quot;</span>,<br>      <span class="hljs-string">&quot;desc&quot;</span>:<span class="hljs-string">&quot;æè¿°4&quot;</span>,<br>      <span class="hljs-string">&quot;image&quot;</span>:<span class="hljs-string">&quot;https://img.lianzhixiu.com/uploads/210106/37-21010609363aS.jpg&quot;</span><br>    &#125;,<br>    &#123;<br>      <span class="hljs-string">&quot;title&quot;</span>:<span class="hljs-string">&quot;æ ‡é¢˜5&quot;</span>,<br>      <span class="hljs-string">&quot;desc&quot;</span>:<span class="hljs-string">&quot;æè¿°6&quot;</span>,<br>      <span class="hljs-string">&quot;image&quot;</span>:<span class="hljs-string">&quot;https://img.lianzhixiu.com/uploads/210106/37-21010609363aS.jpg&quot;</span><br>    &#125;,<br>  ];<br><br>  <span class="hljs-meta">@override</span><br>  Widget build(BuildContext context) &#123;<br>    <span class="hljs-keyword">return</span> ListView.builder(<span class="hljs-comment">//é€šè¿‡ ListView.builder å®ç°æ•°æ®çš„åŠ¨æ€åŠ è½½</span><br>        itemCount: mDataList.length, <span class="hljs-comment">//item çš„ä¸ªæ•°</span><br>        itemBuilder: (context, index) &#123; <span class="hljs-comment">//é€šè¿‡ itemBuilder æ„å»º Widget</span><br>          <span class="hljs-keyword">return</span> Column(<br>            children: [ <span class="hljs-comment">//Column é‡Œé¢åŒ…è£…äº† ListTile + Divider</span><br>              ListTile(<br>                leading: ClipOval( <span class="hljs-comment">//åœ†å½¢å›¾ç‰‡</span><br>                  child: Image.network(<br>                    mDataList[index][<span class="hljs-string">&quot;image&quot;</span>] ?? <span class="hljs-string">&quot;&quot;</span>,<br>                    width: <span class="hljs-number">50</span>,<br>                    height: <span class="hljs-number">50</span>,<br>                    fit: BoxFit.cover,<br>                  ),<br>                ),<br>                title: Text(mDataList[index][<span class="hljs-string">&quot;title&quot;</span>] ?? <span class="hljs-string">&quot;&quot;</span>), <span class="hljs-comment">//æ ‡é¢˜</span><br>                subtitle: Text(mDataList[index][<span class="hljs-string">&quot;desc&quot;</span>] ?? <span class="hljs-string">&quot;&quot;</span>), <span class="hljs-comment">//å‰¯æ ‡é¢˜</span><br>              ),<br>              Divider() <span class="hljs-comment">//æ¨ªçº¿</span><br>            ],<br>          );<br>        &#125;);<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ä¸Šè¿°ä»£ç å°±å®ç°äº†æˆ‘ä»¬æƒ³è¦çš„æ•ˆæœ</p><h2 id="ä¸‰ã€Flutter-Widget-ä¹‹-GridView"><a href="#ä¸‰ã€Flutter-Widget-ä¹‹-GridView" class="headerlink" title="ä¸‰ã€Flutter Widget ä¹‹ GridView"></a>ä¸‰ã€Flutter Widget ä¹‹ GridView</h2><p>GridView æ˜¯ Flutter ç»™æˆ‘ä»¬æä¾›çš„ç½‘æ ¼å¸ƒå±€ Widgetï¼Œæˆ‘ä»¬å¿«é€Ÿè¿‡ä¸€ä¸‹ï¼Œç„¶åå®ç°ä¸€äº›æ•ˆæœï¼š</p><p>GridView åˆ›å»ºç½‘æ ¼åˆ—è¡¨æœ‰å¤šç§æ–¹å¼ï¼Œä¸»è¦ä»‹ç»ä¸¤ç§ï¼š</p><p>1ã€é€šè¿‡ GridView.count å®ç°ç½‘æ ¼å¸ƒå±€</p><p>2ã€é€šè¿‡ GridView.builder å®ç°ç½‘æ ¼å¸ƒå±€</p><p><strong>å¸¸ç”¨å±æ€§</strong>ï¼š</p><table><thead><tr><th>åç§°</th><th>ç±»å‹</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>scrollDirection</td><td>Axis</td><td>Axis.horizontal æ°´å¹³åˆ—è¡¨ <br/>Axis.vertical å‚ç›´åˆ—è¡¨</td></tr><tr><td>padding</td><td>EdgeInsetsGeometry</td><td>å…§è¾¹è·</td></tr><tr><td>resolve</td><td>bool</td><td>ç»„ä»¶åå‘æ’åº</td></tr><tr><td>children</td><td>List<Widget></td><td>åˆ—è¡¨å…ƒç´ </td></tr><tr><td>crossAxisSpacing</td><td>double</td><td>æ°´å¹³å­ Widget ä¹‹é—´é—´è·</td></tr><tr><td>mainAxisSpacing</td><td>double</td><td>å‚ç›´å­ Widget ä¹‹é—´é—´è·</td></tr><tr><td>crossAxisCount</td><td>int</td><td>ä¸€è¡Œçš„ Widget æ•°é‡</td></tr><tr><td>childAspectRatio</td><td>double</td><td>å­ Widget å®½é«˜æ¯”ä¾‹</td></tr><tr><td>gridDelegate</td><td>SliverGridDelegate</td><td>æ§åˆ¶å¸ƒå±€ä¸»è¦ç”¨åœ¨ GridView.builder é‡Œé¢</td></tr></tbody></table><h3 id="3-1ã€Flutter-GridView-count-å®ç°ç½‘æ ¼å¸ƒå±€"><a href="#3-1ã€Flutter-GridView-count-å®ç°ç½‘æ ¼å¸ƒå±€" class="headerlink" title="3.1ã€Flutter GridView.count å®ç°ç½‘æ ¼å¸ƒå±€"></a>3.1ã€Flutter GridView.count å®ç°ç½‘æ ¼å¸ƒå±€</h3><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;package:flutter/material.dart&#x27;</span>;<br><br><span class="hljs-keyword">void</span> main() &#123;<br><br>  runApp(MaterialApp(<br>    home: Scaffold(<br>      appBar: AppBar(<br>        title: Text(<span class="hljs-string">&quot;Flutter ListView Widget&quot;</span>),<span class="hljs-comment">//è®¾ç½®æ ‡é¢˜æ æ ‡é¢˜</span><br>        elevation: <span class="hljs-number">30</span>,<span class="hljs-comment">//è®¾ç½®æ ‡é¢˜æ é˜´å½±</span><br>      ),<br>      body: MyBodyPage() <span class="hljs-comment">//è‡ªå®šä¹‰ Widget</span><br>    ),<br>  ));<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyBodyPage</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">StatelessWidget</span></span>&#123;<br><br>  <span class="hljs-comment">//mock æ•°æ®</span><br>  <span class="hljs-keyword">var</span> mDataList = [<br>    &#123;<br>      <span class="hljs-string">&quot;title&quot;</span>:<span class="hljs-string">&quot;æ ‡é¢˜1&quot;</span>,<br>      <span class="hljs-string">&quot;image&quot;</span>:<span class="hljs-string">&quot;https://img.lianzhixiu.com/uploads/210106/37-21010609363aS.jpg&quot;</span><br>    &#125;,<br>    &#123;<br>      <span class="hljs-string">&quot;title&quot;</span>:<span class="hljs-string">&quot;æ ‡é¢˜2&quot;</span>,<br>      <span class="hljs-string">&quot;image&quot;</span>:<span class="hljs-string">&quot;https://img.lianzhixiu.com/uploads/210106/37-21010609363aS.jpg&quot;</span><br>    &#125;,<br>    &#123;<br>      <span class="hljs-string">&quot;title&quot;</span>:<span class="hljs-string">&quot;æ ‡é¢˜3&quot;</span>,<br>      <span class="hljs-string">&quot;image&quot;</span>:<span class="hljs-string">&quot;https://img.lianzhixiu.com/uploads/210106/37-21010609363aS.jpg&quot;</span><br>    &#125;,<br>    &#123;<br>      <span class="hljs-string">&quot;title&quot;</span>:<span class="hljs-string">&quot;æ ‡é¢˜4&quot;</span>,<br>      <span class="hljs-string">&quot;image&quot;</span>:<span class="hljs-string">&quot;https://img.lianzhixiu.com/uploads/210106/37-21010609363aS.jpg&quot;</span><br>    &#125;,<br>    &#123;<br>      <span class="hljs-string">&quot;title&quot;</span>:<span class="hljs-string">&quot;æ ‡é¢˜5&quot;</span>,<br>      <span class="hljs-string">&quot;image&quot;</span>:<span class="hljs-string">&quot;https://img.lianzhixiu.com/uploads/210106/37-21010609363aS.jpg&quot;</span><br>    &#125;,<br>  ];<br><br>  <span class="hljs-built_in">List</span>&lt;Widget&gt; _getListWidget() &#123;<br>    <span class="hljs-keyword">var</span> listWidget = mDataList.map((value) &#123;<br>      <span class="hljs-keyword">return</span> Container(<br>        decoration: <span class="hljs-comment">//è®¾ç½®ä¸€ä¸ªå®½åº¦ä¸º 1 ç»¿è‰²çš„è¾¹æ¡†</span><br>          BoxDecoration(border: Border.all(color: Colors.green, width: <span class="hljs-number">1.0</span>)),<br>        child: Column( <span class="hljs-comment">//å‚ç›´å¸ƒå±€é‡Œé¢åµŒå¥—ï¼šExpanded + SizedBox + Text + SizedBox</span><br>          children: [<br>            Expanded( <span class="hljs-comment">//å±•å¼€ Widgetï¼Œç±»ä¼¼ Android é‡Œé¢ Linearlayout è®¾ç½®æƒé‡ï¼Œç”¨åœ¨è¿™æ˜¯è®©å›¾ç‰‡è‡ªé€‚åº”å±•å¼€</span><br>              child: Image.network(<span class="hljs-comment">// å›¾ç‰‡</span><br>                value[<span class="hljs-string">&quot;image&quot;</span>] ?? <span class="hljs-string">&quot;&quot;</span>,<br>                fit: BoxFit.cover,<br>                width: <span class="hljs-built_in">double</span>.infinity, <span class="hljs-comment">//è®¾ç½®å›¾ç‰‡çš„å®½åº¦ä¸ºå±å¹•çš„å®½åº¦</span><br>              ),<br>            ),<br>            SizedBox(height: <span class="hljs-number">12</span>),<span class="hljs-comment">//è®¾ç½®ä¸€ä¸ªé«˜åº¦ä¸º 12 çš„ç©ºç™½é—´è·</span><br>            Text( <span class="hljs-comment">// è®¾ç½®æ–‡æœ¬</span><br>                value[<span class="hljs-string">&quot;title&quot;</span>] ?? <span class="hljs-string">&quot;&quot;</span>,<br>                textAlign: TextAlign.center,<br>                style: TextStyle(<br>                    fontSize: <span class="hljs-number">20</span><br>                )<br>            ),<br>            SizedBox(height: <span class="hljs-number">12</span>),<span class="hljs-comment">//è®¾ç½®ä¸€ä¸ªé«˜åº¦ä¸º 12 çš„ç©ºç™½é—´è·</span><br>          ],<br>        ),<br>      );<br>    &#125;);<br>    <span class="hljs-keyword">return</span> listWidget.toList();<br>  &#125;<br><br>  <span class="hljs-meta">@override</span><br>  Widget build(BuildContext context) &#123;<br>    <span class="hljs-keyword">return</span> GridView.count(<br>      crossAxisCount: <span class="hljs-number">2</span>,<span class="hljs-comment">// è®¾ç½®ä¸€è¡Œæ˜¾ç¤º Widget æ•°é‡ä¸º 2</span><br>      padding: EdgeInsets.all(<span class="hljs-number">20</span>), <span class="hljs-comment">//è®¾ç½® GridView å…§è¾¹è·ä¸º 20</span><br>      crossAxisSpacing: <span class="hljs-number">20</span>, <span class="hljs-comment">//è®¾ç½®æ°´å¹³å­ Widget ä¹‹é—´çš„é—´è·ä¸º 20</span><br>      mainAxisSpacing: <span class="hljs-number">20</span>,  <span class="hljs-comment">//è®¾ç½®å‚ç›´å­ Widget ä¹‹é—´çš„é—´è·ä¸º 20</span><br>      children: _getListWidget() <span class="hljs-comment">//è®¾ç½®å­ Widget</span><br>    );<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ä¸Šè¿°ä»£ç ä¸­æˆ‘ä»¬ä½¿ç”¨äº†ä¸¤ä¸ªæ–° Widgetï¼šExpandedï¼ŒSizeBox</p><p>1ã€Expanded æ˜¯ç”¨äºå±•å¼€å­ Widget çš„ Widgetï¼Œå¸¸ç”¨äº Rowï¼ŒColumn ä¸­ï¼Œå…¶ flex å±æ€§å°±æ˜¯ç”¨æ¥è®¾ç½®æƒé‡çš„ï¼Œç±»ä¼¼äº Android çš„ LinearLayout è®¾ç½®æƒé‡</p><p>2ã€SizeBox ä¸»è¦æ˜¯ç”¨æ¥æŒ‡å®šä¸€æ®µé—´è·çš„ï¼Œå…¶æœ‰ä¸¤ä¸ªå±æ€§ï¼Œwidthï¼Œheightã€‚å¦‚æœè®¾ç½® width å°±æ˜¯æŒ‡å®šå®½åº¦ï¼Œå¦‚æœè®¾ç½® height å°±æ˜¯æŒ‡å®šé«˜åº¦</p><p>å®ç°æ•ˆæœï¼š</p><p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/8ed5babf3a7642069893a05e1afe3240~tplv-k3u1fbpfcp-watermark.image" alt="flutter_08.png"></p><h3 id="3-2ã€Flutter-GridView-builder-å®ç°ç½‘æ ¼å¸ƒå±€"><a href="#3-2ã€Flutter-GridView-builder-å®ç°ç½‘æ ¼å¸ƒå±€" class="headerlink" title="3.2ã€Flutter GridView.builder å®ç°ç½‘æ ¼å¸ƒå±€"></a>3.2ã€Flutter GridView.builder å®ç°ç½‘æ ¼å¸ƒå±€</h3><p>åŒæ ·çš„æ•ˆæœï¼Œæˆ‘ä»¬ä½¿ç”¨ GridView.builder æ¥å®ç°</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;package:flutter/material.dart&#x27;</span>;<br><br><span class="hljs-keyword">void</span> main() &#123;<br>  runApp(MaterialApp(<br>    home: Scaffold(<br>        appBar: AppBar(<br>          title: Text(<span class="hljs-string">&quot;Flutter GridView Widget&quot;</span>), <span class="hljs-comment">//è®¾ç½®æ ‡é¢˜æ æ ‡é¢˜</span><br>          elevation: <span class="hljs-number">30</span>, <span class="hljs-comment">//è®¾ç½®æ ‡é¢˜æ é˜´å½±</span><br>        ),<br>        body: MyBodyPage() <span class="hljs-comment">//è‡ªå®šä¹‰ Widget</span><br>        ),<br>  ));<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyBodyPage</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">StatelessWidget</span> </span>&#123;<br>  <span class="hljs-comment">//mock æ•°æ®</span><br>  <span class="hljs-keyword">var</span> mDataList = [<br>    &#123;<br>      <span class="hljs-string">&quot;title&quot;</span>: <span class="hljs-string">&quot;æ ‡é¢˜1&quot;</span>,<br>      <span class="hljs-string">&quot;image&quot;</span>: <span class="hljs-string">&quot;https://img.lianzhixiu.com/uploads/210106/37-21010609363aS.jpg&quot;</span><br>    &#125;,<br>    &#123;<br>      <span class="hljs-string">&quot;title&quot;</span>: <span class="hljs-string">&quot;æ ‡é¢˜2&quot;</span>,<br>      <span class="hljs-string">&quot;image&quot;</span>: <span class="hljs-string">&quot;https://img.lianzhixiu.com/uploads/210106/37-21010609363aS.jpg&quot;</span><br>    &#125;,<br>    &#123;<br>      <span class="hljs-string">&quot;title&quot;</span>: <span class="hljs-string">&quot;æ ‡é¢˜3&quot;</span>,<br>      <span class="hljs-string">&quot;image&quot;</span>: <span class="hljs-string">&quot;https://img.lianzhixiu.com/uploads/210106/37-21010609363aS.jpg&quot;</span><br>    &#125;,<br>    &#123;<br>      <span class="hljs-string">&quot;title&quot;</span>: <span class="hljs-string">&quot;æ ‡é¢˜4&quot;</span>,<br>      <span class="hljs-string">&quot;image&quot;</span>: <span class="hljs-string">&quot;https://img.lianzhixiu.com/uploads/210106/37-21010609363aS.jpg&quot;</span><br>    &#125;,<br>    &#123;<br>      <span class="hljs-string">&quot;title&quot;</span>: <span class="hljs-string">&quot;æ ‡é¢˜5&quot;</span>,<br>      <span class="hljs-string">&quot;image&quot;</span>: <span class="hljs-string">&quot;https://img.lianzhixiu.com/uploads/210106/37-21010609363aS.jpg&quot;</span><br>    &#125;,<br>  ];<br><br>  Widget _getListWidget(context, index) &#123;<br>    <span class="hljs-keyword">return</span> Container(<br>      decoration: <span class="hljs-comment">//è®¾ç½®ä¸€ä¸ªå®½åº¦ä¸º 1 ç»¿è‰²çš„è¾¹æ¡†</span><br>          BoxDecoration(border: Border.all(color: Colors.green, width: <span class="hljs-number">1.0</span>)),<br>      child: Column(<br>        <span class="hljs-comment">//å‚ç›´å¸ƒå±€é‡Œé¢åµŒå¥—ï¼šExpanded + SizedBox + Text + SizedBox</span><br>        children: [<br>          Expanded(<br>            <span class="hljs-comment">//æ‰©å±• Widgetï¼Œç±»ä¼¼ Android é‡Œé¢ Linearlayout è®¾ç½®æƒé‡ï¼Œç”¨åœ¨è¿™æ˜¯è®©å›¾ç‰‡è‡ªé€‚åº”</span><br>            child: Image.network(<br>              <span class="hljs-comment">// å›¾ç‰‡</span><br>              mDataList[index][<span class="hljs-string">&quot;image&quot;</span>] ?? <span class="hljs-string">&quot;&quot;</span>,<br>              fit: BoxFit.cover,<br>              width: <span class="hljs-built_in">double</span>.infinity, <span class="hljs-comment">//è®¾ç½®å›¾ç‰‡çš„å®½åº¦ä¸ºå±å¹•çš„å®½åº¦</span><br>            ),<br>          ),<br>          SizedBox(height: <span class="hljs-number">12</span>), <span class="hljs-comment">//è®¾ç½®ä¸€ä¸ªé«˜åº¦ä¸º 12 çš„ç©ºç™½é—´è·</span><br>          Text(<br>              <span class="hljs-comment">// è®¾ç½®æ–‡æœ¬</span><br>              mDataList[index][<span class="hljs-string">&quot;title&quot;</span>] ?? <span class="hljs-string">&quot;&quot;</span>,<br>              textAlign: TextAlign.center,<br>              style: TextStyle(fontSize: <span class="hljs-number">20</span>)),<br>          SizedBox(height: <span class="hljs-number">12</span>), <span class="hljs-comment">//è®¾ç½®ä¸€ä¸ªé«˜åº¦ä¸º 12 çš„ç©ºç™½é—´è·</span><br>        ],<br>      ),<br>    );<br>  &#125;<br><br>  <span class="hljs-meta">@override</span><br>  Widget build(BuildContext context) &#123;<br>    <span class="hljs-keyword">return</span> GridView.builder(<br>        itemCount: mDataList.length,<br>        padding: EdgeInsets.all(<span class="hljs-number">20</span>),<br>        gridDelegate: SliverGridDelegateWithFixedCrossAxisCount(<br>          crossAxisCount: <span class="hljs-number">2</span>, <span class="hljs-comment">//è®¾ç½®ä¸€è¡Œæœ‰ä¸¤ä¸ª Widget</span><br>          crossAxisSpacing: <span class="hljs-number">20</span>, <span class="hljs-comment">//è®¾ç½®æ°´å¹³å­ Widget ä¹‹é—´çš„é—´è·ä¸º 20</span><br>          mainAxisSpacing: <span class="hljs-number">20</span>, <span class="hljs-comment">//è®¾ç½®å‚ç›´å­ Widget ä¹‹é—´çš„é—´è·ä¸º 20</span><br>          childAspectRatio: <span class="hljs-number">1</span>, <span class="hljs-comment">//è®¾ç½®å­ç»„ä»¶å®½é«˜æ¯”ä¾‹ä¸º 1</span><br>        ),<br>        itemBuilder: _getListWidget <span class="hljs-comment">//å°†æ–¹æ³•ä½œä¸ºä¸€ä¸ªå‚æ•°ä¼ å…¥</span><br>        );<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="å››ã€Flutter-Widget-ä¹‹-Stack"><a href="#å››ã€Flutter-Widget-ä¹‹-Stack" class="headerlink" title="å››ã€Flutter Widget ä¹‹ Stack"></a>å››ã€Flutter Widget ä¹‹ Stack</h2><p>Stack æ˜¯ Fluter æä¾›çš„å å±‚ Widget ï¼Œç±»ä¼¼ Android çš„ FrameLayout</p><p><strong>å¸¸ç”¨å±æ€§</strong>ï¼š</p><table><thead><tr><th>åç§°</th><th>ç±»å‹</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>alignment</td><td>AlignmentGeometry</td><td>é…ç½®æ‰€æœ‰å­å…ƒç´ çš„æ˜¾ç¤ºä½ç½®</td></tr><tr><td>children</td><td>List<Widget></td><td>å­ç»„ä»¶</td></tr></tbody></table><p>é€šå¸¸å®ƒä¼šé…åˆ Align æˆ– Positioned å®ç°å®šä½å¸ƒå±€</p><p><strong>Align å¸¸ç”¨å±æ€§</strong></p><table><thead><tr><th>åç§°</th><th>ç±»å‹</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>alignment</td><td>AlignmentGeometry</td><td>é…ç½®å­å…ƒç´ çš„æ˜¾ç¤ºä½ç½®</td></tr><tr><td>child</td><td>Widget</td><td>å­ç»„ä»¶</td></tr></tbody></table><p><strong>Positioned å¸¸ç”¨å±æ€§</strong></p><table><thead><tr><th>åç§°</th><th>ç±»å‹</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>top</td><td>double</td><td>å­å…ƒç´ è·ç¦»é¡¶éƒ¨çš„è·ç¦»</td></tr><tr><td>bottom</td><td>double</td><td>å­å…ƒç´ è·ç¦»åº•éƒ¨çš„è·ç¦»</td></tr><tr><td>left</td><td>double</td><td>å­å…ƒç´ è·ç¦»å·¦ä¾§è·ç¦»</td></tr><tr><td>right</td><td>double</td><td>å­å…ƒç´ è·ç¦»å³ä¾§è·ç¦»</td></tr><tr><td>child</td><td>Widget</td><td>å­ç»„ä»¶</td></tr></tbody></table><p>ä¸‹é¢æˆ‘ä»¬å®ç°å¦‚ä¸‹æ•ˆæœï¼š</p><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/65d60dd3b5ee487e89e6abc3f3265e13~tplv-k3u1fbpfcp-watermark.image" alt="flutter_09.png"></p><h3 id="4-1ã€Stack-Align-å®ç°å®šä½å¸ƒå±€"><a href="#4-1ã€Stack-Align-å®ç°å®šä½å¸ƒå±€" class="headerlink" title="4.1ã€Stack + Align å®ç°å®šä½å¸ƒå±€"></a>4.1ã€Stack + Align å®ç°å®šä½å¸ƒå±€</h3><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;package:flutter/material.dart&#x27;</span>;<br><br><span class="hljs-keyword">void</span> main() &#123;<br>  runApp(MaterialApp(<br>    home: Scaffold(<br>        appBar: AppBar(<br>          title: Text(<span class="hljs-string">&quot;Flutter Stack Widget&quot;</span>), <span class="hljs-comment">//è®¾ç½®æ ‡é¢˜æ æ ‡é¢˜</span><br>          elevation: <span class="hljs-number">30</span>, <span class="hljs-comment">//è®¾ç½®æ ‡é¢˜æ é˜´å½±</span><br>        ),<br>        body: MyBodyPage() <span class="hljs-comment">//è‡ªå®šä¹‰ Widget</span><br>        ),<br>  ));<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyBodyPage</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">StatelessWidget</span> </span>&#123;<br>  <span class="hljs-meta">@override</span><br>  Widget build(BuildContext context) &#123;<br>    <span class="hljs-keyword">return</span> Stack(<br>      children: [<br>        Align(<br>          alignment: Alignment.topLeft,<span class="hljs-comment">//å·¦ä¸Š</span><br>          child: Container(<br>            width: <span class="hljs-number">100</span>,<br>            height: <span class="hljs-number">100</span>,<br>            color: Colors.red,<br>          ),<br>        ),<br>        Align(<br>          alignment: Alignment.topRight,<span class="hljs-comment">//å³ä¸Š</span><br>          child: Container(<br>            width: <span class="hljs-number">100</span>,<br>            height: <span class="hljs-number">100</span>,<br>            color: Colors.orange,<br>          ),<br>        ),<br>        Align(<br>          alignment: Alignment.center,<span class="hljs-comment">//ä¸­é—´</span><br>          child: Container(<br>            width: <span class="hljs-number">100</span>,<br>            height: <span class="hljs-number">100</span>,<br>            color: Colors.yellow,<br>          ),<br>        ),<br>        Align(<br>          alignment: Alignment.bottomLeft,<span class="hljs-comment">//å·¦ä¸‹</span><br>          child: Container(<br>            width: <span class="hljs-number">100</span>,<br>            height: <span class="hljs-number">100</span>,<br>            color: Colors.green,<br>          ),<br>        ),<br>        Align(<br>          alignment: Alignment.bottomRight,<span class="hljs-comment">//å³ä¸‹</span><br>          child: Container(<br>            width: <span class="hljs-number">100</span>,<br>            height: <span class="hljs-number">100</span>,<br>            color: Colors.blue,<br>          ),<br>        )<br>      ],<br>    );<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="4-2ã€Stack-Positioned-å®ç°å®šä½å¸ƒå±€"><a href="#4-2ã€Stack-Positioned-å®ç°å®šä½å¸ƒå±€" class="headerlink" title="4.2ã€Stack + Positioned å®ç°å®šä½å¸ƒå±€"></a>4.2ã€Stack + Positioned å®ç°å®šä½å¸ƒå±€</h3><p>è¿™ç§æ–¹å¼å¿…é¡»æŒ‡å®šç²¾ç¡®çš„å®½é«˜ï¼Œåœ¨ä¸åŒåˆ†è¾¨ç‡çš„æ‰‹æœºï¼Œå¯èƒ½æ˜¾ç¤ºä¼šæœ‰ç‚¹é—®é¢˜ï¼Œä¼˜å…ˆè¿˜æ˜¯ä½¿ç”¨ Stack + Align å®ç°å®šä½å¸ƒå±€ï¼Œå¦‚æœå¯¹ UI çš„å°åå·®èƒ½å¿½ç•¥ä¸è®¡ï¼Œç”¨è¿™ä¸ªä¹Ÿå¯ä»¥</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;package:flutter/material.dart&#x27;</span>;<br><br><span class="hljs-keyword">void</span> main() &#123;<br>  runApp(MaterialApp(<br>    home: Scaffold(<br>        appBar: AppBar(<br>          title: Text(<span class="hljs-string">&quot;Flutter Stack Widget&quot;</span>), <span class="hljs-comment">//è®¾ç½®æ ‡é¢˜æ æ ‡é¢˜</span><br>          elevation: <span class="hljs-number">30</span>, <span class="hljs-comment">//è®¾ç½®æ ‡é¢˜æ é˜´å½±</span><br>        ),<br>        body: MyBodyPage() <span class="hljs-comment">//è‡ªå®šä¹‰ Widget</span><br>        ),<br>  ));<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyBodyPage</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">StatelessWidget</span> </span>&#123;<br>  <span class="hljs-meta">@override</span><br>  Widget build(BuildContext context) &#123;<br>    <span class="hljs-keyword">final</span> size = MediaQuery.of(context).size;<br>    <span class="hljs-keyword">final</span> screenWidth = size.width; <span class="hljs-comment">//è·å–å±å¹•å®½åº¦</span><br>    <span class="hljs-keyword">final</span> screenHeight = size.height; <span class="hljs-comment">//è·å–å±å¹•é«˜åº¦</span><br>    <span class="hljs-keyword">return</span> Container(<br>      width: <span class="hljs-built_in">double</span>.infinity,<br>      height: <span class="hljs-built_in">double</span>.infinity,<br>      child: Stack(<br>        children: [<br>          Positioned(<span class="hljs-comment">//å·¦ä¸Š</span><br>            child: Container(<br>              width: <span class="hljs-number">100</span>,<br>              height: <span class="hljs-number">100</span>,<br>              color: Colors.red,<br>            ),<br>          ),<br>          Positioned(<span class="hljs-comment">//å³ä¸Š</span><br>            left: screenWidth - <span class="hljs-number">100</span>,<br>            child: Container(<br>              width: <span class="hljs-number">100</span>,<br>              height: <span class="hljs-number">100</span>,<br>              color: Colors.orange,<br>            ),<br>          ),<br>          Positioned(<span class="hljs-comment">//ä¸­é—´</span><br>            left: screenWidth / <span class="hljs-number">2</span> - <span class="hljs-number">50</span>,<br>            top: screenHeight / <span class="hljs-number">2</span> - <span class="hljs-number">90</span>,<br>            child: Container(<br>              width: <span class="hljs-number">100</span>,<br>              height: <span class="hljs-number">100</span>,<br>              color: Colors.yellow,<br>            ),<br>          ),<br>          Positioned(<span class="hljs-comment">//å·¦ä¸‹</span><br>            top: screenHeight - <span class="hljs-number">180</span>,<br>            child: Container(<br>              width: <span class="hljs-number">100</span>,<br>              height: <span class="hljs-number">100</span>,<br>              color: Colors.green,<br>            ),<br>          ),<br>          Positioned(<span class="hljs-comment">//å³ä¸‹</span><br>            left: screenWidth - <span class="hljs-number">100</span>,<br>            top: screenHeight - <span class="hljs-number">180</span>,<br>            child: Container(<br>              width: <span class="hljs-number">100</span>,<br>              height: <span class="hljs-number">100</span>,<br>              color: Colors.blue,<br>            ),<br>          )<br>        ],<br>      ),<br>    );<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="äº”ã€Widget-ç»„åˆä¹‹ç»¼åˆæ¡ˆä¾‹"><a href="#äº”ã€Widget-ç»„åˆä¹‹ç»¼åˆæ¡ˆä¾‹" class="headerlink" title="äº”ã€Widget ç»„åˆä¹‹ç»¼åˆæ¡ˆä¾‹"></a>äº”ã€Widget ç»„åˆä¹‹ç»¼åˆæ¡ˆä¾‹</h2><p>è®²ç»¼åˆæ¡ˆä¾‹ä¹‹å‰æˆ‘ä»¬ä»‹ç»ä¸‹ Paddingï¼š</p><p>Padding æ˜¯ Flutter ç»™æˆ‘ä»¬æä¾›å±•ç¤ºå†…é—´è·çš„ Widgetï¼Œä¸ºå•¥è¦æä¾›è¿™ä¸ª Widget å‘¢ï¼Ÿå› ä¸ºå¾ˆå¤š Widget éƒ½æ²¡æœ‰ padding å±æ€§ï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬å¯ä»¥ç”¨ Padding å¤„ç†ä¸å­ Widget çš„å…§é—´è·ï¼Œå…¶å¸¸ç”¨çš„å±æ€§å¦‚ä¸‹ï¼š</p><table><thead><tr><th>åç§°</th><th>ç±»å‹</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>padding</td><td>EdgeInsetsGeometry</td><td>padding å€¼, EdgeInsets è®¾ç½®å¡«å……çš„å€¼</td></tr><tr><td>child</td><td>Widget</td><td>å­ç»„ä»¶</td></tr></tbody></table><p>okï¼Œæ¥ä¸‹æ¥çœ‹ä¸‹ç»¼åˆæ¡ˆä¾‹è¦å®ç°çš„æ•ˆæœï¼š</p><p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/c8b90e40d5ce42aa95c1a6be5bf0a1c1~tplv-k3u1fbpfcp-watermark.image" alt="flutter_10.png"></p><p>å…ˆæ‹ä¸€æ‹å®ç°çš„æ€è·¯ï¼šé¦–é¡µæˆ‘ä»¬çœ‹åˆ°è¿™ä¸ªé¡µé¢æ•´ä½“æœ‰ä¸€ä¸ªå†…é—´è·ï¼ˆPaddingï¼‰ï¼Œå…ƒç´ åˆ’åˆ†ä¸º 4 å—ï¼Œä»ä¸Šåˆ°ä¸‹å‚ç›´æ’åˆ—ï¼Œå¯ä»¥ä½¿ç”¨ Columnï¼Œåœ¨çœ‹å…·ä½“çš„æ¯ä¸€å—ï¼š</p><p>ç¬¬ä¸€å—ï¼šä¸€ä¸ªé»‘è‰²çš„é•¿æ–¹å½¢ï¼Œå¯ä»¥ä½¿ç”¨ Container å®ç°</p><p>ç¬¬äºŒå—ï¼šå·¦è¾¹ä¸€å¼ é•¿å›¾ï¼Œå³è¾¹å…ˆæ•´ä½“ä¹Ÿçœ‹æˆä¸€å¼ å›¾ç‰‡ï¼Œå·¦å³æ¯”ä¾‹ 2 : 1ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ Row + Expanded å®ç°ï¼Œåœ¨çœ‹å³è¾¹è¿™å—æ•´ä½“åˆåˆ†ä¸Šä¸‹ä¸¤å¼ å›¾ç‰‡ï¼Œä¸ºäº†è®©è¿™ä¸¤å¼ å›¾ç‰‡è‡ªé€‚åº”å®½åº¦ï¼Œè¿™é‡Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ ListView åµŒå¥—ä¸¤ä¸ª Image</p><p>ç¬¬ä¸‰å—ï¼šå·¦ä¸­å³ä¸‰å¼ å›¾ç‰‡ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ Stack + Align å®šä½å¸ƒå±€å®ç°</p><p>ç¬¬å››å—ï¼šç›´æ¥ä½¿ç”¨ ListTile å®ç°ï¼ŒListTile çš„ leading ä¸ºä¸€ä¸ªåœ†å½¢å›¾ç‰‡</p><p>å¦å¤–è¿˜æœ‰ä¸€äº›å°å°çš„ç»†èŠ‚ï¼Œå¦‚æ¯ä¸€å—ä¹‹é—´çš„é—´è·ï¼Œæ¨ªçº¿ï¼Œæ¯ä¸€å—å†…éƒ¨çš„é—´è·ï¼Œè¿™äº›æˆ‘ä»¬ä½¿ç”¨ SizedBoxï¼ŒDivider å®ç°</p><p>é€šè¿‡ä¸Šé¢çš„åˆ†æï¼Œæˆ‘æ•´ç†å‡ºäº†ä¸€å¼ ç»“æ„å›¾ï¼š</p><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/0a63bcb7778c42c6bcfef99a9bb3c81e~tplv-k3u1fbpfcp-watermark.image" alt="flutter_11 (2).png"></p><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°±ç”¨ä»£ç å®ç°ä¸€ä¸‹ï¼š</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;package:flutter/material.dart&#x27;</span>;<br><br><span class="hljs-keyword">void</span> main() &#123;<br>  runApp(MyApp());<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyApp</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">StatelessWidget</span> </span>&#123;<br>  <span class="hljs-meta">@override</span><br>  Widget build(BuildContext context) &#123;<br>    <span class="hljs-keyword">return</span> MaterialApp(<br>      home: Scaffold(<br>        appBar: AppBar(<br>          title: Text(<span class="hljs-string">&quot;Flutter Widget Combine Pricetice&quot;</span>),<br>          elevation: <span class="hljs-number">30</span>, <span class="hljs-comment">//è®¾ç½®æ ‡é¢˜é˜´å½±</span><br>        ),<br>        body: MyHome(),<br>      ),<br>    );<br>  &#125;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyHome</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">StatelessWidget</span> </span>&#123;<br>  <span class="hljs-meta">@override</span><br>  Widget build(BuildContext context) &#123;<br>    <span class="hljs-keyword">return</span> Padding( <span class="hljs-comment">//Padding å®ç°é¡µé¢å…§é—´è·</span><br>      padding: EdgeInsets.all(<span class="hljs-number">10</span>),<br>      child: Column( <span class="hljs-comment">//Column å®ç°å¸ƒå±€å‚ç›´æ’åˆ—</span><br>        children: [<br>          Container( <span class="hljs-comment">//Container å®ç°é»‘è‰²é•¿æ–¹å½¢</span><br>              color: Colors.black,<br>              height: <span class="hljs-number">180</span><br>          ),<br>          SizedBox(height: <span class="hljs-number">10</span>), <span class="hljs-comment">//é«˜åº¦ä¸º 10 çš„é—´è·</span><br>          Row( <span class="hljs-comment">// Row + Expanded å®ç°æ¨ªå‘å¸ƒå±€çš„ç­‰æ¯”åˆ†é…</span><br>            children: [<br>              Expanded(<br>                  flex: <span class="hljs-number">2</span>,<br>                  child: Container( <span class="hljs-comment">//Container åµŒå¥— Image å®ç°å·¦è¾¹é•¿å›¾</span><br>                    child: Image.network(<br>                        <span class="hljs-string">&quot;https://img.lianzhixiu.com/uploads/210106/37-21010609363aS.jpg&quot;</span>,<br>                        fit: BoxFit.cover,<br>                        height: <span class="hljs-number">100</span>),<br>                  )),<br>              SizedBox(width: <span class="hljs-number">10</span>), <span class="hljs-comment">//é«˜åº¦ä¸º 10 çš„é—´è·</span><br>              Expanded(<br>                flex: <span class="hljs-number">1</span>,<br>                child: Container( <span class="hljs-comment">//Container åµŒå¥— ListView å®ç°å³è¾¹ä¸Šä¸‹ä¸¤å¼ è‡ªé€‚åº”å›¾</span><br>                  height: <span class="hljs-number">100</span>,<br>                  child: ListView(<br>                    children: [<br>                      Image.network(<br>                          <span class="hljs-string">&quot;https://img.lianzhixiu.com/uploads/210106/37-21010609363aS.jpg&quot;</span>,<br>                          fit: BoxFit.cover,<br>                          height: <span class="hljs-number">45</span>),<br>                      SizedBox(height: <span class="hljs-number">10</span>), <span class="hljs-comment">//é«˜åº¦ä¸º 10 çš„é—´è·</span><br>                      Image.network(<br>                          <span class="hljs-string">&quot;https://img.lianzhixiu.com/uploads/210106/37-21010609363aS.jpg&quot;</span>,<br>                          fit: BoxFit.cover,<br>                          height: <span class="hljs-number">45</span>),<br>                    ],<br>                  ),<br>                ),<br>              )<br>            ],<br>          ),<br>          Divider(), <span class="hljs-comment">//æ¨ªçº¿</span><br>          Stack( <span class="hljs-comment">// Stack + Align å®ç°å®šä½å¸ƒå±€</span><br>            children: [<br>              Align(<br>                  alignment: Alignment.topLeft,<br>                  child: Image.network(<span class="hljs-string">&quot;https://img.lianzhixiu.com/uploads/210106/37-21010609363aS.jpg&quot;</span>,<br>                      width: <span class="hljs-number">70</span>,<br>                      height: <span class="hljs-number">70</span>,<br>                      fit: BoxFit.cover)<br>              ),<br>              Align(<br>                  alignment: Alignment.topCenter,<br>                  child: Image.network(<span class="hljs-string">&quot;https://img.lianzhixiu.com/uploads/210106/37-21010609363aS.jpg&quot;</span>,<br>                      width: <span class="hljs-number">70</span>,<br>                      height: <span class="hljs-number">70</span>,<br>                      fit: BoxFit.cover)<br>              ),<br>              Align(<br>                  alignment: Alignment.topRight,<br>                  child: Image.network(<span class="hljs-string">&quot;https://img.lianzhixiu.com/uploads/210106/37-21010609363aS.jpg&quot;</span>,<br>                      width: <span class="hljs-number">70</span>,<br>                      height: <span class="hljs-number">70</span>,<br>                      fit: BoxFit.cover)<br>              )<br>            ],<br>          ),<br>          Divider(), <span class="hljs-comment">//æ¨ªçº¿</span><br>          ListTile( <span class="hljs-comment">// ListTile å®ç° item</span><br>            leading: ClipOval( <span class="hljs-comment">//åœ†å½¢å›¾ç‰‡</span><br>              child: Image.network(<br>                <span class="hljs-string">&quot;https://img.lianzhixiu.com/uploads/210106/37-21010609363aS.jpg&quot;</span>,<br>                width: <span class="hljs-number">50</span>,<br>                height: <span class="hljs-number">50</span>,<br>                fit: BoxFit.cover,<br>              ),<br>            ),<br>            title: Text(<br>              <span class="hljs-string">&quot;ä½ å¥½ï¼Œæˆ‘æ˜¯åˆ˜äº¦è²&quot;</span>,<span class="hljs-comment">//æ ‡é¢˜</span><br>              style: TextStyle(<br>                  color: Colors.green,<br>                  fontWeight: FontWeight.bold<br>              )<br>            ),<br>            subtitle: Text(<br>                <span class="hljs-string">&quot;å¾ˆé«˜å…´è®¤è¯†ä½ &quot;</span>,<span class="hljs-comment">//å‰¯æ ‡é¢˜</span><br>                style: TextStyle(<br>                  color: Colors.orange,<br>                )<br>            ),<br>          )<br>        ],<br>      ),<br>    );<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="å…­ã€æ€»ç»“"><a href="#å…­ã€æ€»ç»“" class="headerlink" title="å…­ã€æ€»ç»“"></a>å…­ã€æ€»ç»“</h2><p>æœ¬æ–‡é‡ç‚¹å†…å®¹ï¼š</p><p>1ã€é‡‡ç”¨ æ•ˆæœ -&gt; Widget ä»‹ç» -&gt; ä»£ç å®ç°çš„æ–¹å¼å¯¹ Imageï¼ŒListViewï¼ŒGridViewï¼ŒStack è¿›è¡Œäº†ä»‹ç»</p><p>2ã€åœ¨ä»‹ç»ä¸Šé¢ Widget çš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬åˆç©¿æ’äº†å…¶å®ƒä¸€äº› Widget çš„è®²è§£ï¼šClipOvalï¼ŒListTileï¼ŒExpandedï¼ŒSizedBoxï¼ŒDividerï¼ŒAlignï¼ŒPositionedï¼ŒPadding</p><p>3ã€æœ€åé€šè¿‡ä¸€ä¸ªç»¼åˆæ¡ˆä¾‹å¯¹ä»‹ç»çš„ Widget è¿›è¡Œç»„åˆä½¿ç”¨</p><p>å¥½äº†ï¼Œæœ¬ç¯‡æ–‡ç« åˆ°è¿™é‡Œå°±ç»“æŸäº†ï¼Œå¸Œæœ›èƒ½ç»™ä½ å¸¦æ¥å¸®åŠ© ğŸ¤</p><p><strong>æ„Ÿè°¢ä½ é˜…è¯»è¿™ç¯‡æ–‡ç« </strong></p><h3 id="ä¸‹ç¯‡é¢„å‘Š"><a href="#ä¸‹ç¯‡é¢„å‘Š" class="headerlink" title="ä¸‹ç¯‡é¢„å‘Š"></a>ä¸‹ç¯‡é¢„å‘Š</h3><p>ä¸‹ç¯‡æ–‡ç« æˆ‘ä¼šä»‹ç» Flutter Button ç›¸å…³ Widgetï¼Œä»¥åŠ Flutter 2.x Button çš„å˜åŒ–</p><h3 id="å‚è€ƒå’Œæ¨è"><a href="#å‚è€ƒå’Œæ¨è" class="headerlink" title="å‚è€ƒå’Œæ¨è"></a>å‚è€ƒå’Œæ¨è</h3><p><a href="https://api.flutter.dev/flutter/dart-ui/dart-ui-library.html">Flutter å®˜æ–¹ API æ–‡æ¡£</a></p><blockquote><p><strong>ä½ çš„ç‚¹èµï¼Œè¯„è®ºï¼Œæ˜¯å¯¹æˆ‘å·¨å¤§çš„é¼“åŠ±ï¼</strong></p><p>æ¬¢è¿å…³æ³¨æˆ‘çš„<strong>å…¬ä¼—å·ï¼š</strong>  <a href="http://m6z.cn/6jwi7b"><strong>sweetying</strong></a> ï¼Œæ–‡ç« æ›´æ–°å¯ç¬¬ä¸€æ—¶é—´æ”¶åˆ°</p><p>å¦‚æœ<strong>æœ‰é—®é¢˜</strong>ï¼Œå…¬ä¼—å·å†…æœ‰åŠ æˆ‘å¾®ä¿¡çš„å…¥å£ï¼Œåœ¨æŠ€æœ¯å­¦ä¹ ã€ä¸ªäººæˆé•¿çš„é“è·¯ä¸Šï¼Œæˆ‘ä»¬ä¸€èµ·å‰è¿›ï¼</p></blockquote>]]></content>
    
    
    <categories>
      
      <category>Flutter</category>
      
    </categories>
    
    
    <tags>
      
      <tag>åŸåˆ›</tag>
      
      <tag>Flutter</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Flutter ç³»åˆ—ï¼ˆä¸‰ï¼‰ï¼šFlutter ç‰¹ç‚¹åŠå¸¸ç”¨ Widget ä»‹ç»</title>
    <link href="/2022/10/10/Flutter%20%E7%B3%BB%E5%88%97%EF%BC%88%E4%B8%89%EF%BC%89%EF%BC%9AFlutter%20%E7%89%B9%E7%82%B9%E5%8F%8A%E5%B8%B8%E7%94%A8%20Widget%20%E4%BB%8B%E7%BB%8D/"/>
    <url>/2022/10/10/Flutter%20%E7%B3%BB%E5%88%97%EF%BC%88%E4%B8%89%EF%BC%89%EF%BC%9AFlutter%20%E7%89%B9%E7%82%B9%E5%8F%8A%E5%B8%B8%E7%94%A8%20Widget%20%E4%BB%8B%E7%BB%8D/</url>
    
    <content type="html"><![CDATA[<p><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/7e1baaa8a9b94961a5cae015b0890cf3~tplv-k3u1fbpfcp-watermark.image"></p><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>å¾ˆé«˜å…´é‡è§ä½ ~</p><p>åœ¨æœ¬ç³»åˆ—çš„ä¸Šä¸€ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å…¨é¢ä»‹ç»äº† Dart è¯­æ³•ï¼Œå†…å®¹å¾ˆå¤šï¼Œæ–‡å­—+ä»£ç æœ‰ä¸‰ä¸‡å¤šå­—ï¼Œå¦‚æœä½ èƒ½å¤Ÿè€å¿ƒçœ‹å®Œå¹¶æ‰‹æ•²é‡Œé¢çš„ç¤ºä¾‹ï¼Œä½ ä¸€å®šä¼šæ”¶è·å¾ˆå¤§ã€‚è¿˜æ²¡æœ‰çœ‹è¿‡ä¸Šä¸€ç¯‡æ–‡ç« çš„æœ‹å‹ï¼Œå»ºè®®å…ˆå»é˜…è¯» <a href="https://juejin.cn/post/7130647339294785549#heading-0">Flutter ç³»åˆ—ï¼ˆäºŒï¼‰ï¼šDart è¯­æ³•ç­‘åŸº</a>ã€‚æ¥ä¸‹æ¥æˆ‘ä»¬è¿›å…¥ Flutter çš„å­¦ä¹ ã€‚</p><h2 id="ä¸€ã€Flutter-ç‰¹ç‚¹ä»‹ç»"><a href="#ä¸€ã€Flutter-ç‰¹ç‚¹ä»‹ç»" class="headerlink" title="ä¸€ã€Flutter ç‰¹ç‚¹ä»‹ç»"></a>ä¸€ã€Flutter ç‰¹ç‚¹ä»‹ç»</h2><p>å­¦ä¹ ä¸€ä¸ªæ¡†æ¶ï¼Œæˆ‘ä»¬é¦–å…ˆè¦äº†è§£è¿™ä¸ªæ¡†æ¶çš„ç‰¹ç‚¹ï¼Œå°±å¥½æ¯”ä½ å­¦å¼€è½¦ä¸€æ ·ï¼Œä½ è¦çŸ¥é“è¿™ä¸ªè½¦æœ‰ä»€ä¹ˆç‰¹ç‚¹ï¼Œä½ æ‰èƒ½å¿«é€Ÿçš„å»ä¸Šæ‰‹å®ƒã€‚Flutter ç‰¹ç‚¹ä»‹ç»ï¼š</p><h3 id="1-1ã€åœ¨-Flutter-ä¸­ï¼Œä¸‡ç‰©çš†-Widgetï¼ˆç»„ä»¶ï¼‰"><a href="#1-1ã€åœ¨-Flutter-ä¸­ï¼Œä¸‡ç‰©çš†-Widgetï¼ˆç»„ä»¶ï¼‰" class="headerlink" title="1.1ã€åœ¨ Flutter ä¸­ï¼Œä¸‡ç‰©çš† Widgetï¼ˆç»„ä»¶ï¼‰"></a>1.1ã€åœ¨ Flutter ä¸­ï¼Œä¸‡ç‰©çš† Widgetï¼ˆç»„ä»¶ï¼‰</h3><p>æˆ‘ä»¬åœ¨å†™ Flutter æ—¶ï¼Œä¸€å®šè¦æœ‰è¿™æ ·çš„æ„è¯†ã€‚è¿™æ ·æˆ‘ä»¬æ‰èƒ½æ›´å¥½åœ°ä¸Šæ‰‹å­¦ä¹ ã€‚åœ¨ Flutter ä¸­ï¼Œå‡ ä¹ä»»ä½•ä¸œè¥¿éƒ½æ˜¯ Widgetï¼Œä¸ä»…æ˜¯å¸¸è§çš„ UI ç»„ä»¶ï¼Œç”šè‡³æ˜¯å¸ƒå±€æ–¹å¼ï¼Œæ ·å¼ï¼ŒåŠ¨ç”»ç­‰éƒ½æ˜¯ Widget</p><h3 id="1-2ã€Widget-åµŒå¥—"><a href="#1-2ã€Widget-åµŒå¥—" class="headerlink" title="1.2ã€Widget åµŒå¥—"></a>1.2ã€Widget åµŒå¥—</h3><p>å†™ Android æ—¶ï¼Œæˆ‘ä»¬ä¼šåœ¨ Xml æ–‡ä»¶ä¸­ç¼–å†™å¸ƒå±€åŠ View åµŒå¥—ï¼Œç„¶ååœ¨ Java æˆ– Kotlin æ–‡ä»¶ä¸­è¿›è¡Œ View é€»è¾‘ç¼–å†™ã€‚ä½†å†™ Flutterï¼Œæ— è®ºæ˜¯ Widget åµŒå¥—ï¼Œè¿˜æ˜¯ Widget é€»è¾‘ç¼–å†™ï¼Œéƒ½æ˜¯åœ¨ Dart æ–‡ä»¶ä¸­è¿›è¡Œå¤„ç†ï¼Œè¿™æ ·å°±ä¼šäº§ç”Ÿä¸€äº›é—®é¢˜ï¼š</p><blockquote><p>1ã€å¤æ‚ç•Œé¢å‡ºç°å„ç§æ·±å±‚ Widget åµŒå¥—</p><p>2ã€ä»£ç é€»è¾‘æ··ä¹±ï¼Œå¯è¯»æ€§å·®</p></blockquote><p>ä½œä¸º Android å¼€å‘ï¼Œæˆ‘ä¸€å¼€å§‹çœŸçš„å¾ˆä¸ä¹ æƒ¯ï¼Œä½†æ˜¯éšç€ä½ å­¦ä¹ çš„æ·±å…¥ï¼Œå¯¹é¡¹ç›®è¿›è¡Œåˆç†çš„æ¶æ„è®¾è®¡ï¼ŒåŒ…ç»“æ„è®¾è®¡ï¼Œæ¸…æ™°çš„ä»£ç æ³¨é‡Šï¼Œä¸Šé¢çš„é—®é¢˜åœ¨ä¸€å®šç¨‹åº¦ä¸Šå¾—åˆ°äº†è§£å†³</p><h3 id="1-3ã€Widget-çŠ¶æ€"><a href="#1-3ã€Widget-çŠ¶æ€" class="headerlink" title="1.3ã€Widget çŠ¶æ€"></a>1.3ã€Widget çŠ¶æ€</h3><p>åœ¨ Flutter ä¸­ï¼ŒWidget åˆ†ä¸ºä¸¤ç§ï¼š</p><blockquote><p>1ã€æ— çŠ¶æ€ Widget</p><p>2ã€æœ‰çŠ¶æ€ Widget</p></blockquote><p>æ— çŠ¶æ€ Widget (ç»§æ‰¿è‡ª StatelessWidget)ï¼šåˆå§‹åŒ–åæ— æ³•ä¿®æ”¹å…¶çŠ¶æ€å’Œ UIï¼Œå¦‚ï¼šTextï¼ŒScrollView</p><p>æœ‰çŠ¶æ€ Widget (ç»§æ‰¿è‡ª StatefulWidget)ï¼šå…¶çŠ¶æ€å¯èƒ½åœ¨ Widget ç”Ÿå‘½å‘¨æœŸä¸­å‘ç”Ÿå˜åŒ–ã€‚å¦‚ Imageï¼Œ Scrollable ç­‰ã€‚åœ¨è°ƒç”¨ setState æ–¹æ³•åï¼ŒWidget ä¼šé‡æ–°ç»˜åˆ¶ï¼Œåˆ›å»ºå…¶æ–°çš„ Widget</p><p>StatelessWidget å’Œ StatefulWidget éƒ½ç»§æ‰¿è‡ªWidget</p><p><strong>å° Tips</strong>ï¼š</p><p>1ã€åœ¨ä½ ç¼–å†™è‡ªå®šä¹‰ Widget æ—¶ï¼Œä½ é¦–å…ˆåˆ¤æ–­å®ƒæ˜¯æœ‰çŠ¶æ€çš„è¿˜æ˜¯æ— çŠ¶æ€çš„ï¼Œå¦‚æœ Widget éœ€è¦æ ¹æ®ç”¨æˆ·äº¤äº’æˆ–å…¶ä»–å› ç´ è¿›è¡Œæ›´æ”¹ï¼Œåˆ™è¯¥ Widget æ˜¯æœ‰çŠ¶æ€çš„ï¼Œå¦åˆ™å°±æ˜¯æ— çŠ¶æ€çš„</p><p>2ã€å½“ä½ éœ€è¦æ”¹å˜ Widget çŠ¶æ€æ—¶ï¼Œå¿…é¡»è°ƒç”¨ setState æ–¹æ³•æ¥é€šçŸ¥ Flutter æ¥æ›´æ–°åˆ›å»ºæ–°çš„ Widget</p><p><strong>æ³¨æ„</strong>ï¼šä¸Šé¢ä¸€äº›ç‰¹ç‚¹å¯èƒ½ä¸€å¼€å§‹ä¸èƒ½ç†è§£ï¼Œæ¥ç€å¾€ä¸‹çœ‹ï¼Œæœ‰äº›é—®é¢˜éšç€ä½ çŸ¥è¯†çš„ç§¯ç´¯ä¾¿è¿åˆƒè€Œè§£äº†</p><h2 id="äºŒã€Flutter-å¸¸ç”¨-Widget-ä»‹ç»"><a href="#äºŒã€Flutter-å¸¸ç”¨-Widget-ä»‹ç»" class="headerlink" title="äºŒã€Flutter å¸¸ç”¨ Widget ä»‹ç»"></a>äºŒã€Flutter å¸¸ç”¨ Widget ä»‹ç»</h2><p>å…ˆçœ‹ä¸€å¼ æ•ˆæœå›¾ï¼š</p><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/963be24804034c308ba042a9fe6c6aac~tplv-k3u1fbpfcp-watermark.image" alt="1661082533405.jpg"></p><p>é—®é¢˜ï¼šä¸Šé¢çš„æ•ˆæœæ€ä¹ˆå®ç°çš„å‘¢ğŸ¤”ï¸ï¼Ÿ</p><p>å¦‚æœä½ æ˜¯å°ç™½ï¼Œé‚£ä¹ˆå°±è·Ÿç€æˆ‘çš„æ­¥ä¼ç»§ç»­å¾€ä¸‹å­¦ä¹ ã€‚å¦‚æœä¸æ˜¯ï¼Œä½ å¯ä»¥æƒ³ä¸€ä¸‹å¯ä»¥ä½¿ç”¨å“ªäº› Widget åµŒå¥—æ¥å®ç°ï¼Œä»¥åŠå®ç°çš„ä¸€äº›ç»†èŠ‚ã€‚</p><p>å¾…æˆ‘ä»¬å­¦ä¹ å®Œä¸‹é¢çš„ Widget åï¼Œåœ¨æ¥è§£å†³è¿™ä¸ªé—®é¢˜</p><h3 id="2-1ã€MaterialApp"><a href="#2-1ã€MaterialApp" class="headerlink" title="2.1ã€MaterialApp"></a>2.1ã€MaterialApp</h3><p>è§åçŸ¥ä¹‰ï¼ŒMaterialApp å°±æ˜¯ä¸€ä¸ªå¸¦ Material Design è®¾è®¡é£æ ¼çš„ Widgetï¼Œä¸€èˆ¬ä½œä¸ºé¡¶å±‚ Widget æ¥ä½¿ç”¨</p><h4 id="2-1-1ã€å±æ€§"><a href="#2-1-1ã€å±æ€§" class="headerlink" title="2.1.1ã€å±æ€§"></a>2.1.1ã€å±æ€§</h4><p>æˆ‘ä»¬å¦‚æœè¦æŸ¥çœ‹ä¸€ä¸ª Widget æœ‰å“ªäº›å±æ€§ï¼Œå¯ä»¥é€šè¿‡ IDE ç›´æ¥ç‚¹å‡»è¿™ä¸ª Widget çš„æºç å»æŸ¥çœ‹ï¼Œä½ ä¼šå‘ç°æ¯ä¸ª Widget éƒ½åŒ…å«è®¸å¤šå±æ€§ï¼Œè¿™ä¹ˆå¤šå±æ€§ä¸å¯èƒ½æ¯ä¸ªéƒ½å»çœ‹ï¼Œæˆ‘çš„å»ºè®®æ˜¯ï¼š<strong>æŒæ¡åŸºç¡€å¸¸ç”¨çš„ï¼Œå…¶å®ƒç”¨åˆ°æ—¶ï¼Œçœ‹æºç æŒ‰éœ€å»å–</strong></p><p>MaterialApp æ„é€ æ–¹æ³•ï¼š</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-keyword">const</span> MaterialApp(&#123;<br>    Key? key,<br>    <span class="hljs-keyword">this</span>.navigatorKey,<br>    <span class="hljs-keyword">this</span>.scaffoldMessengerKey,<br>    <span class="hljs-keyword">this</span>.home,<br>    <span class="hljs-built_in">Map</span>&lt;<span class="hljs-built_in">String</span>, WidgetBuilder&gt; <span class="hljs-keyword">this</span>.routes = <span class="hljs-keyword">const</span> &lt;<span class="hljs-built_in">String</span>, WidgetBuilder&gt;&#123;&#125;,<br>    <span class="hljs-keyword">this</span>.initialRoute,<br>    <span class="hljs-keyword">this</span>.onGenerateRoute,<br>    <span class="hljs-keyword">this</span>.onGenerateInitialRoutes,<br>    <span class="hljs-keyword">this</span>.onUnknownRoute,<br>    <span class="hljs-built_in">List</span>&lt;NavigatorObserver&gt; <span class="hljs-keyword">this</span>.navigatorObservers = <span class="hljs-keyword">const</span> &lt;NavigatorObserver&gt;[],<br>    <span class="hljs-keyword">this</span>.builder,<br>    <span class="hljs-keyword">this</span>.title = <span class="hljs-string">&#x27;&#x27;</span>,<br>    <span class="hljs-keyword">this</span>.onGenerateTitle,<br>    <span class="hljs-keyword">this</span>.color,<br>    <span class="hljs-keyword">this</span>.theme,<br>    <span class="hljs-keyword">this</span>.darkTheme,<br>    <span class="hljs-keyword">this</span>.highContrastTheme,<br>    <span class="hljs-keyword">this</span>.highContrastDarkTheme,<br>    <span class="hljs-keyword">this</span>.themeMode = ThemeMode.system,<br>    <span class="hljs-keyword">this</span>.locale,<br>    <span class="hljs-keyword">this</span>.localizationsDelegates,<br>    <span class="hljs-keyword">this</span>.localeListResolutionCallback,<br>    <span class="hljs-keyword">this</span>.localeResolutionCallback,<br>    <span class="hljs-keyword">this</span>.supportedLocales = <span class="hljs-keyword">const</span> &lt;Locale&gt;[Locale(<span class="hljs-string">&#x27;en&#x27;</span>, <span class="hljs-string">&#x27;US&#x27;</span>)],<br>    <span class="hljs-keyword">this</span>.debugShowMaterialGrid = <span class="hljs-keyword">false</span>,<br>    <span class="hljs-keyword">this</span>.showPerformanceOverlay = <span class="hljs-keyword">false</span>,<br>    <span class="hljs-keyword">this</span>.checkerboardRasterCacheImages = <span class="hljs-keyword">false</span>,<br>    <span class="hljs-keyword">this</span>.checkerboardOffscreenLayers = <span class="hljs-keyword">false</span>,<br>    <span class="hljs-keyword">this</span>.showSemanticsDebugger = <span class="hljs-keyword">false</span>,<br>    <span class="hljs-keyword">this</span>.debugShowCheckedModeBanner = <span class="hljs-keyword">true</span>,<br>    <span class="hljs-keyword">this</span>.shortcuts,<br>    <span class="hljs-keyword">this</span>.actions,<br>    <span class="hljs-keyword">this</span>.restorationScopeId,<br>    <span class="hljs-keyword">this</span>.scrollBehavior,<br>    <span class="hljs-keyword">this</span>.useInheritedMediaQuery = <span class="hljs-keyword">false</span>,<br>  &#125;) : <span class="hljs-keyword">assert</span>(routes != <span class="hljs-keyword">null</span>),<br>       <span class="hljs-keyword">assert</span>(navigatorObservers != <span class="hljs-keyword">null</span>),<br>       <span class="hljs-keyword">assert</span>(title != <span class="hljs-keyword">null</span>),<br>       <span class="hljs-keyword">assert</span>(debugShowMaterialGrid != <span class="hljs-keyword">null</span>),<br>       <span class="hljs-keyword">assert</span>(showPerformanceOverlay != <span class="hljs-keyword">null</span>),<br>       <span class="hljs-keyword">assert</span>(checkerboardRasterCacheImages != <span class="hljs-keyword">null</span>),<br>       <span class="hljs-keyword">assert</span>(checkerboardOffscreenLayers != <span class="hljs-keyword">null</span>),<br>       <span class="hljs-keyword">assert</span>(showSemanticsDebugger != <span class="hljs-keyword">null</span>),<br>       <span class="hljs-keyword">assert</span>(debugShowCheckedModeBanner != <span class="hljs-keyword">null</span>),<br>       routeInformationProvider = <span class="hljs-keyword">null</span>,<br>       routeInformationParser = <span class="hljs-keyword">null</span>,<br>       routerDelegate = <span class="hljs-keyword">null</span>,<br>       backButtonDispatcher = <span class="hljs-keyword">null</span>,<br>       <span class="hljs-keyword">super</span>(key: key);<br></code></pre></td></tr></table></figure><p><strong>æ³¨æ„</strong>ï¼šä¸‹é¢ä»‹ç»çš„å±æ€§ä»…æ˜¯ç”¨äºå®ç°ä¸Šé¢çš„æ•ˆæœå›¾</p><p>MaterialApp å¸¸ç”¨å±æ€§ï¼š</p><table><thead><tr><th>å±æ€§</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td>home</td><td>é…ç½® App ä¸»é¡µ</td></tr></tbody></table><p>MaterialApp æ›´å¤šå±æ€§ä»‹ç»ï¼š<a href="https://segmentfault.com/a/1190000040552453">https://segmentfault.com/a/1190000040552453</a></p><h3 id="2-2ã€Scaffold"><a href="#2-2ã€Scaffold" class="headerlink" title="2.2ã€Scaffold"></a>2.2ã€Scaffold</h3><p>Scaffold æ˜¯ä¸€ä¸ª Material Design è®¾è®¡é£æ ¼çš„è„šæ‰‹æ¶ Widgetï¼Œä¸€èˆ¬åµŒå¥—åœ¨ MaterialApp çš„ home å±æ€§ä¸­</p><h4 id="2-2-1ã€å±æ€§"><a href="#2-2-1ã€å±æ€§" class="headerlink" title="2.2.1ã€å±æ€§"></a>2.2.1ã€å±æ€§</h4><p>Scaffold æ„é€ æ–¹æ³•ï¼š</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-keyword">const</span> Scaffold(&#123;<br>    Key? key,<br>    <span class="hljs-keyword">this</span>.appBar,<br>    <span class="hljs-keyword">this</span>.body,<br>    <span class="hljs-keyword">this</span>.floatingActionButton,<br>    <span class="hljs-keyword">this</span>.floatingActionButtonLocation,<br>    <span class="hljs-keyword">this</span>.floatingActionButtonAnimator,<br>    <span class="hljs-keyword">this</span>.persistentFooterButtons,<br>    <span class="hljs-keyword">this</span>.drawer,<br>    <span class="hljs-keyword">this</span>.onDrawerChanged,<br>    <span class="hljs-keyword">this</span>.endDrawer,<br>    <span class="hljs-keyword">this</span>.onEndDrawerChanged,<br>    <span class="hljs-keyword">this</span>.bottomNavigationBar,<br>    <span class="hljs-keyword">this</span>.bottomSheet,<br>    <span class="hljs-keyword">this</span>.backgroundColor,<br>    <span class="hljs-keyword">this</span>.resizeToAvoidBottomInset,<br>    <span class="hljs-keyword">this</span>.primary = <span class="hljs-keyword">true</span>,<br>    <span class="hljs-keyword">this</span>.drawerDragStartBehavior = DragStartBehavior.start,<br>    <span class="hljs-keyword">this</span>.extendBody = <span class="hljs-keyword">false</span>,<br>    <span class="hljs-keyword">this</span>.extendBodyBehindAppBar = <span class="hljs-keyword">false</span>,<br>    <span class="hljs-keyword">this</span>.drawerScrimColor,<br>    <span class="hljs-keyword">this</span>.drawerEdgeDragWidth,<br>    <span class="hljs-keyword">this</span>.drawerEnableOpenDragGesture = <span class="hljs-keyword">true</span>,<br>    <span class="hljs-keyword">this</span>.endDrawerEnableOpenDragGesture = <span class="hljs-keyword">true</span>,<br>    <span class="hljs-keyword">this</span>.restorationId,<br>  &#125;) : <span class="hljs-keyword">assert</span>(primary != <span class="hljs-keyword">null</span>),<br>       <span class="hljs-keyword">assert</span>(extendBody != <span class="hljs-keyword">null</span>),<br>       <span class="hljs-keyword">assert</span>(extendBodyBehindAppBar != <span class="hljs-keyword">null</span>),<br>       <span class="hljs-keyword">assert</span>(drawerDragStartBehavior != <span class="hljs-keyword">null</span>),<br>       <span class="hljs-keyword">super</span>(key: key);<br></code></pre></td></tr></table></figure><table><thead><tr><th>å±æ€§</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td>appBar</td><td>é…ç½®æ˜¾ç¤ºåœ¨ç•Œé¢é¡¶éƒ¨çš„ä¸€ä¸ª AppBar</td></tr><tr><td>body</td><td>é…ç½®å½“å‰ç•Œé¢æ‰€æ˜¾ç¤ºçš„ä¸»è¦å†…å®¹ Widget</td></tr></tbody></table><p>Scaffold æ›´å¤šå±æ€§ä»‹ç»ï¼š<a href="https://segmentfault.com/a/1190000040554948">https://segmentfault.com/a/1190000040554948</a></p><p>ä»¥ä¸Šä¸¤ä¸ª Widget å°±èƒ½æ­å»ºèµ·é¡µé¢çš„åŸºæœ¬æ¡†æ¶äº†ï¼Œä½†æ˜¯çœ‹åˆ°çš„ä¼šæ˜¯ä¸€ä¸ªç©ºç™½çš„é¡µé¢ã€‚å›åˆ°ä¸Šé¢é‚£å¼ å›¾ï¼Œæˆ‘ä»¬çœ‹åˆ°é¡¶éƒ¨æœ‰ä¸€ä¸ªæ ‡é¢˜æ ï¼Œè€Œä¸”è¿˜æœ‰é˜´å½±ï¼ŒFlutter ç»™æˆ‘ä»¬æä¾›äº† AppBar æ¥å®ç°</p><h3 id="2-3ã€AppBar"><a href="#2-3ã€AppBar" class="headerlink" title="2.3ã€AppBar"></a>2.3ã€AppBar</h3><p>AppBar æ˜¯åŸºäº Material Design è®¾è®¡é£æ ¼çš„æ ‡é¢˜æ  Widgetï¼Œä¸€èˆ¬åœ¨ Scaffold çš„ appBar å±æ€§ä¸­ä½¿ç”¨ï¼Œä½œä¸ºé¡¶éƒ¨æ ‡é¢˜æ </p><h4 id="2-3-1ã€å±æ€§"><a href="#2-3-1ã€å±æ€§" class="headerlink" title="2.3.1ã€å±æ€§"></a>2.3.1ã€å±æ€§</h4><p>AppBar æ„é€ æ–¹æ³•ï¼š</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><code class="hljs dart">AppBar(&#123;<br>    Key? key,<br>    <span class="hljs-keyword">this</span>.leading,<br>    <span class="hljs-keyword">this</span>.automaticallyImplyLeading = <span class="hljs-keyword">true</span>,<br>    <span class="hljs-keyword">this</span>.title,<br>    <span class="hljs-keyword">this</span>.actions,<br>    <span class="hljs-keyword">this</span>.flexibleSpace,<br>    <span class="hljs-keyword">this</span>.bottom,<br>    <span class="hljs-keyword">this</span>.elevation,<br>    <span class="hljs-keyword">this</span>.shadowColor,<br>    <span class="hljs-keyword">this</span>.shape,<br>    <span class="hljs-keyword">this</span>.backgroundColor,<br>    <span class="hljs-keyword">this</span>.foregroundColor,<br>    <span class="hljs-meta">@Deprecated</span>(<br>      <span class="hljs-string">&#x27;This property is no longer used, please use systemOverlayStyle instead. &#x27;</span><br>      <span class="hljs-string">&#x27;This feature was deprecated after v2.4.0-0.0.pre.&#x27;</span>,<br>    )<br>    <span class="hljs-keyword">this</span>.brightness,<br>    <span class="hljs-keyword">this</span>.iconTheme,<br>    <span class="hljs-keyword">this</span>.actionsIconTheme,<br>    <span class="hljs-meta">@Deprecated</span>(<br>      <span class="hljs-string">&#x27;This property is no longer used, please use toolbarTextStyle and titleTextStyle instead. &#x27;</span><br>      <span class="hljs-string">&#x27;This feature was deprecated after v2.4.0-0.0.pre.&#x27;</span>,<br>    )<br>    <span class="hljs-keyword">this</span>.textTheme,<br>    <span class="hljs-keyword">this</span>.primary = <span class="hljs-keyword">true</span>,<br>    <span class="hljs-keyword">this</span>.centerTitle,<br>    <span class="hljs-keyword">this</span>.excludeHeaderSemantics = <span class="hljs-keyword">false</span>,<br>    <span class="hljs-keyword">this</span>.titleSpacing,<br>    <span class="hljs-keyword">this</span>.toolbarOpacity = <span class="hljs-number">1.0</span>,<br>    <span class="hljs-keyword">this</span>.bottomOpacity = <span class="hljs-number">1.0</span>,<br>    <span class="hljs-keyword">this</span>.toolbarHeight,<br>    <span class="hljs-keyword">this</span>.leadingWidth,<br>    <span class="hljs-meta">@Deprecated</span>(<br>      <span class="hljs-string">&#x27;This property is obsolete and is false by default. &#x27;</span><br>      <span class="hljs-string">&#x27;This feature was deprecated after v2.4.0-0.0.pre.&#x27;</span>,<br>    )<br>    <span class="hljs-keyword">this</span>.backwardsCompatibility,<br>    <span class="hljs-keyword">this</span>.toolbarTextStyle,<br>    <span class="hljs-keyword">this</span>.titleTextStyle,<br>    <span class="hljs-keyword">this</span>.systemOverlayStyle,<br>  &#125;) : <span class="hljs-keyword">assert</span>(automaticallyImplyLeading != <span class="hljs-keyword">null</span>),<br>       <span class="hljs-keyword">assert</span>(elevation == <span class="hljs-keyword">null</span> || elevation &gt;= <span class="hljs-number">0.0</span>),<br>       <span class="hljs-keyword">assert</span>(primary != <span class="hljs-keyword">null</span>),<br>       <span class="hljs-keyword">assert</span>(toolbarOpacity != <span class="hljs-keyword">null</span>),<br>       <span class="hljs-keyword">assert</span>(bottomOpacity != <span class="hljs-keyword">null</span>),<br>       preferredSize = _PreferredAppBarSize(toolbarHeight, bottom?.preferredSize.height),<br>       <span class="hljs-keyword">super</span>(key: key);<br></code></pre></td></tr></table></figure><table><thead><tr><th>å±æ€§</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td>title</td><td>é…ç½®æ ‡é¢˜æ çš„æ ‡é¢˜</td></tr><tr><td>elevation</td><td>é…ç½®æ ‡é¢˜æ ä¸‹æ–¹çš„é˜´å½±å¤§å°</td></tr></tbody></table><p>AppBar æ›´å¤šå±æ€§ä»‹ç»ï¼š<a href="https://segmentfault.com/a/1190000040562147">https://segmentfault.com/a/1190000040562147</a></p><p>æ ‡é¢˜æ å®ç°äº†ï¼Œæ¥ä¸‹æ¥å°±æ˜¯ body ä¸»ä½“éƒ¨åˆ†ï¼Œæˆ‘ä»¬åœ¨æ¥åˆ†æä¸€ä¸‹ï¼šå¯ä»¥çœ‹åˆ°ï¼Œä¸»ä½“éƒ¨åˆ†æ˜¯ä¸€ä¸ª<strong>å±…ä¸­</strong>æ˜¾ç¤ºçš„<strong>åœ†å½¢</strong>å›¾åƒï¼ŒèƒŒæ™¯æ˜¯è“è‰²ï¼Œæœ‰ä¸ªçº¢è‰²çš„è¾¹æ¡†ã€‚åœ†å½¢å›¾åƒé‡Œé¢æœ‰ä¸€è¡Œ<strong>æ–‡æœ¬</strong>ï¼Œæ–‡æœ¬çš„é¢œè‰²æ˜¯ç™½è‰²ï¼Œå­—ä½“æœ‰ç‚¹å€¾æ–œï¼Œå­—é—´è·åå¤§ï¼Œåªæ˜¾ç¤ºäº†ä¸€è¡Œï¼Œè¶…å‡ºéƒ¨åˆ† â€¦ ï¼Œè€Œä¸”æ–‡æœ¬çš„ä¸­é—´æœ‰ä¸€ä¸ªçº¢è‰²çš„è™šåˆ é™¤çº¿</p><p>ä¸Šé¢åŠ ç²—çš„æ–‡å­—å°±æ˜¯ç”¨äºå®ç°è¯¥æ•ˆæœçš„ Widgetï¼šCenterï¼ŒContainerï¼ŒText</p><h3 id="2-4ã€Center"><a href="#2-4ã€Center" class="headerlink" title="2.4ã€Center"></a>2.4ã€Center</h3><p>Center å°±æ˜¯å°†å­ Widget è¿›è¡Œä¸€ä¸ªå±…ä¸­å±•ç¤ºçš„ Widgetï¼Œå®ƒç»§æ‰¿è‡ª Alignï¼Œå› ä¸º Align é»˜è®¤çš„å¯¹é½æ–¹å¼æ˜¯å±…ä¸­çš„ï¼Œæ‰€ä»¥å®ƒèƒ½å®ç°å±…ä¸­æ•ˆæœï¼Œå¦‚æœ Center çš„å°ºå¯¸æ²¡æœ‰å—åˆ°é™åˆ¶ï¼Œé‚£ä¹ˆå®ƒå°†å……æ»¡æ•´ä¸ªå±å¹•</p><h4 id="2-4-1ã€å±æ€§"><a href="#2-4-1ã€å±æ€§" class="headerlink" title="2.4.1ã€å±æ€§"></a>2.4.1ã€å±æ€§</h4><p>Center æ„é€ æ–¹æ³•ï¼š</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-keyword">const</span> Center(&#123; Key? key, <span class="hljs-built_in">double?</span> widthFactor, <span class="hljs-built_in">double?</span> heightFactor, Widget? child &#125;)<br>    : <span class="hljs-keyword">super</span>(key: key, widthFactor: widthFactor, heightFactor: heightFactor, child: child);<br></code></pre></td></tr></table></figure><table><thead><tr><th>å±æ€§</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td>child</td><td>é…ç½®å±…ä¸­æ˜¾ç¤ºçš„å­ Widget</td></tr></tbody></table><h3 id="2-5ã€Container"><a href="#2-5ã€Container" class="headerlink" title="2.5ã€Container"></a>2.5ã€Container</h3><p>Container æ˜¯ Flutter ç»™æˆ‘ä»¬æä¾›çš„ä¸€ä¸ªå¤šåŠŸèƒ½ Widgetï¼Œå¦‚æœå­ Widget éœ€è¦ä¸€äº›èƒŒæ™¯æ ·å¼ã€å½¢çŠ¶ã€å°ºå¯¸é™åˆ¶ç­‰ï¼Œæˆ‘ä»¬å°±å¯ä»¥åˆ©ç”¨ Container æ¥è¿›è¡ŒåŒ…è£¹ï¼Œä¸Šé¢çš„åœ†å½¢å›¾åƒå°±æ˜¯ä½¿ç”¨ Container æ¥å®ç°çš„</p><h4 id="2-5-1ã€å±æ€§"><a href="#2-5-1ã€å±æ€§" class="headerlink" title="2.5.1ã€å±æ€§"></a>2.5.1ã€å±æ€§</h4><p>Container æ„é€ æ–¹æ³•ï¼š</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs dart">Container(&#123;<br>    Key? key,<br>    <span class="hljs-keyword">this</span>.alignment,<br>    <span class="hljs-keyword">this</span>.padding,<br>    <span class="hljs-keyword">this</span>.color,<br>    <span class="hljs-keyword">this</span>.decoration,<br>    <span class="hljs-keyword">this</span>.foregroundDecoration,<br>    <span class="hljs-built_in">double?</span> width,<br>    <span class="hljs-built_in">double?</span> height,<br>    BoxConstraints? constraints,<br>    <span class="hljs-keyword">this</span>.margin,<br>    <span class="hljs-keyword">this</span>.transform,<br>    <span class="hljs-keyword">this</span>.transformAlignment,<br>    <span class="hljs-keyword">this</span>.child,<br>    <span class="hljs-keyword">this</span>.clipBehavior = Clip.none,<br>  &#125;) : <span class="hljs-keyword">assert</span>(margin == <span class="hljs-keyword">null</span> || margin.isNonNegative),<br>       <span class="hljs-keyword">assert</span>(padding == <span class="hljs-keyword">null</span> || padding.isNonNegative),<br>       <span class="hljs-keyword">assert</span>(decoration == <span class="hljs-keyword">null</span> || decoration.debugAssertIsValid()),<br>       <span class="hljs-keyword">assert</span>(constraints == <span class="hljs-keyword">null</span> || constraints.debugAssertIsValid()),<br>       <span class="hljs-keyword">assert</span>(clipBehavior != <span class="hljs-keyword">null</span>),<br>       <span class="hljs-keyword">assert</span>(decoration != <span class="hljs-keyword">null</span> || clipBehavior == Clip.none),<br>       <span class="hljs-keyword">assert</span>(color == <span class="hljs-keyword">null</span> || decoration == <span class="hljs-keyword">null</span>,<br>         <span class="hljs-string">&#x27;Cannot provide both a color and a decoration\n&#x27;</span><br>         <span class="hljs-string">&#x27;To provide both, use &quot;decoration: BoxDecoration(color: color)&quot;.&#x27;</span>,<br>       ),<br>       constraints =<br>        (width != <span class="hljs-keyword">null</span> || height != <span class="hljs-keyword">null</span>)<br>          ? constraints?.tighten(width: width, height: height)<br>            ?? BoxConstraints.tightFor(width: width, height: height)<br>          : constraints,<br>       <span class="hljs-keyword">super</span>(key: key);<br></code></pre></td></tr></table></figure><table><thead><tr><th>å±æ€§</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td>child</td><td>é…ç½®æ˜¾ç¤ºçš„å­ Widget</td></tr><tr><td>color</td><td>é…ç½® Container èƒŒæ™¯é¢œè‰²</td></tr><tr><td>width</td><td>é…ç½® Container æ˜¾ç¤ºçš„å®½åº¦</td></tr><tr><td>height</td><td>é…ç½® Container æ˜¾ç¤ºçš„é«˜åº¦</td></tr><tr><td>alignment</td><td>é…ç½®å­ Widget çš„å¯¹é½æ–¹å¼</td></tr><tr><td>padding</td><td>é…ç½® Container å…§è¾¹è·</td></tr><tr><td>decoration</td><td>é…ç½® Container è£…é¥°</td></tr></tbody></table><p>decoration æ¥æ”¶ä¸€ä¸ª Decoration ç±»å‹çš„å‚æ•°ï¼Œå…¶å®ç°ç±»ï¼šBoxDecorationï¼ŒBoxDecoration çš„å±æ€§ï¼š</p><table><thead><tr><th>å±æ€§</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td>color</td><td>é…ç½® Container èƒŒæ™¯é¢œè‰²</td></tr><tr><td>border</td><td>é…ç½® Container æ˜¾ç¤ºçš„è¾¹æ¡†</td></tr><tr><td>borderRadius</td><td>é…ç½® Container æ˜¾ç¤ºçš„åœ†è§’</td></tr></tbody></table><p><strong>æ³¨æ„</strong>ï¼šå¦‚æœ BoxDecoration è®¾ç½®äº† color å±æ€§ï¼Œå°±ä¸èƒ½è®¾ç½® Container çš„ color å±æ€§ï¼Œå¦åˆ™ä¼šæŠ¥é”™ï¼Œæ­¤æ—¶åœ¨ BoxDecoration ä¸­è®¾ç½® color å³å¯</p><p>Container æ›´å¤šå±æ€§ä»‹ç»ï¼š<a href="https://www.liujunmin.com/flutter/container.html">https://www.liujunmin.com/flutter/container.html</a></p><h3 id="2-6ã€Text"><a href="#2-6ã€Text" class="headerlink" title="2.6ã€Text"></a>2.6ã€Text</h3><p>Text æ˜¯ Flutter ç»™æˆ‘ä»¬æä¾›çš„æ–‡æœ¬ Widgetï¼Œæœ€å¸¸ç”¨çš„ Widget ä¹‹ä¸€ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å®ƒæ¥å®ç°å„ç§æ–‡æœ¬æ•ˆæœ</p><h4 id="2-6-1ã€å±æ€§"><a href="#2-6-1ã€å±æ€§" class="headerlink" title="2.6.1ã€å±æ€§"></a>2.6.1ã€å±æ€§</h4><p>Text æ„é€ æ–¹æ³•ï¼š</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-keyword">const</span> Text(<br>    <span class="hljs-built_in">String</span> <span class="hljs-keyword">this</span>.data, &#123;<br>    Key? key,<br>    <span class="hljs-keyword">this</span>.style,<br>    <span class="hljs-keyword">this</span>.strutStyle,<br>    <span class="hljs-keyword">this</span>.textAlign,<br>    <span class="hljs-keyword">this</span>.textDirection,<br>    <span class="hljs-keyword">this</span>.locale,<br>    <span class="hljs-keyword">this</span>.softWrap,<br>    <span class="hljs-keyword">this</span>.overflow,<br>    <span class="hljs-keyword">this</span>.textScaleFactor,<br>    <span class="hljs-keyword">this</span>.maxLines,<br>    <span class="hljs-keyword">this</span>.semanticsLabel,<br>    <span class="hljs-keyword">this</span>.textWidthBasis,<br>    <span class="hljs-keyword">this</span>.textHeightBehavior,<br>  &#125;) : <span class="hljs-keyword">assert</span>(<br>         data != <span class="hljs-keyword">null</span>,<br>         <span class="hljs-string">&#x27;A non-null String must be provided to a Text widget.&#x27;</span>,<br>       ),<br>       textSpan = <span class="hljs-keyword">null</span>,<br>       <span class="hljs-keyword">super</span>(key: key);<br></code></pre></td></tr></table></figure><p>TextStyle æ„é€ æ–¹æ³•ï¼š</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-keyword">const</span> TextStyle(&#123;<br>    <span class="hljs-keyword">this</span>.inherit = <span class="hljs-keyword">true</span>,<br>    <span class="hljs-keyword">this</span>.color,<br>    <span class="hljs-keyword">this</span>.backgroundColor,<br>    <span class="hljs-keyword">this</span>.fontSize,<br>    <span class="hljs-keyword">this</span>.fontWeight,<br>    <span class="hljs-keyword">this</span>.fontStyle,<br>    <span class="hljs-keyword">this</span>.letterSpacing,<br>    <span class="hljs-keyword">this</span>.wordSpacing,<br>    <span class="hljs-keyword">this</span>.textBaseline,<br>    <span class="hljs-keyword">this</span>.height,<br>    <span class="hljs-keyword">this</span>.leadingDistribution,<br>    <span class="hljs-keyword">this</span>.locale,<br>    <span class="hljs-keyword">this</span>.foreground,<br>    <span class="hljs-keyword">this</span>.background,<br>    <span class="hljs-keyword">this</span>.shadows,<br>    <span class="hljs-keyword">this</span>.fontFeatures,<br>    <span class="hljs-keyword">this</span>.decoration,<br>    <span class="hljs-keyword">this</span>.decorationColor,<br>    <span class="hljs-keyword">this</span>.decorationStyle,<br>    <span class="hljs-keyword">this</span>.decorationThickness,<br>    <span class="hljs-keyword">this</span>.debugLabel,<br>    <span class="hljs-built_in">String?</span> fontFamily,<br>    <span class="hljs-built_in">List</span>&lt;<span class="hljs-built_in">String</span>&gt;? fontFamilyFallback,<br>    <span class="hljs-built_in">String?</span> package,<br>    <span class="hljs-keyword">this</span>.overflow,<br>  &#125;) : fontFamily = package == <span class="hljs-keyword">null</span> ? fontFamily : <span class="hljs-string">&#x27;packages/<span class="hljs-subst">$package</span>/<span class="hljs-subst">$fontFamily</span>&#x27;</span>,<br>       _fontFamilyFallback = fontFamilyFallback,<br>       _package = package,<br>       <span class="hljs-keyword">assert</span>(inherit != <span class="hljs-keyword">null</span>),<br>       <span class="hljs-keyword">assert</span>(color == <span class="hljs-keyword">null</span> || foreground == <span class="hljs-keyword">null</span>, _kColorForegroundWarning),<br>       <span class="hljs-keyword">assert</span>(backgroundColor == <span class="hljs-keyword">null</span> || background == <span class="hljs-keyword">null</span>, _kColorBackgroundWarning);<br></code></pre></td></tr></table></figure><table><thead><tr><th>å±æ€§</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td>data</td><td>é…ç½® Text è¦æ˜¾ç¤ºçš„å­—ç¬¦ä¸²ï¼Œå¿…é¡»é…ç½®</td></tr><tr><td>maxLines</td><td>é…ç½® Text èƒ½æ˜¾ç¤ºçš„æœ€å¤§è¡Œæ•°</td></tr><tr><td>overflow</td><td>é…ç½® Text æ–‡å­—è¶…å‡ºå±å¹•åçš„å¤„ç†æ–¹å¼ï¼ˆclipï¼šè£å‰ªï¼Œfadeï¼šæ¸éšï¼Œellipsisï¼šâ€¦çœç•¥ï¼‰</td></tr><tr><td>style</td><td>é…ç½® Text æ˜¾ç¤ºçš„æ ·å¼</td></tr></tbody></table><p>style æ¥æ”¶ä¸€ä¸ª TextStyle ç±»å‹çš„å‚æ•°ï¼Œå®ƒçš„å±æ€§ï¼š</p><table><thead><tr><th>å±æ€§</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td>fontSize</td><td>é…ç½® Text æ˜¾ç¤ºçš„å­—ä½“å¤§å°</td></tr><tr><td>fontWeight</td><td>é…ç½® Text æ˜¾ç¤ºçš„å­—ä½“ç²—ç»†ï¼ˆboldï¼šç²—ä½“ï¼Œnormalï¼šæ­£å¸¸ä½“ï¼‰</td></tr><tr><td>color</td><td>é…ç½® Text æ˜¾ç¤ºçš„æ–‡å­—é¢œè‰²</td></tr><tr><td>decoration</td><td>é…ç½® text æ˜¾ç¤ºçš„è£…é¥°çº¿ï¼ˆnoneï¼šæ²¡æœ‰çº¿ï¼ŒlineThroughï¼šåˆ é™¤çº¿ï¼Œoverlineï¼šä¸Šåˆ’çº¿ï¼Œunderlineï¼šä¸‹åˆ’çº¿ï¼‰</td></tr><tr><td>decorationColor</td><td>é…ç½® Text æ˜¾ç¤ºçš„è£…é¥°çº¿é¢œè‰²</td></tr><tr><td>decorationStyle</td><td>é…ç½® Text æ˜¾ç¤ºçš„è£…é¥°çº¿é£æ ¼ï¼ˆdashedï¼šé•¿è™šçº¿ï¼Œdottedï¼šç‚¹è™šçº¿ï¼Œdoubleï¼šä¸¤æ ¹çº¿ï¼Œsolidï¼šä¸€æ ¹å®çº¿ï¼Œwavyï¼šæ³¢æµªçº¿ï¼‰</td></tr><tr><td>wordSpacing</td><td>é…ç½® Text æ˜¾ç¤ºçš„å•è¯é—´éš™</td></tr><tr><td>letterSpacing</td><td>é…ç½® Text æ˜¾ç¤ºçš„å­—æ¯é—´éš™</td></tr><tr><td>fontStyle</td><td>é…ç½® Text æ˜¾ç¤ºçš„æ–‡å­—æ ·å¼ï¼ˆitalicï¼šæ–œä½“ï¼Œnormalï¼šæ­£å¸¸ä½“ï¼‰</td></tr></tbody></table><p>Text æ›´å¤šå±æ€§ä»‹ç»ï¼š<a href="https://juejin.cn/post/6844903724846972942">https://juejin.cn/post/6844903724846972942</a></p><p>ä¸Šé¢ä»‹ç»çš„ Widget å°±å¯ä»¥å®ç°æ•ˆæœå›¾äº†ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬æ¥å®ç°ä¸€ä¸‹å®ƒå§</p><h2 id="ä¸‰ã€æ•ˆæœå›¾å®ç°"><a href="#ä¸‰ã€æ•ˆæœå›¾å®ç°" class="headerlink" title="ä¸‰ã€æ•ˆæœå›¾å®ç°"></a>ä¸‰ã€æ•ˆæœå›¾å®ç°</h2><p>ä¸€ä¸ªæ¸…æ™°çš„æ€è·¯å¾ˆé‡è¦ï¼Œæˆ‘ä»¬å…ˆæ‹ä¸€æ‹ï¼š</p><p>1ã€ä½¿ç”¨ MaterialApp å’Œ Scaffold æ­å»ºé¡µé¢çš„åŸºæœ¬æ¡†æ¶</p><p>2ã€ä½¿ç”¨ AppBar å®ç°å¸¦é˜´å½±çš„é¡¶éƒ¨æ ‡é¢˜æ </p><p>3ã€ä½¿ç”¨ Center åµŒå¥—ä¸€ä¸ª Container å±…ä¸­æ˜¾ç¤ºï¼Œç„¶åé€šè¿‡ Container å±æ€§é…ç½®å°† Container è®¾ç½®ä¸ºå¸¦çº¢è‰²è¾¹æ¡†çš„åœ†å½¢å›¾åƒï¼ŒContainer åµŒå¥—ä¸€ä¸ª Text ï¼Œåœ¨å¯¹ Text è¿›è¡Œå±æ€§é…ç½®å³å¯</p><p>ä»£ç å®ç°å¦‚ä¸‹ï¼š</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;package:flutter/material.dart&#x27;</span>;<br><br><span class="hljs-keyword">void</span> main() &#123;<br>  runApp(MaterialApp(<br>    home: Scaffold(<br>      appBar: AppBar(<br>        title: Text(<span class="hljs-string">&quot;Flutter Widget Learning&quot;</span>),<span class="hljs-comment">//è®¾ç½®æ ‡é¢˜æ æ ‡é¢˜</span><br>        elevation: <span class="hljs-number">30</span>,<span class="hljs-comment">//è®¾ç½®æ ‡é¢˜æ é˜´å½±</span><br>      ),<br>      body: Center(<br>        child: Container( <span class="hljs-comment">// Center åµŒå¥—ä¸€ä¸ª Container</span><br>          width: <span class="hljs-number">300</span>, <span class="hljs-comment">//è®¾ç½® Container å®½åº¦ä¸º 300</span><br>          height: <span class="hljs-number">300</span>, <span class="hljs-comment">//è®¾ç½® Container é«˜åº¦ä¸º 300</span><br>          alignment: Alignment.center, <span class="hljs-comment">//è®¾ç½®å­ Widget å±…ä¸­</span><br>          padding: EdgeInsets.all(<span class="hljs-number">20</span>), <span class="hljs-comment">//è®¾ç½® Container å…§è¾¹è·ä¸º 20</span><br>          decoration: BoxDecoration( <span class="hljs-comment">//è®¾ç½® Container è£…é¥°</span><br>            color: Colors.blue, <span class="hljs-comment">//è®¾ç½® Container èƒŒæ™¯é¢œè‰²ä¸ºè“è‰²</span><br>            border: Border.all(<br>              color: Colors.red, <span class="hljs-comment">//è®¾ç½® Container è¾¹æ¡†é¢œè‰²ä¸ºçº¢è‰²</span><br>              width: <span class="hljs-number">2</span> <span class="hljs-comment">//è®¾ç½® Container è¾¹æ¡†çš„å®½åº¦ä¸º 2</span><br>            ),<br>            borderRadius: BorderRadius.all(Radius.circular(<span class="hljs-number">200</span>)), <span class="hljs-comment">//è®¾ç½® Container çš„å½¢çŠ¶ä¸ºä¸€ä¸ªåœ†å½¢</span><br>          ),<br>          child: Text( <span class="hljs-comment">//Container åµŒå¥—ä¸€ä¸ª Text</span><br>            <span class="hljs-string">&quot;Hello erdai str&quot;</span>, <span class="hljs-comment">// è®¾ç½® Text è¦æ˜¾ç¤ºçš„å­—ç¬¦ä¸²</span><br>            maxLines: <span class="hljs-number">1</span>, <span class="hljs-comment">//è®¾ç½® Text æœ€å¤§æ˜¾ç¤ºä¸€è¡Œ</span><br>            overflow: TextOverflow.ellipsis, <span class="hljs-comment">//è®¾ç½® Text æ–‡æœ¬è¶…è¿‡ä¸€è¡Œ ... æ˜¾ç¤º</span><br>            style: TextStyle( <span class="hljs-comment">//é…ç½® Text æ ·å¼</span><br>                fontSize: <span class="hljs-number">28</span>, <span class="hljs-comment">//è®¾ç½® Text çš„å­—ä½“å¤§å°ä¸º 28</span><br>                fontWeight: FontWeight.bold, <span class="hljs-comment">//è®¾ç½® Text æ˜¾ç¤ºä¸ºç²—ä½“</span><br>                color: Colors.white, <span class="hljs-comment">//è®¾ç½® Text æ–‡å­—é¢œè‰²ä¸ºç™½è‰²</span><br>                decoration: TextDecoration.lineThrough, <span class="hljs-comment">//è®¾ç½® Text åˆ é™¤çº¿</span><br>                decorationColor: Colors.red, <span class="hljs-comment">//è®¾ç½® Text åˆ é™¤çº¿é¢œè‰²ä¸ºçº¢è‰²</span><br>                decorationStyle: TextDecorationStyle.dashed, <span class="hljs-comment">//è®¾ç½® Text åˆ é™¤çº¿ä¸ºè™šçº¿</span><br>                wordSpacing: <span class="hljs-number">20</span>, <span class="hljs-comment">//è®¾ç½® Text å•è¯ä¹‹é—´é—´è·ä¸º 20</span><br>                letterSpacing: <span class="hljs-number">6</span>, <span class="hljs-comment">//è®¾ç½® Text å­—æ¯é—´è·ä¸º 6</span><br>                fontStyle: FontStyle.italic <span class="hljs-comment">//è®¾ç½® Text å­—ä½“æ ·å¼ä¸ºæ–œä½“</span><br>            ),<br>          ),<br>        ),<br>      ),<br>    ),<br>  ));<br>&#125;<br></code></pre></td></tr></table></figure><p>ä¸Šè¿°ä»£ç å°±å®ç°äº†æˆ‘ä»¬æƒ³è¦çš„æ•ˆæœï¼Œä½†æ˜¯æœ‰ä¸€ç‚¹ç‚¹ç‘•ç–µï¼Œé‚£å°±æ˜¯ä»£ç éƒ½å†™åœ¨ main æ–¹æ³•ä¸­ï¼Œå¯¼è‡´ main æ–¹æ³•æ¯”è¾ƒè‡ƒè‚¿ï¼Œé‚£æ˜¯å¦æœ‰åŠæ³•å¯¹ main æ–¹æ³•ä¸­çš„é€»è¾‘è¿›è¡ŒæŠ½ç¦»å‘¢ï¼Ÿ</p><p>ç­”ï¼šæœ‰çš„ï¼Œè‡ªå®šä¹‰ Widget å¯¹ main æ–¹æ³•é€»è¾‘è¿›è¡ŒæŠ½ç¦»ä¼˜åŒ–</p><h2 id="å››ã€è‡ªå®šä¹‰-Widget"><a href="#å››ã€è‡ªå®šä¹‰-Widget" class="headerlink" title="å››ã€è‡ªå®šä¹‰ Widget"></a>å››ã€è‡ªå®šä¹‰ Widget</h2><p>ä¸Šé¢è®²è¿‡ï¼Œè‡ªå®šä¹‰ Widget å…ˆè¦å¯¹ Widget çš„çŠ¶æ€è¿›è¡Œåˆ¤æ–­ï¼Œæˆ‘ä»¬è¿™é‡Œæ— éœ€ç”¨æˆ·äº¤äº’ä»¥åŠå…¶ä»–å› ç´ è¿›è¡Œæ›´æ”¹ï¼Œå› æ­¤æ˜¯æ— çŠ¶æ€çš„ï¼Œç»§æ‰¿ StatelessWidget å³å¯</p><p>æ¥ä¸‹æ¥æˆ‘ä»¬å¯¹ body éƒ¨åˆ†çš„é€»è¾‘è¿›è¡ŒæŠ½ç¦»ï¼Œå°è£…ä¸ºä¸€ä¸ªè‡ªå®šä¹‰ Widgetï¼Œå¦‚ä¸‹ï¼š</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyBodyPage</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">StatelessWidget</span></span>&#123;<br>  <span class="hljs-meta">@override</span><br>  Widget build(BuildContext context) &#123;<br>    <span class="hljs-keyword">return</span> Center(<br>      child: Container( <span class="hljs-comment">// Center åµŒå¥—ä¸€ä¸ª Container</span><br>        width: <span class="hljs-number">300</span>, <span class="hljs-comment">//è®¾ç½® Container å®½åº¦ä¸º 300</span><br>        height: <span class="hljs-number">300</span>, <span class="hljs-comment">//è®¾ç½® Container é«˜åº¦ä¸º 300</span><br>        alignment: Alignment.center, <span class="hljs-comment">//è®¾ç½®å­ Widget å±…ä¸­</span><br>        padding: EdgeInsets.all(<span class="hljs-number">20</span>), <span class="hljs-comment">//è®¾ç½® Container å…§è¾¹è·ä¸º 20</span><br>        decoration: BoxDecoration( <span class="hljs-comment">//è®¾ç½® Container è£…é¥°</span><br>          color: Colors.blue, <span class="hljs-comment">//è®¾ç½® Container èƒŒæ™¯é¢œè‰²ä¸ºè“è‰²</span><br>          border: Border.all(<br>              color: Colors.red, <span class="hljs-comment">//è®¾ç½® Container è¾¹æ¡†é¢œè‰²ä¸ºçº¢è‰²</span><br>              width: <span class="hljs-number">2</span> <span class="hljs-comment">//è®¾ç½® Container è¾¹æ¡†çš„å®½åº¦ä¸º 2</span><br>          ),<br>          borderRadius: BorderRadius.all(Radius.circular(<span class="hljs-number">200</span>)), <span class="hljs-comment">//è®¾ç½® Container çš„å½¢çŠ¶ä¸ºä¸€ä¸ªåœ†å½¢</span><br>        ),<br>        child: Text( <span class="hljs-comment">//Container åµŒå¥—ä¸€ä¸ª Text</span><br>          <span class="hljs-string">&quot;Hello erdai str&quot;</span>, <span class="hljs-comment">// è®¾ç½® Text è¦æ˜¾ç¤ºçš„å­—ç¬¦ä¸²</span><br>          maxLines: <span class="hljs-number">1</span>, <span class="hljs-comment">//è®¾ç½® Text æœ€å¤§æ˜¾ç¤ºä¸€è¡Œ</span><br>          overflow: TextOverflow.ellipsis, <span class="hljs-comment">//è®¾ç½® Text æ–‡æœ¬è¶…è¿‡ä¸€è¡Œ ... æ˜¾ç¤º</span><br>          style: TextStyle( <span class="hljs-comment">//é…ç½® Text æ ·å¼</span><br>              fontSize: <span class="hljs-number">28</span>, <span class="hljs-comment">//è®¾ç½® Text çš„å­—ä½“å¤§å°ä¸º 28</span><br>              fontWeight: FontWeight.bold, <span class="hljs-comment">//è®¾ç½® Text æ˜¾ç¤ºä¸ºç²—ä½“</span><br>              color: Colors.white, <span class="hljs-comment">//è®¾ç½® Text æ–‡å­—é¢œè‰²ä¸ºç™½è‰²</span><br>              decoration: TextDecoration.lineThrough, <span class="hljs-comment">//è®¾ç½® Text åˆ é™¤çº¿</span><br>              decorationColor: Colors.red, <span class="hljs-comment">//è®¾ç½® Text åˆ é™¤çº¿é¢œè‰²ä¸ºçº¢è‰²</span><br>              decorationStyle: TextDecorationStyle.dashed, <span class="hljs-comment">//è®¾ç½® Text åˆ é™¤çº¿ä¸ºè™šçº¿</span><br>              wordSpacing: <span class="hljs-number">20</span>, <span class="hljs-comment">//è®¾ç½® Text å•è¯ä¹‹é—´é—´è·ä¸º 20</span><br>              letterSpacing: <span class="hljs-number">6</span>, <span class="hljs-comment">//è®¾ç½® Text å­—æ¯é—´è·ä¸º 6</span><br>              fontStyle: FontStyle.italic <span class="hljs-comment">//è®¾ç½® Text å­—ä½“æ ·å¼ä¸ºæ–œä½“</span><br>          ),<br>        ),<br>      ),<br>    );<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>å®åˆ™å°±æ˜¯å°† body éƒ¨åˆ†çš„ä»£ç ç§»è¿‡æ¥ğŸ˜‚ï¼ŒæŒæ¡è‡ªå®šä¹‰ Widget çš„æ€è·¯å³å¯ï¼Œé‚£ä¹ˆ main æ–¹æ³•çš„ä»£ç å°±ç®€åŒ–äº†å¾ˆå¤šï¼Œå¦‚ä¸‹ï¼š</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;package:flutter/material.dart&#x27;</span>;<br><br><span class="hljs-keyword">void</span> main() &#123;<br>  runApp(MaterialApp(<br>    home: Scaffold(<br>      appBar: AppBar(<br>        title: Text(<span class="hljs-string">&quot;Flutter Widget Learning&quot;</span>),<span class="hljs-comment">//è®¾ç½®æ ‡é¢˜æ æ ‡é¢˜</span><br>        elevation: <span class="hljs-number">30</span>,<span class="hljs-comment">//è®¾ç½®æ ‡é¢˜æ é˜´å½±</span><br>      ),<br>      body: MyBodyPage() <span class="hljs-comment">//è‡ªå®šä¹‰ Widget</span><br>    ),<br>  ));<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="äº”ã€æ€»ç»“"><a href="#äº”ã€æ€»ç»“" class="headerlink" title="äº”ã€æ€»ç»“"></a>äº”ã€æ€»ç»“</h2><p>æœ¬æ–‡é‡ç‚¹å†…å®¹ï¼š</p><p>1ã€Flutter çš„ç‰¹ç‚¹ï¼Œäº†è§£å®ƒï¼Œèƒ½å¸®åŠ©æˆ‘ä»¬æ›´å¥½çš„å­¦ä¹  Flutter</p><p>2ã€ä»‹ç»äº†å®ç°æ•ˆæœå›¾ç”¨åˆ°çš„ Widgetï¼šMaterialAppï¼ŒScaffoldï¼ŒAppBarï¼ŒCenterï¼ŒContainerï¼ŒText</p><p>3ã€å­¦ä¹  Widget å®åˆ™å°±æ˜¯è¦é‡ç‚¹æŒæ¡å®ƒæœ‰å“ªäº›å±æ€§ï¼Œæˆ‘çš„å»ºè®®æ˜¯ï¼šæŒæ¡å¸¸ç”¨çš„ï¼Œå…¶å®ƒçš„ç”¨åˆ°æ—¶æŸ¥çœ‹æºç å³<br>å¯ã€‚å¦å¤–ä¸€ä¸ªé—®é¢˜ï¼šå½“ä½ ä¸çŸ¥é“å±æ€§æ€ä¹ˆèµ‹å€¼ï¼Œä¹Ÿå¯ä»¥é€šè¿‡æŸ¥çœ‹æºç äº†è§£å±æ€§çš„ç±»å‹ï¼Œç„¶åè¿›è¡Œç›¸åº”çš„èµ‹å€¼</p><p>4ã€ä»‹ç»äº†è‡ªå®šä¹‰å±æ€§ï¼Œæ ¹æ®çŠ¶æ€åˆ¤æ–­æ˜¯ç»§æ‰¿ StatelessWidget è¿˜æ˜¯ StatefulWidget</p><p>å¥½äº†ï¼Œæœ¬ç¯‡æ–‡ç« åˆ°è¿™é‡Œå°±ç»“æŸäº†ï¼Œå¸Œæœ›èƒ½ç»™ä½ å¸¦æ¥å¸®åŠ© ğŸ¤</p><p><strong>æ„Ÿè°¢ä½ é˜…è¯»è¿™ç¯‡æ–‡ç« </strong></p><h3 id="ä¸‹ç¯‡é¢„å‘Š"><a href="#ä¸‹ç¯‡é¢„å‘Š" class="headerlink" title="ä¸‹ç¯‡é¢„å‘Š"></a>ä¸‹ç¯‡é¢„å‘Š</h3><p>Flutter Widget æœ‰å¾ˆå¤šï¼Œä»Šå¤©æˆ‘ä»¬åªæ˜¯å­¦ä¹ äº†ç®€å•çš„å‡ ä¸ªï¼Œæ¥ä¸‹æ¥æˆ‘è¿˜ä¼šç»§ç»­å¯¹ Flutter Widget è¿›è¡Œä»‹ç»</p><h3 id="å‚è€ƒå’Œæ¨è"><a href="#å‚è€ƒå’Œæ¨è" class="headerlink" title="å‚è€ƒå’Œæ¨è"></a>å‚è€ƒå’Œæ¨è</h3><p><a href="https://www.bilibili.com/video/BV1S4411E7LY?p=19&vd_source=d0b24cb21c438ff4a9ac2e589eacb3d9">Flutter æ•™ç¨‹</a>ï¼šé€šä¿—æ˜“æ‡‚çš„ Flutter å…¥é—¨æ•™ç¨‹</p><blockquote><p><strong>ä½ çš„ç‚¹èµï¼Œè¯„è®ºï¼Œæ˜¯å¯¹æˆ‘å·¨å¤§çš„é¼“åŠ±ï¼</strong></p><p>æ¬¢è¿å…³æ³¨æˆ‘çš„<strong>å…¬ä¼—å·ï¼š</strong>  <a href="http://m6z.cn/6jwi7b"><strong>sweetying</strong></a> ï¼Œæ–‡ç« æ›´æ–°å¯ç¬¬ä¸€æ—¶é—´æ”¶åˆ°</p><p>å¦‚æœ<strong>æœ‰é—®é¢˜</strong>ï¼Œå…¬ä¼—å·å†…æœ‰åŠ æˆ‘å¾®ä¿¡çš„å…¥å£ï¼Œåœ¨æŠ€æœ¯å­¦ä¹ ã€ä¸ªäººæˆé•¿çš„é“è·¯ä¸Šï¼Œæˆ‘ä»¬ä¸€èµ·å‰è¿›ï¼</p></blockquote>]]></content>
    
    
    <categories>
      
      <category>Flutter</category>
      
    </categories>
    
    
    <tags>
      
      <tag>åŸåˆ›</tag>
      
      <tag>Flutter</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Flutter ç³»åˆ—ï¼ˆäºŒï¼‰ï¼šDart è¯­æ³•ç­‘åŸº</title>
    <link href="/2022/10/10/Flutter%20%E7%B3%BB%E5%88%97%EF%BC%88%E4%BA%8C%EF%BC%89%EF%BC%9ADart%20%E8%AF%AD%E6%B3%95%E7%AD%91%E5%9F%BA/"/>
    <url>/2022/10/10/Flutter%20%E7%B3%BB%E5%88%97%EF%BC%88%E4%BA%8C%EF%BC%89%EF%BC%9ADart%20%E8%AF%AD%E6%B3%95%E7%AD%91%E5%9F%BA/</url>
    
    <content type="html"><![CDATA[<p><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/0faab578ed4741edb81bf9b8d22b60c8~tplv-k3u1fbpfcp-watermark.image"></p><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>å¾ˆé«˜å…´é‡è§ä½ ~</p><p>åœ¨æœ¬ç³»åˆ—çš„ä¸Šä¸€ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬ä»‹ç»äº† Flutter å¼€å‘ç¯å¢ƒæ­å»ºï¼Œä»¥åŠä½¿ç”¨ AndroidStudio è¿è¡Œä½ çš„ç¬¬ä¸€ä¸ª Flutter é¡¹ç›®ï¼Œä½“éªŒäº†çƒ­é‡è½½ã€‚è¿˜æ²¡æœ‰çœ‹è¿‡ä¸Šä¸€ç¯‡æ–‡ç« çš„æœ‹å‹ï¼Œå»ºè®®å…ˆå»é˜…è¯»<a href="https://juejin.cn/post/7057420846863745031">Flutter ç³»åˆ—ï¼ˆä¸€ï¼‰ï¼šè¿è¡Œä½ çš„ç¬¬ä¸€ä¸ª Flutter åº”ç”¨</a>ï¼Œåœ¨æˆ‘çœ‹æ¥ï¼ŒDart åœ¨è®¾è®¡æ—¶åº”è¯¥æ˜¯å€Ÿé‰´äº†ç™¾å®¶è¯­è¨€ä¹‹æ‰€é•¿ğŸ˜„ï¼šJavaï¼ŒKotlinç­‰ï¼š</p><p>1ã€åœ¨é™æ€è¯­æ³•æ–¹é¢ï¼Œå¦‚ï¼šç±»å‹å®šä¹‰ï¼Œæ–¹æ³•å£°æ˜ï¼Œæ³›å‹ç­‰ï¼Œå’Œ Java éå¸¸ç›¸ä¼¼</p><p>2ã€ä¸€äº›è¯­æ³•ç‰¹æ€§ï¼Œå¦‚ï¼šå‡½æ•°å¼ç‰¹æ€§ï¼Œç©ºå®‰å…¨ï¼Œå‡½æ•°é»˜è®¤å€¼ç­‰ï¼Œå’Œ Kotlin éå¸¸ç›¸ä¼¼</p><p>3ã€Dart è¿˜æœ‰ä¸€äº›è‡ªå·±ç‹¬åˆ›çš„è¯­æ³•ï¼Œå¦‚ï¼šå‘½åæ„é€ æ–¹æ³•ï¼Œçº§è”æ“ä½œç¬¦ç­‰</p><p>æ€»ä¹‹ï¼Œç†Ÿæ‚‰ä¹‹åï¼Œä½ ä¼šå‘ç° Dart æ˜¯ä¸€é—¨éå¸¸æœ‰æ„æ€çš„ç¼–ç¨‹è¯­è¨€ï¼Œæ¥ä¸‹æ¥å°±è®©æˆ‘ä»¬ä¸€èµ·è¿›å…¥ Dart çš„è¯­æ³•å­¦ä¹ å§</p><p><strong>æ³¨æ„</strong>ï¼š Dart è¯­æ³•å’Œ Javaï¼ŒKotlin çœŸçš„å¾ˆåƒï¼Œå°¤å…¶æ˜¯ Javaã€‚å¦å¤–å¦‚æœå¯¹ Kotlin è¯­æ³•ä¸ç†Ÿçš„ï¼Œå¯ä»¥å»çœ‹æˆ‘çš„å¦å¤–ä¸€ç¯‡æ–‡ç« ï¼š<a href="https://juejin.cn/post/6942251919662383134">â€œKotlinâ€ç³»åˆ—: ä¸€ã€Kotlinå…¥é—¨</a></p><h2 id="ä¸€ã€å˜é‡å’Œæ–¹æ³•"><a href="#ä¸€ã€å˜é‡å’Œæ–¹æ³•" class="headerlink" title="ä¸€ã€å˜é‡å’Œæ–¹æ³•"></a>ä¸€ã€å˜é‡å’Œæ–¹æ³•</h2><h3 id="1-1ã€å˜é‡"><a href="#1-1ã€å˜é‡" class="headerlink" title="1.1ã€å˜é‡"></a>1.1ã€å˜é‡</h3><p>1ï¼‰ã€Dart å¯ä»¥æ˜¾ç¤ºæŒ‡æ˜ç±»å‹æ¥å£°æ˜ä¸€ä¸ªå¯å˜çš„å˜é‡ã€‚ä¸”æŒ‡æ˜çš„ç±»å‹åˆ†ä¸ºå¯ç©ºå’Œéç©º</p><p>2ï¼‰ã€Dart ä¹Ÿå¯ä»¥ä½¿ç”¨ var å…³é”®å­—æ¥å£°æ˜ä¸€ä¸ªå¯å˜çš„å˜é‡ï¼Œæ­¤æ—¶ç¼–è¯‘å™¨ä¼šæ ¹æ®å˜é‡åˆå§‹å€¼è‡ªåŠ¨æ¨æ–­ç±»å‹</p><p>3ï¼‰ã€Dart ä½¿ç”¨ final å…³é”®å­—æ¥å£°æ˜ä¸€ä¸ªä¸å¯å˜çš„å˜é‡ï¼Œä¸”å¯ä»¥æ›¿ä»£ var æˆ–åŠ åœ¨ç±»å‹å‰é¢</p><p>4ï¼‰ã€Dart ä¸­å˜é‡å¦‚æœæ˜¯éç©ºç±»å‹ï¼Œé‚£ä¹ˆå¿…é¡»ç»™ä¸€ä¸ªé»˜è®¤å€¼ï¼Œå¦åˆ™æ— æ³•ç¼–è¯‘é€šè¿‡ã€‚å¦‚æœæ˜¯å¯ç©ºç±»å‹ï¼Œé»˜è®¤å€¼éƒ½ä¸º null</p><p>5ï¼‰ã€Dart ä¸­æ¯ä¸€è¡Œä»£ç éƒ½è¦åŠ  ; ğŸ˜‚ï¼Œèµ°å›å¤´è·¯äº†ï¼Œæœ‰ç‚¹é¸¡è‚‹</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-comment">//1ã€Dart å¯ä»¥æ˜¾ç¤ºæŒ‡æ˜ç±»å‹æ¥å£°æ˜ä¸€ä¸ªå¯å˜çš„å˜é‡ã€‚ä¸”æŒ‡æ˜çš„ç±»å‹åˆ†ä¸ºå¯ç©ºå’Œéç©º</span><br><span class="hljs-comment">//1.1ã€ç±»æ¯” Javaï¼Œæ˜¾ç¤ºæŒ‡æ˜ç±»å‹æ¥å£°æ˜ä¸€ä¸ªå¯å˜çš„å˜é‡</span><br><span class="hljs-comment">//dart å†™æ³•ï¼š</span><br><span class="hljs-built_in">int</span> a = <span class="hljs-number">10</span>;<br><span class="hljs-built_in">bool</span> b = <span class="hljs-keyword">true</span>;<br><br><span class="hljs-comment">//Java å†™æ³•</span><br><span class="hljs-built_in">int</span> a = <span class="hljs-number">10</span>;<br>boolean b = <span class="hljs-keyword">true</span>;<br><br><span class="hljs-comment">//1.2ã€æŒ‡æ˜çš„ç±»å‹åˆ†ä¸ºå¯ç©ºå’Œéç©º</span><br><span class="hljs-comment">//dart å†™æ³•</span><br><span class="hljs-built_in">int?</span> a = <span class="hljs-number">10</span>;<br><span class="hljs-built_in">bool?</span> b = <span class="hljs-keyword">true</span>;<br><br><span class="hljs-comment">//kotlin å†™æ³•</span><br><span class="hljs-keyword">var</span> a: Int? = <span class="hljs-number">10</span><br><span class="hljs-keyword">var</span> b: Boolean? = <span class="hljs-keyword">true</span><br>  <br><span class="hljs-comment">//2ã€Dart ä¹Ÿå¯ä»¥ä½¿ç”¨ var å…³é”®å­—æ¥å£°æ˜ä¸€ä¸ªå¯å˜çš„å˜é‡ï¼Œæ­¤æ—¶ç¼–è¯‘å™¨ä¼šæ ¹æ®å˜é‡åˆå§‹å€¼è‡ªåŠ¨æ¨æ–­ç±»å‹</span><br><span class="hljs-comment">//dart å†™æ³•</span><br><span class="hljs-keyword">var</span> a = <span class="hljs-number">10</span>;<br><span class="hljs-keyword">var</span> b = <span class="hljs-keyword">true</span>;<br><br><span class="hljs-comment">//kotlin å†™æ³•</span><br><span class="hljs-keyword">var</span> a = <span class="hljs-number">10</span><br><span class="hljs-keyword">var</span> b = <span class="hljs-keyword">true</span><br>  <br><span class="hljs-comment">//3ã€Dart ä½¿ç”¨ final å…³é”®å­—æ¥å£°æ˜ä¸€ä¸ªä¸å¯å˜çš„å˜é‡ï¼Œä¸”å¯ä»¥æ›¿ä»£ var æˆ–åŠ åœ¨ç±»å‹å‰é¢</span><br><span class="hljs-comment">//dart å†™æ³•</span><br><span class="hljs-keyword">final</span> a = <span class="hljs-number">10</span>;<br><span class="hljs-keyword">final</span> <span class="hljs-built_in">int</span> aa = <span class="hljs-number">10</span>;<br><span class="hljs-keyword">final</span> b = <span class="hljs-keyword">true</span>;<br><span class="hljs-keyword">final</span> <span class="hljs-built_in">bool</span> bb = <span class="hljs-keyword">true</span>;<br><br><span class="hljs-comment">//Java å†™æ³•</span><br><span class="hljs-keyword">final</span> <span class="hljs-built_in">int</span> a = <span class="hljs-number">10</span>;<br><span class="hljs-keyword">final</span> boolean b = <span class="hljs-keyword">true</span>;<br><br><span class="hljs-comment">//5ã€Dart ä¸­å˜é‡å¦‚æœæ˜¯éç©ºç±»å‹ï¼Œé‚£ä¹ˆå¿…é¡»ç»™ä¸€ä¸ªé»˜è®¤å€¼ã€‚å¦‚æœæ˜¯å¯ç©ºç±»å‹ï¼Œé»˜è®¤å€¼éƒ½ä¸º null</span><br><span class="hljs-keyword">void</span> main() &#123;<br>  <span class="hljs-built_in">String</span> s = <span class="hljs-string">&quot;erdai&quot;</span>;<br>  <span class="hljs-built_in">int?</span> i;<br>  <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;<span class="hljs-subst">$s</span> <span class="hljs-subst">$i</span>&#x27;</span>); <span class="hljs-comment">//æ‰“å°ç»“æœï¼šerdai null</span><br>&#125;<br></code></pre></td></tr></table></figure><p><strong>å°å»ºè®®</strong>ï¼šå®šä¹‰å˜é‡ï¼Œä¼˜å…ˆä½¿ç”¨è‡ªåŠ¨æ¨æ–­ï¼Œæ¥è‡ª Dart å®˜æ–¹çš„å»ºè®®</p><p><strong>æ³¨æ„</strong>ï¼š Dart å®Œå…¨æŠ›å¼ƒäº† Java ä¸­çš„åŸºæœ¬æ•°æ®ç±»å‹ï¼Œå…¨éƒ¨éƒ½æ˜¯å¯¹è±¡æ•°æ®ç±»å‹</p><p>5ï¼‰ã€Dart ä¸­è¿˜å¯ä»¥ä½¿ç”¨ Object å’Œ dynamic å…³é”®å­—æ¥å£°æ˜ä¸€ä¸ªå˜é‡</p><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs abnf">//<span class="hljs-number">1</span>ã€Dart ä¸­è¿˜å¯ä»¥ä½¿ç”¨ Object å’Œ dynamic å…³é”®å­—æ¥å£°æ˜ä¸€ä¸ªå˜é‡<br>//<span class="hljs-number">1.1</span>ã€Object å£°æ˜å˜é‡ï¼Œè¿™ä¸€ç‚¹å’Œ Java æ²¡ä»»ä½•åŒºåˆ«<br>Object a <span class="hljs-operator">=</span> <span class="hljs-number">10</span><span class="hljs-comment">;</span><br>Object b <span class="hljs-operator">=</span> true<span class="hljs-comment">;</span><br>Object str <span class="hljs-operator">=</span> <span class="hljs-string">&quot;erdai666&quot;</span><span class="hljs-comment">;</span><br><br>//<span class="hljs-number">1.2</span>ã€dynamic å£°æ˜å˜é‡ï¼Œè¿™ä¸€ç‚¹æ˜¯ Java æ‰€æ²¡æœ‰çš„<br>dynamic a <span class="hljs-operator">=</span> <span class="hljs-number">10</span><span class="hljs-comment">;</span><br>dynamic b <span class="hljs-operator">=</span> true<span class="hljs-comment">;</span><br>dynamic str <span class="hljs-operator">=</span> <span class="hljs-string">&quot;erdai666&quot;</span><span class="hljs-comment">;</span><br></code></pre></td></tr></table></figure><p>æ€è€ƒä¸€ä¸ªé—®é¢˜ï¼šObject å’Œ dynamic æœ‰å•¥åŒºåˆ«å‘¢ï¼ŸğŸ¤”ï¸</p><p>ç­”ï¼šObject æ˜¯æ‰€æœ‰ç±»çš„åŸºç±»ï¼Œç›¸å½“äºä¸€ä¸ªå¯ä»¥å…¼å®¹æ‰€æœ‰ç±»å‹çš„è¶…çº§ç±»å‹ï¼Œè¿™ç‚¹å’Œ Java ç±»ä¼¼ã€‚dynamic å°±æ˜¯ä¸€ä¸ªå®šä¹‰åŠ¨æ€ç±»å‹çš„å…³é”®å­—</p><figure class="highlight processing"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs processing"><span class="hljs-comment">//1ã€å£°æ˜ä¸€ä¸ª Object ç±»å‹çš„å˜é‡è°ƒç”¨ substringï¼Œæ­¤æ—¶ä¼šç¼–è¯‘æŠ¥é”™ï¼Œå› ä¸º Object æ²¡æœ‰ substring æ–¹æ³•</span><br><span class="hljs-built_in">Object</span> <span class="hljs-built_in">str</span> = <span class="hljs-string">&quot;erdai666&quot;</span>;<br><span class="hljs-built_in">str</span>.<span class="hljs-property">substring</span>(<span class="hljs-number">1</span>); <span class="hljs-comment">//ç¼–è¯‘æŠ¥é”™ï¼šThe method &#x27;substring&#x27; isn&#x27;t defined for the type &#x27;Object&#x27;.</span><br><br><span class="hljs-comment">//2ã€ä½¿ç”¨ dynamic å®šä¹‰ä¸€ä¸ªå˜é‡è°ƒç”¨ substringï¼Œæ­¤æ—¶å¯ä»¥ç»•è¿‡ç¼–è¯‘æ£€æŸ¥</span><br>dynamic <span class="hljs-built_in">str</span> = <span class="hljs-string">&quot;erdai666&quot;</span>;<br><span class="hljs-built_in">str</span>.<span class="hljs-property">substring</span>(<span class="hljs-number">1</span>);<br></code></pre></td></tr></table></figure><p><strong>æ³¨æ„</strong>ï¼šä½¿ç”¨ dynamic å®šä¹‰çš„å˜é‡è°ƒç”¨ç›¸å…³æŒ‡å®šç±»å‹ api æ—¶ï¼Œå› ä¸ºä¼šç»•è¿‡ç¼–è¯‘å™¨æ£€æŸ¥ï¼Œæ‰€ä»¥åˆ«å†™é”™äº†ï¼Œå¦åˆ™è¿è¡Œæ—¶å°±ä¼šæŠ¥æ‰¾ä¸åˆ°æ­¤ apiï¼Œå¦‚ä¸‹ï¼š</p><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/56018a16767142e28c710727a2e9fa39~tplv-k3u1fbpfcp-zoom-1.image" alt="img"></p><p>å¯ä»¥çœ‹åˆ°ï¼Œç¼–è¯‘å™¨æç¤ºï¼š String ç±»æ²¡æœ‰ subString æ–¹æ³•ã€‚å°±æ˜¯å› ä¸ºæˆ‘ä»¬ api å†™é”™äº†ï¼Œå°† substring å†™æˆäº† subString å¯¼è‡´çš„</p><h3 id="1-2ã€å¸¸é‡"><a href="#1-2ã€å¸¸é‡" class="headerlink" title="1.2ã€å¸¸é‡"></a>1.2ã€å¸¸é‡</h3><p>1ï¼‰ã€Dart ä½¿ç”¨ const å…³é”®å­—æ¥å®šä¹‰ä¸€ä¸ªå¸¸é‡</p><p>2ï¼‰ã€Dart å¯ä»¥ä½¿ç”¨ const å…³é”®å­—æ›¿ä»£ var æˆ–åŠ åœ¨ç±»å‹å‰é¢</p><p>3ï¼‰ã€Dart è¿˜å¯ä»¥ä½¿ç”¨ const å…³é”®å­—æ¥åˆ›å»ºä¸€ä¸ªå¸¸é‡</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs csharp"><span class="hljs-comment">//1ã€Dart ä½¿ç”¨ const å…³é”®å­—æ¥å®šä¹‰ä¸€ä¸ªå¸¸é‡</span><br><span class="hljs-comment">//2ã€Dart å¯ä»¥ä½¿ç”¨ const å…³é”®å­—æ›¿ä»£ var æˆ–åŠ åœ¨ç±»å‹å‰é¢</span><br><span class="hljs-keyword">const</span> a = <span class="hljs-number">10</span>;<br><span class="hljs-keyword">const</span> b = <span class="hljs-literal">true</span>;<br><span class="hljs-keyword">const</span> <span class="hljs-built_in">int</span> aa = <span class="hljs-number">10</span>;<br><span class="hljs-keyword">const</span> <span class="hljs-built_in">bool</span> bb = <span class="hljs-literal">true</span>;<br><br><span class="hljs-comment">//3ã€Dart è¿˜å¯ä»¥ä½¿ç”¨ const å…³é”®å­—æ¥åˆ›å»ºä¸€ä¸ªå¸¸é‡</span><br><span class="hljs-comment">//åˆ›å»ºä¸€ä¸ªå†…å®¹å’Œå¼•ç”¨éƒ½ä¸å¯å˜çš„ list æ•°ç»„</span><br><span class="hljs-keyword">var</span> list = <span class="hljs-keyword">const</span> [<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>];<br><span class="hljs-comment">//åˆ›å»ºä¸€ä¸ªå†…å®¹å’Œå¼•ç”¨éƒ½ä¸å¯å˜çš„ set é›†åˆ</span><br><span class="hljs-keyword">var</span> <span class="hljs-keyword">set</span> = <span class="hljs-keyword">const</span> &#123;<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>&#125;;<br></code></pre></td></tr></table></figure><p>è¿™é‡Œæˆ‘æœ‰ä¸€ä¸ªç–‘é—®ï¼šé‚£ const å’Œ final æœ‰å•¥å¼‚åŒå‘¢ï¼Ÿ</p><p>ç­”ï¼š</p><p>å¼‚ï¼š</p><p>1ã€final å¯ä»¥ä¸€å¼€å§‹ä¸èµ‹å€¼ï¼Œå¦‚æœèµ‹å€¼äº†åˆ™ä¸å¯å˜ã€‚const ä¸€å¼€å§‹å°±éœ€è¦èµ‹å€¼ä¸”ä¸å¯å˜</p><p>2ã€const å¿…é¡»ç»™ä¸€ä¸ªæ˜ç¡®çš„ç¼–è¯‘å¸¸é‡å€¼ï¼ˆå³ç¼–è¯‘æœŸé—´å°±ç¡®å®šçš„å€¼ï¼‰</p><p>3ã€final å¯ä»¥é€šè¿‡è®¡ç®—æˆ–è€…æ–¹æ³•è·å–ä¸€ä¸ªå€¼ï¼ˆå³è¿è¡ŒæœŸé—´ç¡®å®šçš„å€¼ï¼‰</p><p>4ã€final è¡¨ç¤ºå¼•ç”¨ä¸å¯å˜ï¼Œä½†å†…å®¹æ˜¯å¯å˜çš„ã€‚const è¡¨ç¤ºå†…å®¹å’Œå¼•ç”¨éƒ½ä¸å¯å˜</p><p>åŒï¼š</p><p>1ã€finalï¼Œconst å…³é”®å­—éƒ½å¯ä»¥ç”¨æ¥å®šä¹‰ä¸€ä¸ªå¸¸é‡</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-regexp">//</span><span class="hljs-number">1</span>ã€final å¯ä»¥ä¸€å¼€å§‹ä¸èµ‹å€¼ï¼Œå¦‚æœèµ‹å€¼äº†åˆ™ä¸å¯å˜ã€‚const ä¸€å¼€å§‹å°±éœ€è¦èµ‹å€¼ä¸”ä¸å¯å˜<br><span class="hljs-regexp">//</span><span class="hljs-number">2</span>ã€const å¿…é¡»ç»™ä¸€ä¸ªæ˜ç¡®çš„ç¼–è¯‘å¸¸é‡å€¼ï¼ˆå³ç¼–è¯‘æœŸé—´å°±ç¡®å®šçš„å€¼ï¼‰<br><span class="hljs-regexp">//</span><span class="hljs-number">3</span>ã€final å¯ä»¥é€šè¿‡è®¡ç®—/æ–¹æ³•è·å–ä¸€ä¸ªå€¼ï¼ˆå³è¿è¡ŒæœŸé—´ç¡®å®šçš„å€¼ï¼‰<br><br>final a;<span class="hljs-regexp">//</span>ç¼–è¯‘é€šè¿‡<br>a = <span class="hljs-number">10</span>;<span class="hljs-regexp">//</span>ç¼–è¯‘é€šè¿‡<br><br>const b;<span class="hljs-regexp">//</span>ç¼–è¯‘æŠ¥é”™<br>b = <span class="hljs-number">10</span>;<span class="hljs-regexp">//</span>ç¼–è¯‘æŠ¥é”™<br><br><span class="hljs-regexp">//</span><span class="hljs-number">4</span>ã€final è¡¨ç¤ºå¼•ç”¨ä¸å¯å˜ï¼Œä½†å†…å®¹æ˜¯å¯å˜çš„ã€‚const è¡¨ç¤ºå†…å®¹å’Œå¼•ç”¨éƒ½ä¸å¯å˜<br>final set = &#123;<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>&#125;;<br>set.add(<span class="hljs-number">4</span>);<br><br>var list = const [<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>];<br>list.add(<span class="hljs-number">4</span>);<span class="hljs-regexp">//</span>è¿è¡ŒæŠ¥é”™ï¼Œconst list ä¸å¯æ–°å¢å…ƒç´ <br></code></pre></td></tr></table></figure><h3 id="1-3ã€æ–¹æ³•"><a href="#1-3ã€æ–¹æ³•" class="headerlink" title="1.3ã€æ–¹æ³•"></a>1.3ã€æ–¹æ³•</h3><h4 id="1-3-1ã€æ–¹æ³•å®šä¹‰"><a href="#1-3-1ã€æ–¹æ³•å®šä¹‰" class="headerlink" title="1.3.1ã€æ–¹æ³•å®šä¹‰"></a>1.3.1ã€æ–¹æ³•å®šä¹‰</h4><p>1ï¼‰ã€æ–¹æ³•å’Œå‡½æ•°æ˜¯åŒä¸€ä¸ªæ¦‚å¿µï¼Œåœ¨ Java ä¸­æˆ‘ä»¬ä¹ æƒ¯å«æ–¹æ³• (method)ã€‚åœ¨ Kotlin ä¸­æˆ‘ä»¬ä¹ æƒ¯å«å‡½æ•° (function)ã€‚å›  Dart æ›´åƒ Java ï¼Œå› æ­¤è¿™é‡Œå»ºè®®å¤§å®¶ä¹Ÿå«æ–¹æ³• (method)</p><p>2ï¼‰ã€æ–¹æ³•æ˜¯è¿è¡Œä»£ç çš„è½½ä½“ï¼Œåƒæˆ‘ä»¬ä½¿ç”¨è¿‡çš„ main æ–¹æ³•å°±æ˜¯ä¸€ä¸ªæ–¹æ³•</p><p>Dart ä¸­å®šä¹‰æ–¹æ³•çš„è¯­æ³•è§„åˆ™ï¼š</p><blockquote><p>è¿”å›å‚æ•°ç±»å‹ æ–¹æ³•å(å‚æ•°1,å‚æ•°2,å‚æ•°3â€¦) {</p><p>æ–¹æ³•ä½“</p><p>}</p></blockquote><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs reasonml"><span class="hljs-comment">//1ã€Dart å†™æ³•1ï¼šæ–¹æ³•çš„å‚æ•°ä½¿ç”¨ï¼švar å‚æ•°å</span><br>String <span class="hljs-keyword">method</span><span class="hljs-constructor">Name(<span class="hljs-params">var</span> <span class="hljs-params">name</span>,<span class="hljs-params">var</span> <span class="hljs-params">age</span>)</span>&#123;<br>  return <span class="hljs-string">&quot;erdai666&quot;</span>;<br>&#125;<br><br><span class="hljs-comment">//2ã€Dart å†™æ³•2ï¼šæ–¹æ³•çš„å‚æ•°ä½¿ç”¨ï¼šç±»å‹ å‚æ•°å</span><br>String <span class="hljs-keyword">method</span><span class="hljs-constructor">Name(String <span class="hljs-params">name</span>,<span class="hljs-params">int</span> <span class="hljs-params">age</span>)</span>&#123;<br>  return <span class="hljs-string">&quot;erdai666&quot;</span>;<br>&#125;<br><br><span class="hljs-comment">//3ã€Dart å†™æ³•3ï¼šæ–¹æ³•çš„è¿”å›ç±»å‹å¯çœç•¥ï¼Œæ ¹æ®æ–¹æ³•ä½“æœ€åä¸€è¡Œä»£ç è¿›è¡Œè¿”å›ç±»å‹æ¨æ–­</span><br><span class="hljs-keyword">method</span><span class="hljs-constructor">Name(<span class="hljs-params">var</span> <span class="hljs-params">name</span>,<span class="hljs-params">var</span> <span class="hljs-params">age</span>)</span>&#123;<br>  return <span class="hljs-string">&quot;erdai666&quot;</span>;<br>&#125;<br><br><span class="hljs-comment">//4ã€å¦‚æœæ²¡æœ‰å†™è¿”å›ç±»å‹ï¼Œä¸”æ–¹æ³•ä½“æœ€åä¸€è¡Œä»£ç æ²¡æœ‰æ˜ç¡®å†™è¿”å›è¯­å¥ï¼Œé‚£ä¹ˆé»˜è®¤æ‰§è¡Œï¼šreturn null</span><br><span class="hljs-keyword">method</span><span class="hljs-constructor">Name(<span class="hljs-params">var</span> <span class="hljs-params">name</span>,<span class="hljs-params">var</span> <span class="hljs-params">age</span>)</span>&#123;<br>  <br>&#125;<br><br><span class="hljs-comment">//5ã€Dart å†™æ³•4ï¼šæ— è¿”å›å€¼ä½¿ç”¨ void å…³é”®å­—</span><br>void <span class="hljs-keyword">method</span><span class="hljs-constructor">Name(<span class="hljs-params">var</span> <span class="hljs-params">name</span>,<span class="hljs-params">var</span> <span class="hljs-params">age</span>)</span>&#123;<br>  <br>&#125;<br><br><span class="hljs-comment">//6ã€Dart å†™æ³•5ï¼šå¦‚æœæ–¹æ³•ä½“åªæœ‰ä¸€è¡Œè¡¨è¾¾å¼ï¼Œå¯å°†å…¶æ”¹æˆå•è¡Œæ–¹æ³•æ ·å¼ï¼Œæ–¹æ³•åå’Œæ–¹æ³•ä½“ç”¨ =&gt; è¿æ¥</span><br>String <span class="hljs-keyword">method</span><span class="hljs-constructor">Name(<span class="hljs-params">var</span> <span class="hljs-params">name</span>,<span class="hljs-params">var</span> <span class="hljs-params">age</span>)</span> =&gt; <span class="hljs-string">&quot;erdai666&quot;</span>;<br></code></pre></td></tr></table></figure><p>æ–¹æ³•è¯­æ³•è§£é‡Šï¼š</p><ul><li><p>æ‰€æœ‰æ–¹æ³•éƒ½æœ‰è¿”å›å€¼ï¼Œå³ä½¿è¿”å›å€¼æ˜¯ void</p></li><li><p>æ–¹æ³•çš„è¿”å›ç±»å‹ï¼Œå¯å†™å¯ä¸å†™ã€‚å¦‚æœä¸å†™ï¼Œä¼šæ ¹æ®æ–¹æ³•ä½“é‡Œé¢æœ€åä¸€è¡Œä»£ç è¿›è¡Œç±»å‹æ¨æ–­</p></li><li><p>å¦‚æœæ²¡æœ‰å†™è¿”å›ç±»å‹ï¼Œä¸”æ–¹æ³•ä½“æœ€åä¸€è¡Œä»£ç æ²¡æœ‰æ˜ç¡®å†™è¿”å›è¯­å¥ï¼Œé‚£ä¹ˆé»˜è®¤æ‰§è¡Œï¼šreturn null</p></li><li><p>æ–¹æ³•åç§°å¯ä»¥éšä¾¿å–ï¼Œå°±åƒ Java ï¼ŒKotlin é‡Œé¢å®šä¹‰æ–¹æ³•åä¸€æ ·</p></li><li><p>æ–¹æ³•åé‡Œé¢çš„å‚æ•°å¯ä»¥æœ‰ä»»æ„å¤šä¸ªï¼Œå‚æ•°çš„å£°æ˜æ ¼å¼æœ‰ä¸¤ç§ï¼š</p><blockquote><p>1ã€var å‚æ•°å</p><p>2ã€ç±»å‹ å‚æ•°å</p></blockquote></li></ul><!----><ul><li>å¦‚æœæ–¹æ³•ä½“åªæœ‰ä¸€è¡Œè¡¨è¾¾å¼ï¼Œå¯å°†å…¶æ”¹æˆå•è¡Œæ–¹æ³•æ ·å¼ï¼Œæ–¹æ³•åå’Œæ–¹æ³•ä½“ç”¨ &#x3D;&gt; è¿æ¥</li></ul><p><strong>å°å»ºè®®</strong>ï¼šå®šä¹‰ä¸€ä¸ªæ–¹æ³•æ—¶ï¼Œå»ºè®®æŠŠè¿”å›ç±»å‹ç»™å†™å‡ºæ¥ï¼Œå¯è¯»æ€§å¼º</p><h4 id="1-3-2ã€å¯é€‰å‚æ•°-amp-å‘½åå‚æ•°-amp-é»˜è®¤å‚æ•°"><a href="#1-3-2ã€å¯é€‰å‚æ•°-amp-å‘½åå‚æ•°-amp-é»˜è®¤å‚æ•°" class="headerlink" title="1.3.2ã€å¯é€‰å‚æ•° &amp; å‘½åå‚æ•° &amp; é»˜è®¤å‚æ•°"></a>1.3.2ã€å¯é€‰å‚æ•° &amp; å‘½åå‚æ•° &amp; é»˜è®¤å‚æ•°</h4><h5 id="å¯é€‰å‚æ•°"><a href="#å¯é€‰å‚æ•°" class="headerlink" title="å¯é€‰å‚æ•°"></a>å¯é€‰å‚æ•°</h5><p>1ï¼‰ã€å¯é€‰å‚æ•°é¡¾åæ€ä¹‰å°±æ˜¯å¯ä»¥é€‰æ‹©çš„å‚æ•°ï¼Œä½¿ç”¨ [] è¡¨ç¤ºå¯é€‰çš„ä½ç½®å‚æ•°ï¼Œå¦‚ä¸‹ï¼š</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-keyword">void</span> optionFunction(<span class="hljs-keyword">var</span> value1,[<span class="hljs-keyword">var</span> value2 = <span class="hljs-number">2</span>,<span class="hljs-keyword">var</span> value3 = <span class="hljs-number">3</span>])&#123;<br>  <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;<span class="hljs-subst">$value1</span> <span class="hljs-subst">$value2</span> <span class="hljs-subst">$value3</span>&#x27;</span>);<br>&#125;<br><br><span class="hljs-keyword">void</span> main()&#123;<br>  optionFunction(<span class="hljs-number">1</span>);<br>&#125;<br><br><span class="hljs-comment">//æ‰“å°ç»“æœ</span><br><span class="hljs-number">1</span> <span class="hljs-number">2</span> <span class="hljs-number">3</span><br></code></pre></td></tr></table></figure><p>ç–‘é—®ï¼šå¦‚æœæˆ‘åªæƒ³ç»™ value1 å’Œ value3 ä¼ å‚ï¼šå¯ä»¥åšåˆ°å—ï¼Ÿ</p><p>ç­”ï¼šä¸èƒ½ã€‚å¦‚æœæƒ³åšåˆ°ï¼Œå°±éœ€è¦ä½¿ç”¨å‘½åå‚æ•°</p><h5 id="å‘½åå‚æ•°"><a href="#å‘½åå‚æ•°" class="headerlink" title="å‘½åå‚æ•°"></a>å‘½åå‚æ•°</h5><p>1ï¼‰ã€å‘½åå‚æ•°é»˜è®¤éƒ½ä¸ºå¯é€‰å‚æ•°ã€‚å¦‚æœæ˜¯å¿…è¦å‚æ•°ï¼Œåˆ™éœ€è¦ç”¨ required å…³é”®å­—ï¼Œä¸”ä½¿ç”¨ required ä¿®é¥°çš„å‚æ•°ä¸èƒ½æä¾›é»˜è®¤å€¼</p><p>2ï¼‰ã€ä½¿ç”¨ {} æ¥æŒ‡å®šå‘½åå‚æ•°</p><p>3ï¼‰ã€å‘½åå‚æ•°å¿…é¡»ä»¥ key: value çš„å½¢å¼å»æŒ‡å®š</p><p>å¦‚ä¸‹ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">//1ã€ä½¿ç”¨ &#123;&#125; æ¥æŒ‡å®šå‘½åå‚æ•°</span><br><span class="hljs-keyword">void</span> <span class="hljs-title function_">optionFunction</span>(<span class="hljs-params"><span class="hljs-keyword">var</span> value1,&#123;<span class="hljs-keyword">var</span> value2 = <span class="hljs-number">2</span>,<span class="hljs-keyword">var</span> value3 = <span class="hljs-number">3</span>&#125;</span>)&#123;<br>  <span class="hljs-title function_">print</span>(<span class="hljs-string">&#x27;$value1 $value2 $value3&#x27;</span>);<br>&#125;<br><br><span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span>(<span class="hljs-params"></span>)&#123;<br>  <span class="hljs-title function_">optionFunction</span>(<span class="hljs-number">1</span>,<span class="hljs-attr">value3</span>: <span class="hljs-number">4</span>);<br>&#125;<br><span class="hljs-comment">//æ‰“å°ç»“æœ</span><br><span class="hljs-number">1</span> <span class="hljs-number">2</span> <span class="hljs-number">4</span><br><br> <br><span class="hljs-comment">//2ã€å¦‚æœæ˜¯å¿…è¦å‚æ•°ï¼Œåˆ™éœ€è¦ç”¨ required å…³é”®å­—ï¼Œä¸”ä½¿ç”¨ required ä¿®é¥°çš„å‚æ•°ä¸èƒ½æä¾›é»˜è®¤å€¼</span><br><span class="hljs-comment">//æ­¤æ—¶ value2 ä¸ºå¿…ä¼ çš„å‚æ•°</span><br><span class="hljs-keyword">void</span> <span class="hljs-title function_">optionFunction</span>(<span class="hljs-params"><span class="hljs-keyword">var</span> value1,&#123;required <span class="hljs-keyword">var</span> value2,<span class="hljs-keyword">var</span> value3 = <span class="hljs-number">3</span>&#125;</span>)&#123;<br>  <span class="hljs-title function_">print</span>(<span class="hljs-string">&#x27;$value1 $value2 $value3&#x27;</span>);<br>&#125;  <br><br><span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span>(<span class="hljs-params"></span>)&#123;<br>  <span class="hljs-title function_">optionFunction</span>(<span class="hljs-number">1</span>,<span class="hljs-attr">value2</span>: <span class="hljs-number">4</span>);<br>&#125;<br><span class="hljs-comment">//æ‰“å°ç»“æœ</span><br><span class="hljs-number">1</span> <span class="hljs-number">4</span> <span class="hljs-number">3</span><br></code></pre></td></tr></table></figure><h5 id="é»˜è®¤å‚æ•°"><a href="#é»˜è®¤å‚æ•°" class="headerlink" title="é»˜è®¤å‚æ•°"></a>é»˜è®¤å‚æ•°</h5><p>å¦‚ä¸Šæˆ‘ä»¬åˆšæ‰ç»™å¯é€‰å‚æ•°å’Œå‘½åå‚æ•°æä¾›çš„é»˜è®¤å€¼</p><p>1ï¼‰ã€é»˜è®¤å‚æ•°å°±æ˜¯ç»™å¯é€‰å‚æ•°æä¾›é»˜è®¤å€¼ï¼Œä»¥ä¾¿åœ¨æœªæä¾›ç›¸åº”å®å‚æ—¶ä½¿ç”¨</p><p>2ï¼‰ã€é»˜è®¤å€¼å¿…é¡»æ˜¯ç¼–è¯‘æ—¶å¸¸é‡</p><p>3ï¼‰ã€å¦‚æœå¯é€‰å‚æ•°æ²¡æœ‰æä¾›é»˜è®¤å€¼ï¼Œé‚£é»˜è®¤å€¼å°±ä¸º null</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">//1ã€å¦‚æœå¯é€‰å‚æ•°æ²¡æœ‰æä¾›é»˜è®¤å€¼ï¼Œé‚£é»˜è®¤å€¼å°±ä¸º null</span><br><span class="hljs-keyword">void</span> <span class="hljs-title function_">optionFunction</span>(<span class="hljs-params"><span class="hljs-keyword">var</span> value1,&#123;<span class="hljs-keyword">var</span> value2 = <span class="hljs-number">2</span>,<span class="hljs-keyword">var</span> value3&#125;</span>)&#123;<br>  <span class="hljs-title function_">print</span>(<span class="hljs-string">&#x27;$value1 $value2 $value3&#x27;</span>);<br>&#125;<br> <br><span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span>(<span class="hljs-params"></span>)&#123;<br>  <span class="hljs-title function_">optionFunction</span>(<span class="hljs-number">1</span>);<br>&#125;<br><span class="hljs-comment">//æ‰“å°ç»“æœ</span><br><span class="hljs-number">1</span> <span class="hljs-number">2</span> <span class="hljs-literal">null</span><br></code></pre></td></tr></table></figure><h4 id="1-3-3ã€åŒ¿åæ–¹æ³•ï¼ˆåˆç§°é—­åŒ…ï¼‰"><a href="#1-3-3ã€åŒ¿åæ–¹æ³•ï¼ˆåˆç§°é—­åŒ…ï¼‰" class="headerlink" title="1.3.3ã€åŒ¿åæ–¹æ³•ï¼ˆåˆç§°é—­åŒ…ï¼‰"></a>1.3.3ã€åŒ¿åæ–¹æ³•ï¼ˆåˆç§°é—­åŒ…ï¼‰</h4><p>1ï¼‰ã€åŒ¿åæ–¹æ³•é¡¾åæ€ä¹‰å°±æ˜¯æ²¡æœ‰åå­—çš„æ–¹æ³•ï¼Œè¯­æ³•è§„åˆ™å¦‚ä¸‹ï¼š</p><figure class="highlight gcode"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs gcode"><span class="hljs-comment">//1ã€æ–¹å¼ä¸€ï¼š</span><br><span class="hljs-comment">(var å‚æ•°å)</span>&#123;<br>   æ–¹æ³•ä½“<br>&#125;<br><br><span class="hljs-comment">//2ã€æ–¹å¼äºŒï¼š</span><br><span class="hljs-comment">(ç±»å‹ å‚æ•°å)</span>&#123;<br>   æ–¹æ³•ä½“<br>&#125;<br><br><span class="hljs-comment">//3ã€æ–¹å¼ä¸‰ï¼šå¦‚æœæ–¹æ³•ä½“åªæœ‰ä¸€è¡Œä»£ç å¯ä»¥å°†åŒ¿åæ–¹æ³•ç”¨å•è¡Œè¡¨ç¤º</span><br><span class="hljs-comment">(var å‚æ•°å)</span> =&gt; æ–¹æ³•ä½“<br><span class="hljs-comment">(ç±»å‹ å‚æ•°å)</span> =&gt; æ–¹æ³•ä½“<br>  <br><span class="hljs-comment">//4ã€æ–¹å¼å››ï¼šçœç•¥ var æˆ–ç±»å‹</span><br><span class="hljs-comment">(å‚æ•°å)</span>&#123;<br>   æ–¹æ³•ä½“<br>&#125;<br><br><span class="hljs-comment">(å‚æ•°å)</span> =&gt; æ–¹æ³•ä½“<br></code></pre></td></tr></table></figure><p>2ï¼‰ã€åŒ¿åæ–¹æ³•ä¸€èˆ¬ä¼šå½“åšå‚æ•°æˆ–èµ‹å€¼ç»™ä¸€ä¸ªå˜é‡</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">//1ã€åŒ¿åæ–¹æ³•å½“ä½œå‚æ•°ä½¿ç”¨</span><br><span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span>(<span class="hljs-params"></span>)&#123;<br>  <span class="hljs-keyword">const</span> list = [<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>];<br>  list.<span class="hljs-title function_">forEach</span>((element)&#123;<br>    <span class="hljs-title function_">print</span>(element);<br>  &#125;);<br>  <span class="hljs-comment">//å¯ç®€åŒ–æˆå¦‚ä¸‹å†™æ³•ï¼š</span><br>  <span class="hljs-comment">//list.forEach((element) =&gt; print(element));</span><br>&#125;<br><br><span class="hljs-comment">//2ã€åŒ¿åæ–¹æ³•èµ‹å€¼ç»™ä¸€ä¸ªå˜é‡</span><br><span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span>(<span class="hljs-params"></span>)&#123;<br>  <span class="hljs-keyword">const</span> list = [<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>];<br>  <span class="hljs-keyword">var</span> <span class="hljs-keyword">function</span> = (element)&#123;<br>    <span class="hljs-title function_">print</span>(element);<br>  &#125;;<br>  <span class="hljs-comment">//å¯ç®€åŒ–æˆå¦‚ä¸‹å†™æ³•ï¼š</span><br>  <span class="hljs-comment">//var function = (element) =&gt;  print(element);</span><br>  list.<span class="hljs-title function_">forEach</span>(<span class="hljs-keyword">function</span>);<br>&#125;<br></code></pre></td></tr></table></figure><p>3ï¼‰ã€åŒ¿åæ–¹æ³•ç«‹å³æ‰§è¡Œ</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs csharp"><span class="hljs-comment">//1ã€æ–¹å¼1</span><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">main</span>()</span>&#123;<br>  <span class="hljs-keyword">var</span> func = ()&#123;<br>    print(<span class="hljs-string">&#x27;666&#x27;</span>);<br>  &#125;;<br>  (func)();<br>&#125;<br><br><span class="hljs-comment">//2ã€æ–¹å¼2</span><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">main</span>()</span>&#123;<br>  (()&#123;<br>    print(<span class="hljs-string">&#x27;666&#x27;</span>);<br>  &#125;)();<br>&#125;<br><br><span class="hljs-comment">//æ‰“å°ç»“æœ</span><br><span class="hljs-number">666</span><br></code></pre></td></tr></table></figure><p>4ï¼‰ã€åŒ¿åæ–¹æ³•å†…éƒ¨å¯ä»¥å¼•ç”¨åŒ…å«è¯¥åŒ¿åæ–¹æ³•çš„æ‰€æœ‰å±‚çº§ä½œç”¨åŸŸä¸­çš„å˜é‡ï¼Œä¸åŒ¿åæ–¹æ³•è°ƒç”¨çš„ä½ç½®æ— å…³ï¼Œå¦‚ä¸‹ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">//makeAdder è¿”å›ä¸€ä¸ªåŒ¿åæ–¹æ³•</span><br><span class="hljs-title class_">Function</span> <span class="hljs-title function_">makeAdder</span>(<span class="hljs-params">num addBy</span>)&#123;<br>  <span class="hljs-comment">//åŒ¿åæ–¹æ³•è®¿é—® addBy å‚æ•°</span><br>  <span class="hljs-keyword">return</span> <span class="hljs-function">(<span class="hljs-params">num i</span>) =&gt;</span> addBy + i;<br>&#125;<br><br><span class="hljs-keyword">void</span>  <span class="hljs-title function_">main</span>(<span class="hljs-params"></span>)&#123;<br>  <span class="hljs-comment">//åˆ›å»ºä¸€ä¸ªåŒ¿åæ–¹æ³•ï¼Œä¼ å…¥å®å‚ä¸º 2</span><br>  <span class="hljs-keyword">var</span> add1 = <span class="hljs-title function_">makeAdder</span>(<span class="hljs-number">2</span>);<br>  <span class="hljs-comment">//åˆ›å»ºä¸€ä¸ªåŒ¿åæ–¹æ³•ï¼Œä¼ å…¥å®å‚ä¸º 3</span><br>  <span class="hljs-keyword">var</span> add2 = <span class="hljs-title function_">makeAdder</span>(<span class="hljs-number">3</span>);<br><br>  <span class="hljs-comment">//åˆ†åˆ«è°ƒç”¨ä¸¤ä¸ªåŒ¿åæ–¹æ³•ï¼Œå¹¶æ‰“å°ç»“æœ</span><br>  <span class="hljs-title function_">print</span>(<span class="hljs-title function_">add1</span>(<span class="hljs-number">3</span>));<br>  <span class="hljs-title function_">print</span>(<span class="hljs-title function_">add2</span>(<span class="hljs-number">4</span>));<br>&#125;<br><br><span class="hljs-comment">//æ‰“å°ç»“æœ</span><br><span class="hljs-number">5</span><br><span class="hljs-number">7</span><br></code></pre></td></tr></table></figure><p><strong>æ³¨æ„</strong>ï¼šDart ä¸­çš„æ–¹æ³•ä¹Ÿæ˜¯ä¸€ç§ç±»å‹ï¼Œå¯¹åº” Function ç±»ï¼Œæ‰€ä»¥æ–¹æ³•å¯ä»¥è¢«èµ‹å€¼ç»™å˜é‡æˆ–ä½œä¸ºå‚æ•°ä¼ å…¥å¦ä¸€ä¸ªæ–¹æ³•</p><h4 id="1-3-4ã€é™æ€æ–¹æ³•"><a href="#1-3-4ã€é™æ€æ–¹æ³•" class="headerlink" title="1.3.4ã€é™æ€æ–¹æ³•"></a>1.3.4ã€é™æ€æ–¹æ³•</h4><p>1ï¼‰ã€ä½¿ç”¨ static å…³é”®å­—ä¿®é¥°çš„æ–¹æ³•å³ä¸ºé™æ€æ–¹æ³•ï¼Œå› é™æ€æ–¹æ³•ä¸å±äºç±»å®ä¾‹ï¼Œæ‰€ä»¥ä¹Ÿæ— æ³•è®¿é—®ç±»æˆå‘˜</p><p>2ï¼‰ã€é™æ€æ–¹æ³•å¯ä»¥ä½¿ç”¨ç±»åç›´æ¥è°ƒç”¨</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Test</span>&#123;<br>  <span class="hljs-keyword">static</span> <span class="hljs-title class_">String</span> <span class="hljs-title function_">staticFunction1</span>(<span class="hljs-params"></span>)&#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;&quot;</span>;<br>  &#125;<br><br>  <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">staticFunction2</span>(<span class="hljs-params"></span>)&#123;<br> <br>  &#125;<br>&#125;<br><br><span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span>(<span class="hljs-params"></span>)&#123;<br>  <span class="hljs-title class_">Test</span>.<span class="hljs-title function_">staticFunction1</span>();<br>  <span class="hljs-title class_">Test</span>.<span class="hljs-title function_">staticFunction2</span>();<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="äºŒã€åŸºæœ¬ç±»å‹å’Œè¿ç®—ç¬¦"><a href="#äºŒã€åŸºæœ¬ç±»å‹å’Œè¿ç®—ç¬¦" class="headerlink" title="äºŒã€åŸºæœ¬ç±»å‹å’Œè¿ç®—ç¬¦"></a>äºŒã€åŸºæœ¬ç±»å‹å’Œè¿ç®—ç¬¦</h2><h3 id="2-1ã€åŸºæœ¬ç±»å‹"><a href="#2-1ã€åŸºæœ¬ç±»å‹" class="headerlink" title="2.1ã€åŸºæœ¬ç±»å‹"></a>2.1ã€åŸºæœ¬ç±»å‹</h3><p>å‰é¢æåˆ°è¿‡ï¼šDart å®Œå…¨æŠ›å¼ƒäº† Java ä¸­çš„åŸºæœ¬æ•°æ®ç±»å‹ï¼Œå…¨éƒ¨éƒ½æ˜¯å¯¹è±¡æ•°æ®ç±»å‹ã€‚å› æ­¤æˆ‘ä»¬è¿™é‡Œè®²çš„åŸºæœ¬ç±»å‹ï¼Œä¹Ÿæ˜¯å¯¹è±¡æ•°æ®ç±»å‹ï¼Œåªä¸è¿‡æ˜¯ Dart é»˜è®¤ç»™æˆ‘ä»¬æä¾›çš„</p><h4 id="2-1-1ã€æ•°å­—ç±»å‹"><a href="#2-1-1ã€æ•°å­—ç±»å‹" class="headerlink" title="2.1.1ã€æ•°å­—ç±»å‹"></a>2.1.1ã€æ•°å­—ç±»å‹</h4><p>1ï¼‰ã€åœ¨dartè¯­è¨€ä¸­æ•°å­—ç±»å‹ä¸»è¦æœ‰ä¸‹é¢ä¸‰ç§ï¼š</p><blockquote><p>intï¼šæ•´æ•°ç±»å‹</p><p>doubleï¼šæµ®ç‚¹æ•°ç±»å‹</p><p>numï¼šæ•°å­—ç±»å‹ï¼Œintå’Œdoubleéƒ½æ˜¯å®ƒçš„å­ç±»</p></blockquote><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs abnf">var x <span class="hljs-operator">=</span> <span class="hljs-number">1</span><span class="hljs-comment">;   // åˆå§‹åŒ–ä¸º int ç±»å‹</span><br>var y <span class="hljs-operator">=</span> <span class="hljs-number">1.1</span><span class="hljs-comment">;  // åŒ…å«å°æ•°ï¼Œåˆå§‹åŒ–ä¸º double</span><br><br>// æ˜ç¡®æŒ‡å®šæ•°æ®ç±»å‹<br>double z <span class="hljs-operator">=</span> <span class="hljs-number">1</span><span class="hljs-comment">;</span><br>num d <span class="hljs-operator">=</span> <span class="hljs-number">100</span><span class="hljs-comment">;</span><br></code></pre></td></tr></table></figure><p>2ï¼‰ã€æ•°å­—ç±»å‹å’Œå­—ç¬¦ä¸²ç±»å‹äº’ç›¸è½¬æ¢</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-comment">// å°† String ç±»å‹è½¬æ¢æˆ int ç±»å‹</span><br><span class="hljs-keyword">var</span> one = <span class="hljs-built_in">int</span>.parse(<span class="hljs-string">&#x27;1&#x27;</span>);<br><br><span class="hljs-comment">// å°† String ç±»å‹è½¬æ¢æˆ double ç±»å‹</span><br><span class="hljs-keyword">var</span> onePointOne = <span class="hljs-built_in">double</span>.parse(<span class="hljs-string">&#x27;1.1&#x27;</span>);<br><br><br><span class="hljs-comment">// å°† int ç±»å‹è½¬æ¢æˆ String ç±»å‹</span><br><span class="hljs-built_in">String</span> oneAsString = <span class="hljs-number">1.</span>toString();<br><br><span class="hljs-comment">// å°† double ç±»å‹è½¬æ¢æˆ String ç±»å‹, ä¿ç•™ä¸¤ä½å°æ•°</span><br><span class="hljs-built_in">String</span> piAsString = <span class="hljs-number">3.14159</span>.toStringAsFixed(<span class="hljs-number">2</span>);<br></code></pre></td></tr></table></figure><h4 id="2-1-2ã€å­—ç¬¦ä¸²ç±»å‹"><a href="#2-1-2ã€å­—ç¬¦ä¸²ç±»å‹" class="headerlink" title="2.1.2ã€å­—ç¬¦ä¸²ç±»å‹"></a>2.1.2ã€å­—ç¬¦ä¸²ç±»å‹</h4><p>1ï¼‰ã€å­—ç¬¦ä¸²ç±»å‹ä½¿ç”¨å•å¼•å·æˆ–è€…åŒå¼•å·åŒ…è£¹å­—ç¬¦ä¸²éƒ½å¯ä»¥</p><figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs actionscript"><span class="hljs-keyword">var</span> s1 = <span class="hljs-string">&#x27;Hello&#x27;</span>;<br><span class="hljs-keyword">var</span> s2 = <span class="hljs-string">&quot;erdai&quot;</span>;<br></code></pre></td></tr></table></figure><h5 id="2-1-2-1ã€å­—ç¬¦ä¸²å†…åµŒè¡¨è¾¾å¼"><a href="#2-1-2-1ã€å­—ç¬¦ä¸²å†…åµŒè¡¨è¾¾å¼" class="headerlink" title="2.1.2.1ã€å­—ç¬¦ä¸²å†…åµŒè¡¨è¾¾å¼"></a>2.1.2.1ã€å­—ç¬¦ä¸²å†…åµŒè¡¨è¾¾å¼</h5><p>1ï¼‰ã€Dart æ”¯æŒåœ¨å­—ç¬¦ä¸²ä¸­å†…åµŒå˜é‡ï¼Œæˆ–è€…å¹²è„†å†…åµŒè¡¨è¾¾å¼</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-comment">// å†…åµŒå˜é‡</span><br><span class="hljs-keyword">var</span> s3 = <span class="hljs-string">&#x27;ä½ å¥½: <span class="hljs-subst">$s2</span>&#x27;</span>;<br><br><span class="hljs-comment">// å†…åµŒè¡¨è¾¾å¼</span><br><span class="hljs-keyword">var</span> s4 = <span class="hljs-string">&quot;è½¬å¤§å†™ï¼š<span class="hljs-subst">$&#123;s2.toUpperCase()&#125;</span>&quot;</span>;<br></code></pre></td></tr></table></figure><h5 id="2-1-2-2ã€å­—ç¬¦ä¸²ç›¸åŠ ï¼ˆè¿æ¥ï¼‰"><a href="#2-1-2-2ã€å­—ç¬¦ä¸²ç›¸åŠ ï¼ˆè¿æ¥ï¼‰" class="headerlink" title="2.1.2.2ã€å­—ç¬¦ä¸²ç›¸åŠ ï¼ˆè¿æ¥ï¼‰"></a>2.1.2.2ã€å­—ç¬¦ä¸²ç›¸åŠ ï¼ˆè¿æ¥ï¼‰</h5><p>å­—ç¬¦ä¸²ç›¸åŠ ï¼Œå°±æ˜¯å°†ä¸¤ä¸ªå­—ç¬¦ä¸²è¿æ¥èµ·æ¥ï¼Œdart è¯­è¨€ä¸­æœ‰ä»¥ä¸‹ä¸¤ç§æ–¹å¼å®ç°å­—ç¬¦ä¸²è¿æ¥ï¼š</p><p>1ï¼‰ã€è¿ç»­çš„å­—é¢å­—ç¬¦ä¸²å®šä¹‰ï¼Œé»˜è®¤ä¼šå°†å­—ç¬¦ä¸²è¿æ¥èµ·æ¥</p><p>2ï¼‰ã€ä½¿ç”¨ + åŠ å·è¿æ¥å­—ç¬¦ä¸²</p><figure class="highlight axapta"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs axapta"><span class="hljs-keyword">void</span> main()&#123;<br>  <span class="hljs-comment">//1ã€è¿ç»­çš„å­—é¢å­—ç¬¦ä¸²å®šä¹‰ï¼Œé»˜è®¤ä¼šå°†å­—ç¬¦ä¸²è¿æ¥èµ·æ¥</span><br>  <span class="hljs-built_in">var</span> str1 = <span class="hljs-string">&quot;erdai&quot;</span> <span class="hljs-string">&quot;666&quot;</span>;<br>  <span class="hljs-comment">//2ã€ä½¿ç”¨ + åŠ å·è¿æ¥å­—ç¬¦ä¸²</span><br>  <span class="hljs-built_in">var</span> str2 = <span class="hljs-string">&quot;erdai&quot;</span> + <span class="hljs-string">&quot;666&quot;</span>;<br>  <span class="hljs-keyword">print</span>(str1);<br>  <span class="hljs-keyword">print</span>(str2);<br>&#125;<br><br><span class="hljs-comment">//æ‰“å°ç»“æœ</span><br>erdai666<br>erdai666<br></code></pre></td></tr></table></figure><h5 id="2-1-2-3ã€å¤šè¡Œå­—ç¬¦ä¸²å®šä¹‰"><a href="#2-1-2-3ã€å¤šè¡Œå­—ç¬¦ä¸²å®šä¹‰" class="headerlink" title="2.1.2.3ã€å¤šè¡Œå­—ç¬¦ä¸²å®šä¹‰"></a>2.1.2.3ã€å¤šè¡Œå­—ç¬¦ä¸²å®šä¹‰</h5><p>1ï¼‰ã€ä½¿ç”¨ <strong>â€˜â€™â€™</strong> ä¸‰å¼•å·å®šä¹‰å¤šè¡Œå­—ç¬¦ä¸²ï¼Œè¿™ç§æ–¹å¼å¯ä»¥ä¿ç•™å­—ç¬¦ä¸²çš„æ¢è¡Œç¬¦</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs awk">void main() &#123;<br>  var s1 = <span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">è¿™æ˜¯ç¬¬ä¸€è¡Œå­—ç¬¦ä¸²ã€‚</span><br><span class="hljs-string">è¿™æ˜¯ç¬¬äºŒè¡Œå­—ç¬¦ä¸²ã€‚</span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span>;<br>  print(s1);<br>&#125;<br><br><span class="hljs-regexp">//</span>æ‰“å°ç»“æœ<br>è¿™æ˜¯ç¬¬ä¸€è¡Œå­—ç¬¦ä¸²ã€‚<br>è¿™æ˜¯ç¬¬äºŒè¡Œå­—ç¬¦ä¸²ã€‚<br></code></pre></td></tr></table></figure><h4 id="2-1-3ã€å¸ƒå°”ç±»å‹"><a href="#2-1-3ã€å¸ƒå°”ç±»å‹" class="headerlink" title="2.1.3ã€å¸ƒå°”ç±»å‹"></a>2.1.3ã€å¸ƒå°”ç±»å‹</h4><p>å¸ƒå°”ç±»å‹å°±ä¸¤ç§å€¼ï¼štrue æˆ–è€… falseï¼Œ åˆ†åˆ«è¡¨ç¤ºçœŸå’Œå‡</p><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs abnf">var isOk <span class="hljs-operator">=</span> false<span class="hljs-comment">;</span><br>bool status <span class="hljs-operator">=</span> true<span class="hljs-comment">;</span><br></code></pre></td></tr></table></figure><h4 id="2-1-4ã€æšä¸¾ç±»å‹"><a href="#2-1-4ã€æšä¸¾ç±»å‹" class="headerlink" title="2.1.4ã€æšä¸¾ç±»å‹"></a>2.1.4ã€æšä¸¾ç±»å‹</h4><p>1ï¼‰ã€æšä¸¾ç±»å‹å…¶å®å°±æ˜¯ä¸€ç»„å¸¸é‡çš„é›†åˆï¼Œéƒ½æ˜¯åªè¯»çš„</p><figure class="highlight processing"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs processing"><span class="hljs-comment">// ä½¿ç”¨ enum å…³é”®å­—ï¼Œå®šä¹‰ Color æšä¸¾ç±»å‹ï¼ŒColor åŒ…å«äº†3ä¸ªå¸¸é‡ redã€greenã€blue</span><br><span class="hljs-keyword">enum</span> Color &#123; <span class="hljs-built_in">red</span>, <span class="hljs-built_in">green</span>, <span class="hljs-built_in">blue</span> &#125;<br><br><span class="hljs-comment">// è¯»å– Color.blue æšä¸¾å¸¸é‡</span><br>var aColor = Color.<span class="hljs-property">blue</span>;<br><br><span class="hljs-comment">// ä½¿ç”¨ switch è¯­å¥åˆ¤æ–­ aColor å˜é‡å€¼</span><br><span class="hljs-title function_">switch</span> (aColor) &#123;<br>  <span class="hljs-keyword">case</span> Color.<span class="hljs-property">red</span>:  <span class="hljs-comment">// ä½¿ç”¨æšä¸¾å¸¸é‡ä½œä¸ºæ£€æµ‹æ¡ä»¶ï¼ŒaColor == Color.red åˆ™æˆç«‹ã€‚</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;Red as roses!&#x27;</span>);<br>    <span class="hljs-keyword">break</span>;<br>  <span class="hljs-keyword">case</span> Color.<span class="hljs-property">green</span>:<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;Green as grass!&#x27;</span>);<br>    <span class="hljs-keyword">break</span>;<br>  <span class="hljs-keyword">default</span>: <span class="hljs-comment">// é»˜è®¤æ¡ä»¶</span><br>    <span class="hljs-built_in">print</span>(aColor); <span class="hljs-comment">// &#x27;Color.blue&#x27;</span><br>&#125;<br></code></pre></td></tr></table></figure><p>2ï¼‰ã€æšä¸¾å¸¸é‡éƒ½æœ‰ä¸€ä¸ªä» 0 å¼€å§‹æ•°å­—ç¼–å·ï¼Œç¬¬ä¸€ä¸ªå¸¸é‡æ˜¯ 0ï¼Œç¬¬äºŒä¸ªæ˜¯ 1ï¼Œä»¥æ­¤ç±»æ¨</p><figure class="highlight axapta"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs axapta"><span class="hljs-keyword">void</span> main() &#123;<br>  <span class="hljs-keyword">print</span>(Color.green.<span class="hljs-keyword">index</span>);<br>  <span class="hljs-keyword">print</span>(Color.blue.<span class="hljs-keyword">index</span>);<br>&#125;<br><br><span class="hljs-comment">//æ‰“å°ç»“æœ</span><br><span class="hljs-number">1</span><br><span class="hljs-number">2</span><br></code></pre></td></tr></table></figure><h3 id="2-2ã€è¿ç®—ç¬¦"><a href="#2-2ã€è¿ç®—ç¬¦" class="headerlink" title="2.2ã€è¿ç®—ç¬¦"></a>2.2ã€è¿ç®—ç¬¦</h3><p>è¿ç®—ç¬¦è¿™ä¸€å—ï¼Œé™¤äº†çº§è”è°ƒç”¨æ˜¯ Java å’Œ Kotlin æ‰€æ²¡æœ‰çš„ï¼Œå…¶ä»–è¿ç®—ç¬¦åŸºæœ¬ç±»ä¼¼</p><h4 id="2-2-1ã€çº§è”è°ƒç”¨"><a href="#2-2-1ã€çº§è”è°ƒç”¨" class="headerlink" title="2.2.1ã€çº§è”è°ƒç”¨"></a>2.2.1ã€çº§è”è°ƒç”¨</h4><p>1ï¼‰ã€çº§è”è°ƒç”¨å°±æ˜¯é€šè¿‡ <strong>.. (ä¸¤ä¸ªè¿ç»­çš„ç‚¹)</strong> è¿ç»­è°ƒç”¨å¯¹è±¡çš„å±æ€§å’Œæ–¹æ³•</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs awk">querySelector(<span class="hljs-string">&#x27;#confirm&#x27;</span>) <span class="hljs-regexp">//</span> é€šè¿‡ querySelector æŸ¥è¯¢è·å¾—ä¸€ä¸ªå¯¹è±¡<br>  ..text = <span class="hljs-string">&#x27;Confirm&#x27;</span> <span class="hljs-regexp">//</span> è®¾ç½®å¯¹è±¡ text å±æ€§<br>  ..classes.add(<span class="hljs-string">&#x27;important&#x27;</span>);  <span class="hljs-regexp">//</span> è°ƒç”¨å¯¹è±¡çš„ classes å±æ€§çš„ add å‡½æ•°<br><br><span class="hljs-regexp">//</span>ç­‰ä»·å¦‚ä¸‹ä»£ç <br><br><span class="hljs-regexp">//</span> é€šè¿‡ querySelector æŸ¥è¯¢è·å¾—ä¸€ä¸ªå¯¹è±¡<br>var button = querySelector(<span class="hljs-string">&#x27;#confirm&#x27;</span>);<br><span class="hljs-regexp">//</span> è®¾ç½®å¯¹è±¡ text å±æ€§<br>button.text = <span class="hljs-string">&#x27;Confirm&#x27;</span>;<br><span class="hljs-regexp">//</span> è°ƒç”¨å¯¹è±¡çš„ classes å±æ€§çš„ add å‡½æ•°<br>button.classes.add(<span class="hljs-string">&#x27;important&#x27;</span>);<br></code></pre></td></tr></table></figure><p><strong>æ³¨æ„</strong>ï¼šå¤§å®¶å…ˆå…³æ³¨è¯­æ³•å³å¯</p><h4 id="2-2-2ã€èµ‹å€¼è¿ç®—ç¬¦"><a href="#2-2-2ã€èµ‹å€¼è¿ç®—ç¬¦" class="headerlink" title="2.2.2ã€èµ‹å€¼è¿ç®—ç¬¦"></a>2.2.2ã€èµ‹å€¼è¿ç®—ç¬¦</h4><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-regexp">//</span><span class="hljs-number">1</span>ã€ä½¿ç”¨ = è¿›è¡Œèµ‹å€¼<br>a = <span class="hljs-number">100</span>;<br><br><span class="hljs-regexp">//</span><span class="hljs-number">2</span>ã€å¤åˆèµ‹å€¼è¿ç®—ç¬¦<br>a *= <span class="hljs-number">3</span>; <span class="hljs-regexp">//</span> ç­‰ä»·äº a = a * <span class="hljs-number">3</span><br>a -= <span class="hljs-number">3</span>; <span class="hljs-regexp">//</span> ç­‰ä»·äº a = a - <span class="hljs-number">3</span><br>a += <span class="hljs-number">3</span>; <span class="hljs-regexp">//</span> ç­‰ä»·äº a = a + <span class="hljs-number">3</span><br>a <span class="hljs-regexp">/= 3; /</span><span class="hljs-regexp">/ ç­‰ä»·äº a = a /</span> <span class="hljs-number">3</span><br>a %= <span class="hljs-number">3</span>; <span class="hljs-regexp">//</span> ç­‰ä»·äº a = a % <span class="hljs-number">3</span><br></code></pre></td></tr></table></figure><h4 id="2-2-3ã€ç®—æ•°è¿ç®—ç¬¦"><a href="#2-2-3ã€ç®—æ•°è¿ç®—ç¬¦" class="headerlink" title="2.2.3ã€ç®—æ•°è¿ç®—ç¬¦"></a>2.2.3ã€ç®—æ•°è¿ç®—ç¬¦</h4><table><thead><tr><th>è¿ç®—ç¬¦</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>+</td><td>åŠ </td></tr><tr><td>-</td><td>å‡</td></tr><tr><td>-expr</td><td>ç®—æ•°å–å</td></tr><tr><td>*</td><td>ä¹˜</td></tr><tr><td>&#x2F;</td><td>é™¤</td></tr><tr><td>~&#x2F;</td><td>é™¤æ³•ï¼Œç»“æœå–æ•´</td></tr><tr><td>%</td><td>æ±‚ä½™</td></tr><tr><td>++</td><td>æ”¯æŒå‰ç½®è‡ªå¢å’Œåç½®è‡ªå¢</td></tr><tr><td>â€“</td><td>æ”¯æŒå‰ç½®è‡ªå‡å’Œåç½®è‡ªå‡</td></tr></tbody></table><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-regexp">//</span> a = <span class="hljs-number">5</span><br>var a = <span class="hljs-number">2</span> + <span class="hljs-number">3</span>;<br><span class="hljs-regexp">//</span> a1 = -<span class="hljs-number">1</span><br>var a1 = <span class="hljs-number">2</span> - <span class="hljs-number">3</span>;<br><span class="hljs-regexp">//</span> a2 = <span class="hljs-number">6</span><br>var a2 = <span class="hljs-number">2</span> * <span class="hljs-number">3</span>;<br><span class="hljs-regexp">//</span> a3 = <span class="hljs-number">2.5</span><br>var a3 = <span class="hljs-number">5</span> / <span class="hljs-number">2</span>;<br><span class="hljs-regexp">//</span> æ•´é™¤ï¼Œa4 = <span class="hljs-number">2</span><br>var a4 = <span class="hljs-number">5</span> ~/ <span class="hljs-number">2</span>;<br><span class="hljs-regexp">//</span> æ±‚ä½™æ•° a5 = <span class="hljs-number">1</span><br>var a5 = <span class="hljs-number">5</span> % <span class="hljs-number">2</span>;<br><span class="hljs-regexp">//</span>a++ å’Œ ++a åŒºåˆ«ï¼ša++ å…ˆç”¨åœ¨åŠ ï¼Œ++aå…ˆåŠ åœ¨ç”¨<br>a++; <span class="hljs-regexp">//</span> ç›¸å½“äº a = a + <span class="hljs-number">1</span><br>++a; <br>a--; <span class="hljs-regexp">//</span> ç›¸å½“äº a = a - <span class="hljs-number">1</span><br>--a;<br></code></pre></td></tr></table></figure><h4 id="2-2-4ã€å…³ç³»è¿ç®—ç¬¦"><a href="#2-2-4ã€å…³ç³»è¿ç®—ç¬¦" class="headerlink" title="2.2.4ã€å…³ç³»è¿ç®—ç¬¦"></a>2.2.4ã€å…³ç³»è¿ç®—ç¬¦</h4><p>å…³ç³»è¿è¿ç®—ç¬¦å¸¸ç”¨äºæ¡ä»¶è¡¨è¾¾å¼ä¸­ï¼Œåˆ¤æ–­æ¡ä»¶æ˜¯å¦æˆç«‹</p><table><thead><tr><th>è¿ç®—ç¬¦</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>&#x3D;&#x3D;</td><td>åˆ¤æ–­ä¸¤ä¸ªå€¼æ˜¯å¦ç›¸ç­‰</td></tr><tr><td>!&#x3D;</td><td>åˆ¤æ–­ä¸¤ä¸ªå€¼æ˜¯å¦ä¸ç›¸ç­‰</td></tr><tr><td>&gt;</td><td>å¤§äº</td></tr><tr><td>&lt;</td><td>å°äº</td></tr><tr><td>&gt;&#x3D;</td><td>å¤§äºç­‰äº</td></tr><tr><td>&lt;&#x3D;</td><td>å°äºç­‰äº</td></tr></tbody></table><h4 id="2-2-5ã€ç±»å‹æµ‹è¯•è¿ç®—ç¬¦"><a href="#2-2-5ã€ç±»å‹æµ‹è¯•è¿ç®—ç¬¦" class="headerlink" title="2.2.5ã€ç±»å‹æµ‹è¯•è¿ç®—ç¬¦"></a>2.2.5ã€ç±»å‹æµ‹è¯•è¿ç®—ç¬¦</h4><table><thead><tr><th>è¿ç®—ç¬¦</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>as</td><td>ç”¨äºç±»å‹è½¬æ¢ï¼Œå°†ä¸€ä¸ªå¯¹è±¡ç±»å‹è½¬æ¢æˆå¦å¤–ä¸€ç§å¯¹è±¡ç±»å‹ï¼Œä¸€èˆ¬ç”¨äºå­ç±»å¯¹è±¡è½¬æ¢æˆçˆ¶ç±»å¯¹è±¡ã€‚</td></tr><tr><td>is</td><td>ç”¨äºæ£€æµ‹ä¸€ä¸ªå˜é‡æ˜¯å¦å±äºæŸç§å¯¹è±¡ç±»å‹</td></tr><tr><td>is!</td><td>ç”¨äºæ£€æµ‹ä¸€ä¸ªå˜é‡ä¸å±äºæŸç§å¯¹è±¡ç±»å‹</td></tr></tbody></table><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-regexp">//</span> å¦‚æœ emp å˜é‡æ˜¯ Person ç±»å‹åˆ™æ¡ä»¶ä¸º true<br><span class="hljs-keyword">if</span> (emp is Person) &#123;<br>  <span class="hljs-regexp">//</span> å¿½ç•¥ä»£ç <br>&#125;<br><br><span class="hljs-regexp">//</span> æ°¸è¿œè¿”å› true, å› ä¸ºæ‰€æœ‰ç±»å‹éƒ½ç»§æ‰¿äº† Objectã€‚<br><span class="hljs-keyword">if</span> (emp is Object) &#123;<br>    <span class="hljs-regexp">//</span> å¿½ç•¥ä»£ç <br>&#125;<br></code></pre></td></tr></table></figure><p><strong>æ³¨æ„</strong>ï¼šå¦‚æœå˜é‡æ˜¯æŸä¸ªç±»çš„å­ç±»çš„å®ä¾‹ï¼Œé‚£ä¹ˆè¿™ä¸ªå˜é‡ä¹Ÿå±äºçˆ¶ç±»ç±»å‹ï¼Œis æ¡ä»¶è¿”å› true</p><h4 id="2-2-6ã€é€»è¾‘è¿ç®—ç¬¦"><a href="#2-2-6ã€é€»è¾‘è¿ç®—ç¬¦" class="headerlink" title="2.2.6ã€é€»è¾‘è¿ç®—ç¬¦"></a>2.2.6ã€é€»è¾‘è¿ç®—ç¬¦</h4><table><thead><tr><th>è¿ç®—ç¬¦</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>!expr</td><td>è¡¨è¾¾å¼æ¡ä»¶å–å</td></tr><tr><td>||</td><td>é€»è¾‘æˆ–</td></tr><tr><td>&amp;&amp;</td><td>é€»è¾‘ä¸</td></tr></tbody></table><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-regexp">//</span>å¸¸ç”¨äºæ¡ä»¶è¯­å¥ç»„åˆè¡¨è¾¾å¼<br><span class="hljs-keyword">if</span> (!done &amp;&amp; (col == <span class="hljs-number">0</span> || col == <span class="hljs-number">3</span>)) &#123;<br>  <span class="hljs-regexp">//</span>...<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="2-2-7ã€ä½è¿ç®—ç¬¦"><a href="#2-2-7ã€ä½è¿ç®—ç¬¦" class="headerlink" title="2.2.7ã€ä½è¿ç®—ç¬¦"></a>2.2.7ã€ä½è¿ç®—ç¬¦</h4><p>äºŒè¿›åˆ¶ä½è¿ç®—ç¬¦</p><table><thead><tr><th>è¿ç®—ç¬¦</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>&amp;</td><td>ä¸</td></tr><tr><td>|</td><td>æˆ–</td></tr><tr><td>^</td><td>å¼‚æˆ–</td></tr><tr><td>~expr</td><td>æŒ‰ä½å–å</td></tr><tr><td>&lt;&lt;</td><td>å·¦ç§»</td></tr><tr><td>&gt;&gt;</td><td>å³ç§»</td></tr></tbody></table><figure class="highlight tap"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs tap">// a = 256<br>var a =<span class="hljs-number"> 1 </span>&lt;&lt; 8; //<span class="hljs-number"> 1 </span>å·¦ç§»<span class="hljs-number"> 8 </span>ä½ç›¸å½“äºï¼š1 *<span class="hljs-number"> 2 </span>çš„<span class="hljs-number"> 8 </span>æ¬¡æ–¹<br></code></pre></td></tr></table></figure><h4 id="2-2-8ã€æ¡ä»¶è¿ç®—ç¬¦"><a href="#2-2-8ã€æ¡ä»¶è¿ç®—ç¬¦" class="headerlink" title="2.2.8ã€æ¡ä»¶è¿ç®—ç¬¦"></a>2.2.8ã€æ¡ä»¶è¿ç®—ç¬¦</h4><p>Dart ä¸­æœ‰ä¸¤ç§æ¡ä»¶è¿ç®—ç¬¦ï¼š</p><p>1ã€è¯­æ³•è§„åˆ™ï¼šcondition ? expr1 : expr2 ï¼Œç±»ä¼¼ Java ä¸‰ç›®è¿ç®—ç¬¦ã€‚condition è¡¨è¾¾å¼ä¸ºçœŸï¼Œåˆ™æ‰§è¡Œå¹¶è¿”å› expr1 çš„å€¼ï¼Œ å¦åˆ™æ‰§è¡Œ expr2</p><p>2ã€è¯­æ³•è§„åˆ™ï¼šexpr1 ?? expr2 ï¼Œç±»ä¼¼ Kotlin çš„ ?: ã€‚å¦‚æœ expr1 ä¸ç­‰äº null, åˆ™æ‰§è¡Œ expr1 å¹¶è¿”å› expr1 çš„å€¼ï¼Œå¦åˆ™æ‰§è¡Œå¹¶è¿”å› expr2 çš„å€¼</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-regexp">//</span> å¦‚æœisPublicä¸ºçœŸï¼Œvisibility = <span class="hljs-string">&#x27;public&#x27;</span> å¦åˆ™ visibility = <span class="hljs-string">&#x27;private&#x27;</span><br>var visibility = isPublic ? <span class="hljs-string">&#x27;public&#x27;</span> : <span class="hljs-string">&#x27;private&#x27;</span>;<br><br><span class="hljs-regexp">//</span> è¿™ç§è¯­æ³•åœ¨å¤„ç†å‚æ•°é»˜è®¤å€¼éå¸¸æœ‰ç”¨ã€‚<br><span class="hljs-regexp">//</span> å¦‚æœnameä¸ç­‰äºnull, åˆ™payerName = name å¦åˆ™payerName = <span class="hljs-string">&#x27;Guest&#x27;</span><br>String payerName = name ?? <span class="hljs-string">&#x27;Guest&#x27;</span>;<br></code></pre></td></tr></table></figure><h2 id="ä¸‰ã€æ•°ç»„å’Œé›†åˆ"><a href="#ä¸‰ã€æ•°ç»„å’Œé›†åˆ" class="headerlink" title="ä¸‰ã€æ•°ç»„å’Œé›†åˆ"></a>ä¸‰ã€æ•°ç»„å’Œé›†åˆ</h2><h3 id="3-1ã€List-æ•°ç»„"><a href="#3-1ã€List-æ•°ç»„" class="headerlink" title="3.1ã€List æ•°ç»„"></a>3.1ã€List æ•°ç»„</h3><h4 id="3-1-1ã€å®šä¹‰"><a href="#3-1-1ã€å®šä¹‰" class="headerlink" title="3.1.1ã€å®šä¹‰"></a>3.1.1ã€å®šä¹‰</h4><p>1ï¼‰ã€ä¸ Java çš„æ•°ç»„ç±»å‹ä¸åŒï¼ŒDart ä¸­çš„æ•°ç»„ç±»å‹å°±æ˜¯ Listï¼Œå®ƒæ˜¯æ³›å‹ç±»å‹æ•°æ®ç»“æ„ï¼Œæ”¯æŒä»»æ„æ•°æ®ç±»å‹çš„æ•°ç»„</p><p>2ï¼‰ã€List æ•°ç»„å®šä¹‰çš„å…ƒç´ æœ‰åºå¯é‡å¤ï¼Œç±»ä¼¼ Java çš„ List é›†åˆ</p><p>3ï¼‰ã€Dart ä¸­ List æ•°ç»„ä¸»è¦åˆ†ä¸ºä¸¤ç§ç±»å‹ï¼š</p><p>1ã€å¯å˜é•¿åº¦æ•°ç»„</p><p>2ã€å›ºå®šé•¿åº¦æ•°ç»„</p><p>ä¸ç®¡æ˜¯å“ªç§ç±»å‹çš„æ•°ç»„ï¼Œä»–ä»¬çš„æ“ä½œæ–¹å¼æ˜¯ä¸€æ ·çš„</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-regexp">//</span><span class="hljs-number">1</span>ã€å¯å˜é•¿åº¦æ•°ç»„<br><span class="hljs-regexp">//</span>å®šä¹‰ä¸€ä¸ª int ç±»å‹çš„å¯å˜æ•°ç»„<br>List&lt;int&gt; a = []; <span class="hljs-regexp">//</span>ç­‰ä»·ï¼švar a = &lt;int&gt;[];<br><br><span class="hljs-regexp">//</span>å®šä¹‰ä¸€ä¸ª String ç±»å‹çš„å¯å˜æ•°ç»„<br>var strs = &lt;String&gt;[]; <span class="hljs-regexp">//</span>ç­‰ä»· List&lt;String&gt; strs = [];<br><br><span class="hljs-regexp">//</span>å¦‚ä¸‹è¿™ç§å®šä¹‰æ–¹å¼ï¼Œç¼–è¯‘å™¨ä¼šç»™æˆ‘ä»¬æ¨æ–­å‡ºæ˜¯å­—ç¬¦ä¸²ç±»å‹çš„å¯å˜æ•°ç»„<br>var strs = [<span class="hljs-string">&#x27;å­—ç¬¦ä¸²&#x27;</span>];<br></code></pre></td></tr></table></figure><p>1ã€ç†Ÿæ‚‰ Java çš„äººéƒ½çŸ¥é“ï¼Œä¸Šè¿°è¿™ç§å®šä¹‰å°±æ˜¯æ³›å‹ç±»å‹çš„è¯­æ³•ï¼Œ&lt;&gt; ç¬¦å·å®šä¹‰çš„æ˜¯ List çš„å…ƒç´ ç±»å‹</p><p>2ã€ä¸Šè¿°å®šä¹‰æ•°ç»„æˆ‘ä»¬å¹¶æ²¡æœ‰æŒ‡å®šæ•°ç»„å¤§å°ï¼Œå› æ­¤ä»–ä»¬å®šä¹‰çš„éƒ½æ˜¯å¯å˜æ•°ç»„ï¼Œå¯å˜æ•°ç»„å¯ä»¥å¾€æ•°ç»„ä¸­æ’å…¥ä¸é™åˆ¶æ•°é‡çš„å…ƒç´  ï¼ˆåªè¦æ²¡è¶…è¿‡å†…å­˜é™åˆ¶ï¼‰</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-regexp">//</span><span class="hljs-number">2</span>ã€å›ºå®šé•¿åº¦æ•°ç»„<br><span class="hljs-regexp">//</span>å®šä¹‰ä¸€ä¸ªå›ºå®šé•¿åº¦ä¸º <span class="hljs-number">3</span> ï¼Œç±»å‹ä¸º int çš„æ•°ç»„<br>var list = List.filled(<span class="hljs-number">3</span>,<span class="hljs-number">0</span>);<br><br><span class="hljs-regexp">//</span>æµ‹è¯•ä¸€<br>void main() &#123;<br>  <span class="hljs-regexp">//</span>å®šä¹‰ä¸€ä¸ªå›ºå®šé•¿åº¦ä¸º <span class="hljs-number">3</span> ï¼Œç±»å‹ä¸º int çš„æ•°ç»„<br>  var list = List.filled(<span class="hljs-number">3</span>,<span class="hljs-number">0</span>);<br>  list[<span class="hljs-number">0</span>] = <span class="hljs-number">1</span>;<br>  list[<span class="hljs-number">1</span>] = <span class="hljs-number">2</span>;<br>  list[<span class="hljs-number">2</span>] = <span class="hljs-number">3</span>;<br>  <span class="hljs-regexp">//</span>æ­¤æ—¶å¦‚æœæˆ‘ä»¬æ·»åŠ ç¬¬ <span class="hljs-number">4</span> ä¸ªå…ƒç´ ï¼Œåˆ™ä¼šæŠ¥æ•°ç»„ä¸‹æ ‡è¶Šç•Œå¼‚å¸¸<br>  <span class="hljs-regexp">//</span>list[<span class="hljs-number">3</span>] = <span class="hljs-number">4</span>; <span class="hljs-regexp">//</span>æ•°ç»„ä¸‹æ ‡è¶Šç•Œ<br>  <span class="hljs-keyword">for</span> (var value <span class="hljs-keyword">in</span> list) &#123;<br>    print(value);<br>  &#125;<br>&#125;<br><span class="hljs-regexp">//</span>æ‰“å°ç»“æœ<br><span class="hljs-number">1</span><br><span class="hljs-number">2</span><br><span class="hljs-number">3</span><br>  <br><span class="hljs-regexp">//</span>æµ‹è¯•äºŒï¼š<br>void main() &#123;<br>  <span class="hljs-regexp">//</span>å®šä¹‰ä¸€ä¸ªå›ºå®šé•¿åº¦ä¸º <span class="hljs-number">2</span> ï¼Œç±»å‹ä¸º String çš„æ•°ç»„<br>  var list = List.filled(<span class="hljs-number">2</span>,<span class="hljs-string">&quot;&quot;</span>);<br>  list[<span class="hljs-number">0</span>] = <span class="hljs-string">&quot;erdai&quot;</span>;<br>  list[<span class="hljs-number">1</span>] = <span class="hljs-string">&quot;666&quot;</span>;<br><br>  <span class="hljs-keyword">for</span> (var value <span class="hljs-keyword">in</span> list) &#123;<br>    print(value);<br>  &#125;<br>&#125;<br><span class="hljs-regexp">//</span>æ‰“å°ç»“æœ<br>erdai<br><span class="hljs-number">666</span><br></code></pre></td></tr></table></figure><p><strong>æ³¨æ„ï¼š</strong></p><p>1ã€ä¸Šè¿° filled æ–¹æ³•çš„ä¸¤ä¸ªå‚æ•°ï¼šç¬¬ä¸€ä¸ªè¡¨ç¤ºæ•°ç»„é•¿åº¦ï¼Œç¬¬äºŒä¸ªè¡¨ç¤ºå­˜æ”¾çš„å…ƒç´ ç±»å‹åˆå§‹å€¼</p><p>2ã€å›ºå®šé•¿åº¦çš„æ•°ç»„ï¼Œåªèƒ½é€šè¿‡æ•°ç»„ä¸‹æ ‡çš„æ–¹å¼è¯»å†™æ•°ç»„ï¼Œä¸èƒ½ä½¿ç”¨ addï¼Œinsert æ–¹æ³•ä¿®æ”¹æ•°ç»„ï¼Œå¦åˆ™ä¼šæŠ¥é”™</p><h4 id="3-1-2ã€ä¼¸å±•è¿ç®—ç¬¦"><a href="#3-1-2ã€ä¼¸å±•è¿ç®—ç¬¦" class="headerlink" title="3.1.2ã€ä¼¸å±•è¿ç®—ç¬¦"></a>3.1.2ã€ä¼¸å±•è¿ç®—ç¬¦</h4><p>å¦‚æœæˆ‘ä»¬æƒ³å°†ä¸€ä¸ª List æ•°ç»„çš„å…ƒç´ å¡«å……åˆ°å¦å¤–ä¸€ä¸ªæ•°ç»„å»ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¼¸å±•è¿ç®—ç¬¦ <strong>â€¦</strong> ï¼Œå¦‚ä¸‹ï¼š</p><figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs actionscript"><span class="hljs-keyword">var</span> list = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>];<br><span class="hljs-keyword">var</span> list2 = [<span class="hljs-number">0</span>, ...list]; <span class="hljs-comment">// å°† list æ•°ç»„çš„æ‰€æœ‰å…ƒç´ ä¸€ä¸ªä¸ªå±•å¼€æ¥ï¼Œæ’å…¥åˆ° list2 ä¸­</span><br><span class="hljs-comment">// ç­‰ä»·ä»£ç  var list2 = [0, 1, 2, 3]</span><br></code></pre></td></tr></table></figure><h4 id="3-1-3ã€å¸¸ç”¨-Api-ä»‹ç»"><a href="#3-1-3ã€å¸¸ç”¨-Api-ä»‹ç»" class="headerlink" title="3.1.3ã€å¸¸ç”¨ Api ä»‹ç»"></a>3.1.3ã€å¸¸ç”¨ Api ä»‹ç»</h4><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-regexp">//</span><span class="hljs-number">1</span>ã€é¦–å…ˆå®šä¹‰ä¸€ä¸ª int ç±»å‹çš„å¯å˜æ•°ç»„<br>var a = &lt;int&gt;[];<br><br><span class="hljs-regexp">//</span><span class="hljs-number">2</span>ã€å¾€æ•°ç»„å°¾å·´æ·»åŠ å…ƒç´  a:[<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>]<br>a.add(<span class="hljs-number">1</span>);<br>a.add(<span class="hljs-number">2</span>);<br>a.add(<span class="hljs-number">3</span>);<br><br><span class="hljs-regexp">//</span><span class="hljs-number">3</span>ã€ä¿®æ”¹ç¬¬ä¸€ä¸ªå…ƒç´ çš„å€¼ a:[<span class="hljs-number">0</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>]<br>a[<span class="hljs-number">0</span>] = <span class="hljs-number">0</span>;<br><br><span class="hljs-regexp">//</span><span class="hljs-number">4</span>ã€åœ¨æ•°ç»„ <span class="hljs-number">0</span> ä½ç½®ï¼Œæ’å…¥ <span class="hljs-number">100</span> a:[<span class="hljs-number">100</span>,<span class="hljs-number">0</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>]<br>a.insert(<span class="hljs-number">0</span>,<span class="hljs-number">100</span>);<br><br><span class="hljs-regexp">//</span><span class="hljs-number">5</span>ã€åˆ é™¤ä¸€ä¸ªå…ƒç´  a:[<span class="hljs-number">100</span>,<span class="hljs-number">0</span>,<span class="hljs-number">2</span>]<br><span class="hljs-regexp">//</span>æ ¹æ®å…ƒç´ åˆ é™¤<br>a.remove(<span class="hljs-number">3</span>);<br><br><span class="hljs-regexp">//</span>æ ¹æ®ä¸‹æ ‡åˆ é™¤ a:[<span class="hljs-number">100</span>,<span class="hljs-number">2</span>]<br>a.removeAt(<span class="hljs-number">1</span>);<br><br><span class="hljs-regexp">//</span><span class="hljs-number">6</span>ã€è·å–æ•°ç»„å¤§å°<br>print(a.length); <span class="hljs-regexp">//</span>æ‰“å°ï¼š<span class="hljs-number">2</span><br>  <br><span class="hljs-regexp">//</span><span class="hljs-number">7</span>ã€æ•°ç»„æ’åºï¼šé»˜è®¤æ•°ç»„ä»å°åˆ°å¤§æ’åº a:[<span class="hljs-number">2</span>,<span class="hljs-number">100</span>]<br>a.sort();<br><br><span class="hljs-regexp">//</span><span class="hljs-number">8</span>ã€åˆ¤æ–­æ•°ç»„æ˜¯å¦åŒ…å«æŒ‡å®šå…ƒç´ <br>a.contains(<span class="hljs-number">2</span>); <span class="hljs-regexp">//</span> true<br><br><span class="hljs-regexp">//</span><span class="hljs-number">9</span>ã€æ¸…ç©º Listï¼Œåˆ é™¤æ‰€æœ‰æ•°æ® a:[]<br>a.clear();<br></code></pre></td></tr></table></figure><h3 id="3-2ã€Set-é›†åˆ"><a href="#3-2ã€Set-é›†åˆ" class="headerlink" title="3.2ã€Set é›†åˆ"></a>3.2ã€Set é›†åˆ</h3><h4 id="3-2-1ã€å®šä¹‰"><a href="#3-2-1ã€å®šä¹‰" class="headerlink" title="3.2.1ã€å®šä¹‰"></a>3.2.1ã€å®šä¹‰</h4><p>1ï¼‰ã€Dart ä¸­çš„ Set æ˜¯æ— åºé›†åˆç±»å‹ï¼ŒSet è·Ÿ List éƒ½èƒ½ä¿å­˜ä¸€ç»„æ•°æ®ï¼ŒåŒºåˆ«å°±æ˜¯ Set çš„å…ƒç´ éƒ½æ˜¯å”¯ä¸€çš„ï¼Œå’Œ Java çš„ Set é›†åˆç±»ä¼¼</p><p>2ï¼‰ã€Set æ”¯æŒä»»æ„ç±»å‹æ•°æ®ï¼Œä¸»è¦æœ‰ä¸‹é¢ä¸‰ç§æ–¹å¼åˆå§‹åŒ–ï¼š</p><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs cmake">//<span class="hljs-number">1</span>ã€æ–¹å¼ä¸€ï¼šä½¿ç”¨ &#123;&#125; å®šä¹‰ä¸€ä¸ª <span class="hljs-keyword">String</span> ç±»å‹çš„ <span class="hljs-keyword">Set</span><br>var strSet = &#123;<span class="hljs-string">&quot;str&quot;</span>&#125;;<br><br>//<span class="hljs-number">2</span>ã€æ–¹å¼äºŒï¼šå®šä¹‰ä¸€ä¸ªç©ºçš„ <span class="hljs-keyword">String</span> ç±»å‹çš„ <span class="hljs-keyword">Set</span><br>var names = &lt;<span class="hljs-keyword">String</span>&gt;&#123;&#125;;<br><br>//<span class="hljs-number">3</span>ã€æ–¹å¼ä¸‰ï¼šé€šè¿‡ <span class="hljs-keyword">Set</span> å¯¹è±¡å®šä¹‰ä¸€ä¸ªå¯ä»¥ä¿å­˜ <span class="hljs-keyword">String</span> ç±»å‹çš„ <span class="hljs-keyword">Set</span><br>var names = <span class="hljs-keyword">Set</span>&lt;<span class="hljs-keyword">String</span>&gt;();<br></code></pre></td></tr></table></figure><h4 id="3-2-2ã€å¸¸ç”¨-Api-ä»‹ç»"><a href="#3-2-2ã€å¸¸ç”¨-Api-ä»‹ç»" class="headerlink" title="3.2.2ã€å¸¸ç”¨ Api ä»‹ç»"></a>3.2.2ã€å¸¸ç”¨ Api ä»‹ç»</h4><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-regexp">//</span><span class="hljs-number">1</span>ã€é¦–å…ˆå®šä¹‰ä¸€ä¸ª set é›†åˆ<br>var names = &lt;String&gt;&#123;&#125;;<br><br><span class="hljs-regexp">//</span><span class="hljs-number">2</span>ã€æ·»åŠ ä¸€ä¸ªå…ƒç´  names:&#123;<span class="hljs-string">&quot;Dart&quot;</span>&#125;<br>names.add(<span class="hljs-string">&quot;Dart&quot;</span>);<br><br><span class="hljs-regexp">//</span><span class="hljs-number">3</span>ã€æ·»åŠ ä¸€ä¸ª List æ•°ç»„ names:&#123;<span class="hljs-string">&quot;Dart&quot;</span>,<span class="hljs-string">&quot;Flutter&quot;</span>&#125;<br>var titles = [<span class="hljs-string">&quot;Flutter&quot;</span>];<br>names.addAll(titles);<br><br><span class="hljs-regexp">//</span><span class="hljs-number">4</span>ã€è·å– Set å¤§å°<br>print(names.length); <span class="hljs-regexp">//</span>æ‰“å°ï¼š<span class="hljs-number">2</span><br><br><span class="hljs-regexp">//</span><span class="hljs-number">5</span>ã€åˆ é™¤å…ƒç´ <br><span class="hljs-regexp">//</span>æ ¹æ®å…ƒç´ è¿›è¡Œåˆ é™¤ names:&#123;<span class="hljs-string">&quot;Dart&quot;</span>&#125;<br>names.remove(<span class="hljs-string">&quot;Flutter&quot;</span>);<br><br><span class="hljs-regexp">//</span><span class="hljs-number">6</span>ã€åˆ¤æ–­ Set æ˜¯å¦åŒ…å«æŒ‡å®šå…ƒç´ <br>names.contains(<span class="hljs-string">&quot;Dart&quot;</span>); <span class="hljs-regexp">//</span>true<br><br><span class="hljs-regexp">//</span><span class="hljs-number">7</span>ã€æ¸…ç©º Set æ‰€æœ‰å…ƒç´  names:&#123;&#125;<br>names.clear();<br></code></pre></td></tr></table></figure><h3 id="3-3ã€Map-é›†åˆ"><a href="#3-3ã€Map-é›†åˆ" class="headerlink" title="3.3ã€Map é›†åˆ"></a>3.3ã€Map é›†åˆ</h3><h4 id="3-3-1ã€å®šä¹‰"><a href="#3-3-1ã€å®šä¹‰" class="headerlink" title="3.3.1ã€å®šä¹‰"></a>3.3.1ã€å®šä¹‰</h4><p>1ï¼‰ã€Dart ä¸­ map ç±»å‹ï¼Œå°±æ˜¯ä¸€ç§å“ˆå¸Œç±»å‹æ•°æ®ï¼Œmap ç±»å‹çš„æ•°æ®éƒ½æ˜¯ç”± key å’Œ value ä¸¤ä¸ªå€¼ç»„æˆï¼Œkey æ˜¯å”¯ä¸€çš„ï¼Œvalue ä¸å¿…å”¯ä¸€ï¼Œè¯»å†™æ•°æ®éƒ½æ˜¯é€šè¿‡ key è¿›è¡Œï¼Œmap ä¹Ÿæ˜¯æ³›å‹ç±»å‹ï¼Œæ”¯æŒä»»æ„ç±»å‹æ•°æ®ï¼Œkey å’Œ value å¯ä»¥æ˜¯ä»»æ„ç±»å‹æ•°æ®</p><p>2ï¼‰ã€map ä¸»è¦æœ‰ä»¥ä¸‹å››ç§æ–¹å¼åˆå§‹åŒ–ï¼š</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-comment">//1ã€æ–¹å¼ä¸€ï¼šç›´æ¥ä»¥key, value çš„æ–¹å¼åˆå§‹åŒ–ä¸€ä¸ª map ç±»å‹å˜é‡ï¼Œ key å’Œ value éƒ½æ˜¯ String ç±»å‹</span><br><span class="hljs-keyword">var</span> map1 = &#123;<br>  <span class="hljs-comment">//æ ¼å¼  Key: Value</span><br>  <span class="hljs-string">&#x27;first&#x27;</span>: <span class="hljs-string">&#x27;partridge&#x27;</span>,<br>  <span class="hljs-string">&#x27;second&#x27;</span>: <span class="hljs-string">&#x27;turtledoves&#x27;</span>,<br>  <span class="hljs-string">&#x27;fifth&#x27;</span>: <span class="hljs-string">&#x27;golden rings&#x27;</span><br>&#125;;<br><br><span class="hljs-comment">//2ã€æ–¹å¼äºŒï¼šç›´æ¥é€šè¿‡ Map ç±»æ„é€ ä¸€ä¸ª map ç±»å‹å˜é‡, key ç±»å‹ä¸º String, value ç±»å‹ä¸º int</span><br><span class="hljs-keyword">var</span> map2 = <span class="hljs-built_in">Map</span>&lt;<span class="hljs-built_in">String</span>, <span class="hljs-built_in">int</span>&gt;();<br><br><span class="hljs-comment">//3ã€æ–¹å¼ä¸‰ï¼šå®šä¹‰ä¸€ä¸ª key ç±»å‹ä¸º String, value ç±»å‹ä¸º int çš„ç©º Map</span><br><span class="hljs-keyword">var</span> map3 = &lt;<span class="hljs-built_in">String</span>,<span class="hljs-built_in">int</span>&gt;&#123;&#125;<br><br><span class="hljs-comment">//4ã€æ–¹å¼å››ï¼šå®šä¹‰ä¸€ä¸ªç»•è¿‡ç¼–è¯‘æ£€æŸ¥çš„åŠ¨æ€ keyï¼Œvalue ç±»å‹ Map</span><br><span class="hljs-keyword">var</span> map4 = <span class="hljs-built_in">Map</span>(); <span class="hljs-comment">//ç­‰ä»·äºï¼švar map4 = &#123;&#125;;</span><br></code></pre></td></tr></table></figure><h4 id="3-3-2ã€å¸¸ç”¨-Api-ä»‹ç»"><a href="#3-3-2ã€å¸¸ç”¨-Api-ä»‹ç»" class="headerlink" title="3.3.2ã€å¸¸ç”¨ Api ä»‹ç»"></a>3.3.2ã€å¸¸ç”¨ Api ä»‹ç»</h4><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-regexp">//</span><span class="hljs-number">1</span>ã€é¦–å…ˆå®šä¹‰ä¸€ä¸ª map<br>var map = &#123;&#125;;<br><br><span class="hljs-regexp">//</span><span class="hljs-number">2</span>ã€å‘ map æ·»åŠ æ•°æ® map:&#123;<span class="hljs-string">&quot;key1&quot;</span>:<span class="hljs-string">&quot;value1&quot;</span>,<span class="hljs-string">&quot;key2&quot;</span>:<span class="hljs-string">&quot;value2&quot;</span>&#125;<br><span class="hljs-regexp">//</span>ä½¿ç”¨ [] æ“ä½œç¬¦è¯»å†™ map æ•°æ®ï¼Œè¯­æ³•ï¼šmapå˜é‡[key]<br>map[<span class="hljs-string">&quot;key1&quot;</span>] = <span class="hljs-string">&quot;value1&quot;</span>;<br>map[<span class="hljs-string">&quot;key2&quot;</span>] = <span class="hljs-string">&quot;value2&quot;</span>;<br><br><span class="hljs-regexp">//</span><span class="hljs-number">3</span>ã€æŸ¥è¯¢ mapï¼šä½¿ç”¨[]æ“ä½œç¬¦ï¼Œæ ¹æ® key æŸ¥è¯¢å¯¹åº”çš„ value å€¼ï¼Œå¦‚æœ key ä¸å­˜åœ¨åˆ™è¿”å› null<br>var v1 = map[<span class="hljs-string">&quot;key1&quot;</span>];<br>var v2 = map[<span class="hljs-string">&quot;key2&quot;</span>];<br><br><span class="hljs-regexp">//</span><span class="hljs-number">4</span>ã€æ›´æ–° map æ•°æ®ï¼šæ ¹æ® key æ›´æ–° map æ•°æ®å’Œæ·»åŠ  map æ•°æ®ç”¨æ³•ä¸€æ ·<br><span class="hljs-regexp">//</span>å¦‚æœ key å€¼ä¸å­˜åœ¨åˆ™æ·»åŠ ï¼Œå¦åˆ™æ›´æ–° key çš„æ•°æ®<br><span class="hljs-regexp">//m</span>ap:&#123;<span class="hljs-string">&quot;key1&quot;</span>:<span class="hljs-string">&quot;value1&quot;</span>,<span class="hljs-string">&quot;key2&quot;</span>:<span class="hljs-string">&quot;value2&quot;</span>&#125;<br>map[<span class="hljs-string">&quot;key2&quot;</span>] = <span class="hljs-string">&quot;erdai&quot;</span>;<br><br><span class="hljs-regexp">//</span><span class="hljs-number">5</span>ã€è·å– map å¤§å°<br>print(map.length); <span class="hljs-regexp">//</span>æ‰“å°ï¼š<span class="hljs-number">2</span><br><br><span class="hljs-regexp">//</span><span class="hljs-number">6</span>ã€éå† map<br>map.forEach((k, v) &#123;<br>  print(<span class="hljs-string">&#x27;$k $v&#x27;</span>);<br>&#125;);<br><br><span class="hljs-regexp">//</span><span class="hljs-number">7</span>ã€åˆ é™¤ map æ•°æ®ï¼šé€šè¿‡ remove å‡½æ•°å¯ä»¥åˆ é™¤æŒ‡å®šçš„ key æ•°æ®<br><span class="hljs-regexp">//m</span>ap:&#123;<span class="hljs-string">&quot;key2&quot;</span>:<span class="hljs-string">&quot;value2&quot;</span>&#125;<br>map.remove(<span class="hljs-string">&quot;key1&quot;</span>);<br><br><span class="hljs-regexp">//</span><span class="hljs-number">8</span>ã€æ¸…ç©ºæ‰€æœ‰ map æ•°æ® map:&#123;&#125;<br>map.clear();<br></code></pre></td></tr></table></figure><h2 id="å››ã€ç¨‹åºçš„é€»è¾‘æ§åˆ¶"><a href="#å››ã€ç¨‹åºçš„é€»è¾‘æ§åˆ¶" class="headerlink" title="å››ã€ç¨‹åºçš„é€»è¾‘æ§åˆ¶"></a>å››ã€ç¨‹åºçš„é€»è¾‘æ§åˆ¶</h2><p>è¿™ä¸ªç« èŠ‚ç›¸å¯¹ç®€å•ï¼Œæˆ‘ä»¬å°±ç®€å•ä¸¾ä¸ªä¾‹å­</p><h3 id="4-1ã€if-else"><a href="#4-1ã€if-else" class="headerlink" title="4.1ã€if-else"></a>4.1ã€if-else</h3><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-keyword">if</span> (isRaining()) &#123;<br>  <span class="hljs-regexp">//</span> ä»£ç <span class="hljs-number">1</span><br>&#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (isSnowing()) &#123;<br>  <span class="hljs-regexp">//</span> ä»£ç <span class="hljs-number">2</span><br>&#125; <span class="hljs-keyword">else</span> &#123;<br>  <span class="hljs-regexp">//</span> ä»£ç <span class="hljs-number">3</span><br>&#125;<br></code></pre></td></tr></table></figure><p>elseæ˜¯å¯é€‰çš„ï¼Œæ ¹æ®éœ€è¦ç»„åˆå³å¯</p><h3 id="4-2ã€for-i-å’Œ-for-in-å¾ªç¯"><a href="#4-2ã€for-i-å’Œ-for-in-å¾ªç¯" class="headerlink" title="4.2ã€for-i å’Œ for-in å¾ªç¯"></a>4.2ã€for-i å’Œ for-in å¾ªç¯</h3><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-regexp">//</span> å®šä¹‰ int æ•°ç»„<br>var list = [<span class="hljs-number">5</span>,<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">6</span>,<span class="hljs-number">3</span>];<br><br><span class="hljs-regexp">//</span><span class="hljs-number">1</span>ã€<span class="hljs-keyword">for</span>-i å¾ªç¯éå†æ•°ç»„<br><span class="hljs-keyword">for</span> (var i = <span class="hljs-number">0</span>; i &lt; list.length; i++) &#123;<br>  <span class="hljs-regexp">//</span> æ‰“å°æ•°ç»„å…ƒç´ <br>  print(list[i]); <br>&#125;<br><br><span class="hljs-regexp">//</span><span class="hljs-number">2</span>ã€<span class="hljs-keyword">for</span>-<span class="hljs-keyword">in</span> å¾ªç¯éå†æ•°ç»„å˜é‡ list<br><span class="hljs-keyword">for</span> (var v <span class="hljs-keyword">in</span> list) &#123;<br>  <span class="hljs-regexp">//</span> æ‰“å°æ•°ç»„å…ƒç´  v<br>  print(v); <br>&#125;<br><br><span class="hljs-regexp">//</span>æ‰“å°ç»“æœ<br><span class="hljs-number">5</span><br><span class="hljs-number">1</span><br><span class="hljs-number">2</span><br><span class="hljs-number">6</span><br><span class="hljs-number">3</span><br></code></pre></td></tr></table></figure><h3 id="4-3ã€switchè¯­å¥"><a href="#4-3ã€switchè¯­å¥" class="headerlink" title="4.3ã€switchè¯­å¥"></a>4.3ã€switchè¯­å¥</h3><p>1ï¼‰ã€switch è¯­å¥çš„ä½œç”¨è·Ÿ if è¯­å¥ç±»ä¼¼ï¼Œç”¨äºæ£€æµ‹å„ç§æ¡ä»¶æ˜¯å¦æˆç«‹ï¼Œç„¶åæ‰§è¡Œç›¸åº”åˆ†æ”¯çš„ä»£ç </p><p>2ï¼‰ã€switch æ”¯æŒæ£€æµ‹ intï¼ŒString ç±»å‹å˜é‡çš„æ£€æµ‹ï¼Œå½“ç„¶å¦‚æœä½ è‡ªå®šä¹‰çš„ç±»é‡è½½äº† &#x3D;&#x3D; æ“ä½œç¬¦ï¼Œä¹Ÿå¯ä»¥åœ¨ switch æ¡ä»¶ä¸­ä½¿ç”¨</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-regexp">//</span> æ¡ä»¶çŠ¶æ€å˜é‡<br>var command = <span class="hljs-string">&#x27;OPEN&#x27;</span>;<br><br>switch (command) &#123; <span class="hljs-regexp">//</span> éœ€è¦æ£€æµ‹çš„å˜é‡ <br>  case <span class="hljs-string">&#x27;CLOSED&#x27;</span>:  <span class="hljs-regexp">//</span>case è¯­å¥ç”¨äºè®¾ç½®æ£€æµ‹æ¡ä»¶<br>    executeClosed(); <span class="hljs-regexp">//</span> å¦‚æœ command = <span class="hljs-string">&#x27;CLOSED&#x27;</span>ï¼Œæ‰§è¡Œå½“å‰åˆ†æ”¯ä»£ç ã€‚<br>    <span class="hljs-keyword">break</span>; <span class="hljs-regexp">//</span> ç»“æŸå½“å‰åˆ†æ”¯æ‰§è¡Œé€»è¾‘<br>  case <span class="hljs-string">&#x27;PENDING&#x27;</span>:<br>    executePending();<br>    <span class="hljs-keyword">break</span>;<br>  case <span class="hljs-string">&#x27;APPROVED&#x27;</span>:<br>    executeApproved();<br>    <span class="hljs-keyword">break</span>;<br>  default: <span class="hljs-regexp">//</span> å¦‚æœä¸Šé¢çš„ case è¯­å¥éƒ½æ²¡æœ‰åŒ¹é…æˆåŠŸï¼Œåˆ™æ‰§è¡Œ default åˆ†æ”¯çš„é€»è¾‘ã€‚<br>    executeUnknown();<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="4-4ã€while-å’Œ-do-while-å¾ªç¯è¯­å¥"><a href="#4-4ã€while-å’Œ-do-while-å¾ªç¯è¯­å¥" class="headerlink" title="4.4ã€while å’Œ do-while å¾ªç¯è¯­å¥"></a>4.4ã€while å’Œ do-while å¾ªç¯è¯­å¥</h3><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-regexp">//</span><span class="hljs-number">1</span>ã€<span class="hljs-keyword">while</span> å¾ªç¯è¯­å¥ä¾‹å­<br>void main() &#123;<br>  <span class="hljs-regexp">//</span> å®šä¹‰ int æ•°ç»„<br>  var list = [<span class="hljs-number">5</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">6</span>, <span class="hljs-number">3</span>];<br><br>  <span class="hljs-regexp">//</span> å¾ªç¯éå†æ•°ç»„<br>  var i = <span class="hljs-number">0</span>;<br>  <span class="hljs-keyword">while</span> (i &lt; list.length) &#123;<br>    <span class="hljs-regexp">//</span> æ¡ä»¶ä¸º true åˆ™æ‰§è¡Œå¾ªç¯ä½“ä»£ç <br>    print(list[i]); <span class="hljs-regexp">//</span> æ‰“å°æ•°ç»„å…ƒç´ <br>    i++; <span class="hljs-regexp">//</span> æ•°ç»„ä¸‹æ ‡é€’å¢<br>  &#125;<br>&#125;<br><br><span class="hljs-regexp">//</span><span class="hljs-number">2</span>ã€<span class="hljs-keyword">do</span>-<span class="hljs-keyword">while</span> å¾ªç¯è¯­å¥ä¾‹å­<br>void main() &#123;<br>  <span class="hljs-regexp">//</span> å®šä¹‰ int æ•°ç»„<br>  var list = [<span class="hljs-number">5</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">6</span>, <span class="hljs-number">3</span>];<br><br>  <span class="hljs-regexp">//</span> å¾ªç¯éå†æ•°ç»„<br>  var i = <span class="hljs-number">0</span>;<br>  <span class="hljs-keyword">do</span> &#123;<br>    print(list[i]);<br>    i++;<br>  &#125; <span class="hljs-keyword">while</span> (i &lt; list.length); <span class="hljs-regexp">//</span> å…ˆæ‰§è¡Œå¾ªç¯ä½“ä»£ç åå†æ£€æµ‹å¾ªç¯æ¡ä»¶ï¼Œæ¡ä»¶ä¸º true åˆ™ç»§ç»­æ‰§è¡Œå¾ªç¯<br>&#125;<br><br><span class="hljs-regexp">//</span>æ‰“å°ç»“æœ<br><span class="hljs-number">5</span><br><span class="hljs-number">1</span><br><span class="hljs-number">2</span><br><span class="hljs-number">6</span><br><span class="hljs-number">3</span><br></code></pre></td></tr></table></figure><h2 id="äº”ã€é¢å‘å¯¹è±¡ç¼–ç¨‹"><a href="#äº”ã€é¢å‘å¯¹è±¡ç¼–ç¨‹" class="headerlink" title="äº”ã€é¢å‘å¯¹è±¡ç¼–ç¨‹"></a>äº”ã€é¢å‘å¯¹è±¡ç¼–ç¨‹</h2><p>Dart æ˜¯é¢å‘å¯¹è±¡ç¼–ç¨‹è¯­è¨€ï¼Œå¯¹è±¡éƒ½æ˜¯ç”±ç±»åˆ›å»ºçš„ï¼Œæ‰€æœ‰ç±»éƒ½æ˜¯ç”± Object ç±»æ´¾ç”Ÿå‡ºæ¥çš„å­ç±»ï¼Œé™¤äº† Object , æ‰€æœ‰ç±»åªæœ‰ä¸€ä¸ªçˆ¶ç±»ï¼ˆå³åªèƒ½ç»§æ‰¿ä¸€ä¸ªçˆ¶ç±»ï¼‰</p><p>å°½ç®¡ Dart è¯­è¨€ä¸­ä¸€ä¸ªç±»åªèƒ½ç»§æ‰¿ä¸€ä¸ªçˆ¶ç±»ï¼Œä½†æ˜¯ Dart è¯­è¨€æä¾›äº† mixin æœºåˆ¶ï¼Œå¯ä»¥å¤ç”¨å¤šä¸ªç±»ï¼Œè¾¾åˆ°ç±»ä¼¼å¤šç»§æ‰¿çš„æ•ˆæœ</p><h3 id="5-1ã€ç±»å’Œå¯¹è±¡"><a href="#5-1ã€ç±»å’Œå¯¹è±¡" class="headerlink" title="5.1ã€ç±»å’Œå¯¹è±¡"></a>5.1ã€ç±»å’Œå¯¹è±¡</h3><p>1ï¼‰ã€Dart æ²¡æœ‰ publicã€protected å’Œ private ç­‰æˆå‘˜è®¿é—®é™å®šç¬¦ã€‚é»˜è®¤æƒ…å†µä¸‹å±æ€§ï¼Œæ–¹æ³•ï¼Œç±»ç­‰éƒ½æ˜¯å…±æœ‰çš„ï¼Œç±»ä¼¼ Java çš„ publicã€‚å¦‚æœæƒ³è¦è¡¨ç¤ºç§æœ‰ï¼Œåˆ™ä»¥ä¸‹åˆ’çº¿ _ å¼€å¤´å»å‘½å</p><p>2ï¼‰ã€Dart ä¸­å®ä¾‹åŒ–å¯¹è±¡å’Œ Java ç±»ä¼¼ï¼Œnew å…³é”®å­—å¯å†™å¯ä¸å†™</p><p>3ï¼‰ã€å½“æˆ‘ä»¬åœ¨ç±»ä¸­åˆ›å»ºç§æœ‰å±æ€§æ—¶ï¼Œæˆ‘ä»¬åº”è¯¥ç»™ç§æœ‰å±æ€§æä¾› getter å’Œ setter æ–¹æ³•ä¾›å¤–ç•Œè®¿é—®ï¼š</p><p>get æ–¹æ³•è¯­æ³•æ ¼å¼ï¼š<strong>è¿”å›å€¼ç±»å‹ get æ–¹æ³•å { æ–¹æ³•ä½“ }</strong></p><p>set æ–¹æ³•è¯­æ³•æ ¼å¼ï¼š<strong>set æ–¹æ³•å ( å‚æ•° ) { æ–¹æ³•ä½“ }</strong></p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Person</span> </span>&#123;<br>  <span class="hljs-comment">// å®šä¹‰ç±»æˆå‘˜å±æ€§ï¼Œé»˜è®¤ç±»çš„æˆå‘˜å±æ€§å’Œæ–¹æ³•éƒ½æ˜¯å…±æœ‰çš„ï¼Œç±»ä¼¼ java çš„ public</span><br>  <span class="hljs-keyword">var</span> name;<br>  <span class="hljs-comment">// ä»¥ä¸‹åˆ’çº¿ ( _ ) å¼€å¤´å‘½åçš„å±æ€§ä»£è¡¨ç§æœ‰æˆå‘˜å±æ€§</span><br>  <span class="hljs-keyword">var</span> _age;<br><br>  <span class="hljs-comment">// è·Ÿç±»ååŒåçš„æ–¹æ³•ï¼Œä¸ºæ„é€ æ–¹æ³•</span><br>  <span class="hljs-comment">// è¿™é‡Œè‡ªå®šä¹‰äº†ä¸€ä¸ªæºå¸¦å‚æ•°çš„æ„é€ æ–¹æ³•ã€‚</span><br>  <span class="hljs-comment">// å¦‚æœæˆ‘ä»¬æ²¡æœ‰è‡ªå®šä¹‰æ„é€ æ–¹æ³•ï¼Œä¼šè‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªä¸å¸¦å‚æ•°çš„é»˜è®¤æ„é€ æ–¹æ³•</span><br>  Person(<span class="hljs-keyword">var</span> name, <span class="hljs-keyword">var</span> age) &#123;<br>    <span class="hljs-comment">// å› ä¸ºå‚æ•°åå’Œç±»å±æ€§ååŒåï¼Œå¯ä»¥ä½¿ç”¨thiså¼•ç”¨å½“å‰å¯¹è±¡</span><br>    <span class="hljs-keyword">this</span>.name = name;<br>    <span class="hljs-comment">// å¯ä»¥å¿½ç•¥thiså…³é”®å­—ï¼Œç›´æ¥å¼•ç”¨ç±»æˆå‘˜</span><br>    _age = age;<br>  &#125;<br>  <br>  <span class="hljs-comment">//ä¸º _age æä¾› getter å’Œ setter æ–¹æ³•</span><br>  <span class="hljs-built_in">int</span> <span class="hljs-keyword">get</span> age&#123;<br>    <span class="hljs-keyword">return</span> _age;<br>  &#125;<br>  <span class="hljs-comment">//getter æ–¹æ³•è¿˜å¯ä»¥ç®€åŒ–ä¸ºæ­¤å†™æ³•ï¼šint get age =&gt; _age;</span><br><br>  <span class="hljs-keyword">set</span> age(<span class="hljs-built_in">int</span> age)&#123;<br>    _age = age;<br>  &#125;<br><br>  <span class="hljs-comment">// å®šä¸€ä¸ª public çš„æ–¹æ³•</span><br>  <span class="hljs-built_in">String</span> greet(<span class="hljs-built_in">String</span> who) =&gt; <span class="hljs-string">&#x27;Hello, <span class="hljs-subst">$who</span>. I am <span class="hljs-subst">$name</span>, my age is <span class="hljs-subst">$_age</span> !&#x27;</span>;<br>&#125;<br><br><span class="hljs-keyword">void</span> main()&#123;<br>  <span class="hljs-keyword">var</span> person = Person(<span class="hljs-string">&quot;erdai&quot;</span>,<span class="hljs-number">18</span>);<br>  <span class="hljs-comment">//ä¸‹é¢è¿™å¥å°±æ˜¯è°ƒç”¨äº† age çš„ set æ–¹æ³•</span><br>  person.age = <span class="hljs-number">20</span>;<br>  <span class="hljs-keyword">var</span> greet = person.greet(<span class="hljs-string">&quot;lucy&quot;</span>);<br>  <span class="hljs-built_in">print</span>(greet);<br>&#125;<br><br><span class="hljs-comment">//æ‰“å°ç»“æœ</span><br>Hello, lucy. I am erdai, my age <span class="hljs-keyword">is</span> <span class="hljs-number">20</span> !<br></code></pre></td></tr></table></figure><h3 id="5-2ã€æ„é€ æ–¹æ³•"><a href="#5-2ã€æ„é€ æ–¹æ³•" class="headerlink" title="5.2ã€æ„é€ æ–¹æ³•"></a>5.2ã€æ„é€ æ–¹æ³•</h3><p>å¦‚æœæˆ‘ä»¬æ²¡æœ‰è‡ªå®šä¹‰ä¸€ä¸ªæ„é€ æ–¹æ³•ï¼Œä¼šè‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªä¸å¸¦å‚æ•°çš„é»˜è®¤æ„é€ æ–¹æ³•</p><figure class="highlight haxe"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs haxe"><span class="hljs-comment">// è¿™ä¸ªç±»ä¼šç”Ÿæˆé»˜è®¤çš„æ„é€ æ–¹æ³•</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Person</span> </span>&#123;<br>    <span class="hljs-keyword">String</span> name;<br>&#125;<br><br><span class="hljs-comment">// é€šè¿‡é»˜è®¤æ„é€ æ–¹æ³•å®ä¾‹åŒ–å¯¹è±¡</span><br><span class="hljs-keyword">var</span> p = Person();<br></code></pre></td></tr></table></figure><h4 id="5-2-1ã€è‡ªå®šä¹‰æ„é€ æ–¹æ³•"><a href="#5-2-1ã€è‡ªå®šä¹‰æ„é€ æ–¹æ³•" class="headerlink" title="5.2.1ã€è‡ªå®šä¹‰æ„é€ æ–¹æ³•"></a>5.2.1ã€è‡ªå®šä¹‰æ„é€ æ–¹æ³•</h4><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Point</span>&#123;<br>  <span class="hljs-keyword">var</span> x,y;<br>  <br>  Point(<span class="hljs-keyword">var</span> x,<span class="hljs-keyword">var</span> y)&#123;<br>    <span class="hljs-comment">// é€šè¿‡thisè®¿é—®æˆå‘˜å±æ€§ï¼Œå½“ç„¶ä¸€èˆ¬é™¤éå‡ºç°å‘½åå†²çªï¼Œå¦åˆ™å¯ä»¥å¿½ç•¥this</span><br>    <span class="hljs-keyword">this</span>.x = x;<br>    <span class="hljs-keyword">this</span>.y = y;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>å¯¹äºæ„é€ æ–¹æ³•ä¸­ï¼Œç®€å•çš„èµ‹å€¼æ“ä½œï¼ŒDartè¯­è¨€æä¾›äº†æ›´ç®€æ´çš„è¯­æ³•ï¼Œå¦‚ä¸‹ï¼š</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Point</span>&#123;<br>  <span class="hljs-keyword">var</span> x,y;<br><br>  <span class="hljs-comment">// ç›´æ¥å°†æ„é€ æ–¹æ³•çš„ç¬¬ä¸€ä¸ªå‚æ•°èµ‹å€¼ç»™this.x, ç¬¬äºŒä¸ªå‚æ•°èµ‹å€¼ç»™this.y</span><br>  Point(<span class="hljs-keyword">this</span>.x,<span class="hljs-keyword">this</span>.y);<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="5-2-2ã€åˆå§‹åŒ–å‚æ•°åˆ—è¡¨"><a href="#5-2-2ã€åˆå§‹åŒ–å‚æ•°åˆ—è¡¨" class="headerlink" title="5.2.2ã€åˆå§‹åŒ–å‚æ•°åˆ—è¡¨"></a>5.2.2ã€åˆå§‹åŒ–å‚æ•°åˆ—è¡¨</h4><p>Dart è¿˜ä¸ºæ„é€ æ–¹æ³•æä¾›äº† <strong>å‚æ•°åˆå§‹åŒ–åˆ—è¡¨</strong> çš„è¯­æ³•ï¼Œç”¨äºåˆå§‹åŒ–å¯¹è±¡å‚æ•°</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Point</span>&#123;<br>  <span class="hljs-keyword">var</span> x,y;<br><br>  <span class="hljs-comment">// å†’å· : åé¢çš„è¡¨è¾¾å¼å°±æ˜¯å‚æ•°åˆå§‹åŒ–åˆ—è¡¨ï¼Œæ¯ä¸ªè¡¨è¾¾å¼ç”¨é€—å·åˆ†éš”</span><br>  Point(<span class="hljs-keyword">var</span> x,<span class="hljs-keyword">var</span> y): <span class="hljs-keyword">this</span>.x = x,<span class="hljs-keyword">this</span>.y = y&#123;<br>    <span class="hljs-comment">// ä½¿ç”¨å‚æ•°åˆå§‹åŒ–åˆ—è¡¨åˆå§‹åŒ–å¯¹è±¡å±æ€§ï¼Œè¿™é‡Œå¦‚æœæ²¡æœ‰åˆ«çš„åˆå§‹åŒ–å·¥ä½œè¦åšï¼Œå¯ä»¥æ˜¯ç©ºçš„</span><br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="5-2-3ã€å‘½åæ„é€ æ–¹æ³•"><a href="#5-2-3ã€å‘½åæ„é€ æ–¹æ³•" class="headerlink" title="5.2.3ã€å‘½åæ„é€ æ–¹æ³•"></a>5.2.3ã€å‘½åæ„é€ æ–¹æ³•</h4><p>1ï¼‰ã€Dart å¯ä»¥ä½¿ç”¨å‘½åæ„é€ æ–¹æ³•è¯­æ³•ï¼Œåˆ›å»ºå¤šä¸ªæ„é€ æ–¹æ³•ï¼Œå‘½åæ„é€ æ–¹æ³•è¯­æ³•æ ¼å¼ï¼š <strong>ç±»å.æ„é€ æ–¹æ³•å(å‚æ•°åˆ—è¡¨)</strong></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Point</span>&#123;<br>  <span class="hljs-keyword">var</span> x,y;<br><br>  <span class="hljs-title class_">Point</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">x</span>,<span class="hljs-variable language_">this</span>.<span class="hljs-property">y</span>);<br><br>  <span class="hljs-comment">// å‘½åæ„é€ æ–¹æ³• namedConstructor</span><br>  <span class="hljs-title class_">Point</span>.<span class="hljs-title function_">namedConstructor</span>(<span class="hljs-params"></span>)&#123;<br>    x = <span class="hljs-number">0</span>;<br>    y = <span class="hljs-number">0</span>;<br>  &#125;<br>&#125;<br><br><span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span>(<span class="hljs-params"></span>)&#123;<br>  <span class="hljs-comment">// ä½¿ç”¨å‘½åæ„é€ æ–¹æ³•å®ä¾‹åŒ–å¯¹è±¡</span><br>  <span class="hljs-keyword">var</span> point = <span class="hljs-title class_">Point</span>.<span class="hljs-title function_">namedConstructor</span>();<br>&#125;<br></code></pre></td></tr></table></figure><p>ä¸Šé¢çš„ä¾‹å­ä¹Ÿå¯ä»¥æ”¹å†™ä¸ºï¼š</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Point</span>&#123;<br>  <span class="hljs-keyword">var</span> x,y;<br><br>  Point(<span class="hljs-keyword">this</span>.x,<span class="hljs-keyword">this</span>.y);<br>  <span class="hljs-comment">// å‘½åæ„é€ æ–¹æ³• namedConstructor</span><br>  <span class="hljs-comment">// è¿™é‡Œä½¿ç”¨å‚æ•°åˆå§‹åŒ–åˆ—è¡¨ï¼Œç›´æ¥é€šè¿‡ this è°ƒç”¨ä¸Šé¢çš„æ„é€ æ–¹æ³•ï¼Œä¼ å…¥ä¸¤ä¸ªå‚æ•° 0ï¼Œåˆå§‹åŒ–å¯¹è±¡</span><br>  Point.namedConstructor():<span class="hljs-keyword">this</span>(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>);<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="5-2-4ã€factory-æ„é€ æ–¹æ³•"><a href="#5-2-4ã€factory-æ„é€ æ–¹æ³•" class="headerlink" title="5.2.4ã€factory æ„é€ æ–¹æ³•"></a>5.2.4ã€factory æ„é€ æ–¹æ³•</h4><p>1ï¼‰ã€Dart æä¾›äº†ä¸€ä¸ªç‰¹æ®Šçš„æ„é€ æ–¹æ³•ï¼Œç±»ä¼¼è®¾è®¡æ¨¡å¼ä¸­çš„å·¥å‚æ¨¡å¼ï¼Œç”¨æ¥åˆ›å»ºå¯¹è±¡</p><p>2ï¼‰ã€factory æ„é€ æ–¹æ³•åªèƒ½è®¿é—®é™æ€å±æ€§å’Œé™æ€æˆå‘˜æ–¹æ³•ï¼Œå› æ­¤ä¸èƒ½è®¿é—® this å¼•ç”¨</p><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs arduino"><span class="hljs-comment">//1ã€å®šä¹‰ä¸ªæ—¥å¿—ç±»</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Logger</span> &#123;<br>  <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> name;<br>  <span class="hljs-type">bool</span> mute = <span class="hljs-literal">false</span>;<br><br>  <span class="hljs-comment">// å®šä¹‰ä¸€ä¸ªç§æœ‰çš„_cacheå±æ€§ï¼Œç”¨æ¥ä¿å­˜åˆ›å»ºå¥½çš„Loggerå¯¹è±¡</span><br>  <span class="hljs-type">static</span> <span class="hljs-keyword">final</span> Map&lt;<span class="hljs-type">String</span>, Logger&gt; _cache = &#123;&#125;;<br><br>  <span class="hljs-comment">// æ³¨æ„è¿™ä¸ªæ„é€ æ–¹æ³•ï¼Œå‰é¢ä½¿ç”¨äº†factoryå…³é”®å­—ä¿®é¥°ï¼Œè¿™ä»£è¡¨è¿™ä¸ªæ„é€ æ–¹æ³•æ˜¯ä¸€ä¸ªå·¥å‚æ„é€ æ–¹æ³•</span><br>  <span class="hljs-comment">// å·¥å‚æ„é€ æ–¹æ³•ä¸ä¼šæ¯æ¬¡éƒ½åˆ›å»ºä¸€ä¸ªæ–°çš„Loggerå¯¹è±¡</span><br>  <span class="hljs-function">factory <span class="hljs-title">Logger</span><span class="hljs-params">(<span class="hljs-type">String</span> name)</span> </span>&#123;<br>    <span class="hljs-comment">// æ ¹æ®nameåˆ¤æ–­ç¼“å­˜çš„Loggerå¯¹è±¡æ˜¯å¦å­˜åœ¨</span><br>    <span class="hljs-keyword">if</span> (_cache.<span class="hljs-built_in">containsKey</span>(name)) &#123;<br>      <span class="hljs-comment">// è¿”å›ç¼“å­˜çš„Loggerå¯¹è±¡</span><br>      <span class="hljs-keyword">return</span> _cache[name]!;<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>      <span class="hljs-comment">// å¦‚æœæ²¡æœ‰ç¼“å­˜ï¼Œåˆ™è°ƒç”¨å‘½åæ„é€ æ–¹æ³•_internalåˆ›å»ºä¸€ä¸ªLoggerå¯¹è±¡</span><br>      <span class="hljs-keyword">final</span> logger = Logger._internal(name);<br>      <span class="hljs-comment">// æ ¹æ®nameç¼“å­˜logger</span><br>      _cache[name] = logger;<br>      <span class="hljs-comment">// è¿”å›æ–°çš„Loggerå¯¹è±¡</span><br>      <span class="hljs-keyword">return</span> logger;<br>    &#125;<br>  &#125;<br><br>  <span class="hljs-comment">// æ³¨æ„è¿™ä¸ªæ˜¯ä¸€ä¸ªç§æœ‰çš„å‘½åæ„é€ æ–¹æ³•ã€‚</span><br>  Logger._internal(<span class="hljs-keyword">this</span>.name);<br><br>  <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">log</span><span class="hljs-params">(<span class="hljs-type">String</span> msg)</span> </span>&#123;<br>    <span class="hljs-keyword">if</span> (!mute) <span class="hljs-built_in">print</span>(msg);<br>  &#125;<br>&#125;<br><br><span class="hljs-comment">//2ã€æµ‹è¯•</span><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span>&#123;<br>  var logger = <span class="hljs-built_in">Logger</span>(<span class="hljs-string">&quot;erdai&quot;</span>);<br>  logger.<span class="hljs-built_in">log</span>(logger.name);<br>&#125;<br><br><span class="hljs-comment">//æ‰“å°ç»“æœ</span><br>erdai<br></code></pre></td></tr></table></figure><h3 id="5-3ã€ç»§æ‰¿å’Œå¤šæ€"><a href="#5-3ã€ç»§æ‰¿å’Œå¤šæ€" class="headerlink" title="5.3ã€ç»§æ‰¿å’Œå¤šæ€"></a>5.3ã€ç»§æ‰¿å’Œå¤šæ€</h3><h4 id="5-3-1ã€ç»§æ‰¿"><a href="#5-3-1ã€ç»§æ‰¿" class="headerlink" title="5.3.1ã€ç»§æ‰¿"></a>5.3.1ã€ç»§æ‰¿</h4><p>1ï¼‰ã€Dart é€šè¿‡ extend å…³é”®å­—ç»§æ‰¿ä¸€ä¸ªç±»ï¼Œå’Œ Java ç±»ä¼¼</p><p>2ï¼‰ã€å­ç±»ä¼šç»§æ‰¿çˆ¶ç±»å¯è§çš„å±æ€§å’Œæ–¹æ³•ï¼Œä¸ä¼šç»§æ‰¿æ„é€ æ–¹æ³•</p><p>3ï¼‰ã€å­ç±»èƒ½å¤Ÿå¤å†™çˆ¶ç±»çš„ getterï¼Œsetterï¼Œä»¥åŠæ™®é€šæ–¹æ³•ï¼Œä½¿ç”¨ @override è¡¨ç¤ºè¦†å†™</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Parent</span></span>&#123;<br>  <span class="hljs-built_in">String</span> name = <span class="hljs-string">&quot;&quot;</span>;<br>  <span class="hljs-built_in">int</span> age = <span class="hljs-number">0</span>;<br><br>  <span class="hljs-comment">//è®¡ç®—å±æ€§</span><br>  <span class="hljs-built_in">bool</span> <span class="hljs-keyword">get</span> adult =&gt; <span class="hljs-keyword">this</span>.age &gt; <span class="hljs-number">18</span>;<br><br>  <span class="hljs-comment">//ç§æœ‰å±æ€§ï¼Œå¯¹äºå­ç±»ä¸å¯è§</span><br>  <span class="hljs-built_in">String</span> _address = <span class="hljs-string">&quot;&quot;</span>;<br><br>  <span class="hljs-keyword">void</span> method()&#123;<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;Parent&#x27;</span>);<br>  &#125;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Children</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Parent</span></span>&#123;<br>  <br>  <span class="hljs-keyword">void</span> specificMethod()&#123;<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;Children specificMethod&#x27;</span>);<br>  &#125;<br>&#125;<br><br><span class="hljs-keyword">void</span> main()&#123;<br>  <span class="hljs-keyword">var</span> child = Children();<br>  <span class="hljs-comment">//è°ƒç”¨å­ç±»è‡ªå·±çš„æ–¹æ³•</span><br>  child.specificMethod();<br>  <span class="hljs-comment">//è®¿é—®çˆ¶ç±»çš„å±æ€§</span><br>  child.name = <span class="hljs-string">&quot;erdai&quot;</span>;<br>  child.age = <span class="hljs-number">18</span>;<br>  <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;<span class="hljs-subst">$&#123;child.name&#125;</span> <span class="hljs-subst">$&#123;child.age&#125;</span>&#x27;</span>);<br>  <span class="hljs-comment">//è°ƒç”¨çˆ¶ç±»çš„æ–¹æ³•</span><br>  child.method();<br>  <span class="hljs-comment">//è®¿é—®çˆ¶ç±»çš„è®¡ç®—å±æ€§</span><br>  <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;<span class="hljs-subst">$&#123;child.adult&#125;</span>&#x27;</span>);<br>&#125;<br><br><span class="hljs-comment">//æ‰“å°ç»“æœ</span><br>Children specificMethod<br>erdai <span class="hljs-number">18</span><br>Parent<br><span class="hljs-keyword">false</span><br></code></pre></td></tr></table></figure><h4 id="5-3-2ã€å¤šæ€"><a href="#5-3-2ã€å¤šæ€" class="headerlink" title="5.3.2ã€å¤šæ€"></a>5.3.2ã€å¤šæ€</h4><p>1ï¼‰ã€ç®€å•çš„ç†è§£ï¼šå¤šæ€å°±æ˜¯å°†å­ç±»çš„å¯¹è±¡èµ‹å€¼ç»™çˆ¶ç±»çš„å¼•ç”¨ï¼ŒåŒä¸€ä¸ªæ–¹æ³•è°ƒç”¨ä¼šæœ‰ä¸åŒçš„æ‰§è¡Œæ•ˆæœ</p><p>2ï¼‰ã€å¤šæ€çš„ä½“ç°ï¼šçˆ¶ç±»å®šä¹‰ä¸€ä¸ªæ–¹æ³•ï¼Œè®©ç»§æ‰¿å®ƒçš„å­ç±»å»å®ç°ï¼Œæ¯ä¸ªå­ç±»æœ‰ä¸åŒçš„è¡¨ç°</p><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs scala"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Animal</span></span>&#123;<br>  void animalType()&#123;<br><br>  &#125;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Dog</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Animal</span></span>&#123;<br><br>  <span class="hljs-meta">@override</span><br>  void animalType() &#123;<br>    print(&#x27;<span class="hljs-type">I</span> am dog&#x27;);<br>  &#125;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Pig</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Animal</span></span>&#123;<br><br>  <span class="hljs-meta">@override</span><br>  void animalType() &#123;<br>    print(&#x27;<span class="hljs-type">I</span> am pig&#x27;);<br>  &#125;<br>&#125;<br><br>void main()&#123;<br>  <span class="hljs-comment">//å­ç±»çš„å¯¹è±¡èµ‹å€¼ç»™çˆ¶ç±»çš„å¼•ç”¨</span><br>  <span class="hljs-type">Animal</span> animal1 = <span class="hljs-type">Dog</span>();<br>  <span class="hljs-type">Animal</span> animal2 = <span class="hljs-type">Pig</span>();<br>  <span class="hljs-comment">//åŒä¸€ä¸ªæ–¹æ³•è°ƒç”¨ä¼šæœ‰ä¸åŒçš„æ‰§è¡Œæ•ˆæœ</span><br>  animal1.animalType();<br>  animal2.animalType();<br>&#125;<br><br><span class="hljs-comment">//æ‰“å°ç»“æœ</span><br><span class="hljs-type">I</span> am dog<br><span class="hljs-type">I</span> am pig<br></code></pre></td></tr></table></figure><h3 id="5-4ã€æŠ½è±¡ç±»å’ŒæŠ½è±¡æ–¹æ³•"><a href="#5-4ã€æŠ½è±¡ç±»å’ŒæŠ½è±¡æ–¹æ³•" class="headerlink" title="5.4ã€æŠ½è±¡ç±»å’ŒæŠ½è±¡æ–¹æ³•"></a>5.4ã€æŠ½è±¡ç±»å’ŒæŠ½è±¡æ–¹æ³•</h3><p>1ï¼‰ã€æŠ½è±¡ç±»å°±æ˜¯ä¸èƒ½å®ä¾‹åŒ–çš„ç±»ï¼Œé€šè¿‡ abstract å…³é”®å­—å£°æ˜</p><p>2ï¼‰ã€æŠ½è±¡æ–¹æ³•å°±æ˜¯æ²¡æœ‰å®ç°çš„æ–¹æ³•ï¼ŒDart ä¸­çš„æŠ½è±¡æ–¹æ³•ä¸èƒ½ç”¨ abstract å£°æ˜ï¼ŒDart ä¸­æ²¡æœ‰æ–¹æ³•ä½“çš„æ–¹æ³•å°±ç§°ä¸ºæŠ½è±¡æ–¹æ³•</p><p>3ï¼‰ã€ç»§æ‰¿æŠ½è±¡ç±»ï¼Œå­ç±»å¿…é¡»è¦å®ç°æ‰€æœ‰æŠ½è±¡æ–¹æ³•ï¼Œå¦åˆ™ä¼šæŠ¥é”™</p><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs scala"><span class="hljs-comment">// ä½¿ç”¨ abstract å…³é”®å­—ä¿®é¥°çš„ç±»ï¼Œå°±æ˜¯æŠ½è±¡ç±»</span><br><span class="hljs-keyword">abstract</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Doer</span></span>&#123;<br>  <span class="hljs-comment">// æŠ½è±¡ç±»è·Ÿæ™®é€šç±»ä¸€æ ·ï¼Œå¯ä»¥å®šä¹‰æˆå‘˜å˜é‡ï¼Œæˆå‘˜æ–¹æ³•ã€‚</span><br>  <span class="hljs-type">String</span> name = <span class="hljs-string">&quot;&quot;</span>;<br>  <span class="hljs-comment">// å®šä¹‰ä¸ªæŠ½è±¡æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•æˆ‘ä»¬æ²¡æœ‰å®ç°å…·ä½“çš„åŠŸèƒ½</span><br>  void doSomething();<br>&#125;<br><br><span class="hljs-comment">// ç»§æ‰¿æŠ½è±¡ç±» Doer</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">EffectiveDoer</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Doer</span></span>&#123;<br>  <span class="hljs-comment">// å®ç°æŠ½è±¡ç±»çš„æŠ½è±¡æ–¹æ³•</span><br>  <span class="hljs-meta">@override</span><br>  void doSomething() &#123;<br>    print(&#x27;doSomething&#x27;);<br>  &#125;<br>&#125;<br><br>void main()&#123;<br>  <span class="hljs-keyword">var</span> doer = <span class="hljs-type">EffectiveDoer</span>();<br>  doer.doSomething();<br>  doer.name = <span class="hljs-string">&quot;erdai&quot;</span>;<br>  print(doer.name);<br>&#125;<br><br><span class="hljs-comment">//æ‰“å°ç»“æœ</span><br>doSomething<br>erdai<br></code></pre></td></tr></table></figure><h3 id="5-5ã€æ¥å£"><a href="#5-5ã€æ¥å£" class="headerlink" title="5.5ã€æ¥å£"></a>5.5ã€æ¥å£</h3><p>1ï¼‰ã€Dart ä¸­çš„æ¥å£æ²¡æœ‰ä½¿ç”¨ interface å…³é”®å­—å®šä¹‰ï¼Œè€Œæ˜¯æ™®é€šç±»å’ŒæŠ½è±¡ç±»éƒ½å¯ä»¥ä½œä¸ºæ¥å£è¢«å®ç°ã€‚ä½†æ˜¯ä¸€èˆ¬éƒ½æ˜¯ç”¨æŠ½è±¡ç±»æ¥å®šä¹‰æ¥å£</p><p>2ï¼‰ã€å­ç±»é€šè¿‡ implements æ¥å®ç°æ¥å£</p><p>3ï¼‰ã€é»˜è®¤æƒ…å†µæ¯ä¸€ä¸ªç±»éƒ½<strong>éšå«</strong>ä¸€ä¸ªåŒ…å«æ‰€æœ‰å…¬æœ‰æˆå‘˜ï¼ˆå±æ€§å’Œæ–¹æ³•ï¼‰çš„æ¥å£å®šä¹‰</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Fruit</span>&#123;<br>  <span class="hljs-comment">// åŒ…å«åœ¨éšå¼æ¥å£é‡Œé¢</span><br>  <span class="hljs-title class_">String</span> name = <span class="hljs-string">&quot;&quot;</span>;<br>  <br>  <span class="hljs-comment">// æ„é€ æ–¹æ³•ä¸åŒ…å«åœ¨éšå¼æ¥å£é‡Œé¢</span><br>  <span class="hljs-title class_">Fruit</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span>);<br>  <br>  <span class="hljs-comment">// åŒ…å«åœ¨éšå¼æ¥å£é‡Œé¢</span><br>  <span class="hljs-built_in">void</span> <span class="hljs-title function_">eat</span>();<br>&#125;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Apple</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Fruit</span>&#123;<br>  <span class="hljs-meta">@override</span><br>  <span class="hljs-title class_">String</span> name = <span class="hljs-string">&quot;è‹¹æœ&quot;</span>;<br><br>  <span class="hljs-meta">@override</span><br>  <span class="hljs-built_in">void</span> <span class="hljs-title function_">eat</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-title function_">print</span>(<span class="hljs-string">&#x27;åƒ$name&#x27;</span>);<br>  &#125;<br>&#125;<br><br><span class="hljs-built_in">void</span> <span class="hljs-title function_">main</span>(<span class="hljs-params"></span>)&#123;<br>  <span class="hljs-keyword">var</span> fruit = <span class="hljs-title class_">Apple</span>();<br>  fruit.<span class="hljs-title function_">eat</span>();<br>&#125;<br><br><span class="hljs-comment">//æ‰“å°ç»“æœ</span><br>åƒè‹¹æœ<br></code></pre></td></tr></table></figure><p><strong>æ³¨æ„</strong>ï¼šè™½ç„¶æ™®é€šç±»ä¹Ÿå¯ä»¥ä½œä¸ºæ¥å£å®ç°ï¼Œä½†æ˜¯ä¾ç„¶éœ€è¦å®ç°æ™®é€šç±»é‡Œé¢æ‰€æœ‰çš„å…¬æœ‰æˆå‘˜ï¼ˆå±æ€§å’Œæ–¹æ³•ï¼‰ï¼Œå› æ­¤å»ºè®®å¤§å®¶ä½¿ç”¨æŠ½è±¡ç±»æ¥ä½œä¸ºæ¥å£å®ç°ï¼Œå› ä¸ºæŠ½è±¡ç±»æœ¬æ¥å°±æ˜¯ç”¨æ¥å®šä¹‰ç»™å­ç±»å®ç°çš„</p><h2 id="å…­ã€ç©ºå®‰å…¨æ£€æŸ¥"><a href="#å…­ã€ç©ºå®‰å…¨æ£€æŸ¥" class="headerlink" title="å…­ã€ç©ºå®‰å…¨æ£€æŸ¥"></a>å…­ã€ç©ºå®‰å…¨æ£€æŸ¥</h2><p>1ï¼‰ã€Dart åœ¨ 2.12 ç‰ˆæœ¬å’Œ Flutter 2.0 ä¸­å¼•å…¥äº†ç©ºå®‰å…¨çš„æ–°ç‰¹æ€§ï¼Œåœ¨ç©ºå®‰å…¨ç‰ˆæœ¬ä¸‹ï¼Œè¿è¡Œæ—¶çš„ <strong>NPE (NullPointer Exception)</strong> å¼‚å¸¸è¢«æå‰åˆ°äº†ç¼–è¯‘æœŸ</p><p>2ï¼‰ã€åœ¨ç©ºå®‰å…¨æ¨å‡ºä¹‹å‰ï¼Œé™æ€ç±»å‹ç³»ç»Ÿå…è®¸æ‰€æœ‰çš„ç±»å‹å€¼ä¸º nullï¼Œå› ä¸º Null æ˜¯æ‰€æœ‰ç±»å‹çš„å­ç±»ã€‚è€Œåœ¨ç©ºå®‰å…¨æ¨å‡ºåï¼Œæ‰€æœ‰ç±»å‹é»˜è®¤ä¸ºä¸å¯ç©ºç±»å‹ï¼ŒNull ä¸å†æ˜¯æ‰€æœ‰ç±»çš„å­ç±»ï¼Œå®ƒå˜æˆäº†å’Œå…¶ä»–ç±»å‹å¹¶è¡Œçš„ç±»</p><p>3ï¼‰ã€Dart æ–°å¢äº†ä¸€äº›å…³é”®å­—ç”¨äºç©ºå®‰å…¨ï¼Œå¦‚ä¸‹ï¼š</p><table><thead><tr><th><strong>å…³é”®å­—</strong></th><th><strong>å«ä¹‰</strong></th><th>ç¤ºä¾‹</th></tr></thead><tbody><tr><td>?</td><td>å¯ç©º</td><td>int a?;</td></tr><tr><td>!</td><td>éç©º</td><td>int b &#x3D; a!;</td></tr><tr><td>late</td><td>å»¶è¿Ÿåˆå§‹åŒ–</td><td>late int a;</td></tr><tr><td>required</td><td>å¯é€‰å‚æ•°çš„ä¸å¯ç©º</td><td>{required int a}</td></tr></tbody></table><h3 id="6-1ã€ç©ºç±»å‹å£°æ˜ç¬¦-ï¼Ÿ"><a href="#6-1ã€ç©ºç±»å‹å£°æ˜ç¬¦-ï¼Ÿ" class="headerlink" title="6.1ã€ç©ºç±»å‹å£°æ˜ç¬¦ ï¼Ÿ"></a>6.1ã€<strong>ç©ºç±»å‹å£°æ˜ç¬¦ ï¼Ÿ</strong></h3><p>1ï¼‰ã€åœ¨ç±»å‹åé¢åŠ ä¸Š ï¼Ÿï¼Œè¡¨ç¤ºå¯ç©ºç±»å‹</p><p>2ï¼‰ã€ä½¿ç”¨ var å…³é”®å­—å®šä¹‰çš„å˜é‡ä¹Ÿæ˜¯å¯ç©ºç±»å‹</p><p>3ï¼‰ã€å¯ç©ºç±»å‹å˜é‡çš„è°ƒç”¨ï¼Œä½¿ç”¨ ?. æ“ä½œç¬¦ï¼Œå®ƒè¡¨ç¤ºå¦‚æœå½“å‰å¯¹è±¡ä¸ä¸º null åˆ™è°ƒç”¨ï¼Œä¸º null åˆ™ä»€ä¹ˆéƒ½ä¸åš</p><figure class="highlight axapta"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs axapta"><span class="hljs-comment">//1ã€åœ¨ç±»å‹åé¢åŠ ä¸Š ï¼Ÿï¼Œè¡¨ç¤ºå¯ç©ºç±»å‹</span><br><span class="hljs-keyword">void</span> main() &#123;<br>  <span class="hljs-comment">//å®šä¹‰ä¸€ä¸ª String çš„å¯ç©ºç±»å‹ï¼Œé»˜è®¤å€¼ä¸º null</span><br>  String? <span class="hljs-built_in">str</span>;<br>  <span class="hljs-comment">//ç¼–è¯‘æŠ¥çº¢ï¼Œå› ä¸ºå¯ç©ºç±»å‹éœ€è¦ä½¿ç”¨ ?. è°ƒç”¨</span><br>  <span class="hljs-comment">//æç¤ºï¼šThe property &#x27;length&#x27; can&#x27;t be unconditionally accessed because the receiver can be &#x27;null&#x27;.</span><br>  <span class="hljs-keyword">print</span>(<span class="hljs-built_in">str</span>.length); <br>&#125;<br><br><span class="hljs-comment">//2ã€ä½¿ç”¨ var å…³é”®å­—å®šä¹‰çš„å˜é‡ä¹Ÿæ˜¯å¯ç©ºç±»å‹</span><br><span class="hljs-keyword">void</span> main() &#123;<br>  <span class="hljs-comment">//å®šä¹‰ä¸€ä¸ªåŠ¨æ€çš„å¯ç©ºç±»å‹ strï¼Œé»˜è®¤å€¼ä¸º null</span><br>  <span class="hljs-built_in">var</span> <span class="hljs-built_in">str</span>;<br>  <span class="hljs-comment">//ä¸‹é¢è¿™å¥ä»£ç ä¼šç»•è¿‡ç¼–è¯‘å™¨æ£€æŸ¥ï¼Œä½†è¿è¡Œæ—¶ä¼šæŠ¥é”™ï¼šNoSuchMethodError: &#x27;length&#x27;</span><br>  <span class="hljs-keyword">print</span>(<span class="hljs-built_in">str</span>.length);<br>&#125;<br><br><span class="hljs-comment">//3ã€å¯ç©ºç±»å‹å˜é‡çš„è°ƒç”¨ï¼Œä½¿ç”¨ ?. æ“ä½œç¬¦ï¼Œå®ƒè¡¨ç¤ºå¦‚æœå½“å‰å¯¹è±¡ä¸ä¸º null åˆ™è°ƒç”¨ï¼Œä¸º null åˆ™ä»€ä¹ˆéƒ½ä¸åš</span><br><span class="hljs-keyword">void</span> main() &#123;<br>  String? str1;<br>  <span class="hljs-built_in">var</span> str2;<br>  <span class="hljs-keyword">print</span>(str1?.length);<br>  <span class="hljs-keyword">print</span>(str2?.length);<br>&#125;<br><span class="hljs-comment">//æ‰“å°ç»“æœ</span><br><span class="hljs-literal">null</span><br><span class="hljs-literal">null</span><br></code></pre></td></tr></table></figure><h3 id="6-2ã€éç©ºæ–­è¨€"><a href="#6-2ã€éç©ºæ–­è¨€" class="headerlink" title="6.2ã€éç©ºæ–­è¨€ !"></a>6.2ã€<strong>éç©ºæ–­è¨€ !</strong></h3><p>1ï¼‰ã€ä½¿ç”¨ ! å…³é”®å­—è¡¨ç¤ºå‘Šè¯‰ç¼–è¯‘å™¨è¿™æ˜¯ä¸€ä¸ªä¸å¯èƒ½ä¸ºç©ºçš„å˜é‡ã€‚å¦‚æœä¸ºç©ºï¼Œä½ å°±æŠ›å¼‚å¸¸</p><figure class="highlight processing"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs processing"><span class="hljs-built_in">String</span>? <span class="hljs-title function_">getName</span>() =&gt; <span class="hljs-string">&quot;erdai&quot;</span>;<br><br><span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span>() &#123;<br> <span class="hljs-built_in">String</span>? <span class="hljs-built_in">str</span> = <span class="hljs-title function_">getName</span>();<br> <span class="hljs-comment">//æ­¤æ—¶ä¼šç¼–è¯‘æŠ¥çº¢ï¼Œå› ä¸ºç¼–è¯‘å™¨æ— æ³•æ™ºèƒ½åˆ¤ç©º</span><br> <span class="hljs-comment">//print(str.length);</span><br> <span class="hljs-comment">//å› æ­¤æˆ‘ä»¬éœ€è¦ä½¿ç”¨ ! å…³é”®å­—</span><br> <span class="hljs-built_in">print</span>(<span class="hljs-built_in">str</span>!.<span class="hljs-property">length</span>);<br>&#125;<br><span class="hljs-comment">//æ‰“å°ç»“æœ</span><br><span class="hljs-number">5</span><br></code></pre></td></tr></table></figure><h3 id="6-3ã€late-å»¶è¿Ÿåˆå§‹åŒ–"><a href="#6-3ã€late-å»¶è¿Ÿåˆå§‹åŒ–" class="headerlink" title="6.3ã€late å»¶è¿Ÿåˆå§‹åŒ–"></a>6.3ã€<strong>late å»¶è¿Ÿåˆå§‹åŒ–</strong></h3><p>1ï¼‰ã€late å…³é”®å­—ä¼šå‘Šè¯‰ç¼–è¯‘å™¨ï¼šè¿™æ˜¯ä¸ªéç©ºå˜é‡ï¼Œæˆ‘ç¨åä¼šåˆå§‹åŒ–</p><figure class="highlight processing"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs processing"><span class="hljs-comment">//æ­¤æ—¶ä¼šç¼–è¯‘æŠ¥çº¢ï¼Œå› ä¸ºç¼–è¯‘å™¨ä¼šå‘Šè¯‰æˆ‘ä»¬éç©ºå˜é‡å¿…é¡»å…ˆåˆå§‹åŒ–</span><br><span class="hljs-comment">//String str;</span><br><span class="hljs-comment">//å› æ­¤æˆ‘ä»¬éœ€è¦ä½¿ç”¨ late å…³é”®å­—</span><br>late <span class="hljs-built_in">String</span> <span class="hljs-built_in">str</span>;<br><br><span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span>() &#123;<br>  <span class="hljs-built_in">str</span> = <span class="hljs-string">&quot;erdai&quot;</span>;<br>  <span class="hljs-built_in">print</span>(<span class="hljs-built_in">str</span>);<br>&#125;<br><span class="hljs-comment">//æ‰“å°ç»“æœ</span><br>erdai<br></code></pre></td></tr></table></figure><h3 id="6-4ã€required-å…³é”®å­—"><a href="#6-4ã€required-å…³é”®å­—" class="headerlink" title="6.4ã€required å…³é”®å­—"></a>6.4ã€<strong>required å…³é”®å­—</strong></h3><p>1ï¼‰ã€required å…³é”®å­—ä¸»è¦æ˜¯ç”¨æ¥æ ‡è®°å‘½åå‚æ•°ï¼Œåœ¨ä½¿ç”¨æ—¶ä¸€å®šè¦ç»™ä»–ä»¬èµ‹å€¼ï¼Œä½¿å¾—ä»–ä»¬ä¸ä¸ºç©º</p><p>2ï¼‰ã€ä½¿ç”¨ required ä¿®é¥°çš„å‚æ•°ä¸èƒ½æä¾›é»˜è®¤å€¼</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-keyword">void</span> optionFunction(<span class="hljs-keyword">var</span> value1,&#123;<span class="hljs-keyword">required</span> <span class="hljs-keyword">var</span> value2,<span class="hljs-keyword">var</span> value3 = <span class="hljs-number">3</span>&#125;)&#123;<br>  <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;<span class="hljs-subst">$value1</span> <span class="hljs-subst">$value2</span> <span class="hljs-subst">$value3</span>&#x27;</span>);<br>&#125; <br><br><span class="hljs-keyword">void</span> main() &#123;<br>  optionFunction(<span class="hljs-number">1</span>, value2: <span class="hljs-number">100</span>);<br>&#125;<br><br><span class="hljs-comment">//æ‰“å°ç»“æœ</span><br><span class="hljs-number">1</span> <span class="hljs-number">100</span> <span class="hljs-number">3</span><br></code></pre></td></tr></table></figure><h2 id="ä¸ƒã€æœ‰è¶£çš„è¿ç®—ç¬¦é‡è½½"><a href="#ä¸ƒã€æœ‰è¶£çš„è¿ç®—ç¬¦é‡è½½" class="headerlink" title="ä¸ƒã€æœ‰è¶£çš„è¿ç®—ç¬¦é‡è½½"></a>ä¸ƒã€æœ‰è¶£çš„è¿ç®—ç¬¦é‡è½½</h2><p>ä¸ Kotlin ç±»ä¼¼ï¼ŒDart çš„è¿ç®—ç¬¦é‡è½½å…è®¸æˆ‘ä»¬è®©ä»»æ„ä¸¤ä¸ªå¯¹è±¡è¿›è¡Œç›¸åŠ ï¼Œæˆ–è€…æ˜¯è¿›è¡Œå…¶ä»–æ›´å¤šçš„è¿ç®—æ“ä½œ</p><p>1ï¼‰ã€è¿ç®—ç¬¦é‡è½½ä½¿ç”¨çš„æ˜¯ operator å…³é”®å­—ï¼Œæˆ‘ä»¬åªéœ€è¦åœ¨æŒ‡å®šè¿ç®—ç¬¦å‰é¢åŠ ä¸Š operator å…³é”®å­—ï¼Œå°±å¯ä»¥å®ç°è¿ç®—ç¬¦é‡è½½çš„åŠŸèƒ½äº†ï¼ŒDart æ”¯æŒçš„é‡è½½è¿ç®—ç¬¦å¦‚ä¸‹ï¼š</p><figure class="highlight bnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bnf"><span class="hljs-attribute">&lt;   +   |   []</span><br><span class="hljs-attribute">&gt;</span>   /   ^   []=<br><span class="hljs-attribute">&lt;=  ~/  &amp;   ~</span><br><span class="hljs-attribute">&gt;</span>=  *   <span class="hljs-attribute">&lt;&lt;  ==</span><br><span class="hljs-attribute">â€“   %   &gt;</span>&gt;<br></code></pre></td></tr></table></figure><p>2ï¼‰ã€é‡è½½è¿ç®—ç¬¦çš„è¯­æ³•æ ¼å¼å¦‚ä¸‹ï¼š</p><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs arduino">å‡½æ•°è¿”å›å€¼ <span class="hljs-keyword">operator</span> è¿ç®—ç¬¦(è¿ç®—ç¬¦å‚æ•°) &#123;<br>    <span class="hljs-comment">// å®ç°è¿ç®—ç¬¦é‡è½½é€»è¾‘</span><br>&#125;<br></code></pre></td></tr></table></figure><p>ä¸‹é¢æˆ‘ä»¬å°±æ¥å®è·µä¸€ä¸‹ï¼š</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">class</span> <span class="hljs-type">Money</span>&#123;<br>  <span class="hljs-type">int</span> <span class="hljs-keyword">value</span> = <span class="hljs-number">0</span>;<br><br>  <span class="hljs-type">Money</span>(this.<span class="hljs-keyword">value</span>);<br><br>  //é‡è½½ + å·è¿ç®—ç¬¦, ä¸¤ä¸ª <span class="hljs-type">Money</span> å¯¹è±¡ç›¸åŠ ,ç„¶åè¿”å›ä¸€ä¸ªæ–°çš„ <span class="hljs-type">Money</span> å¯¹è±¡<br>  <span class="hljs-type">Money</span> <span class="hljs-keyword">operator</span> +(<span class="hljs-type">Money</span> <span class="hljs-type">money</span>)&#123;<br>    var sum = <span class="hljs-keyword">value</span> + <span class="hljs-type">money</span>.<span class="hljs-keyword">value</span>;<br>    <span class="hljs-keyword">return</span> <span class="hljs-type">Money</span>(sum);<br>  &#125;<br>&#125;<br><br><span class="hljs-type">void</span> main() &#123;<br>  var money1 = <span class="hljs-type">Money</span>(<span class="hljs-number">100</span>);<br>  var money2 = <span class="hljs-type">Money</span>(<span class="hljs-number">200</span>);<br>  //ä¸¤ä¸ªå¯¹è±¡ç›¸åŠ <br>  var money3 = money1 + money2;<br>  print(money3.<span class="hljs-keyword">value</span>);<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="å…«ã€-mixin-æ··å…¥"><a href="#å…«ã€-mixin-æ··å…¥" class="headerlink" title="å…«ã€ mixin æ··å…¥"></a>å…«ã€ mixin æ··å…¥</h2><p>1ï¼‰ã€å‰é¢è¯´åˆ° Dart è¯­è¨€çš„ç±»æ˜¯å•ç»§æ‰¿çš„ï¼Œå¦‚æœæˆ‘ä»¬æƒ³è¦å®ç°ç±»ä¼¼å¤šç»§æ‰¿çš„æ•ˆæœå¯ä»¥ä½¿ç”¨ mixin æœºåˆ¶ï¼Œåˆå«æ··å…¥æœºåˆ¶ï¼Œä¾‹å¦‚æŠŠç±» A æ··å…¥åˆ°ç±» B ä¸­ï¼Œé‚£ä¹ˆç±» B å°±æ‹¥æœ‰äº†ç±» A çš„æˆå‘˜ï¼Œè·Ÿç»§æ‰¿çš„ç‰¹æ€§éå¸¸ç›¸ä¼¼</p><p>2ï¼‰ã€å®šä¹‰ä¸€ä¸ªå¯ä»¥è¢« mixin çš„ç±»ï¼Œä½¿ç”¨ mixin å…³é”®å­—ä»£æ›¿ class å…³é”®å­—å³å¯</p><p>3ï¼‰ã€ç»§æ‰¿è¢« mixin çš„ç±»ï¼Œä½¿ç”¨ with å…³é”®å­—ï¼Œå¦‚æœæœ‰å¤šä¸ªï¼Œä¸­é—´ç”¨ , éš”å¼€</p><p>4ï¼‰ã€è¢« mixin çš„ç±»åªèƒ½ç»§æ‰¿è‡ª Objectï¼Œä¸èƒ½ç»§æ‰¿å…¶ä»–ç±»ï¼Œä¸”ä¸èƒ½æœ‰æ„é€ æ–¹æ³•</p><p>5ï¼‰ã€ä½¿ç”¨ on å…³é”®å­—å¯ä»¥æŒ‡å®šå“ªäº›ç±»å¯ä»¥ä½¿ç”¨è¯¥ mixin ç±»ï¼Œå¦‚æœæœ‰å¤šä¸ªï¼Œä¸­é—´ç”¨ , éš”å¼€</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><code class="hljs angelscript"><span class="hljs-comment">//1ã€å®šä¹‰ä¸€ä¸ªå¯ä»¥è¢« mixin çš„ç±»ï¼Œä½¿ç”¨ mixin å…³é”®å­—ä»£æ›¿ class å…³é”®å­—å³å¯</span><br><span class="hljs-comment">//2ã€ç»§æ‰¿è¢« mixin çš„ç±»ï¼Œä½¿ç”¨ with å…³é”®å­—ï¼Œå¦‚æœæœ‰å¤šä¸ªï¼Œä¸­é—´ç”¨ , éš”å¼€</span><br><span class="hljs-keyword">mixin</span> A&#123;<br>  <span class="hljs-built_in">void</span> getA()&#123;<br>    print(<span class="hljs-string">&#x27;A&#x27;</span>);<br>  &#125;<br>&#125;<br><br><span class="hljs-keyword">mixin</span> B&#123;<br>  <span class="hljs-built_in">void</span> getB()&#123;<br>    print(<span class="hljs-string">&#x27;B&#x27;</span>);<br>  &#125;<br>&#125;<br><br><span class="hljs-keyword">class</span> <span class="hljs-symbol">C</span>&#123;<br>  <span class="hljs-built_in">void</span> getC()&#123;<br>    print(<span class="hljs-string">&#x27;C&#x27;</span>);<br>  &#125;<br>&#125;<br><br><span class="hljs-keyword">class</span> <span class="hljs-symbol">CC</span> <span class="hljs-symbol">extends</span> <span class="hljs-symbol">C</span> <span class="hljs-symbol">with</span> <span class="hljs-symbol">A,<span class="hljs-symbol">B</span></span>&#123;&#125;<br><br><span class="hljs-built_in">void</span> main() &#123;<br>  var cc = CC();<br>  cc.getA();<br>  cc.getB();<br>  cc.getC();<br>  print(cc <span class="hljs-keyword">is</span> A);<br>  print(cc <span class="hljs-keyword">is</span> B);<br>  print(cc <span class="hljs-keyword">is</span> C);<br>&#125;<br><span class="hljs-comment">//æ‰“å°ç»“æœ</span><br>A<br>B<br>C<br><span class="hljs-literal">true</span><br><span class="hljs-literal">true</span><br><span class="hljs-literal">true</span><br>  <br><span class="hljs-comment">//3ã€è¢« mixin çš„ç±»åªèƒ½ç»§æ‰¿è‡ª Objectï¼Œä¸èƒ½ç»§æ‰¿å…¶ä»–ç±»ï¼Œä¸”ä¸èƒ½æœ‰æ„é€ æ–¹æ³•</span><br><span class="hljs-keyword">class</span> <span class="hljs-symbol">D</span> &#123;&#125;<br><br><span class="hljs-comment">//ç¼–è¯‘æŠ¥é”™ï¼Œmixin ç±»ä¸èƒ½ç»§æ‰¿å…¶ä»–ç±»ï¼Œåªèƒ½ç»§æ‰¿è‡ª Object</span><br><span class="hljs-keyword">mixin</span> E extends D&#123;<br>   <span class="hljs-comment">//ç¼–è¯‘æŠ¥é”™ï¼Œmixin ç±»ä¸èƒ½æœ‰æ„é€ æ–¹æ³•</span><br>   E();<br>&#125;<br><br><span class="hljs-comment">//4ã€ä½¿ç”¨ on å…³é”®å­—å¯ä»¥æŒ‡å®šå“ªäº›ç±»å¯ä»¥ä½¿ç”¨è¯¥ mixin ç±»</span><br><span class="hljs-keyword">class</span> <span class="hljs-symbol">F</span>&#123;&#125;<br><br><span class="hljs-keyword">mixin</span> G on F&#123;&#125;<br><br><span class="hljs-comment">//class I with G&#123;&#125; //ç¼–è¯‘æŠ¥é”™ï¼šmixin ç±» G æ²¡æœ‰æŒ‡å®š I å¯ä»¥ä½¿ç”¨</span><br><span class="hljs-keyword">class</span> <span class="hljs-symbol">I</span> <span class="hljs-symbol">extends</span> <span class="hljs-symbol">F</span> <span class="hljs-symbol">with</span> <span class="hljs-symbol">G</span>&#123;&#125; <span class="hljs-comment">//ç¼–è¯‘é€šè¿‡ï¼Œç»§æ‰¿ F é—´æ¥çš„ä½¿ç”¨ mixin ç±» G</span><br></code></pre></td></tr></table></figure><h2 id="ä¹ã€Dart-æ³›å‹"><a href="#ä¹ã€Dart-æ³›å‹" class="headerlink" title="ä¹ã€Dart æ³›å‹"></a>ä¹ã€Dart æ³›å‹</h2><p>æ³›å‹ç¼–ç¨‹æœºåˆ¶æœ€ä¸»è¦çš„ç›®çš„æ˜¯ä¸ºäº†ä»£ç å¤ç”¨ï¼Œé¿å…ç±»å‹è½¬æ¢å¼‚å¸¸ã€‚å¦‚æœä½ å¯¹ Java ï¼ŒKotlin æ³›å‹å¾ˆç†Ÿæ‚‰ï¼Œä½ ä¼šè§‰å¾— Dart æ³›å‹éå¸¸ç®€å•ã€‚å¯¹ Java ï¼ŒKotlin æ³›å‹è¿˜ä¸ç†Ÿæ‚‰çš„ï¼Œçœ‹æˆ‘è¿™ç¯‡æ–‡ç« <a href="https://juejin.cn/post/6950042154496425992">ä¼ é€é—¨</a></p><p>1ï¼‰ã€Dart ä¸­æ³›å‹ä¸»è¦æœ‰ä»¥ä¸‹ä¸‰ç§ä½¿ç”¨ï¼š</p><p>1ã€æ³›å‹ç±»</p><p>2ã€æ³›å‹æ¥å£</p><p>3ã€é™åˆ¶æ³›å‹ç±»å‹</p><h3 id="9-1ã€æ³›å‹ç±»å’Œæ³›å‹æ¥å£"><a href="#9-1ã€æ³›å‹ç±»å’Œæ³›å‹æ¥å£" class="headerlink" title="9.1ã€æ³›å‹ç±»å’Œæ³›å‹æ¥å£"></a>9.1ã€æ³›å‹ç±»å’Œæ³›å‹æ¥å£</h3><p>1ï¼‰ã€æˆ‘ä»¬å®šä¹‰ä¸€ä¸ªç±»ï¼Œæˆ–è€…æ¥å£çš„æ—¶å€™ï¼Œåœ¨ç±»ååé¢å¢åŠ æ³›å‹å‚æ•°ï¼Œå°±æ˜¯ä¸ºè¿™ä¸ªç±»æˆ–æ¥å£æ·»åŠ äº†ä¸€ä¸ªæ³›å‹</p><p>2ï¼‰ã€æ³›å‹è¯­æ³•æ ¼å¼ï¼š<code>&lt;T&gt;</code> ï¼Œå¤šä¸ªæ³›å‹ä¹‹é—´ç”¨ , éš”å¼€ï¼š&lt;T,K&gt;</p><p>3ï¼‰ã€æ³›å‹å‚æ•°çš„å‘½åå¯ä»¥éšä¾¿å–ï¼Œä½†æ˜¯æˆ‘ä»¬ä¸€èˆ¬ä¹ æƒ¯ä½¿ç”¨å¤§å†™å­—æ¯ä»£è¡¨æ³›å‹å‚æ•°</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">//ä¸€ã€æ³›å‹ç±»</span><br><span class="hljs-comment">//1ã€å®šä¹‰æ³›å‹ç±»</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">GenericClass</span>&lt;T&gt;&#123;<br><br>  T? name;<br><br>  <span class="hljs-title class_">GenericClass</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span>);<br><br>  <span class="hljs-built_in">void</span> <span class="hljs-title function_">setName</span>(<span class="hljs-params">T? value</span>)&#123;<br>    name = value;<br>  &#125;<br><br>  T? <span class="hljs-title function_">getName</span>(<span class="hljs-params"></span>)&#123;<br>    <span class="hljs-keyword">return</span> name;<br>  &#125;<br>&#125;<br><br><span class="hljs-comment">//2ã€æ³›å‹ç±»ä½¿ç”¨</span><br><span class="hljs-built_in">void</span> <span class="hljs-title function_">main</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">var</span> genericClass = <span class="hljs-title class_">GenericClass</span>&lt;<span class="hljs-title class_">String</span>&gt;(<span class="hljs-string">&quot;&quot;</span>);<br>  genericClass.<span class="hljs-title function_">setName</span>(<span class="hljs-string">&quot;erdai&quot;</span>);<br>  <span class="hljs-title function_">print</span>(genericClass.<span class="hljs-title function_">getName</span>());<br>&#125;<br><br><span class="hljs-comment">//3ã€æ‰“å°ç»“æœ</span><br>erdai<br>  <br><span class="hljs-comment">//äºŒã€æ³›å‹æ¥å£</span><br><span class="hljs-comment">//1ã€å®šä¹‰æ³›å‹æ¥å£</span><br><span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">GenericInterface</span>&lt;K,V&gt;&#123;<br>  <span class="hljs-built_in">void</span> <span class="hljs-title function_">setKeyValue</span>(K key,V value);<br>&#125;<br><br><span class="hljs-comment">//2ã€å®šä¹‰æ³›å‹æ¥å£å®ç°ç±»</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">GenericInterfaceImpl</span>&lt;K,V&gt; <span class="hljs-keyword">implements</span> <span class="hljs-title class_">GenericInterface</span>&lt;K,V&gt;&#123;<br><br>  <span class="hljs-keyword">var</span> map = &#123;&#125;;<br><br>  <span class="hljs-meta">@override</span><br>  <span class="hljs-built_in">void</span> <span class="hljs-title function_">setKeyValue</span>(<span class="hljs-params">K key, V value</span>) &#123;<br>    map[key] = value;<br>  &#125;<br>&#125;<br><br><span class="hljs-comment">//3ã€æ³›å‹æ¥å£ä½¿ç”¨</span><br><span class="hljs-built_in">void</span> <span class="hljs-title function_">main</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">var</span> impl = <span class="hljs-title class_">GenericInterfaceImpl</span>&lt;<span class="hljs-title class_">String</span>,int&gt;();<br>  impl.<span class="hljs-title function_">setKeyValue</span>(<span class="hljs-string">&quot;erdai&quot;</span>, <span class="hljs-number">666</span>);<br>  impl.<span class="hljs-property">map</span>.<span class="hljs-title function_">forEach</span>((key, value) &#123;<br>    <span class="hljs-title function_">print</span>(<span class="hljs-string">&#x27;$key $value&#x27;</span>);<br>  &#125;);<br>&#125;<br><br><span class="hljs-comment">//4ã€æ‰“å°ç»“æœ</span><br>erdai <span class="hljs-number">666</span><br></code></pre></td></tr></table></figure><h3 id="9-2ã€é™åˆ¶æ³›å‹ç±»å‹"><a href="#9-2ã€é™åˆ¶æ³›å‹ç±»å‹" class="headerlink" title="9.2ã€é™åˆ¶æ³›å‹ç±»å‹"></a>9.2ã€é™åˆ¶æ³›å‹ç±»å‹</h3><p>1ï¼‰ã€é™åˆ¶æ³›å‹å‚æ•°ç±»å‹è¯­æ³•æ ¼å¼ï¼š&lt;æ³›å‹å‚æ•° extends çˆ¶ç±»&gt;</p><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><code class="hljs scala"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">BaseClass</span></span>&#123;<br><br>  void baseMethod()&#123;<br>    print(&#x27;<span class="hljs-type">BaseClass</span> baseMethod...&#x27;);<br>  &#125;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Child</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">BaseClass</span></span>&#123;<br>  <span class="hljs-meta">@override</span><br>  void baseMethod() &#123;<br>    print(&#x27;<span class="hljs-type">Child</span> baseMethod&#x27;);<br>  &#125;<br>&#125;<br><br><span class="hljs-comment">//T ç±»å‹å¿…é¡»æ˜¯ BaseClass æˆ–è€…å…¶å­ç±»</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Foo&lt;T</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">BaseClass&gt;</span></span>&#123;<br>  <span class="hljs-type">T</span>? t;<br>  <br>  <span class="hljs-type">Foo</span>(<span class="hljs-keyword">this</span>.t);<br><br>  void fooTest()&#123;<br>    t?.baseMethod();<br>  &#125;<br>&#125;<br><br>void main()&#123;<br>  <span class="hljs-comment">//1ã€ä½¿ç”¨çˆ¶ç±» BaseClass ä½œä¸ºæ³›å‹å‚æ•°æ˜¯å…è®¸çš„</span><br>  <span class="hljs-keyword">var</span> baseClass = <span class="hljs-type">BaseClass</span>();<br>  <span class="hljs-keyword">var</span> foo1 = <span class="hljs-type">Foo</span>&lt;<span class="hljs-type">BaseClass</span>&gt;(baseClass);<br>  foo1.fooTest();<br>  <br>  <span class="hljs-comment">//2ã€ä½¿ç”¨å­ç±» Child ä½œä¸ºæ³›å‹å‚æ•°</span><br>  <span class="hljs-keyword">var</span> childClass = <span class="hljs-type">Child</span>();<br>  <span class="hljs-keyword">var</span> foo2 = <span class="hljs-type">Foo</span>&lt;<span class="hljs-type">Child</span>&gt;(childClass);<br>  foo2.fooTest();<br><br>  <span class="hljs-comment">//3ã€å¦‚æœä¸ä¼ å…¥ä»»ä½•æ³›å‹å‚æ•°ï¼Œé»˜è®¤ä½¿ç”¨çˆ¶ç±» BaseClass ä½œä¸ºæ³›å‹å‚æ•°</span><br>  <span class="hljs-keyword">var</span> foo3 = <span class="hljs-type">Foo</span>(baseClass);<br>  foo3.fooTest();<br>&#125;<br><br><span class="hljs-comment">//æ‰“å°ç»“æœ</span><br><span class="hljs-type">BaseClass</span> baseMethod...<br><span class="hljs-type">Child</span> baseMethod<br><span class="hljs-type">BaseClass</span> baseMethod...<br></code></pre></td></tr></table></figure><h2 id="åã€Dart-Import-å¯¼å…¥åŒ…"><a href="#åã€Dart-Import-å¯¼å…¥åŒ…" class="headerlink" title="åã€Dart Import å¯¼å…¥åŒ…"></a>åã€Dart Import å¯¼å…¥åŒ…</h2><p>åœ¨æ—¥å¸¸å¼€å‘ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸éœ€è¦å¯¼å…¥æˆ‘ä»¬çš„æœ¬åœ°æ¨¡å—æˆ–è€…ç¬¬ä¸‰æ–¹å¼€æºåŒ…ã€‚Dart ä¸­ä¸»è¦é€šè¿‡ import æŒ‡ä»¤å¯¼å…¥åŒ…</p><h3 id="10-1ã€å¯¼å…¥å†…ç½®åŒ…"><a href="#10-1ã€å¯¼å…¥å†…ç½®åŒ…" class="headerlink" title="10.1ã€å¯¼å…¥å†…ç½®åŒ…"></a>10.1ã€å¯¼å…¥å†…ç½®åŒ…</h3><p>1ï¼‰ã€Dart å†…ç½®äº†ä¸€äº›å¸¸ç”¨çš„åŒ…ï¼Œè¿™äº›å†…ç½®çš„åŒ…ä¼šéšç€ Dart sdk ä¸€èµ·å®‰è£…åœ¨æœ¬åœ°</p><p>2ï¼‰ã€å¯¼å…¥å†…ç½®åŒ…ä½¿ç”¨ dart: ä½œä¸ºè·¯å¾„å‰ç¼€</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">// å¯¼å…¥å†…ç½® math åŒ…ï¼Œä½¿ç”¨ dart: ä½œä¸ºå‰ç¼€ã€‚</span><br><span class="hljs-comment">// math åŒ…ä¸»è¦æä¾›ä¸€äº›æ•°å­¦ç›¸å…³çš„å‡½æ•°ï¼Œä¾‹å¦‚ï¼Œæ­£å¼¦å‡½æ•°ã€æ±‚æœ€å¤§å€¼å‡½æ•°ç­‰ç­‰</span><br><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;dart:math&#x27;</span>;<br><br><span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-comment">// è°ƒç”¨ math åŒ…ä¸­çš„ max å‡½æ•°ï¼Œæ±‚ä¸¤ä¸ªæ•°ä¸­çš„æœ€å¤§å€¼ã€‚</span><br>  <span class="hljs-keyword">var</span> a = <span class="hljs-title function_">max</span>(<span class="hljs-number">1</span>,<span class="hljs-number">100</span>);<br>  <span class="hljs-title function_">print</span>(a); <span class="hljs-comment">//æ‰“å° 100</span><br>&#125;<br></code></pre></td></tr></table></figure><h3 id="10-2ã€åŒ…çš„åˆ«å"><a href="#10-2ã€åŒ…çš„åˆ«å" class="headerlink" title="10.2ã€åŒ…çš„åˆ«å"></a>10.2ã€åŒ…çš„åˆ«å</h3><p>é»˜è®¤æƒ…å†µè°ƒç”¨åŒ…ä¸­çš„å‡½æ•°æˆ–è€…ç±»ï¼Œä¸éœ€è¦åŒ…åä½œä¸ºå‰ç¼€ï¼Œä¸Šé¢è°ƒç”¨äº† math åŒ…ä¸­çš„ max å‡½æ•°ï¼Œç›´æ¥ä½¿ç”¨åŒ…ä¸­çš„å‡½æ•°åã€‚ä½†æ˜¯è¿™æ ·ä¼šå­˜åœ¨å‘½åå†²çªçš„å¯èƒ½æ€§ï¼Œå¦‚æœå¯¼å…¥çš„ä¸¤ä¸ªåŒ…ï¼ŒåŒ…å«äº†åŒåçš„ç±»æˆ–è€…å‡½æ•°ï¼Œå°±ä¼šå‡ºç°å‘½åå†²çªï¼Œå› æ­¤æä¾›åˆ«åæœºåˆ¶</p><p>1ï¼‰ã€ä½¿ç”¨ as å…³é”®å­—æŒ‡å®šåŒ…çš„åˆ«å</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">//ä½¿ç”¨ as å…³é”®å­—ï¼ŒæŒ‡å®šåŒ…çš„åˆ«å</span><br><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;dart:math&#x27;</span> <span class="hljs-keyword">as</span> math;<br><br><span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-comment">// ä½¿ç”¨åˆ«åï¼Œå¼•ç”¨åŒ…ä¸­çš„å‡½æ•° ã€‚</span><br>  <span class="hljs-keyword">var</span> a = math.<span class="hljs-title function_">max</span>(<span class="hljs-number">1</span>,<span class="hljs-number">100</span>);<br>  <span class="hljs-title function_">print</span>(a); <span class="hljs-comment">//æ‰“å° 100</span><br>&#125;<br></code></pre></td></tr></table></figure><h3 id="10-3ã€å¯¼å…¥åŒ…çš„éƒ¨åˆ†å†…å®¹"><a href="#10-3ã€å¯¼å…¥åŒ…çš„éƒ¨åˆ†å†…å®¹" class="headerlink" title="10.3ã€å¯¼å…¥åŒ…çš„éƒ¨åˆ†å†…å®¹"></a>10.3ã€å¯¼å…¥åŒ…çš„éƒ¨åˆ†å†…å®¹</h3><p>1ï¼‰ã€æœ‰æ—¶å€™æˆ‘ä»¬ä¸æƒ³å¯¼å…¥æ•´ä¸ªåŒ…ï¼Œåªæƒ³å¯¼å…¥åŒ…é‡Œé¢çš„æŸä¸ªç±»æˆ–è€…æŸä¸ªå‡½æ•°ã€‚Dart æä¾›äº†show å’Œ hide å…³é”®å­—å¤„ç†å¯¼å…¥åŒ…çš„éƒ¨åˆ†å†…å®¹</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs lua">//<span class="hljs-number">1</span>ã€ä»…å¯¼å…¥ <span class="hljs-built_in">max</span> å‡½æ•°, å¯¼å…¥å¤šä¸ªå†…å®¹ä½¿ç”¨é€—å·åˆ†éš”ï¼Œä¾‹å¦‚ show <span class="hljs-built_in">max</span>,<span class="hljs-built_in">sin</span><br>import <span class="hljs-string">&#x27;dart:math&#x27;</span> show <span class="hljs-built_in">max</span>;<br><br>//<span class="hljs-number">2</span>ã€é™¤äº†<span class="hljs-built_in">max</span>å‡½æ•°ï¼Œå¯¼å…¥ <span class="hljs-built_in">math</span> ä¸­çš„æ‰€æœ‰å†…å®¹ã€‚<br>import <span class="hljs-string">&#x27;dart:math&#x27;</span> hide <span class="hljs-built_in">max</span>;<br></code></pre></td></tr></table></figure><h3 id="10-4ã€å¯¼å…¥æœ¬åœ°æ¨¡å—"><a href="#10-4ã€å¯¼å…¥æœ¬åœ°æ¨¡å—" class="headerlink" title="10.4ã€å¯¼å…¥æœ¬åœ°æ¨¡å—"></a>10.4ã€å¯¼å…¥æœ¬åœ°æ¨¡å—</h3><p>åœ¨æ—¥å¸¸å¼€å‘ä¸­ï¼Œæˆ‘ä»¬ä¼šç»å¸¸ä¼šå¯¼å…¥æœ¬åœ°çš„æ¨¡å—ï¼Œä¸€èˆ¬é¡¹ç›®ä¸­ä¼šæœ‰å¤šä¸ª dart è„šæœ¬æ–‡ä»¶ï¼Œæ¯ä¸ª dart è„šæœ¬å®ç°ä¸åŒæ¨¡å—çš„ä»£ç ï¼Œåœ¨éœ€è¦çš„æ—¶å€™ç›´æ¥å¯¼å…¥ dart è„šæœ¬æ–‡ä»¶å³å¯</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-regexp">//</span>ä¾‹å¦‚æˆ‘æœ‰ä¸ªæœ¬åœ°æ¨¡å—ï¼šlibs/stack.dart<br><br><span class="hljs-regexp">//</span>å¯¼å…¥æœ¬åœ°æ¨¡å—<br><span class="hljs-regexp">//</span>ç›´æ¥é€šè¿‡æœ¬åœ°æ–‡ä»¶è·¯å¾„å¯¼å…¥ dart è„šæœ¬å³å¯<br>import <span class="hljs-string">&#x27;libs/stack.dart&#x27;</span>;<br></code></pre></td></tr></table></figure><h3 id="10-5ã€å¯¼å…¥ç¬¬ä¸‰æ–¹å¼€æºåŒ…"><a href="#10-5ã€å¯¼å…¥ç¬¬ä¸‰æ–¹å¼€æºåŒ…" class="headerlink" title="10.5ã€å¯¼å…¥ç¬¬ä¸‰æ–¹å¼€æºåŒ…"></a>10.5ã€å¯¼å…¥ç¬¬ä¸‰æ–¹å¼€æºåŒ…</h3><h4 id="10-5-1ã€æŸ¥æ‰¾ç¬¬ä¸‰æ–¹å¼€æºåŒ…"><a href="#10-5-1ã€æŸ¥æ‰¾ç¬¬ä¸‰æ–¹å¼€æºåŒ…" class="headerlink" title="10.5.1ã€æŸ¥æ‰¾ç¬¬ä¸‰æ–¹å¼€æºåŒ…"></a>10.5.1ã€æŸ¥æ‰¾ç¬¬ä¸‰æ–¹å¼€æºåŒ…</h4><p><a href="https://pub.dev/">https://pub.dev/</a> ï¼šè¿™ä¸ªæ˜¯ pub çš„ä¸­å¤®ä»“åº“, ä¸Šé¢æœ‰å¤§é‡çš„ç¬¬ä¸‰æ–¹å¼€æºåŒ…ï¼Œå¯ä»¥åˆ°è¿™é‡Œæ‰¾åˆ°è‡ªå·±æƒ³è¦çš„åŒ…</p><h4 id="10-5-2ã€é…ç½®ä¾èµ–åŒ…"><a href="#10-5-2ã€é…ç½®ä¾èµ–åŒ…" class="headerlink" title="10.5.2ã€é…ç½®ä¾èµ–åŒ…"></a>10.5.2ã€é…ç½®ä¾èµ–åŒ…</h4><p>åœ¨é¡¹ç›®æ ¹ç›®å½• pubspec.yaml ä¸­é…ç½® dependencies å±æ€§ï¼Œç»“æ„å¦‚ä¸‹ï¼š</p><blockquote><p>dependencies:</p><p>åŒ…å: ç‰ˆæœ¬å·</p></blockquote><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">dependencies</span>:<br>  <span class="hljs-attribute">http</span>: ^<span class="hljs-number">0</span>.<span class="hljs-number">13</span>.<span class="hljs-number">5</span><br>  <span class="hljs-attribute">cupertino_icons</span>: ^<span class="hljs-number">1</span>.<span class="hljs-number">0</span>.<span class="hljs-number">2</span><br></code></pre></td></tr></table></figure><p>å…³äºç‰ˆæœ¬å·è¯´æ˜ï¼Œå¦‚ä¸‹:</p><ul><li>^1.2.1 ä»£è¡¨çš„æ›´æ–°ç‰ˆæœ¬èŒƒå›´ä¸º &gt;&#x3D;1.2.1 &amp;&amp; &lt; 2.0.0</li><li>^0.2.1 ä»£è¡¨çš„æ›´æ–°ç‰ˆæœ¬èŒƒå›´ä¸º &gt;&#x3D;0.2.1 &amp;&amp; &lt; 0.3.0</li><li>^0.0.2 ä»£è¡¨çš„æ›´æ–°ç‰ˆæœ¬èŒƒå›´ä¸º 0.0.2ï¼ˆç›¸å½“äºé”å®šä¸ºäº† 0.0.2 ç‰ˆæœ¬ï¼‰</li></ul><p><strong>è§„å¾‹</strong>ï¼š å®åˆ™å°±æ˜¯æŠŠ ^ åé¢é 0 çš„æ•°å­— +1 ï¼Œç„¶åæŠŠå…¶ä»–ä½å˜ä¸º 0 å°±æ˜¯å®ƒçš„æœ€å¤§ç‰ˆæœ¬ã€‚å¦å¤–å¦‚æœæœ€åä¸€ä½é 0 ï¼Œå…¶ä»–ä½ä¸º 0 ï¼Œå°±ç›¸å½“äºé”ç‰ˆæœ¬ã€‚å¦‚ï¼š</p><figure class="highlight coq"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs coq">æœ€å¤§ç‰ˆæœ¬ï¼š^<span class="hljs-number">1.2</span><span class="hljs-number">.1</span> =&gt; <span class="hljs-number">2.2</span><span class="hljs-number">.1</span> =&gt; <span class="hljs-number">2.0</span><span class="hljs-number">.0</span> èŒƒå›´ï¼š<span class="hljs-number">1.2</span><span class="hljs-number">.1</span><span class="hljs-number">-2.0</span><span class="hljs-number">.0</span><br>æœ€å¤§ç‰ˆæœ¬ï¼š^<span class="hljs-number">0.2</span><span class="hljs-number">.1</span> =&gt; <span class="hljs-number">0.3</span><span class="hljs-number">.1</span> =&gt; <span class="hljs-number">0.3</span><span class="hljs-number">.0</span> èŒƒå›´ï¼š<span class="hljs-number">0.2</span><span class="hljs-number">.1</span><span class="hljs-number">-0.3</span><span class="hljs-number">.0</span><br>^<span class="hljs-number">0.0</span><span class="hljs-number">.2</span>ï¼šå›ºå®šç‰ˆæœ¬ï¼š<span class="hljs-number">0.0</span><span class="hljs-number">.2</span><br></code></pre></td></tr></table></figure><h4 id="10-5-3ã€ä¸‹è½½ä¾èµ–åŒ…"><a href="#10-5-3ã€ä¸‹è½½ä¾èµ–åŒ…" class="headerlink" title="10.5.3ã€ä¸‹è½½ä¾èµ–åŒ…"></a>10.5.3ã€ä¸‹è½½ä¾èµ–åŒ…</h4><p>æ‰“å¼€å‘½ä»¤è¡Œï¼Œè¾“å…¥å¦‚ä¸‹å‘½ä»¤ï¼š</p><figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs actionscript">flutter pub <span class="hljs-keyword">get</span><br></code></pre></td></tr></table></figure><p>æˆ–è€…ç›´æ¥ä½¿ç”¨å¼€å‘å·¥å…·çš„å¯è§†åŒ–ç•Œé¢æ“ä½œ</p><h4 id="10-5-4ã€å¯¼å…¥ç¬¬ä¸‰æ–¹å¼€æºåŒ…"><a href="#10-5-4ã€å¯¼å…¥ç¬¬ä¸‰æ–¹å¼€æºåŒ…" class="headerlink" title="10.5.4ã€å¯¼å…¥ç¬¬ä¸‰æ–¹å¼€æºåŒ…"></a>10.5.4ã€å¯¼å…¥ç¬¬ä¸‰æ–¹å¼€æºåŒ…</h4><p>ä¾èµ–åŒ…ä¸‹è½½å®‰è£…åï¼Œæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨ import å¯¼å…¥ç¬¬ä¸‰æ–¹åŒ…ï¼Œç¬¬ä¸‰æ–¹åŒ…å‰ç¼€ä¸º package:</p><figure class="highlight tcl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs tcl">// è¿™é‡Œå¯¼å…¥ <span class="hljs-keyword">http</span> åŒ…ï¼Œåˆ«åä¸º <span class="hljs-keyword">http</span><br>import &#x27;<span class="hljs-keyword">package</span>:<span class="hljs-keyword">http</span>/<span class="hljs-keyword">http</span>.dart&#x27; as <span class="hljs-keyword">http</span>;<br></code></pre></td></tr></table></figure><h2 id="åä¸€ã€Dart-å¼‚å¸¸å¤„ç†"><a href="#åä¸€ã€Dart-å¼‚å¸¸å¤„ç†" class="headerlink" title="åä¸€ã€Dart å¼‚å¸¸å¤„ç†"></a>åä¸€ã€Dart å¼‚å¸¸å¤„ç†</h2><p>ç±»ä¼¼ Javaï¼ŒDart æä¾›äº† Exception å’Œ Error ä¸¤ç§ç±»å‹çš„å¼‚å¸¸ä»¥åŠä¸€äº›å­ç±»</p><p>1ï¼‰ã€ä½¿ç”¨ throw å…³é”®å­—æŠ›å‡ºè‡ªå®šä¹‰ç±»å‹å¼‚å¸¸ï¼Œä¹Ÿå¯ä»¥å°†ä»»ä½•é null å¯¹è±¡ä½œä¸ºå¼‚å¸¸æŠ›å‡º</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-keyword">throw</span> <span class="hljs-built_in">Exception</span>(<span class="hljs-string">&#x27;è¿™æ˜¯ä¸€ä¸ªå¼‚å¸¸&#x27;</span>);<br><span class="hljs-keyword">throw</span> <span class="hljs-string">&#x27;è¿™æ˜¯ä¸€ä¸ªå¼‚å¸¸&#x27;</span>;<br></code></pre></td></tr></table></figure><p><strong>å°å»ºè®®</strong>ï¼šä¸€èˆ¬å»ºè®®æŠ›å‡º Exception å’Œ Error , æˆ–è€…ä»–ä»¬çš„å­ç±»</p><p>2ï¼‰ã€ä½¿ç”¨ try&#x2F;on catch é…åˆæ•è·å¼‚å¸¸</p><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs scss">void <span class="hljs-selector-tag">main</span>() &#123;<br>  try &#123;<br>    <span class="hljs-selector-tag">var</span> s;<br>    <span class="hljs-built_in">print</span>(s.length);<br>  &#125; on NoSuchMethodError catch (e) &#123;<br>    <span class="hljs-comment">//æ•è·å¼‚å¸¸å¹¶æ‰“å°</span><br>    <span class="hljs-built_in">print</span>(e);<br>  &#125; catch (e, s) &#123;<br>    <span class="hljs-comment">//å…œåº•å¤„ç† eï¼šæŠ›å‡ºçš„å¼‚å¸¸å¯¹è±¡ sï¼šæ ˆä¿¡æ¯ï¼Œæ­¤å‚æ•°å¯å†™å¯ä¸å†™</span><br>    <span class="hljs-built_in">print</span>(e);<br>    <span class="hljs-built_in">print</span>(s);<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ä¸Šè¿°ä»£ç ï¼š</p><p>1ã€ä½¿ç”¨ on å’Œ catch æ¥æ•è·å¼‚å¸¸ï¼šon ç”¨æ¥æŒ‡å®šå¼‚å¸¸çš„ç±»å‹ï¼Œcatch åˆ™ç”¨æ¥æ•è·å¯¹è±¡</p><p>2ã€å½“æŠ›å‡ºçš„é”™è¯¯å¹¶ä¸æ˜¯ on æŒ‡å®šçš„å¼‚å¸¸ç±»å‹æ—¶ï¼Œåˆ™èµ°æœ€åé¢çš„ catch å…œåº•</p><p>3ã€å…œåº• catch æ–¹æ³•æœ‰ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯æŠ›å‡ºçš„å¼‚å¸¸å¯¹è±¡ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯æ ˆä¿¡æ¯</p><p>3ï¼‰ã€ä½¿ç”¨ rethrow å†æ¬¡æŠ›å‡ºå¼‚å¸¸</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs csharp"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">exceptionMethod</span>()</span>&#123;<br>  <span class="hljs-keyword">try</span> &#123;<br>    <span class="hljs-built_in">dynamic</span> b = <span class="hljs-literal">true</span>;<br>    print(b++); <span class="hljs-comment">//NoSuchMethodError</span><br>  &#125; <span class="hljs-keyword">catch</span> (e) &#123;<br>    rethrow; <span class="hljs-comment">//å°†ä¸Šè¿°å¼‚å¸¸å†æ¬¡æŠ›å‡º</span><br>  &#125;<br>&#125;<br><br><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">main</span>()</span> &#123;<br>  <span class="hljs-keyword">try</span> &#123;<br>    exceptionMethod();<br>  &#125; <span class="hljs-keyword">catch</span> (e) &#123;<br>    <span class="hljs-comment">//æ•è·å¼‚å¸¸å¹¶æ‰“å°</span><br>    print(e);<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="åäºŒã€Dart-å¼‚æ­¥å¤„ç†"><a href="#åäºŒã€Dart-å¼‚æ­¥å¤„ç†" class="headerlink" title="åäºŒã€Dart å¼‚æ­¥å¤„ç†"></a>åäºŒã€Dart å¼‚æ­¥å¤„ç†</h2><p>Dart æ˜¯å•çº¿ç¨‹æ¨¡å‹çš„è¯­è¨€ï¼Œå¦‚æœæˆ‘ä»¬åœ¨ç¨‹åºä¸­åšè€—æ—¶æ“ä½œï¼šè¯·æ±‚ Api æ¥å£ï¼Œæ–‡ä»¶ IO ç­‰ï¼Œå°±å¯èƒ½å¯¼è‡´ç‚¹å‡»äº‹ä»¶æ²¡æœ‰å“åº”ï¼Œç¨‹åºå¡é¡¿ä¹‹ç±»çš„æƒ…å†µã€‚ä¸ºäº†å¤„ç†è¿™ç§æƒ…å†µï¼ŒDart å¼•å…¥äº†å¼‚æ­¥æ“ä½œæœºåˆ¶ï¼š</p><p>1ã€Dart å¼‚æ­¥å¤„ç†ä¸ä¼šé˜»å¡çº¿ç¨‹ï¼Œå…¶ä»–ä»»åŠ¡å¯ä»¥ç»§ç»­è¿è¡Œ</p><p>2ã€å› ä¸º Dart çš„å¼‚æ­¥æœºåˆ¶å¹¶ä¸æ¶‰åŠçº¿ç¨‹çš„åˆ‡æ¢ï¼Œä»…ä»…æ˜¯ç”±æˆ‘ä»¬çš„ç¼–ç¨‹è¯­è¨€å»æ§åˆ¶ï¼Œæ‰€ä»¥å®ƒçš„æ‰§è¡Œæ•ˆç‡éå¸¸é«˜</p><h3 id="12-1ã€Dart-å¼‚æ­¥å¤„ç†çš„ç”¨æ³•"><a href="#12-1ã€Dart-å¼‚æ­¥å¤„ç†çš„ç”¨æ³•" class="headerlink" title="12.1ã€Dart å¼‚æ­¥å¤„ç†çš„ç”¨æ³•"></a>12.1ã€Dart å¼‚æ­¥å¤„ç†çš„ç”¨æ³•</h3><p>1ï¼‰ã€Dart è¯­è¨€ä¸­ï¼Œæœ‰å¾ˆå¤šåº“çš„å‡½æ•°è¿”å› Future æˆ–è€… Stream å¯¹è±¡ï¼Œè¿™äº›å¯¹è±¡éƒ½æ˜¯ Dart å¯¹å¼‚æ­¥ç¼–ç¨‹æ”¯æŒçš„å®ç°</p><p>Future - ä»£è¡¨ä¸€ä¸ªå¼‚æ­¥è®¡ç®—ä»»åŠ¡ï¼Œå¯ä»¥è·å–ä»»åŠ¡çš„è®¡ç®—ç»“æœ</p><p>Stream - ä»£è¡¨ä¸€ä¸ªå¼‚æ­¥çš„æ•°æ®åºåˆ—ï¼Œé€šå¸¸ç”¨äºè¯»å–è¿ç»­çš„æ•°æ®æˆ–è€…äº‹ä»¶</p><h4 id="12-1-1ã€Future"><a href="#12-1-1ã€Future" class="headerlink" title="12.1.1ã€Future"></a>12.1.1ã€Future</h4><p>1ï¼‰ã€Futureä»£è¡¨çš„æ˜¯ä¸€ä¸ªå¼‚æ­¥çš„è®¡ç®—ä»»åŠ¡ï¼Œå¦‚æœä»»åŠ¡è¿˜æ²¡æ‰§è¡Œå®Œæˆï¼Œæˆ‘ä»¬æ˜¯æ‹¿ä¸åˆ°å¼‚æ­¥ä»»åŠ¡çš„ç»“æœ</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs awk">import <span class="hljs-string">&#x27;package:http/http.dart&#x27;</span> as http;<br><br>void main() &#123;<br>  var url = <span class="hljs-string">&quot;https://www.baidu.com/&quot;</span>;<br>  <span class="hljs-regexp">//</span>è°ƒç”¨ get å‡½æ•°è¯·æ±‚ url, è¿”å›ä¸€ä¸ªå°è£…äº† http è¯·æ±‚ä»»åŠ¡çš„ future å¯¹è±¡<br>  Future fTask = http.get(Uri.parse(url));<br>  <span class="hljs-regexp">//</span>æ‰“å° future å¯¹è±¡<br>  print(fTask);<br>  <br>  <span class="hljs-regexp">//</span> å‘ future å¯¹è±¡æ³¨å†Œå›è°ƒå‡½æ•°ï¼Œå¤„ç†è¯·æ±‚ç»“æœ<br>  fTask.then((response) =&gt; &#123;<br>    print(<span class="hljs-string">&#x27;Response status: $&#123;response.statusCode&#125;&#x27;</span>)<br>  &#125;);<br>  <span class="hljs-regexp">//</span> æ‰“å° main å‡½æ•°ç»“æŸæ ‡è®°<br>  print(<span class="hljs-string">&#x27;main end...&#x27;</span>);<br>&#125;<br><br><span class="hljs-regexp">//</span>æ‰“å°ç»“æœ<br>Instance of <span class="hljs-string">&#x27;Future&lt;Response&gt;&#x27;</span><br>main end...<br>Response status: <span class="hljs-number">200</span><br><br>Process finished with <span class="hljs-keyword">exit</span> code <span class="hljs-number">0</span><br></code></pre></td></tr></table></figure><p>ä¸Šè¿°ä»£ç ï¼š</p><p>1ã€é¦–å…ˆæ‰“å°äº† fTask ï¼Œè¾“å‡ºè¡¨ç¤º fTask æ˜¯ä¸€ä¸ª Future å¯¹è±¡ï¼Œå°†æ¥ä¼šè¿”å›ä¸€ä¸ªå« Response çš„ç»“æœå¯¹è±¡</p><p>2ã€æ¥ä¸‹æ¥æ‰“å°äº† main endâ€¦ ï¼Œè€Œä¸æ˜¯å…ˆè¾“å‡º http çš„è¯·æ±‚çŠ¶æ€ç </p><p>3ã€æœ€åæ‰“å°äº† http çš„è¯·æ±‚çŠ¶æ€ç ï¼šResponse status: 200 ï¼Œç„¶åè¿›ç¨‹ä¹Ÿé€€å‡ºäº†</p><p>ä¸Šé¢è¿™æ®µç¨‹åºåœ¨æ‰“å°äº† main endâ€¦ æ—¶è¿›ç¨‹å¹¶æ²¡æœ‰é€€å‡ºï¼Œè€Œæ˜¯ç­‰åˆ°æ‰“å°äº† http çš„è¯·æ±‚çŠ¶æ€ç ï¼šResponse status: 200 æ‰é€€å‡ºï¼Œè¿™ä¹ŸéªŒè¯äº†æˆ‘ä»¬å‰é¢ä¸€ä¸ªè§‚ç‚¹ï¼š <strong>Dart çš„å¼‚æ­¥æœºåˆ¶å¹¶ä¸æ¶‰åŠçº¿ç¨‹çš„åˆ‡æ¢ï¼Œä»…ä»…æ˜¯ç”±æˆ‘ä»¬çš„ç¼–ç¨‹è¯­è¨€å»æ§åˆ¶ï¼Œæ‰€ä»¥å®ƒçš„æ‰§è¡Œæ•ˆç‡éå¸¸é«˜</strong></p><h4 id="12-1-2ã€await-å’Œ-async"><a href="#12-1-2ã€await-å’Œ-async" class="headerlink" title="12.1.2ã€await å’Œ async"></a>12.1.2ã€await å’Œ async</h4><p>ä¸Šè¿°è¿™ä¸ªä¾‹å­å­˜åœ¨ä¸€ä¸ªé—®é¢˜ï¼š</p><p>1ã€éœ€è¦æ³¨å†Œå›è°ƒå‡½æ•°ï¼Œå¦‚æœæˆ‘æœ‰å¤šå±‚å›è°ƒï¼Œå¯è¯»æ€§å°±ä¼šå˜å¾—å¾ˆå·®</p><p>æ­¤æ—¶æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ await å’Œ async æœºåˆ¶æ¥å¤„ç†è¿™ä¸ªé—®é¢˜ï¼Œè€Œä¸”å®ƒè¿˜èƒ½è®©æˆ‘ä»¬ä½¿ç”¨åŒæ­¥çš„æ–¹å¼å†™å‡ºå¼‚æ­¥çš„ä»£ç </p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-keyword">void</span> main() <span class="hljs-keyword">async</span>&#123;<br>  <span class="hljs-keyword">var</span> url = <span class="hljs-string">&quot;https://www.baidu.com/&quot;</span>;<br>  <span class="hljs-comment">//è¯·æ±‚ url, é€šè¿‡ awaitï¼Œç­‰å¾… future å¼‚æ­¥è®¡ç®—ä»»åŠ¡çš„ç»“æœï¼Œæ‰§è¡ŒæˆåŠŸå°±ç›´æ¥è¿”å›ç»“æœ</span><br>  <span class="hljs-keyword">var</span> response = <span class="hljs-keyword">await</span> http.<span class="hljs-keyword">get</span>(<span class="hljs-built_in">Uri</span>.parse(url));<br>  <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;Response status: <span class="hljs-subst">$&#123;response.statusCode&#125;</span>&#x27;</span>);<br>  <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;main end...&#x27;</span>);<br>&#125;<br><br><span class="hljs-comment">//æ‰“å°ç»“æœ</span><br>Response status: <span class="hljs-number">200</span><br>main end...<br></code></pre></td></tr></table></figure><p>ä¸Šè¿°ä»£ç ï¼š</p><p>1ã€è¾“å‡ºç»“æœçš„é¡ºåºï¼Œè·Ÿæˆ‘ä»¬ä¹¦å†™ä»£ç çš„é¡ºåºä¸€è‡´</p><p>2ã€é€šè¿‡æ ‡è®° async å’Œ await å…³é”®å­—ï¼Œæˆ‘ä»¬çš„å¼‚æ­¥ä»£ç ï¼Œçœ‹èµ·æ¥è·ŸåŒæ­¥ä»£ç æ²¡ä»€ä¹ˆåŒºåˆ«ï¼š</p><ul><li>async å…³é”®å­—çš„ä½œç”¨å°±æ˜¯æ ‡è®°ä¸€ä¸ªå‡½æ•°æ˜¯å¼‚æ­¥å‡½æ•°</li><li>await å…³é”®å­—çš„ä½œç”¨æ˜¯ç­‰å¾…å¼‚æ­¥ä»»åŠ¡çš„ç»“æœ</li></ul><p><strong>æ³¨æ„ï¼š</strong> await å…³é”®å­—åªèƒ½åœ¨æ ‡è®°äº†async çš„å¼‚æ­¥å‡½æ•°ä¸­ä½¿ç”¨ï¼Œå¦åˆ™ä¼šæŠ¥é”™</p><h4 id="12-1-3ã€Stream"><a href="#12-1-3ã€Stream" class="headerlink" title="12.1.3ã€Stream"></a>12.1.3ã€Stream</h4><p>1ï¼‰ã€Stream ä»£è¡¨ä¸€ä¸ªå¼‚æ­¥çš„æ•°æ®åºåˆ—ï¼Œæ˜¯ä¸€ç§å¼‚æ­¥è¯»å–æµå¼æ•°æ®çš„æ–¹å¼ï¼Œä½¿ç”¨æ ¼å¼å¦‚ä¸‹ï¼š</p><blockquote><p>await for (æ•°æ®ç±»å‹ å˜é‡ in streamç±»å‹å˜é‡) {</p><p>&#x2F;&#x2F; å¤„ç†æ•°æ®</p><p>}</p></blockquote><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs csharp"><span class="hljs-function">Future&lt;<span class="hljs-built_in">int</span>&gt; <span class="hljs-title">sumStream</span>(<span class="hljs-params">Stream&lt;<span class="hljs-built_in">int</span>&gt; stream</span>) <span class="hljs-keyword">async</span></span> &#123;<br>  <span class="hljs-keyword">var</span> sum = <span class="hljs-number">0</span>;<br>  <span class="hljs-keyword">await</span> <span class="hljs-keyword">for</span> (final <span class="hljs-keyword">value</span> <span class="hljs-keyword">in</span> stream) &#123;<br>    sum += <span class="hljs-keyword">value</span>;<br>  &#125;<br>  <span class="hljs-keyword">return</span> sum;<br>&#125;<br><br><span class="hljs-comment">//async* è¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ªéœ€è¿”å› Stream ç±»å‹å‚æ•°çš„å¼‚æ­¥å‡½æ•°</span><br><span class="hljs-function">Stream&lt;<span class="hljs-built_in">int</span>&gt; <span class="hljs-title">countStream</span>(<span class="hljs-params"><span class="hljs-built_in">int</span> to</span>) <span class="hljs-keyword">async</span>*</span> &#123;<br>  <span class="hljs-keyword">for</span> (<span class="hljs-built_in">int</span> i = <span class="hljs-number">1</span>; i &lt;= to; i++) &#123;<br>    <span class="hljs-comment">//yield åœ¨è¿™é‡Œè¡¨ç¤ºæš‚æ—¶è®©å‡ºèµ„æºè®©å…¶ä»–ä»£ç æ‰§è¡Œ</span><br>    <span class="hljs-keyword">yield</span> i;<br>  &#125;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">main</span>() <span class="hljs-keyword">async</span></span>&#123;<br>  <span class="hljs-keyword">var</span> stream = countStream(<span class="hljs-number">10</span>);<br>  <span class="hljs-comment">//é€šè¿‡ await ç­‰å¾… sumStream è®¡ç®—è¿”å›ç»“æœ</span><br>  <span class="hljs-keyword">var</span> sum = <span class="hljs-keyword">await</span> sumStream(stream);<br>  print(sum);<br>&#125;<br><span class="hljs-comment">//æ‰“å°ç»“æœ</span><br><span class="hljs-number">55</span><br></code></pre></td></tr></table></figure><p>ä¸Šè¿°ä»£ç æˆ‘ä»¬ä½¿ç”¨ await æ ‡è®° for in å¾ªç¯è¯­å¥ï¼Œå¾ªç¯è¯»å– stream ç±»å‹å˜é‡ä¸­çš„æ•°æ®ï¼Œä»£ç ä¹¦å†™ä¹Ÿå¾ˆç›´è§‚ï¼Œè·ŸåŒæ­¥ä»£ç çš„ä¹¦å†™æ–¹å¼ä¸€è‡´</p><h2 id="åä¸‰ã€Dart-Isolate-å¹¶å‘"><a href="#åä¸‰ã€Dart-Isolate-å¹¶å‘" class="headerlink" title="åä¸‰ã€Dart Isolate å¹¶å‘"></a>åä¸‰ã€Dart Isolate å¹¶å‘</h2><p>æˆ‘ä»¬çŸ¥é“ä¸€èˆ¬å¸¸ç”¨çš„å¹¶å‘æœºåˆ¶ä¸»è¦åŒ…æ‹¬è¿›ç¨‹ï¼Œçº¿ç¨‹ä»¥åŠåé¢çš„åç¨‹ã€‚ä½†æ˜¯ Dart ä¸ä¸€èˆ¬ ğŸ˜‚ ï¼ŒDart ä¸­çš„å¹¶å‘æœºåˆ¶ä¸»è¦æ˜¯ç”± Isolate å»å®ç°çš„ã€‚æ‰€è°“ Isolate ï¼Œä½ å¯ä»¥ç®€å•çš„ç†è§£æ˜¯ä¸€ç§ç‰¹æ®Šçš„çº¿ç¨‹</p><p>Isolate çš„ç‰¹ç‚¹ï¼š</p><p>1ã€Isolate ä¹‹é—´ä¸èƒ½å…±äº«å†…å­˜</p><p>2ã€Isolate ä¹‹é—´åªèƒ½é€šè¿‡æ¶ˆæ¯é€šè®¯</p><p>ä¸èƒ½å…±äº«å†…å­˜ï¼Œæ„å‘³ç€ä½ ä¸èƒ½åƒçº¿ç¨‹é‚£æ ·é€šè¿‡å˜é‡å…±äº«çŠ¶æ€ï¼Œæ¯ä¸ª Isolate éƒ½æœ‰è‡ªå·±ç‹¬ç«‹çš„å†…å­˜ï¼Œè¿™æ ·è®¾è®¡çš„å¥½å¤„<strong>å°±æ˜¯ä½ ä¸ç”¨åŠ é”ï¼Œä¹Ÿèƒ½å®‰å…¨çš„æ“ä½œè‡ªå·±çš„æ•°æ®</strong></p><p>è¿™é‡Œä½ æ˜¯å¦ä¼šæœ‰ä¸€ä¸ªç–‘é—®ğŸ¤”ï¸ï¼šå‰é¢æˆ‘ä»¬é€šè¿‡ Dart å¼‚æ­¥æœºåˆ¶å¤„ç†äº†æ¥å£è¯·æ±‚ä¹‹ç±»çš„å¼‚æ­¥ä»»åŠ¡ï¼Œä¸æ˜¯ä¹Ÿæœ‰ç±»ä¼¼å¹¶å‘çš„æ•ˆæœå—ï¼Ÿé‚£ä¸ºä»€ä¹ˆè¿˜è¦å¼•å…¥ Isolate å¹¶å‘æœºåˆ¶å‘¢ï¼Ÿ</p><p>ç­”ï¼šå‰é¢æˆ‘ä»¬è®²çš„å¼‚æ­¥æœºåˆ¶ä½ å¯ä»¥ç†è§£ä¸ºä¸€ç§å‡å¼‚æ­¥ï¼Œå› ä¸ºå®ƒå®é™…è¿˜æ˜¯åœ¨ä¸€ä¸ªçº¿ç¨‹ä¸­å»å¤„ç†å„ç§ç½‘ç»œ IOï¼Œè¿™äº›ç½‘ç»œ IO å¹¶ä¸æ€ä¹ˆæ¶ˆè€— CPU èµ„æºï¼Œåªæ˜¯éœ€è¦å¤§é‡çš„ç­‰å¾…è¯·æ±‚å“åº”çš„æ—¶é—´ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥åˆ©ç”¨ç­‰å¾…çš„ç©ºé—²æ—¶é—´å»å¤„ç†å…¶ä»–ä»»åŠ¡ï¼Œè¿™å°±æ˜¯å¼‚æ­¥æœºåˆ¶èƒ½å¤Ÿæé«˜æ€§èƒ½çš„åŸå› ã€‚è¿™ç§æœºåˆ¶å…¶å®å’Œ Android Handler æœºåˆ¶æœ‰ç‚¹ç±»ä¼¼ã€‚è€Œç°åœ¨å¦‚æœä½ æœ‰ä¸€ä¸ªè®¡ç®—é‡éå¸¸å¤§çš„ä»»åŠ¡ï¼Œä¾‹å¦‚ï¼šä½ éœ€è¦å¯¹è§†é¢‘è¿›è¡Œæ ¼å¼åŒ–å¤„ç†ï¼Œè¿™ä¸ªæ—¶å€™è¿™äº› CPU å¯†é›†å‹è®¡ç®—å°±ä¼šé˜»å¡ä½ çš„çº¿ç¨‹ï¼Œå¯¼è‡´å…¶ä»–ä»»åŠ¡éƒ½æ‰§è¡Œä¸äº†ã€‚å› æ­¤é’ˆå¯¹è¿™ç§æ¯”è¾ƒè€— CPU èµ„æºçš„ä»»åŠ¡ï¼Œæœ€å¥½åˆ›å»ºä¸€ä¸ª Isolate å»å¤„ç†ï¼Œé¿å…é˜»å¡ä¸» Isolate ï¼ˆä¹Ÿå°±æ˜¯ä¸»çº¿ç¨‹ï¼‰ï¼Œè¿™æ ·ä¹Ÿå¯ä»¥åˆ©ç”¨è®¾å¤‡çš„å¤šæ ¸ç‰¹æ€§</p><h3 id="13-1ã€Isolate-åŸºæœ¬ç”¨æ³•"><a href="#13-1ã€Isolate-åŸºæœ¬ç”¨æ³•" class="headerlink" title="13.1ã€Isolate åŸºæœ¬ç”¨æ³•"></a>13.1ã€Isolate åŸºæœ¬ç”¨æ³•</h3><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-regexp">//</span> å¯¼å…¥ isolate åŒ…<br>import <span class="hljs-string">&#x27;dart:isolate&#x27;</span>;<br><br>void main() &#123;<br>  <span class="hljs-regexp">//</span> é€šè¿‡ Isolate.spawn é™æ€å‡½æ•°ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„ Isolate<br>  <span class="hljs-regexp">//</span> spawn æ˜¯ä¸€ä¸ªæ³›å‹å‡½æ•°ï¼Œæ¥å—ä¸€ä¸ªæ³›å‹å‚æ•°ï¼Œè¡¨ç¤º Isolate å…¥å£å‡½æ•°æ¥å—çš„å‚æ•°ç±»å‹<br>  <span class="hljs-regexp">//</span> è¿™é‡Œ spawn çš„æ³›å‹å‚æ•°æ˜¯ Stringï¼ŒsubTask æ˜¯å…¥å£å‡½æ•°<br>  <span class="hljs-regexp">//</span> ç¬¬äºŒä¸ªå‚æ•°è·Ÿæ³›å‹å‚æ•°ç±»å‹ä¸€è‡´ï¼Œè¡¨ç¤ºä¼ é€’ç»™å…¥å£å‡½æ•°çš„å‚æ•°ï¼Œè¿™é‡Œä¼ å…¥çš„æ˜¯å­—ç¬¦ä¸²<br>  Isolate.spawn&lt;String&gt;(subTask, <span class="hljs-string">&quot;my task&quot;</span>);<br>  print(<span class="hljs-string">&quot;main func end.&quot;</span>);<br>&#125;<br><br><span class="hljs-regexp">//</span> Isolate å…¥å£å‡½æ•°å®šä¹‰ï¼Œæ¥å—ä¸€ä¸ª String å‚æ•°<br><span class="hljs-regexp">//</span> å…¥å£å‡½æ•°çš„å‚æ•°ç±»å‹ç”±ä¸Šé¢çš„ spawn çš„æ³›å‹å‚æ•°å†³å®š<br>void subTask(String msg)&#123;<br>  print(<span class="hljs-string">&quot;subTask receive: $msg &quot;</span>);<br>&#125;<br><br><span class="hljs-regexp">//</span>æ‰“å°ç»“æœ<br>main <span class="hljs-keyword">func</span> end.<br>subTask receive: my task<br></code></pre></td></tr></table></figure><p>é€šè¿‡è¾“å‡ºï¼Œæˆ‘ä»¬å‘ç°å…ˆæ‰“å°äº† main func endï¼Œç„¶åï¼Œæ‰§è¡Œæ–°å»º Isolate çš„å…¥å£å‡½æ•°ã€‚ å¦‚æœæˆ‘ä»¬æƒ³è®©ä»£ç æ‰§è¡Œé¡ºåºï¼Œè·Ÿæˆ‘ä»¬ä¹¦å†™é¡ºåºä¸€è‡´çš„è¯ï¼Œå¯ä»¥ä½¿ç”¨ await å…³é”®å­—ç­‰å¾… Isolate æ‰§è¡Œç»“æŸï¼š</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-comment">// å¯¼å…¥ isolate åŒ…</span><br><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;dart:isolate&#x27;</span>;<br><br><span class="hljs-comment">// ä½¿ç”¨ async å…³é”®å­—å°† main å‡½æ•°æ ‡è®°ä¸ºä¸€ä¸ªå¼‚æ­¥å‡½æ•°ï¼Œè¿™æ ·æ‰èƒ½ä½¿ç”¨ await å…³é”®å­—</span><br><span class="hljs-keyword">void</span> main() <span class="hljs-keyword">async</span>&#123;<br>  <span class="hljs-comment">// ä½¿ç”¨ await å…³é”®å­—ç­‰å¾…ä»»åŠ¡æ‰§è¡Œå®Œæˆ</span><br>  <span class="hljs-keyword">await</span> Isolate.spawn&lt;<span class="hljs-built_in">String</span>&gt;(subTask, <span class="hljs-string">&quot;my task&quot;</span>);<br>  <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;main func end.&quot;</span>);<br>&#125;<br><br><span class="hljs-comment">// Isolate å…¥å£å‡½æ•°å®šä¹‰ï¼Œæ¥å—ä¸€ä¸ª String å‚æ•°</span><br><span class="hljs-keyword">void</span> subTask(<span class="hljs-built_in">String</span> msg)&#123;<br>  <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;subTask receive: <span class="hljs-subst">$msg</span> &quot;</span>);<br>&#125;<br><br><span class="hljs-comment">//æ‰“å°ç»“æœ</span><br>subTask receive: my task <br>main func end.<br></code></pre></td></tr></table></figure><h3 id="13-2ã€Isolate-æ¶ˆæ¯é€šè®¯"><a href="#13-2ã€Isolate-æ¶ˆæ¯é€šè®¯" class="headerlink" title="13.2ã€Isolate æ¶ˆæ¯é€šè®¯"></a>13.2ã€Isolate æ¶ˆæ¯é€šè®¯</h3><p>å¤šä¸ª Isolate ä¹‹é—´åªèƒ½é€šè¿‡æ¶ˆæ¯è¿›è¡Œé€šè®¯ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¦‚ä½•å»è·å–ä¸€ä¸ª Isolate è¿”å›çš„ç»“æœå‘¢ï¼Ÿ</p><p>ç­”ï¼šä¸»è¦é€šè¿‡ ReceivePort å’Œ SendPort ä¸¤ä¸ªç±»å¤„ç†æ¶ˆæ¯é€šè®¯</p><p>1ï¼‰ã€ReceivePort è´Ÿè´£æ¥æ”¶ SendPort å‘é€çš„æ¶ˆæ¯ï¼Œ SendPort å’Œ ReceivePort æ˜¯æ†ç»‘å…³ç³»ï¼Œ SendPort æ˜¯ç”± ReceivePort åˆ›å»ºçš„</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs csharp"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">main</span>() <span class="hljs-keyword">async</span></span>&#123;<br>   <span class="hljs-comment">// åˆ›å»ºä¸€ä¸ª ReceivePort ç”¨äºæ¥æ”¶æ¶ˆæ¯</span><br>   <span class="hljs-keyword">var</span> recv = ReceivePort();<br><br>   <span class="hljs-comment">// åˆ›å»ºä¸€ä¸ª Isolateï¼Œæ³›å‹å‚æ•°ä¸º SendPortï¼Œå…¥å£å‡½æ•°ä¸º subTask</span><br>   <span class="hljs-comment">// subTask å…¥å£å‡½æ•°çš„å‚æ•°ä¸º SendPort ç±»å‹ï¼Œå› æ­¤ spawn ç¬¬äºŒä¸ªå‚æ•°ï¼Œä¼ å…¥ recv çš„ sendPort å¯¹è±¡</span><br>   Isolate.spawn&lt;SendPort&gt;(subTask, recv.sendPort);<br><br>   <span class="hljs-comment">// ä½¿ç”¨ await ç­‰å¾… recv çš„ç¬¬ä¸€æ¡æ¶ˆæ¯</span><br>   <span class="hljs-keyword">var</span> result = <span class="hljs-keyword">await</span> recv.first;<br>   print(<span class="hljs-string">&quot;receiveï¼š$result&quot;</span>);<br>&#125;<br><br><span class="hljs-comment">// Isolate å…¥å£å‡½æ•°å®šä¹‰ï¼Œæ¥æ”¶ä¸€ä¸ª SendPort å¯¹è±¡ä½œä¸ºå‚æ•°</span><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">subTask</span>(<span class="hljs-params">SendPort port</span>)</span>&#123;<br>  <span class="hljs-comment">// ä½¿ç”¨ SendPort å‘é€ä¸€æ¡å­—ç¬¦ä¸²æ¶ˆæ¯</span><br>  port.send(<span class="hljs-string">&quot;subTask Result&quot;</span>);<br>&#125;<br><br><span class="hljs-comment">//æ‰“å°ç»“æœ</span><br>receiveï¼šsubTask Result<br></code></pre></td></tr></table></figure><h2 id="åå››ã€æ€»ç»“"><a href="#åå››ã€æ€»ç»“" class="headerlink" title="åå››ã€æ€»ç»“"></a>åå››ã€æ€»ç»“</h2><p>æœ¬ç¯‡ä¼°è®¡æ˜¯æˆ‘å†™è¿‡æœ€é•¿çš„æ–‡ç« äº†ï¼Œæ¯”ä¹‹å‰å†™ Kotlin å…¥é—¨é‚£ä¸€ç¯‡è¿˜è¦é•¿ğŸ˜‚ã€‚æ€»çš„æ¥è¯´ï¼Œè¿™ç¯‡æ–‡ç« å‡ ä¹æ¶µç›–äº† Dart çš„æ‰€æœ‰è¯­æ³•çŸ¥è¯†ï¼Œå¦‚æœä½ èƒ½å¤Ÿè€å¿ƒçœ‹åˆ°è¿™é‡Œï¼Œå¹¶æ‰‹æ•²é‡Œé¢çš„ç¤ºä¾‹ï¼Œç›¸ä¿¡ä½ ä¸€å®šæ”¶è·å¾ˆå¤§ã€‚å¦‚æœè§‰å¾—æˆ‘å†™çš„è¿˜ä¸é”™ï¼Œè¯·ç»™æˆ‘ç‚¹ä¸ªèµå§ğŸ¤</p><p><strong>æ„Ÿè°¢ä½ é˜…è¯»è¿™ç¯‡æ–‡ç« </strong></p><h3 id="ä¸‹ç¯‡é¢„å‘Š"><a href="#ä¸‹ç¯‡é¢„å‘Š" class="headerlink" title="ä¸‹ç¯‡é¢„å‘Š"></a>ä¸‹ç¯‡é¢„å‘Š</h3><p>åŸºç¡€æ‰“å¥½äº†ï¼Œä¸‹ç¯‡æ–‡ç« æˆ‘ä»¬å°±æ­£å¼è¿›å…¥åˆ° Flutter çš„å­¦ä¹ äº†ï¼Œæ•¬è¯·æœŸå¾…å§ğŸ˜„</p><h3 id="å‚è€ƒå’Œæ¨è"><a href="#å‚è€ƒå’Œæ¨è" class="headerlink" title="å‚è€ƒå’Œæ¨è"></a>å‚è€ƒå’Œæ¨è</h3><p><a href="https://juejin.cn/post/7075337131974983688#heading-72">ä¸€æ–‡æå®šDartè¯­æ³•</a></p><p><a href="https://www.tizi365.com/archives/165.html">Dartè¯­è¨€æ•™ç¨‹</a></p><p><a href="https://juejin.cn/post/7028710779171897351#heading-7">Flutter åŸºç¡€ | Dart è¯­æ³•</a></p><p><a href="https://dart.cn/tutorials/language">Dart å®˜æ–¹æ•™ç¨‹</a></p><blockquote><p><strong>ä½ çš„ç‚¹èµï¼Œè¯„è®ºï¼Œæ˜¯å¯¹æˆ‘å·¨å¤§çš„é¼“åŠ±ï¼</strong></p><p>æ¬¢è¿å…³æ³¨æˆ‘çš„<strong>å…¬ä¼—å·ï¼š</strong>  <a href="http://m6z.cn/6jwi7b"><strong>sweetying</strong></a> ï¼Œæ–‡ç« æ›´æ–°å¯ç¬¬ä¸€æ—¶é—´æ”¶åˆ°</p><p>å¦‚æœ<strong>æœ‰é—®é¢˜</strong>ï¼Œå…¬ä¼—å·å†…æœ‰åŠ æˆ‘å¾®ä¿¡çš„å…¥å£ï¼Œåœ¨æŠ€æœ¯å­¦ä¹ ã€ä¸ªäººæˆé•¿çš„é“è·¯ä¸Šï¼Œæˆ‘ä»¬ä¸€èµ·å‰è¿›ï¼</p></blockquote>]]></content>
    
    
    <categories>
      
      <category>Flutter</category>
      
    </categories>
    
    
    <tags>
      
      <tag>åŸåˆ›</tag>
      
      <tag>Flutter</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Flutterç³»åˆ—ï¼ˆä¸€ï¼‰ï¼šè¿è¡Œä½ çš„ç¬¬ä¸€ä¸ªFlutteråº”ç”¨</title>
    <link href="/2022/09/05/Flutter%E7%B3%BB%E5%88%97%EF%BC%88%E4%B8%80%EF%BC%89%EF%BC%9A%E8%BF%90%E8%A1%8C%E4%BD%A0%E7%9A%84%E7%AC%AC%E4%B8%80%E4%B8%AAFlutter%E5%BA%94%E7%94%A8/"/>
    <url>/2022/09/05/Flutter%E7%B3%BB%E5%88%97%EF%BC%88%E4%B8%80%EF%BC%89%EF%BC%9A%E8%BF%90%E8%A1%8C%E4%BD%A0%E7%9A%84%E7%AC%AC%E4%B8%80%E4%B8%AAFlutter%E5%BA%94%E7%94%A8/</url>
    
    <content type="html"><![CDATA[<p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/d6e402af2a774dbdbca9fc37e8027cfa~tplv-k3u1fbpfcp-watermark.image"></p><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>Flutter æ˜¯ Google æ¨å‡ºå¹¶å¼€æºçš„ç§»åŠ¨ç«¯å¼€å‘æ¡†æ¶ï¼Œä¸»æ‰“è·¨å¹³å°ã€é«˜ä¿çœŸã€é«˜æ€§èƒ½ã€‚å¼€å‘è€…å¯ä»¥é€šè¿‡ Dart è¯­è¨€å¼€å‘ Appï¼Œä¸€å¥—ä»£ç å¯ä»¥åŒæ—¶è¿è¡Œåœ¨ iOS å’Œ Androidå¹³å°ã€‚</p><p>2018 å¹´ 12 æœˆï¼ŒGoogle å‘å¸ƒ Flutter 1.0ã€‚ä»é‚£æ—¶å€™å¼€å§‹ï¼ŒFlutter ä»¥è¿…é›·ä¸åŠæ©è€³ä¹‹åŠ¿ï¼Œè¿…é€Ÿå´›èµ·ï¼Œå¹¶ç¨³å›ºäº†å…¶åœ¨å¸‚åœºä¸Šçš„åœ°ä½ã€‚</p><p>å¦‚ä»Šï¼ŒFlutter ç›¸å…³èµ„æºå’Œç¤¾åŒºéƒ½å·²æ¸æ¸æˆç†Ÿï¼Œå¾—åˆ°äº†å¾ˆå¤šå¼€å‘è€…å’Œä¼ä¸šçš„ä¿¡ä»»ã€‚å¦å¤–å› ä¸ºå…¬å¸ä¸šåŠ¡æ‰©å¼ ï¼Œå‡†å¤‡å¼•å…¥ Flutter å¼€å‘é¡¹ç›®ï¼Œæ‰€ä»¥å­¦ä¹  Flutter åŠ¿åœ¨å¿…è¡Œï¼Œä¸‹é¢å°±è·Ÿç€æˆ‘çš„è„šæ­¥è¿›è¡Œ Flutter çš„å­¦ä¹ å§</p><h2 id="ä¸€ã€Flutter-å¼€å‘ç¯å¢ƒæ­å»º"><a href="#ä¸€ã€Flutter-å¼€å‘ç¯å¢ƒæ­å»º" class="headerlink" title="ä¸€ã€Flutter å¼€å‘ç¯å¢ƒæ­å»º"></a>ä¸€ã€Flutter å¼€å‘ç¯å¢ƒæ­å»º</h2><p><strong>æ³¨æ„</strong>ï¼šæœ¬æ–‡ä»¥ macOS ç³»ç»Ÿä¸ºä¾‹</p><h3 id="1ï¼‰ã€ä½¿ç”¨é•œåƒ"><a href="#1ï¼‰ã€ä½¿ç”¨é•œåƒ" class="headerlink" title="1ï¼‰ã€ä½¿ç”¨é•œåƒ"></a>1ï¼‰ã€ä½¿ç”¨é•œåƒ</h3><p>ç”±äºåœ¨å›½å†…è®¿é—® Flutter æœ‰æ—¶å¯èƒ½ä¼šå—åˆ°é™åˆ¶ï¼Œ Flutter å®˜æ–¹ä¸ºä¸­å›½å¼€å‘è€…æ­å»ºäº†ä¸´æ—¶é•œåƒï¼Œæˆ‘ä»¬åªéœ€å°†å¦‚ä¸‹ç¯å¢ƒå˜é‡é…ç½®åˆ°ç”¨æˆ·ç¯å¢ƒå˜é‡ä¸­å³å¯ï¼š</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-keyword">export</span> PUB_HOSTED_URL=https:<span class="hljs-comment">//pub.flutter-io.cn</span><br><span class="hljs-keyword">export</span> FLUTTER_STORAGE_BASE_URL=https:<span class="hljs-comment">//storage.flutter-io.cn</span><br></code></pre></td></tr></table></figure><h3 id="2ï¼‰ã€ä¸‹è½½-Flutter-SDK"><a href="#2ï¼‰ã€ä¸‹è½½-Flutter-SDK" class="headerlink" title="2ï¼‰ã€ä¸‹è½½ Flutter SDK"></a>2ï¼‰ã€ä¸‹è½½ Flutter SDK</h3><p>æ–¹å¼æœ‰ 2ï¼š</p><h4 id="1ã€ç›´æ¥å»-Flutter-å®˜ç½‘ä¸‹è½½æœ€æ–°çš„å®‰è£…åŒ…å³å¯"><a href="#1ã€ç›´æ¥å»-Flutter-å®˜ç½‘ä¸‹è½½æœ€æ–°çš„å®‰è£…åŒ…å³å¯" class="headerlink" title="1ã€ç›´æ¥å» Flutter å®˜ç½‘ä¸‹è½½æœ€æ–°çš„å®‰è£…åŒ…å³å¯"></a>1ã€ç›´æ¥å» Flutter å®˜ç½‘ä¸‹è½½æœ€æ–°çš„å®‰è£…åŒ…å³å¯</h4><p>ä¸‹è½½åœ°å€ï¼š<a href="https://docs.flutter.dev/development/tools/sdk/releases?tab=macos#macos">https://docs.flutter.dev/development/tools/sdk/releases?tab=macos#macos</a></p><h4 id="2ã€é€šè¿‡-git-clone-ä¸‹è½½"><a href="#2ã€é€šè¿‡-git-clone-ä¸‹è½½" class="headerlink" title="2ã€é€šè¿‡ git clone ä¸‹è½½"></a>2ã€é€šè¿‡ git clone ä¸‹è½½</h4><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dart">git clone -b master https:<span class="hljs-comment">//github.com/flutter/flutter.git</span><br></code></pre></td></tr></table></figure><p>ä¸Šè¿°è¿™å¥å‘½ä»¤ä¼šå°†ä»“åº“å…‹éš†ä¸‹æ¥å¹¶åˆ‡æ¢åˆ° master åˆ†æ”¯</p><p><strong>æ³¨æ„</strong>ï¼šä¸Šè¿°ä¸¤ç§æ–¹å¼ç¬¬ä¸€ç§éœ€è¦è§£å‹ï¼Œç¬¬äºŒç§ä¸éœ€è¦ï¼Œæ€»ä¹‹å°†å®ƒä»¬æ”¾ç½®åˆ°æ‚¨æƒ³æ”¾çš„åœ°æ–¹å³å¯</p><h3 id="3ï¼‰ã€é…ç½®-Flutter-ç¯å¢ƒå˜é‡"><a href="#3ï¼‰ã€é…ç½®-Flutter-ç¯å¢ƒå˜é‡" class="headerlink" title="3ï¼‰ã€é…ç½® Flutter ç¯å¢ƒå˜é‡"></a>3ï¼‰ã€é…ç½® Flutter ç¯å¢ƒå˜é‡</h3><p>å°† Flutter ç¯å¢ƒå˜é‡é…ç½®åˆ°ä½ çš„ç”¨æˆ·ç¯å¢ƒï¼Œä¸‹é¢ä»¥æˆ‘ä¸ªäººçš„ä¸ºä¾‹ï¼š</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs dart"># flutter ç¯å¢ƒå˜é‡<br><span class="hljs-keyword">export</span> FLUTTER_HOME=/Users/zhouying/Library/flutter<br><span class="hljs-keyword">export</span> PATH=$&#123;PATH&#125;:$&#123;FLUTTER_HOME&#125;/bin<br></code></pre></td></tr></table></figure><h3 id="4ï¼‰ã€éªŒè¯-Flutter-æ˜¯å¦å®‰è£…æˆåŠŸ"><a href="#4ï¼‰ã€éªŒè¯-Flutter-æ˜¯å¦å®‰è£…æˆåŠŸ" class="headerlink" title="4ï¼‰ã€éªŒè¯ Flutter æ˜¯å¦å®‰è£…æˆåŠŸ"></a>4ï¼‰ã€éªŒè¯ Flutter æ˜¯å¦å®‰è£…æˆåŠŸ</h3><p>é€šè¿‡<code>flutter doctor</code>æ¥æ£€æŸ¥æ˜¯å¦éœ€è¦å®‰è£…å…¶å®ƒä¾èµ–é¡¹æ¥å®Œæˆå®‰è£…ï¼Œè¿™ä¸ªè¿‡ç¨‹ç¬¬ä¸€æ¬¡å¯èƒ½éœ€è¦è€—è´¹ä¸€æ®µæ—¶é—´ï¼Œä¸‹æ¬¡å°±ä¼šå¿«å¾ˆå¤š</p><p><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/3928cb6c9f4d443fa22245f7ba2a8d58~tplv-k3u1fbpfcp-watermark.image" alt="202201261529488.png"></p><p>ä»ä¸Šé¢è¯Šæ–­ä¿¡æ¯æˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼š</p><p>1ã€Flutter ç‰ˆæœ¬å’Œæ¸ é“å· ok</p><p>2ã€Flutterè¿è¡Œæ‰€éœ€çš„ Android å·¥å…·é“¾ ok</p><p>3ã€Flutter æ‰€éœ€çš„ iOS å¼€å‘ç¯å¢ƒä¸ ok</p><p>4ã€Chrome ok</p><p>5ã€AndroidStudio ok</p><p>6ã€è¿æ¥çš„è®¾å¤‡ ok</p><p>7ã€HTTP ä¸»æœºå¯ç”¨æ€§ ok</p><h3 id="5ï¼‰ã€ä¸€äº›é¢å¤–å¸¸ç”¨çš„-Flutter-å‘½ä»¤"><a href="#5ï¼‰ã€ä¸€äº›é¢å¤–å¸¸ç”¨çš„-Flutter-å‘½ä»¤" class="headerlink" title="5ï¼‰ã€ä¸€äº›é¢å¤–å¸¸ç”¨çš„ Flutter å‘½ä»¤"></a>5ï¼‰ã€ä¸€äº›é¢å¤–å¸¸ç”¨çš„ Flutter å‘½ä»¤</h3><p>1ã€é€šè¿‡<code>flutter --help</code>æŸ¥çœ‹æ‰€å®‰è£… Flutter éœ€è¦çš„å¸®åŠ©</p><p>2ã€é€šè¿‡<code>flutter --version</code>æŸ¥çœ‹ Flutter ç‰ˆæœ¬</p><p>3ã€é€šè¿‡<code>flutter devices</code>æŸ¥çœ‹å½“å‰å¯ç”¨çš„è®¾å¤‡</p><p>4ã€é€šè¿‡<code>flutter run</code>è¿è¡Œå¯åŠ¨ä½ çš„åº”ç”¨ç¨‹åº</p><h2 id="äºŒã€å¹³å°è®¾ç½®"><a href="#äºŒã€å¹³å°è®¾ç½®" class="headerlink" title="äºŒã€å¹³å°è®¾ç½®"></a>äºŒã€å¹³å°è®¾ç½®</h2><p><strong>æ³¨æ„</strong>ï¼šè¿™é‡Œä¸»è¦è®² Android å¹³å°</p><h3 id="1ï¼‰ã€å®‰è£…å¹¶é…ç½®ä½ çš„-Android-Studio"><a href="#1ï¼‰ã€å®‰è£…å¹¶é…ç½®ä½ çš„-Android-Studio" class="headerlink" title="1ï¼‰ã€å®‰è£…å¹¶é…ç½®ä½ çš„ Android Studio"></a>1ï¼‰ã€å®‰è£…å¹¶é…ç½®ä½ çš„ Android Studio</h3><p>1ã€ä¸‹è½½å¹¶å®‰è£… <a href="https://developer.android.com/studio/index.html">Android Studio</a>.</p><p><strong>æ³¨æ„</strong>ï¼šAndroid Studio éœ€è¦ 3.0 æˆ–æ›´é«˜ç‰ˆæœ¬</p><p>2ã€å¯åŠ¨ Android Studioï¼Œç„¶åæ‰§è¡Œ Android Studio å®‰è£…å‘å¯¼ï¼Œè¿™å°†å®‰è£…æœ€æ–°çš„ Android SDKï¼ŒAndroid SDK å¹³å°å·¥å…·å’Œ Android SDK æ„å»ºå·¥å…·ï¼Œè¿™æ˜¯ Flutter ä¸º Android å¼€å‘æ—¶æ‰€å¿…éœ€çš„</p><h3 id="2ï¼‰ã€è®¾ç½®ä½ çš„-Android-è®¾å¤‡"><a href="#2ï¼‰ã€è®¾ç½®ä½ çš„-Android-è®¾å¤‡" class="headerlink" title="2ï¼‰ã€è®¾ç½®ä½ çš„ Android è®¾å¤‡"></a>2ï¼‰ã€è®¾ç½®ä½ çš„ Android è®¾å¤‡</h3><p><strong>æ³¨æ„</strong>ï¼šAndroid è®¾å¤‡éœ€è¦ Android 4.1ï¼ˆAPI level 16ï¼‰æˆ–æ›´é«˜ç‰ˆæœ¬</p><h4 id="1ã€çœŸæœº"><a href="#1ã€çœŸæœº" class="headerlink" title="1ã€çœŸæœº"></a>1ã€çœŸæœº</h4><blockquote><p>1ã€åœ¨æ‚¨çš„è®¾å¤‡ä¸Šå¯ç”¨ <strong>å¼€å‘äººå‘˜é€‰é¡¹</strong> å’Œ <strong>USBè°ƒè¯•</strong></p><p>2ã€ä½¿ç”¨USBå°†æ‰‹æœºæ’å…¥ç”µè„‘ã€‚å¦‚æœæ‚¨çš„è®¾å¤‡å‡ºç°æç¤ºï¼Œè¯·æˆæƒæ‚¨çš„è®¡ç®—æœºè®¿é—®æ‚¨çš„è®¾å¤‡</p><p>3ã€åœ¨ç»ˆç«¯ä¸­ï¼Œè¿è¡Œ <code>flutter devices</code> å‘½ä»¤ä»¥éªŒè¯Flutterè¯†åˆ«æ‚¨è¿æ¥çš„Androidè®¾å¤‡</p><p>4ã€è¿è¡Œå¯åŠ¨æ‚¨çš„åº”ç”¨ç¨‹åº <code>flutter run</code></p></blockquote><h4 id="2ã€æ¨¡æ‹Ÿå™¨"><a href="#2ã€æ¨¡æ‹Ÿå™¨" class="headerlink" title="2ã€æ¨¡æ‹Ÿå™¨"></a>2ã€æ¨¡æ‹Ÿå™¨</h4><blockquote><p>1ã€åœ¨æ‚¨çš„æœºå™¨ä¸Šå¯ç”¨ <a href="https://developer.android.com/studio/run/emulator-acceleration.html">VM acceleration</a> </p><p>2ã€å¯åŠ¨ <strong>Android Studio&gt;Tools&gt;Android&gt;AVD Manager</strong> å¹¶é€‰æ‹© <strong>Create Virtual Device</strong></p><p>3ã€é€‰æ‹©ä¸€ä¸ªè®¾å¤‡å¹¶é€‰æ‹© <strong>Next</strong></p><p>4ã€ä¸ºè¦æ¨¡æ‹Ÿçš„ Android ç‰ˆæœ¬é€‰æ‹©ä¸€ä¸ªæˆ–å¤šä¸ªç³»ç»Ÿæ˜ åƒï¼Œç„¶åé€‰æ‹© <strong>Next</strong>. å»ºè®®ä½¿ç”¨ <em>x86</em> æˆ– <em>x86_64</em> image </p><p>5ã€åœ¨ Emulated Performanceä¸‹, é€‰æ‹© <strong>Hardware - GLES 2.0</strong> ä»¥å¯ç”¨ <a href="https://developer.android.com/studio/run/emulator-acceleration.html">ç¡¬ä»¶åŠ é€Ÿ</a></p><p>6ã€éªŒè¯AVDé…ç½®æ˜¯å¦æ­£ç¡®ï¼Œç„¶åé€‰æ‹© <strong>Finish</strong></p><p>7ã€åœ¨ Android Virtual Device Manager ä¸­, ç‚¹å‡»å·¥å…·æ çš„ <strong>Run</strong>ã€‚æ¨¡æ‹Ÿå™¨å¯åŠ¨å¹¶æ˜¾ç¤ºæ‰€é€‰æ“ä½œç³»ç»Ÿç‰ˆæœ¬æˆ–è®¾å¤‡çš„å¯åŠ¨ç”»é¢.</p><p>8ã€è¿è¡Œ <code>flutter run</code> å¯åŠ¨æ‚¨çš„è®¾å¤‡. è¿æ¥çš„è®¾å¤‡åæ˜¯ <code>Android SDK built for &lt;platform&gt;</code>ï¼Œå…¶ä¸­ <em>platform</em> æ˜¯èŠ¯ç‰‡ç³»åˆ—ï¼Œå¦‚ x86</p></blockquote><h3 id="3ï¼‰ã€åœ¨-AndroidStudio-ä¸Šå®‰è£…-Flutter-å’Œ-dart-æ’ä»¶"><a href="#3ï¼‰ã€åœ¨-AndroidStudio-ä¸Šå®‰è£…-Flutter-å’Œ-dart-æ’ä»¶" class="headerlink" title="3ï¼‰ã€åœ¨ AndroidStudio ä¸Šå®‰è£… Flutter å’Œ dart æ’ä»¶"></a>3ï¼‰ã€åœ¨ AndroidStudio ä¸Šå®‰è£… Flutter å’Œ dart æ’ä»¶</h3><ul><li><code>Flutter</code>æ’ä»¶ï¼š æ”¯æŒFlutterå¼€å‘å·¥ä½œæµ (è¿è¡Œã€è°ƒè¯•ã€çƒ­é‡è½½ç­‰)</li><li><code>Dart</code>æ’ä»¶ï¼š æä¾›ä»£ç åˆ†æ (è¾“å…¥ä»£ç æ—¶è¿›è¡ŒéªŒè¯ã€ä»£ç è¡¥å…¨ç­‰)</li></ul><p>è¦å®‰è£…è¿™äº›:</p><ol><li>å¯åŠ¨ Android Studio</li><li>æ‰“å¼€æ’ä»¶é¦–é€‰é¡¹ <strong>Preferences &gt; Plugins</strong></li><li>é€‰æ‹© <strong>Browse repositoriesâ€¦</strong>, é€‰æ‹© Flutter æ’ä»¶å¹¶ç‚¹å‡» <code>install</code></li><li>é‡å¯ Android Studio åæ’ä»¶ç”Ÿæ•ˆ</li></ol><p><strong>æ³¨æ„</strong>ï¼šå½“ä½ å®‰è£… Flutter æ’ä»¶åï¼Œä¼šè‡ªåŠ¨å®‰è£… Dart æ’ä»¶</p><h2 id="ä¸‰ã€åˆ›å»ºå¹¶è¿è¡Œä½ çš„ç¬¬ä¸€ä¸ª-Flutter-åº”ç”¨"><a href="#ä¸‰ã€åˆ›å»ºå¹¶è¿è¡Œä½ çš„ç¬¬ä¸€ä¸ª-Flutter-åº”ç”¨" class="headerlink" title="ä¸‰ã€åˆ›å»ºå¹¶è¿è¡Œä½ çš„ç¬¬ä¸€ä¸ª Flutter åº”ç”¨"></a>ä¸‰ã€åˆ›å»ºå¹¶è¿è¡Œä½ çš„ç¬¬ä¸€ä¸ª Flutter åº”ç”¨</h2><h3 id="1ï¼‰ã€åˆ›å»ºæ–°åº”ç”¨"><a href="#1ï¼‰ã€åˆ›å»ºæ–°åº”ç”¨" class="headerlink" title="1ï¼‰ã€åˆ›å»ºæ–°åº”ç”¨"></a>1ï¼‰ã€åˆ›å»ºæ–°åº”ç”¨</h3><p>1ã€é€‰æ‹© <strong>File &gt; New Flutter Project</strong></p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/3c6360e622964e47b26eb78d4d6324ae~tplv-k3u1fbpfcp-zoom-1.image" alt="image-20220112220116827" style="zoom:50%;" /><p>2ã€é€‰æ‹© <strong>Flutter</strong> ä½œä¸º project ç±»å‹, ç„¶åç‚¹å‡» Next</p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/9bdad331ea4c45119cdb82840793e3b1~tplv-k3u1fbpfcp-zoom-1.image" alt="image-20220112220159083" style="zoom:50%;" /><p>3ã€è¾“å…¥é¡¹ç›®åç§° (å¦‚ <code>myapp</code>)ï¼Œç„¶åç‚¹å‡» Next</p><p><strong>æ³¨æ„</strong>ï¼šProject name å­—æ¯å¿…é¡»éƒ½æ˜¯å°å†™ï¼Œå¦åˆ™ä¼šæç¤ºä½ ä¸èƒ½åˆ›å»ºåº”ç”¨</p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/5de438253adc4fb9ba333b9e0fd2f522~tplv-k3u1fbpfcp-zoom-1.image" alt="image-20220112220309504" style="zoom:50%;" /><p>4ã€ç‚¹å‡» <strong>Finish</strong></p><p>5ã€ç­‰å¾… Android Studio å®‰è£… SDK å¹¶åˆ›å»ºé¡¹ç›®</p><h3 id="2ï¼‰ã€Flutter-å·¥ç¨‹ç»“æ„è§£æ"><a href="#2ï¼‰ã€Flutter-å·¥ç¨‹ç»“æ„è§£æ" class="headerlink" title="2ï¼‰ã€Flutter å·¥ç¨‹ç»“æ„è§£æ"></a>2ï¼‰ã€Flutter å·¥ç¨‹ç»“æ„è§£æ</h3><p>å¦‚ä¸‹å›¾å°±æ˜¯æˆ‘ä»¬åˆ›å»ºå¥½çš„ä¸€ä¸ª Flutter é¡¹ç›®å·¥ç¨‹ç»“æ„ï¼š</p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/c06e013ea6f54f208fd3e355f98639aa~tplv-k3u1fbpfcp-zoom-1.image" alt="image-20220113145050564" style="zoom:50%;" /><p>ç®€å•çš„è§£é‡Šä¸€ä¸‹ï¼š</p><table><thead><tr><th>æ–‡ä»¶</th><th>æè¿°</th></tr></thead><tbody><tr><td>myapp</td><td>é¡¹ç›®å·¥ç¨‹åç§°</td></tr><tr><td>.dart_tool</td><td>Dart å·¥å…·å¼€å‘ç›¸å…³é…ç½®</td></tr><tr><td>.idea</td><td>Flutter å¼€å‘ç¯å¢ƒé…ç½®</td></tr><tr><td>android</td><td>Android å¹³å°ç›¸å…³ä»£ç </td></tr><tr><td>ios</td><td>iOS å¹³å°ç›¸å…³ä»£ç </td></tr><tr><td>lib</td><td>è·¨å¹³å°ä»£ç ï¼Œä¹Ÿæ˜¯ Flutter é¡¹ç›®ä¸»è¦å…³å¿ƒçš„ç›®å½•</td></tr><tr><td>test</td><td>æµ‹è¯•ç›¸å…³ä»£ç </td></tr><tr><td>.gitignore</td><td>git æäº¤ä»“åº“å¿½ç•¥æ–‡ä»¶</td></tr><tr><td>.metadata</td><td>å¯¹å½“å‰å·¥ç¨‹çš„é…ç½®è®°å½•</td></tr><tr><td>.packages</td><td>ä»¥ lib ç»“å°¾çš„æ–‡ä»¶ç»å¯¹è·¯å¾„</td></tr><tr><td>analysis_options.yaml</td><td>é™æ€åˆ†ææ–‡ä»¶</td></tr><tr><td>myapp.iml</td><td>å·¥ç¨‹æ–‡ä»¶çš„æœ¬åœ°è·¯å¾„é…ç½®</td></tr><tr><td>pubspec.lock</td><td>å½“å‰é¡¹ç›®ä¾èµ–æ‰€ç”Ÿæˆçš„æ–‡ä»¶</td></tr><tr><td>pubspec.yaml</td><td>é¡¹ç›®æè¿°æ–‡ä»¶ï¼ŒåŒ…å«äº†é¡¹ç›®çš„æè¿°ä¿¡æ¯ä»¥åŠæ‰€éœ€è¦çš„ä¾èµ–çš„åº“</td></tr><tr><td>README.md</td><td>é¡¹ç›®æè¿°ä¿¡æ¯</td></tr><tr><td>External Libraries</td><td>Android å¼€å‘åŒ…ï¼Œèµ„æºæ–‡ä»¶ã€Dart SDK æ–‡ä»¶ã€å·¥ç¨‹å¼€å‘ä¾èµ–æ’ä»¶ API ç­‰ç­‰</td></tr><tr><td>Scratches and Consoles</td><td>åˆ›å»ºçš„ä¸´æ—¶æ–‡ä»¶å’Œç¼“å†²åŒºåˆ—è¡¨</td></tr></tbody></table><h3 id="3ï¼‰ã€è¿è¡Œåº”ç”¨"><a href="#3ï¼‰ã€è¿è¡Œåº”ç”¨" class="headerlink" title="3ï¼‰ã€è¿è¡Œåº”ç”¨"></a>3ï¼‰ã€è¿è¡Œåº”ç”¨</h3><p>1ã€å®šä½åˆ° Android Studio å·¥å…·æ ï¼Œé€‰æ‹©è¿è¡Œåº”ç”¨çš„ Android è®¾å¤‡ï¼Œæˆ‘è¿™é‡Œé€‰æ‹©çš„æ˜¯çœŸæœº</p><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/a722418fe13f4df8880c3d82dc8df874~tplv-k3u1fbpfcp-zoom-1.image" alt="image-20220112220957667"></p><p>2ã€åœ¨å·¥å…·æ ä¸­ç‚¹å‡» <strong>Run å›¾æ ‡</strong>ï¼Œæˆ–è€…è°ƒç”¨èœå•é¡¹ <strong>Run &gt; Run</strong>ï¼Œæˆ–è€…ä½¿ç”¨<code>flutter run</code> å‘½ä»¤æ¥è¿è¡Œä½ çš„åº”ç”¨</p><p>3ã€å¦‚æœä¸€åˆ‡æ­£å¸¸, ä½ åº”è¯¥åœ¨ä½ çš„è®¾å¤‡æˆ–æ¨¡æ‹Ÿå™¨ä¸Šä¼šçœ‹åˆ°å¯åŠ¨çš„åº”ç”¨ï¼š</p><p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/baf1a7e5dc404bc3b3835c3025801cf9~tplv-k3u1fbpfcp-watermark.image" alt="202201261600172.png"></p><h3 id="4ï¼‰ã€ä½“éªŒçƒ­é‡è½½"><a href="#4ï¼‰ã€ä½“éªŒçƒ­é‡è½½" class="headerlink" title="4ï¼‰ã€ä½“éªŒçƒ­é‡è½½"></a>4ï¼‰ã€ä½“éªŒçƒ­é‡è½½</h3><blockquote><p>Flutter å¯ä»¥é€šè¿‡ <em>çƒ­é‡è½½ï¼ˆhot reloadï¼‰</em> å®ç°å¿«é€Ÿæ•ˆæœé¢„è§ˆï¼Œçƒ­é‡è½½å°±æ˜¯æ— éœ€é‡å¯åº”ç”¨ç¨‹åºå°±èƒ½å®æ—¶åŠ è½½ä¿®æ”¹åçš„ä»£ç ï¼Œå¹¶ä¸”ä¸ä¼šä¸¢å¤±çŠ¶æ€ï¼ˆè¿™å’Œ webpack çš„çƒ­é‡è½½æ˜¯ä¸€æ ·çš„ï¼‰ã€‚ç®€å•çš„å¯¹ä»£ç è¿›è¡Œæ›´æ”¹ï¼Œç„¶åå‘Šè¯‰ IDE æˆ–å‘½ä»¤è¡Œå·¥å…·ä½ éœ€è¦é‡æ–°åŠ è½½ï¼ˆç‚¹å‡»reloadæŒ‰é’®ï¼‰ï¼Œä½ å°±ä¼šåœ¨ä½ çš„è®¾å¤‡æˆ–æ¨¡æ‹Ÿå™¨ä¸Šçœ‹åˆ°æ›´æ”¹</p></blockquote><p>1ã€å°†å­—ç¬¦ä¸²<code>You have pushed the button this many times:&#39;</code> æ›´æ”¹ä¸º<code>You have clicked the button this many times:&#39;</code></p><p>2ã€ä¸è¦æŒ‰<code>Stop</code>æŒ‰é’®ï¼Œè®©ä½ çš„åº”ç”¨ç»§ç»­è¿è¡Œ</p><p>3ã€è¦æŸ¥çœ‹ä½ çš„æ›´æ”¹, åªéœ€è°ƒç”¨<code>command + s</code>ï¼Œæˆ–ç‚¹å‡» <strong>çƒ­é‡è½½æŒ‰é’®</strong> (å¸¦æœ‰é—ªç”µâš¡ï¸å›¾æ ‡çš„æŒ‰é’®) å³å¯</p><p><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/2c2690d17dd74f8eae0da8e6ff48b409~tplv-k3u1fbpfcp-watermark.image" alt="202201261539133.png"></p><h2 id="å››ã€æ€»ç»“"><a href="#å››ã€æ€»ç»“" class="headerlink" title="å››ã€æ€»ç»“"></a>å››ã€æ€»ç»“</h2><p>æœ¬ç¯‡æ–‡ç« è®²çš„ä¸€äº›é‡ç‚¹å†…å®¹ï¼š</p><p>1ã€Flutter å¼€å‘ç¯å¢ƒæ­å»º</p><p>2ã€Flutter åœ¨ Android å¹³å°ç›¸å…³è®¾ç½®</p><p>3ã€åˆ›å»ºå¹¶è¿è¡Œä½ çš„ç¬¬ä¸€ä¸ª Flutter é¡¹ç›®ï¼ŒFlutter å·¥ç¨‹ç»“æ„è§£æ</p><p>å¥½äº†ï¼Œæœ¬ç¯‡æ–‡ç« åˆ°è¿™é‡Œå°±ç»“æŸäº†ï¼Œå¸Œæœ›èƒ½ç»™ä½ å¸¦æ¥å¸®åŠ© ğŸ¤ </p><p><strong>æ„Ÿè°¢ä½ é˜…è¯»è¿™ç¯‡æ–‡ç« </strong></p><h3 id="ä¸‹ç¯‡é¢„å‘Š"><a href="#ä¸‹ç¯‡é¢„å‘Š" class="headerlink" title="ä¸‹ç¯‡é¢„å‘Š"></a>ä¸‹ç¯‡é¢„å‘Š</h3><p>å› ä¸º Flutter æ˜¯åŸºäº Dart è¯­è¨€å¼€å‘çš„ï¼Œæ‰€ä»¥ä¸‹ç¯‡æ–‡ç« æˆ‘ä¼šè®² Dart è¯­è¨€ç›¸å…³çš„å†…å®¹ï¼Œæ•¬è¯·æœŸå¾…å§ğŸ˜„</p><h3 id="å‚è€ƒå’Œæ¨è"><a href="#å‚è€ƒå’Œæ¨è" class="headerlink" title="å‚è€ƒå’Œæ¨è"></a>å‚è€ƒå’Œæ¨è</h3><p><a href="https://flutterchina.club/setup-macos/">Flutter å®˜æ–¹æ–‡æ¡£</a></p><p><a href="https://book.flutterchina.club/chapter1/flutter_intro.html">ã€ŠFlutterå®æˆ˜Â·ç¬¬äºŒç‰ˆã€‹- Preview</a></p><blockquote><p><strong>ä½ çš„ç‚¹èµï¼Œè¯„è®ºï¼Œæ˜¯å¯¹æˆ‘å·¨å¤§çš„é¼“åŠ±ï¼</strong></p><p>æ¬¢è¿å…³æ³¨æˆ‘çš„<strong>å…¬ä¼—å·ï¼š</strong>  <a href="http://m6z.cn/6jwi7b"><strong>sweetying</strong></a> ï¼Œæ–‡ç« æ›´æ–°å¯ç¬¬ä¸€æ—¶é—´æ”¶åˆ°</p><p>å¦‚æœ<strong>æœ‰é—®é¢˜</strong>ï¼Œå…¬ä¼—å·å†…æœ‰åŠ æˆ‘å¾®ä¿¡çš„å…¥å£ï¼Œåœ¨æŠ€æœ¯å­¦ä¹ ã€ä¸ªäººæˆé•¿çš„é“è·¯ä¸Šï¼Œæˆ‘ä»¬ä¸€èµ·å‰è¿›ï¼</p></blockquote>]]></content>
    
    
    <categories>
      
      <category>Flutter</category>
      
    </categories>
    
    
    <tags>
      
      <tag>åŸåˆ›</tag>
      
      <tag>Flutter</tag>
      
    </tags>
    
  </entry>
  
  
  
  
</search>
